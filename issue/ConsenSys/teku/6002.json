{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6002",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6002",
  "id": 1324563726,
  "node_id": "I_kwDOCM9I9M5O8z0O",
  "number": 6002,
  "title": "Besu/Teku: Execution Client is offline",
  "user": {
    "login": "q9f",
    "id": 58883403,
    "node_id": "MDQ6VXNlcjU4ODgzNDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/q9f",
    "html_url": "https://github.com/q9f",
    "followers_url": "https://api.github.com/users/q9f/followers",
    "following_url": "https://api.github.com/users/q9f/following{/other_user}",
    "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
    "organizations_url": "https://api.github.com/users/q9f/orgs",
    "repos_url": "https://api.github.com/users/q9f/repos",
    "events_url": "https://api.github.com/users/q9f/events{/privacy}",
    "received_events_url": "https://api.github.com/users/q9f/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-08-01T15:02:05Z",
  "updated_at": "2022-08-03T10:36:42Z",
  "closed_at": "2022-08-03T01:20:28Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nI upgraded Besu from 22.4.2 to 22.4.4 and Teku from 22.6.0. to 22.7.0 and get the following error without changing any configuration:\r\n\r\n```\r\n2022-08-01 16:47:57.660 ERROR - Execution Client is offline\r\njava.net.ConnectException: Failed to connect to /127.0.0.1:8550\r\nat okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:297) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:207) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:226) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:106) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:74) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.RealCall.initExchange$okhttp(RealCall.kt:255) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:32) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:95) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:83) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:76) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nat tech.pegasys.teku.ethereum.executionclient.auth.JwtAuthHttpInterceptor.intercept(JwtAuthHttpInterceptor.java:41) ~[teku-ethereum-executionclient-22.7.0.jar:22.7.0]\r\nat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.RealCall.getResponseWithInterceptorChain$okhttp(RealCall.kt:201) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.RealCall.execute(RealCall.kt:154) ~[okhttp-4.9.2.jar:?]\r\nat org.web3j.protocol.http.HttpService.performIO(HttpService.java:165) ~[core-4.9.3.jar:?]\r\nat org.web3j.protocol.Service.send(Service.java:48) ~[core-4.9.3.jar:?]\r\nat org.web3j.protocol.Service.lambda$sendAsync$0(Service.java:60) ~[core-4.9.3.jar:?]\r\nat org.web3j.utils.Async.lambda$run$1(Async.java:38) ~[core-4.9.3.jar:?]\r\nat java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\nat java.lang.Thread.run(Thread.java:833) ~[?:?]\r\nCaused by: java.net.ConnectException: Connection refused\r\nat sun.nio.ch.Net.pollConnect(Native Method) ~[?:?]\r\nat sun.nio.ch.Net.pollConnectNow(Net.java:672) ~[?:?]\r\nat sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:539) ~[?:?]\r\nat sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:594) ~[?:?]\r\nat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327) ~[?:?]\r\nat java.net.Socket.connect(Socket.java:633) ~[?:?]\r\nat okhttp3.internal.platform.Platform.connectSocket(Platform.kt:128) ~[okhttp-4.9.2.jar:?]\r\nat okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:295) ~[okhttp-4.9.2.jar:?]\r\n... 25 more\r\n2022-08-01 16:47:57.661 ERROR - An error occurred while querying remote transition configuration\r\njava.util.concurrent.CompletionException: java.lang.IllegalArgumentException: Invalid remote response: Failed to connect to /127.0.0.1:8550\r\nat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:320) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:649) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:147) ~[teku-infrastructure-async-22.7.0.jar:22.7.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.7.0.jar:22.7.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?] \r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat org.web3j.utils.Async.lambda$run$1(Async.java:40) ~[core-4.9.3.jar:?]\r\nat java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\nat java.lang.Thread.run(Thread.java:833) ~[?:?]\r\nCaused by: java.lang.IllegalArgumentException: Invalid remote response: Failed to connect to /127.0.0.1:8550\r\nat com.google.common.base.Preconditions.checkArgument(Preconditions.java:220) ~[guava-31.1-jre.jar:?]\r\nat tech.pegasys.teku.ethereum.executionlayer.ExecutionLayerManagerImpl.unwrapResponseOrThrow(ExecutionLayerManagerImpl.java:499) ~[teku-ethereum-executionlayer-22.7.0.jar:22.7.0]\r\nat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:646) ~[?:?]\r\n... 17 more\r\n```\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\nBesu Config:\r\n\r\n```\r\n  besu \\\r\n    --data-path=\"/home/user/.local/share/besu\" \\\r\n    --max-peers=512 \\\r\n    --rpc-http-enabled=true \\\r\n    --identity=\"Q9f Goerli Prater Tiaki\" \\\r\n    --network=goerli \\\r\n    --engine-jwt-enabled=true \\\r\n    --engine-jwt-secret=\"/home/user/.ethereum/jwtsecret.hex\" \\\r\n    --engine-rpc-port=8550\r\n```\r\n\r\nTeku Config:\r\n\r\n```\r\n  teku \\\r\n    --network=\"goerli\" \\\r\n    --data-path=\"/home/user/.local/share/teku\" \\\r\n    --ee-endpoint=\"http://127.0.0.1:8550\" \\\r\n    --ee-jwt-secret-file=\"/home/user/.ethereum/jwtsecret.hex\" \\\r\n    --eth1-endpoint=\"http://127.0.0.1:8545\" \\\r\n    --rest-api-enabled=true \\\r\n    --validators-graffiti=\"Goerli Tiaki @q9f Teku\" \\\r\n    --validators-proposer-default-fee-recipient=\"0xe0a2Bd4258D2768837BAa26A28fE71Dc079f84c7\" \\\r\n    --metrics-enabled=true \\\r\n    --log-destination=\"CONSOLE\"\r\n```\r\n\r\n**Expected behavior:** Should work as it did previously.\r\n\r\n**Actual behavior:** Teku cannot reach Besu's engine API on port 8550.\r\n\r\n**Frequency:** Happenend on two machines were I conducted the upgrade. A restart of both clients did not resolve this.\r\n\r\nNotably, there are no logs indicating issues on the Besu side, however, it could also be a Besu issue?\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `teku/v22.7.0/linux-x86_64/-na-openjdk64bitservervm-java-18`\r\n* Java version: `openjdk version \"18.0.2\" 2022-07-19`\r\n* OS Name & Version: `NAME=\"Arch Linux\"`\r\n* Docker Version: N/A\r\n* Cloud VM, type, size: Ryzen 7 1700X bare metal, 64GB RAM, 2x",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6002/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1201766178",
    "html_url": "https://github.com/ConsenSys/teku/issues/6002#issuecomment-1201766178",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002",
    "id": 1201766178,
    "node_id": "IC_kwDOCM9I9M5HoX8i",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T21:59:55Z",
    "updated_at": "2022-08-01T21:59:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "Is besu listening on port 8550? It seems like Teku can't connect.  Importantly besu 22.4.4 doesn't include the TTD for Goerli so it probably isn't enabling it's engine API endpoint - you'd need at least besu 22.7.0-RC2 (but I suggest using 22.7.0-RC3) or to add the TTD as an override.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1201766178/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1201767088",
    "html_url": "https://github.com/ConsenSys/teku/issues/6002#issuecomment-1201767088",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002",
    "id": 1201767088,
    "node_id": "IC_kwDOCM9I9M5HoYKw",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T22:01:04Z",
    "updated_at": "2022-08-01T22:01:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also worth noting your seeing the errors now because the Teku upgrade did add the merge config for Goerli so it's actually starting to use the `--ee-endpoint` option now, whereas before it wasn't used for anything (only the `--eth1-endpoint` option was used).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1201767088/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1203376424",
    "html_url": "https://github.com/ConsenSys/teku/issues/6002#issuecomment-1203376424",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002",
    "id": 1203376424,
    "node_id": "IC_kwDOCM9I9M5HuhEo",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-03T01:20:28Z",
    "updated_at": "2022-08-03T01:20:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to close this one as the issue appears to just be that besu isn't configured correctly and so teku really can't connect to the engine API and is reporting that correctly. Let me know if I've misunderstood something though.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1203376424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1203775732",
    "html_url": "https://github.com/ConsenSys/teku/issues/6002#issuecomment-1203775732",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6002",
    "id": 1203775732,
    "node_id": "IC_kwDOCM9I9M5HwCj0",
    "user": {
      "login": "q9f",
      "id": 58883403,
      "node_id": "MDQ6VXNlcjU4ODgzNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/q9f",
      "html_url": "https://github.com/q9f",
      "followers_url": "https://api.github.com/users/q9f/followers",
      "following_url": "https://api.github.com/users/q9f/following{/other_user}",
      "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
      "organizations_url": "https://api.github.com/users/q9f/orgs",
      "repos_url": "https://api.github.com/users/q9f/repos",
      "events_url": "https://api.github.com/users/q9f/events{/privacy}",
      "received_events_url": "https://api.github.com/users/q9f/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-03T10:36:42Z",
    "updated_at": "2022-08-03T10:36:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for your explanation. I was assuming that the EE endpoint is always available. üëçüèº ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1203775732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
