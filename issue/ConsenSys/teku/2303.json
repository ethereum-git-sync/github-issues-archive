{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2303",
  "id": 649846613,
  "node_id": "MDU6SXNzdWU2NDk4NDY2MTM=",
  "number": 2303,
  "title": "Native memory excessive consumption and native memory leaks",
  "user": {
    "login": "Nashatyrev",
    "id": 8173857,
    "node_id": "MDQ6VXNlcjgxNzM4NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Nashatyrev",
    "html_url": "https://github.com/Nashatyrev",
    "followers_url": "https://api.github.com/users/Nashatyrev/followers",
    "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
    "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
    "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
    "repos_url": "https://api.github.com/users/Nashatyrev/repos",
    "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1271198478,
      "node_id": "MDU6TGFiZWwxMjcxMTk4NDc4",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/performance%20%F0%9F%9A%80",
      "name": "performance ðŸš€",
      "color": "ffcce3",
      "default": false,
      "description": "Improves performance without changing functionality"
    },
    {
      "id": 2172541810,
      "node_id": "MDU6TGFiZWwyMTcyNTQxODEw",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P2",
      "name": "P2",
      "color": "FFA500",
      "default": false,
      "description": "High"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Nashatyrev",
    "id": 8173857,
    "node_id": "MDQ6VXNlcjgxNzM4NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Nashatyrev",
    "html_url": "https://github.com/Nashatyrev",
    "followers_url": "https://api.github.com/users/Nashatyrev/followers",
    "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
    "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
    "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
    "repos_url": "https://api.github.com/users/Nashatyrev/repos",
    "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 31,
  "created_at": "2020-07-02T11:11:56Z",
  "updated_at": "2021-07-12T22:00:05Z",
  "closed_at": "2021-07-12T22:00:05Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/PegasysEng/teku/blob/master/CODE-OF-CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging wiki: https://github.com/PegasysEng/teku/wiki/debugging -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3APegasysEng/Teku -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n\r\nWhen running Teku with `-Xmx1G` the `java` process resident memory tend to be of ~`2.5G` which looks like an overhead\r\n\r\nWhen running Teku with e.g. `-Xmx1G`, the total JVM memory consumption is estimated to be around 1.5G (including `ByteBuffers` which are mostly Netty owned). \r\nIt's also expected for `RocksDB` to consume around `200Mb` with the current defaults: \r\n- 128Mb for write buffer\r\n- 8Mb for block cache \r\n- Other native structures\r\n\r\nThus we having ~`0.8G` of unknown native memory consumption. \r\n`RocksDB` is the major native lib used in Teku so it is the primary suspect. \r\n\r\nHere is the process memory consumption over time: \r\n![Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ](https://user-images.githubusercontent.com/8173857/86351464-f7e9b580-bc6c-11ea-9c3d-5cc715e9e0d1.png)\r\n\r\nFrom the graph it doesn't looks like the memory is leaking\r\n\r\n### Acceptance Criteria\r\nTeku process with `-Xmx1G` shouldn't consume more than `2G`\r\n\r\n### Steps to Reproduce (Bug)\r\nRun Teku node with `-Xmx1G` on Onyx (or other) testnet for about 2-3 hours \r\n\r\n**Expected behavior:** process consumes < `2Gb`\r\n\r\n**Actual behavior:** process consumes `2.5G`\r\n\r\n**Frequency:** Always\r\n\r\n### Versions (Add all that apply)\r\n```\r\ncommit d98d802cb416819a22081be693ffb130c052e425 (HEAD -> master, origin/master, origin/HEAD)\r\nAuthor: Adrian Sutton <adrian.sutton@consensys.net>\r\nDate:   Wed Jul 1 15:03:46 2020 +1000\r\n```\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2303/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652946026",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-652946026",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 652946026,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1Mjk0NjAyNg==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-02T11:17:14Z",
    "updated_at": "2020-07-02T11:17:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is the information gathered by `jemalloc` with following settings: \r\n```\r\n> export LD_PRELOAD=/usr/local/lib/libjemalloc.so\r\n> export MALLOC_CONF=\"prof:true,lg_prof_interval:30,lg_prof_sample:17\"\r\n```\r\n```\r\n(pprof) top\r\nTotal: 75500943443 B\r\n42991837621  56.9%  56.9% 49218367523  65.2% JVM_RaiseSignal\r\n14543664971  19.3%  76.2% 14543931233  19.3% rocksdb::Arena::AllocateNewBlock\r\n3092307015   4.1%  80.3% 3092307015   4.1% YMap::init\r\n2128888958   2.8%  83.1% 2128888958   2.8% YNodeTree::allocateFreeNode\r\n1978396368   2.6%  85.7% 4883327036   6.5% _init\r\n1310280226   1.7%  87.5% 1310280226   1.7% inflate\r\n1277841606   1.7%  89.2% 1277841606   1.7% YMap::rehash\r\n955604955   1.3%  90.4% 955604955   1.3% CountingSupportBase::getCounterPtrImpl\r\n854434717   1.1%  91.6% 854434717   1.1% std::string::_Rep::_S_create\r\n829081038   1.1%  92.7% 3140881904   4.2% YNodeTree::YNodeTree\r\n597342681   0.8%  93.5% 3924786781   5.2% PlayerEventAdding::createTableRow\r\n(pprof) top --cum\r\nTotal: 75500943443 B\r\n       0   0.0%   0.0% 52106014966  69.0% JVM_handle_linux_signal\r\n42991837621  56.9%  56.9% 49218367523  65.2% JVM_RaiseSignal\r\n       0   0.0%  56.9% 33374137573  44.2% 0x00007fa1cb91c96f\r\n       0   0.0%  56.9% 14633438816  19.4% Java_org_rocksdb_Transaction_commit\r\n       0   0.0%  56.9% 14633438816  19.4% rocksdb::PessimisticTransaction::Commit\r\n       0   0.0%  56.9% 14625888452  19.4% rocksdb::DBImpl::WriteImpl\r\n       0   0.0%  56.9% 14625888452  19.4% rocksdb::WriteCommittedTxn::CommitWithoutPrepareInternal\r\n14543664971  19.3%  76.2% 14543931233  19.3% rocksdb::Arena::AllocateNewBlock\r\n  131120   0.0%  76.2% 14369816624  19.0% rocksdb::SkipListFactory::CreateMemTableRep\r\n       0   0.0%  76.2% 14369685504  19.0% rocksdb::ConcurrentArena::AllocateAligned\r\n       0   0.0%  76.2% 14369685504  19.0% rocksdb::MemTable::Add\r\n```\r\n\r\nThough I'm not sure how to interpret those numbers correctly it appears that no one besides `RocksDB` is in duty for memory consumption",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652946026/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652947650",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-652947650",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 652947650,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1Mjk0NzY1MA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-02T11:20:57Z",
    "updated_at": "2020-07-02T11:20:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is the usual JVM Native memory layout for Teku with `-Xmx1G`: \r\n\r\n(Note that `Other` part includes allocated `ByteBuffers` which are 99% owned by Netty (Libp2p)\r\n\r\n```\r\n> jcmd 20485 VM.native_memory\r\n20485:\r\n\r\nNative Memory Tracking:\r\n\r\nTotal: reserved=2851785KB, committed=1524893KB\r\n-                 Java Heap (reserved=1048576KB, committed=1048576KB)\r\n                            (mmap: reserved=1048576KB, committed=1048576KB)\r\n\r\n-                     Class (reserved=1123823KB, committed=81439KB)\r\n                            (classes #11294)\r\n                            (  instance classes #10641, array classes #653)\r\n                            (malloc=3567KB #54769)\r\n                            (mmap: reserved=1120256KB, committed=77872KB)\r\n                            (  Metadata:   )\r\n                            (    reserved=71680KB, committed=70064KB)\r\n                            (    used=68772KB)\r\n                            (    free=1292KB)\r\n                            (    waste=0KB =0.00%)\r\n                            (  Class space:)\r\n                            (    reserved=1048576KB, committed=7808KB)\r\n                            (    used=6959KB)\r\n                            (    free=849KB)\r\n                            (    waste=0KB =0.00%)\r\n\r\n-                    Thread (reserved=110554KB, committed=11166KB)\r\n                            (thread #107)\r\n                            (stack: reserved=109944KB, committed=10556KB)\r\n                            (malloc=383KB #644)\r\n                            (arena=227KB #213)\r\n\r\n-                      Code (reserved=250952KB, committed=65832KB)\r\n                            (malloc=3264KB #7984)\r\n                            (mmap: reserved=247688KB, committed=62568KB)\r\n\r\n-                        GC (reserved=106664KB, committed=106664KB)\r\n                            (malloc=34844KB #145736)\r\n                            (mmap: reserved=71820KB, committed=71820KB)\r\n\r\n-                  Compiler (reserved=981KB, committed=981KB)\r\n                            (malloc=951KB #1068)\r\n                            (arena=30KB #5)\r\n\r\n-                  Internal (reserved=40024KB, committed=40024KB)\r\n                            (malloc=39992KB #53696)\r\n                            (mmap: reserved=32KB, committed=32KB)\r\n\r\n-                     Other (reserved=131309KB, committed=131309KB)\r\n                            (malloc=131309KB #40)\r\n\r\n-                    Symbol (reserved=12100KB, committed=12100KB)\r\n                            (malloc=10462KB #128405)\r\n                            (arena=1638KB #1)\r\n\r\n-    Native Memory Tracking (reserved=6250KB, committed=6250KB)\r\n                            (malloc=29KB #395)\r\n                            (tracking overhead=6220KB)\r\n\r\n-        Shared class space (reserved=17024KB, committed=17024KB)\r\n                            (mmap: reserved=17024KB, committed=17024KB)\r\n\r\n-               Arena Chunk (reserved=2939KB, committed=2939KB)\r\n                            (malloc=2939KB)\r\n\r\n-                   Logging (reserved=4KB, committed=4KB)\r\n                            (malloc=4KB #191)\r\n\r\n-                 Arguments (reserved=41KB, committed=41KB)\r\n                            (malloc=41KB #495)\r\n\r\n-                    Module (reserved=279KB, committed=279KB)\r\n                            (malloc=279KB #2133)\r\n\r\n-              Synchronizer (reserved=258KB, committed=258KB)\r\n                            (malloc=258KB #2159)\r\n\r\n-                 Safepoint (reserved=8KB, committed=8KB)\r\n                            (mmap: reserved=8KB, committed=8KB)\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652947650/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652949064",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-652949064",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 652949064,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1Mjk0OTA2NA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-02T11:24:02Z",
    "updated_at": "2020-07-02T11:24:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is also a chat with Besu team member on RocksDB versions: \r\n>Anton Nashatyrev  1 day ago\r\nHey team! I'm trying to investigate native memory leaks in Teku and the main suspect is RocksDB.\r\nI'd love to consult with someone from Besu who may have any RocksDB tuning experience (edited) \r\n\r\nDanno Ferrin:besu:  21 hours ago\r\nThe only serious work Iâ€™ve done was to play with rocksdb versions.  6.4.6 which is what teku currently runs is what we had for 1.4.x versions of besu.  We just updated to 6.8.1 as part of 1.5.0 library version updates.  Prior versions were 6.2.4 and 5.15.10.  We rolled back to 5.15.10 because of severe leaks in 5.17.2. (edited) \r\n\r\nAnton Nashatyrev  21 hours ago\r\nSo you generally didn't experience any memory problems with 6.4.6 ?\r\n\r\nDanno Ferrin:besu:  21 hours ago\r\nI think we did, it just never caused OOMs within 2 weeks for our production nodes.\r\n\r\nDanno Ferrin:besu:  21 hours ago\r\nA classic full sync did die after 3 weeks.\r\n\r\nAnton Nashatyrev  21 hours ago\r\nDo you know what was the approximate process mem size comparing to max heap size ?\r\n\r\nDanno Ferrin:besu:  21 hours ago\r\nnot really.  Havent dug that deeply.\r\n\r\nAnton Nashatyrev  21 hours ago\r\nIs the 6.8.1 version better in that respect?\r\n\r\nDanno Ferrin:besu:  21 hours ago\r\nItâ€™s the newest.  During our quarterly minor version RCs we update all versions to newest and see if anything breaks.  Mostly doing it to keep ahead of security advisories.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652949064/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/654248276",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-654248276",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 654248276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NDI0ODI3Ng==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-06T13:45:34Z",
    "updated_at": "2020-07-06T13:45:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like we have light native memory leak. This is the process memory usage for ~100 hours:\r\n![Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ](https://user-images.githubusercontent.com/8173857/86599868-e9223c00-bfa7-11ea-858d-31710d49c0e2.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/654248276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/661831485",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-661831485",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 661831485,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MTgzMTQ4NQ==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-21T12:39:09Z",
    "updated_at": "2020-07-21T12:39:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Upped to P2 now that we've seen a couple of OOMs.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/661831485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/662365336",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-662365336",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 662365336,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MjM2NTMzNg==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-22T10:05:54Z",
    "updated_at": "2020-07-23T10:32:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Run the node without `RocksDB` and with `-XX:MaxDirectMemorySize=128M`\r\nHEAD: 59f58aa70f90826c660c29ae6c8822c05aa9f8ca\r\nHere is the difference between Process committed memory and VM native memory committed: \r\n\r\n(don't pay too much attention to those spikes. These are just two metrics measurement time shifts)\r\n\r\n![Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ](https://user-images.githubusercontent.com/8173857/88277179-f437d480-cce8-11ea-8fb6-eb14603d5067.png)\r\n\r\n\r\nLooks like leaking ~750Kb/hour",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/662365336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/663416435",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-663416435",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 663416435,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MzQxNjQzNQ==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-24T08:46:44Z",
    "updated_at": "2020-07-24T08:46:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Limiting RocksDB open files seems to be having a very good effect on my system.\r\n\r\n![Annotation 2020-07-24 061804](https://user-images.githubusercontent.com/20796281/88374416-a2975480-cd91-11ea-9dac-fc9e0e6707e6.png)\r\n\r\nThe chart covers 6 days of total process memory. The left hand side is the previous behaviour: observe the inexorable upwards slope everywhere. For the last 2 days I constrained RocksDB open files (I set 100, but I already had ~253. It has not reduced the FDs, but has also not increased them as it did previously). Note that the upwards sloping trend is now almost flat.\r\n\r\nThe memory profile now looks like a smoothed version of the heap usage plus a constant about 1.5GB. I have `Xmx2g`, which could be reduced, and I don't think I have the latest reduction in ByteBuffer usage applied, so there's definitely scope to reduce RSS more. I'm just happy that it has stopped growing unboundedly, which is the main thing.\r\n\r\nCaveats: needs another day or so to be sure. I'm keen then to do a resync so that I can see if the open files can really be kept within our new limits. YMMV - we may have different memory issues on different systems. I don't know what bad effect this may have, if any, on RocksDB performance.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/663416435/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/665235722",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-665235722",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 665235722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTIzNTcyMg==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-28T19:35:18Z",
    "updated_at": "2020-07-28T19:35:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seems to be under control for now. Closing.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/665235722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/665665085",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-665665085",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 665665085,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTY2NTA4NQ==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-29T13:29:35Z",
    "updated_at": "2020-07-29T13:33:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is the pure native memory consuption (`process committed - jvm committed`) for 5 days (version: 05cea37ad80fa0210e5a3f6b1d7ae2134af41ee7): \r\n![Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ](https://user-images.githubusercontent.com/8173857/88806298-e8508480-d1b8-11ea-8ff7-2f80ed0a37a1.png)\r\n\r\nLooks pretty stable but extra 1.3G for unknown purposes looks slightly excessive ðŸ¤” \r\n\r\nJust 21 `SST` files are opened, and totally 41 handle to the data dir",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/665665085/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/697851346",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-697851346",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 697851346,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5Nzg1MTM0Ng==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-23T18:32:55Z",
    "updated_at": "2020-09-23T18:32:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is the fresh data from attack-net Teku nodes with validators: \r\n![Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ](https://user-images.githubusercontent.com/8173857/94054314-2d252000-fde4-11ea-9200-9a84602c6f7b.png)\r\n\r\nWith 2Gb heap allocated the process committed memory approaching to 3.5Gb and keeps growing. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/697851346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/698205695",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-698205695",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 698205695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODIwNTY5NQ==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-24T08:42:26Z",
    "updated_at": "2020-09-24T08:42:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "![Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ](https://user-images.githubusercontent.com/8173857/94122236-fb02d500-fe5a-11ea-9884-0567ae633e20.png)\r\nOne node down. Didn't find any anomalies on all other node metrics besides this one. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/698205695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705276681",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-705276681",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 705276681,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTI3NjY4MQ==",
    "user": {
      "login": "kcharbo3",
      "id": 30647178,
      "node_id": "MDQ6VXNlcjMwNjQ3MTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/30647178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kcharbo3",
      "html_url": "https://github.com/kcharbo3",
      "followers_url": "https://api.github.com/users/kcharbo3/followers",
      "following_url": "https://api.github.com/users/kcharbo3/following{/other_user}",
      "gists_url": "https://api.github.com/users/kcharbo3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kcharbo3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kcharbo3/subscriptions",
      "organizations_url": "https://api.github.com/users/kcharbo3/orgs",
      "repos_url": "https://api.github.com/users/kcharbo3/repos",
      "events_url": "https://api.github.com/users/kcharbo3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kcharbo3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T01:24:29Z",
    "updated_at": "2020-10-08T01:24:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm new here, but thought I might take a stab at this issue. I see that it was opened and closed, so I'm uncertain how much this issue has changed from when it was first opened. A couple of quick questions: Are the steps to reproduce the native memory leak the same? (Run Teku node with -Xmx1G on Onyx (or other) testnet for about 2-3 hours)  Is RocksDB still the main suspect? ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705276681/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705278326",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-705278326",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 705278326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTI3ODMyNg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T01:31:38Z",
    "updated_at": "2020-10-08T01:31:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "@kcharbo3 Lots and lots of unknowns about what's going on but very similar situation.  We're seeing issues when running Teku in a docker container with 4Gb of RAM and -Xmx2G.  Medalla is a bigger network so will need more than 1G but should run comfortably with -Xmx2g but seems to struggle at some points (but not always).  At the same time, we're seeing total process resident memory gradually increase to the point where with a 4g system memory limit the system out of memory killer kills Teku.\r\n\r\nSo there's two issues - one with on-heap memory being higher than we'd like at times, the second with native memory usage growing.  RocksDB is the key suspect for the native memory usage growth but we're definitely open to any theories.  \r\n\r\n@Nashatyrev can probably provide more detail but he's in Russian timezones so won't be awake for a while yet.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705278326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705758146",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-705758146",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 705758146,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTc1ODE0Ng==",
    "user": {
      "login": "kcharbo3",
      "id": 30647178,
      "node_id": "MDQ6VXNlcjMwNjQ3MTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/30647178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kcharbo3",
      "html_url": "https://github.com/kcharbo3",
      "followers_url": "https://api.github.com/users/kcharbo3/followers",
      "following_url": "https://api.github.com/users/kcharbo3/following{/other_user}",
      "gists_url": "https://api.github.com/users/kcharbo3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kcharbo3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kcharbo3/subscriptions",
      "organizations_url": "https://api.github.com/users/kcharbo3/orgs",
      "repos_url": "https://api.github.com/users/kcharbo3/repos",
      "events_url": "https://api.github.com/users/kcharbo3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kcharbo3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T18:51:58Z",
    "updated_at": "2020-10-08T18:51:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Makes sense, thanks for the explanation. I'll update if I find anything!",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705758146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705767116",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-705767116",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 705767116,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTc2NzExNg==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T19:10:47Z",
    "updated_at": "2020-10-08T19:10:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @kcharbo3 ! I'm working on this at the moment. Unfortunately no new findings yet :/ ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705767116/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705927160",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-705927160",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 705927160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTkyNzE2MA==",
    "user": {
      "login": "kcharbo3",
      "id": 30647178,
      "node_id": "MDQ6VXNlcjMwNjQ3MTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/30647178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kcharbo3",
      "html_url": "https://github.com/kcharbo3",
      "followers_url": "https://api.github.com/users/kcharbo3/followers",
      "following_url": "https://api.github.com/users/kcharbo3/following{/other_user}",
      "gists_url": "https://api.github.com/users/kcharbo3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kcharbo3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kcharbo3/subscriptions",
      "organizations_url": "https://api.github.com/users/kcharbo3/orgs",
      "repos_url": "https://api.github.com/users/kcharbo3/repos",
      "events_url": "https://api.github.com/users/kcharbo3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kcharbo3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T02:17:48Z",
    "updated_at": "2020-10-09T02:17:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ahh okay thanks for the update, I'll reach out to you if I find anything that I think can help!",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705927160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/775099792",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-775099792",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 775099792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTA5OTc5Mg==",
    "user": {
      "login": "tzapu",
      "id": 2983312,
      "node_id": "MDQ6VXNlcjI5ODMzMTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2983312?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tzapu",
      "html_url": "https://github.com/tzapu",
      "followers_url": "https://api.github.com/users/tzapu/followers",
      "following_url": "https://api.github.com/users/tzapu/following{/other_user}",
      "gists_url": "https://api.github.com/users/tzapu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tzapu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tzapu/subscriptions",
      "organizations_url": "https://api.github.com/users/tzapu/orgs",
      "repos_url": "https://api.github.com/users/tzapu/repos",
      "events_url": "https://api.github.com/users/tzapu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tzapu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T12:08:09Z",
    "updated_at": "2021-02-08T12:08:29Z",
    "author_association": "NONE",
    "body": "we re seeing a slow but steady memory increase on mainnet to the point where teku gets killed, so it s reaching 11-12gb+, graph is of `container_memory_working_set_bytes`\r\nspecial flags we used are \r\n```\r\n        env:\r\n          - name: JAVA_OPTS\r\n            value: -Xmx4g -XX:-HeapDumpOnOutOfMemoryError\r\n```\r\n![image](https://user-images.githubusercontent.com/2983312/107217188-7fbf4b80-6a16-11eb-91d6-98e49bbd53b8.png)\r\n\r\nis there anything we can do/set to stop the slow leak? how can we limit the max mem it uses so it doesn't grow large enough to get killed?\r\nwhat other data can i provide?\r\nthank you very much, love teku :D",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/775099792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/775103227",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-775103227",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 775103227,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTEwMzIyNw==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T12:14:30Z",
    "updated_at": "2021-02-08T12:14:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "@tzapu This is most like related to https://github.com/ConsenSys/teku/issues/3495 - (excessive memory consumption by RocksDB). We are actively looking at alternative DBs at the moment, and will hopefully have news soon. It would definitely be good to resolve this!",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/775103227/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/829168305",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-829168305",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 829168305,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyOTE2ODMwNQ==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-29T11:56:22Z",
    "updated_at": "2021-04-29T11:56:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note that, on Linux, setting the environment variable `MALLOC_ARENA_MAX=1` has a good effect for me. It reduces process memory growth on my own node from about 300MB/day to about 100MB/day over the long term. I've been testing this for a couple of months, and all seems fine. There is no detectable affect on performance/CPU usage. This is with RocksDB.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/829168305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/850740622",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-850740622",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 850740622,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MDc0MDYyMg==",
    "user": {
      "login": "hoangong",
      "id": 5703525,
      "node_id": "MDQ6VXNlcjU3MDM1MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5703525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hoangong",
      "html_url": "https://github.com/hoangong",
      "followers_url": "https://api.github.com/users/hoangong/followers",
      "following_url": "https://api.github.com/users/hoangong/following{/other_user}",
      "gists_url": "https://api.github.com/users/hoangong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hoangong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hoangong/subscriptions",
      "organizations_url": "https://api.github.com/users/hoangong/orgs",
      "repos_url": "https://api.github.com/users/hoangong/repos",
      "events_url": "https://api.github.com/users/hoangong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hoangong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-29T01:00:34Z",
    "updated_at": "2021-05-29T01:00:34Z",
    "author_association": "NONE",
    "body": "Hi, I see that the PR to fix this issue (using levelDB) has been merged. But I still have the same issue. memory usage is very high  after about 1hr running (more than 20G). I'm using version 21.5.0. This is the command I used:\r\n```\r\nJAVA_OPTS=\"-Xmx3G\" bin/./teku \\\r\n  --eth1-endpoints=\"$ETH1_NODE,$ETH1_BACKUP\" \\\r\n  --data-path=$ETH2_DATA/teku\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/850740622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/850768014",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-850768014",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 850768014,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MDc2ODAxNA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-29T04:35:41Z",
    "updated_at": "2021-05-29T04:35:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "@1mdc Are you using an existing database or creating a new one? The change to leveldb so far is only for newly created database - existing databases will continue to use RocksDB.\r\n\r\n20Gb is way more than I've ever seen even with RocksDB though.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/850768014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/856782330",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-856782330",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 856782330,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Njc4MjMzMA==",
    "user": {
      "login": "hoangong",
      "id": 5703525,
      "node_id": "MDQ6VXNlcjU3MDM1MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5703525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hoangong",
      "html_url": "https://github.com/hoangong",
      "followers_url": "https://api.github.com/users/hoangong/followers",
      "following_url": "https://api.github.com/users/hoangong/following{/other_user}",
      "gists_url": "https://api.github.com/users/hoangong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hoangong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hoangong/subscriptions",
      "organizations_url": "https://api.github.com/users/hoangong/orgs",
      "repos_url": "https://api.github.com/users/hoangong/repos",
      "events_url": "https://api.github.com/users/hoangong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hoangong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T13:46:11Z",
    "updated_at": "2021-06-08T13:56:25Z",
    "author_association": "NONE",
    "body": "@ajsutton I have same problem with both old DB and completely new database (i.e. pointing data path to a new location)\r\n\r\nI tried to debug in JDK Mission Control. I find that recorded memory is quite low in this profiler (1-3Gb), i'm not sure where it the rest comes from. may be some another sub-process? \r\n\r\nThese are screenshots actual memory usage from activity monitor (it shows 5Gb but it keep growing to 20Gb or 30Gb) and from JDK Mission Control:\r\n<img width=\"828\" alt=\"Screenshot 2021-06-08 at 14 53 53\" src=\"https://user-images.githubusercontent.com/5703525/121197829-8c8b6900-c869-11eb-8738-a2e7edb01133.png\">\r\n\r\n<img width=\"1007\" alt=\"Screenshot 2021-06-08 at 14 54 19\" src=\"https://user-images.githubusercontent.com/5703525/121197818-88f7e200-c869-11eb-91b5-dd7481424614.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/856782330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857287852",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-857287852",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 857287852,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NzI4Nzg1Mg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T00:46:56Z",
    "updated_at": "2021-06-09T00:46:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I tried to debug in JDK Mission Control. I find that recorded memory is quite low in this profiler (1-3Gb), i'm not sure where it the rest comes from. may be some another sub-process?\r\n\r\nJDK Mission Control only looks at the on-heap memory that's actually used.  Activity monitor will report the amount of heap that's allocated (whether it's currently used or not) plus native memory use.  I'm not entirely sure what MacOS reports in that memory column - if it includes memory mapped files then it will grow to be very large but that doesn't necessarily mean that memory isn't available to other processes if needed.\r\n\r\nHow much memory does your system have available? Are you seeing any actual problems like slow performance etc?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857287852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857665194",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-857665194",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 857665194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NzY2NTE5NA==",
    "user": {
      "login": "hoangong",
      "id": 5703525,
      "node_id": "MDQ6VXNlcjU3MDM1MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5703525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hoangong",
      "html_url": "https://github.com/hoangong",
      "followers_url": "https://api.github.com/users/hoangong/followers",
      "following_url": "https://api.github.com/users/hoangong/following{/other_user}",
      "gists_url": "https://api.github.com/users/hoangong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hoangong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hoangong/subscriptions",
      "organizations_url": "https://api.github.com/users/hoangong/orgs",
      "repos_url": "https://api.github.com/users/hoangong/repos",
      "events_url": "https://api.github.com/users/hoangong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hoangong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T12:48:26Z",
    "updated_at": "2021-06-09T12:48:26Z",
    "author_association": "NONE",
    "body": "My system has 40Gb memory. I can notice the system be slow down when teku takes > 20Gb (e.g. switching between chrome tab very slow)",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857665194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/858175477",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-858175477",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 858175477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1ODE3NTQ3Nw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T23:53:52Z",
    "updated_at": "2021-06-09T23:53:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "> My system has 40Gb memory. I can notice the system be slow down when teku takes > 20Gb (e.g. switching between chrome tab very slow)\r\n\r\nSo probably the next thing to check is that Teku is actually using leveldb rather than RocksDB.  If you look in the director you're using for `--data-path` there will be a `beacon/db.version` file.  If it's using leveldb it should contain `leveldb2`. If it's just a number like `5` then it's still using RocksDB.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/858175477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/858499460",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-858499460",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 858499460,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1ODQ5OTQ2MA==",
    "user": {
      "login": "hoangong",
      "id": 5703525,
      "node_id": "MDQ6VXNlcjU3MDM1MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5703525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hoangong",
      "html_url": "https://github.com/hoangong",
      "followers_url": "https://api.github.com/users/hoangong/followers",
      "following_url": "https://api.github.com/users/hoangong/following{/other_user}",
      "gists_url": "https://api.github.com/users/hoangong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hoangong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hoangong/subscriptions",
      "organizations_url": "https://api.github.com/users/hoangong/orgs",
      "repos_url": "https://api.github.com/users/hoangong/repos",
      "events_url": "https://api.github.com/users/hoangong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hoangong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-10T10:16:10Z",
    "updated_at": "2021-06-10T10:16:10Z",
    "author_association": "NONE",
    "body": "it is `leveldb2` in db.version file.\r\n\r\nThis screenshot shows that the app took 31Gb after about 30 minutes running and my machine is slowing down. \r\n\r\n<img width=\"853\" alt=\"Screenshot 2021-06-10 at 11 12 26\" src=\"https://user-images.githubusercontent.com/5703525/121508046-1c9def80-c9dd-11eb-80e6-bc7336af26b0.png\">\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/858499460/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/861917934",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-861917934",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 861917934,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MTkxNzkzNA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-16T00:21:08Z",
    "updated_at": "2021-06-16T00:21:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "@1mdc This may be easier to work through on discord rather than this issue: https://discord.gg/7hPv2T6 in the #teku channel.\r\n\r\nBut I think the next thing to check is the metrics around memory to see what's actually being used.  Prometheus and grafana are the ideal and the memory graph in https://grafana.com/grafana/dashboards/13457 gives a very good overview.  If you don't have those setup though, you could run Teku with `--metrics-enabled`, give it time for the memory usage to become an issue and then run `curl http://localhost:8008/metrics | grep memory` to get a single snapshot of the memory metrics. Mac OS X doesn't provide some of the metrics around native memory usage I'd really like but we can at least confirm what the JVM itself is actually using.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/861917934/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/866988447",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-866988447",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 866988447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2Njk4ODQ0Nw==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-23T16:31:44Z",
    "updated_at": "2021-06-23T16:31:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Another thing I would try is the newer leveldb version. \r\nThe version Teku is using is pretty old. Bintray had been shut down, so I'm attaching the artifact I have here. It's not the latest leveldb version though. \r\n [leveldbjni-all-1.18.3.zip](https://github.com/ConsenSys/teku/files/6703505/leveldbjni-all-1.18.3.zip)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/866988447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/866989940",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-866989940",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 866989940,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2Njk4OTk0MA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-23T16:33:52Z",
    "updated_at": "2021-06-23T16:33:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Not sure if it's binary compatible with `1.8` so probably you would need to delete the old db dir and sync from scratch",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/866989940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/877791428",
    "html_url": "https://github.com/ConsenSys/teku/issues/2303#issuecomment-877791428",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2303",
    "id": 877791428,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3Nzc5MTQyOA==",
    "user": {
      "login": "hoangong",
      "id": 5703525,
      "node_id": "MDQ6VXNlcjU3MDM1MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5703525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hoangong",
      "html_url": "https://github.com/hoangong",
      "followers_url": "https://api.github.com/users/hoangong/followers",
      "following_url": "https://api.github.com/users/hoangong/following{/other_user}",
      "gists_url": "https://api.github.com/users/hoangong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hoangong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hoangong/subscriptions",
      "organizations_url": "https://api.github.com/users/hoangong/orgs",
      "repos_url": "https://api.github.com/users/hoangong/repos",
      "events_url": "https://api.github.com/users/hoangong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hoangong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-11T12:29:15Z",
    "updated_at": "2021-07-11T12:29:15Z",
    "author_association": "NONE",
    "body": "I have not really found the root cause but I finally fixed it by switching to a different JVM implementation. From openj9 to hotspot. Explicitly, it is from `AdoptOpenJDK 11.0.11.j9-adpt` to `AdoptOpenJDK 11.0.11.hs-adpt`",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/877791428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
