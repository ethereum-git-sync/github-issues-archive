{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3028",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3028/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3028/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3028/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3028",
  "id": 725286214,
  "node_id": "MDU6SXNzdWU3MjUyODYyMTQ=",
  "number": 3028,
  "title": "Sync Stalling",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-10-20T07:23:58Z",
  "updated_at": "2020-10-20T18:26:35Z",
  "closed_at": "2020-10-20T18:26:35Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\nThree times in a row since updating this afternoon my Medalla sync has stalled.  At INFO level there's no sign of anything going wrong, it just stops progressing after an hour or two.  Still has peers, but seems to have stopped requesting new blocks entirely.  I tried again with debug level enabled for the `tech.pegasys.teku.sync` package and got the exception below:\n\n```\n slot 435936 by replaying 20 blocks. Took 2252ms\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:36:48,547\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552483, Head slot: 435980, Connected peers: 74\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:36:56,389\",\"level\":\"DEBUG\",\"thread\":\"forkchoice-0\",\"class\":\"PeerSync\",\"message\":\"Request 200 blocks starting at 436012 from peer 16Uiu2HAkyjDgW6orCnb1RLkm21Voho617U8ay89tZGzUQcx8fbjL\",\"throwable\n\":\"\"}\n{\"timestamp\":\"2020-10-20T06:36:56,806\",\"level\":\"WARN\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"DefaultChannelPipeline\",\"message\":\"An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usuall\ny means the last handler in the pipeline did not handle the exception.\",\"throwable\":\" io.netty.channel.ChannelPipelineException: tech.pegasys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.handlerRemoved() has thrown\n an exception.\\n\\tat io.netty.channel.DefaultChannelPipeline.callHandlerRemoved0(DefaultChannelPipeline.java:640)\\n\\tat io.netty.channel.DefaultChannelPipeline.destroyDown(DefaultChannelPipeline.java:876)\\n\\tat io.netty.ch\nannel.DefaultChannelPipeline.destroyUp(DefaultChannelPipeline.java:844)\\n\\tat io.netty.channel.DefaultChannelPipeline.destroy(DefaultChannelPipeline.java:836)\\n\\tat io.netty.channel.DefaultChannelPipeline.access$700(Defaul\ntChannelPipeline.java:46)\\n\\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelUnregistered(DefaultChannelPipeline.java:1392)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelUnregistered(Abstr\nactChannelHandlerContext.java:198)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelUnregistered(AbstractChannelHandlerContext.java:184)\\n\\tat io.netty.channel.DefaultChannelPipeline.fireChannelUnregistere\nd(DefaultChannelPipeline.java:821)\\n\\tat io.netty.channel.AbstractChannel$AbstractUnsafe$8.run(AbstractChannel.java:826)\\n\\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)\\n\\ta\nt io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)\\n\\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:497)\\n\\tat io.netty.util.concurrent.SingleThreadEventExecut\nor$4.run(SingleThreadEventExecutor.java:989)\\n\\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat\n java.base/java.lang.Thread.run(Thread.java:832)\\nCaused by: java.lang.IllegalStateException: Trying to reuse disposable LengthPrefixedPayloadDecoder\\n\\tat tech.pegasys.teku.networking.eth2.rpc.core.encodings.LengthPrefixe\ndPayloadDecoder.complete(LengthPrefixedPayloadDecoder.java:108)\\n\\tat tech.pegasys.teku.networking.eth2.rpc.core.RpcResponseDecoder.complete(RpcResponseDecoder.java:115)\\n\\tat tech.pegasys.teku.networking.eth2.rpc.core.Rpc\nResponseDecoder.close(RpcResponseDecoder.java:105)\\n\\tat tech.pegasys.teku.networking.eth2.rpc.core.Eth2OutgoingRequestHandler.abortRequest(Eth2OutgoingRequestHandler.java:222)\\n\\tat tech.pegasys.teku.networking.eth2.rpc.c\nore.Eth2OutgoingRequestHandler.abortRequest(Eth2OutgoingRequestHandler.java:212)\\n\\tat tech.pegasys.teku.networking.eth2.rpc.core.Eth2OutgoingRequestHandler.readComplete(Eth2OutgoingRequestHandler.java:159)\\n\\tat tech.pega\nsys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.onRemoteWriteClosed(RpcHandler.java:191)\\n\\tat tech.pegasys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.onChannelClosed(RpcHandler.java:197)\\n\\tat tech.pega\nsys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.handlerRemoved(RpcHandler.java:178)\\n\\tat io.netty.channel.AbstractChannelHandlerContext.callHandlerRemoved(AbstractChannelHandlerContext.java:946)\\n\\tat io.netty.ch\nannel.DefaultChannelPipeline.callHandlerRemoved0(DefaultChannelPipeline.java:637)\\n\\t... 16 more\\n\"}\n{\"timestamp\":\"2020-10-20T06:36:57,148\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552484, Head slot: 436011, Connected peers: 73\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:37:09,112\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552485, Head slot: 436013, Connected peers: 74\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:37:21,170\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552486, Head slot: 436013, Connected peers: 73\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:37:33,123\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552487, Head slot: 436013, Connected peers: 74\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:37:45,108\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552488, Head slot: 436013, Connected peers: 74\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:37:57,105\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552489, Head slot: 436013, Connected peers: 74\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:38:09,365\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552490, Head slot: 436013, Connected peers: 73\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:38:21,105\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552491, Head slot: 436013, Connected peers: 73\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:38:22,958\",\"level\":\"WARN\",\"thread\":\"p2p-async-0\",\"class\":\"LoggingWeakSubjectivityViolationPolicy\",\"message\":\"The latest finalized checkpoint at epoch 13623 (67417 active validators) fell outside\n of the weak subjectivity period after epoch 14721, which is prior to the current epoch 17265.\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:38:22,958\",\"level\":\"WARN\",\"thread\":\"p2p-async-0\",\"class\":\"teku-status-log\",\"message\":\"The latest finalized checkpoint at epoch 13623 is outside of the weak subjectivity period.  Please supply a\nrecent weak subjectivity checkpoint using --ws-checkpoint=<BLOCK_ROOT>:<EPOCH>.\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:38:33,234\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552492, Head slot: 436013, Connected peers: 72\",\"throwable\":\"\"}\n{\"timestamp\":\"2020-10-20T06:38:45,113\",\"level\":\"INFO\",\"thread\":\"TimeTickChannel-0\",\"class\":\"teku-event-log\",\"message\":\"Sync Event  *** Current slot: 552493, Head slot: 436013, Connected peers: 72\",\"throwable\":\"\"}\n```",
  "closed_by": {
    "login": "Nashatyrev",
    "id": 8173857,
    "node_id": "MDQ6VXNlcjgxNzM4NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Nashatyrev",
    "html_url": "https://github.com/Nashatyrev",
    "followers_url": "https://api.github.com/users/Nashatyrev/followers",
    "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
    "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
    "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
    "repos_url": "https://api.github.com/users/Nashatyrev/repos",
    "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3028/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3028/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/712878342",
    "html_url": "https://github.com/ConsenSys/teku/issues/3028#issuecomment-712878342",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3028",
    "id": 712878342,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjg3ODM0Mg==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-20T14:06:09Z",
    "updated_at": "2020-10-20T14:06:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Formatted trace:\r\n```\r\nAn exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\",\"throwable\":\" io.netty.channel.ChannelPipelineException: tech.pegasys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.handlerRemoved() has thrown an exception.\r\n\tat io.netty.channel.DefaultChannelPipeline.callHandlerRemoved0(DefaultChannelPipeline.java:640)\r\n\tat io.netty.channel.DefaultChannelPipeline.destroyDown(DefaultChannelPipeline.java:876)\r\n\tat io.netty.channel.DefaultChannelPipeline.destroyUp(DefaultChannelPipeline.java:844)\r\n\tat io.netty.channel.DefaultChannelPipeline.destroy(DefaultChannelPipeline.java:836)\r\n\tat io.netty.channel.DefaultChannelPipeline.access$700(DefaultChannelPipeline.java:46)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelUnregistered(DefaultChannelPipeline.java:1392)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelUnregistered(AbstractChannelHandlerContext.java:198)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelUnregistered(AbstractChannelHandlerContext.java:184)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelUnregistered(DefaultChannelPipeline.java:821)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$8.run(AbstractChannel.java:826)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:497)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:832)\r\nCaused by: java.lang.IllegalStateException: Trying to reuse disposable LengthPrefixedPayloadDecoder\r\n\tat tech.pegasys.teku.networking.eth2.rpc.core.encodings.LengthPrefixedPayloadDecoder.complete(LengthPrefixedPayloadDecoder.java:108)\r\n\tat tech.pegasys.teku.networking.eth2.rpc.core.RpcResponseDecoder.complete(RpcResponseDecoder.java:115)\r\n\tat tech.pegasys.teku.networking.eth2.rpc.core.RpcResponseDecoder.close(RpcResponseDecoder.java:105)\r\n\tat tech.pegasys.teku.networking.eth2.rpc.core.Eth2OutgoingRequestHandler.abortRequest(Eth2OutgoingRequestHandler.java:222)\r\n\tat tech.pegasys.teku.networking.eth2.rpc.core.Eth2OutgoingRequestHandler.abortRequest(Eth2OutgoingRequestHandler.java:212)\r\n\tat tech.pegasys.teku.networking.eth2.rpc.core.Eth2OutgoingRequestHandler.readComplete(Eth2OutgoingRequestHandler.java:159)\r\n\tat tech.pegasys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.onRemoteWriteClosed(RpcHandler.java:191)\r\n\tat tech.pegasys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.onChannelClosed(RpcHandler.java:197)\r\n\tat tech.pegasys.teku.networking.p2p.libp2p.rpc.RpcHandler$Controller.handlerRemoved(RpcHandler.java:178)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.callHandlerRemoved(AbstractChannelHandlerContext.java:946)\r\n\tat io.netty.channel.DefaultChannelPipeline.callHandlerRemoved0(DefaultChannelPipeline.java:637)\r\n\t... 16 more\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/712878342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/712957534",
    "html_url": "https://github.com/ConsenSys/teku/issues/3028#issuecomment-712957534",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3028",
    "id": 712957534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjk1NzUzNA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-20T16:01:13Z",
    "updated_at": "2020-10-20T16:01:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ajsutton your guess was 100% correct. See the PR above",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/712957534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
