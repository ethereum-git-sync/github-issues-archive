{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2837",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2837",
  "id": 707338796,
  "node_id": "MDU6SXNzdWU3MDczMzg3OTY=",
  "number": 2837,
  "title": " java.lang.IllegalStateException: Blocking message pending 10000 for BLOCKING     ",
  "user": {
    "login": "tzapu",
    "id": 2983312,
    "node_id": "MDQ6VXNlcjI5ODMzMTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2983312?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tzapu",
    "html_url": "https://github.com/tzapu",
    "followers_url": "https://api.github.com/users/tzapu/followers",
    "following_url": "https://api.github.com/users/tzapu/following{/other_user}",
    "gists_url": "https://api.github.com/users/tzapu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tzapu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tzapu/subscriptions",
    "organizations_url": "https://api.github.com/users/tzapu/orgs",
    "repos_url": "https://api.github.com/users/tzapu/repos",
    "events_url": "https://api.github.com/users/tzapu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tzapu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug üêû",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2172541810,
      "node_id": "MDU6TGFiZWwyMTcyNTQxODEw",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P2",
      "name": "P2",
      "color": "FFA500",
      "default": false,
      "description": "High"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-09-23T12:50:43Z",
  "updated_at": "2020-10-06T03:31:03Z",
  "closed_at": "2020-10-06T03:31:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n### Description\r\nTested the split beacon/validator and got a couple of errors on the beacon side of things\r\n\r\n**Actual behavior:** [What actually happens]\r\n```\r\n 12:41:24.761 INFO  - Slot Event  *** Slot: 359905, Block:    ... empty, Epoch: 11247, Finalized checkpoint: 11245, Finalized root: 3eefe7..475f, Peers: 12                                                                                                                        ‚îÇ\r\n‚îÇ 12:41:24.766 ERROR - PLEASE FIX OR REPORT | Unexpected exception thrown for event 'interface tech.pegasys.teku.util.time.channels.SlotEventsChannel.onSlot' in handler 'tech.pegasys.teku.services.remotevalidator.RemoteValidatorBeaconChainEventsAdapter'                       ‚îÇ\r\n‚îÇ java.lang.IllegalStateException: Blocking message pending 10000 for BLOCKING                                                                                                                                                                                                      ‚îÇ\r\n‚îÇ     at org.eclipse.jetty.websocket.common.WebSocketRemoteEndpoint.lockMsg(WebSocketRemoteEndpoint.java:130) ~[websocket-common-9.4.25.v20191220.jar:9.4.25.v20191220]                                                                                                             ‚îÇ\r\n‚îÇ     at org.eclipse.jetty.websocket.common.WebSocketRemoteEndpoint.sendString(WebSocketRemoteEndpoint.java:376) ~[websocket-common-9.4.25.v20191220.jar:9.4.25.v20191220]                                                                                                          ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.services.remotevalidator.RemoteValidatorApi.lambda$subscribeValidator$2(RemoteValidatorApi.java:86) ~[teku-services-remote-validator-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                            ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.services.remotevalidator.RemoteValidatorSubscriptions.lambda$onEvent$0(RemoteValidatorSubscriptions.java:64) ~[teku-services-remote-validator-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                   ‚îÇ\r\n‚îÇ     at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183) ~[?:?]                                                                                                                                                                                             ‚îÇ\r\n‚îÇ     at java.util.concurrent.ConcurrentHashMap$ValueSpliterator.forEachRemaining(ConcurrentHashMap.java:3612) ~[?:?]                                                                                                                                                               ‚îÇ\r\n‚îÇ     at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484) ~[?:?]                                                                                                                                                                                               ‚îÇ\r\n‚îÇ     at java.util.stream.ForEachOps$ForEachTask.compute(ForEachOps.java:290) ~[?:?]                                                                                                                                                                                                ‚îÇ\r\n‚îÇ     at java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:746) ~[?:?]                                                                                                                                                                                               ‚îÇ\r\n‚îÇ     at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290) ~[?:?]                                                                                                                                                                                                     ‚îÇ\r\n‚îÇ     at java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:408) ~[?:?]                                                                                                                                                                                                   ‚îÇ\r\n‚îÇ     at java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:736) ~[?:?]                                                                                                                                                                                                     ‚îÇ\r\n‚îÇ     at java.util.stream.ForEachOps$ForEachOp.evaluateParallel(ForEachOps.java:159) ~[?:?]                                                                                                                                                                                         ‚îÇ\r\n‚îÇ     at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateParallel(ForEachOps.java:173) ~[?:?]                                                                                                                                                                                   ‚îÇ\r\n‚îÇ     at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:233) ~[?:?]                                                                                                                                                                                               ‚îÇ\r\n‚îÇ     at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497) ~[?:?]                                                                                                                                                                                              ‚îÇ\r\n‚îÇ     at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:661) ~[?:?]                                                                                                                                                                                         ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.services.remotevalidator.RemoteValidatorSubscriptions.onEvent(RemoteValidatorSubscriptions.java:64) ~[teku-services-remote-validator-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                            ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.services.remotevalidator.RemoteValidatorBeaconChainEventsAdapter.onSlot(RemoteValidatorBeaconChainEventsAdapter.java:76) ~[teku-services-remote-validator-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                       ‚îÇ\r\n‚îÇ     at jdk.internal.reflect.GeneratedMethodAccessor9.invoke(Unknown Source) ~[?:?]                                                                                                                                                                                                ‚îÇ\r\n‚îÇ     at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]                                                                                                                                                                      ‚îÇ\r\n‚îÇ     at java.lang.reflect.Method.invoke(Method.java:564) ~[?:?]                                                                                                                                                                                                                    ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.infrastructure.events.DirectEventDeliverer.executeMethod(DirectEventDeliverer.java:74) ~[teku-infrastructure-events-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                                             ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.infrastructure.events.DirectEventDeliverer.deliverTo(DirectEventDeliverer.java:54) ~[teku-infrastructure-events-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                                                 ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.infrastructure.events.AsyncEventDeliverer.lambda$deliverTo$0(AsyncEventDeliverer.java:61) ~[teku-infrastructure-events-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                                          ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.infrastructure.events.AsyncEventDeliverer$QueueReader.deliverNextEvent(AsyncEventDeliverer.java:117) [teku-infrastructure-events-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                                ‚îÇ\r\n‚îÇ     at tech.pegasys.teku.infrastructure.events.AsyncEventDeliverer$QueueReader.run(AsyncEventDeliverer.java:109) [teku-infrastructure-events-0.12.7-SNAPSHOT.jar:0.12.7-dev-8cf430e1]                                                                                             ‚îÇ\r\n‚îÇ     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]                                                                                                                                                                                      ‚îÇ\r\n‚îÇ     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]                                                                                                                                                                                      ‚îÇ\r\n‚îÇ     at java.lang.Thread.run(Thread.java:832) [?:?]                                                                                                                                                                                                                                ‚îÇ\r\n‚îÇ 12:41:25.153 INFO  - Chain reorg from 0a686b..7143 (359905) to 1b0c74..4f45 (359905). Common ancestor at slot 359904                                                                                                                                                              ‚îÇ\r\n‚îÇ 12:41:30.209 INFO  - Slot Event  *** Slot: 359906, Block:    ... empty, Epoch: 11247, Finalized checkpoint: 11245, Finalized root: 3eefe7..475f, Peers: 19                                                                                                                        ‚îÇ\r\n‚îÇ 12:41:37.460 INFO  - Slot Event  *** Slot: 359907, Block: 80ddc8..ae4d, Epoch: 11247, Finalized checkpoint: 11245, Finalized root: 3eefe7..475f, Peers: 19 \r\n```\r\n\r\n**Frequency:** a couple of times after startup\r\n\r\n### Versions (Add all that apply)\r\n* Software version: teku/v0.12.7-dev-8cf430e1/linux-x86_64/oracle_openjdk-java-14\r\n* Cloud VM, type, size: eks \r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2837/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/697523837",
    "html_url": "https://github.com/ConsenSys/teku/issues/2837#issuecomment-697523837",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837",
    "id": 697523837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NzUyMzgzNw==",
    "user": {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-23T15:16:03Z",
    "updated_at": "2020-09-23T15:16:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting @tzapu. We'll look into this and get back to you as soon as possible.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/697523837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/698672762",
    "html_url": "https://github.com/ConsenSys/teku/issues/2837#issuecomment-698672762",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837",
    "id": 698672762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODY3Mjc2Mg==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-25T01:37:37Z",
    "updated_at": "2020-09-25T01:38:11Z",
    "author_association": "MEMBER",
    "body": "Seems related to this https://github.com/tipsy/javalin/issues/423. I heven't fully investigated it though. We are using Javalin for the WebSocket server (and Javalin users Jetty underneath).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/698672762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/698673989",
    "html_url": "https://github.com/ConsenSys/teku/issues/2837#issuecomment-698673989",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2837",
    "id": 698673989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5ODY3Mzk4OQ==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-25T01:42:50Z",
    "updated_at": "2020-09-25T01:42:50Z",
    "author_association": "MEMBER",
    "body": "From my superficial analysis this seems to be somehow related to the way that `RemoteEndpoint#sendString()` is synchronous, and things endup queueing up if there are many concurrent sends. This is being used in the `RemoteValidatorApi` class.\r\n\r\nOne possible solution could be changing it to use `RemoveEndpoint##sendStringByFuture()`, which is more like a \"send-and-forget\" approach.\r\n\r\nI believe for our use case it might make sense to use this send and forget approach. But I'm not 100% sure.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/698673989/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
