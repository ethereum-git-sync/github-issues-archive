{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/7269",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/7269/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/7269/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/7269/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/7269",
  "id": 1761919930,
  "node_id": "I_kwDOCM9I9M5pBMO6",
  "number": 7269,
  "title": "Failure to start during upgrade 23.5.0 -> 23.6.0",
  "user": {
    "login": "NoahStahl",
    "id": 7528994,
    "node_id": "MDQ6VXNlcjc1Mjg5OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7528994?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/NoahStahl",
    "html_url": "https://github.com/NoahStahl",
    "followers_url": "https://api.github.com/users/NoahStahl/followers",
    "following_url": "https://api.github.com/users/NoahStahl/following{/other_user}",
    "gists_url": "https://api.github.com/users/NoahStahl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/NoahStahl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/NoahStahl/subscriptions",
    "organizations_url": "https://api.github.com/users/NoahStahl/orgs",
    "repos_url": "https://api.github.com/users/NoahStahl/repos",
    "events_url": "https://api.github.com/users/NoahStahl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/NoahStahl/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-06-17T16:46:10Z",
  "updated_at": "2023-06-19T00:18:29Z",
  "closed_at": "2023-06-19T00:18:29Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "After swapping in the latest `23.6.0` from previous `23.5.0` and starting Teku, encountered the exception below with a failure to start.\r\n\r\nI was able to work around by:\r\n\r\n1. Starting `23.5.0` again\r\n2. Stopping\r\n3. Switching back to `23.6.0`, starting\r\n\r\nIt seems to have been transient in my setup, all is working now. Just thought I'd file in case it repros for others or it sparks something to look into. Feel free to close if not actionable.\r\n\r\n```\r\n2023-06-17 10:59:41.166-05:00 | beaconchain-async-0 | INFO  | teku-status-log | Initializing storage\r\n2023-06-17 10:59:41.791-05:00 | validator-async-0 | INFO  | teku-status-log | Loaded 1 Validators: xxxxxxx\r\n2023-06-17 10:59:41.791-05:00 | validator-async-0 | INFO  | ValidatorClientService | validator-api-enabled is false, not starting rest api.\r\n2023-06-17 10:59:44.494-05:00 | beaconchain-async-1 | FATAL | teku-status-log | Failed to initialize storage. Check the existing database matches the current network configuration. Set log level to debug for more information.\r\n2023-06-17 10:59:44.510-05:00 | main | FATAL | BeaconNodeCommand | Teku failed to start\r\njava.util.concurrent.CompletionException: java.lang.RuntimeException: org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: D:\\teku\\data\\beacon\\db\\6330508.sst: Could not create random access file.\r\nat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:332) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:347) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:636) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:146) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:626) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:33) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:143) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$exceptionallyCompose$34(SafeFuture.java:426) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:146) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateToAsync$22(SafeFuture.java:329) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:82) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.AsyncRunner.lambda$runAsync$2(AsyncRunner.java:47) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:74) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:124) ~[teku-infrastructure-async-23.6.0.jar:23.6.0]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\nat java.lang.Thread.run(Thread.java:833) ~[?:?]\r\nCaused by: java.lang.RuntimeException: org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: D:\\teku\\data\\beacon\\db\\6330508.sst: Could not create random access file.\r\nat org.fusesource.leveldbjni.internal.JniDBIterator.next(JniDBIterator.java:102) ~[leveldbjni-1.8.jar:1.8]\r\nat org.fusesource.leveldbjni.internal.JniDBIterator.next(JniDBIterator.java:45) ~[leveldbjni-1.8.jar:1.8]\r\nat tech.pegasys.teku.storage.server.leveldb.LevelDbIterator.next(LevelDbIterator.java:64) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.leveldb.LevelDbIterator.next(LevelDbIterator.java:29) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat java.util.Iterator.forEachRemaining(Iterator.java:133) ~[?:?]\r\nat java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1845) ~[?:?]\r\nat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509) ~[?:?]\r\nat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499) ~[?:?]\r\nat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150) ~[?:?]\r\nat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173) ~[?:?]\r\nat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[?:?]\r\nat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596) ~[?:?]\r\nat tech.pegasys.teku.storage.server.kvstore.KvStoreDatabase.buildHotBlockMetadata(KvStoreDatabase.java:266) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.kvstore.KvStoreDatabase.createMemoryStore(KvStoreDatabase.java:639) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.kvstore.KvStoreDatabase.createMemoryStore(KvStoreDatabase.java:619) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.ChainStorage.getStore(ChainStorage.java:74) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.ChainStorage.onStoreRequest(ChainStorage.java:90) ~[teku-storage-23.6.0.jar:23.6.0]\r\n... 5 more\r\nCaused by: org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: D:\\teku\\data\\beacon\\db\\6330508.sst: Could not create random access file.\r\nat org.fusesource.leveldbjni.internal.NativeDB.checkStatus(NativeDB.java:200) ~[leveldbjni-1.8.jar:1.8]\r\nat org.fusesource.leveldbjni.internal.NativeIterator.checkStatus(NativeIterator.java:121) ~[leveldbjni-1.8.jar:1.8]\r\nat org.fusesource.leveldbjni.internal.NativeIterator.next(NativeIterator.java:157) ~[leveldbjni-1.8.jar:1.8]\r\nat org.fusesource.leveldbjni.internal.JniDBIterator.next(JniDBIterator.java:100) ~[leveldbjni-1.8.jar:1.8]\r\nat org.fusesource.leveldbjni.internal.JniDBIterator.next(JniDBIterator.java:45) ~[leveldbjni-1.8.jar:1.8]\r\nat tech.pegasys.teku.storage.server.leveldb.LevelDbIterator.next(LevelDbIterator.java:64) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.leveldb.LevelDbIterator.next(LevelDbIterator.java:29) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat java.util.Iterator.forEachRemaining(Iterator.java:133) ~[?:?]\r\nat java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1845) ~[?:?]\r\nat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509) ~[?:?]\r\nat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499) ~[?:?]\r\nat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150) ~[?:?]\r\nat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173) ~[?:?]\r\nat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[?:?]\r\nat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596) ~[?:?]\r\nat tech.pegasys.teku.storage.server.kvstore.KvStoreDatabase.buildHotBlockMetadata(KvStoreDatabase.java:266) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.kvstore.KvStoreDatabase.createMemoryStore(KvStoreDatabase.java:639) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.kvstore.KvStoreDatabase.createMemoryStore(KvStoreDatabase.java:619) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.ChainStorage.getStore(ChainStorage.java:74) ~[teku-storage-23.6.0.jar:23.6.0]\r\nat tech.pegasys.teku.storage.server.ChainStorage.onStoreRequest(ChainStorage.java:90) ~[teku-storage-23.6.0.jar:23.6.0]\r\n... 5 more\r\n```\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\n(Only occurred once)\r\n1. Stop `23.5.0` process\r\n2. Start `23.6.0` process\r\n3. Observe failure to start with above exception in logs\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `23.5.0` -> `23.6.0`\r\n* Java version: 17.0.2\r\n* OS Name & Version: Windows 10",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/7269/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/7269/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1596320533",
    "html_url": "https://github.com/ConsenSys/teku/issues/7269#issuecomment-1596320533",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/7269",
    "id": 1596320533,
    "node_id": "IC_kwDOCM9I9M5fJesV",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-19T00:18:27Z",
    "updated_at": "2023-06-19T00:18:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "This sounds suspiciously like something wasn't fully shutdown on the first attempt, but the error from leveldb isn't super helpful.\nGlad it was resolved, will close this for now but if you see it again we'll have a go at reproducing... I've upgraded a fair few nodes and not seen this so it's a bit of a mystery but the stack trace could be helpful if there's more instances.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1596320533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
