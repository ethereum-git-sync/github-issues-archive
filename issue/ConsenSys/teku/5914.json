{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5914",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5914/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5914/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5914/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5914",
  "id": 1300951857,
  "node_id": "I_kwDOCM9I9M5NivMx",
  "number": 5914,
  "title": "Update execution payload re-execution strategy",
  "user": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-07-11T16:32:32Z",
  "updated_at": "2022-07-20T01:14:01Z",
  "closed_at": "2022-07-20T01:14:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "We currently have two PRs (#5840 and #5868) insisting on the same `ReexecutingExecutionPayloadBlockManager` class which handles the logic to re-execute a payload when it fails due to low level\\networking exceptions, with the aim of being more resilient to short term outages.\r\n\r\n## Current behaviour\r\nWe re-execute failing blocks every 2 seconds. We expire the re-executing when block's slot become more than 2 slot older than the current slot. It means it will re-executend for current slot and for the next 2 slots.\r\n\r\n**Summary: blocks that arrives in time will be re-executed every 2s for 36s**\r\n\r\nExisting bug: There is an unintended behaviour in which we are queuing for re-execution an already expired block (so it may be executed if the pruning happening `onSlot` doesn't kick-in before the 2s tick). This may happen if we hit a timeout on EL, when we may end up by re-executing it several time.\r\n\r\n## Intents of the current PRs\r\n\r\n#5840 wants to solve a stall problem (#5824, syncing doesn't kick-in quickly enough) by continue re-executing a block every time a descendant of that block is received. The goal is to extend the time window in which we re-execute it to be able to recover without start syncing.\r\n\r\n#5868 wants to avoid too many re-execution by reducing slot expiry from 2 to 1 (24s likely re-execution time, 12s guaranteed)\r\nThe idea is fail fast and relay on sync process to kick-in for recovery. It also solves the bug mentioned above.\r\n\r\n## How to proceed\r\n\r\nSolve the mentioned bug in a dedicated pr:\r\n- [x] #5915\r\n\r\nWe should then discuss here what are the general re-execution\\retry behaviour we want to have on:\r\n\r\nBlockImport via Gossip (currently implemented in `ReexecutingExecutionPayloadBlockManager` wrapping `BlockManager`)\r\nBlockImport via BatchSync (nothing implemented yet)\r\n\r\nThen we could implement a re-execution system managing both cases, or split them in two classes if the logic differs too much.\r\n\r\nOptionally:\r\nImprove the way we engage syncing by being more reactive (if actually needed)\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5914/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5914/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1189698390",
    "html_url": "https://github.com/ConsenSys/teku/issues/5914#issuecomment-1189698390",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5914",
    "id": 1189698390,
    "node_id": "IC_kwDOCM9I9M5G6VtW",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-20T01:14:01Z",
    "updated_at": "2022-07-20T01:14:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to call this done for now.  Batch sync will automatically retry already and is only syncing a single chain so unlikely to swamp the EL.  Gossip is now handled simply but sensibly and shouldn't cause issues for the EL, while the new approach has fixed problems seen in hive tests and shown that Teku doesn't retry correctly and then carry on following the chain.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1189698390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
