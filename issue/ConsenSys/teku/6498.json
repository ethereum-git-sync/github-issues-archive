{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6498",
  "id": 1462524725,
  "node_id": "I_kwDOCM9I9M5XLFs1",
  "number": 6498,
  "title": "Potential issue with voluntary exit command not gracefully exiting",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-11-23T23:05:06Z",
  "updated_at": "2022-12-08T00:18:31Z",
  "closed_at": "2022-12-08T00:18:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Had a talk with someone while testing capella devnet, and they submitted an exit and it hung, we should see if we can submit some exits and that we haven't broken it...\n\nI had a vague memory of this being in acceptance tests, so it would be interesting to see if that's not using the CLI version...\n\ndocs reference for convenience: https://docs.teku.consensys.net/en/latest/HowTo/Voluntary-Exit/\n\n\n> \n> When manually triggering a teku exit, it's hanging\n> \n> ```\n> Loading configuration...\n> Exits are going to be generated for validators:\n> ad2e4b8\n> Epoch: 18\n> \n> These validators won't be able to be re-activated, and withdrawals aren't likely to be possible until Phase 2 of eth2 Mainnet.\n> Are you sure you wish to continue (yes/no)?\n> yes\n> Exit for validator ad2e4b8 submitted.\n> \n> \n> ^C\n> ```\n> and I have to escape\n> ",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6498/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337111076",
    "html_url": "https://github.com/ConsenSys/teku/issues/6498#issuecomment-1337111076",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
    "id": 1337111076,
    "node_id": "IC_kwDOCM9I9M5PsrIk",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T10:38:13Z",
    "updated_at": "2022-12-05T10:38:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "First test in ropsten mev.\r\nI exited only one key using this command line:\r\n\r\n```shell\r\nsudo -u teku ./teku voluntary-exit --beacon-node-api-endpoint=http://127.0.0.1:5051 --validator-keys \"/etc/teku/keys:/etc/teku/secrets\" --validator-public-keys \"0x9975b3bf26f6727dbc201cc202a1e04c7d478bebaef0435f11e8f8cb6ccdc68c39fd67b036e13cb5ccfa39525cb43cfa\"\r\n```\r\n\r\nit hanged for a couple of minutes after printing:\r\n```\r\nLoading configuration...\r\nExits are going to be generated for validators:\r\n9975b3b\r\nEpoch: 42482\r\n\r\nThese validators won't be able to be re-activated, and withdrawals aren't likely to be possible until Phase 2 of eth2 Mainnet.\r\nAre you sure you wish to continue (yes/no)?\r\nyes\r\nExit for validator 9975b3b submitted.\r\n```\r\nand then exited correctly (RC seems to be 0)\r\n\r\n<img width=\"919\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15999009/205616810-4d8820ec-5081-49db-a57c-64a90d94a09b.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337111076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337116266",
    "html_url": "https://github.com/ConsenSys/teku/issues/6498#issuecomment-1337116266",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
    "id": 1337116266,
    "node_id": "IC_kwDOCM9I9M5PssZq",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T10:42:46Z",
    "updated_at": "2022-12-05T10:42:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "then I exited 4 keys together:\r\n\r\n<img width=\"919\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15999009/205617601-4590ca32-882c-4506-973c-8f86d96f360d.png\">\r\n\r\nhanged for the same amount of time (2m ish) after printing the submission messages for all of them.\r\nSo it seems a constant time independent by the amount of keys exiting.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337116266/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337123598",
    "html_url": "https://github.com/ConsenSys/teku/issues/6498#issuecomment-1337123598",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
    "id": 1337123598,
    "node_id": "IC_kwDOCM9I9M5PsuMO",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T10:47:22Z",
    "updated_at": "2022-12-05T10:47:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "I exited them all (2500).\r\nI correctly got `Exit is not the first one for validator <idx>.` for the 6 previously exited validator.\r\nThe same amount of time waited before getting the prompt back.\r\nError code: 0",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337123598/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337152334",
    "html_url": "https://github.com/ConsenSys/teku/issues/6498#issuecomment-1337152334",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
    "id": 1337152334,
    "node_id": "IC_kwDOCM9I9M5Ps1NO",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T11:10:05Z",
    "updated_at": "2022-12-05T11:16:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "randomly picking keys and they are effectively exiting:\r\n<img width=\"1405\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15999009/205623134-8fbd01a9-2481-4c24-97a4-424de7396e74.png\">\r\n<img width=\"390\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15999009/205624261-1fd98abe-c173-4805-a105-bed4003760c0.png\">\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1337152334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1338592476",
    "html_url": "https://github.com/ConsenSys/teku/issues/6498#issuecomment-1338592476",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
    "id": 1338592476,
    "node_id": "IC_kwDOCM9I9M5PyUzc",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T01:34:29Z",
    "updated_at": "2022-12-06T01:34:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "If I had to guess I'd say the 2 min delay before shutdown is something like waiting for OkHttp to terminate the background threads it creates.  If they aren't marked as daemon that would stop the jvm from exiting until they exited and I think they do stay around for a period of time before being stopped.  We can probably grab a thread dump in the period we're waiting for it to stop to confirm that.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1338592476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1339186365",
    "html_url": "https://github.com/ConsenSys/teku/issues/6498#issuecomment-1339186365",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6498",
    "id": 1339186365,
    "node_id": "IC_kwDOCM9I9M5P0ly9",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T11:33:40Z",
    "updated_at": "2022-12-06T11:33:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "> If I had to guess ...\r\n\r\nI had the same thought",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1339186365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
