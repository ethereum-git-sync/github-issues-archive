{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6075",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6075",
  "id": 1339038018,
  "node_id": "I_kwDOCM9I9M5P0BlC",
  "number": 6075,
  "title": "ERROR - Failed to process event queue for client",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-15T13:56:50Z",
  "updated_at": "2022-12-13T01:20:21Z",
  "closed_at": "2022-12-13T01:20:20Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Reported by user `Torran` on [Discord](https://discord.com/channels/697535391594446898/697539289042649190/1008732873093824533).\r\n\r\n> I got a random error in my Teku logs, didn't seem to affect its operation, should I be concerned?\r\n\r\n```\r\nERROR - Failed to process event queue for client 902268355\r\njava.util.concurrent.CompletionException: java.lang.IllegalStateException: s=OPEN,api=BLOCKED,sc=false,e=null\r\nat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:332) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:347) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:636) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:576) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:32) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:142) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$exceptionallyCompose$29(SafeFuture.java:395) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:576) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:32) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:142) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateTo(SafeFuture.java:289) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:119) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\nat java.lang.Thread.run(Thread.java:833) ~[?:?]\r\nCaused by: java.lang.IllegalStateException: s=OPEN,api=BLOCKED,sc=false,e=null\r\nat org.eclipse.jetty.server.HttpOutput.write(HttpOutput.java:828) ~[jetty-server-9.4.48.v20220622.jar:9.4.48.v20220622]\r\nat org.eclipse.jetty.server.HttpOutput.print(HttpOutput.java:1139) ~[jetty-server-9.4.48.v20220622.jar:9.4.48.v20220622]\r\nat org.eclipse.jetty.server.HttpOutput.print(HttpOutput.java:1068) ~[jetty-server-9.4.48.v20220622.jar:9.4.48.v20220622]\r\nat io.javalin.http.sse.Emitter.emit(Emitter.kt:29) ~[javalin-4.6.4.jar:4.6.4]\r\nat io.javalin.http.sse.SseClient.sendEvent(SseClient.kt:29) ~[javalin-4.6.4.jar:4.6.4]\r\nAug 15 14:13:19 eth-node teku[407600]: at io.javalin.http.sse.SseClient.sendEvent$default(SseClient.kt:27) ~[javalin-4.6.4.jar:4.6.4]\r\nat io.javalin.http.sse.SseClient.sendEvent(SseClient.kt) ~[javalin-4.6.4.jar:4.6.4]\r\nat tech.pegasys.teku.beaconrestapi.handlers.v1.events.EventSubscriber.lambda$processEventQueue$1(EventSubscriber.java:121) ~[teku-data-beaconrestapi-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.fromRunnable(SafeFuture.java:154) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.AsyncRunner.lambda$runAsync$0(AsyncRunner.java:23) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:73) ~[teku-infrastructure-async-22.8.0.jar:22.8.0]\r\n... 4 more\r\n```\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6075/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1215065582",
    "html_url": "https://github.com/ConsenSys/teku/issues/6075#issuecomment-1215065582",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075",
    "id": 1215065582,
    "node_id": "IC_kwDOCM9I9M5IbG3u",
    "user": {
      "login": "torran-g",
      "id": 56542316,
      "node_id": "MDQ6VXNlcjU2NTQyMzE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/56542316?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/torran-g",
      "html_url": "https://github.com/torran-g",
      "followers_url": "https://api.github.com/users/torran-g/followers",
      "following_url": "https://api.github.com/users/torran-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/torran-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/torran-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/torran-g/subscriptions",
      "organizations_url": "https://api.github.com/users/torran-g/orgs",
      "repos_url": "https://api.github.com/users/torran-g/repos",
      "events_url": "https://api.github.com/users/torran-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/torran-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-15T14:17:17Z",
    "updated_at": "2022-08-15T14:17:17Z",
    "author_association": "NONE",
    "body": "## More details\r\n\r\n- Teku v22.8.0\r\n- EL: Besu v22.7.0\r\n- Network: Mainnet\r\n- Synced but no activated validators.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1215065582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1215997753",
    "html_url": "https://github.com/ConsenSys/teku/issues/6075#issuecomment-1215997753",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075",
    "id": 1215997753,
    "node_id": "IC_kwDOCM9I9M5Ieqc5",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T00:01:39Z",
    "updated_at": "2022-08-16T00:01:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "This error is saying that the Teku beacon node couldn't send an event to some client connected to the `/eth/v1/events` endpoint. I'm not entirely sure I understand the situation but it looks like the socket was unable to be written to fast enough - though it does look suspiciously like a bug in the underlying jetty HTTP library since it typically should have blocked until it could write and `IllegalStateException` is definitely something I wouldn't expect it to throw...\n\nWere you running a separate validator client or would something else have been subscribed to the events endpoint? If it wasn't an external VC, what events was it subscribed to?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1215997753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1216458304",
    "html_url": "https://github.com/ConsenSys/teku/issues/6075#issuecomment-1216458304",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075",
    "id": 1216458304,
    "node_id": "IC_kwDOCM9I9M5Iga5A",
    "user": {
      "login": "torran-g",
      "id": 56542316,
      "node_id": "MDQ6VXNlcjU2NTQyMzE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/56542316?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/torran-g",
      "html_url": "https://github.com/torran-g",
      "followers_url": "https://api.github.com/users/torran-g/followers",
      "following_url": "https://api.github.com/users/torran-g/following{/other_user}",
      "gists_url": "https://api.github.com/users/torran-g/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/torran-g/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/torran-g/subscriptions",
      "organizations_url": "https://api.github.com/users/torran-g/orgs",
      "repos_url": "https://api.github.com/users/torran-g/repos",
      "events_url": "https://api.github.com/users/torran-g/events{/privacy}",
      "received_events_url": "https://api.github.com/users/torran-g/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T10:32:36Z",
    "updated_at": "2022-08-16T10:32:36Z",
    "author_association": "NONE",
    "body": "I'm not running a separate VC. Unsure what would be subscribed to it, the only thing I can think of is the [ethereum-metrics-exporter](https://github.com/samcm/ethereum-metrics-exporter) but I don't see anything related in its logs.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1216458304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1217245883",
    "html_url": "https://github.com/ConsenSys/teku/issues/6075#issuecomment-1217245883",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075",
    "id": 1217245883,
    "node_id": "IC_kwDOCM9I9M5IjbK7",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T22:46:05Z",
    "updated_at": "2022-08-16T22:46:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "ah, yeah ethereum-metrics-exporter hits the event stream pretty hard. There's a good chance it wasn't able to read the data being sent fast enough. Teku should handle this gracefully and disconnect it without the error but hopefully that gives us something to go on to try and reproduce this.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1217245883/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1347611780",
    "html_url": "https://github.com/ConsenSys/teku/issues/6075#issuecomment-1347611780",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6075",
    "id": 1347611780,
    "node_id": "IC_kwDOCM9I9M5QUuyE",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-13T01:20:20Z",
    "updated_at": "2022-12-13T01:20:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "We've now updated Jetty and I'm no longer able to reproduce this.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1347611780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
