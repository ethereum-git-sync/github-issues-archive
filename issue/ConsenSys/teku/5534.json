{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5534",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5534/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5534/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5534/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5534",
  "id": 1241364160,
  "node_id": "I_kwDOCM9I9M5J_bbA",
  "number": 5534,
  "title": "Downgrade or suppress logging of io.libp2p.pubsub.MessageAlreadySeenException",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-05-19T07:43:59Z",
  "updated_at": "2022-05-24T07:17:39Z",
  "closed_at": "2022-05-24T07:17:39Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Background\r\n\r\n`io.libp2p.pubsub.MessageAlreadySeenException` indicates that a node is trying to publish an attestation that it has previously seen via gossip. We currently log this at `ERROR` level.\r\n\r\nFor example,\r\n\r\n```\r\n2022-05-09 12:03:33.427 ERROR - Failed to publish attestation for slot 2965817\r\njava.util.concurrent.CompletionException: io.libp2p.pubsub.MessageAlreadySeenException: Msg: PubsubMessage{data: \"\\367\\001\\034\\344\\000\\000\\0009A-\\000\\001\\001\\000\\023\\001\\005\\230\\000\\000\\000\\v8\\244\\240>-\\270Qq\\245Ej\\250\\327\\213p\\365\\347\\001\\320#?E3%^\\016\\220\\242\\232O\\254\\bj\\001\\000\\001(\\210\\355\\354\\354\\233<\\267\\017:\\262~\\364\\221\\306\\354\\334A\\2713\\321\\364`\\252\\023\\2204y\\232\\a\\t\\301\\037\\022\\tj\\001\\001\\'\\360\\223\\000\\363\\t\\233\\332%(-\\3447\\377v\\024\\367\\313t\\324\\024\\004.\\236\\300\\226\\226\\275\\230\\344?\\341\\a\\324\\266}\\204\\227b\\f\\366 \\a{\\321s\\030\\265\\346\\231\\001c\\237\\370%\\033\\203\\355\\261\\315\\212\\213\\273\\000_\\356z\\206\\323\\370\\356k\\203`\\353\\022&z\\273\\2132\\257!H\\021\\327\\301\\001.\\327\\n\\017\\203\\306\\374V\\242\\027\\247M\\300Ev\\303\\220\\315\\371\\265\\363\\241\\a\\003N<qK3\\027\\207#\\266\\243\\260m5\\210\\350\\242K\\341\\f\\337\\000\\000\\000\\000\\000 \\000\\000\\000\\000\\000\\000\\000\\000\\000\\000\\000\\000 \"\r\ntopicIDs: \"/eth2/82f4a72b/beacon_attestation_19/ssz_snappy\"\r\n}\r\nat java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:368) ~[?:?]\r\n```\r\n\r\n## The issue\r\n\r\nIn standard Teku configurations receiving a message before publishing it is definitely not expected and indicates something weird is going on. It doesn't seem actively harmful though, so maybe ought to be a `WARNING`, but that's not the main issue.\r\n\r\nOn non-standard deployments, however, it is expected that nodes might see attestations via gossip before they publish them. Examples are:\r\n\r\n  - Where a validator is run in multiple locations, relying on Web3Signer for slashing protection. If one node is slower than another then it will throw this exception on trying to send an attestation although it is harmless. (Yes, this is not a recommended configuration, but people still deploy it.)\r\n  - In distributed validator deployments multiple nodes can produce an attestation and they all publish it to the beacon chain to achieve redundancy. Again, this is harmless.\r\n\r\n## Possible approaches\r\n\r\nOptions,\r\n1. downgrade the severity of this to `DEBUG` so that it does not appear in normal logs, or\r\n2. add a configuration option to suppress this message in non-standard configurations.\r\n\r\nI think I favour the second, and maybe downgrading to `WARNING` in the normal case.\r\n\r\nIn all cases, since we've seen the message already via gossip, it likely still makes sense not to publish it again, so we should retain the current behaviour of not publishing it.",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5534/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5534/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
