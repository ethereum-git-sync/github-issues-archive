{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7402",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7402/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7402/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7402/events",
  "html_url": "https://github.com/Consensys/teku/issues/7402",
  "id": 1828634007,
  "node_id": "I_kwDOCM9I9M5s_r2X",
  "number": 7402,
  "title": "Cannot create attestation for future slot",
  "user": {
    "login": "d-banana",
    "id": 109871781,
    "node_id": "U_kgDOBoyCpQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/109871781?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/d-banana",
    "html_url": "https://github.com/d-banana",
    "followers_url": "https://api.github.com/users/d-banana/followers",
    "following_url": "https://api.github.com/users/d-banana/following{/other_user}",
    "gists_url": "https://api.github.com/users/d-banana/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/d-banana/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/d-banana/subscriptions",
    "organizations_url": "https://api.github.com/users/d-banana/orgs",
    "repos_url": "https://api.github.com/users/d-banana/repos",
    "events_url": "https://api.github.com/users/d-banana/events{/privacy}",
    "received_events_url": "https://api.github.com/users/d-banana/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-07-31T08:04:42Z",
  "updated_at": "2023-08-03T21:18:31Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nMy consensus node stop working for about one hour due to \"Cannot create attestation for future slot\" then start syncing again.\r\n![Screenshot from 2023-07-31 09-31-57](https://github.com/Consensys/teku/assets/109871781/eecb50da-36a0-47ec-9a5c-dbf53a7247d5)\r\n![Screenshot from 2023-07-31 10-01-22](https://github.com/Consensys/teku/assets/109871781/878fc10e-0943-4c4b-b92e-1bd48643f200)\r\n![Screenshot from 2023-07-31 10-03-53](https://github.com/Consensys/teku/assets/109871781/70bc327c-6454-4b7d-8251-9ac36e5aac3c)\r\n\r\n\r\n\r\n\r\n### Steps to Reproduce (Bug)\r\nRun Teku consensus node with Besu.\r\n\r\n**Expected behavior:** Run without any issue\r\n\r\n**Actual behavior:** Stop posting attestation and restart syncing \r\n\r\n**Frequency:** Only one time\r\n\r\n### Versions \r\n* Software version: Teku 23.6.2 with Besu 23.4.4\r\n* Java version: 17.0.7\r\n* OS Name & Version: Ubuntu 22.04\r\n* Docker Version: Barebone\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7402/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7402/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1659244839",
    "html_url": "https://github.com/Consensys/teku/issues/7402#issuecomment-1659244839",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7402",
    "id": 1659244839,
    "node_id": "IC_kwDOCM9I9M5i5hEn",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-31T21:55:52Z",
    "updated_at": "2023-07-31T21:55:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for raising.\nThis is typically a sign of struggle - what `-Xmx` setting do you have with teku? This is the heap space used, typically we're seeing people on less than 5g (would look like `-Xmx5g`) struggle on mainnet currently...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1659244839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1659923434",
    "html_url": "https://github.com/Consensys/teku/issues/7402#issuecomment-1659923434",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7402",
    "id": 1659923434,
    "node_id": "IC_kwDOCM9I9M5i8Gvq",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-01T09:24:16Z",
    "updated_at": "2023-08-01T09:24:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "I had a closer look at your screenshots and it does look like you were on 5g heap at the time, and your peer count dropped to 0 (or close to) for a period during full Garbage collection...\nThis looks very similar to a historical sync issue we had during non finality a couple of releases back ,but shouldn't be present in the current (23.6.2)\nCan I confirm which teku image you're using? It really does look very similar to something fixed in 23.5.0, but its definitely possible that some other scenario looks similar on the dash...\n\nWould it be possible to see the beacon node logs prior to the spike in garbage collection just after 8pm on the metrics board? Specifically warnings / errors / exceptions are of interest, probably in the period from 8pm to maybe 5 past...\n\nRelated to this, though not strictly, we've started a release that would address some memory consumption etc which might alleviate things, though it'd be interesting to pursue and see if there's something else involved here.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1659923434/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1661662794",
    "html_url": "https://github.com/Consensys/teku/issues/7402#issuecomment-1661662794",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7402",
    "id": 1661662794,
    "node_id": "IC_kwDOCM9I9M5jCvZK",
    "user": {
      "login": "d-banana",
      "id": 109871781,
      "node_id": "U_kgDOBoyCpQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/109871781?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/d-banana",
      "html_url": "https://github.com/d-banana",
      "followers_url": "https://api.github.com/users/d-banana/followers",
      "following_url": "https://api.github.com/users/d-banana/following{/other_user}",
      "gists_url": "https://api.github.com/users/d-banana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/d-banana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/d-banana/subscriptions",
      "organizations_url": "https://api.github.com/users/d-banana/orgs",
      "repos_url": "https://api.github.com/users/d-banana/repos",
      "events_url": "https://api.github.com/users/d-banana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/d-banana/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-02T07:33:45Z",
    "updated_at": "2023-08-02T07:33:45Z",
    "author_association": "NONE",
    "body": "Indead I use the Xmx5g flag but I confirm that I use the version 23.6.2.\r\n![image](https://github.com/Consensys/teku/assets/109871781/47163770-15cf-48ed-83de-62a6fee56d1b)\r\n\r\nLog files => https://gist.github.com/d-banana/33492faf6370d81017a658c93643b177\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1661662794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1664650346",
    "html_url": "https://github.com/Consensys/teku/issues/7402#issuecomment-1664650346",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7402",
    "id": 1664650346,
    "node_id": "IC_kwDOCM9I9M5jOIxq",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T21:08:12Z",
    "updated_at": "2023-08-03T21:18:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Particularly during the heavy garbage collection during the outage period we lost a lot of states and kept having to regenerate.\r\nThis problem should be resolved in 23.8.0 using the epoch-states cache, which is on by default.\r\n\r\nIt greatly reduces the states in memory, and if you're accessing a lot of non final states it might be worth increasing that cache, which is noted in release notes, but by default it should be good for most users. \r\n\r\nAre you happy to update to 23.8.0?",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1664650346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
