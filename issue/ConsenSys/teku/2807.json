{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2807",
  "id": 703094255,
  "node_id": "MDU6SXNzdWU3MDMwOTQyNTU=",
  "number": 2807,
  "title": "Verify ETH1 chain ID",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919131,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTMx",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/enhancement%20%F0%9F%95%B5%EF%B8%8F%E2%80%8D%E2%99%80%EF%B8%8F",
      "name": "enhancement üïµÔ∏è‚Äç‚ôÄÔ∏è",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 1170684912,
      "node_id": "MDU6TGFiZWwxMTcwNjg0OTEy",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/good%20first%20issue%20:raising_hand:",
      "name": "good first issue :raising_hand:",
      "color": "006b75",
      "default": false,
      "description": "This is a good first issue for a new contributor to work on"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-09-16T21:41:36Z",
  "updated_at": "2020-10-20T21:15:35Z",
  "closed_at": "2020-10-20T21:15:35Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\nWhen the PoWService first connects to the ETH1 node and when sending deposits, check that the chain ID reported by the ETH1 node matches the one in the network config.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2807/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705974358",
    "html_url": "https://github.com/ConsenSys/teku/issues/2807#issuecomment-705974358",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
    "id": 705974358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTk3NDM1OA==",
    "user": {
      "login": "systemfreund",
      "id": 574849,
      "node_id": "MDQ6VXNlcjU3NDg0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/systemfreund",
      "html_url": "https://github.com/systemfreund",
      "followers_url": "https://api.github.com/users/systemfreund/followers",
      "following_url": "https://api.github.com/users/systemfreund/following{/other_user}",
      "gists_url": "https://api.github.com/users/systemfreund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/systemfreund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/systemfreund/subscriptions",
      "organizations_url": "https://api.github.com/users/systemfreund/orgs",
      "repos_url": "https://api.github.com/users/systemfreund/repos",
      "events_url": "https://api.github.com/users/systemfreund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/systemfreund/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T05:22:29Z",
    "updated_at": "2020-10-09T05:22:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'd like to tackle this, but I have a question. What do you mean by checking the chain ID?\r\nShould it just do an `ERROR` log in that case, or somehow fail or shutdown?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705974358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705977225",
    "html_url": "https://github.com/ConsenSys/teku/issues/2807#issuecomment-705977225",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
    "id": 705977225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTk3NzIyNQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T05:32:39Z",
    "updated_at": "2020-10-09T05:32:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Good question.  The ideal case is that the ETH1 node is up at startup, and Teku fails to start with a clear error message if the chain ID doesn't match but the ETH1 chain may not be available at startup and we don't want to delay Teku waiting for it to become available.  So I think we'll just have to have something that tries to query the chain ID - started by `PowchainService.doStart` but that returns immediately and then in the background continues retrying until the ETH1 node is available and we can get it's chain ID.  Then if it doesn't match log a message via the `StatusLogger` at error level.\r\n\r\n\r\nThe sending deposits part of this description doesn't apply anymore as we'll be removing the subcommands that send deposits (we recommend users use other tools like the launchpad).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705977225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/706928374",
    "html_url": "https://github.com/ConsenSys/teku/issues/2807#issuecomment-706928374",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
    "id": 706928374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjkyODM3NA==",
    "user": {
      "login": "systemfreund",
      "id": 574849,
      "node_id": "MDQ6VXNlcjU3NDg0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/systemfreund",
      "html_url": "https://github.com/systemfreund",
      "followers_url": "https://api.github.com/users/systemfreund/followers",
      "following_url": "https://api.github.com/users/systemfreund/following{/other_user}",
      "gists_url": "https://api.github.com/users/systemfreund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/systemfreund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/systemfreund/subscriptions",
      "organizations_url": "https://api.github.com/users/systemfreund/orgs",
      "repos_url": "https://api.github.com/users/systemfreund/repos",
      "events_url": "https://api.github.com/users/systemfreund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/systemfreund/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-12T07:21:19Z",
    "updated_at": "2020-10-12T07:21:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for your input. I still do have a couple of questions :smiley: \r\n\r\n1. Against which chain id value do I have to validate the ETH1 chain id? I couldn't find any mention of a chain id in the existing code. \r\n\r\n1. Regarding the `StatusLogger`... you're not referring to `fatalError` with a following `System.exit`, but to adding a new logging method to `StatusLogger`, right?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/706928374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/706940033",
    "html_url": "https://github.com/ConsenSys/teku/issues/2807#issuecomment-706940033",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
    "id": 706940033,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjk0MDAzMw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-12T07:42:00Z",
    "updated_at": "2020-10-12T07:42:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "1. The expected chain ID is in the network definition (so for example the MainNet config: https://github.com/PegaSysEng/teku/blob/aa936b9c36607f434a2a412ad63ad693263ef71c/util/src/main/resources/tech/pegasys/teku/util/config/mainnet.yaml#L55) and those definitions will be loaded into the `Constants` class at startup (https://github.com/PegaSysEng/teku/blob/ffc0579ab701df30ac43feb26f500b18215d5e17/util/src/main/java/tech/pegasys/teku/util/config/Constants.java#L124).  So you'd request the chain ID from the ETH1 node and check that it matches `Constants.DEPOSIT_CHAIN_ID`.\r\n\r\nRequesting the chain ID from the ETH1 node would be a new method to add to `Eth1Provider` which will wind up calling `web3j.ethChainId()` to do the actual work.\r\n\r\n2. Yes, it would be a nw method on StatusLogger.  I'd suggest starting the message with `PLEASE CHECK YOUR ETH1 NODE | ` to match what eth1DepositEventsFailure outputs.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/706940033/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/708234622",
    "html_url": "https://github.com/ConsenSys/teku/issues/2807#issuecomment-708234622",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
    "id": 708234622,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwODIzNDYyMg==",
    "user": {
      "login": "systemfreund",
      "id": 574849,
      "node_id": "MDQ6VXNlcjU3NDg0OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574849?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/systemfreund",
      "html_url": "https://github.com/systemfreund",
      "followers_url": "https://api.github.com/users/systemfreund/followers",
      "following_url": "https://api.github.com/users/systemfreund/following{/other_user}",
      "gists_url": "https://api.github.com/users/systemfreund/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/systemfreund/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/systemfreund/subscriptions",
      "organizations_url": "https://api.github.com/users/systemfreund/orgs",
      "repos_url": "https://api.github.com/users/systemfreund/repos",
      "events_url": "https://api.github.com/users/systemfreund/events{/privacy}",
      "received_events_url": "https://api.github.com/users/systemfreund/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-14T08:05:13Z",
    "updated_at": "2020-10-14T08:05:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Just wanted to say that I'm still working on this. I do have a day-job therefore I cannot allocate my time freely to work on teku, that's why it takes a bit longer :) ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/708234622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/708683857",
    "html_url": "https://github.com/ConsenSys/teku/issues/2807#issuecomment-708683857",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2807",
    "id": 708683857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwODY4Mzg1Nw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-14T22:01:30Z",
    "updated_at": "2020-10-14T22:01:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "@systemfreund Thanks for the update, no problem if it takes time.  Feel free to ask more questions either here or on our Discord (https://discord.gg/7hPv2T6) if there's anything we can do to help.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/708683857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
