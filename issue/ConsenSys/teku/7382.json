{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7382",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7382/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7382/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7382/events",
  "html_url": "https://github.com/Consensys/teku/issues/7382",
  "id": 1818916120,
  "node_id": "I_kwDOCM9I9M5sanUY",
  "number": 7382,
  "title": "Teku VC asks Web3Signer to sign for inactive validators",
  "user": {
    "login": "gg718",
    "id": 126100364,
    "node_id": "U_kgDOB4QjjA",
    "avatar_url": "https://avatars.githubusercontent.com/u/126100364?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gg718",
    "html_url": "https://github.com/gg718",
    "followers_url": "https://api.github.com/users/gg718/followers",
    "following_url": "https://api.github.com/users/gg718/following{/other_user}",
    "gists_url": "https://api.github.com/users/gg718/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gg718/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gg718/subscriptions",
    "organizations_url": "https://api.github.com/users/gg718/orgs",
    "repos_url": "https://api.github.com/users/gg718/repos",
    "events_url": "https://api.github.com/users/gg718/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gg718/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/Consensys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug ðŸž",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-07-24T18:25:00Z",
  "updated_at": "2023-08-02T13:10:39Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nTeku VC asks Web3Signer to sign for inactive validators. Let's say I load 10 keys into Teku; 5 that have received 32 ETH and become active, and another 5 that have yet to receive 32 ETH, I see errors in the logs for Web3Signer like:\r\n\r\n> `2023-07-24 09:42:15.029+00:00 | vert.x-eventloop-thread-0 | ERROR | LogErrorHandler | Failed request: http://web3signer:9000/api/v1/eth2/sign/0xa60345b3482359171a7aae637b93fcd9245126a07bc58717cbc55502a197bf838e10adb6825f52420994c9f29c913b7d`\r\n\r\nOther validator clients correctly recognize the validator is not active and do not ask Web3Signer to sign.\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\n**Expected behavior:**\r\n\r\nTeku should not ask Web3Signer to sign for inactive keys.\r\n\r\n**Actual behavior:**\r\n\r\nTeku asks Web3Signer to sign for inactive keys.\r\n\r\n**Frequency:**\r\n\r\nEvery epoch.\r\n\r\n### Versions (Add all that apply)\r\n\r\n* Teku v23.6.2\r\n* Web3Signer v23.6.0",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7382/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7382/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1648702145",
    "html_url": "https://github.com/Consensys/teku/issues/7382#issuecomment-1648702145",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7382",
    "id": 1648702145,
    "node_id": "IC_kwDOCM9I9M5iRTLB",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-24T22:19:15Z",
    "updated_at": "2023-07-24T22:19:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for raising.\nWhen you say 'constantly', is it asking every slot? Once an epoch?\nIt sounds very much like attempting to determine if an attester is an aggregator...\n\nI'll put the 'bug' flag on this one, but this extra information would be useful if it's easy to get at, otherwise we'll be trying it anyway so we'll find out soon enough...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1648702145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1648747486",
    "html_url": "https://github.com/Consensys/teku/issues/7382#issuecomment-1648747486",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7382",
    "id": 1648747486,
    "node_id": "IC_kwDOCM9I9M5iRePe",
    "user": {
      "login": "gg718",
      "id": 126100364,
      "node_id": "U_kgDOB4QjjA",
      "avatar_url": "https://avatars.githubusercontent.com/u/126100364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gg718",
      "html_url": "https://github.com/gg718",
      "followers_url": "https://api.github.com/users/gg718/followers",
      "following_url": "https://api.github.com/users/gg718/following{/other_user}",
      "gists_url": "https://api.github.com/users/gg718/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gg718/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gg718/subscriptions",
      "organizations_url": "https://api.github.com/users/gg718/orgs",
      "repos_url": "https://api.github.com/users/gg718/repos",
      "events_url": "https://api.github.com/users/gg718/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gg718/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-24T23:16:13Z",
    "updated_at": "2023-07-24T23:16:13Z",
    "author_association": "NONE",
    "body": "Apologies, opened this issue a little too hastily.\r\n\r\nIt's every epoch â€“ description updated.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1648747486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1648931653",
    "html_url": "https://github.com/Consensys/teku/issues/7382#issuecomment-1648931653",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7382",
    "id": 1648931653,
    "node_id": "IC_kwDOCM9I9M5iSLNF",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-25T02:46:56Z",
    "updated_at": "2023-07-25T02:46:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok great, I suspect it's likely trying to decide which validators are aggregators for the epoch.\nThe VC likely isn't fully aware of each validators status, but I think we can probably do something to alleviate this.\nThanks for the extra context, it's helpful :)",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1648931653/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1661380827",
    "html_url": "https://github.com/Consensys/teku/issues/7382#issuecomment-1661380827",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7382",
    "id": 1661380827,
    "node_id": "IC_kwDOCM9I9M5jBqjb",
    "user": {
      "login": "ybstaked",
      "id": 85460995,
      "node_id": "MDQ6VXNlcjg1NDYwOTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85460995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ybstaked",
      "html_url": "https://github.com/ybstaked",
      "followers_url": "https://api.github.com/users/ybstaked/followers",
      "following_url": "https://api.github.com/users/ybstaked/following{/other_user}",
      "gists_url": "https://api.github.com/users/ybstaked/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ybstaked/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ybstaked/subscriptions",
      "organizations_url": "https://api.github.com/users/ybstaked/orgs",
      "repos_url": "https://api.github.com/users/ybstaked/repos",
      "events_url": "https://api.github.com/users/ybstaked/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ybstaked/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-02T02:10:20Z",
    "updated_at": "2023-08-02T02:10:20Z",
    "author_association": "NONE",
    "body": "We are also noticing this and same behavior for exited validators and it causes in our case to miss a lot of attestations where there are inactive or exited keys.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1661380827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1661548920",
    "html_url": "https://github.com/Consensys/teku/issues/7382#issuecomment-1661548920",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7382",
    "id": 1661548920,
    "node_id": "IC_kwDOCM9I9M5jCTl4",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-02T06:06:54Z",
    "updated_at": "2023-08-02T06:06:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "> We are also noticing this and same behavior for exited validators and it causes in our case to miss a lot of attestations where there are inactive or exited keys.\r\n\r\nSigning a message causes missed attestations?\r\nAre you talking about signing contention? Or reporting in the summary line? I'd be interested to know a little more on this if possible...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1661548920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1662186637",
    "html_url": "https://github.com/Consensys/teku/issues/7382#issuecomment-1662186637",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7382",
    "id": 1662186637,
    "node_id": "IC_kwDOCM9I9M5jEvSN",
    "user": {
      "login": "ybstaked",
      "id": 85460995,
      "node_id": "MDQ6VXNlcjg1NDYwOTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85460995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ybstaked",
      "html_url": "https://github.com/ybstaked",
      "followers_url": "https://api.github.com/users/ybstaked/followers",
      "following_url": "https://api.github.com/users/ybstaked/following{/other_user}",
      "gists_url": "https://api.github.com/users/ybstaked/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ybstaked/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ybstaked/subscriptions",
      "organizations_url": "https://api.github.com/users/ybstaked/orgs",
      "repos_url": "https://api.github.com/users/ybstaked/repos",
      "events_url": "https://api.github.com/users/ybstaked/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ybstaked/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-02T13:10:38Z",
    "updated_at": "2023-08-02T13:10:38Z",
    "author_association": "NONE",
    "body": "@rolfyone unfortunately no errors in either Teku BN or Teku VC logs, but the performance of our Teku validator has been considerably worse and I think it's due to this issue.\r\n\r\n- https://beaconcha.in/validator/292955#attestations",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1662186637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
