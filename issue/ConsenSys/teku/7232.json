{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/7232",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/7232/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/7232/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/7232/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/7232",
  "id": 1745584061,
  "node_id": "I_kwDOCM9I9M5oC3-9",
  "number": 7232,
  "title": "Validator retry attestation when detected a future slot",
  "user": {
    "login": "maxp1256",
    "id": 22156972,
    "node_id": "MDQ6VXNlcjIyMTU2OTcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/22156972?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/maxp1256",
    "html_url": "https://github.com/maxp1256",
    "followers_url": "https://api.github.com/users/maxp1256/followers",
    "following_url": "https://api.github.com/users/maxp1256/following{/other_user}",
    "gists_url": "https://api.github.com/users/maxp1256/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/maxp1256/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/maxp1256/subscriptions",
    "organizations_url": "https://api.github.com/users/maxp1256/orgs",
    "repos_url": "https://api.github.com/users/maxp1256/repos",
    "events_url": "https://api.github.com/users/maxp1256/events{/privacy}",
    "received_events_url": "https://api.github.com/users/maxp1256/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-06-07T10:31:33Z",
  "updated_at": "2023-06-08T08:04:37Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nValidator is missing slots because the slot id is too high compared to the chain\r\n\r\nFailed to produce aggregate  Slot: 6608897 Validator: [x]\r\njava.lang.IllegalArgumentException: Invalid params response from Beacon Node API (url = http://localhost:5051/eth/v1/validator/attestation_data?slot=6608897&committee_index=50, status = 400, message = Cannot create attestation for future slot. Requested 6608897 but current slot is 6608895)\r\nat tech.pegasys.teku.validator.remote.typedef.ResponseHandler.defaultBadRequestHandler(ResponseHandler.java:129) ~[teku-validator-remote-23.5.0.jar:23.5.0]\r\nat tech.pegasys.teku.validator.remote.typedef.ResponseHandler.handleResponse(ResponseHandler.java:93) ~[teku-validator-remote-23.5.0.jar:23.5.0]\r\nat tech.pegasys.teku.validator.remote.typedef.handlers.AbstractTypeDefRequest.executeCall(AbstractTypeDefRequest.java:149) ~[teku-validator-remote-23.5.0.jar:23.5.0]\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\nDon't know why it's happening, maybe related to high cpu load / multithreading / timesync issue\r\n\r\n**Expected behavior:** [What you expect to happen]\r\nattestation should be retried and not missed\r\n\r\n**Actual behavior:** [What actually happens]\r\nattestation is missed\r\n\r\n**Frequency:** [How regularly does it occur?] \r\n10-30 times a day\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 23.5.0\r\n* Java version: OpenJDK 19.0.2\r\n* OS Name & Version: Win 10 Hyper-V VM",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/7232/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/7232/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1581750755",
    "html_url": "https://github.com/ConsenSys/teku/issues/7232#issuecomment-1581750755",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/7232",
    "id": 1581750755,
    "node_id": "IC_kwDOCM9I9M5eR5nj",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-08T01:25:28Z",
    "updated_at": "2023-06-08T01:25:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey there, thanks for raising this one.\n\nIt's a bit of a complicated scenario generally, where this would occur.\n\nSome little notes:\n - attestations are due at 4 seconds into a given slot\n - blocks are due at 0 seconds on slot.\n\nA number of things can happen, often regenerating states for example - where the beacon-node isn't ready to accept attestation requests, and this seems to be the most common kind of scenario where this 'future slot' error occurs.\nIt would be worth just making sure that your BN isn't running low on resources - that you're up to date on teku version etc etc.\nIt's also worth checking when it happens, whether the BN has any log context about anything - like slow tick events, regenerating states...\n\nIf the BN is struggling, it's difficult to resubmit, it could actually exacerbate any issues that may be happening on the BN, so resubmitting can be problematic...\n\nWe may be able to do something in this area, I'll have to ponder options...",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1581750755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1582095842",
    "html_url": "https://github.com/ConsenSys/teku/issues/7232#issuecomment-1582095842",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/7232",
    "id": 1582095842,
    "node_id": "IC_kwDOCM9I9M5eTN3i",
    "user": {
      "login": "maxp1256",
      "id": 22156972,
      "node_id": "MDQ6VXNlcjIyMTU2OTcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/22156972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maxp1256",
      "html_url": "https://github.com/maxp1256",
      "followers_url": "https://api.github.com/users/maxp1256/followers",
      "following_url": "https://api.github.com/users/maxp1256/following{/other_user}",
      "gists_url": "https://api.github.com/users/maxp1256/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maxp1256/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maxp1256/subscriptions",
      "organizations_url": "https://api.github.com/users/maxp1256/orgs",
      "repos_url": "https://api.github.com/users/maxp1256/repos",
      "events_url": "https://api.github.com/users/maxp1256/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maxp1256/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-08T08:03:45Z",
    "updated_at": "2023-06-08T08:04:37Z",
    "author_association": "NONE",
    "body": "I've splitted validator and chain into 2 different processes on the same machine. They are both the same (latest) 23.5 version.\r\ngeth is on another VM but on the same hardware. It's definitely possible that's a cpu ressource lack, but I think that there should be a retry logic to address this issue.\r\n\r\nMaybe relevant logs related to the chain\r\n`\r\n2023-06-07 11:39:53.243+02:00 | beaconchain-async-0 | INFO  | StateGenerator | Completed regeneration of state for block 0xd357c69dd0d34d3d0facd0b783ba4ef178cb4c773bb0116f08245d697b4a0623 at slot 6608832 by replaying 31 blocks. Took 17359ms\r\n\r\n2023-06-07 11:39:53.243+02:00 | TimeTick-1 | INFO  | teku-event-log | \u001B[32mEpoch Event *** Epoch: 206528, Justified checkpoint: 206527, Finalized checkpoint: 206526, Finalized root: d357c69dd0d34d3d0facd0b783ba4ef178cb4c773bb0116f08245d697b4a0623\u001B[0m\r\n\r\n2023-06-07 11:39:53.503+02:00 | TimeTick-1 | INFO  | teku-event-log | \u001B[32mEpoch Event *** Epoch: 206528, Justified checkpoint: 206527, Finalized checkpoint: 206526, Finalized root: d357c69dd0d34d3d0facd0b783ba4ef178cb4c773bb0116f08245d697b4a0623\u001B[0m\r\n\r\n2023-06-07 11:40:05.170+02:00 | beaconchain-async-1 | INFO  | teku-status-log | Attestation performance: epoch 206526, expected 1, produced 0, included 0 (0%), distance 0 / 0,00 / 0, correct target 0 (0%), correct head 0 (0%)\r\n\r\n2023-06-07 11:40:22.110+02:00 | beaconchain-async-1 | INFO  | StateGenerator | Completed regeneration of state for block 0x9a93fb4a48b3c007bdbe8f878862e82b5680788fb5b711bee0a42d08c49abd34 at slot 6608896 by replaying 1 blocks. Took 9139ms\r\n\r\n2023-06-07 11:40:22.484+02:00 | beaconchain-async-3 | INFO  | StateGenerator | Completed regeneration of state for block 0x06ec26b3b15f28704754a786381276563b51c16ec53e7973cf8d88c8e90ec7ef at slot 6608864 by replaying 63 blocks. Took 50562ms\r\n\r\n2023-06-07 11:40:23.147+02:00 | TimeTick-1 | INFO  | teku-event-log | \u001B[37mSlot Event  *** Slot: 6608896, Block:                                                        ... empty, Justified: 206527, Finalized: 206526, Peers: 65\u001B[0m\r\n\r\n2023-06-07 11:40:23.500+02:00 | TimeTick-1 | INFO  | teku-event-log | \u001B[37mMiss slots  *** Current slot: 6608900, previous slot: 6608897\u001B[0m\r\n\r\n2023-06-07 11:40:27.113+02:00 | TimeTick-1 | INFO  | teku-event-log | \u001B[37mSlot Event  *** Slot: 6608900, Block: 559b40d6e59a8762ee73877002cb01ff4fffa422e4af2c7a57969bea0df93ad7, Justified: 206527, Finalized: 206526, Peers: 65\u001B[0m\r\n\r\n2023-06-07 11:40:39.081+02:00 | TimeTick-1 | INFO  | teku-event-log | \u001B[37mSlot Event  *** Slot: 6608901, Block: f33918110f67722f95e599a9cfe7d44eae7bcb444cdfd50705f7131136b549dd, Justified: 206527, Finalized: 206526, Peers: 65\u001B[0m\r\n`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1582095842/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
