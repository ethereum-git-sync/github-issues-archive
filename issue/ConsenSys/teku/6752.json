{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6752",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6752",
  "id": 1565225481,
  "node_id": "I_kwDOCM9I9M5dS3IJ",
  "number": 6752,
  "title": "Teku (23.1.1) sync committee stop working",
  "user": {
    "login": "tiagocmachado",
    "id": 30123077,
    "node_id": "MDQ6VXNlcjMwMTIzMDc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/30123077?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tiagocmachado",
    "html_url": "https://github.com/tiagocmachado",
    "followers_url": "https://api.github.com/users/tiagocmachado/followers",
    "following_url": "https://api.github.com/users/tiagocmachado/following{/other_user}",
    "gists_url": "https://api.github.com/users/tiagocmachado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tiagocmachado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tiagocmachado/subscriptions",
    "organizations_url": "https://api.github.com/users/tiagocmachado/orgs",
    "repos_url": "https://api.github.com/users/tiagocmachado/repos",
    "events_url": "https://api.github.com/users/tiagocmachado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tiagocmachado/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-02-01T00:56:48Z",
  "updated_at": "2023-03-20T02:12:04Z",
  "closed_at": "2023-03-20T02:12:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nSuddenly attestations and sync committee  start failing \r\n\r\n```\r\nJan 31 22:42:19 ip-172-31-14-130 teku[897626]: 2023-01-31 22:42:19.009 INFO  - Validator   *** Published sync_contribution  Count: 1, Slot: 5698409, Root: d2801c36065f9782cead3b26bd2d6d3418b922dbbdb7503ddb78a8e1981e7c26\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: 2023-01-31 22:42:25.237 INFO  - Validator   *** Published sync_signature     Count: 3, Slot: 5698410, Root: aab53809ca8b315c58316718ed82f0b3d2532098cf9c3e7e9e3617cd53dc4c84\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]:   topicIDs: \"/eth2/4a26c58b/sync_committee_1/ssz_snappy\"\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: }\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:368) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:377) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1152) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1773) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]:   topicIDs: \"/eth2/4a26c58b/sync_committee_1/ssz_snappy\"\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: }\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at io.libp2p.etc.types.AsyncExtKt$anyComplete$1.lambda-1$lambda-0(AsyncExt.kt:73) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325) ~[?:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at io.libp2p.etc.types.AsyncExtKt$anyComplete$1.<init>(AsyncExt.kt:69) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at io.libp2p.etc.types.AsyncExtKt.anyComplete(AsyncExt.kt:65) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: at io.libp2p.etc.types.AsyncExtKt.anyComplete(AsyncExt.kt:61) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]:   topicIDs: \"/eth2/4a26c58b/sync_committee_1/ssz_snappy\"\r\nJan 31 22:42:25 ip-172-31-14-130 teku[897626]: }\r\n```\r\n\r\n\r\n**Actual behavior:**\r\nStart missing attestations and sync committee participation goes to 0\r\n\r\n**Frequency:** \r\nOnly once till now\r\n\r\n### Versions\r\n* Software version: 23.1.1\r\n* Java version: openjdk 17.0.5 2022-10-18",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6752/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1411495772",
    "html_url": "https://github.com/ConsenSys/teku/issues/6752#issuecomment-1411495772",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752",
    "id": 1411495772,
    "node_id": "IC_kwDOCM9I9M5UIbdc",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-01T05:39:44Z",
    "updated_at": "2023-02-01T05:39:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "There's 2 aspects that I can see in this ticket\n1- the information being output is excessive, largely the stack trace could be skipped, and then it's noisy but not impossible to follow. This error was changed from debug previously, so before 22.12, it would have silently failed, and you'd be missing sync committee contributions and not be aware that that's what's happening, so we've definitely taken a step in the right direction.\n\n2- It does appear that a host disconnects, which was likely the only host on the sync committee subnet we're subscribed to. It's not clear why we don't find a new host on that subnet, but that does seem to correlate to the reason we can't publish.\n\nFixing the exception spam should be easy enough, and it's reasonable to expect we need to find more subscription hosts in a timely manner. hopefully this isn't something that's super difficult to replicate locally, and I can find a good solution there.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1411495772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1414833120",
    "html_url": "https://github.com/ConsenSys/teku/issues/6752#issuecomment-1414833120",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752",
    "id": 1414833120,
    "node_id": "IC_kwDOCM9I9M5UVKPg",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T03:49:19Z",
    "updated_at": "2023-02-03T03:49:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Nashatyrev do you recall where we check we've got good subscriptions on each subnet? If not it's no bother, we'll do some discovery...",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1414833120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1414906158",
    "html_url": "https://github.com/ConsenSys/teku/issues/6752#issuecomment-1414906158",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752",
    "id": 1414906158,
    "node_id": "IC_kwDOCM9I9M5UVcEu",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T04:26:22Z",
    "updated_at": "2023-02-03T04:26:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "@rolfyone I believe the central interface is `PeerSelectionStrategy` for that. But I never had deep dive to the actual algorithms.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1414906158/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1475509178",
    "html_url": "https://github.com/ConsenSys/teku/issues/6752#issuecomment-1475509178",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6752",
    "id": 1475509178,
    "node_id": "IC_kwDOCM9I9M5X8nu6",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T02:12:03Z",
    "updated_at": "2023-03-20T02:12:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "The remaining section of this issue is basically what's been outlined etc in #6527\n\nI think just for tracking, we'll close this ticket, and any more work in this area is basically #6527 work.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1475509178/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
