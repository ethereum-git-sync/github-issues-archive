{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4078",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4078/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4078/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4078/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4078",
  "id": 918206543,
  "node_id": "MDU6SXNzdWU5MTgyMDY1NDM=",
  "number": 4078,
  "title": "check partial_content return code when syncing on node/health",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-06-11T04:24:17Z",
  "updated_at": "2021-06-14T00:28:52Z",
  "closed_at": "2021-06-14T00:28:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "If an archive node is syncing, the expectation is that the endpoint `/eth/v1/node/health` should return a 206 (partial content) return code.\n\nJuan wasn't having this happen, we should investigate that a normal node syncing is returning a 206 code, and fix if it's behaving unexpectedly.",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4078/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4078/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/859459888",
    "html_url": "https://github.com/ConsenSys/teku/issues/4078#issuecomment-859459888",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4078",
    "id": 859459888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1OTQ1OTg4OA==",
    "user": {
      "login": "joaorodrigues-consensys",
      "id": 43372251,
      "node_id": "MDQ6VXNlcjQzMzcyMjUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43372251?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joaorodrigues-consensys",
      "html_url": "https://github.com/joaorodrigues-consensys",
      "followers_url": "https://api.github.com/users/joaorodrigues-consensys/followers",
      "following_url": "https://api.github.com/users/joaorodrigues-consensys/following{/other_user}",
      "gists_url": "https://api.github.com/users/joaorodrigues-consensys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joaorodrigues-consensys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joaorodrigues-consensys/subscriptions",
      "organizations_url": "https://api.github.com/users/joaorodrigues-consensys/orgs",
      "repos_url": "https://api.github.com/users/joaorodrigues-consensys/repos",
      "events_url": "https://api.github.com/users/joaorodrigues-consensys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joaorodrigues-consensys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-11T09:52:45Z",
    "updated_at": "2021-06-11T09:52:45Z",
    "author_association": "NONE",
    "body": "To give some context on our side, we are relying on kubernetes readiness probes to determine if beacon is ready or not.\r\nThe probes is just a simple HTTP GET request to `/eth/v1/node/health` that if returns other than [200, 400[ its marks it as not ready. We were also trying to make use of the query param `syncing_status` as recently introduced [here](https://github.com/ConsenSys/teku/commit/af6eea57d086c4eea44d9969df2426887bdcde76) to make the health endpoint send a 400 when syncing and mark the pod as not ready.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/859459888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/860295383",
    "html_url": "https://github.com/ConsenSys/teku/issues/4078#issuecomment-860295383",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4078",
    "id": 860295383,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDI5NTM4Mw==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-14T00:28:52Z",
    "updated_at": "2021-06-14T00:28:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Had a good look, and it's clear what the issue is.\n\nThe check is currently only returning that it's syncing when its got peers and performing sync, but that doesn't allow for the period before it has peers.\ncurrent behaviour for node health\ninitialisation: unavailable\npre-having peers: 200 (<- should really be 206)\nhave peers and syncing: 206\nin sync: 200\n\nI'm tweaking the logic so that when its starting up or syncing it'll return a 206 from node/health (or custom code if that's been set).\n\nOther impacts for this same logic are getting duties and posting blocks, which would currently potentially accept data or send duties while in startup mode.  This is similarly not great, so all of these scenarios will benefit from being turned off while not actually in an 'inSync' state.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/860295383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
