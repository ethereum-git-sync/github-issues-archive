{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7410",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7410/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7410/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7410/events",
  "html_url": "https://github.com/Consensys/teku/issues/7410",
  "id": 1833692381,
  "node_id": "I_kwDOCM9I9M5tS-zd",
  "number": 7410,
  "title": "validator_duties_performed{result=\"failed\"} metric does not report a failure when it actually fails onchain",
  "user": {
    "login": "ybstaked",
    "id": 85460995,
    "node_id": "MDQ6VXNlcjg1NDYwOTk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/85460995?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ybstaked",
    "html_url": "https://github.com/ybstaked",
    "followers_url": "https://api.github.com/users/ybstaked/followers",
    "following_url": "https://api.github.com/users/ybstaked/following{/other_user}",
    "gists_url": "https://api.github.com/users/ybstaked/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ybstaked/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ybstaked/subscriptions",
    "organizations_url": "https://api.github.com/users/ybstaked/orgs",
    "repos_url": "https://api.github.com/users/ybstaked/repos",
    "events_url": "https://api.github.com/users/ybstaked/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ybstaked/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-08-02T18:20:51Z",
  "updated_at": "2023-08-20T22:02:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Possibly related to #7382, maybe it doesn't report when signing fails due to inactive/exit keys.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7410/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7410/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1663057374",
    "html_url": "https://github.com/Consensys/teku/issues/7410#issuecomment-1663057374",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7410",
    "id": 1663057374,
    "node_id": "IC_kwDOCM9I9M5jID3e",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-02T22:33:12Z",
    "updated_at": "2023-08-02T22:33:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for raising.\n\nI think that metric is specifically relating to when the process of creating a specific duty failed...\n\nAre you looking for something like the Attestation performance data to be available via metrics, where you'd be able to see included count etc?\n\n#7382 should be somewhat unrelated to that 'failed', but I haven't looked closely. It sounds very much like the process we go through to determine if a validator is due to aggregate, which we need to sign a message to be able to determine due to how the process was designed...\nThe gap in that ticket (heavy assumption) is likely that we're signing for all keys we've loaded, rather than just actual active keys, because we're less aware than we could be about the state of the key we've been given...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1663057374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1664017521",
    "html_url": "https://github.com/Consensys/teku/issues/7410#issuecomment-1664017521",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7410",
    "id": 1664017521,
    "node_id": "IC_kwDOCM9I9M5jLuRx",
    "user": {
      "login": "ybstaked",
      "id": 85460995,
      "node_id": "MDQ6VXNlcjg1NDYwOTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85460995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ybstaked",
      "html_url": "https://github.com/ybstaked",
      "followers_url": "https://api.github.com/users/ybstaked/followers",
      "following_url": "https://api.github.com/users/ybstaked/following{/other_user}",
      "gists_url": "https://api.github.com/users/ybstaked/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ybstaked/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ybstaked/subscriptions",
      "organizations_url": "https://api.github.com/users/ybstaked/orgs",
      "repos_url": "https://api.github.com/users/ybstaked/repos",
      "events_url": "https://api.github.com/users/ybstaked/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ybstaked/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T13:48:01Z",
    "updated_at": "2023-08-03T13:48:01Z",
    "author_association": "NONE",
    "body": "What we are looking for is a way to measure and alert on failed attestations, i.e.: if no successful attestations after 20 minutes.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1664017521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1665221791",
    "html_url": "https://github.com/Consensys/teku/issues/7410#issuecomment-1665221791",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7410",
    "id": 1665221791,
    "node_id": "IC_kwDOCM9I9M5jQUSf",
    "user": {
      "login": "StefanBratanov",
      "id": 14827647,
      "node_id": "MDQ6VXNlcjE0ODI3NjQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StefanBratanov",
      "html_url": "https://github.com/StefanBratanov",
      "followers_url": "https://api.github.com/users/StefanBratanov/followers",
      "following_url": "https://api.github.com/users/StefanBratanov/following{/other_user}",
      "gists_url": "https://api.github.com/users/StefanBratanov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StefanBratanov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StefanBratanov/subscriptions",
      "organizations_url": "https://api.github.com/users/StefanBratanov/orgs",
      "repos_url": "https://api.github.com/users/StefanBratanov/repos",
      "events_url": "https://api.github.com/users/StefanBratanov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StefanBratanov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-04T08:31:48Z",
    "updated_at": "2023-08-04T08:32:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @ybstaked possibly following metrics can help. They are BN ones and are per epoch. Basically how they work is based on your subscribed attestation subnets, it determines how many attestations were expected from your validators, and then it determines how many were produced by your validators and included on the chain.\r\n\r\n\r\n```\r\n$ curl localhost:8008/metrics | grep -E validator_performance.*attestations\r\n\r\n# HELP validator_performance_produced_attestations Number of produced attestations\r\n# TYPE validator_performance_produced_attestations gauge\r\nvalidator_performance_produced_attestations 2.0\r\n# HELP validator_performance_expected_attestations Number of expected attestations\r\n# TYPE validator_performance_expected_attestations gauge\r\nvalidator_performance_expected_attestations 2.0\r\n# HELP validator_performance_included_attestations Number of included attestations\r\n# TYPE validator_performance_included_attestations gauge\r\nvalidator_performance_included_attestations 2.0\r\n```\r\n\r\nWe use it in our Teku detailed dashboard:\r\n\r\n![image](https://github.com/Consensys/teku/assets/14827647/301bb3b2-8dac-4aa3-a478-8611a27c3f35)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1665221791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1685407508",
    "html_url": "https://github.com/Consensys/teku/issues/7410#issuecomment-1685407508",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7410",
    "id": 1685407508,
    "node_id": "IC_kwDOCM9I9M5kdUcU",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-20T22:01:59Z",
    "updated_at": "2023-08-20T22:01:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @ybstaked - any thoughts on Stefans suggestion? It does offer basically what you're looking for...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1685407508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
