{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2869",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2869",
  "id": 712173234,
  "node_id": "MDU6SXNzdWU3MTIxNzMyMzQ=",
  "number": 2869,
  "title": "Teku can't access (write) to docker volume ",
  "user": {
    "login": "stefa2k",
    "id": 54934211,
    "node_id": "MDQ6VXNlcjU0OTM0MjEx",
    "avatar_url": "https://avatars.githubusercontent.com/u/54934211?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stefa2k",
    "html_url": "https://github.com/stefa2k",
    "followers_url": "https://api.github.com/users/stefa2k/followers",
    "following_url": "https://api.github.com/users/stefa2k/following{/other_user}",
    "gists_url": "https://api.github.com/users/stefa2k/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stefa2k/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stefa2k/subscriptions",
    "organizations_url": "https://api.github.com/users/stefa2k/orgs",
    "repos_url": "https://api.github.com/users/stefa2k/repos",
    "events_url": "https://api.github.com/users/stefa2k/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stefa2k/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug ðŸž",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2172542566,
      "node_id": "MDU6TGFiZWwyMTcyNTQyNTY2",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P3",
      "name": "P3",
      "color": "FFFF00",
      "default": false,
      "description": "Medium"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-09-30T18:26:03Z",
  "updated_at": "2020-10-28T03:35:36Z",
  "closed_at": "2020-10-28T03:35:36Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nI ran the docker image inside a [docker-compose setup](https://github.com/stefa2k/ethereum2-docker-compose/blob/7596edc55df2ef358fe04646d3c1118b64ff7a9b/docker-compose.yaml#L52) and teku throws an error:\r\n```\r\nUnable to create the path to store database files at /opt/teku/data/db\r\n```\r\n\r\nGot it fixed by adding\r\n```\r\nservices:\r\n  ...\r\n  teku_node:\r\n    ...\r\n    user: \"0:0\"\r\n    ...\r\n```\r\n\r\n### Acceptance Criteria\r\n* Using docker image without needing to specify `user` via `docker run` or `docker-compose up`\r\n\r\n### Steps to Reproduce (Bug)\r\n1. checkout [docker-compose](https://github.com/stefa2k/ethereum2-docker-compose/tree/7596edc55df2ef358fe04646d3c1118b64ff7a9b)\r\n2. run `docker-compose up teku_node`\r\n3. watch the log\r\n\r\n**Expected behavior:**\r\nNo error, no need to add `user`\r\n\r\n**Actual behavior:**\r\nEither error is thrown or need to add `user`\r\n\r\n**Frequency:**\r\nEvery time\r\n\r\n### Versions (Add all that apply)\r\n* OS Name & Version: Ubuntu 20.04\r\n* Kernel Version: Linux eth2-medalla-node-d 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n* Docker Version:\r\n```\r\nClient: Docker Engine - Community\r\n Version:           19.03.13\r\n API version:       1.40\r\n Go version:        go1.13.15\r\n Git commit:        4484c46d9d\r\n Built:             Wed Sep 16 17:02:36 2020\r\n OS/Arch:           linux/amd64\r\n Experimental:      false\r\n\r\nServer: Docker Engine - Community\r\n Engine:\r\n  Version:          19.03.13\r\n  API version:      1.40 (minimum version 1.12)\r\n  Go version:       go1.13.15\r\n  Git commit:       4484c46d9d\r\n  Built:            Wed Sep 16 17:01:06 2020\r\n  OS/Arch:          linux/amd64\r\n  Experimental:     false\r\n containerd:\r\n  Version:          1.3.7\r\n  GitCommit:        8fba4e9a7d01810a393d5d25a3621dc101981175\r\n runc:\r\n  Version:          1.0.0-rc10\r\n  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd\r\n docker-init:\r\n  Version:          0.18.0\r\n  GitCommit:        fec3683\r\n```\r\n\r\n### Additional Information\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2869/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/702247952",
    "html_url": "https://github.com/ConsenSys/teku/issues/2869#issuecomment-702247952",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869",
    "id": 702247952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjI0Nzk1Mg==",
    "user": {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T16:21:58Z",
    "updated_at": "2020-10-01T16:21:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting @stefa2k . We'll look into this and try to fix it as soon as possible.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/702247952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/702657858",
    "html_url": "https://github.com/ConsenSys/teku/issues/2869#issuecomment-702657858",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869",
    "id": 702657858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjY1Nzg1OA==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-02T10:37:26Z",
    "updated_at": "2020-10-02T10:37:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Just adding @ajsutton's comments from the Discord here:\r\n\r\n> Teku follows best security practice by not running as root, even within the docker container. That can lead to the kind of permissions issue you hit if the user running teku in the container (default UID 501 I think) differs from the user you are using outside the container. The best solution is to explicitly set the UID to use within the docker container so you know what teku is actually running as.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/702657858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/717674418",
    "html_url": "https://github.com/ConsenSys/teku/issues/2869#issuecomment-717674418",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2869",
    "id": 717674418,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzY3NDQxOA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-28T03:35:36Z",
    "updated_at": "2020-10-28T03:35:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to close this one.  It's security best practice to not run as root even within the docker container.  The downside is that this can create permissions issues for file mounts but specifying the UID to use when running the docker instance manages that and our docs already include a note to that effect.\n\nI would recommend using a non-root UID though and just changing the ownership of the files being mounted to that user.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/717674418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
