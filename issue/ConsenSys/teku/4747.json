{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4747",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4747/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4747/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4747/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4747",
  "id": 1071303127,
  "node_id": "I_kwDOCM9I9M4_2snX",
  "number": 4747,
  "title": "Incorrect slot value on head event?",
  "user": {
    "login": "mcdee",
    "id": 511384,
    "node_id": "MDQ6VXNlcjUxMTM4NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcdee",
    "html_url": "https://github.com/mcdee",
    "followers_url": "https://api.github.com/users/mcdee/followers",
    "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
    "organizations_url": "https://api.github.com/users/mcdee/orgs",
    "repos_url": "https://api.github.com/users/mcdee/repos",
    "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcdee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-12-04T21:55:44Z",
  "updated_at": "2021-12-20T22:17:40Z",
  "closed_at": "2021-12-20T22:17:40Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I have been investigating an issue where some blocks are received extremely late but a node, in to the following slot.  An example of this on mainnet is slot 2651855, which was received around 13 seconds after the start of its slot.  The following block, 2651856, was received around 500ms after the start of its slot, so notably _before_ the block for the prior slot.\r\n\r\nThe teku head events from the `/events` endpoint generated in this situation were:\r\n\r\n```\r\nevent:head\r\ndata:{\"slot\":\"2651856\",\"block\":\"0xbd76e4a6163720e526b8c44a249a2a4b663cae9074d8cc3f82689a38f1637d26\",\"state\":\"0x46f581ff0c92647dee09d513eb93aa4a75c8eb2149baab01770403b6229d910a\",\"epoch_transition\":false,\"previous_duty_dependent_root\":\"0x3f8becd864124efa4acede4fe461e028a1be0ff3d73d2bc0c27ecbf233fe1777\",\"current_duty_dependent_root\":\"0x8f35304bed23213ede76021b0847177f0f29387fa8baa0d8a8cab67c4120c4ba\"}\r\n\r\nevent:head\r\ndata:{\"slot\":\"2651856\",\"block\":\"0xffe1c9fef22e4f15eeac3e6c8756f261d18ab86733628f17148a4b504bdd1542\",\"state\":\"0xa582b8720a7cd5f13c4c0e5e28d1e0ea5db7902225cba08a21a4d503fb5b6518\",\"epoch_transition\":false,\"previous_duty_dependent_root\":\"0x3f8becd864124efa4acede4fe461e028a1be0ff3d73d2bc0c27ecbf233fe1777\",\"current_duty_dependent_root\":\"0x8f35304bed23213ede76021b0847177f0f29387fa8baa0d8a8cab67c4120c4ba\"}\r\n```\r\n\r\nAll of this data ties up with information from other nodes, except the `slot` number.  prysm and lighthouse show the slot number for the second event as `2651855`.\r\n\r\nNow, it could be argued that `slot` should be the slot of the chain, which appears to be what teku is showing, or that it should be the slot of the head block, which appears to be what prysm and lighthouse are showing.  Given that teku is currently in the minority I'm raising an issue here for discussion (but personally think that teku's use of slot is more accurate/useful).",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4747/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4747/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/986178568",
    "html_url": "https://github.com/ConsenSys/teku/issues/4747#issuecomment-986178568",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4747",
    "id": 986178568,
    "node_id": "IC_kwDOCM9I9M46x-QI",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-05T07:06:53Z",
    "updated_at": "2021-12-05T07:06:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah I'd say Teku is being weird here. We're reporting what we call the \"fork choice slot\" which is basically a vestige of the fact that, prior to dependentRoots being added to the API, Teku would consider a slot \"officially empty\" 4s into the slot and publish a reorg event if it was fill after that point. To do this, we track the latest slot that fork choice has selected the head for which is the \"fork choice slot\". \r\n\r\nI think reporting the block slot is more intuitive and likely safer in terms of ensuring that validator clients correctly identify when duties should be invalidated. So I'd say we need to fix Teku.  Someone receiving the event could always independently calculate the slot based on current time which is pretty much what Teku is reporting.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/986178568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/998312243",
    "html_url": "https://github.com/ConsenSys/teku/issues/4747#issuecomment-998312243",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4747",
    "id": 998312243,
    "node_id": "IC_kwDOCM9I9M47gQkz",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-20T22:17:40Z",
    "updated_at": "2021-12-20T22:17:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is resolved by #4749",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/998312243/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
