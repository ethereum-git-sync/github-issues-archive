{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4378",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4378/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4378/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4378/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4378",
  "id": 997991602,
  "node_id": "I_kwDOCM9I9M47fCSy",
  "number": 4378,
  "title": "teku intermittently reports \"Syncing completed\" twice",
  "user": {
    "login": "chrishobcroft",
    "id": 2212651,
    "node_id": "MDQ6VXNlcjIyMTI2NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212651?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chrishobcroft",
    "html_url": "https://github.com/chrishobcroft",
    "followers_url": "https://api.github.com/users/chrishobcroft/followers",
    "following_url": "https://api.github.com/users/chrishobcroft/following{/other_user}",
    "gists_url": "https://api.github.com/users/chrishobcroft/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chrishobcroft/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chrishobcroft/subscriptions",
    "organizations_url": "https://api.github.com/users/chrishobcroft/orgs",
    "repos_url": "https://api.github.com/users/chrishobcroft/repos",
    "events_url": "https://api.github.com/users/chrishobcroft/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chrishobcroft/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "regio",
    "id": 1396294,
    "node_id": "MDQ6VXNlcjEzOTYyOTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1396294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/regio",
    "html_url": "https://github.com/regio",
    "followers_url": "https://api.github.com/users/regio/followers",
    "following_url": "https://api.github.com/users/regio/following{/other_user}",
    "gists_url": "https://api.github.com/users/regio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/regio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/regio/subscriptions",
    "organizations_url": "https://api.github.com/users/regio/orgs",
    "repos_url": "https://api.github.com/users/regio/repos",
    "events_url": "https://api.github.com/users/regio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/regio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "regio",
      "id": 1396294,
      "node_id": "MDQ6VXNlcjEzOTYyOTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1396294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/regio",
      "html_url": "https://github.com/regio",
      "followers_url": "https://api.github.com/users/regio/followers",
      "following_url": "https://api.github.com/users/regio/following{/other_user}",
      "gists_url": "https://api.github.com/users/regio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/regio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/regio/subscriptions",
      "organizations_url": "https://api.github.com/users/regio/orgs",
      "repos_url": "https://api.github.com/users/regio/repos",
      "events_url": "https://api.github.com/users/regio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/regio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-09-16T09:30:57Z",
  "updated_at": "2021-10-26T03:55:37Z",
  "closed_at": "2021-10-26T03:55:37Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nWhen `teku` process booting up, the following was observed in the `stdout`:\r\n\r\n```\r\n08:10:14.382 INFO  - Syncing     *** Target slot: 2079649, Head slot: 2079638, Remaining slots: 11, Connected peers: 26\r\n08:10:16.592 INFO  - Syncing completed\r\n08:10:28.339 INFO  - Slot Event  *** Slot: 2079650, Block:    ... empty, Epoch: 64989, Finalized checkpoint: 64987, Finalized root: 54af7e..906e, Peers: 28\r\n08:10:29.499 INFO  - Syncing completed\r\n08:10:39.854 INFO  - Slot Event  *** Slot: 2079651, Block: 97019d..48ac, Epoch: 64989, Finalized checkpoint: 64987, Finalized root: 54af7e..906e, Peers: 25\r\n```\r\n\r\nNotice that \"Syncing completed\" was reported twice.\r\n\r\nThis may be a red herring, but also may expose lower-level synchronisation anomalies, i.e. either:\r\n\r\na) it *did* \"complete\" the first time - in which case why did it apparently continue syncing and report  and then report \"Syncing completed a second time, or\r\n\r\nb) if *didn't* completethe first time - in which case why did it report that it did complete.\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\n0. Empty the database and clear the logs\r\n1. Run `teku` with the following command, with no keys in `/var/lib/teku/validator_keys`:\r\n```\r\n\r\n```\r\n2. Observe the dual \"Syncing completed\" message.\r\n\r\n**Expected behavior:**\r\n\r\nI expect it to complete syncing once and once only.\r\n\r\n**Actual behavior:**\r\n\r\nIt reports that it completes syncing twice.\r\n\r\n**Frequency:**\r\n\r\nThis does not happen every time. So far, I have witnessed this happening 2 times, from 7 attempts.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 21.9.1\r\n* Java version: latest from `sudo apt install default-jre`\r\n* OS Name & Version: Ubuntu 20.04.3 LTS (Focal Fossa)\r\n* Cloud VM, type, size: Exoscale Medium 4 GB, 2 x 2198 MHz\r\n\r\n### Additional Information\r\n\r\nConsole output:\r\n\r\n```\r\nubuntu@VM-e4344a82-4ea5-4184-9759-ef5426b164e5:~$ sudo systemctl stop teku\r\nubuntu@VM-e4344a82-4ea5-4184-9759-ef5426b164e5:~$ sudo rm -rf /var/lib/teku/beacon/\r\nubuntu@VM-e4344a82-4ea5-4184-9759-ef5426b164e5:~$ sudo rm -rf /var/lib/teku/logs/\r\nubuntu@VM-e4344a82-4ea5-4184-9759-ef5426b164e5:~$ sudo systemctl start teku\r\nubuntu@VM-e4344a82-4ea5-4184-9759-ef5426b164e5:~$ sudo journalctl -fu teku.service\r\n-- Logs begin at Thu 2021-09-16 07:57:50 UTC. --\r\nSep 16 09:00:04 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18471]: 09:00:04.202 INFO  - Slot Event  *** Slot: 2079898, Block: 30485b..d24b, Epoch: 64996, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 3\r\nSep 16 09:00:09 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18471]: 09:00:09.489 WARN  - Request for eth1 deposit logs from 10000 blocks failed. Retrying with a smaller block range.\r\nSep 16 09:00:15 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18471]: 09:00:15.221 INFO  - Slot Event  *** Slot: 2079899, Block: 062d41..8574, Epoch: 64996, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 3\r\nSep 16 09:00:27 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18471]: 09:00:27.245 INFO  - Slot Event  *** Slot: 2079900, Block: 933ef3..65e7, Epoch: 64996, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 4\r\nSep 16 09:00:30 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 systemd[1]: Stopping Teku Eth2 Client...\r\nSep 16 09:00:30 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18471]: Teku is shutting down\r\nSep 16 09:00:33 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 systemd[1]: teku.service: Main process exited, code=exited, status=143/n/a\r\nSep 16 09:00:33 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 systemd[1]: teku.service: Failed with result 'exit-code'.\r\nSep 16 09:00:33 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 systemd[1]: Stopped Teku Eth2 Client.\r\nSep 16 09:00:51 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 systemd[1]: Started Teku Eth2 Client.\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 2021-09-16 09:00:54,104 main INFO Configuring logging for destination: console and file\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 2021-09-16 09:00:54,107 main INFO Logging file location: /var/lib/teku/logs/teku.log\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 2021-09-16 09:00:54,107 main INFO Logging includes events: true\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 2021-09-16 09:00:54,107 main INFO Logging includes validator duties: true\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 2021-09-16 09:00:54,108 main INFO Logging includes color: true\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 2021-09-16 09:00:54,201 main INFO Include P2P warnings set to: false\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:54.203 INFO  - Teku version: teku/v21.9.1/linux-x86_64/-ubuntu-openjdk64bitservervm-java-11\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:54.207 INFO  - This software is licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this software except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:54.299 INFO  - Loading 0 validator keys...\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:54.304 INFO  - Loaded 0 Validators:\r\nSep 16 09:00:54 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:54.687 INFO  - Storing beacon chain data in: /var/lib/teku/beacon\r\nSep 16 09:00:55 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:55.094 INFO  - Initializing storage\r\nSep 16 09:00:55 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:55.097 INFO  - Storage initialization complete\r\nSep 16 09:00:55 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:00:55.099 INFO  - Loading initial state from https://eth2-beacon-mainnet.infura.io/eth/v1/debug/beacon/states/finalized\r\nSep 16 09:01:02 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:02.007 INFO  - Loaded initial state at epoch 64994 (state root = 0x1cb067f4ca921a54f20780e281372d5875271dbfacd6250c0fe1cd30d7ea00d3, block root = 0xfdbb4e46b0a91dca404e9a363e0067b1b00e644271ea7877d22462620e004b8a, block slot = 2079808).  Please ensure that the supplied initial state corresponds to the latest finalized block as of the start of epoch 64994 (slot 2079808).\r\nSep 16 09:01:03 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:03.004 INFO  - Generated new p2p private key and storing in: generated-node-key\r\nSep 16 09:01:03 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:03.341 INFO  - PreGenesis Local ENR: enr:-Iu4QHTYqR4Mt_g25xG1sYb0UiPBBmc7yLBw5A-dxnOFezRlXEhdj7unJAqL2TRbjvTQauhjUwh-mJKqK2n021PP-RAChGV0aDKQ9aX9QgAAAAD__________4JpZIJ2NIlzZWNwMjU2azGhAvNABdMTXcEU7ad6UWlpSKd1WIWu1INRIQSGOaUX9Q1n\r\nSep 16 09:01:03 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:03.956 INFO  - Listening for connections on: /ip4/185.150.10.44/tcp/9000/p2p/16Uiu2HAmBoDfxtgsUFUrGoQY5pkWkD1hiVq2yYu8hr9TNg1wGCNa\r\nSep 16 09:01:04 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:04.377 INFO  - Local ENR: enr:-Iu4QAm5yBkuDt2kt9TWcjUHPizmBuSUJoXyR0oKOf6A0lwpSauheteUveLERN21coFVUkHTQI45FJmXGj6dkCQqDkMDhGV0aDKQtTA_KgAAAAD__________4JpZIJ2NIlzZWNwMjU2azGhAvNABdMTXcEU7ad6UWlpSKd1WIWu1INRIQSGOaUX9Q1n\r\nSep 16 09:01:04 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:04.669 INFO  - Slot Event  *** Slot: 2079903, Block:    ... empty, Epoch: 64996, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 0\r\nSep 16 09:01:11 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:11.499 INFO  - Epoch Event *** Epoch: 64997, Justified checkpoint: 64994, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a\r\nSep 16 09:01:15 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:15.497 INFO  - Slot Event  *** Slot: 2079904, Block:    ... empty, Epoch: 64997, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 0\r\nSep 16 09:01:27 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:27.496 INFO  - Slot Event  *** Slot: 2079905, Block:    ... empty, Epoch: 64997, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 0\r\nSep 16 09:01:39 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:39.496 INFO  - Slot Event  *** Slot: 2079906, Block:    ... empty, Epoch: 64997, Finalized checkpoint: 64994, Finalized root: fdbb4e..4b8a, Peers: 0\r\nSep 16 09:01:47 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:47.212 INFO  - Syncing started\r\nSep 16 09:01:47 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:01:47.515 INFO  - Syncing     *** Target slot: 2079907, Head slot: 2079808, Remaining slots: 99, Connected peers: 6\r\nSep 16 09:02:00 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:02:00.248 INFO  - Syncing     *** Target slot: 2079908, Head slot: 2079815, Remaining slots: 93, Connected peers: 19\r\nSep 16 09:02:11 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:02:11.654 INFO  - Syncing     *** Target slot: 2079909, Head slot: 2079824, Remaining slots: 85, Connected peers: 23\r\nSep 16 09:02:24 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:02:24.054 INFO  - Syncing     *** Target slot: 2079910, Head slot: 2079836, Remaining slots: 74, Connected peers: 19\r\nSep 16 09:02:35 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:02:35.500 INFO  - Syncing     *** Target slot: 2079911, Head slot: 2079840, Remaining slots: 71, Connected peers: 19\r\nSep 16 09:02:48 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:02:48.280 INFO  - Syncing     *** Target slot: 2079912, Head slot: 2079887, Remaining slots: 25, Connected peers: 26\r\nSep 16 09:02:56 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:02:56.015 INFO  - Syncing completed\r\nSep 16 09:03:04 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:03:04.478 INFO  - Slot Event  *** Slot: 2079913, Block: dd2b31..85c1, Epoch: 64997, Finalized checkpoint: 64995, Finalized root: 6dbe20..6ab5, Peers: 25\r\nSep 16 09:03:05 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:03:05.621 INFO  - Syncing completed\r\nSep 16 09:03:15 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:03:15.550 INFO  - Slot Event  *** Slot: 2079914, Block: a33621..6047, Epoch: 64997, Finalized checkpoint: 64995, Finalized root: 6dbe20..6ab5, Peers: 23\r\nSep 16 09:03:27 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:03:27.539 INFO  - Slot Event  *** Slot: 2079915, Block: 303b5e..5dfc, Epoch: 64997, Finalized checkpoint: 64995, Finalized root: 6dbe20..6ab5, Peers: 28\r\nSep 16 09:03:39 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:03:39.562 INFO  - Slot Event  *** Slot: 2079916, Block: 15d152..cd01, Epoch: 64997, Finalized checkpoint: 64995, Finalized root: 6dbe20..6ab5, Peers: 31\r\nSep 16 09:03:51 VM-e4344a82-4ea5-4184-9759-ef5426b164e5 teku[18898]: 09:03:51.549 INFO  - Slot Event  *** Slot: 2079917, Block: bdc1d2..def8, Epoch: 64997, Finalized checkpoint: 64995, Finalized root: 6dbe20..6ab5, Peers: 30\r\n```",
  "closed_by": {
    "login": "regio",
    "id": 1396294,
    "node_id": "MDQ6VXNlcjEzOTYyOTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1396294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/regio",
    "html_url": "https://github.com/regio",
    "followers_url": "https://api.github.com/users/regio/followers",
    "following_url": "https://api.github.com/users/regio/following{/other_user}",
    "gists_url": "https://api.github.com/users/regio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/regio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/regio/subscriptions",
    "organizations_url": "https://api.github.com/users/regio/orgs",
    "repos_url": "https://api.github.com/users/regio/repos",
    "events_url": "https://api.github.com/users/regio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/regio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4378/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4378/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
