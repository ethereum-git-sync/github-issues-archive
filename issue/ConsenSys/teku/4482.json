{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4482",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4482/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4482/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4482/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4482",
  "id": 1025793621,
  "node_id": "I_kwDOCM9I9M49JF5V",
  "number": 4482,
  "title": "0 peers after unexpected reboot",
  "user": {
    "login": "alby6969",
    "id": 73508748,
    "node_id": "MDQ6VXNlcjczNTA4NzQ4",
    "avatar_url": "https://avatars.githubusercontent.com/u/73508748?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alby6969",
    "html_url": "https://github.com/alby6969",
    "followers_url": "https://api.github.com/users/alby6969/followers",
    "following_url": "https://api.github.com/users/alby6969/following{/other_user}",
    "gists_url": "https://api.github.com/users/alby6969/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alby6969/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alby6969/subscriptions",
    "organizations_url": "https://api.github.com/users/alby6969/orgs",
    "repos_url": "https://api.github.com/users/alby6969/repos",
    "events_url": "https://api.github.com/users/alby6969/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alby6969/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-10-13T23:58:31Z",
  "updated_at": "2021-10-18T00:26:33Z",
  "closed_at": "2021-10-18T00:26:33Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nRunning Teku and Geth on my intel NUC i7 64G RAM 2TB NVME SSD - I do not know if there was a power outage or what, as my server is remote. The logs say there was a reboot at around Oct 13 19:34:03 . I got alerted to missed attestations when i woke up for maybe 1.5 hours. I logged in, updated Ubuntu with 5 updates and rebooted, and it picked up peers as normal again, this was at approx Oct 13 20:55\r\n\r\n### Steps to Reproduce (Bug)\r\nN/A - Has only happened once\r\n\r\n**Expected behavior:** After unexpected reboot, expected Teku to automatically pick up peers, but stayed 0 until a manual reboot\r\n\r\n**Actual behavior:** After unexpected reboot, Teku peers stayed 0\r\n\r\n**Frequency:** Happened only once\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 21.9.2\r\n* Java version: \"11.0.11\" 2021-04-20\r\n* OS Name & Version: \r\nDISTRIB_ID=Ubuntu\r\nDISTRIB_RELEASE=20.04\r\nDISTRIB_CODENAME=focal\r\nDISTRIB_DESCRIPTION=\"Ubuntu 20.04.3 LTS\"\r\nNAME=\"Ubuntu\"\r\nVERSION=\"20.04.3 LTS (Focal Fossa)\"\r\n\r\n* Kernel Version: Linux eth 5.4.0-88-generic #99-Ubuntu SMP Thu Sep 23 17:29:00 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n* Virtual Machine software & version: N/A\r\n* Docker Version: N/A\r\n* Cloud VM, type, size: N/A\r\n\r\n### Additional Information\r\n\r\nI have attached the Geth and Teku logs, starting from right before the unexpected reboot at approx Oct 13 19:34:03 . \r\n\r\nThe reboot at Oct 13 20:55 , was done by myself over ssh in order to pick up peers again\r\n[tekulog.txt](https://github.com/ConsenSys/teku/files/7341973/tekulog.txt)\r\n[gethlog.txt](https://github.com/ConsenSys/teku/files/7341974/gethlog.txt)\r\n\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4482/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4482/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/945226440",
    "html_url": "https://github.com/ConsenSys/teku/issues/4482#issuecomment-945226440",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4482",
    "id": 945226440,
    "node_id": "IC_kwDOCM9I9M44VwLI",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-18T00:19:11Z",
    "updated_at": "2021-10-18T00:19:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "For the record, I think what's happening with your server is that the server and Teku start up before network connectivity is actually available.  That's quite unusual but certainly possible with some virtualisation and software defined network setups. It may also be that the external IP changes just after teku starts up which would have the same effect.  The attempt to do a discovery handshake with the bootnodes fails because the network isn't available initially and because that first failed handshake attempt didn't get cleaned up properly after failing future attempts to contact the bootnodes also failed so it was impossible to find peers even once the network came back up.\r\n\r\n#4490 is a simple work around for this that was included in 21.10.0 release and #4497 fixes the actual underlying problem in the discovery library that will be included in the next release.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/945226440/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
