{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2910",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2910",
  "id": 716821025,
  "node_id": "MDU6SXNzdWU3MTY4MjEwMjU=",
  "number": 2910,
  "title": "Zinken: Restarting beacon complains about existing lock file",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug üêû",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2172541810,
      "node_id": "MDU6TGFiZWwyMTcyNTQxODEw",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P2",
      "name": "P2",
      "color": "FFA500",
      "default": false,
      "description": "High"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cemozerr",
    "id": 16581242,
    "node_id": "MDQ6VXNlcjE2NTgxMjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cemozerr",
    "html_url": "https://github.com/cemozerr",
    "followers_url": "https://api.github.com/users/cemozerr/followers",
    "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
    "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
    "organizations_url": "https://api.github.com/users/cemozerr/orgs",
    "repos_url": "https://api.github.com/users/cemozerr/repos",
    "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cemozerr/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-07T20:14:20Z",
  "updated_at": "2020-10-09T20:36:44Z",
  "closed_at": "2020-10-09T20:36:44Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Zinken before genesis state has been calculated. A lock file is created; stopping and restarting the beacon will have the beacon exit because of the existing lock file. This is the lock file for avoiding running two validators on the same key, I believe,\r\n\r\n```\r\nyorick@ethlinux:~/eth2-zinken-teku$ docker-compose down\r\nStopping eth2-zinken-teku_geth_1 ... done\r\nRemoving eth2-zinken-teku_geth_1 ... done\r\nRemoving network eth2-zinken-teku_default\r\nyorick@ethlinux:~/eth2-zinken-teku$ docker-compose up -d eth2\r\nCreating network \"eth2-zinken-teku_default\" with the default driver\r\nCreating eth2-zinken-teku_geth_1 ... done\r\nCreating eth2-zinken-teku_beacon_1 ... done\r\nCreating eth2-zinken-teku_eth2_1   ... done\r\nyorick@ethlinux:~/eth2-zinken-teku$ docker-compose logs -f beacon\r\nAttaching to eth2-zinken-teku_beacon_1\r\nbeacon_1            | 2020-10-07 20:11:47,631 main INFO Setting logging level to INFO\r\nbeacon_1            | 2020-10-07 20:11:48,478 main INFO Configuring logging for destination: console\r\nbeacon_1            | 2020-10-07 20:11:48,479 main INFO Logging includes events: true\r\nbeacon_1            | 2020-10-07 20:11:48,480 main INFO Logging includes validator duties: true\r\nbeacon_1            | 2020-10-07 20:11:48,487 main INFO Logging includes color: true\r\nbeacon_1            | 20:11:48.530 INFO  - Teku version: teku/v0.12.10-dev-f8fbf9fa/linux-x86_64/oracle_openjdk-java-14\r\nbeacon_1            | 20:11:49.735 INFO  - Loading 1 validator keys...\r\nbeacon_1            | Keystore file /var/lib/teku/validator-keys/keystore-m_12381_3600_2_0_0-1601727363.json.lock already in use.\r\nbeacon_1            |\r\nbeacon_1            | To display full help:\r\nbeacon_1            | teku [COMMAND] --help\r\neth2-zinken-teku_beacon_1 exited with code 1\r\n```\r\n",
  "closed_by": {
    "login": "cemozerr",
    "id": 16581242,
    "node_id": "MDQ6VXNlcjE2NTgxMjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cemozerr",
    "html_url": "https://github.com/cemozerr",
    "followers_url": "https://api.github.com/users/cemozerr/followers",
    "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
    "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
    "organizations_url": "https://api.github.com/users/cemozerr/orgs",
    "repos_url": "https://api.github.com/users/cemozerr/repos",
    "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cemozerr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2910/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705222125",
    "html_url": "https://github.com/ConsenSys/teku/issues/2910#issuecomment-705222125",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910",
    "id": 705222125,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTIyMjEyNQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T22:15:40Z",
    "updated_at": "2020-10-07T22:15:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting this, we'll need to investigate further, but it looks like Docker has terminated the teku process without giving it a chance to release lock files.\r\n\r\nYou can disable the use of lock files with `--validators-keystore-locking-enabled false` as a temporary work around.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705222125/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705227864",
    "html_url": "https://github.com/ConsenSys/teku/issues/2910#issuecomment-705227864",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910",
    "id": 705227864,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTIyNzg2NA==",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T22:32:13Z",
    "updated_at": "2020-10-07T22:32:13Z",
    "author_association": "NONE",
    "body": "Looking at what docker-compose does, it's possible the beacon exited abnormally, and this ended up NOT being a regular restart thereby.\r\n\r\nI have since restarted teku a few times, and it did not exhibit this behavior.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/705227864/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/706391097",
    "html_url": "https://github.com/ConsenSys/teku/issues/2910#issuecomment-706391097",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2910",
    "id": 706391097,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjM5MTA5Nw==",
    "user": {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T20:36:44Z",
    "updated_at": "2020-10-09T20:36:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @yorickdowne, we've looked into this issue, and we were only able to reproduce this scenario when the container running Teku was killed. \r\n\r\nInside the docker container, Teku does not have access to the process PID. This means that Teku can't save its process PID into the lock file. So if it's killed abruptly, (like when the docker container is killed) it can't delete the lock file. Later on during restart, since it does not have the process PID in the lockfile, it can't clean up the lockfile. Thus, it hits this issue.\r\n\r\nWith normal stops and restarts to the container, cleaning the lock file is not an issue. Thus I'm closing this ticket. Let us know if you have other issues!",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/706391097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
