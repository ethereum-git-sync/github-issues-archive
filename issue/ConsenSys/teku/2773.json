{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2773",
  "id": 697190662,
  "node_id": "MDU6SXNzdWU2OTcxOTA2NjI=",
  "number": 2773,
  "title": "Chain reorg on every block during sync",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug üêû",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2172542566,
      "node_id": "MDU6TGFiZWwyMTcyNTQyNTY2",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P3",
      "name": "P3",
      "color": "FFFF00",
      "default": false,
      "description": "Medium"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Nashatyrev",
    "id": 8173857,
    "node_id": "MDQ6VXNlcjgxNzM4NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Nashatyrev",
    "html_url": "https://github.com/Nashatyrev",
    "followers_url": "https://api.github.com/users/Nashatyrev/followers",
    "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
    "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
    "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
    "repos_url": "https://api.github.com/users/Nashatyrev/repos",
    "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2020-09-09T22:04:43Z",
  "updated_at": "2020-10-22T21:12:57Z",
  "closed_at": "2020-10-22T21:12:57Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\nTeku is printing a chain reorg on every imported block during sync:\n```\n\n2020-09-10 08:03:17.747 | beaconchain-async-7       | INFO  | RecentChainData                | Chain reorg from ebe498..660c (261915) to 4f042e..da16 (261915). Common ancestor at slot 0\n2020-09-10 08:03:17.817 | beaconchain-async-8       | INFO  | RecentChainData                | Chain reorg from 4f042e..da16 (261915) to 21dd54..ddab (261915). Common ancestor at slot 1\n2020-09-10 08:03:17.887 | beaconchain-async-7       | INFO  | RecentChainData                | Chain reorg from 21dd54..ddab (261915) to 35b622..1cad (261915). Common ancestor at slot 3\n2020-09-10 08:03:17.956 | beaconchain-async-10      | INFO  | RecentChainData                | Chain reorg from 35b622..1cad (261915) to a24292..d7f7 (261915). Common ancestor at slot 4\n2020-09-10 08:03:18.011 | beaconchain-async-1       | INFO  | RecentChainData                | Chain reorg from a24292..d7f7 (261915) to d346e6..10cb (261915). Common ancestor at slot 5\n2020-09-10 08:03:18.055 | beaconchain-async-9       | INFO  | RecentChainData                | Chain reorg from d346e6..10cb (261915) to 3f1b68..2ce1 (261915). Common ancestor at slot 6\n2020-09-10 08:03:18.079 | beaconchain-async-11      | INFO  | RecentChainData                | Chain reorg from 3f1b68..2ce1 (261915) to 76262e..fc76 (261915). Common ancestor at slot 7\n2020-09-10 08:03:18.194 | beaconchain-async-3       | INFO  | RecentChainData                | Chain reorg from 76262e..fc76 (261915) to 6f88ad..ebbd (261915). Common ancestor at slot 8\n2020-09-10 08:03:18.267 | beaconchain-async-2       | INFO  | RecentChainData                | Chain reorg from 6f88ad..ebbd (261915) to 9a2fef..4eaf (261915). Common ancestor at slot 9\n2020-09-10 08:03:18.371 | beaconchain-async-4       | INFO  | RecentChainData                | Chain reorg from 9a2fef..4eaf (261915) to 97b939..f54c (261915). Common ancestor at slot 10\n2020-09-10 08:03:18.455 | beaconchain-async-6       | INFO  | RecentChainData                | Chain reorg from 97b939..f54c (261915) to 8f1817..371a (261915). Common ancestor at slot 11\n2020-09-10 08:03:18.541 | beaconchain-async-9       | INFO  | RecentChainData                | Chain reorg from 8f1817..371a (261915) to eca78a..1a22 (261915). Common ancestor at slot 12\n```\n\nWe need to find a way to be smarter about this.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2773/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690035995",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690035995",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690035995,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDAzNTk5NQ==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T07:06:44Z",
    "updated_at": "2020-09-10T07:06:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Do you have any ideas which PR made this regression? I believe everything was fine recently",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690035995/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690058931",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690058931",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690058931,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA1ODkzMQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T07:50:46Z",
    "updated_at": "2020-09-10T07:50:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah there's a couple - https://github.com/PegaSysEng/teku/pull/2769 is the key one but fixes an important bug where we missed reorgs and so wound up not recalculating validator duties when we should have.\r\n#2637 is what started it but significantly improves attestation inclusion rates.\r\n\r\nhttps://github.com/PegaSysEng/teku/pull/2670 would fix it but is a bit heavy handed and would lead to attestations that point to and old head in some cases.  Not a bad option as a quick fix though.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690058931/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690069601",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690069601",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690069601,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA2OTYwMQ==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T08:10:33Z",
    "updated_at": "2020-09-10T08:10:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm actually not sure why this case is treated as 'reorg':\r\n\r\nOriginal head: \r\n```\r\nforkChoiceSlot = 264740\r\nblock = BeaconBlock{root=0xdf44...5631, slot=260735, parent_root=0x6844...586e, state_root=0x89cf....f524, ...}\r\nstate = BeaconStateImpl{slot=260735, latest_block_header=BeaconBlockHeader{slot=260735}}\r\n```\r\n\r\nNew head: \r\n```\r\nforkChoiceSlot = 264740\r\nblock = BeaconBlock{root=0x036e...7b5f, slot=260737, parent_root=0xdf44....5631, state_root=0x6f0d...c41f}\r\nstate = BeaconStateImpl{slot=260737, latest_block_header=BeaconBlockHeader{slot=260737}}\r\n```\r\n\r\n```java\r\n  /** @return The slot at which the chain head was calculated */\r\n  public UInt64 getForkChoiceSlot() {\r\n```\r\n\r\nI.e. the `forkChoiceSlot` has nothing with our head as we didn't recalculate the state for the slot `264740`. The slot `264740` is just like a 'timestamp' for a `ChainHead` right?  The actual head is on the slot `260737` with the state for the slot `260737`\r\n\r\nI'm not a big expert here so may say something irrelevant ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690069601/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690076841",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690076841",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690076841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA3Njg0MQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T08:23:47Z",
    "updated_at": "2020-09-10T08:23:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's a reorg because slots that we've processed have gone from empty to filled. The validator may have calculated duties based on those slots being empty and it needs to know to recalculate them because of the new blocks. \n\nWhen we're syncing that far back we don't really need to be updating the chain head on every block anyway so could just skip that. There's a few options but none that feel like a perfect answer. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690076841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690076947",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690076947",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690076947,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA3Njk0Nw==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T08:23:59Z",
    "updated_at": "2020-09-10T08:25:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Do I get it right, when we are tracking chain head (we used to call it 'short sync') and a couple of slots without blocks are passed: \r\n```\r\n(slot-100) --> (slot-101) --> (slot-102)\r\nblock-100\r\n```\r\nwe would have the `ChainHead`:\r\n```\r\nforkChoiceSlot = 102\r\nblock = BeaconBlock{slot=100}\r\nstate = BeaconState{slot=102}\r\n```\r\nAnd when the (late) `block-101` is imported \r\n```\r\n(slot-100) --> (slot-101) --> (slot-102)\r\nblock-100      block-101\r\n```\r\nthere is indeed a reorg to the head\r\n```\r\nforkChoiceSlot = 102\r\nblock = BeaconBlock{slot=101}\r\nstate = BeaconState{slot=102}\r\n```\r\nBut that's not because of `forkChoiceSlot = 102` but because of  `state = BeaconState{slot=102}`. \r\nDoes it makes sense ?\r\nOr am I missing something here? ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690076947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690079068",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690079068",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690079068,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA3OTA2OA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T08:27:54Z",
    "updated_at": "2020-09-10T08:27:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, or do we always have `state slot == block slot` in the `ChainHead` ?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690079068/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690079396",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690079396",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690079396,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA3OTM5Ng==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T08:28:29Z",
    "updated_at": "2020-09-10T08:28:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "The state is at the same slot as the block. Otherwise during sync we'd have to process all those empty slots. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690079396/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690085838",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690085838",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690085838,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDA4NTgzOA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T08:40:43Z",
    "updated_at": "2020-09-10T08:40:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh got it üëç \r\nWe just made this differently in Harmony so I was confused a bit ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690085838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690266365",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690266365",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690266365,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDI2NjM2NQ==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T12:55:22Z",
    "updated_at": "2020-09-10T12:55:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Then strictly speaking this is indeed a chain reorg. Even if the current slot is `1 000 000` and we just imported a block `#1` ü§î \r\nIt's clear that nobody is going to calculate the actual State for that slot but where is the boundary should be? \r\n\r\n> When we're syncing that far back we don't really need to be updating the chain head on every block anyway so could just skip that\r\n\r\nHm, honestly I'm scary to disable updating the chain head, I thought this is something central which many components rely on. \r\nMay be we could disable reorg tracking until sync state is `IN_SYNC`? ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690266365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690273040",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690273040",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690273040,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDI3MzA0MA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T13:05:08Z",
    "updated_at": "2020-09-10T13:05:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "BTW do we have any project wide notion of 'long/short sync'? I found something similar in `ValidatorApiHandler.isSyncActive()`:\r\n```java\r\n  boolean isSyncActive() {\r\n    final SyncState syncState = syncStateTracker.getCurrentSyncState();\r\n    return syncState.isStartingUp() || (syncState.isSyncing() && headBlockIsTooFarBehind());\r\n  }\r\n```\r\nWould be good for example to disable reorg tracking while in 'long sync`",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690273040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690329641",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690329641",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690329641,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDMyOTY0MQ==",
    "user": {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T14:32:45Z",
    "updated_at": "2020-09-10T14:32:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "> BTW do we have any project wide notion of 'long/short sync'?\r\n\r\nNot currently, but `SyncStateTracker` would probably be the place to add the logic for this.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690329641/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690719737",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-690719737",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 690719737,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MDcxOTczNw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-10T20:50:11Z",
    "updated_at": "2020-09-10T20:50:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Hm, honestly I'm scary to disable updating the chain head, I thought this is something central which many components rely on.\r\n\r\nThe updating chain head immediately after importing a block is actually quite a new addition.  Previously we only updated the chain head when running the full fork choice process once per slot.  I'm thinking the quick win is to go back to that.\r\n\r\n> BTW do we have any project wide notion of 'long/short sync'?\r\n\r\nYeah typically we're either in sync or not but in this case I don't think it matters where we are relative to other peers, only where we are relative to our node head (ie current time) because that's all the validator client will actually care about and it's the only thing that reacts to blocks being imported and needs a fully updated chain head. Everything else is fine with head being updated once per slot.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/690719737/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/692166970",
    "html_url": "https://github.com/ConsenSys/teku/issues/2773#issuecomment-692166970",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2773",
    "id": 692166970,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjE2Njk3MA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T16:24:41Z",
    "updated_at": "2020-09-14T16:24:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Doesn't look like P2 now so reducing priority ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/692166970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
