{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7714",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7714/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7714/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7714/events",
  "html_url": "https://github.com/Consensys/teku/issues/7714",
  "id": 1995399479,
  "node_id": "I_kwDOCM9I9M5272E3",
  "number": 7714,
  "title": "I think teku doesn't submit voluntary exits when node is not in sync?",
  "user": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-11-15T19:26:31Z",
  "updated_at": "2023-12-03T21:00:30Z",
  "closed_at": "2023-12-03T21:00:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": null,
  "closed_by": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7714/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7714/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1817986930",
    "html_url": "https://github.com/Consensys/teku/issues/7714#issuecomment-1817986930",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7714",
    "id": 1817986930,
    "node_id": "IC_kwDOCM9I9M5sXEdy",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-19T21:43:42Z",
    "updated_at": "2023-11-19T21:46:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for raising, this does sound feasible, a lot of the APIs don't interact well when not in sync. We'll have a look and see if we can improve things on this front...\n\nAs an aside, it's 'safe' to submit voluntary exits more than once. Much like bls changes, there's no guarantees they make it through to a block (depends on a block producer seeing the message and retaining it) and also no penalty if it's already been seen.\n\nYou can see if it's in your local pool by querying the endpoint:\n\n`curl http://localhost:5051/eth/v1/beacon/pool/voluntary_exits | jq`\n\nThis would list any voluntary exits that have been seen and not subsequently been listed in a block (it'll clear on a restart though).\n\nAnother 'caveat' is if you submit and then restart your node, you'll probably want to periodically resubmit the exit if it hasn't been included into a block in a reasonable (a couple of hours usually) timeframe.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1817986930/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1837598775",
    "html_url": "https://github.com/Consensys/teku/issues/7714#issuecomment-1837598775",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7714",
    "id": 1837598775,
    "node_id": "IC_kwDOCM9I9M5th4g3",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-03T21:00:22Z",
    "updated_at": "2023-12-03T21:00:22Z",
    "author_association": "MEMBER",
    "body": "After looking around the code and doing some testing, I can confirm that Teku does not prevent a user from submitting a voluntary exit while the node is out of sync. However, there are a few scenarios in which the user might not be able to submit the exit when out of sync. Let me try to explain.\r\n\r\nSome of the [consensus spec validation rules for voluntary exit messages](https://github.com/ethereum/consensus-specs/blob/dev/specs/phase0/beacon-chain.md#voluntary-exits) are \"state dependent\". That means that they depend on what your node sees as the current beacon state (for example: checking if you are trying to create a voluntary exit for a validator that is active).\r\n\r\nThink of this extreme example: trying to start a new node from genesis and sending a voluntary exit for my validator. Because you are syncing from genesis, it is possible that your beacon state doesn't even know that you have a validator active. So if you try to submit a voluntary exit it is going to fail. Again, the problem isn't the fact that your node is out of sync, but that your current state results in a invalid voluntary exit.\r\n\r\nNow for the question: how to exit a validator if I don't have a sync'd beacon node. You have two options:\r\n1. Start a new Teku node using [checkpoint sync](https://docs.teku.consensys.io/reference/cli#checkpoint-sync-url). This will get you a sync'd node quickly, and then you can submit your exit.\r\n2. Use a service like signed message propagation from Beaconcha.in (https://beaconcha.in/tools/broadcast) to submit an signed voluntary exit in the network w/o the need you running a beacon node.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1837598775/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
