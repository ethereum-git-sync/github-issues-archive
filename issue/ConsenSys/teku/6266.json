{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6266",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6266/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6266/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6266/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6266",
  "id": 1392252873,
  "node_id": "I_kwDOCM9I9M5S_BfJ",
  "number": 6266,
  "title": "Avoid unnecessary and wrong `FcU` calls when proposing blocks under certain conditions",
  "user": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-09-30T10:50:29Z",
  "updated_at": "2022-10-04T06:56:08Z",
  "closed_at": "2022-10-04T06:56:08Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "```\r\n2022-09-29 16:43:16.157 DEBUG - internalAttestationsDue slot 3996816\r\n2022-09-29 16:43:16.157 DEBUG - updatePayloadAttributes blockSlot 3996817\r\n2022-09-29 16:43:16.157 DEBUG - send - already sent\r\n2022-09-29 16:43:24.050 DEBUG - internalForkChoiceUpdated forkChoiceState ForkChoiceState{headBlockRoot=0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf, headBlockSlot=3996816, headExecutionBlockHash=0xf0981c1ba4895a6a78b5363882ff65b97699eea795ea81629dba65a179526a19, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}\r\n2022-09-29 16:43:24.050 DEBUG - internalForkChoiceUpdated forkChoiceUpdateData ForkChoiceUpdateData{forkChoiceState=ForkChoiceState{headBlockRoot=0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf, headBlockSlot=3996816, headExecutionBlockHash=0xf0981c1ba4895a6a78b5363882ff65b97699eea795ea81629dba65a179526a19, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, payloadBuildingAttributes=Optional[PayloadBuildingAttributes{timestamp=1664469804, prevRandao=0x3db9a7dbb9a44489caf172f349165dccad0d37931cb40c8e799479ad3ebc69cb, feeRecipient=0xd23D393167e391e62d464CD5ef09e52Ed58BC889, validatorRegistration=Optional.empty}], terminalBlockHash=Optional.empty, executionPayloadContext=tech.pegasys.teku.infrastructure.async.SafeFuture@5ba95f57[Completed normally]}\r\n2022-09-29 16:43:24.050 DEBUG - updatePayloadAttributes blockSlot 3996818\r\n2022-09-29 16:43:24.050 DEBUG - send - calling forkChoiceUpdated(ForkChoiceState{headBlockRoot=0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf, headBlockSlot=3996816, headExecutionBlockHash=0xf0981c1ba4895a6a78b5363882ff65b97699eea795ea81629dba65a179526a19, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, Optional.empty)\r\n2022-09-29 16:43:24.050 DEBUG - send - already sent\r\n2022-09-29 16:43:24.055 DEBUG - send - forkChoiceUpdated returned payload id Optional.empty for ForkChoiceState{headBlockRoot=0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf, headBlockSlot=3996816, headExecutionBlockHash=0xf0981c1ba4895a6a78b5363882ff65b97699eea795ea81629dba65a179526a19, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, Optional.empty\r\n2022-09-29 16:43:24.136 DEBUG - internalGetPayloadId parentBeaconBlockRoot 0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf blockSlot 3996817\r\n2022-09-29 16:43:24.136 DEBUG - isPayloadIdSuitable - payloadAttributes.isEmpty returning false\r\n2022-09-29 16:43:24.136 DEBUG - send - calling forkChoiceUpdated(ForkChoiceState{headBlockRoot=0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf, headBlockSlot=3996816, headExecutionBlockHash=0xf0981c1ba4895a6a78b5363882ff65b97699eea795ea81629dba65a179526a19, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, Optional[PayloadBuildingAttributes{timestamp=1664469804, prevRandao=0x3db9a7dbb9a44489caf172f349165dccad0d37931cb40c8e799479ad3ebc69cb, feeRecipient=0xd23D393167e391e62d464CD5ef09e52Ed58BC889, validatorRegistration=Optional.empty}])\r\n2022-09-29 16:43:24.141 DEBUG - send - forkChoiceUpdated returned payload id Optional[0x00669762af732cd4] for ForkChoiceState{headBlockRoot=0xfafbd85029f54b7d618d1ad40c168731861b8e3d958f64748bc5a327bb7a7baf, headBlockSlot=3996816, headExecutionBlockHash=0xf0981c1ba4895a6a78b5363882ff65b97699eea795ea81629dba65a179526a19, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, Optional[PayloadBuildingAttributes{timestamp=1664469804, prevRandao=0x3db9a7dbb9a44489caf172f349165dccad0d37931cb40c8e799479ad3ebc69cb, feeRecipient=0xd23D393167e391e62d464CD5ef09e52Ed58BC889, validatorRegistration=Optional.empty}]\r\n2022-09-29 16:43:24.142 WARN  - Builder endpoint is available but a non-blinded block has been requested\r\n2022-09-29 16:43:24.454 DEBUG - internalForkChoiceUpdated forkChoiceState ForkChoiceState{headBlockRoot=0xcb78f7a65de73b493dde47f7dce2507923aeb775ed3a6904c517c0f0caf2b82e, headBlockSlot=3996817, headExecutionBlockHash=0x8aad68b7c0db1cd8fa29c6a52997a603bbda4d5651eb0021a1b901facb710c1a, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}\r\n2022-09-29 16:43:24.454 DEBUG - internalForkChoiceUpdated forkChoiceUpdateData ForkChoiceUpdateData{forkChoiceState=ForkChoiceState{headBlockRoot=0xcb78f7a65de73b493dde47f7dce2507923aeb775ed3a6904c517c0f0caf2b82e, headBlockSlot=3996817, headExecutionBlockHash=0x8aad68b7c0db1cd8fa29c6a52997a603bbda4d5651eb0021a1b901facb710c1a, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, payloadBuildingAttributes=Optional.empty, terminalBlockHash=Optional.empty, executionPayloadContext=tech.pegasys.teku.infrastructure.async.SafeFuture@5a2735e3[Not completed]}\r\n2022-09-29 16:43:24.454 DEBUG - updatePayloadAttributes blockSlot 3996818\r\n2022-09-29 16:43:24.454 DEBUG - send - calling forkChoiceUpdated(ForkChoiceState{headBlockRoot=0xcb78f7a65de73b493dde47f7dce2507923aeb775ed3a6904c517c0f0caf2b82e, headBlockSlot=3996817, headExecutionBlockHash=0x8aad68b7c0db1cd8fa29c6a52997a603bbda4d5651eb0021a1b901facb710c1a, safeExecutionBlockHash=0x3cc3e2d8984d233f727ac9dd63af99783891147e30fd9494452de9bc3b208cf8, finalizedExecutionBlockHash=0xc515266e852939c051203bed9b9fe1e167806dee36f8e99ae6c604c2d247ec9d, isHeadOptimistic=false}, Optional.empty)\r\n2022-09-29 16:43:24.454 DEBUG - send - already sent\r\n16:43:24.465 INFO  - Validator   *** Published block              Count: 1, Slot: 3996817, Root: cb78f7a65de73b493dde47f7dce2507923aeb775ed3a6904c517c0f0caf2b82e, 6926216 (23%) gas, EL block:  8aad68b7c0db1cd8fa29c6a52997a603bbda4d5651eb0021a1b901facb710c1a (7681458)\r\n```\r\n\r\nWhen proposing blocks with separated VC and BN, it may occur that `createUnsignedBlock` is called with enough delay to cause `prepareForBlockProduction` to trigger an `FcU` with attributes calculate for the next slot, not the current one.",
  "closed_by": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6266/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6266/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
