{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7822",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7822/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7822/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7822/events",
  "html_url": "https://github.com/Consensys/teku/issues/7822",
  "id": 2039297537,
  "node_id": "I_kwDOCM9I9M55jTYB",
  "number": 7822,
  "title": "23.12.0 cannot sync Holesky from genesis",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-12-13T09:26:59Z",
  "updated_at": "2023-12-15T10:58:03Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nAttempting to sync Holesky from genesis with `--ignore-weak-subjectivity-period-enabled=true` will nonetheless load a checkpoint. I believe this makes it impossible to use Teku as an archive node on Holesky.\r\n\r\nOn mainnet, it does not show this behavior.\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\nRun without `--checkpoint-sync-url` and with `--ignore-weak-subjectivity-period-enabled=true` on Holesky\r\n\r\nLogs:\r\n```\r\neth-docker-devel-consensus-1  | 2023-12-13 09:24:25.485 INFO  - Initializing storage\r\neth-docker-devel-consensus-1  | 2023-12-13 09:24:25.493 INFO  - Storage initialization complete\r\neth-docker-devel-consensus-1  | 2023-12-13 09:24:25.495 WARN  - Ignoring weak subjectivity period check (--ignore-weak-subjectivity-period-enabled). Syncing from outside of the weak subjectivity period is considered UNSAFE.\r\neth-docker-devel-consensus-1  | 2023-12-13 09:24:25.497 INFO  - Loading initial state from https://checkpoint-sync.holesky.ethpandaops.io/eth/v2/debug/beacon/states/finalized\r\neth-docker-devel-consensus-1  | 2023-12-13 09:24:54.706 INFO  - Loaded initial state at epoch 17073 (state root = 0x30d76b13a970d8dbc31f64b2e45452e74ca9a4ef4a89933c6a92bd93a59f5980, block root = 0x835305d6f02a0c1ab069f9d7a845c8a547c543ca03d819ed86a85831c069fa36, block slot = 546336).  Please ensure that the supplied initial state corresponds to the latest finalized block as of the start of epoch 17073 (slot 546336).\r\n```\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 23.12.0\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7822/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7822/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1854772191",
    "html_url": "https://github.com/Consensys/teku/issues/7822#issuecomment-1854772191",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7822",
    "id": 1854772191,
    "node_id": "IC_kwDOCM9I9M5ujZPf",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-13T22:05:25Z",
    "updated_at": "2023-12-13T22:05:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "You could definitely do it, just need to specify `--initial-state` and pass in `https://checkpoint-sync.holesky.ethpandaops.io/eth/v2/debug/beacon/states/genesis`... Holesky has been starting at finalized by default so you'd need to manually specify both flags.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1854772191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1854783506",
    "html_url": "https://github.com/Consensys/teku/issues/7822#issuecomment-1854783506",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7822",
    "id": 1854783506,
    "node_id": "IC_kwDOCM9I9M5ujcAS",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-13T22:15:51Z",
    "updated_at": "2023-12-13T22:15:51Z",
    "author_association": "NONE",
    "body": "You’re saying this is by design? Teku doesn’t ship with the Holesky genesis state included? That makes it kinda tough to run an archive node there, unless I’m missing something ",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1854783506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1854833440",
    "html_url": "https://github.com/Consensys/teku/issues/7822#issuecomment-1854833440",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7822",
    "id": 1854833440,
    "node_id": "IC_kwDOCM9I9M5ujoMg",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-13T23:06:52Z",
    "updated_at": "2023-12-13T23:08:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "genesis route is served by checkpointz, and teku points to the github repo for its reference, but we're moving away from suggesting syncing from genesis as a rule (weak subjectivity). \n\nIf we have weak-subjectivity is on and we have sync from genesis by default, then you'd *always* get an error unless you specify to sync from finalized which would be significantly impacting most users when they try to initialise...\n\nMainnet still has initial-state genesis, so if you do try to startup on mainnet now, it'll fail unless you specify to ignore weak-subjectivity, which I don't love the UX of...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1854833440/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1855621199",
    "html_url": "https://github.com/Consensys/teku/issues/7822#issuecomment-1855621199",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7822",
    "id": 1855621199,
    "node_id": "IC_kwDOCM9I9M5umohP",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-14T10:50:52Z",
    "updated_at": "2023-12-14T10:50:52Z",
    "author_association": "NONE",
    "body": "Yes that’s what I compared it to, mainnet.\r\n\r\nWhat is your recommended way to sync a Teku archive node? On mainnet I have the built-in genesis, but on Holesky you’d recommend to load the state from the URL you showed?",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1855621199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1857098178",
    "html_url": "https://github.com/Consensys/teku/issues/7822#issuecomment-1857098178",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7822",
    "id": 1857098178,
    "node_id": "IC_kwDOCM9I9M5usRHC",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-15T00:52:10Z",
    "updated_at": "2023-12-15T00:54:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "so on mainnet it looks like:\n```\nteku \\\n    --ignore-weak-subjectivity-period-enabled \\\n    --data-storage-mode archive \\\n    --initial-state=https://sync-mainnet.beaconcha.in/eth/v2/debug/beacon/states/genesis \\\n    --network=mainnet\n```\ncould optionally specify `--initial-state=https://sync-mainnet.beaconcha.in/eth/v2/debug/beacon/states/genesis\n`, but equally its default so you could strike that out.\nequally with --network - defaults to mainnet so implicit...\nso ultimately this simplifies to \n```\nteku \\\n    --ignore-weak-subjectivity-period-enabled \\\n    --data-storage-mode archive\n```\n\nOn holesky, its got a version from github of the genesis state still, but its initial state doesn't default to genesis, so you'd basically be going:\n```\nteku \\\n    --ignore-weak-subjectivity-period-enabled \\\n    --data-storage-mode archive \\\n    --network holesky \\\n    --initial-state=https://checkpoint-sync.holesky.ethpandaops.io/eth/v2/debug/beacon/states/genesis\n```\nand all these options aren't defaulting so they'll all be specified.\n\nSometimes we just start an archive node from normal finalized state, which means it's not back to genesis, and then we can not bother specifying the ignore or the initial state, but equally we can't query states earlier than when we initialized in this scenario... In that case it's just:\n```\nteku \\\n    --data-storage-mode archive \\\n    --network holesky\n```\nAgain though, just to reemphasise, this is an archive node that doesn't go back to genesis, so this may not be what some (most?) people would desire from an archive node... The first holesky example is closer to what you're asking...",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1857098178/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1857685630",
    "html_url": "https://github.com/Consensys/teku/issues/7822#issuecomment-1857685630",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7822",
    "id": 1857685630,
    "node_id": "IC_kwDOCM9I9M5uugh-",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-15T10:58:02Z",
    "updated_at": "2023-12-15T10:58:02Z",
    "author_association": "NONE",
    "body": "Thank you. I have some special-casing to do then, so this works.\r\n\r\nI assume Sepolia is similar, with an initial state needed? Where is that kept?",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1857685630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
