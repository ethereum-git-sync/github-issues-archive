{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4516",
  "id": 1033141641,
  "node_id": "I_kwDOCM9I9M49lH2J",
  "number": 4516,
  "title": "Continuous failure to produce attestations",
  "user": {
    "login": "paulmillr",
    "id": 574696,
    "node_id": "MDQ6VXNlcjU3NDY5Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulmillr",
    "html_url": "https://github.com/paulmillr",
    "followers_url": "https://api.github.com/users/paulmillr/followers",
    "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
    "organizations_url": "https://api.github.com/users/paulmillr/orgs",
    "repos_url": "https://api.github.com/users/paulmillr/repos",
    "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulmillr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2021-10-22T03:29:33Z",
  "updated_at": "2021-10-26T07:01:41Z",
  "closed_at": "2021-10-25T22:31:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm testing teku behavior on prater testnet\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Import 10 validators to teku. First 5 validators need to be already-validating. Import slashing protection from another client \r\n2. The other 5 validators need to be activating in some short time\r\n3. Wait until activation.\r\n\r\n**Expected behavior:** The new validators will produce attestations as expected\r\n\r\n**Actual behavior:** all attestations will be missed. The attestations start missing 5 hours before the activation, even for existing validators\r\n\r\n### Versions (Add all that apply)\r\n* Software version: teku/v21.10.1/linux-x86_64/-debian-openjdk64bitservervm-java-17\r\n* Java version: java 17\r\n* OS Name & Version: debian 11\r\n* Kernel Version: 5.10.0\r\n\r\n### Additional Information\r\n\r\nThis seems like very bad bug, especially one week before altair launch. I have stopped testing this after 2+ hours, because nothing was produced. Switched to a different client, and all is fine.\r\n\r\nThe performance log is here: https://gist.github.com/paulmillr/da16133f9d010c866ddc1fd0fd4639ec\r\n\r\nNo errors, only lots of `SlashableConditionException` **after** attestations started dropping.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4516/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949259643",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949259643",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949259643,
    "node_id": "IC_kwDOCM9I9M44lI17",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T03:37:41Z",
    "updated_at": "2021-10-22T03:37:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "`SlashableConditionException` indicates that the node has refused to sign something because it would be potentially slash able. You definitely do NOT want teku to proceed to produce attestations in that case.\r\n\r\nMy guess is that the slashing protection file you imported includes attestations that are in the future.  Since Teku uses the minimal approach to slashing protection (which is much simpler, thus reliable and doesn't not consume an ever growing amount of disk space)  it will refuse to produce attestations until that future slot is passed.\r\n\r\nIt would be worth reviewing the attestations in the slashing protection file you imported to check if any are in the future - if so, teku is correctly preventing you from getting slashed.  You can also review the slashing protection records to see what Teku did import - they're simple YAML files under `<data-path>/validators/slashprotection/`.  Given this is the prater testnet if you're able to provide the slashing import file and resulting .yml files from that slashprotection directory we can review.\r\n\r\nAlso worth noting that Altair launched on the Prater testnet some time back.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949259643/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949277191",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949277191",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949277191,
    "node_id": "IC_kwDOCM9I9M44lNIH",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T04:26:59Z",
    "updated_at": "2021-10-22T04:26:59Z",
    "author_association": "NONE",
    "body": "> My guess is that the slashing protection file you imported includes attestations that are in the future. Since Teku uses the minimal approach to slashing protection (which is much simpler, thus reliable and doesn't not consume an ever growing amount of disk space) it will refuse to produce attestations until that future slot is passed.\r\n\r\nI see stuff like that:\r\n\r\n```\r\nlastSignedBlockSlot: 1256396\r\nlastSignedAttestationSourceEpoch: 47811\r\nlastSignedAttestationTargetEpoch: 47812\r\n---\r\nlastSignedBlockSlot: 0\r\nlastSignedAttestationSourceEpoch: 47811\r\nlastSignedAttestationTargetEpoch: 47812\r\n---\r\nlastSignedBlockSlot: 1126761\r\nlastSignedAttestationSourceEpoch: 47805\r\nlastSignedAttestationTargetEpoch: 47810\r\n---\r\nlastSignedBlockSlot: 1201568\r\nlastSignedAttestationSourceEpoch: 47811\r\nlastSignedAttestationTargetEpoch: 47812\r\n```\r\n\r\nSeems fine. There are just 4 epochs there in sourceEpoch: 47805, 47807, 47810, 47811. After that i've switched to a different client.\r\n\r\n> My guess is that the slashing protection file you imported includes attestations that are in the future\r\n\r\nIf it was, why did it validate fine for 5+ hours after import? It started missing attestations after that.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949277191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949278078",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949278078",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949278078,
    "node_id": "IC_kwDOCM9I9M44lNV-",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T04:29:22Z",
    "updated_at": "2021-10-22T04:29:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, interesting. I think I'd need to see the full teku logs to dig in further.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949278078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949278368",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949278368",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949278368,
    "node_id": "IC_kwDOCM9I9M44lNag",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T04:30:02Z",
    "updated_at": "2021-10-22T04:30:02Z",
    "author_association": "NONE",
    "body": "No problem. How do I pass them to you?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949278368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949280541",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949280541",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949280541,
    "node_id": "IC_kwDOCM9I9M44lN8d",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T04:36:05Z",
    "updated_at": "2021-10-22T04:36:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "You can email me at adrian.sutton@consensys.net is probably easiest.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949280541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949281292",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949281292",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949281292,
    "node_id": "IC_kwDOCM9I9M44lOIM",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T04:38:28Z",
    "updated_at": "2021-10-22T04:38:28Z",
    "author_association": "NONE",
    "body": "Sent.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949281292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949285843",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949285843",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949285843,
    "node_id": "IC_kwDOCM9I9M44lPPT",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T04:53:09Z",
    "updated_at": "2021-10-22T04:53:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, the log file shows that the node is failing to keep up with gossip:\r\n```\r\n2021-10-21 14:31:37.812+02:00 | beaconchain-async-13 | WARN  | Eth2TopicHandler | Encountered exception while processing message for topic /eth2/82f4a72b/beacon_attestation_16/ssz_snappy\r\njava.util.concurrent.CompletionException: java.lang.RuntimeException: java.util.concurrent.CompletionException: tech.pegasys.teku.service.serviceutils.ServiceCapacityExceededException: Failed to process signature, queue is full.\r\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315) ~[?:?]\r\n```\r\nand nearly every slot reports no block, I suspect because it's not getting them via gossip.  Eventually it falls far enough behind that the long sync kicks in and catches it back up to head, but in doing so the committee assignments change and often a validator is then assigned to attest at a different slot - that would be slash able so the slashing protection is correctly kicking in and stopping it.\r\n\r\nWe need to find out why its not able to keep up.\r\n\r\nSo a few questions:\r\n\r\n1. What's the CPU and memory specs of the system it's running on?\r\n2. Is there anything else running on that system? (Other beacon nodes, geth etc)\r\n3. Have you set a -Xmx value at all for teku?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949285843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949293777",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949293777",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949293777,
    "node_id": "IC_kwDOCM9I9M44lRLR",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T05:15:16Z",
    "updated_at": "2021-10-22T05:25:43Z",
    "author_association": "NONE",
    "body": "- Ryzen 7 1700X (8-core, 16-thread), 64GB RAM\r\n- Geth is running (ate 1h of cpu time in 16h), other nodes are not. Prometheus is running, it ate just 2 mins of cpu time.\r\n- The load was something like 5-5.5 with teku the last time i've checked\r\n\r\nThe teku is ran like this:\r\n\r\n```\r\nJAVA_OPTS=-Xmx2g\r\n--rest-api-enabled=true --rest-api-docs-enabled=true --metrics-enabled --network=prater\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949293777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949294557",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949294557",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949294557,
    "node_id": "IC_kwDOCM9I9M44lRXd",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T05:17:06Z",
    "updated_at": "2021-10-22T05:17:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah right, `-Xmx2g` will not be sufficient for a network the size of prater or mainnet.  Unfortunately a few guides have quite outdated values from when the networks were much smaller.\r\n\r\nMy suggestion would be to use:\r\n```\r\nEnvironment=\"JAVA_OPTS=-Xmx4g\"\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949294557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949295724",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949295724",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949295724,
    "node_id": "IC_kwDOCM9I9M44lRps",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T05:20:06Z",
    "updated_at": "2021-10-22T05:23:11Z",
    "author_association": "NONE",
    "body": "I can try it, but there were no memory errors. Why doesn't teku produce a mem error if something like this happens?\r\n\r\nCan teku detect the total # of validators in the network and at least warn users accordingly?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949295724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949957155",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-949957155",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 949957155,
    "node_id": "IC_kwDOCM9I9M44nzIj",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T21:02:18Z",
    "updated_at": "2021-10-22T21:02:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I can try it, but there were no memory errors. Why doesn't teku produce a mem error if something like this happens?\r\n> \r\n> Can teku detect the total # of validators in the network and at least warn users accordingly?\r\n\r\nThere weren't any memory errors because teku didn't actually run out of memory - it just had to spend so much time doing garbage collection to survive it wasn't able to keep up. If that had been for a short period of time, that would be fine and it would have recovered, but the demand for memory just didn't subside.  If you think of it like when you've run more programs than can fit in system memory - you don't expect the system to fail, it starts using swap but that means everything gets slower.  That's essentially what teku is doing - it keeps dropping stuff out of memory to make room for stuff it needs now, but then has to reload those things from disk again when they're needed later, so it's effectively thrashing swap.\r\n\r\nThe logs are actually full of errors about the queue being full so it's immediately clear that it's not keeping up. That could be because of a lack of CPU or a lack of memory. The best way to monitor is via prometheus/grafana - our standard dashboard has a graph of time spent in GC which would very quickly show the problem.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/949957155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951384338",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-951384338",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 951384338,
    "node_id": "IC_kwDOCM9I9M44tPkS",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T22:31:30Z",
    "updated_at": "2021-10-25T22:31:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm going to close this given that its clear the attestations weren't created because Teku didn't have sufficient resources to keep up with incoming gossip.  If you do increase the max heap and still have problems feel free to reopen.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951384338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951526990",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-951526990",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 951526990,
    "node_id": "IC_kwDOCM9I9M44tyZO",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-26T03:32:37Z",
    "updated_at": "2021-10-26T03:32:37Z",
    "author_association": "NONE",
    "body": "Could teku emit any errors that would specifically mention that heap size should be increased ? Because gc time / size is not obvious",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951526990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951608696",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-951608696",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 951608696,
    "node_id": "IC_kwDOCM9I9M44uGV4",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-26T06:40:10Z",
    "updated_at": "2021-10-26T06:40:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Could teku emit any errors that would specifically mention that heap size should be increased ? Because gc time / size is not obvious\r\n\r\nThe problem with this is that the max heap size is a simple command line setting but the way it comes out inside the JVM varies depending on the JDK and which GC algorithm is in use (different GC algorithms take different approaches to memory management).  So this winds up being one of those things that's reasonably easy for a human to identify as a problem by looking at the standard dashboard we provide and seeing that CPU usage is very high and GC is is using nearly all of it, but much harder to identify programmatically from inside the JVM.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951608696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951620339",
    "html_url": "https://github.com/ConsenSys/teku/issues/4516#issuecomment-951620339",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4516",
    "id": 951620339,
    "node_id": "IC_kwDOCM9I9M44uJLz",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-26T07:01:41Z",
    "updated_at": "2021-10-26T07:01:41Z",
    "author_association": "NONE",
    "body": "BTW, your dashboard inside of the repo is outdated. https://grafana.com/grafana/dashboards/13457 This one seems to be working",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/951620339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
