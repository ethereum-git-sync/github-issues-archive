{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7552",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7552/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7552/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7552/events",
  "html_url": "https://github.com/Consensys/teku/issues/7552",
  "id": 1915955847,
  "node_id": "I_kwDOCM9I9M5yMyqH",
  "number": 7552,
  "title": "`23.9.1` minor release introduces a breaking change in LevelDB dependency",
  "user": {
    "login": "Neurone",
    "id": 562943,
    "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Neurone",
    "html_url": "https://github.com/Neurone",
    "followers_url": "https://api.github.com/users/Neurone/followers",
    "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
    "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
    "organizations_url": "https://api.github.com/users/Neurone/orgs",
    "repos_url": "https://api.github.com/users/Neurone/repos",
    "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Neurone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-27T16:38:42Z",
  "updated_at": "2023-09-29T00:04:19Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nUsing Ubuntu 20.04, when upgrading from `23.9.0.` to `23.9.1`, Teku reports a LevelDB error and stops.\r\n\r\nIf I run from scratch, without using an existing DB, Teku reports the same error and starts a new DB with RocksDB instead of using the existing LevelDB database.\r\n\r\n```sh\r\nTeku failed to start: java.lang.UnsatisfiedLinkError: Could not load library. Reasons: [Can't load library: /tmp/leveldbjni@14976013304512060760/libleveldbjni-1.8.so, /tmp/leveldbjni@14976013304512060760/libleveldbjni.so: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by /tmp/leveldbjni@14976013304512060760/libleveldbjni.so), no leveldbjni64-1.8 in java.library.path: /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib, no leveldbjni-1.8 in java.library.path: /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib, no leveldbjni in java.library.path: /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib]\r\n```\r\n\r\nUpdating Ubuntu to the latest updates from the official repos does not solve the problem.\r\n\r\nI searched online, and having `GLIBC 2.33` on Ubuntu 20.04 seems complex. The current repo seems stuck to `GLIBC 2.31`.\r\n\r\nI noticed the LevelDB native library in the Teku repo was updated from `0.2.0` to `0.3.0` in the `23.9.1` release with PR #7504\r\n\r\nUsing `23.9.1`, I downgraded that native library back to `0.2.0`, and everything seems to work fine - both unit tests and the execution of Teku on an existing DB.\r\n\r\n```sh\r\n‚ùØ ./gradlew\r\n...\r\nBUILD SUCCESSFUL in 9m 13s\r\n539 actionable tasks: 537 executed, 2 up-to-date\r\n```\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\n- Use Ubuntu `20.04`\r\n- Run Teku `23.9.0`, and stop it\r\n- Run Teku `23.9.1` on the same DB\r\n\r\n**Expected behavior:**\r\n\r\nTeku continues to work as expected before the upgrade.\r\n\r\n**Actual behavior:**\r\n\r\nTeku reports the following error and stops.\r\n\r\n```sh\r\nTeku failed to start: java.lang.UnsatisfiedLinkError: Could not load library. Reasons: [Can't load library: /tmp/leveldbjni@14976013304512060760/libleveldbjni-1.8.so, /tmp/leveldbjni@14976013304512060760/libleveldbjni.so: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by /tmp/leveldbjni@14976013304512060760/libleveldbjni.so), no leveldbjni64-1.8 in java.library.path: /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib, no leveldbjni-1.8 in java.library.path: /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib, no leveldbjni in java.library.path: /usr/java/packages/lib:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib]\r\n```\r\n\r\n**Frequency:**\r\n\r\nAlways\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `teku/v23.9.1/linux-x86_64/-privatebuild-openjdk64bitservervm-java-17`\r\n* Java version: `openjdk version \"17.0.8.1\" 2023-08-24 - OpenJDK Runtime Environment (build 17.0.8.1+1-Ubuntu-0ubuntu120.04) - OpenJDK 64-Bit Server VM (build 17.0.8.1+1-Ubuntu-0ubuntu120.04, mixed mode, sharing)`\r\n* OS Name & Version: `Ubuntu 20.04.3 LTS (Focal Fossa)`\r\n* Docker Version: `N/A`\r\n* Cloud VM, type, size: `N/A`",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7552/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7552/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1737752877",
    "html_url": "https://github.com/Consensys/teku/issues/7552#issuecomment-1737752877",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7552",
    "id": 1737752877,
    "node_id": "IC_kwDOCM9I9M5nlAEt",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-27T16:47:49Z",
    "updated_at": "2023-09-27T16:47:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @Neurone for opening! We realized the issue today as well.\r\nWe are in the process of releasing a new leveldb lib moving back GLIBC requirements.\r\nReference to https://github.com/Consensys/leveldbjni-native/pull/12 for the upcoming version.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1737752877/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1739006840",
    "html_url": "https://github.com/Consensys/teku/issues/7552#issuecomment-1739006840",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7552",
    "id": 1739006840,
    "node_id": "IC_kwDOCM9I9M5npyN4",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-28T11:59:25Z",
    "updated_at": "2023-09-28T11:59:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Neurone do you have the chance to compile https://github.com/Consensys/teku/pull/7557 so we can double-check that the problem is solved?",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1739006840/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1740141467",
    "html_url": "https://github.com/Consensys/teku/issues/7552#issuecomment-1740141467",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7552",
    "id": 1740141467,
    "node_id": "IC_kwDOCM9I9M5nuHOb",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-29T00:04:19Z",
    "updated_at": "2023-09-29T00:04:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @tbenr , yep, it works. I tried that branch and tests pass and also Teku starts correctly over the old LevelDB.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1740141467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
