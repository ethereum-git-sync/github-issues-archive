{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3855",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3855/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3855/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3855/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3855",
  "id": 857425300,
  "node_id": "MDU6SXNzdWU4NTc0MjUzMDA=",
  "number": 3855,
  "title": "Improve eth1 logging",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-04-14T00:51:14Z",
  "updated_at": "2022-08-16T10:22:48Z",
  "closed_at": "2022-08-16T10:22:47Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nWhen requests to the eth1 node fail they are currently only logged at debug level.  Then the `ErrorTrackingEth1Provider` logs a warning that the eth1 node is inaccessible every 30 seconds that eth1 is unavailable.  This avoids spamming the logs with a lot of stack traces when eth1 requests fail but winds up providing too little information when the node is down for a longer period.  It also doesn't provide any warning when the preferred eth1 node is failing and a backup is used (once #3832 is merged).\r\n\r\nRequirements for logging:\r\n\r\n1. Avoid logging every failed eth1 request at anything above DEBUG level to avoid spamming logs\r\n2. Provide a warning when any eth1 endpoint is unavailable for an extended period, not just when all eth1 endpoints are unavailable.\r\n3. Provide a reasonable amount of information with those warnings to indicate why the requests are failing. This likely isn't every exception and for common failures like `ConnectException` can omit the stack trace and just provide a meaningful error message.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3855/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3855/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/839374472",
    "html_url": "https://github.com/ConsenSys/teku/issues/3855#issuecomment-839374472",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3855",
    "id": 839374472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzOTM3NDQ3Mg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-12T02:00:06Z",
    "updated_at": "2021-05-12T02:00:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "It would also be good to improve the reporting when one, but not all eth1 nodes are unavailable.  Currently we print:\n```\nteku[2523]: 03:52:25.650 WARN  - Endpoint localhost:8545 [1] is INVALID | Connection refused (Connection refused)\n```\n\nOne option would be to periodically print the status of all eth1 endpoints and which is being actively used if some are offline so it's clear that some of them are still accessible.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/839374472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1216448780",
    "html_url": "https://github.com/ConsenSys/teku/issues/3855#issuecomment-1216448780",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3855",
    "id": 1216448780,
    "node_id": "IC_kwDOCM9I9M5IgYkM",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T10:22:48Z",
    "updated_at": "2022-08-16T10:22:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "We did a round of improvements for this and the eth1-endpoint is going away post-merge which changes the reporting requirements anyway.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1216448780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
