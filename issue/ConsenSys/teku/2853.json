{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2853",
  "id": 709720215,
  "node_id": "MDU6SXNzdWU3MDk3MjAyMTU=",
  "number": 2853,
  "title": "Retain orphaned blocks within archive database",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919131,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTMx",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/enhancement%20%F0%9F%95%B5%EF%B8%8F%E2%80%8D%E2%99%80%EF%B8%8F",
      "name": "enhancement üïµÔ∏è‚Äç‚ôÄÔ∏è",
      "color": "a2eeef",
      "default": false,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2020-09-27T11:16:46Z",
  "updated_at": "2021-04-21T03:58:08Z",
  "closed_at": "2021-04-21T03:58:08Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Change request from @mcdee via Discord.\r\n\r\nCurrently, Teku aggresively prunes orphaned blocks from the database, even in ARCHIVE mode. For data analytics purposes it would be useful to retain orphaned blocks and make them accessible via the API in ARCHIVE mode.\r\n",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2853/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/792601675",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-792601675",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 792601675,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjYwMTY3NQ==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-08T09:08:56Z",
    "updated_at": "2021-03-08T09:08:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Noting so I don't forget that we now have a second request for this feature. Also that the API should indicate whether a block was canonical or orphaned - I don't know whether this is possible within the constraints of the current API.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/792601675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/792605417",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-792605417",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 792605417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjYwNTQxNw==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-08T09:13:54Z",
    "updated_at": "2021-03-08T09:13:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Regarding stating the canonical state of a block: it probably falls outside of the purview of the API to provide that info in the standard API call.  The API tries to return ETH2 structs where possible, and canonical state is somewhat another layer on top of the block information rather than an inherent property of it.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/792605417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/815625786",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-815625786",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 815625786,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTYyNTc4Ng==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-08T09:55:09Z",
    "updated_at": "2021-04-08T09:55:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "There should be a release tomorrow containing this feature behind the dev cli flag `--Xdata-storage-non-canonical-blocks-enabled`\nand fetching block by root for orphaned blocks should then also work.\n\nIf you'd like to take a look and see if this is adequate for your use-case @mcdee ?  Historic orphaned blocks won't be able to be fetched, but new orphaned blocks should start getting stored, and you'd have to fetch by block root...\n\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/815625786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/816125711",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-816125711",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 816125711,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNjEyNTcxMQ==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-08T19:56:30Z",
    "updated_at": "2021-04-08T19:56:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Will fetching by slot also work?\r\n\r\nAlso, curious as to if the node will store historical orphaned blocks with this mode enabled, if these blocks are delivered to the node?  Wondering if I can find a way to back-fill the historic orphaned blocks by sending them over p2p.\r\n\r\nI haven't checked the code so apologies if this is already the case, but does it make sense for this flag to be enabled by default in archive mode?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/816125711/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/816164888",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-816164888",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 816164888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNjE2NDg4OA==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-08T20:33:17Z",
    "updated_at": "2021-04-08T20:33:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Fetch by slot won't currently work for orphaned blocks, is that functionality that you need?\n\nHistorical block fetching is only canonical, I'm not sure it'd be easy to sync non canonical slots through that process currently.\n\nIf the block was gossiped to the node, the node would then see it's non canonical during finalization and store it as a non canonical block... I've seen it working on current blocks, but nothing currently pushes non canonical blocks around as far as I'm aware. I added a debug for this, because its fairly rare on mainnet to even see a non canonical block ( a few a day)\n\nSo basically while the orphaned block is in non finalized state, it comes from hot storage (used to do that) and would be fetchable by slot or by root, because it's heavily indexed. Without the dev flag, it will be deleted during the move of data to finalized storage.\n\nWith the new flag, It will get stored and indexed by root, so retrieval by block root is cheap. Retrieval by slot hasn't currently been added, theres options but neither are great, I might actually need a separate endpoint that does a full scan on the new column.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/816164888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/819782513",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-819782513",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 819782513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTc4MjUxMw==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-14T19:39:24Z",
    "updated_at": "2021-04-14T19:39:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Fetch by slot won't currently work for orphaned blocks, is that functionality that you need?\r\n\r\nNot sure how it would be possible to discover orphaned blocks without the ability to fetch by slot.  Is there some other way in which these could be found?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/819782513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/820074877",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-820074877",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 820074877,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMDA3NDg3Nw==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-15T04:03:11Z",
    "updated_at": "2021-04-15T04:03:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm really not sure actually, I might tag @ajsutton and see if he's got any ideas...",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/820074877/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/820090583",
    "html_url": "https://github.com/ConsenSys/teku/issues/2853#issuecomment-820090583",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2853",
    "id": 820090583,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMDA5MDU4Mw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-15T04:43:34Z",
    "updated_at": "2021-04-15T04:43:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Not sure how it would be possible to discover orphaned blocks without the ability to fetch by slot. Is there some other way in which these could be found?\r\n\r\nSo the details depend a fair bit on use case.  Every block, canonical or not will be sent to the event stream which has the block hash.  But I suspect if you can catch the block hash from there then you'd get it before the slot was finalised and you'd have always been able to get it.\r\n\r\nIf the node is offline when the block is published it will probably never get it and definitely won't ever get it if it hasn't heard about it by the time the slot is finalized.\r\n\r\nSo I'm guessing that you're thinking in terms of something like having a node that's been consistently online but then something like chaind has just restarted and is backfilling data for certain epochs.  In that case yeah you'd probably have to walk through each slot between the last block you have and the current chain head requesting canonical and non-canonical at each slot.\r\n\r\nThe other option would be to request based on the parent_root which oddly the standard API does support (though Teku's never implemented it because it seems weird). In that case you'd have to get each canonical block and then use it's hash as the parent_root to see if it has any non-canonical descendants and follow each chain you find.  Get by slot probably makes more sense.\r\n\r\nWe'll have to add a teku specific API to be able to get non-canonical blocks by slot and add another column to the db to index them appropriately.  The standard API can only return one block for each slot so can't be used for non-canonical blocks.  Most of the time non-canonical blocks are just orphans but they can be completely different forks and so you wind up with multiple blocks at the same slot.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/820090583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
