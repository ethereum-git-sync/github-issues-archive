{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6527",
  "id": 1470290682,
  "node_id": "I_kwDOCM9I9M5Xotr6",
  "number": 6527,
  "title": "investigate 'no peers found on gossip topic'",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2022-11-30T22:17:52Z",
  "updated_at": "2023-03-31T06:58:40Z",
  "closed_at": "2023-03-31T06:58:40Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "```\nFailed to publish attestations(s) for slot NNN because no peers were available on the required gossip topic\n```",
  "closed_by": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6527/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1332901567",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1332901567",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1332901567,
    "node_id": "IC_kwDOCM9I9M5Pcna_",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-30T23:43:05Z",
    "updated_at": "2022-11-30T23:43:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "From Ben:\nOne hypothesis is that it is due to more nodes on the post-Merge network that are not running validators, making it harder to find the ones you want. Is increasing the number of peers likely to help (gut feel, yes)? If so, should we increase our default maxPeers?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1332901567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1339154772",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1339154772",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1339154772,
    "node_id": "IC_kwDOCM9I9M5P0eFU",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T11:06:25Z",
    "updated_at": "2022-12-06T11:06:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "from a user in discord:\r\nhe is experiencing some peering issues during sync committee duties. I asked him enable TRACE on `SyncCommitteeMessageGossipManager` and here it is:\r\n\r\n```\r\n2022-12-06 09:55:51.001 INFO  - Slot Event  *** Slot: 5291377, Block: b9ced3d8073485d1b190027e46feebc4600c1f5e5e481cdb91f7bcb520b5f015, Justified: 165354, Finalized: 165353, Peers: 100\r\n2022-12-06 09:56:00.236 INFO  - Validator   *** Published sync_signature     Count: 1, Slot: 5291378, Root: e09755625ddaf5ba409134d0129ca612feaf7e0402eca82d5a736ccc38a65101\r\n2022-12-06 09:56:00.236 TRACE - Failed to publish sync committee message for slot 5291378\r\njava.util.concurrent.CompletionException: io.libp2p.pubsub.NoPeersForOutboundMessageException: No peers for message topics [/eth2/4a26c58b/sync_committee_3/ssz_snappy] found\r\nat java.util.concurrent.CompletableFuture.encodeRelay(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeRelay(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniCompose.tryFire(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$AsyncSupply.run(Unknown Source) ~[?:?]\r\nat java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) ~[?:?]\r\nat java.util.concurrent.FutureTask.run(Unknown Source) ~[?:?]\r\nat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(Unknown Source) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) ~[?:?]\r\nat java.lang.Thread.run(Unknown Source) ~[?:?]\r\nCaused by: io.libp2p.pubsub.NoPeersForOutboundMessageException: No peers for message topics [/eth2/4a26c58b/sync_committee_3/ssz_snappy] found\r\nat io.libp2p.pubsub.gossip.GossipRouter.broadcastOutbound(GossipRouter.kt:404) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nat io.libp2p.pubsub.AbstractRouter$publish$1.invoke(AbstractRouter.kt:72) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nat io.libp2p.pubsub.AbstractRouter$publish$1.invoke(AbstractRouter.kt:66) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\nat io.libp2p.etc.types.AsyncExtKt.submitAsync$lambda-1(AsyncExt.kt:53) ~[jvm-libp2p-minimal-0.10.0-RELEASE.jar:?]\r\n... 7 more\r\n```\r\n\r\nSo the node struggle to find (or suddenly loses) sync committee peers",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1339154772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1339194991",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1339194991",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1339194991,
    "node_id": "IC_kwDOCM9I9M5P0n5v",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T11:42:09Z",
    "updated_at": "2022-12-06T11:42:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seems like during the entire sync committee period user had missed the majority of all messages but not all. So wasn't able to maintain good peers.\r\n<img width=\"941\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15999009/205902308-e2f222a0-eea9-4f12-83eb-de2fc3285aa4.png\">\r\n\r\nAttestations have been OK and steady peers to 100 (86 inbound, 14 outbound)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1339194991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1342509385",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1342509385",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1342509385,
    "node_id": "IC_kwDOCM9I9M5QBRFJ",
    "user": {
      "login": "stefa2k",
      "id": 54934211,
      "node_id": "MDQ6VXNlcjU0OTM0MjEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54934211?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefa2k",
      "html_url": "https://github.com/stefa2k",
      "followers_url": "https://api.github.com/users/stefa2k/followers",
      "following_url": "https://api.github.com/users/stefa2k/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefa2k/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefa2k/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefa2k/subscriptions",
      "organizations_url": "https://api.github.com/users/stefa2k/orgs",
      "repos_url": "https://api.github.com/users/stefa2k/repos",
      "events_url": "https://api.github.com/users/stefa2k/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefa2k/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T10:43:04Z",
    "updated_at": "2022-12-08T10:43:04Z",
    "author_association": "NONE",
    "body": "Some more metrics of the case @tbenr mentioned:\r\n![image](https://user-images.githubusercontent.com/54934211/206426572-1824d73d-617e-4b01-b158-e777c0d8ecea.png)\r\n![image](https://user-images.githubusercontent.com/54934211/206426630-9e42527c-1830-4035-b72e-59550bc03303.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1342509385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1344026937",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1344026937",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1344026937,
    "node_id": "IC_kwDOCM9I9M5QHDk5",
    "user": {
      "login": "stefa2k",
      "id": 54934211,
      "node_id": "MDQ6VXNlcjU0OTM0MjEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54934211?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefa2k",
      "html_url": "https://github.com/stefa2k",
      "followers_url": "https://api.github.com/users/stefa2k/followers",
      "following_url": "https://api.github.com/users/stefa2k/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefa2k/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefa2k/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefa2k/subscriptions",
      "organizations_url": "https://api.github.com/users/stefa2k/orgs",
      "repos_url": "https://api.github.com/users/stefa2k/repos",
      "events_url": "https://api.github.com/users/stefa2k/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefa2k/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-09T08:57:30Z",
    "updated_at": "2022-12-09T08:57:30Z",
    "author_association": "NONE",
    "body": "As @tbenr requested:\r\n\r\n<img width=\"1357\" alt=\"image\" src=\"https://user-images.githubusercontent.com/54934211/206663559-b81e2463-56a8-4179-be06-f32aefe7bbcb.png\">\r\n\r\n<img width=\"1357\" alt=\"image\" src=\"https://user-images.githubusercontent.com/54934211/206663771-f6bd36a7-2cdd-4204-b518-e746f911d57a.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1344026937/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1345678763",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1345678763",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1345678763,
    "node_id": "IC_kwDOCM9I9M5QNW2r",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-11T22:48:48Z",
    "updated_at": "2022-12-11T22:48:48Z",
    "author_association": "MEMBER",
    "body": "Thanks, @stefa2k we are looking into this and will report back as soon as we can.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1345678763/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1360375395",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1360375395",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1360375395,
    "node_id": "IC_kwDOCM9I9M5RFa5j",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-20T21:58:19Z",
    "updated_at": "2022-12-20T21:58:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "One possibly relevant detail with sync committees specifically, is that you only subscribe to those topics if you're scheduled to be in a sync committee (including in the next sync committee) or if you've set `--p2p-subscribe-all-subnets`. Whereas with attestation subnets, you subscribe to one subnet per validator you run.  So if you're running 64 or more validators you'll always be subscribed to all attestation subnets, but likely won't be subscribed to sync committee subnets.  In that case it would be worth enabling `--p2p-subscribe-all-subnets`.  Normally doing so would increase CPU and bandwidth significantly but with 64+ validators you're already paying that cost, so may as well stay subscribed to the sync committee subnets as well - then other peers will be seeking out your node to connect all the time and it _may_ help ensure you have peers on the subnet.  That said, when you are scheduled to be part of a sync committee, you'd subscribe to those topics and other sync committee members would start seeking you out then anyway so it's definitely not a guarantee that it would help.\r\n\r\nThe other possibility is that because post-merge there are a larger number of nodes not running validators and thus not subscribed to any subnets, it's gotten harder to ensure Teku has peers on all the different subnets. It may be that Teku's scoring system is flipping between prioritising different attestation and sync committee subnets trying to cover them all, but unable to within the peer limit. If that's the case, and there's sufficient bandwidth available, increasing the peer count may help. Worst case if every peer is only subscribed to one subnet then we'd need `(64 + 4) * 2 = 136` peers to have two peers on each subnet which is the default target.   I'd be tempted to try setting `--p2p-peer-upper-bound=150` to give a bit of wiggle room, but it's important to watch bandwidth availability - if the extra peers exceed the available bandwidth it would likely make the problem worse.\r\n\r\nFundamentally, I don't think there are any quick fixes here. We will likely wind up needing to adjust either Teku's defaults or it's peer selection strategy to adjust to the changes in the network post-merge, but we'll need to gather a fair bit of data on what effects that actually has before we can be confident if it actually helps or not.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1360375395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1360657207",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1360657207",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1360657207,
    "node_id": "IC_kwDOCM9I9M5RGfs3",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-21T01:43:02Z",
    "updated_at": "2022-12-21T01:43:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "ok, I'm not particularly convinced by the theory that it's harder to find peers on the required subnets.  Wrote a script to simulate a validator being in a sync committee and telling the beacon node to subscribe and Teku very quickly found 15-20 peers on each sync committee subnet, along with 20+ peers on each attestation subnet just with default options and a brand new node (with open ports).\r\n\r\nWhat is weird though, when the `until_epoch` was reached and the beacon node was no longer being told it needed to be subscribed to the sync committee subnets, the number of peers on those subnets dropped to zero straight away. The node was at its upper peer bound at the time.  Send a subscription request again and within a slot it had 5 peers back on those subnets.\r\n\r\nThat does mean that if there's ever a point where the VC's call to `/eth/v1/validator/sync_committee_subscriptions` is lost either because it expires before the VC refreshes it successfully or the beacon node restarts after it was called, the number of peers on sync committee subnets would drop to zero very quickly and cause issues. I think that's because sync committees are no longer valuable and so those peers are replaced by ones subscribed to more attestation subnets quickly which isn't a bad thing.\r\nThe Teku VC will subscribe to subnets until the end of the sync committee period so if the beacon node doesn't restart, getting that call once should be enough for the entire sync committee period. However, it only makes the call once per sync committee period unless the VC is restarted. That's not frequent enough and makes it pretty easy for the beacon node to wind up restarting and have the subscription be lost.\r\nAlso if the subscription request failed, it would log an error to the log file, but not to the console which could easily be missed.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1360657207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1360730211",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1360730211",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1360730211,
    "node_id": "IC_kwDOCM9I9M5RGxhj",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-21T02:30:49Z",
    "updated_at": "2022-12-21T02:30:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Except none of that applies to attestations - only sync committees, so it doesn't explain why we sometimes see no peers on attestation subnets.  Possibly there's multiple issues here.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1360730211/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1366904119",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1366904119",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1366904119,
    "node_id": "IC_kwDOCM9I9M5ReU03",
    "user": {
      "login": "alepacheco",
      "id": 8210939,
      "node_id": "MDQ6VXNlcjgyMTA5Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8210939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alepacheco",
      "html_url": "https://github.com/alepacheco",
      "followers_url": "https://api.github.com/users/alepacheco/followers",
      "following_url": "https://api.github.com/users/alepacheco/following{/other_user}",
      "gists_url": "https://api.github.com/users/alepacheco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alepacheco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alepacheco/subscriptions",
      "organizations_url": "https://api.github.com/users/alepacheco/orgs",
      "repos_url": "https://api.github.com/users/alepacheco/repos",
      "events_url": "https://api.github.com/users/alepacheco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alepacheco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-28T20:38:16Z",
    "updated_at": "2022-12-28T20:38:16Z",
    "author_association": "NONE",
    "body": "I was having this issue with 500 peers and subscribing to all topics ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1366904119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1366962638",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1366962638",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1366962638,
    "node_id": "IC_kwDOCM9I9M5RejHO",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-28T22:35:41Z",
    "updated_at": "2022-12-28T22:35:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I was having this issue with 500 peers and subscribing to all topics\r\n\r\nYou will have almost certainly overloaded your node's ability to service all those peers quickly enough and hit the limits of your network causing peers to downscore and unsubscribe from you which then causes this problem.  I'd suggest reducing the peer limit to at most 150 and not subscribing to all topics as a starting point. There could well be other factors involved but being unable to keep up with the traffic will pretty much guarantee you get this failure.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1366962638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1373049009",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1373049009",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1373049009,
    "node_id": "IC_kwDOCM9I9M5R1xCx",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-06T02:11:08Z",
    "updated_at": "2023-01-06T02:11:08Z",
    "author_association": "MEMBER",
    "body": "@stefa2k have you had a chance to update your config to use `--p2p-subscribe-all-subnets`? We might need to wait until your validators are chosen for a sync committee but it would be worth a try.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1373049009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1373207428",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1373207428",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1373207428,
    "node_id": "IC_kwDOCM9I9M5R2XuE",
    "user": {
      "login": "stefa2k",
      "id": 54934211,
      "node_id": "MDQ6VXNlcjU0OTM0MjEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54934211?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefa2k",
      "html_url": "https://github.com/stefa2k",
      "followers_url": "https://api.github.com/users/stefa2k/followers",
      "following_url": "https://api.github.com/users/stefa2k/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefa2k/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefa2k/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefa2k/subscriptions",
      "organizations_url": "https://api.github.com/users/stefa2k/orgs",
      "repos_url": "https://api.github.com/users/stefa2k/repos",
      "events_url": "https://api.github.com/users/stefa2k/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefa2k/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-06T06:47:10Z",
    "updated_at": "2023-01-06T06:47:10Z",
    "author_association": "NONE",
    "body": "> @stefa2k have you had a chance to update your config to use `--p2p-subscribe-all-subnets`? We might need to wait until your validators are chosen for a sync committee but it would be worth a try.\r\n\r\nNo change to Teku's behaviour with @ajsutton 's suggestions.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1373207428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1491407749",
    "html_url": "https://github.com/ConsenSys/teku/issues/6527#issuecomment-1491407749",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6527",
    "id": 1491407749,
    "node_id": "IC_kwDOCM9I9M5Y5ROF",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T06:58:40Z",
    "updated_at": "2023-03-31T06:58:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "User reported the issue has been fixed by not using the following CLI parameters anymore:\r\n--p2p-port\r\n--p2p-advertised-ip\r\n--p2p-advertised-port\r\n\r\nSo letting teku be on its default ports and autodetect its external ip and port.\r\n\r\nclosing the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1491407749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
