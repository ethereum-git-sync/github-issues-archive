{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2687",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2687/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2687/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2687/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2687",
  "id": 688080808,
  "node_id": "MDU6SXNzdWU2ODgwODA4MDg=",
  "number": 2687,
  "title": "Can't set metrics-host-allowlist to an IP address via a config file",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-08-28T13:36:15Z",
  "updated_at": "2020-08-28T21:33:56Z",
  "closed_at": "2020-08-28T21:33:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Setting an address in `--metrics-host-allowlist` via the command line works, but not via a config file.\r\n\r\n### Command line\r\n\r\nBoth of these work for accessing from the remote IP 192.168.1.253.\r\n\r\n```\r\nteku --config-file=tmp/test.yaml --metrics-host-allowlist='*'\r\nteku --config-file=tmp/test.yaml --metrics-host-allowlist=192.168.1.203\r\n```\r\n\r\n[Update: however, see user report below of it not working from the commandline either]\r\n\r\n### Config file\r\n\r\nHowever, I can get only `*` to work via the config file, not an address.\r\n\r\nThis works:\r\n```\r\nmetrics-host-allowlist: \"*\"\r\n```\r\n\r\nThese fail with `Host not authorized.`:\r\n```\r\nmetrics-host-allowlist: \"192.168.1.253\"\r\nmetrics-host-allowlist: [\"192.168.1.253\"]\r\nmetrics-host-allowlist: [192.168.1.253]\r\n```\r\n\r\n(The second one is as per [the docs](https://docs.teku.pegasys.tech/Reference/CLI/CLI-Syntax/#metrics-host-allowlist).)\r\n\r\nHere is the full (non-working) metrics config I am using:\r\n```\r\nmetrics-enabled: true\r\nmetrics-interface: \"0.0.0.0\"\r\nmetrics-port: 8009\r\nmetrics-host-allowlist: [\"192.168.1.253\"]\r\n```",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2687/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2687/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/682584910",
    "html_url": "https://github.com/ConsenSys/teku/issues/2687#issuecomment-682584910",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2687",
    "id": 682584910,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjU4NDkxMA==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T13:48:05Z",
    "updated_at": "2020-08-28T13:48:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Update from user `tjc_` on [Teku discord](https://discord.com/channels/697535391594446898/697539289042649190/748900007159267359):\r\n\r\nI continued to get `Host not authorized` from the command line. Here is what I ran:\r\n\r\n```\r\nteku --data-path=\"/var/eth/teku\" --network=\"medalla\" --eth1-endpoint=\"http://127.0.0.1:8545/\" --validator-keys=\"/var/eth/teku/validators/keystore-m_12381_3600_0_0_0-1598582155.json:/var/eth/teku/validators/password.txt\" --p2p-port=9001 --log-destination=CONSOLE --metrics-enabled=true --metrics-interface=0.0.0.0 --metrics-port=8008 --metrics-host-allowlist=ws2 --rest-api-enabled=true --rest-api-docs-enabled=true\r\n```\r\n\r\nEven though this machine can resolve `ws2` :\r\n\r\n```\r\n[teku@eth1 trevor]$ ping ws2\r\nPING ws2.XXX.XX (10.0.0.243) 56(84) bytes of data.\r\n64 bytes from ws2.XXX.XX (10.0.0.243): icmp_seq=1 ttl=64 time=0.344 ms\r\n64 bytes from ws2.XXX.XX (10.0.0.243): icmp_seq=2 ttl=64 time=0.329 ms\r\n```\r\n\r\nI did try using the IP address also:\r\n\r\n```\r\nteku --data-path=\"/var/eth/teku\" --network=\"medalla\" --eth1-endpoint=\"http://127.0.0.1:8545/\" --validator-keys=\"/var/eth/teku/validators/keystore-m_12381_3600_0_0_0-1598582155.json:/var/eth/teku/validators/password.txt\" --p2p-port=9001 --log-destination=CONSOLE --metrics-enabled=true --metrics-interface=0.0.0.0 --metrics-port=8008 --metrics-host-allowlist=10.0.0.243 --rest-api-enabled=true --rest-api-docs-enabled=true\r\n```\r\n\r\nWith the same result. From the command-line it worked when I set the allowlist to `\"*\"`",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/682584910/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/683156472",
    "html_url": "https://github.com/ConsenSys/teku/issues/2687#issuecomment-683156472",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2687",
    "id": 683156472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzE1NjQ3Mg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T21:33:56Z",
    "updated_at": "2020-08-28T21:33:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Discussed this on discord as well but for the historical record...\n\nThe `--metrics-host-allowlist` specifies which hosts are allowed in the http `Host` header to prevent DNS rebinding attacks. So it restricts the target host, not the source.  If you allow `192.168.1.253` then calling `http://192.168.1.253/metrics` will be allowed from any source. \n\nhttps://en.wikipedia.org/wiki/DNS_rebinding has some info on DNS Rebinding Attacks. Anything you can access on your local network without dns rebinding protection can be accessed to some extent from any webpage you visit which is why we enable this protection by default in Teku.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/683156472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
