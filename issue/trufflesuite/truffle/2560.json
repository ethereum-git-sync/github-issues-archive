{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2560",
  "id": 518100804,
  "node_id": "MDU6SXNzdWU1MTgxMDA4MDQ=",
  "number": 2560,
  "title": "@truffle/contract 'confirmation' listener cannot be configured",
  "user": {
    "login": "nventuro",
    "id": 2530770,
    "node_id": "MDQ6VXNlcjI1MzA3NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2530770?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nventuro",
    "html_url": "https://github.com/nventuro",
    "followers_url": "https://api.github.com/users/nventuro/followers",
    "following_url": "https://api.github.com/users/nventuro/following{/other_user}",
    "gists_url": "https://api.github.com/users/nventuro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nventuro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nventuro/subscriptions",
    "organizations_url": "https://api.github.com/users/nventuro/orgs",
    "repos_url": "https://api.github.com/users/nventuro/repos",
    "events_url": "https://api.github.com/users/nventuro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nventuro/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 230393329,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjk=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/help%20wanted",
      "name": "help wanted",
      "color": "159818",
      "default": true,
      "description": null
    },
    {
      "id": 1675042241,
      "node_id": "MDU6TGFiZWwxNjc1MDQyMjQx",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority5%20%F0%9F%8C%80",
      "name": "priority5 ðŸŒ€",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-11-05T22:46:52Z",
  "updated_at": "2021-02-24T20:05:18Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\n`@truffle/contract` registers a `'confirmation'` event listener, which gets fired every time there is a new block until the number of requested confirmations is reached. The default number of confirmations is 24, and there is no way to configure this value from the outside. \r\n\r\nThis means that sending a transaction via a `@truffle/contract` object will spawn a Node timeout object that will not be removed until 24 confirmations arrive, blocking the event loop and preventing the process from exiting. This is not an issue in `truffle test` because the CLI calls `process.exit()` directly.\r\n\r\nThis also causes performance issues, since 25 receipts will be requested to the provider _per transaction_, while often (e.g. in testing environments) a single confirmation is sufficient. \r\n\r\nIt'd be great if `@truffle/contract` had an API exposing the number of confirmations it requires from web3 (probably at the contract abstraction creation level, so that all instances have this same value).\r\n\r\nAdditionally, both `@truffle/contract` and `@truffle/interface-adapter` should be upgraded to use web3 v1.2.2, which [includes a fix for 'confirmation' events on HttpProviders](https://github.com/ethereum/web3.js/pull/3140).\r\n\r\n## Steps to Reproduce\r\n\r\nCreate a `@truffle/contract` object and send a transaction from it in a non-truffle environment (outside of `truffle test` or `truffle exec`), the process won't end until the contract receives 24 confirmations of the transaction being mined.\r\n\r\n## Environment\r\n\r\n`\"@truffle/contract\": \"^4.0.38\"`\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/550133646",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2560#issuecomment-550133646",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560",
    "id": 550133646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MDEzMzY0Ng==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-06T04:05:40Z",
    "updated_at": "2019-11-06T04:05:40Z",
    "author_association": "MEMBER",
    "body": "I'm in favor of making this configurable, if anyone wants to open a PR",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/550133646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/782477719",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2560#issuecomment-782477719",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560",
    "id": 782477719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjQ3NzcxOQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T00:30:07Z",
    "updated_at": "2021-02-20T00:30:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can this be closed now that we have `disableConfirmationListener`, or does more need to be done here?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/782477719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785214437",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2560#issuecomment-785214437",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560",
    "id": 785214437,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTIxNDQzNw==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T16:48:36Z",
    "updated_at": "2021-02-24T16:48:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "There might be some work to be done if people still want to be able to configure the number of confirmations (I'm not sure if that is supported yet). Like if someone wanted to specify to wait for 5 confirmations, then maybe they should have this option. I'm not sure if the `confirmations` property under networks here solves this issue? https://www.trufflesuite.com/docs/truffle/reference/configuration#networks",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785214437/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785338846",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2560#issuecomment-785338846",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2560",
    "id": 785338846,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTMzODg0Ng==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T20:05:18Z",
    "updated_at": "2021-02-24T20:05:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "That just affects waiting for confirmations after deployments, if I understand correctly; it doesn't affect the confirmation listener more generally.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785338846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
