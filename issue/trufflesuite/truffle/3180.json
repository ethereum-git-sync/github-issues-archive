{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3180",
  "id": 659847220,
  "node_id": "MDU6SXNzdWU2NTk4NDcyMjA=",
  "number": 3180,
  "title": "External compiler flags invalid bytecode for abstract contracts",
  "user": {
    "login": "shanecarey17",
    "id": 7001915,
    "node_id": "MDQ6VXNlcjcwMDE5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7001915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shanecarey17",
    "html_url": "https://github.com/shanecarey17",
    "followers_url": "https://api.github.com/users/shanecarey17/followers",
    "following_url": "https://api.github.com/users/shanecarey17/following{/other_user}",
    "gists_url": "https://api.github.com/users/shanecarey17/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shanecarey17/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shanecarey17/subscriptions",
    "organizations_url": "https://api.github.com/users/shanecarey17/orgs",
    "repos_url": "https://api.github.com/users/shanecarey17/repos",
    "events_url": "https://api.github.com/users/shanecarey17/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shanecarey17/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-07-18T02:59:17Z",
  "updated_at": "2020-10-07T18:06:33Z",
  "closed_at": "2020-10-07T18:06:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nExternal compiler complains about abstract contracts with no bytecode.\r\n\r\n## Steps to Reproduce\r\n\r\nI have three config files, one top level and two which refer to projects in subdirectories p1 and p2. I omitted some parts of the config I don't believe are important.\r\n\r\ntruffle.js\r\n\r\n```\r\ncompilers: {\r\n        external: {\r\n          command: 'bash truffle-compile.sh',\r\n          targets: [{\r\n              path: './artifacts/**/*.json'\r\n          }]\r\n        }\r\n   }\r\n```\r\n\r\ntruffle.p1.js\r\n\r\n```\r\ncontracts_build_directory: 'artifacts/p1/',\r\ncompilers: {\r\n    solc: {\r\n        version: '0.4.22'\r\n    }\r\n  }\r\n```\r\n\r\ntruffle.p2.js\r\n\r\n```\r\ncontracts_build_directory: 'artifacts/p2/',\r\ncompilers: {\r\n    solc: {\r\n        version: '0.5.16'\r\n    }\r\n  }\r\n```\r\n\r\ntruffle-compile.sh\r\n\r\n```\r\nnpx truffle compile --config truffle.p1.js\r\nnpx truffle compile --config truffle.p2.js\r\n```\r\n\r\n## Expected Behavior\r\n\r\nThe subproject compilation tasks should run with their respective compiler versions and put output into `artifacts/`. Then the targets path should move all of those outputs to the top level build directory (separate from subproject build directories).\r\n\r\n## Actual Results\r\n\r\nThere are interface classes in the subprojects which have a bytecode of `0x` in the outputted JSON. The contract schema flags these as invalid and does not move the contracts to the build folder. This validation either does not occur or does not fail with a direct call to `npx truffle compile --config truffle.p*.js`.\r\n\r\n```\r\nError: Schema validation failed. Errors:\r\n\r\nshould match pattern \"^0x0$|^0x([a-fA-F0-9]{2}|__.{38})+$\" (pattern):\r\n{\r\n  dataPath: '.bytecode',\r\n  schemaPath: '#/definitions/Bytecode/pattern',\r\n  params: { pattern: '^0x0$|^0x([a-fA-F0-9]{2}|__.{38})+$' },\r\n  **data: '0x',**\r\n  parentSchema: { type: 'string', pattern: '^0x0$|^0x([a-fA-F0-9]{2}|__.{38})+$' }\r\n}\r\n\r\n    at Object.validate (/node_modules/truffle/build/webpack:/packages/contract-schema/index.js:265:1)\r\n    at processTargets (/node_modules/truffle/build/webpack:/packages/external-compile/index.js:154:1)\r\n    at processTarget (/node_modules/truffle/build/webpack:/packages/external-compile/index.js:210:1)\r\n    at processTargets (/node_modules/truffle/build/webpack:/packages/external-compile/index.js:152:1)\r\n    at /node_modules/truffle/build/webpack:/packages/external-compile/index.js:263:1\r\nTruffle v5.1.35 (core: 5.1.35)\r\nNode v12.16.3\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: Mac OS X\r\n* Ethereum client: ganache\r\n* Truffle version (`truffle version`): v5.1.35\r\n* node version (`node --version`): v12.16.3\r\n* npm version (`npm --version`): 6.14.4\r\n",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/660727432",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3180#issuecomment-660727432",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180",
    "id": 660727432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2MDcyNzQzMg==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-19T23:37:04Z",
    "updated_at": "2020-07-19T23:37:04Z",
    "author_association": "MEMBER",
    "body": "Hm, good catch. I guess `0x` is a valid value for bytecode? I'll PR this shortly.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/660727432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/663749278",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3180#issuecomment-663749278",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180",
    "id": 663749278,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Mzc0OTI3OA==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-24T21:53:27Z",
    "updated_at": "2020-07-24T21:53:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think this issue may be resolved in Truffle 5.1.36, can you confirm?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/663749278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/705104489",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3180#issuecomment-705104489",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3180",
    "id": 705104489,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTEwNDQ4OQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T18:06:32Z",
    "updated_at": "2020-10-07T18:06:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like this has been fixed, closing.  Let us know if it's not.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/705104489/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
