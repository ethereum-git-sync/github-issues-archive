{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/6157",
  "id": 1825192144,
  "node_id": "I_kwDOAkfq-c5syjjQ",
  "number": 6157,
  "title": "Debugger shows incorrect value for a Yul variable",
  "user": {
    "login": "cds-amal",
    "id": 2529600,
    "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cds-amal",
    "html_url": "https://github.com/cds-amal",
    "followers_url": "https://api.github.com/users/cds-amal/followers",
    "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
    "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
    "organizations_url": "https://api.github.com/users/cds-amal/orgs",
    "repos_url": "https://api.github.com/users/cds-amal/repos",
    "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cds-amal/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-07-27T20:46:27Z",
  "updated_at": "2023-07-28T01:26:31Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "While evaluating #6154 I noticed this strange behavior where the expected value for a variable should be 0, but we get 1.\r\n\r\n## Steps to Reproduce\r\n\r\n1. Clone [this Repo](https://github.com/cds-amal/truffle-issue-6157)\r\n1. `truffle develop`\r\n1. ```javascript\r\n    truffle(develop) migrate\r\n    D = await DelegateTestYulString.deployed()\r\n    await D.setValue(\"Hello\")\r\n    // grab transaction hash\r\n    ```\r\n1. In a separate terminal console:\r\n    ```console\r\n    truffle debug --url http://127.0.0.1:9545 txhash\r\n    b YulString.yul:179\r\n    c\r\n    :v\r\n    # expect 0, but got 1\r\n    ```\r\n   \r\n## Environment\r\n\r\n* Operating System: linux\r\n* Ethereum client: truffle develop console\r\n* Truffle version PR #6154 \r\n* node version (`node --version`): 18.16.1\r\n* npm version (`npm --version`): 9.5.1\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654662618",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6157#issuecomment-1654662618",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157",
    "id": 1654662618,
    "node_id": "IC_kwDOAkfq-c5ioCXa",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-27T22:25:35Z",
    "updated_at": "2023-07-27T22:25:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, yeah, looks like the debugger is getting wrong the stack slots for Yul return variables.  Will have to see just what's going on there.  Oy, like that code isn't hairy enough already...!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654662618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654752945",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6157#issuecomment-1654752945",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157",
    "id": 1654752945,
    "node_id": "IC_kwDOAkfq-c5ioYax",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-27T23:29:11Z",
    "updated_at": "2023-07-27T23:29:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, this is very annoying.  It looks like the problem is due to the optimizer -- it'll run on straight Yul code where it wouldn't on a Solidity `assembly` block.  Even if you set `enabled: false`, even if you set `yul: false`, it'll still do it.  The only way I found to turn it off was to set `yul: true` (!), and then use `yulDetails` to turn everything off.  Once you do *that*, things work fine. :-/\r\n\r\nSince it's due to the optimizer, I'm not sure if I can do much about this; but it's very annoying because, like, the optimizer is basically going to always be on in this case!  Ugh...",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654752945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654754299",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6157#issuecomment-1654754299",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157",
    "id": 1654754299,
    "node_id": "IC_kwDOAkfq-c5ioYv7",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-27T23:30:54Z",
    "updated_at": "2023-07-27T23:30:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "(Maybe should file an issue with Solidity about this...?  Or at least go ask them about it...)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654754299/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654840020",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6157#issuecomment-1654840020",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6157",
    "id": 1654840020,
    "node_id": "IC_kwDOAkfq-c5iotrU",
    "user": {
      "login": "cds-amal",
      "id": 2529600,
      "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds-amal",
      "html_url": "https://github.com/cds-amal",
      "followers_url": "https://api.github.com/users/cds-amal/followers",
      "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
      "organizations_url": "https://api.github.com/users/cds-amal/orgs",
      "repos_url": "https://api.github.com/users/cds-amal/repos",
      "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds-amal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-28T01:26:31Z",
    "updated_at": "2023-07-28T01:26:31Z",
    "author_association": "MEMBER",
    "body": "> (Maybe should file an issue with Solidity about this...? Or at least go ask them about it...)\r\n\r\nSeems like a good idea to raise it with them. Can you do that please?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1654840020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
