{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/770",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/770",
  "id": 291345625,
  "node_id": "MDU6SXNzdWUyOTEzNDU2MjU=",
  "number": 770,
  "title": "Assert.sol - Bug in `Assert.notEqual` for list types",
  "user": {
    "login": "sabhiram",
    "id": 2693144,
    "node_id": "MDQ6VXNlcjI2OTMxNDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2693144?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sabhiram",
    "html_url": "https://github.com/sabhiram",
    "followers_url": "https://api.github.com/users/sabhiram/followers",
    "following_url": "https://api.github.com/users/sabhiram/following{/other_user}",
    "gists_url": "https://api.github.com/users/sabhiram/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sabhiram/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sabhiram/subscriptions",
    "organizations_url": "https://api.github.com/users/sabhiram/orgs",
    "repos_url": "https://api.github.com/users/sabhiram/repos",
    "events_url": "https://api.github.com/users/sabhiram/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sabhiram/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-01-24T20:17:53Z",
  "updated_at": "2018-01-26T00:06:56Z",
  "closed_at": "2018-01-26T00:06:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "When working on https://github.com/trufflesuite/truffle/pull/769, I was reviewing your pattern for error reporting and noticed that you have a bug in the case where two equal length arrays with different values will fail the `Assert.notEqual` check. \r\n\r\nLets say `a` contains `[1,2]` and `b` contains `[3, 4]`, you would expect `Assert.notEqual(a, b, \"a not equal to b\");` to return true since they are not equal to each other. However, due to the way that this case is handled, the function incorrectly treats them as equal.\r\n\r\nHere is a short test case to illustrate the point. Below, the `testEqual_GOOD()` does the right thing and asserts, while the `testNotEqual_BAD()` throws an assert even though the two arrays are clearly not equal (but have the same length). Notice that if the arrays are of different lengths - everything is a-ok (`testNotEqual_GOOD()`).\r\n\r\n```\r\n\tint[] a;\r\n\tint[] b;\r\n\tint[] c;\r\n\tfunction beforeAll() public {\r\n\t\ta.push(1);\r\n\t\ta.push(2);\r\n\t\tb.push(3);\r\n\t\tb.push(4);\r\n\t\tc.push(5);\r\n\t}\r\n\r\n\t// Should assert and it does.\r\n\tfunction testEqual_GOOD() public {\r\n\t\tAssert.equal(a, b, \"a and b are equal\"); \r\n\t}\r\n\r\n\t// Should not assert (a and b are in fact not equal).\r\n\tfunction testNotEqual_BAD() public {\r\n\t\tAssert.notEqual(a, b, \"a and b are not equal\");\r\n\t}\r\n\r\n\t// Should not assert (a and c are in fact not equal).\r\n\tfunction testNotEqual_GOOD() public {\r\n\t\tAssert.notEqual(a, c, \"a and c are not equal\");\r\n\t}\r\n```\r\n\r\nThis error occurs due to the fact that you guys employ a negation trick on the call to `_report` for these cases since the variable `r` captures the equality of the lengths of the arrays being compared. If the lengths do not match, this works great. The bug lives in the code where on a match (not equal is true) - the code sets `r` to true which is later negated. \r\n\r\nI will send you a patch shortly :)\r\n\r\n",
  "closed_by": {
    "login": "sabhiram",
    "id": 2693144,
    "node_id": "MDQ6VXNlcjI2OTMxNDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2693144?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sabhiram",
    "html_url": "https://github.com/sabhiram",
    "followers_url": "https://api.github.com/users/sabhiram/followers",
    "following_url": "https://api.github.com/users/sabhiram/following{/other_user}",
    "gists_url": "https://api.github.com/users/sabhiram/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sabhiram/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sabhiram/subscriptions",
    "organizations_url": "https://api.github.com/users/sabhiram/orgs",
    "repos_url": "https://api.github.com/users/sabhiram/repos",
    "events_url": "https://api.github.com/users/sabhiram/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sabhiram/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/770/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360260874",
    "html_url": "https://github.com/trufflesuite/truffle/issues/770#issuecomment-360260874",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770",
    "id": 360260874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDI2MDg3NA==",
    "user": {
      "login": "sabhiram",
      "id": 2693144,
      "node_id": "MDQ6VXNlcjI2OTMxNDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2693144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sabhiram",
      "html_url": "https://github.com/sabhiram",
      "followers_url": "https://api.github.com/users/sabhiram/followers",
      "following_url": "https://api.github.com/users/sabhiram/following{/other_user}",
      "gists_url": "https://api.github.com/users/sabhiram/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sabhiram/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sabhiram/subscriptions",
      "organizations_url": "https://api.github.com/users/sabhiram/orgs",
      "repos_url": "https://api.github.com/users/sabhiram/repos",
      "events_url": "https://api.github.com/users/sabhiram/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sabhiram/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-24T20:20:14Z",
    "updated_at": "2018-01-26T00:03:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, here is the output from `truffle test`:\r\n```\r\n    1) testEqual_GOOD\r\n\r\n    Events emitted during test:\r\n    ---------------------------\r\n\r\n    TestEvent(result: <indexed>, message: a and b are equal)\r\n\r\n    ---------------------------\r\n    2) testNotEqual_BAD\r\n\r\n    Events emitted during test:\r\n    ---------------------------\r\n\r\n    TestEvent(result: <indexed>, message: a and b are not equal)\r\n\r\n    ---------------------------\r\n    âœ“ testNotEqual_GOOD (38ms)\r\n\r\n\r\n  1 passing (631ms)\r\n  2 failing\r\n\r\n  1) Test testEqual_GOOD:\r\n     Error: a and b are equal\r\n\r\n  2) Test testNotEqual_BAD:\r\n     Error: a and b are not equal\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360260874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360263466",
    "html_url": "https://github.com/trufflesuite/truffle/issues/770#issuecomment-360263466",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770",
    "id": 360263466,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDI2MzQ2Ng==",
    "user": {
      "login": "sabhiram",
      "id": 2693144,
      "node_id": "MDQ6VXNlcjI2OTMxNDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2693144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sabhiram",
      "html_url": "https://github.com/sabhiram",
      "followers_url": "https://api.github.com/users/sabhiram/followers",
      "following_url": "https://api.github.com/users/sabhiram/following{/other_user}",
      "gists_url": "https://api.github.com/users/sabhiram/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sabhiram/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sabhiram/subscriptions",
      "organizations_url": "https://api.github.com/users/sabhiram/orgs",
      "repos_url": "https://api.github.com/users/sabhiram/repos",
      "events_url": "https://api.github.com/users/sabhiram/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sabhiram/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-24T20:29:55Z",
    "updated_at": "2018-01-24T20:29:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "This actually will also fail when the very first element of the arrays match. The code goes like this:\r\n```\r\n    function notEqual(int[] arrA, int[] arrB, string message) public returns (bool) {\r\n        var r = arrA.length == arrB.length;\r\n        if (r) {\r\n            for (uint i = 0; i < arrA.length; i++) {\r\n                if (arrA[i] == arrB[i]) {\r\n                    r = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        _report(!r, message);\r\n    }\r\n```\r\n\r\nSo if `a = [1,2]` and `b = [1,4]` - it will consider them equal and throw an assert when checking `notEqual`. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360263466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360265547",
    "html_url": "https://github.com/trufflesuite/truffle/issues/770#issuecomment-360265547",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770",
    "id": 360265547,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDI2NTU0Nw==",
    "user": {
      "login": "sabhiram",
      "id": 2693144,
      "node_id": "MDQ6VXNlcjI2OTMxNDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2693144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sabhiram",
      "html_url": "https://github.com/sabhiram",
      "followers_url": "https://api.github.com/users/sabhiram/followers",
      "following_url": "https://api.github.com/users/sabhiram/following{/other_user}",
      "gists_url": "https://api.github.com/users/sabhiram/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sabhiram/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sabhiram/subscriptions",
      "organizations_url": "https://api.github.com/users/sabhiram/orgs",
      "repos_url": "https://api.github.com/users/sabhiram/repos",
      "events_url": "https://api.github.com/users/sabhiram/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sabhiram/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-24T20:37:39Z",
    "updated_at": "2018-01-24T20:37:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "PR#769 contains the fix for this as well. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360265547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360642729",
    "html_url": "https://github.com/trufflesuite/truffle/issues/770#issuecomment-360642729",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/770",
    "id": 360642729,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDY0MjcyOQ==",
    "user": {
      "login": "sabhiram",
      "id": 2693144,
      "node_id": "MDQ6VXNlcjI2OTMxNDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2693144?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sabhiram",
      "html_url": "https://github.com/sabhiram",
      "followers_url": "https://api.github.com/users/sabhiram/followers",
      "following_url": "https://api.github.com/users/sabhiram/following{/other_user}",
      "gists_url": "https://api.github.com/users/sabhiram/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sabhiram/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sabhiram/subscriptions",
      "organizations_url": "https://api.github.com/users/sabhiram/orgs",
      "repos_url": "https://api.github.com/users/sabhiram/repos",
      "events_url": "https://api.github.com/users/sabhiram/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sabhiram/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T00:06:56Z",
    "updated_at": "2018-01-26T00:06:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this in favor of https://github.com/trufflesuite/truffle-core/issues/101",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/360642729/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
