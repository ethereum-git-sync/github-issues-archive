{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1769",
  "id": 415162965,
  "node_id": "MDU6SXNzdWU0MTUxNjI5NjU=",
  "number": 1769,
  "title": "Ganache accounts ether amounts not refreshed after subsequent truffle test calls",
  "user": {
    "login": "isaacsultan",
    "id": 16841500,
    "node_id": "MDQ6VXNlcjE2ODQxNTAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16841500?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/isaacsultan",
    "html_url": "https://github.com/isaacsultan",
    "followers_url": "https://api.github.com/users/isaacsultan/followers",
    "following_url": "https://api.github.com/users/isaacsultan/following{/other_user}",
    "gists_url": "https://api.github.com/users/isaacsultan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/isaacsultan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/isaacsultan/subscriptions",
    "organizations_url": "https://api.github.com/users/isaacsultan/orgs",
    "repos_url": "https://api.github.com/users/isaacsultan/repos",
    "events_url": "https://api.github.com/users/isaacsultan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/isaacsultan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 644098328,
      "node_id": "MDU6TGFiZWw2NDQwOTgzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20reproduced",
      "name": "needs reproduced",
      "color": "fbca04",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-02-27T14:50:51Z",
  "updated_at": "2019-02-28T13:50:41Z",
  "closed_at": "2019-02-28T13:50:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen `ganache-cli` and `truffle test` used: (sorry not sure which repo to file this in)\r\n\r\nI've noticed that when sending an amount of ether on the `development` blockchain from one account to another, on the next `truffle test` calls, the account balances are not restored to 100 ether, but maintain the amount from the previous test. \r\n\r\n## Steps to Reproduce\r\n\r\nPushed up the [repo](https://github.com/isaacsultan/workshop/tree/master) as seems like an important issue:\r\n\r\n## Expected Behavior\r\n\r\nWe should expect the [`console.log`] (https://github.com/isaacsultan/workshop/blob/53332190fc69c67b149414ef2449584010170d63/test/Loan.test.js#L90) to be `99895717520000000000` for each separate call of truffle test.\r\n\r\n## Actual Results\r\n\r\n```\r\nUNKNOWN:workshop isaacsultan$ truffle test\r\nUsing network 'development'.\r\n\r\nCompiling ./contracts/Loan.sol...\r\nCompiling ./contracts/mocks/ERC20Mock.sol...\r\n\r\nCompilation warnings encountered:\r\n\r\n/Users/isaacsultan/PartialF-Isaac/workshop/contracts/Loan.sol:73:5: Warning: Function state mutability can be restricted to view\r\n    function isCollateralized\r\n    ^ (Relevant source part starts here and spans across multiple lines).\r\n\r\n\r\n\r\n  Contract: Loan\r\n    #createLoan\r\n      âœ“ should revert if not fully collateralized\r\n      âœ“ should revert if the collateral address is unregistered\r\n      âœ“ should revert if there is not enough ether to send to the user\r\n      loan is funded with ether\r\n99895717520000000000\r\n        âœ“ should revert if the user has an outstanding loan (101ms)\r\n\r\n\r\n  4 passing (2s)\r\n\r\nUNKNOWN:workshop isaacsultan$ truffle test\r\nUsing network 'development'.\r\n\r\nCompiling ./contracts/Loan.sol...\r\nCompiling ./contracts/mocks/ERC20Mock.sol...\r\n\r\nCompilation warnings encountered:\r\n\r\n/Users/isaacsultan/PartialF-Isaac/workshop/contracts/Loan.sol:73:5: Warning: Function state mutability can be restricted to view\r\n    function isCollateralized\r\n    ^ (Relevant source part starts here and spans across multiple lines).\r\n\r\n\r\n\r\n  Contract: Loan\r\n    #createLoan\r\n      âœ“ should revert if not fully collateralized\r\n      âœ“ should revert if the collateral address is unregistered\r\n      âœ“ should revert if there is not enough ether to send to the user\r\n      loan is funded with ether\r\n69791435040000000000\r\n        âœ“ should revert if the user has an outstanding loan (73ms)\r\n\r\n\r\n  4 passing (2s)\r\n\r\nUNKNOWN:workshop isaacsultan$ truffle test\r\nUsing network 'development'.\r\n\r\nCompiling ./contracts/Loan.sol...\r\nCompiling ./contracts/mocks/ERC20Mock.sol...\r\n\r\nCompilation warnings encountered:\r\n\r\n/Users/isaacsultan/PartialF-Isaac/workshop/contracts/Loan.sol:73:5: Warning: Function state mutability can be restricted to view\r\n    function isCollateralized\r\n    ^ (Relevant source part starts here and spans across multiple lines).\r\n\r\n\r\n\r\n  Contract: Loan\r\n    #createLoan\r\n      âœ“ should revert if not fully collateralized\r\n      âœ“ should revert if the collateral address is unregistered\r\n      âœ“ should revert if there is not enough ether to send to the user\r\n      loan is funded with ether\r\n39687152560000000000\r\n        âœ“ should revert if the user has an outstanding loan (76ms)\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: 10.14 \r\n* Truffle version (`truffle version`): v5.0.5\r\n* node version (`node --version`): v10.14.2\r\n* npm version (`npm --version`): 6.4.1\r\n* ganache-cli: Ganache CLI v6.3.0 (ganache-core: 2.4.0)\r\n",
  "closed_by": {
    "login": "isaacsultan",
    "id": 16841500,
    "node_id": "MDQ6VXNlcjE2ODQxNTAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16841500?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/isaacsultan",
    "html_url": "https://github.com/isaacsultan",
    "followers_url": "https://api.github.com/users/isaacsultan/followers",
    "following_url": "https://api.github.com/users/isaacsultan/following{/other_user}",
    "gists_url": "https://api.github.com/users/isaacsultan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/isaacsultan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/isaacsultan/subscriptions",
    "organizations_url": "https://api.github.com/users/isaacsultan/orgs",
    "repos_url": "https://api.github.com/users/isaacsultan/repos",
    "events_url": "https://api.github.com/users/isaacsultan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/isaacsultan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467927215",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1769#issuecomment-467927215",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769",
    "id": 467927215,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzkyNzIxNQ==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-27T16:18:39Z",
    "updated_at": "2019-02-27T16:19:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @isaacsultan !\r\n\r\nAre you running `ganache-cli` in a separate window while running these tests?\r\n\r\nIf you use the default `test` network (spins up when no networks are defined in your project's `truffle-config.js`), each round of tests should use a clean chain state.\r\n\r\nOtherwise, with `ganache-cli` running separately in the background somewhere, the evm state will be saved and re-used by each test run.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467927215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467935850",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1769#issuecomment-467935850",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769",
    "id": 467935850,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzkzNTg1MA==",
    "user": {
      "login": "isaacsultan",
      "id": 16841500,
      "node_id": "MDQ6VXNlcjE2ODQxNTAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16841500?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/isaacsultan",
      "html_url": "https://github.com/isaacsultan",
      "followers_url": "https://api.github.com/users/isaacsultan/followers",
      "following_url": "https://api.github.com/users/isaacsultan/following{/other_user}",
      "gists_url": "https://api.github.com/users/isaacsultan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/isaacsultan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/isaacsultan/subscriptions",
      "organizations_url": "https://api.github.com/users/isaacsultan/orgs",
      "repos_url": "https://api.github.com/users/isaacsultan/repos",
      "events_url": "https://api.github.com/users/isaacsultan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/isaacsultan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-27T16:39:41Z",
    "updated_at": "2019-02-27T16:39:41Z",
    "author_association": "NONE",
    "body": "Hey @CruzMolina , thanks for getting back to me so quickly! The default `test` network is being use, as no networks are defined in my config.\r\n\r\nHowever, I am running `ganache-cli` in a separate window. What would the alternative be, in order to have a clean chain state?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467935850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467943380",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1769#issuecomment-467943380",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769",
    "id": 467943380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2Nzk0MzM4MA==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-27T16:58:53Z",
    "updated_at": "2019-02-27T16:58:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh! Well if you're using the default `test` network, no need to run `ganache-cli` separately. Truffle will/should spin up `ganache-cli` as a background/child process on every `truffle test` run (and terminate it after the tests are done running).\r\n\r\nIn your situation, truffle must be connecting to the `development` chain running separately rather than starting up its own internally.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467943380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467945578",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1769#issuecomment-467945578",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769",
    "id": 467945578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2Nzk0NTU3OA==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-27T17:04:31Z",
    "updated_at": "2019-02-27T17:04:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "@isaacsultan realized I didn't directly answer your question ðŸ˜‚ .\r\n\r\nTo have a clean chain state on each `truffle test` run, don't run `ganache-cli` separately and have truffle use the default `test` network (no networks defined in the config).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/467945578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/468279311",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1769#issuecomment-468279311",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1769",
    "id": 468279311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2ODI3OTMxMQ==",
    "user": {
      "login": "isaacsultan",
      "id": 16841500,
      "node_id": "MDQ6VXNlcjE2ODQxNTAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16841500?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/isaacsultan",
      "html_url": "https://github.com/isaacsultan",
      "followers_url": "https://api.github.com/users/isaacsultan/followers",
      "following_url": "https://api.github.com/users/isaacsultan/following{/other_user}",
      "gists_url": "https://api.github.com/users/isaacsultan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/isaacsultan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/isaacsultan/subscriptions",
      "organizations_url": "https://api.github.com/users/isaacsultan/orgs",
      "repos_url": "https://api.github.com/users/isaacsultan/repos",
      "events_url": "https://api.github.com/users/isaacsultan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/isaacsultan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-28T13:50:40Z",
    "updated_at": "2019-02-28T13:50:40Z",
    "author_association": "NONE",
    "body": "@CruzMolina Thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/468279311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
