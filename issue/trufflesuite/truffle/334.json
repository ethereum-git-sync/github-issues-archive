{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/334",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/334",
  "id": 203749055,
  "node_id": "MDU6SXNzdWUyMDM3NDkwNTU=",
  "number": 334,
  "title": "Large int causes throws to fail during testing. ",
  "user": {
    "login": "barryWhiteHat",
    "id": 22997678,
    "node_id": "MDQ6VXNlcjIyOTk3Njc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/22997678?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barryWhiteHat",
    "html_url": "https://github.com/barryWhiteHat",
    "followers_url": "https://api.github.com/users/barryWhiteHat/followers",
    "following_url": "https://api.github.com/users/barryWhiteHat/following{/other_user}",
    "gists_url": "https://api.github.com/users/barryWhiteHat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barryWhiteHat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barryWhiteHat/subscriptions",
    "organizations_url": "https://api.github.com/users/barryWhiteHat/orgs",
    "repos_url": "https://api.github.com/users/barryWhiteHat/repos",
    "events_url": "https://api.github.com/users/barryWhiteHat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barryWhiteHat/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2017-01-27T21:50:46Z",
  "updated_at": "2017-02-22T17:58:10Z",
  "closed_at": "2017-02-22T17:58:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ https://gitter.im/ConsenSys/truffle?at=588b6bcbdcb66e4f76bae841] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\nWhen passing a large uint throw does not work. \r\n\r\n## Steps to Reproduce\r\ncontract\r\n```\r\n function AddKey(address owner, uint256 PubKey) returns(uint) { throw; }\r\n```\r\n```\r\nvar PubKey = 260652911456477803323683869567310326260426673437970818576857965924962545969307\r\ntl.AddKey(owner,PubKey)\r\n``` this does not thorw\r\n\r\nset ```\r\nvar PubKey = 2606529\r\ntl.AddKey(owner,PubKey)\r\n```\r\nThis throws. \r\n\r\n## Expected Behavior\r\n\r\nShow throw both times\r\n\r\n## Actual Results\r\nOnly throws when there is a small int passed\r\n\r\n```\r\nCompiling EC.sol...\r\nCompiling TimeLock.sol...\r\n  Contract: TimeLock:\r\n    ✓ check adding new key\r\n  1 passing (171ms)\r\n```\r\nCompiling EC.sol...\r\nCompiling TimeLock.sol...\r\n  Contract: TimeLock: \r\n    ✓ check adding new key\r\n  1 passing (181ms)\r\n/usr/local/lib/node_modules/truffle/lib/test.js:322\r\n          throw reason;\r\n          ^\r\nError: VM Exception while processing transaction: invalid JUMP at d572ee0fb129179cf2540b6dad8f56986a6b80bbc24f590d3de6cd657f24c99a/fed18b7fbdbd03a8c1f899fde536844251e9a2f5:2207\r\n    at Object.module.exports.InvalidResponse (/usr/local/lib/node_modules/truffle/node_modules/ether-pudding/node_modules/web3/lib/web3/errors.js:35:16)\r\n    at /usr/local/lib/node_modules/truffle/node_modules/ether-pudding/node_modules/web3/lib/web3/requestmanager.js:86:36\r\n    at request.onreadystatechange (/usr/local/lib/node_modules/truffle/node_modules/web3/lib/web3/httpprovider.js:114:13)\r\n    at dispatchEvent (/usr/local/lib/node_modules/truffle/node_modules/xmlhttprequest/lib/XMLHttpRequest.js:591:25)\r\n    at setState (/usr/local/lib/node_modules/truffle/node_modules/xmlhttprequest/lib/XMLHttpRequest.js:610:14)\r\n    at IncomingMessage.<anonymous> (/usr/local/lib/node_modules/truffle/node_modules/xmlhttprequest/lib/XMLHttpRequest.js:447:13)\r\n    at emitNone (events.js:91:20)\r\n    at IncomingMessage.emit (events.js:185:7)\r\n    at endReadableNT (_stream_readable.js:934:12)\r\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\r\n    at process._tickDomainCallback (internal/process/next_tick.js:122:9)\r\n```\r\n\r\n\r\n## Environment\r\n\r\n* Operating System: Linux dev-s 4.4.0-59-generic #80-Ubuntu SMP Fri Jan 6 17:47:47 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n* Truffle version: Truffle v2.1.1\r\n* Ethereum client: testrpc\r\n* node version: v6.2.2\r\n* npm version: 4.2.0\r\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/334/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/275797526",
    "html_url": "https://github.com/trufflesuite/truffle/issues/334#issuecomment-275797526",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334",
    "id": 275797526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTc5NzUyNg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-27T22:56:39Z",
    "updated_at": "2017-01-27T22:56:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm having trouble determining what your test looks like. Can you show that here? Also, would you mind sharing the full contract code? What you typed looks jumbled.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/275797526/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/275800586",
    "html_url": "https://github.com/trufflesuite/truffle/issues/334#issuecomment-275800586",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334",
    "id": 275800586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTgwMDU4Ng==",
    "user": {
      "login": "barryWhiteHat",
      "id": 22997678,
      "node_id": "MDQ6VXNlcjIyOTk3Njc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/22997678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barryWhiteHat",
      "html_url": "https://github.com/barryWhiteHat",
      "followers_url": "https://api.github.com/users/barryWhiteHat/followers",
      "following_url": "https://api.github.com/users/barryWhiteHat/following{/other_user}",
      "gists_url": "https://api.github.com/users/barryWhiteHat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barryWhiteHat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barryWhiteHat/subscriptions",
      "organizations_url": "https://api.github.com/users/barryWhiteHat/orgs",
      "repos_url": "https://api.github.com/users/barryWhiteHat/repos",
      "events_url": "https://api.github.com/users/barryWhiteHat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barryWhiteHat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-27T23:16:44Z",
    "updated_at": "2017-01-27T23:16:44Z",
    "author_association": "NONE",
    "body": "Let me make a cut down version. ;-)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/275800586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/275803441",
    "html_url": "https://github.com/trufflesuite/truffle/issues/334#issuecomment-275803441",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334",
    "id": 275803441,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NTgwMzQ0MQ==",
    "user": {
      "login": "barryWhiteHat",
      "id": 22997678,
      "node_id": "MDQ6VXNlcjIyOTk3Njc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/22997678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barryWhiteHat",
      "html_url": "https://github.com/barryWhiteHat",
      "followers_url": "https://api.github.com/users/barryWhiteHat/followers",
      "following_url": "https://api.github.com/users/barryWhiteHat/following{/other_user}",
      "gists_url": "https://api.github.com/users/barryWhiteHat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barryWhiteHat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barryWhiteHat/subscriptions",
      "organizations_url": "https://api.github.com/users/barryWhiteHat/orgs",
      "repos_url": "https://api.github.com/users/barryWhiteHat/repos",
      "events_url": "https://api.github.com/users/barryWhiteHat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barryWhiteHat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-01-27T23:36:39Z",
    "updated_at": "2017-01-27T23:36:39Z",
    "author_association": "NONE",
    "body": "```\r\ncontract('TimeLock: ', function(accounts) {\r\n\r\n  it(\"case 1\", function() {\r\n    tl = TimeLock.deployed()\r\n\r\n    var owner = accounts[0];\r\n    var n = \"115445564387450941991481732409838921121340329898388495706040442841335199756800587903149000898261945340856676784874918657347633307906756071132017391584489476929371087400989053221067789100989201919954123911970375286114309401587894170767865638539376215996124429737040410789718880530497880688634519689153366810989\";\r\n    tl.AddKey(owner,n)\r\n  });\r\n\r\n  it(\"case 2\", function() {\r\n    tl = TimeLock.deployed()\r\n    var owner = accounts[0];\r\n    var n = 115445564387450941991481732409838921121340329898388495706040442841335199756800587903149000898261945340856676784874918657347633307906756071132017391584489476929371087400989053221067789100989201919954123911970375286114309401587894170767865638539376215996124429737040410789718880530497880688634519689153366810989;\r\n    tl.AddKey(owner,n)\r\n  });\r\n\r\n/*  it(\"case 3\", function() {\r\n    tl = TimeLock.deployed()\r\n\r\n    var owner = accounts[0];\r\n    var n = 123;\r\n    tl.AddKey(owner,n)\r\n  }); */\r\n\r\n});\r\n```\r\n\r\n```\r\npragma solidity ^0.4.8;\r\n\r\n\r\n\r\ncontract TimeLock {\r\n    function TimeLock() {\r\n    }\r\n\r\n    function AddKey(address owner, uint256 PubKey) returns(uint) {\r\n        throw;\r\n    }\r\n}\r\n```\r\n\r\nCase 1 and 2 pass when they should fail. Case 3 fails which is the expected behavior. I reinitialized my truffle project and copied the test and contract over.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/275803441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/281749174",
    "html_url": "https://github.com/trufflesuite/truffle/issues/334#issuecomment-281749174",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/334",
    "id": 281749174,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MTc0OTE3NA==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-22T17:58:10Z",
    "updated_at": "2017-02-22T17:58:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "There's a couple issues here. \r\n\r\n### Your tests aren't actually testing anything\r\n\r\nA test needs to assert, or fail when things fail. When there's a failure (like when that `throw` is executed) there's no way for the testing framework to know that because you haven't wired up the test correctly. `tl.AddKey(owner,n)` returns a promise, and you're not making that promise available to the testing framework. To do so, you need to `return` the promise, i.e., \r\n\r\n```\r\nreturn tl.AddKey(owner,n);\r\n```\r\n\r\nIf the promise fails, then, the testing framework will know about it and report it successfully. \r\n\r\nThis is the cause of your passing tests that should fail; you haven't told the framework about the failure, and so everything else -- i.e., the large integers -- are just a red herring and aren't the actually problem in this case.\r\n\r\nHowever, we might as well address the large integer problem since you mentioned it. \r\n\r\n### You're not correctly representing large integers in Javascript and with web3\r\n\r\nJavascript [will only support integers +/- 9007199254740991](http://stackoverflow.com/questions/307179/what-is-javascripts-highest-integer-value-that-a-number-can-go-to-without-losin), so case 2 won't send the integer you're expecting simply because Javascript doesn't support a number that large. Case 1 _likely_ won't send the number you expect because that number is a string, and web3 needs to know that you intend to represent a decimal number with that string and not something else (i.e., a hexadecimal number). web3 *might* know, but to ensure it does, use `web3.toBigNumber(your_number)` to be sure before passing it to your function.\r\n\r\nI'm going to go ahead and close this ticket, as this should be the information that you need. Feel free to open a new ticket if you run into an issue.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/281749174/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
