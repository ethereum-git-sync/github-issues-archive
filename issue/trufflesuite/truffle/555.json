{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/555",
  "id": 254793048,
  "node_id": "MDU6SXNzdWUyNTQ3OTMwNDg=",
  "number": 555,
  "title": "Feature request: global registry for events",
  "user": {
    "login": "cag",
    "id": 298447,
    "node_id": "MDQ6VXNlcjI5ODQ0Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/298447?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cag",
    "html_url": "https://github.com/cag",
    "followers_url": "https://api.github.com/users/cag/followers",
    "following_url": "https://api.github.com/users/cag/following{/other_user}",
    "gists_url": "https://api.github.com/users/cag/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cag/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cag/subscriptions",
    "organizations_url": "https://api.github.com/users/cag/orgs",
    "repos_url": "https://api.github.com/users/cag/repos",
    "events_url": "https://api.github.com/users/cag/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cag/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 971535741,
      "node_id": "MDU6TGFiZWw5NzE1MzU3NDE=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Artifacts",
      "name": "Artifacts",
      "color": "bfb8fc",
      "default": false,
      "description": ""
    },
    {
      "id": 1120350502,
      "node_id": "MDU6TGFiZWwxMTIwMzUwNTAy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/stale",
      "name": "stale",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2017-09-02T06:21:04Z",
  "updated_at": "2018-11-15T09:10:26Z",
  "closed_at": "2018-11-15T09:10:26Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Suppose there are two contracts: `A.sol` and `B.sol`. `A` has a method which does a delegatecall to an arbitrary contract. `B` has a method which logs some events. Since `A` doesn't have the event declaration, the contract artifact doesn't get the event info when the migration is run, and as a result, B's event log doesn't get parsed by A's `truffle-contract` if A delegatecalls B. However, `truffle test` _does_ catch and parse the B's event log when A delegatecalls B. Furthermore, if B's event declaration gets copied into A, A will catch and parse the event log when it delegatecalls B.\r\n\r\nTo solve this, I propose a global registry for events which automatically add the parsing metadata for contracts as they get initialized so that those logs can be parsed even when they are produced in a different contract's context.",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/555/reactions",
    "total_count": 4,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/370235160",
    "html_url": "https://github.com/trufflesuite/truffle/issues/555#issuecomment-370235160",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
    "id": 370235160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDIzNTE2MA==",
    "user": {
      "login": "snario",
      "id": 1933029,
      "node_id": "MDQ6VXNlcjE5MzMwMjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1933029?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/snario",
      "html_url": "https://github.com/snario",
      "followers_url": "https://api.github.com/users/snario/followers",
      "following_url": "https://api.github.com/users/snario/following{/other_user}",
      "gists_url": "https://api.github.com/users/snario/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/snario/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/snario/subscriptions",
      "organizations_url": "https://api.github.com/users/snario/orgs",
      "repos_url": "https://api.github.com/users/snario/repos",
      "events_url": "https://api.github.com/users/snario/events{/privacy}",
      "received_events_url": "https://api.github.com/users/snario/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-04T14:52:40Z",
    "updated_at": "2018-03-04T14:52:40Z",
    "author_association": "NONE",
    "body": "As proxy contract schemes like what Gnosis does [here](https://github.com/gnosis/gnosis-safe-contracts/tree/master/contracts) become more common, this will be quite helpful.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/370235160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/404101607",
    "html_url": "https://github.com/trufflesuite/truffle/issues/555#issuecomment-404101607",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
    "id": 404101607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDEwMTYwNw==",
    "user": {
      "login": "elenadimitrova",
      "id": 703848,
      "node_id": "MDQ6VXNlcjcwMzg0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/703848?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elenadimitrova",
      "html_url": "https://github.com/elenadimitrova",
      "followers_url": "https://api.github.com/users/elenadimitrova/followers",
      "following_url": "https://api.github.com/users/elenadimitrova/following{/other_user}",
      "gists_url": "https://api.github.com/users/elenadimitrova/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elenadimitrova/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elenadimitrova/subscriptions",
      "organizations_url": "https://api.github.com/users/elenadimitrova/orgs",
      "repos_url": "https://api.github.com/users/elenadimitrova/repos",
      "events_url": "https://api.github.com/users/elenadimitrova/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elenadimitrova/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-11T09:15:05Z",
    "updated_at": "2018-07-11T09:15:14Z",
    "author_association": "NONE",
    "body": "This is a problem for us at Colony too where events in called contracts aren't surfaced in the transaction logs. We've solved this for `A` and `B` in the example above being the Interface and actual contract implementation. For different contracts however this is still a problem, see `Colony.addGlobalSkill` calls `ColonyNetwork.addSkill` which  emits `SkillAdded` that never surfaces in the transaction log of the `Colony.addGlobalSkill` call https://github.com/JoinColony/colonyNetwork/blob/develop/contracts/Colony.sol#L112",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/404101607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/404204133",
    "html_url": "https://github.com/trufflesuite/truffle/issues/555#issuecomment-404204133",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
    "id": 404204133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDIwNDEzMw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-11T15:07:44Z",
    "updated_at": "2018-07-11T15:07:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "@elenadimitrova Coincidentally saw a possible solution to this yesterday [here](https://github.com/zulhfreelancer/truffle-events). \r\n\r\nIt's a library that decodes logs for what the author calls 'deep events', using the data on the receipt and knowledge of what contracts are interrelated. Usage looks like this (from their docs):\r\n```javascript\r\nvar truffleAssert = require('truffle-assertions');\r\nvar truffleEvent  = require('truffle-events');\r\n\r\n// code omitted for brevity\r\n\r\nit(\"Foo#doSomethingExtra\", async function(){\r\n  var fooScope = await f.doSomethingExtra(b.address);\r\n  var barScope = truffleEvent.formTxObject('Bar', 1, fooScope);\r\n\r\n  truffleAssert.eventEmitted(fooScope, 'LogNumber', (ev) => {\r\n    return ev.number == 100;\r\n  });\r\n\r\n  truffleAssert.eventEmitted(barScope, 'LogAlphabet', (ev) => {\r\n    return ev.word == \"Hello!\";\r\n  });\r\n});\r\n```\r\n\r\nWe've talked about developing a global registry within Truffle and it's seemed like the appropriate place is at the artifact level. A rewrite of that is scheduled for late summer / fall so it will be a while before there are any real developments there.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/404204133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/415170624",
    "html_url": "https://github.com/trufflesuite/truffle/issues/555#issuecomment-415170624",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
    "id": 415170624,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNTE3MDYyNA==",
    "user": {
      "login": "jdkanani",
      "id": 1692593,
      "node_id": "MDQ6VXNlcjE2OTI1OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1692593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jdkanani",
      "html_url": "https://github.com/jdkanani",
      "followers_url": "https://api.github.com/users/jdkanani/followers",
      "following_url": "https://api.github.com/users/jdkanani/following{/other_user}",
      "gists_url": "https://api.github.com/users/jdkanani/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jdkanani/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jdkanani/subscriptions",
      "organizations_url": "https://api.github.com/users/jdkanani/orgs",
      "repos_url": "https://api.github.com/users/jdkanani/repos",
      "events_url": "https://api.github.com/users/jdkanani/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jdkanani/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-22T20:35:32Z",
    "updated_at": "2018-08-23T10:47:03Z",
    "author_association": "NONE",
    "body": "We are using following code to decode logs:\r\n\r\n```js\r\n// File: helpers/log-decoder.js \r\n\r\nimport ethers from 'ethers'\r\n\r\nexport default class LogDecoder {\r\n  constructor(abis = []) {\r\n    this._methodIDs = {}\r\n    abis.forEach(abi => {\r\n      const methodInterface = new ethers.Interface(abi)\r\n      Object.keys(methodInterface.events).forEach(evtKey => {\r\n        const evt = methodInterface.events[evtKey]\r\n        const signature = evt.topics[0]\r\n        // Handles different indexed arguments with same signature from different contracts \r\n        // Like ERC721/ERC20 Transfer\r\n        this._methodIDs[signature] = this._methodIDs[signature] || []\r\n        this._methodIDs[signature].push(evt)\r\n      })\r\n    })\r\n  }\r\n\r\n  decodeLogs(logs) {\r\n    return logs.map(log => {\r\n      const evts = this._methodIDs[log.topics[0]]\r\n      for (let index = 0; index < evts.length; index++) {\r\n        const evt = evts[index]\r\n        try {\r\n          return {\r\n            address: log.address.toLowerCase(),\r\n            event: evt.name,\r\n            signature: evt.signature,\r\n            args: evt.parse(log.topics, log.data)\r\n          }\r\n        } catch (e) {}\r\n      }\r\n\r\n      throw new Error(\"Log doesn't match\")\r\n    })\r\n  }\r\n}\r\n```\r\n\r\n**Usage:**\r\n\r\n```js\r\nconst decoder = new LogDecoder(abis)\r\nconst result = decoder.decodeLogs(receipt.logs)\r\n// result will be the decoded log array\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/415170624/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/436910762",
    "html_url": "https://github.com/trufflesuite/truffle/issues/555#issuecomment-436910762",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
    "id": 436910762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjkxMDc2Mg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-08T08:21:49Z",
    "updated_at": "2018-11-08T08:21:49Z",
    "author_association": "NONE",
    "body": "Thank you for raising this issue! It has been automatically marked as stale because it has not had recent activity. It will be closed in 7 days if no further activity occurs. If you would like to keep this issue open, please respond with information about the current state of this problem.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/436910762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/438969509",
    "html_url": "https://github.com/trufflesuite/truffle/issues/555#issuecomment-438969509",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/555",
    "id": 438969509,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODk2OTUwOQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-15T09:10:00Z",
    "updated_at": "2018-11-15T09:10:00Z",
    "author_association": "NONE",
    "body": "There has been no new activity on this issue since it was marked as stale 7 days ago, so it is being automatically closed.  If you'd like help with this or a different problem, please open a new issue. Thanks!\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/438969509/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
