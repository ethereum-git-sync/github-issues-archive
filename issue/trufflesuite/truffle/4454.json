{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4454",
  "id": 1059503856,
  "node_id": "I_kwDOAkfq-c4_Jr7w",
  "number": 4454,
  "title": "Required scripts in `truffle console` import from Truffle's dependencies instead of project `node_modules/`",
  "user": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 971680115,
      "node_id": "MDU6TGFiZWw5NzE2ODAxMTU=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Console",
      "name": "Console",
      "color": "fbca04",
      "default": false,
      "description": ""
    },
    {
      "id": 1675042241,
      "node_id": "MDU6TGFiZWwxNjc1MDQyMjQx",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority5%20%F0%9F%8C%80",
      "name": "priority5 ðŸŒ€",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-11-21T22:24:56Z",
  "updated_at": "2022-07-11T20:43:17Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nIf you define a `truffle console --require=<...>` script, and that script imports a package with a `require()` statement of its own, then Truffle will prefer to import packages from Truffle's internal dependencies rather than whatever the dependencies the user may have installed specifically. This is problematic when there are version differences between these two imports.\r\n\r\nBetter behavior here would be for these scripts to prioritize local packages, since this is more in line with what normal Node.js behavior is, and also because otherwise there's no good way to require local packages.\r\n\r\n## Steps to Reproduce\r\n\r\n1. `truffle init`\r\n2. `yarn add ethers`\r\n3. Define a script `get-ethers.js`:\r\n    ```javascript\r\n    const { ethers } = require(\"ethers\");\r\n    module.exports = { ethers };\r\n    ```\r\n4. Run `truffle console --require=get-ethers.js`\r\n\r\n## Expected Behavior\r\n\r\nThe latest version of `ethers` should be available inside the Truffle console (v5.5.1)\r\n\r\n## Actual Results\r\n\r\nTruffle runs `get-ethers.js` and requires Truffle's internal, old version of `ethers` (v4)\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client:\r\n* Truffle version (`truffle version`): Truffle v5.4.21\r\n* node version (`node --version`):\r\n* npm version (`npm --version`): \r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1175150030",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4454#issuecomment-1175150030",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4454",
    "id": 1175150030,
    "node_id": "IC_kwDOAkfq-c5GC13O",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-05T14:47:45Z",
    "updated_at": "2022-07-05T14:48:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "When trying to wrap my head around #5231 I noticed some deficiencies in the implementation of `require` provided to the VM's global context by the `file` function of `@truffle/require`.\r\n\r\nFrom memory, here are a few of the things we might want to fix/clean up:\r\n\r\n- the host's `require.cache` is used, rather than providing our own for the child context\r\n- require.resolve is not implemented\r\n- require.resolve.paths is not implemented\r\n- the paths searched by our implementation don't match the paths that would be searched by the default implementation\r\n- rather than executing required modules in a new `vm.Script` that shares a global context with the `vm.Script` that called `require` in the first place, we execute them in the parent global context by just passing them to the parent context's require (this is the basis for #5231).\r\n\r\nAlso the NodeJS docs on CommonJS Modules has [a great pseudocode explanation for exactly how node resolves the specific file for a given import](https://nodejs.org/api/modules.html#all-together). I'd suggest that if we're going to implement our own `require`, we should use this as a guide.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1175150030/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
