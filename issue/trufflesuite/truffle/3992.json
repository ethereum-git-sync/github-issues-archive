{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3992",
  "id": 864157376,
  "node_id": "MDU6SXNzdWU4NjQxNTczNzY=",
  "number": 3992,
  "title": "Truffle should not be stupid about gas + gas price",
  "user": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 1086852667,
      "node_id": "MDU6TGFiZWwxMDg2ODUyNjY3",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20requirements",
      "name": "needs requirements",
      "color": "d4c5f9",
      "default": false,
      "description": "feature request is unclear"
    },
    {
      "id": 1675040909,
      "node_id": "MDU6TGFiZWwxNjc1MDQwOTA5",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority1%20%F0%9F%9A%A8",
      "name": "priority1 ðŸš¨",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-04-21T18:31:26Z",
  "updated_at": "2021-09-22T18:32:52Z",
  "closed_at": "2021-09-22T18:32:51Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Right now, Truffle assumes per-network that there will be one constant gas price (with some default, IIRC), and then may or may not compute gas limit on a per-transaction basis (although a common pattern is to specify a constant gas limit for every transaction it makes to that network).\r\n\r\nThis sort of approach is absolutely terrible. Truffle should figure out the gas using the normal gas estimation techniques (maybe this simply means discouraging configuring `gas`), and also Truffle should determine reasonable gas price **for a transaction of the estimated size**, given current network conditions.\r\n\r\nRaising this issue as a follow-up from various issues related to mainnet deployment, most recently #3888.\r\n\r\nSo, this issue represents two problems:\r\n- [x] Truffle should not attempt to provide any default gas price. (**Implemented in #4073**)\r\n- [x] Truffle should use the result of `eth_estimateGas` (times some buffer) as the default gas limit for any transaction it makes. (**In progress via #4296**)",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/912714475",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3992#issuecomment-912714475",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992",
    "id": 912714475,
    "node_id": "IC_kwDOAkfq-c42Zurr",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T18:01:48Z",
    "updated_at": "2021-09-03T18:01:48Z",
    "author_association": "MEMBER",
    "body": "It appears that the gas price half of this issue is resolved; what remains is just the stupid behavior for gas limit.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/912714475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/912723911",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3992#issuecomment-912723911",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992",
    "id": 912723911,
    "node_id": "IC_kwDOAkfq-c42Zw_H",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T18:18:22Z",
    "updated_at": "2021-09-03T18:18:22Z",
    "author_association": "MEMBER",
    "body": "So in doing #4296, @fainashalts discovered that the naÃ¯ve strategy of doing an `eth_estimateGas` is insufficient for transactions that revert: in such situations, `eth_estimateGas` does not provide a quantity in response (it instead errors). This means that Truffle won't be able to proceed with sending the transaction, since it won't have all the information it needs to be able to do so. We need Truffle to be able to send transactions, even if it knows those transactions will revert, because users must be able to inspect such reverted transactions (e.g. via stacktrace inspection, etc.). As a consequence of this, we'll need some additional logic to produce a gas limit value when the estimate cannot be determined via `eth_estimateGas`.\r\n\r\nBest solution for this remains undetermined, but we've uncovered a few options (all specifically relating to the case where `eth_estimateGas` fails due to revert):\r\na. Use the block limit (or some value based on the block limit, e.g. `blockLimit / 2`) as the default transaction gas limit\r\nb. Do a binary search to find the boundary for gas limit between the transaction's failing for \"out of gas\" and the transaction's failing for \"revert\", and use that value when sending the transaction to the network.\r\nc. Petition to modify the JSON-RPC and all client implementations so as to ensure `eth_estimateGas` reports a sensible gas limit value even for transactions that revert\r\n\r\nThese all seem not-ideal; currently looking for an option (d)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/912723911/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/921941705",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3992#issuecomment-921941705",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992",
    "id": 921941705,
    "node_id": "IC_kwDOAkfq-c4287bJ",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T16:53:08Z",
    "updated_at": "2021-09-17T16:53:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can we close this since #4296 was merged and released?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/921941705/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/925185469",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3992#issuecomment-925185469",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3992",
    "id": 925185469,
    "node_id": "IC_kwDOAkfq-c43JTW9",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T18:32:51Z",
    "updated_at": "2021-09-22T18:32:51Z",
    "author_association": "MEMBER",
    "body": "Yep, we went with option (a) above!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/925185469/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
