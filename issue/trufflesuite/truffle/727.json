{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/727",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/727",
  "id": 283815488,
  "node_id": "MDU6SXNzdWUyODM4MTU0ODg=",
  "number": 727,
  "title": "Testing does not reset state",
  "user": {
    "login": "timothywangdev",
    "id": 5894018,
    "node_id": "MDQ6VXNlcjU4OTQwMTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5894018?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timothywangdev",
    "html_url": "https://github.com/timothywangdev",
    "followers_url": "https://api.github.com/users/timothywangdev/followers",
    "following_url": "https://api.github.com/users/timothywangdev/following{/other_user}",
    "gists_url": "https://api.github.com/users/timothywangdev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timothywangdev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timothywangdev/subscriptions",
    "organizations_url": "https://api.github.com/users/timothywangdev/orgs",
    "repos_url": "https://api.github.com/users/timothywangdev/repos",
    "events_url": "https://api.github.com/users/timothywangdev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timothywangdev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2017-12-21T09:06:35Z",
  "updated_at": "2018-04-02T05:14:31Z",
  "closed_at": "2018-01-12T02:47:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nTesting does not reset state\r\n\r\n## Steps to Reproduce\r\n### Test.sol\r\n```\r\ncontract Test {\r\n    uint[] a;\r\n    function length() public view returns (uint) {\r\n        return a.length;\r\n    }\r\n\r\n    function add(uint val) public {\r\n        a.push(val);\r\n    }\r\n}\r\n```\r\n\r\n### test.js\r\n```\r\nvar Test = artifacts.require(\"Test\");\r\ncontract('Test', function(accounts) {\r\n    it(\"test 0\", async function() {\r\n        var t = await Test.deployed();\r\n        var l = await t.length.call();\r\n        assert.equal(l.toNumber(), 0, 'array should be empty');\r\n    });\r\n\r\n    it(\"test 1\", async function() {\r\n        var t = await Test.deployed();\r\n        await t.add(1);\r\n    });\r\n\r\n    it(\"test 2\", async function() {\r\n        var t = await Test.deployed();\r\n        var l = await t.length.call();\r\n        assert.equal(l.toNumber(), 0, 'array should be empty');\r\n    });\r\n});\r\n```\r\n\r\n- truffle dev\r\n- test\r\n\r\n## Expected Behavior\r\n\r\nall tests should pass\r\n\r\n## Actual Results\r\n```\r\nContract: Test test 2:\r\n     AssertionError: array should be empty: expected 1 to equal 0\r\n```\r\n## Environment\r\n\r\n* Operating System:  Ubuntu 16.04\r\n* Truffle version: v4.0.4\r\n* Ethereum client: None\r\n* node version: v8.9.1\r\n* npm version: 5.5.1\r\n",
  "closed_by": {
    "login": "cgewecke",
    "id": 7332026,
    "node_id": "MDQ6VXNlcjczMzIwMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cgewecke",
    "html_url": "https://github.com/cgewecke",
    "followers_url": "https://api.github.com/users/cgewecke/followers",
    "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
    "organizations_url": "https://api.github.com/users/cgewecke/orgs",
    "repos_url": "https://api.github.com/users/cgewecke/repos",
    "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cgewecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/727/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/356281143",
    "html_url": "https://github.com/trufflesuite/truffle/issues/727#issuecomment-356281143",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727",
    "id": 356281143,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NjI4MTE0Mw==",
    "user": {
      "login": "JackPickering",
      "id": 16956871,
      "node_id": "MDQ6VXNlcjE2OTU2ODcx",
      "avatar_url": "https://avatars.githubusercontent.com/u/16956871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JackPickering",
      "html_url": "https://github.com/JackPickering",
      "followers_url": "https://api.github.com/users/JackPickering/followers",
      "following_url": "https://api.github.com/users/JackPickering/following{/other_user}",
      "gists_url": "https://api.github.com/users/JackPickering/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JackPickering/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JackPickering/subscriptions",
      "organizations_url": "https://api.github.com/users/JackPickering/orgs",
      "repos_url": "https://api.github.com/users/JackPickering/repos",
      "events_url": "https://api.github.com/users/JackPickering/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JackPickering/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-09T13:17:48Z",
    "updated_at": "2018-01-09T13:17:48Z",
    "author_association": "NONE",
    "body": "Truffle tests dont reset state within the same file, if this is an issue for you, you can use a 'beforeEach' hook and specify a function which creates a new instance of your contract using 'MyContract.new([param1],[param2]...)'\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/356281143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357127996",
    "html_url": "https://github.com/trufflesuite/truffle/issues/727#issuecomment-357127996",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727",
    "id": 357127996,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzEyNzk5Ng==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-12T02:47:54Z",
    "updated_at": "2018-01-12T02:47:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @timothywangdev! @JackPickering is correct. You can see some nice examples of the `beforeEach` pattern he's describing at the Cryptokitties contract repository [here](https://github.com/axiomzen/cryptokitties-bounty/blob/master/test/clock-auction.test.js#L23-L36).\r\n\r\nBy design Truffle resets the state or \"reverts\" between each `contract` suite - e.g. each block of tests wrapped in Truffle's `contract` test abstraction.  \r\n\r\nClosing because this is intended behavior. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357127996/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/377856476",
    "html_url": "https://github.com/trufflesuite/truffle/issues/727#issuecomment-377856476",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/727",
    "id": 377856476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzg1NjQ3Ng==",
    "user": {
      "login": "PhABC",
      "id": 9306422,
      "node_id": "MDQ6VXNlcjkzMDY0MjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9306422?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PhABC",
      "html_url": "https://github.com/PhABC",
      "followers_url": "https://api.github.com/users/PhABC/followers",
      "following_url": "https://api.github.com/users/PhABC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PhABC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PhABC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PhABC/subscriptions",
      "organizations_url": "https://api.github.com/users/PhABC/orgs",
      "repos_url": "https://api.github.com/users/PhABC/repos",
      "events_url": "https://api.github.com/users/PhABC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PhABC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T05:13:56Z",
    "updated_at": "2018-04-02T05:14:31Z",
    "author_association": "NONE",
    "body": "This might want to be reconsidered @cgewecke . For instance, when using the `evm_increaseTime` feature, the timestamp of all subsequent blocks will be increased by the previous value, which makes testing timestamp based functionalities quite cumbersome. This is one example, but I am sure there are others. Ideally, one could have the option of starting from scratch if desired, even it less efficient.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/377856476/reactions",
      "total_count": 3,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 3,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
