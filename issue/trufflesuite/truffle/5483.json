{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5483",
  "id": 1347024481,
  "node_id": "I_kwDOAkfq-c5QSfZh",
  "number": 5483,
  "title": "Potentially rework codec output format?",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1174994378,
      "node_id": "MDU6TGFiZWwxMTc0OTk0Mzc4",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/codec",
      "name": "codec",
      "color": "bbe853",
      "default": false,
      "description": ""
    },
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    },
    {
      "id": 4450004506,
      "node_id": "LA_kwDOAkfq-c8AAAABCT2uGg",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/requires-breaking-change",
      "name": "requires-breaking-change",
      "color": "FB4D16",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-08-22T21:45:09Z",
  "updated_at": "2022-08-25T18:23:56Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nThis is an issue to collect some potential breaking changes to the codec output format we might want to make.  Not all of these are compatible with one another, and some of them might be bad ideas.  But I thought I'd collect them here!\r\n\r\n1. Replace `BN`s with `BigInt`s\r\n\r\nThe format was designed before `BigInt`s were safe to use everywhere.  `BN`s are mutable objects which is annoying.  `BigInt`s would be nicer?\r\n\r\n2. Replace `BN`s and `Big`s with `string`s\r\n\r\nBecause of its use of `BN` and `Big` (and one other thing, see below), the format can't be easily serialized and deserialized with `JSON.stringify` and `JSON.parse`, something that has caused no end of headaches.  That doesn't mean it can't be serialized or deserialized some other way, but so far we haven't bothered to write that.\r\n\r\nOr rather -- we tried to write that, back in PR #2901, and the method we attempted to use for it hit some snags.  Not related to the code itself but rather due to some of the things surrounding the code.  Well... I won't bother going over that again here.  Anyway it was a problem.\r\n\r\nSo, if we got rid of the `BN`s and `Big`s, and just made it directly serializable with `JSON.stringify` and `JSON.parse`, that would be nice.  Annoyingly, `BigInt`s can't be serialized and deserialized in this way, so it'd have to be strings or something. :-/  Blech.  Using strings for integers bothers me but it may be unavoidable?  Using it for decimal fixed-point doesn't bother me so much, but it does have its own problem, of agreeing on a specific format of string...\r\n\r\n3. Remove the circularities :P\r\n\r\nThis is the other thing that would have to be changed if we want native serialization and deserialization.  This is much less big a deal though.  Long story short -- for reasons that I'll skip going into, when designing the format, I thought, hey, why not represent circular objects with circular objects?  (Marked, of course, so code processing it doesn't go into loops.)  This wasn't out of nowhere, there was actually a specific use case I had in mind for this, but it never materialized.  So, uh, maybe it would be better to get rid of that.\r\n\r\n(That said, this change would actually be less necessary than (2), as if we want to simply handle this step separately, well, you can see that done in #2901 and it works fine; it didn't encounter the typing problems that the use of `BN`s and `Big`s caused...)\r\n\r\n## Environment\r\n\r\n* Truffle version (`truffle version`): 5.5.27",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1227595067",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5483#issuecomment-1227595067",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483",
    "id": 1227595067,
    "node_id": "IC_kwDOAkfq-c5JK507",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-25T18:00:54Z",
    "updated_at": "2022-08-25T18:00:54Z",
    "author_association": "MEMBER",
    "body": "We may want to hold off on this until we have @truffle/codec-components, since the absence of that library makes this format more externally-facing than if we had that library.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1227595067/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1227611558",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5483#issuecomment-1227611558",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483",
    "id": 1227611558,
    "node_id": "IC_kwDOAkfq-c5JK92m",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-25T18:18:56Z",
    "updated_at": "2022-08-25T18:18:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note: @gnidan points out the existence of the [superJson](https://github.com/blitz-js/superjson) package, which would allow us to use `BigInt`s.  Obviously `Big`s would still be a problem, but I'm more OK with using strings there (so long as we can agree on a string format!).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1227611558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1227616172",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5483#issuecomment-1227616172",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5483",
    "id": 1227616172,
    "node_id": "IC_kwDOAkfq-c5JK--s",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-25T18:23:55Z",
    "updated_at": "2022-08-25T18:23:55Z",
    "author_association": "MEMBER",
    "body": "I'm torn... I really like the simplicity of just using strings everywhere and avoiding the need for custom JSON logic. But yeah, trade-offs... ðŸ¤· ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1227616172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
