{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2368",
  "id": 489458149,
  "node_id": "MDU6SXNzdWU0ODk0NTgxNDk=",
  "number": 2368,
  "title": "Improve debug messages to include the full path of an error",
  "user": {
    "login": "pyskell",
    "id": 9665963,
    "node_id": "MDQ6VXNlcjk2NjU5NjM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9665963?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pyskell",
    "html_url": "https://github.com/pyskell",
    "followers_url": "https://api.github.com/users/pyskell/followers",
    "following_url": "https://api.github.com/users/pyskell/following{/other_user}",
    "gists_url": "https://api.github.com/users/pyskell/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pyskell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pyskell/subscriptions",
    "organizations_url": "https://api.github.com/users/pyskell/orgs",
    "repos_url": "https://api.github.com/users/pyskell/repos",
    "events_url": "https://api.github.com/users/pyskell/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pyskell/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-09-04T23:44:45Z",
  "updated_at": "2019-09-12T20:42:20Z",
  "closed_at": "2019-09-12T20:42:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\nTechnically I [complained on Twitter](https://twitter.com/pyskell/status/1169323268555325440?s=20) and didn't ask in Gitter but it still counts right?\r\n## Issue\r\nThe only debug information from Mocha comes in the form of JavaScript errors. If an error exists within the tested code there will be limited (if any) debugging information about the error.\r\n\r\n## Steps to Reproduce\r\nHave a test throw an error that occurs in the EVM.\r\n\r\nFor example, this code will error at the call to `ct.deleteSchedule()`.\r\n```\r\n        it(\"should delete a VestingSchedule\", async () => {\r\n            let vestingSchedule = await VestingSchedule.new(accounts[0], accounts[0], \"test_deploy\", 1000, 1, 5)\r\n            await ct.addSchedule(vestingSchedule.address, {from: accounts[0]})\r\n\r\n            await ct.deleteSchedule(accounts[0], {from: accounts[0]})\r\n            let deletedSchedule = await ct.vestingSchedules.call(accounts[0])\r\n\r\n            await assert.equal(deletedSchedule, 0x0)\r\n        })\r\n```\r\n\r\n`ct.deleteSchedule()` will then error when it calls a function in another contract `oldSchedule.disable()`\r\n```\r\n  function deleteSchedule(address grantee) public {\r\n    VestingSchedule oldSchedule = vestingSchedules[address(grantee)];\r\n    oldSchedule.disable(true);\r\n    delete vestingSchedules[address(grantee)];\r\n  }\r\n```\r\n\r\n## Expected Behavior\r\n\r\nI expected to see some errors from the EVM so I can know what function, code, and line resulted in the error. This is potentially fixable with #2253 (as per @gnidan).\r\n\r\n## Actual Results\r\n\r\nBut the output is simply the error propagation after execution in the EVM halts and we get back to JavaScript. There's no actual info about what happened when `oldSchedule.disable()` was called.\r\n```\r\n  1) Contract: CapTable\r\n       basic tests\r\n         should delete a VestingSchedule:\r\n     Error: Returned error: VM Exception while processing transaction: revert\r\n      at Object.ErrorResponse (/usr/lib/node_modules/truffle/build/webpack:/~/web3-eth/~/web3-core-helpers/src/errors.js:29:1)\r\n      at /usr/lib/node_modules/truffle/build/webpack:/~/web3-eth/~/web3-core-requestmanager/src/index.js:140:1\r\n      at /usr/lib/node_modules/truffle/build/webpack:/packages/truffle-provider/wrapper.js:112:1\r\n      at XMLHttpRequest.request.onreadystatechange (/usr/lib/node_modules/truffle/build/webpack:/~/web3/~/web3-providers-http/src/index.js:96:1)\r\n      at XMLHttpRequestEventTarget.dispatchEvent (/usr/lib/node_modules/truffle/build/webpack:/~/xhr2-cookies/dist/xml-http-request-event-target.js:34:1)\r\n      at XMLHttpRequest._setReadyState (/usr/lib/node_modules/truffle/build/webpack:/~/xhr2-cookies/dist/xml-http-request.js:208:1)\r\n      at XMLHttpRequest._onHttpResponseEnd (/usr/lib/node_modules/truffle/build/webpack:/~/xhr2-cookies/dist/xml-http-request.js:318:1)\r\n      at IncomingMessage.<anonymous> (/usr/lib/node_modules/truffle/build/webpack:/~/xhr2-cookies/dist/xml-http-request.js:289:47)\r\n      at endReadableNT (_stream_readable.js:1139:12)\r\n      at processTicksAndRejections (internal/process/task_queues.js:81:17)\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: Linux\r\n* Ethereum client: ganache\r\n* Truffle version (`truffle version`): Truffle v5.0.12 (core: 5.0.12)\r\n* node version (`node --version`): Node v11.15.0\r\n* npm version (`npm --version`): 6.10.3\r\nSolidity - 0.5.1 (solc-js)\r\nWeb3.js v1.0.0-beta.37\r\n",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/528143809",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2368#issuecomment-528143809",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368",
    "id": 528143809,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODE0MzgwOQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-05T00:24:42Z",
    "updated_at": "2019-09-05T00:24:42Z",
    "author_association": "MEMBER",
    "body": "This might be resolved by #2170, currently needing love. Will investigate.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/528143809/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/530997923",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2368#issuecomment-530997923",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2368",
    "id": 530997923,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDk5NzkyMw==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-12T20:42:20Z",
    "updated_at": "2019-09-12T20:42:20Z",
    "author_association": "MEMBER",
    "body": "#2170 has been merged and released! Check it out in v5.0.36\r\n\r\nClosing this pre-emptively but feel free to tell me to reopen if it's not resolved!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/530997923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
