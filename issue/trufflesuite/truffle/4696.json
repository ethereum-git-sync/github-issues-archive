{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4696",
  "id": 1124838486,
  "node_id": "I_kwDOAkfq-c5DC6xW",
  "number": 4696,
  "title": "Decoder can't decode events, return values, revert strings from old Solidity versions with misencoded empty string",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1174994378,
      "node_id": "MDU6TGFiZWwxMTc0OTk0Mzc4",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/codec",
      "name": "codec",
      "color": "bbe853",
      "default": false,
      "description": ""
    },
    {
      "id": 1675041996,
      "node_id": "MDU6TGFiZWwxNjc1MDQxOTk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority4%20%F0%9F%93%8B",
      "name": "priority4 ðŸ“‹",
      "color": "006b75",
      "default": false,
      "description": ""
    },
    {
      "id": 3628476601,
      "node_id": "LA_kwDOAkfq-c7YRii5",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/decoder",
      "name": "decoder",
      "color": "D3249C",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-02-05T05:15:53Z",
  "updated_at": "2022-03-04T02:30:06Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nSo it turns out that Solidity versions prior to 0.7.6, when using ABI encoder v1, would incorrectly encode the empty string when emitting events or returning values or revert strings.\r\n\r\nThis is a problem for the decoder, because when decoding events or return values (including revert strings), it requires that the input be encoded *exactly* correctly for the particular decoding.  As such, the decoder will fail to decode such events, return values, or revert strings.  (The problem doesn't apply to custom errors for the simple reason that they weren't introduced until Solidity 0.8.4) The reason the decoder does this is to prevent it from returning nonsensical interpretations in various cases, so this isn't an easy assumption to remove.\r\n\r\n(Note I say \"the decoder\", but of course this problem really lies in Truffle Codec, and so all this applies to the debugger as well.)\r\n\r\nNow, one possibility would be to say, this is a Solidity bug, we won't handle it... but we generally try to handle Solidity bugs.  This one seems particularly like a pain to handle, so maybe this is low-priority, I don't know.  (It would just be a matter of adjusting allocation and encoding based on compiler version, *except* that it depends not only on compiler version but also the ABI encoder pragma.  So either we have to allow both, *or* we have to somehow determine which ABI encoder is in use at multiple points...)\r\n\r\nBut the thing that poses a real problem here is how this interacts with Truffle's Solidity assertion library.  However, I've split that off as its own issue, #4722, so go see that.\r\n\r\n## Environment\r\n\r\n* Truffle version (`truffle version`): 5.4.32",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1058763798",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4696#issuecomment-1058763798",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696",
    "id": 1058763798,
    "node_id": "IC_kwDOAkfq-c4_G3QW",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-04T02:27:57Z",
    "updated_at": "2022-03-04T02:27:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "A note: When the decoder is eventually used in Truffle Contract, it would probably be a good idea to make a similar `disableChecks` flag for return data decoding, and turn that on when decoding returned data for the affected Solidity versions, because that should basically be safe and not cause problems (since it would only cause problems for custom errors, which weren't introduced until later).  Less clear what to do about events in that case.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1058763798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1058764801",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4696#issuecomment-1058764801",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4696",
    "id": 1058764801,
    "node_id": "IC_kwDOAkfq-c4_G3gB",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-04T02:30:05Z",
    "updated_at": "2022-03-04T02:30:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually, @gnidan suggests a better idea, rather than switching based on the Solidity version, is to switch based on the ABI!  We can turn the flag on precisely when there are no errors declared in the ABI. :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1058764801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
