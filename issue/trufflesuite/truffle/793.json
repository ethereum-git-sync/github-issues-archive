{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/793",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/793",
  "id": 296179779,
  "node_id": "MDU6SXNzdWUyOTYxNzk3Nzk=",
  "number": 793,
  "title": "out of gas Error trying to run Unit Test for Buy Token Function of Decentralised Exchange contract using Ganache CLI",
  "user": {
    "login": "ltfschoen",
    "id": 6226175,
    "node_id": "MDQ6VXNlcjYyMjYxNzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6226175?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ltfschoen",
    "html_url": "https://github.com/ltfschoen",
    "followers_url": "https://api.github.com/users/ltfschoen/followers",
    "following_url": "https://api.github.com/users/ltfschoen/following{/other_user}",
    "gists_url": "https://api.github.com/users/ltfschoen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ltfschoen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ltfschoen/subscriptions",
    "organizations_url": "https://api.github.com/users/ltfschoen/orgs",
    "repos_url": "https://api.github.com/users/ltfschoen/repos",
    "events_url": "https://api.github.com/users/ltfschoen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ltfschoen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-02-11T10:36:42Z",
  "updated_at": "2018-02-11T22:30:41Z",
  "closed_at": "2018-02-11T22:30:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [X] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\ni'm looking for help on some solidity code for a DEX i've been coding https://github.com/ltfschoen/dex. If I try and add anymore code to the `buyToken` function https://github.com/ltfschoen/dex/blob/master/contracts/Exchange.sol#L348, then when I run my Unit Tests I get an `Error: VM Exception while processing transaction: out of gas`, which is associated with the transaction to the `buyToken` https://github.com/ltfschoen/dex/blob/master/test/09_exchange_trading_buy_tokens_creates_market_buy_order_test.js#L50. I've tried explicitly setting the largest Gas Price possible but it doesn’t help.\r\nI didn't get this error when I debugged the whole workflow of that Unit Test file in Remix IDE. I've tried changing the Gas Price / Gas Limit in truffle.js, but that didn't help.\r\nEven if I add something silly somewhere in the `buyToken` function like the following it still triggers the `out of gas` error:\r\n```\r\nif (true == false) {\r\n require(uint(1) > uint(0));\r\n}\r\n```\r\ni’ve attached above a summary of my progress asking questions to the authors of the Udemy course i've been doing to try and find out if they can help me overcome the error.\r\n\r\n [![out_of_gas_error_question.pdf](https://files.gitter.im/ConsenSys/truffle/xvW1/thumb/out_of_gas_error_question.jpg)](https://files.gitter.im/ConsenSys/truffle/xvW1/out_of_gas_error_question.pdf)\r\n\r\n## Steps to Reproduce\r\n\r\n* Open a new Terminal window\r\n  * Clone https://github.com/ltfschoen/dex\r\n  * Install dependencies\r\n```\r\nnpm install -g truffle;\r\nnpm install -g ganache-cli;\r\n```\r\n* Open a 2nd Terminal window and run Ganache TestRPC\r\n```\r\nganache-cli --port=\"8500\" --mnemonic \"copy obey episode awake damp vacant protect hold wish primary travel shy\"\r\n```\r\n* Migrate the contracts in the original 1st Terminal window \r\n```\r\ntruffle migrate --network development\r\n```\r\n* Run unit tests. Observe that only one test fails as expected (because I'm emitting and extra event for debugging purposes)\r\n```\r\ntruffle test\r\n```\r\n* Add the following code somewhere in the `buyToken` function to demonstrate that adding even code that won't get run is triggering the `out of gas` error.\r\n```\r\nif (true == false) {\r\n require(uint(1) > uint(0));\r\n}\r\n```\r\n* Run the unit tests again and observe how it gives error `Error: VM Exception while processing transaction: out of gas`\r\n\r\n## Expected Behavior\r\n\r\nI want to be able to uncomment and use more lines of my code (i.e. such as this line of code https://github.com/ltfschoen/dex/blob/master/contracts/Exchange.sol#L405) in my `buyToken` function without it causing my Unit Tests producing error `Error: VM Exception while processing transaction: out of gas`\r\n\r\n## Actual Results\r\n\r\nWhen I run the Unit Tests with more lines of code even if it's valid code, it gives me error `Error: VM Exception while processing transaction: out of gas` and in the Ganache TestRPC window it displays:\r\n```\r\n...\r\neth_sendTransaction\r\n\r\n  Transaction: 0x47a34e196f220abf534a2b40d36ce204781700327450c617ff4b9edcac96a2c1\r\n  Contract created: 0x4947869c6b59621b6aa3bcb0c0562f07d39152ce\r\n  Gas usage: 4712388\r\n  Block Number: 5\r\n  Block Time: Sun Feb 11 2018 21:31:58 GMT+1100 (AEDT)\r\n  Runtime Error: out of gas\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: macOS 10.12.6\r\n* Truffle version:\r\nTruffle v4.0.4 (core: 4.0.4)\r\nSolidity v0.4.18 (solc-js)\r\n* Ethereum client: Parity v1.8.9-stable\r\n* node version: v8.7.0\r\n* npm version: 5.5.1\r\n* Ganache CLI v6.0.3 (ganache-core: 2.0.2)",
  "closed_by": {
    "login": "cgewecke",
    "id": 7332026,
    "node_id": "MDQ6VXNlcjczMzIwMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cgewecke",
    "html_url": "https://github.com/cgewecke",
    "followers_url": "https://api.github.com/users/cgewecke/followers",
    "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
    "organizations_url": "https://api.github.com/users/cgewecke/orgs",
    "repos_url": "https://api.github.com/users/cgewecke/repos",
    "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cgewecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/793/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364745557",
    "html_url": "https://github.com/trufflesuite/truffle/issues/793#issuecomment-364745557",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793",
    "id": 364745557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc0NTU1Nw==",
    "user": {
      "login": "ltfschoen",
      "id": 6226175,
      "node_id": "MDQ6VXNlcjYyMjYxNzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6226175?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ltfschoen",
      "html_url": "https://github.com/ltfschoen",
      "followers_url": "https://api.github.com/users/ltfschoen/followers",
      "following_url": "https://api.github.com/users/ltfschoen/following{/other_user}",
      "gists_url": "https://api.github.com/users/ltfschoen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ltfschoen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ltfschoen/subscriptions",
      "organizations_url": "https://api.github.com/users/ltfschoen/orgs",
      "repos_url": "https://api.github.com/users/ltfschoen/repos",
      "events_url": "https://api.github.com/users/ltfschoen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ltfschoen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T11:48:15Z",
    "updated_at": "2018-02-11T11:48:15Z",
    "author_association": "NONE",
    "body": "I get the same `out of gas` error even after upgrading to the latest versions of:\r\nTruffle v4.0.6 (core: 4.0.6)\r\nSolidity v0.4.19 (solc-js)\r\nNode.js v9.5.0\r\nnpm 5.6.0\r\n\r\nI've also tried to explicitly set the Gas Price and Gas Limit of Ganache CLI to match the values I've set in truffle.js (as shown below), but it still gives the `out of gas` error\r\n```\r\nganache-cli --port=\"8500\" --mnemonic \"copy obey episode awake damp vacant protect hold wish primary travel shy\" --verbose --networkId=3 --gasLimit=4712388 --gasPrice=100000000000\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364745557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364784027",
    "html_url": "https://github.com/trufflesuite/truffle/issues/793#issuecomment-364784027",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793",
    "id": 364784027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc4NDAyNw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T20:16:29Z",
    "updated_at": "2018-02-11T20:16:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ltfschoen Your contract consumes more gas to deploy than the limit you've specified. At the time of this comment, mainnet's limit is 7984452 so you have quite a bit of room to expand while remaining within deployable reality.  \r\n\r\nCould you try raising the `gasLimit` of your ganache-cli instance as well as the `gasLimit` specified in your `truffle.js`? \r\n \r\n ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364784027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364787578",
    "html_url": "https://github.com/trufflesuite/truffle/issues/793#issuecomment-364787578",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793",
    "id": 364787578,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc4NzU3OA==",
    "user": {
      "login": "ltfschoen",
      "id": 6226175,
      "node_id": "MDQ6VXNlcjYyMjYxNzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6226175?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ltfschoen",
      "html_url": "https://github.com/ltfschoen",
      "followers_url": "https://api.github.com/users/ltfschoen/followers",
      "following_url": "https://api.github.com/users/ltfschoen/following{/other_user}",
      "gists_url": "https://api.github.com/users/ltfschoen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ltfschoen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ltfschoen/subscriptions",
      "organizations_url": "https://api.github.com/users/ltfschoen/orgs",
      "repos_url": "https://api.github.com/users/ltfschoen/repos",
      "events_url": "https://api.github.com/users/ltfschoen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ltfschoen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T20:55:54Z",
    "updated_at": "2018-02-11T20:55:54Z",
    "author_association": "NONE",
    "body": "@cgewecke Thank you that worked!\r\nI found the latest Gas Limit and Gas Price used by Mainnet at https://ethstats.net/, as you mentioned.\r\nI need to updated truffle.js with a larger Gas Limit as you mentioned:\r\n```\r\nmodule.exports = {\r\n  networks: {\r\n    development: {\r\n      ...\r\n      gas: 7984452, // Block Gas Limit same as latest on Mainnet https://ethstats.net/\r\n      gasPrice: 2000000000, // same as latest on Mainnet https://ethstats.net/\r\n...\r\n```\r\nIt was also necessary to specify a matching Block Gas Limit in Ganache CLI flags as follows:\r\n```\r\nganache-cli \\\r\n  --port=\"8500\" \\\r\n  --mnemonic \"copy obey episode awake damp vacant protect hold wish primary travel shy\" \\\r\n  --verbose \\\r\n  --networkId=3 \\\r\n  --gasLimit=7984452 \\\r\n  --gasPrice=2000000000;\r\n``` ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364787578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364795748",
    "html_url": "https://github.com/trufflesuite/truffle/issues/793#issuecomment-364795748",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/793",
    "id": 364795748,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc5NTc0OA==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T22:30:41Z",
    "updated_at": "2018-02-11T22:30:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ltfschoen Oh good - closing this for housekeeping. \r\n\r\nPlease feel free to re-open if you feel there are other issues to resolve here. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364795748/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
