{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/462",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/462/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/462/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/462/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/462",
  "id": 238643696,
  "node_id": "MDU6SXNzdWUyMzg2NDM2OTY=",
  "number": 462,
  "title": "Truffle discards all (potentially expensive) deployed contracts when a migration fails",
  "user": {
    "login": "interfect",
    "id": 752054,
    "node_id": "MDQ6VXNlcjc1MjA1NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/752054?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/interfect",
    "html_url": "https://github.com/interfect",
    "followers_url": "https://api.github.com/users/interfect/followers",
    "following_url": "https://api.github.com/users/interfect/following{/other_user}",
    "gists_url": "https://api.github.com/users/interfect/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/interfect/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/interfect/subscriptions",
    "organizations_url": "https://api.github.com/users/interfect/orgs",
    "repos_url": "https://api.github.com/users/interfect/repos",
    "events_url": "https://api.github.com/users/interfect/events{/privacy}",
    "received_events_url": "https://api.github.com/users/interfect/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2017-06-26T19:23:00Z",
  "updated_at": "2017-07-13T18:55:29Z",
  "closed_at": "2017-07-13T18:55:29Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [X] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nTruffle doesn't save the addresses of contracts successfully deployed during failed migrations to `build/contracts/*.json`. This means it is very difficult/impossible to re-use those already-paid-for contract deployments when re-running the migration.\r\n\r\n## Steps to Reproduce\r\n\r\n* Make a migration that deploys 2 contracts.\r\n* Give it only enough ETH to pay for one deployment.\r\n* Run the migration on the live network, so it deploys the first contract and does not deploy the second.\r\n* Look at the file for the deployed contract in `build/contracts`.\r\n* Note the absence of any address for the contract on the mainnet.\r\n* Verify with a block explorer that the contract is actually deployed.\r\n\r\n## Expected Behavior\r\n\r\nThe address that the contract is deployed to ought to be saved to its file in `build/contracts` as soon as it is deployed, so that re-running the migration with `{replace: false}` could, at least for simple migrations, potentially recover from the failure.\r\n\r\n## Actual Results\r\n\r\nThe address that the contract is deployed at on the main network is not saved to the file in `build/contracts`.\r\n\r\n## Environment\r\n\r\n* Operating System: Windows 7\r\n* Truffle version: 3.2.92\r\n* Ethereum client: Geth\r\n* node version: 1.6.5\r\n* npm version: 4.2.0\r\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/462/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/462/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/312559453",
    "html_url": "https://github.com/trufflesuite/truffle/issues/462#issuecomment-312559453",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/462",
    "id": 312559453,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMjU1OTQ1Mw==",
    "user": {
      "login": "Janther",
      "id": 1022054,
      "node_id": "MDQ6VXNlcjEwMjIwNTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1022054?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Janther",
      "html_url": "https://github.com/Janther",
      "followers_url": "https://api.github.com/users/Janther/followers",
      "following_url": "https://api.github.com/users/Janther/following{/other_user}",
      "gists_url": "https://api.github.com/users/Janther/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Janther/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Janther/subscriptions",
      "organizations_url": "https://api.github.com/users/Janther/orgs",
      "repos_url": "https://api.github.com/users/Janther/repos",
      "events_url": "https://api.github.com/users/Janther/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Janther/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-03T06:25:12Z",
    "updated_at": "2017-07-03T06:25:12Z",
    "author_association": "NONE",
    "body": "I'm experiencing the same issue in all networks, even testrpc. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/312559453/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/315170186",
    "html_url": "https://github.com/trufflesuite/truffle/issues/462#issuecomment-315170186",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/462",
    "id": 315170186,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNTE3MDE4Ng==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-13T18:55:29Z",
    "updated_at": "2017-07-13T18:55:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "When a migration fails, it's often hard figuring out what happened. We working on two ways to make migrations better that, when used correctly, *should* prevent the error you're seeing here. \r\n\r\n1. #495 - Show all transactions that were attempted during a migration. This should give you more information about what happened and allow you to diagnose your migration. \r\n2. #490 - Integrate the TestRPC into Truffle, and include a `--dry-run` feature that will fork from your desired chain and deploy your migrations in a sandbox, as if you were deploying them on the chain itself. \r\n\r\nWith (2), you should be able to use `--dry-run` to expose migration errors more quickly. With (1), you should be able to diagnose those errors to see what happened during those transactions.\r\n\r\nI'm going to close this ticket as the two tickets above will track our progress on this issue. Please stay tuned for these new features as they're added.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/315170186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
