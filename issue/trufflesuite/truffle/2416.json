{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2416",
  "id": 498010718,
  "node_id": "MDU6SXNzdWU0OTgwMTA3MTg=",
  "number": 2416,
  "title": "Default EVM version for solidity 0.5.8 appears to be byzantium",
  "user": {
    "login": "rkalis",
    "id": 9142187,
    "node_id": "MDQ6VXNlcjkxNDIxODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9142187?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkalis",
    "html_url": "https://github.com/rkalis",
    "followers_url": "https://api.github.com/users/rkalis/followers",
    "following_url": "https://api.github.com/users/rkalis/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkalis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkalis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkalis/subscriptions",
    "organizations_url": "https://api.github.com/users/rkalis/orgs",
    "repos_url": "https://api.github.com/users/rkalis/repos",
    "events_url": "https://api.github.com/users/rkalis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkalis/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 644098328,
      "node_id": "MDU6TGFiZWw2NDQwOTgzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20reproduced",
      "name": "needs reproduced",
      "color": "fbca04",
      "default": false,
      "description": null
    },
    {
      "id": 1403343142,
      "node_id": "MDU6TGFiZWwxNDAzMzQzMTQy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20investigated",
      "name": "needs investigated",
      "color": "b7410e",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-09-25T02:20:45Z",
  "updated_at": "2020-05-28T10:14:01Z",
  "closed_at": "2020-05-28T10:14:00Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nI have been in touch with @mattBlackDesign of Atomic Loans about using truffle-plugin-verify in their project, which they were having trouble with. We manually copied over the required data into [Etherscan's verification web form](https://kovan.etherscan.io/verifyContract), which failed initially, but after selecting EVM version 'byzantium' (rather than 'default' or 'petersburg') on the Etherscan website, we got it to verify.\r\n\r\nThe Truffle config that was used contained these compiler settings:\r\n```\r\n  compilers: {\r\n    solc: {\r\n      version: \"0.5.8\",\r\n      settings: {\r\n        optimizer: {\r\n          enabled: true,\r\n          runs: 200\r\n        },\r\n        // evmVersion: 'petersburg'\r\n      },\r\n    },\r\n  },\r\n```\r\n\r\nSince no EVM version was specified, we would expect it to use the default for Solidity v0.5.8, which is petersburg according to the [docs](https://solidity.readthedocs.io/en/v0.5.8/using-the-compiler.html#target-options). However, it appears to use byzantium, since we are only able to verify the code on Etherscan using byzantium as the EVM version.\r\n\r\nWhen manually specifying `evmVersion: 'petersburg'` in the truffle config, it correctly verifies on Etherscan using default settings.\r\n\r\n## Steps to Reproduce\r\n\r\n1. Clone [atomicloans-eth-contracts](https://github.com/AtomicLoans/atomicloans-eth-contracts/tree/kovan-deploy) and checkout branch `kovan-deploy`.\r\n2. `yarn` / `npm install`\r\n3. Create a `.env` file in the root directory that has `MNEMONIC` and `ETHERSCAN_API_KEY` keys containing a mnemonic with a few Kovan Ethers and an Etherscan API key, generated from [their website](https://etherscan.io/apis).\r\n4. Comment out the line stating `evmVersion: 'petersburg'` in `truffle.js`.\r\n5. `truffle compile`\r\n6. `truffle migrate --network kovan`\r\n7. `truffle run verify Loans --network kovan`\r\n\r\nThis should return `Failed - Unable to verify`. Then uncomment the line specifying evm version petersburg and go through the steps again. This should return `Pass - Verified`.\r\n\r\n## Expected Behavior\r\n\r\nThe contract code should be verified without having to specify `evmVersion: 'petersburg'`, because the default EVM version for Solidity 0.5.8 should already be petersburg.\r\n\r\n## Actual Results\r\n\r\nThe contract code is only verified when manually specifying `evmVersion: 'petersburg'`, indicating that it doesn't use petersburg by default.\r\n\r\n## Environment\r\n\r\n* Operating System: macOS 10.14.4\r\n* Ethereum client: N/A\r\n* Truffle version (`truffle version`): 5.0.36\r\n* node version (`node --version`): 11.15.0\r\n* npm version (`npm --version`): 6.9.0\r\n",
  "closed_by": {
    "login": "rkalis",
    "id": 9142187,
    "node_id": "MDQ6VXNlcjkxNDIxODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9142187?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkalis",
    "html_url": "https://github.com/rkalis",
    "followers_url": "https://api.github.com/users/rkalis/followers",
    "following_url": "https://api.github.com/users/rkalis/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkalis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkalis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkalis/subscriptions",
    "organizations_url": "https://api.github.com/users/rkalis/orgs",
    "repos_url": "https://api.github.com/users/rkalis/repos",
    "events_url": "https://api.github.com/users/rkalis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkalis/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/537522385",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-537522385",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 537522385,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzUyMjM4NQ==",
    "user": {
      "login": "rkalis",
      "id": 9142187,
      "node_id": "MDQ6VXNlcjkxNDIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9142187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkalis",
      "html_url": "https://github.com/rkalis",
      "followers_url": "https://api.github.com/users/rkalis/followers",
      "following_url": "https://api.github.com/users/rkalis/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkalis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkalis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkalis/subscriptions",
      "organizations_url": "https://api.github.com/users/rkalis/orgs",
      "repos_url": "https://api.github.com/users/rkalis/repos",
      "events_url": "https://api.github.com/users/rkalis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkalis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-02T14:35:03Z",
    "updated_at": "2019-10-02T14:35:03Z",
    "author_association": "MEMBER",
    "body": "I also observed this issue in @makoto's [wearekickback/contracts](https://github.com/wearekickback/contracts) repo (Solidity v0.5.11). \r\n\r\nIt appears to occur when compiler settings are provided, e.g.:\r\n\r\n```js\r\n  compilers: {\r\n    solc: {\r\n      version: \"0.5.11\",\r\n      settings: {\r\n        optimizer: {\r\n          enabled: true\r\n        },\r\n      },\r\n    },\r\n  },\r\n```\r\n\r\nBut I haven't observed this issue in projects where there's no compiler settings specified whatsoever (i.e. using the builtin compiler). So that might be related to the problem.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/537522385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540165335",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-540165335",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 540165335,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDE2NTMzNQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-09T19:59:06Z",
    "updated_at": "2019-10-09T19:59:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't think Truffle has any reference to specific `evmVersion`s any more and it should use the default for the version of solc you are using if nothing is specified. I will do a check to try and verify this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540165335/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540177413",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-540177413",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 540177413,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDE3NzQxMw==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-09T20:25:47Z",
    "updated_at": "2019-10-09T20:53:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "There must be something else going on here. I confirmed that the output from solc on version 0.5.8 with a simple test contract is the same whether the `evmVersion` is specified as `petersburg` or `undefined` or not specified in the options at all. I also confirmed that in general in Truffle, when `evmVersion` is not specified, `undefined` is the value that gets passed in the options. I'll think about this a bit more and see if I can come up with another explanation for the behavior you are getting.\r\n\r\n**Update:** Actually I realized that I didn't fully test this. I need to find a simple example of something that would be compiled differently given different versions of the evm specified in the options. Back to research!\r\n\r\n**Another Update:** So both test contracts that I made DO compile differently if I don't specify `evmVersion` and compile and then recompile while specifying `byzantium`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540177413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540347857",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-540347857",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 540347857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDM0Nzg1Nw==",
    "user": {
      "login": "rkalis",
      "id": 9142187,
      "node_id": "MDQ6VXNlcjkxNDIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9142187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkalis",
      "html_url": "https://github.com/rkalis",
      "followers_url": "https://api.github.com/users/rkalis/followers",
      "following_url": "https://api.github.com/users/rkalis/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkalis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkalis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkalis/subscriptions",
      "organizations_url": "https://api.github.com/users/rkalis/orgs",
      "repos_url": "https://api.github.com/users/rkalis/repos",
      "events_url": "https://api.github.com/users/rkalis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkalis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-10T04:24:33Z",
    "updated_at": "2019-10-10T04:24:33Z",
    "author_association": "MEMBER",
    "body": "Hey, I double checked as well and you're right that not specifying `evmVersion` has the same bytecode result as compiling with `petersburg` set. But still, the code verifies on Etherscan only when it's set to `petersburg` in the truffle config. So something else must be happening. \r\n\r\n@RyuuGan, do you think this could be related to sol-merger? I guess I should test this by taking a  single-file contract and seeing if I can still observe the behaviour with that contract. I'll try that out some time after devcon.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540347857/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540921971",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-540921971",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 540921971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDkyMTk3MQ==",
    "user": {
      "login": "RyuuGan",
      "id": 426268,
      "node_id": "MDQ6VXNlcjQyNjI2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/426268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RyuuGan",
      "html_url": "https://github.com/RyuuGan",
      "followers_url": "https://api.github.com/users/RyuuGan/followers",
      "following_url": "https://api.github.com/users/RyuuGan/following{/other_user}",
      "gists_url": "https://api.github.com/users/RyuuGan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RyuuGan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RyuuGan/subscriptions",
      "organizations_url": "https://api.github.com/users/RyuuGan/orgs",
      "repos_url": "https://api.github.com/users/RyuuGan/repos",
      "events_url": "https://api.github.com/users/RyuuGan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RyuuGan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-11T06:01:06Z",
    "updated_at": "2019-10-11T06:01:06Z",
    "author_association": "NONE",
    "body": "@rkalis I don't compile any contracts, I just build a new one based on one entry contract file. So I'm not sure if this is related to `sol-merger`. Better to find the smallest contract that reproduces this cituation and then find out why it is happening.\r\n\r\nBut if there is an error in `sol-merger` then it should be in `pragma` versions. Take attention to this please when you will be looking in this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/540921971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/634846244",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-634846244",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 634846244,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNDg0NjI0NA==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-27T18:10:00Z",
    "updated_at": "2020-05-27T18:10:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "@rkalis \r\n@RyuuGan\r\nDo you guys think there is some issue here for Truffle to address? Let me know!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/634846244/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/635250273",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2416#issuecomment-635250273",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2416",
    "id": 635250273,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNTI1MDI3Mw==",
    "user": {
      "login": "rkalis",
      "id": 9142187,
      "node_id": "MDQ6VXNlcjkxNDIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9142187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkalis",
      "html_url": "https://github.com/rkalis",
      "followers_url": "https://api.github.com/users/rkalis/followers",
      "following_url": "https://api.github.com/users/rkalis/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkalis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkalis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkalis/subscriptions",
      "organizations_url": "https://api.github.com/users/rkalis/orgs",
      "repos_url": "https://api.github.com/users/rkalis/repos",
      "events_url": "https://api.github.com/users/rkalis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkalis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-28T10:14:00Z",
    "updated_at": "2020-05-28T10:14:00Z",
    "author_association": "MEMBER",
    "body": "I think the issue is difficult to isolate, and since it only occurred on a specific Solidity version that is now outdated, and the issue is generally not a problem, I would say this issue can be closed.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/635250273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
