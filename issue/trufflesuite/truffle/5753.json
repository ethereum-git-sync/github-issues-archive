{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5753",
  "id": 1473789553,
  "node_id": "I_kwDOAkfq-c5X2D5x",
  "number": 5753,
  "title": "`truffle test` fails to decode custom errors",
  "user": {
    "login": "advra",
    "id": 1753803,
    "node_id": "MDQ6VXNlcjE3NTM4MDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1753803?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/advra",
    "html_url": "https://github.com/advra",
    "followers_url": "https://api.github.com/users/advra/followers",
    "following_url": "https://api.github.com/users/advra/following{/other_user}",
    "gists_url": "https://api.github.com/users/advra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/advra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/advra/subscriptions",
    "organizations_url": "https://api.github.com/users/advra/orgs",
    "repos_url": "https://api.github.com/users/advra/repos",
    "events_url": "https://api.github.com/users/advra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/advra/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-12-03T06:04:34Z",
  "updated_at": "2023-02-10T08:22:58Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n<img width=\"740\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1753803/205433695-9a4c96d3-e5a3-4733-929c-60e49f220581.png\">\r\n\r\nI have a test which passes using string messages. Ive changed the contract to use custom error messages and get the error \"VM Exception revert -- Reason given: Custom error (could not decode)\".\r\n\r\n## Steps to Reproduce\r\nCompile contract\r\nRun test\r\nCase should be able to compare error message\r\n\r\nHere is a portion of the test_contract.js\r\n```\r\nit(\"should validate for 721\", async function () {\r\n    // code for account[0] to mint nft\r\n    await expectRevert(\r\n        registry.stakeNFT(nft721Contract, 1, {from: accounts[2], value: listingFee}),\r\n        \"Not owner of nft 721\"\r\n    );\r\n}\r\n```\r\n\r\nThe solidity code which will pass using error strings: \r\nfunction someFunction(address nftContract, unint256 tokenId) {\r\n    // some logic here\r\n    require(IERC721(nftContract).ownerOf(tokenId) == msg.sender, \"Not owner of nft 721\");\r\n    // some more logic\r\n}\r\n\r\nThe new solidity code which does not pass because it cannot decode the custom error message\r\n```\r\n// newcontract.sol\r\nerror NotOwnerOfNFT();\r\n\r\nfunction someFunction(address nftContract, unint256 tokenId) {\r\n    // some logic here\r\n    if(IERC721(nftContract).ownerOf(tokenId) != msg.sender) revert NotOwnerOfNFT();\r\n\r\n    // some more logic\r\n}\r\n```\r\n\r\nWhen running newcontract.sol against the test it will provide the exception error. If I recall correctly, truffle now supports reading custom error codes. But it does not?\r\n\r\n## Expected Behavior\r\n\r\nCustom error message should be read and returned in the test as a pass or fail. Instead it says cannot decode.\r\n\r\n## Actual Results\r\n\r\nWhat actually happened. Please give examples and support it with screenshots, copied output or error messages.\r\n\r\n## Environment\r\n\r\n* Operating System: OSX\r\n* Ethereum client: local test\r\n* Truffle version (`truffle version`): 5.6.7\r\n* node version (`node --version`): 14.18.1\r\n* npm version (`npm --version`):  8.13.2\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1336094764",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5753#issuecomment-1336094764",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753",
    "id": 1336094764,
    "node_id": "IC_kwDOAkfq-c5PozAs",
    "user": {
      "login": "advra",
      "id": 1753803,
      "node_id": "MDQ6VXNlcjE3NTM4MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1753803?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/advra",
      "html_url": "https://github.com/advra",
      "followers_url": "https://api.github.com/users/advra/followers",
      "following_url": "https://api.github.com/users/advra/following{/other_user}",
      "gists_url": "https://api.github.com/users/advra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/advra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/advra/subscriptions",
      "organizations_url": "https://api.github.com/users/advra/orgs",
      "repos_url": "https://api.github.com/users/advra/repos",
      "events_url": "https://api.github.com/users/advra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/advra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-03T06:29:36Z",
    "updated_at": "2022-12-03T06:41:10Z",
    "author_association": "NONE",
    "body": "I see this that I may try out: https://github.com/OpenZeppelin/openzeppelin-test-helpers/issues/180  \r\n\r\nNevermind. This wont help. My issue is the custom message is not decoded _Before_ hitting the asserts within the javascript test. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1336094764/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1336268892",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5753#issuecomment-1336268892",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753",
    "id": 1336268892,
    "node_id": "IC_kwDOAkfq-c5Ppdhc",
    "user": {
      "login": "cds-amal",
      "id": 2529600,
      "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds-amal",
      "html_url": "https://github.com/cds-amal",
      "followers_url": "https://api.github.com/users/cds-amal/followers",
      "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
      "organizations_url": "https://api.github.com/users/cds-amal/orgs",
      "repos_url": "https://api.github.com/users/cds-amal/repos",
      "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds-amal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-03T22:20:36Z",
    "updated_at": "2022-12-03T22:20:36Z",
    "author_association": "MEMBER",
    "body": "Thanks for opening this issue @advra, we have #4123 in our backlog, and I'll make a case to bump its priority during our next ticket grooming meeting.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1336268892/reactions",
      "total_count": 3,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 3,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1343172361",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5753#issuecomment-1343172361",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753",
    "id": 1343172361,
    "node_id": "IC_kwDOAkfq-c5QDy8J",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T18:39:38Z",
    "updated_at": "2022-12-08T18:39:38Z",
    "author_association": "MEMBER",
    "body": "We'll leave this open as an issue related to supporting custom error decoding directly in `truffle test`, and then leave #4123 for handling these in @truffle/contract more specifically.\r\n\r\nThanks again!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1343172361/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1366253190",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5753#issuecomment-1366253190",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753",
    "id": 1366253190,
    "node_id": "IC_kwDOAkfq-c5Rb16G",
    "user": {
      "login": "TomiOhl",
      "id": 6696659,
      "node_id": "MDQ6VXNlcjY2OTY2NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6696659?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TomiOhl",
      "html_url": "https://github.com/TomiOhl",
      "followers_url": "https://api.github.com/users/TomiOhl/followers",
      "following_url": "https://api.github.com/users/TomiOhl/following{/other_user}",
      "gists_url": "https://api.github.com/users/TomiOhl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TomiOhl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TomiOhl/subscriptions",
      "organizations_url": "https://api.github.com/users/TomiOhl/orgs",
      "repos_url": "https://api.github.com/users/TomiOhl/repos",
      "events_url": "https://api.github.com/users/TomiOhl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TomiOhl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-27T23:10:22Z",
    "updated_at": "2022-12-27T23:10:22Z",
    "author_association": "NONE",
    "body": "Note to truffle devs: [TomiOhl/custom-error-test-helper](https://github.com/TomiOhl/custom-error-test-helper)  does basically what you want to do with ganache (doesn't work with hardhat network etc, but for that you could look at their official chai matchers).\r\nI appreciate you're working on this, this is really the missing piece when testing with truffle.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1366253190/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1425401970",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5753#issuecomment-1425401970",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5753",
    "id": 1425401970,
    "node_id": "IC_kwDOAkfq-c5U9ehy",
    "user": {
      "login": "seaona",
      "id": 54408225,
      "node_id": "MDQ6VXNlcjU0NDA4MjI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/54408225?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/seaona",
      "html_url": "https://github.com/seaona",
      "followers_url": "https://api.github.com/users/seaona/followers",
      "following_url": "https://api.github.com/users/seaona/following{/other_user}",
      "gists_url": "https://api.github.com/users/seaona/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/seaona/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/seaona/subscriptions",
      "organizations_url": "https://api.github.com/users/seaona/orgs",
      "repos_url": "https://api.github.com/users/seaona/repos",
      "events_url": "https://api.github.com/users/seaona/events{/privacy}",
      "received_events_url": "https://api.github.com/users/seaona/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-10T08:22:57Z",
    "updated_at": "2023-02-10T08:22:57Z",
    "author_association": "NONE",
    "body": "Looking forward this too https://github.com/trufflesuite/truffle/issues/4123 :boom:",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1425401970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
