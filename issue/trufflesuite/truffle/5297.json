{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5297",
  "id": 1305599645,
  "node_id": "I_kwDOAkfq-c5N0d6d",
  "number": 5297,
  "title": "Empty error description when deploying a smart contract (Detailed trace)",
  "user": {
    "login": "SmartArray",
    "id": 934592,
    "node_id": "MDQ6VXNlcjkzNDU5Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/934592?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SmartArray",
    "html_url": "https://github.com/SmartArray",
    "followers_url": "https://api.github.com/users/SmartArray/followers",
    "following_url": "https://api.github.com/users/SmartArray/following{/other_user}",
    "gists_url": "https://api.github.com/users/SmartArray/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SmartArray/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SmartArray/subscriptions",
    "organizations_url": "https://api.github.com/users/SmartArray/orgs",
    "repos_url": "https://api.github.com/users/SmartArray/repos",
    "events_url": "https://api.github.com/users/SmartArray/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SmartArray/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-07-15T05:39:37Z",
  "updated_at": "2022-07-30T02:38:06Z",
  "closed_at": "2022-07-30T02:38:05Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\nWhen deploying a smart contract, sometimes we get a stack trace like\r\n```\r\nError: \r\n    at /usr/local/lib/node_modules/truffle/build/webpack:/packages/deployer/src/deployment.js:331:1\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at Migration._deploy (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:69:1)\r\n    at Migration._load (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:55:1)\r\n    at Migration.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:203:1)\r\n    at Object.runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:143:1)\r\n    at Object.runFrom (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:108:4)\r\n    at Object.runAll (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:112:4)\r\n    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:85:1)\r\n    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/testing/Test.js:114:1)\r\n    at startGanacheAndRunTests (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/test/run.js:49:1)\r\n    at Object.module.exports [as run] (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/test/run.js:106:1)\r\n    at runCommand (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command-utils.js:184:1)\r\n```\r\n\r\nThis is not very developer friendly and should be changed.\r\n\r\nFortunately, I was able to dig into the webpack-compiled bundles and take a look what's going on.\r\n\r\nhttps://github.com/trufflesuite/truffle/blob/b9ed05e806b5de524cc1c5489cdd28e0fced573f/packages/deployer/src/sanitizeMessage.js#L6-L7\r\n\r\njust tries to print the first element of the error array. By utilizing the environment variable ```DEBUG=deploy*```, I got \r\n```bash\r\ndeployer:sanitizeMessage processing the following message - [ undefined, [], [], [], [], [], [], [] ] +0ms\r\n```\r\n\r\nThis was of course not very helpful either. But by logging the error that happens here:\r\n\r\nhttps://github.com/trufflesuite/truffle/blob/b9ed05e806b5de524cc1c5489cdd28e0fced573f/packages/deployer/src/deployment.js#L328\r\n\r\ngave me a hint that the error that was happening on our site was indeed very simple:\r\n```\r\nError: overflow [ See: https://links.ethers.org/v5-errors-NUMERIC_FAULT-overflow ] (fault=\"overflow\", operation=\"BigNumber.from\", value=1000000000000000000, code=NUMERIC_FAULT, version=bignumber/5.6.2)\r\n```\r\n\r\nThe bad error handling costed me half an hour for such a simple thing, and an additional half for writing this issue, when in fact it could be simpler ðŸ˜±\r\n\r\n## Trace\r\n\r\nThis causes a major problem:\r\nhttps://github.com/trufflesuite/truffle/blob/ff5e098f75fce170de84ad0aac7ab5a94abc2ffe/packages/events/defaultSubscribers/migrate/index.js#L86\r\n\r\nAlthough I didn't set it to quiet explicitly, it will return `undefined` by default so that the first element of the array is undefined and `sanitizeMessage` won't print out anything.\r\n\r\nWouldn't it be better to pass the error object or message to `sanitizeMessage`?\r\nIt would at least contain a valid error message...\r\n\r\n## Steps to Reproduce\r\nDeploy a contract with an invalid big integer (e.g. 10**18).\r\n\r\n## Expected Behavior\r\nBetter error message handling, for example: Error: NUMERIC_FAULT or Error: overflow\r\n\r\n## Actual Results\r\nNo detailed error description\r\n\r\n## Environment\r\n```\r\nMacOS\r\nTruffle v5.5.21 (core: 5.5.21)\r\nGanache v7.2.0\r\nSolidity - ^0.8.15 (solc-js)\r\nNode v16.15.1\r\nWeb3.js v1.7.4\r\n```\r\n",
  "closed_by": {
    "login": "cds-amal",
    "id": 2529600,
    "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cds-amal",
    "html_url": "https://github.com/cds-amal",
    "followers_url": "https://api.github.com/users/cds-amal/followers",
    "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
    "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
    "organizations_url": "https://api.github.com/users/cds-amal/orgs",
    "repos_url": "https://api.github.com/users/cds-amal/repos",
    "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cds-amal/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1185588066",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5297#issuecomment-1185588066",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297",
    "id": 1185588066,
    "node_id": "IC_kwDOAkfq-c5GqqNi",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T14:13:34Z",
    "updated_at": "2022-07-15T14:13:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting this @SmartArray! Do you have a project that you could link to on GitHub that I could use to demonstrate this? ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1185588066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1195917334",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5297#issuecomment-1195917334",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297",
    "id": 1195917334,
    "node_id": "IC_kwDOAkfq-c5HSEAW",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-26T19:56:13Z",
    "updated_at": "2022-07-26T19:57:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, when I try this I'm seeing the error message just fine.  Could you give more detailed reproduction steps?  Thanks!\r\n\r\nEdit: Nevermind, I forgot to turn on `--quiet`.  I've reproduced the problem.  Mind you, the overflow error does still appear in the output... it just doesn't appear at the top like that.  But I guess I can see about making it appear there too.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1195917334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1197838846",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5297#issuecomment-1197838846",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297",
    "id": 1197838846,
    "node_id": "IC_kwDOAkfq-c5HZZH-",
    "user": {
      "login": "mipicdev",
      "id": 13817314,
      "node_id": "MDQ6VXNlcjEzODE3MzE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/13817314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mipicdev",
      "html_url": "https://github.com/mipicdev",
      "followers_url": "https://api.github.com/users/mipicdev/followers",
      "following_url": "https://api.github.com/users/mipicdev/following{/other_user}",
      "gists_url": "https://api.github.com/users/mipicdev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mipicdev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mipicdev/subscriptions",
      "organizations_url": "https://api.github.com/users/mipicdev/orgs",
      "repos_url": "https://api.github.com/users/mipicdev/repos",
      "events_url": "https://api.github.com/users/mipicdev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mipicdev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T08:37:07Z",
    "updated_at": "2022-07-28T08:37:07Z",
    "author_association": "NONE",
    "body": "I had the same issue when executing `truffle test --network=test`.\r\n\r\nThis error occurred because I had forgotten to add the condition `network === \"test\"` to the corresponding migration file:\r\n\r\n```\r\nconst MyERC777Token = artifacts.require(\"MyERC777Token\");\r\nconst { singletons } = require(\"@openzeppelin/test-helpers\");\r\nrequire(\"@openzeppelin/test-helpers/configure\")({ provider: web3.currentProvider, environment: \"truffle\" });\r\n\r\nmodule.exports = async function (deployer, network, accounts) {\r\n  if (network === \"development\" || network === \"test\") {\r\n    await singletons.ERC1820Registry(accounts[0]);\r\n  }\r\n\r\n  await deployer.deploy(MyERC777Token);\r\n};\r\n\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1197838846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1200070251",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5297#issuecomment-1200070251",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5297",
    "id": 1200070251,
    "node_id": "IC_kwDOAkfq-c5Hh55r",
    "user": {
      "login": "cds-amal",
      "id": 2529600,
      "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds-amal",
      "html_url": "https://github.com/cds-amal",
      "followers_url": "https://api.github.com/users/cds-amal/followers",
      "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
      "organizations_url": "https://api.github.com/users/cds-amal/orgs",
      "repos_url": "https://api.github.com/users/cds-amal/repos",
      "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds-amal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-30T02:38:05Z",
    "updated_at": "2022-07-30T02:38:05Z",
    "author_association": "MEMBER",
    "body": "@SmartArray, closing as this should be fixed in [Truffle v5.5.24](https://github.com/trufflesuite/truffle/releases/tag/v5.5.24). Kindly let me know if it isn't.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1200070251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
