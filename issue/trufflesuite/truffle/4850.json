{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4850",
  "id": 1166728231,
  "node_id": "I_kwDOAkfq-c5Fitwn",
  "number": 4850,
  "title": "Make the default subscriber for the dashboard more useful",
  "user": {
    "login": "MicaiahReid",
    "id": 17027138,
    "node_id": "MDQ6VXNlcjE3MDI3MTM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17027138?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MicaiahReid",
    "html_url": "https://github.com/MicaiahReid",
    "followers_url": "https://api.github.com/users/MicaiahReid/followers",
    "following_url": "https://api.github.com/users/MicaiahReid/following{/other_user}",
    "gists_url": "https://api.github.com/users/MicaiahReid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MicaiahReid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MicaiahReid/subscriptions",
    "organizations_url": "https://api.github.com/users/MicaiahReid/orgs",
    "repos_url": "https://api.github.com/users/MicaiahReid/repos",
    "events_url": "https://api.github.com/users/MicaiahReid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MicaiahReid/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    },
    {
      "id": 3816950911,
      "node_id": "LA_kwDOAkfq-c7jggx_",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/dashboard",
      "name": "dashboard",
      "color": "4667D5",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cliffoo",
    "id": 41348973,
    "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cliffoo",
    "html_url": "https://github.com/cliffoo",
    "followers_url": "https://api.github.com/users/cliffoo/followers",
    "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
    "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
    "organizations_url": "https://api.github.com/users/cliffoo/orgs",
    "repos_url": "https://api.github.com/users/cliffoo/repos",
    "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cliffoo/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cliffoo",
      "id": 41348973,
      "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cliffoo",
      "html_url": "https://github.com/cliffoo",
      "followers_url": "https://api.github.com/users/cliffoo/followers",
      "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
      "organizations_url": "https://api.github.com/users/cliffoo/orgs",
      "repos_url": "https://api.github.com/users/cliffoo/repos",
      "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cliffoo/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-03-11T18:28:47Z",
  "updated_at": "2022-11-04T00:57:57Z",
  "closed_at": "2022-11-04T00:57:57Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The dashboard will need capability to listen to truffle events. We'll need to add a new default subscriber to truffle for the dashboard. A lot of other issues hinge on this capability.",
  "closed_by": {
    "login": "cliffoo",
    "id": 41348973,
    "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cliffoo",
    "html_url": "https://github.com/cliffoo",
    "followers_url": "https://api.github.com/users/cliffoo/followers",
    "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
    "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
    "organizations_url": "https://api.github.com/users/cliffoo/orgs",
    "repos_url": "https://api.github.com/users/cliffoo/repos",
    "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cliffoo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1073716962",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4850#issuecomment-1073716962",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850",
    "id": 1073716962,
    "node_id": "IC_kwDOAkfq-c4__57i",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-21T10:13:36Z",
    "updated_at": "2022-03-21T10:16:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "As I reread this ticket, I think I missed the underlying goal. The result from #4875 is a new default event subscriber, but that subscriber doesn't do anything to forward events off to the dashboard for consumption by the UI.\n\nI think in order to support that we need a new message type to be added to the message bus specifically for transmitting Truffle event data. The problem for the moment is that truffle commands only communicate with the message bus via the RPC interface.\n\nWe could in theory funnel Truffle events through an extended RPC namespace, or we could make it possible for Truffle to detect via the RPC interface that it's talking to the dashboard, and have it connect directly to the message bus endpoint to publish event messages that way (assuming message publish is allowed at all via that endpoint).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1073716962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1302835207",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4850#issuecomment-1302835207",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850",
    "id": 1302835207,
    "node_id": "IC_kwDOAkfq-c5Np7AH",
    "user": {
      "login": "cliffoo",
      "id": 41348973,
      "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cliffoo",
      "html_url": "https://github.com/cliffoo",
      "followers_url": "https://api.github.com/users/cliffoo/followers",
      "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
      "organizations_url": "https://api.github.com/users/cliffoo/orgs",
      "repos_url": "https://api.github.com/users/cliffoo/repos",
      "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cliffoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-04T00:57:41Z",
    "updated_at": "2022-11-04T00:57:41Z",
    "author_association": "MEMBER",
    "body": "> but that subscriber doesn't do anything to forward events off to the dashboard for consumption by the UI\r\n\r\nThat definitely doesn't happen by default. Perhaps when dashboard starts needing data from more Truffle events we can add some boilerplate, using a new message type as @benjamincburns suggested:\r\n```ts\r\neventsThatTruffleNeedsDataFrom.map(e => ({\r\n  [e]: [\r\n    async (data) =>\r\n      void (\r\n        await this.messageBusClient.publish({\r\n          type: \"truffle-event-data\",\r\n          payload: { e, data }\r\n          // There are other considerations like filtering to send\r\n          // not `data`, only what is needed, but same idea\r\n        })\r\n      ).abandon()\r\n  ]\r\n}));\r\n```\r\nWe are able to configure it! In my decoding in dashboard PR I'm [explicit about](https://github.com/trufflesuite/truffle/blob/95a094218a2c7a4983723bf9149f0ef34131940d/packages/events/defaultSubscribers/dashboard.js#L42-L52) which event to listen for (`compile:succeed`) and what to forward off to the message bus.\r\nSo the default subscriber _is_ useful in the sense that we can configure Truffle event listeners to forward data to the message bus client in the browser for an arbitrary purpose (e.g. consumption by UI, persist to db), which fits the bill.\r\nAddendum: I prefer not extending rpc namespace for this unless there's a clear advantage in doing so.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1302835207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1302835293",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4850#issuecomment-1302835293",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4850",
    "id": 1302835293,
    "node_id": "IC_kwDOAkfq-c5Np7Bd",
    "user": {
      "login": "cliffoo",
      "id": 41348973,
      "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cliffoo",
      "html_url": "https://github.com/cliffoo",
      "followers_url": "https://api.github.com/users/cliffoo/followers",
      "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
      "organizations_url": "https://api.github.com/users/cliffoo/orgs",
      "repos_url": "https://api.github.com/users/cliffoo/repos",
      "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cliffoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-04T00:57:55Z",
    "updated_at": "2022-11-04T00:57:55Z",
    "author_association": "MEMBER",
    "body": "Thanks @benjamincburns @MicaiahReid!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1302835293/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
