{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3528",
  "id": 742022236,
  "node_id": "MDU6SXNzdWU3NDIwMjIyMzY=",
  "number": 3528,
  "title": "Add options to yield better control of metadata stripping in code-utils's parseCode function",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-11-13T00:14:33Z",
  "updated_at": "2020-11-20T03:40:46Z",
  "closed_at": "2020-11-20T03:40:45Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nThe `parseCode` function in `@truffle/code-utils` can be used in two ways, affecting the question of where it should stop disassembling.  One is that you can specify the number of instructions to disassemble, if you know it.  The other, if you don't know the number, is that it can strip the metadata off the end.\r\n\r\nBut really, there should be a way of invoking `parseCode`, without knowing the number of instructions in advance, that *won't* strip metadata off the end.  This is because languages other than Solidity and Yul don't put this metadata on the end, so stripping it off the end would be incorrect.\r\n\r\n## Expected Behavior\r\n\r\nSome possible solutions:\r\n\r\n1. Add a way of invoking it that doesn't strip metadata off.\r\n2. Add a way of invoking it where one passes in the compiler being used, and let it determine whether to strip metadata based on that.\r\n3. Make it so that the strip-metadata mode actually checks whether the metadata it's stripping is valid CBOR, like we do in the `normalizeContexts` function in `@truffle/codec`.  Then there's no need for a separate option not to strip the metadata.\r\n\r\nOf these, (1) seems overall simplest, but would probably be breaking.  (3) is a bit more complex, but is non-breaking.  (2) seems the worst solution.\r\n\r\nNote that even if we do (1) we might also want to do (3).  Possibly as a separate option, if we're going that route...",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/727082202",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3528#issuecomment-727082202",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528",
    "id": 727082202,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNzA4MjIwMg==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-13T23:23:36Z",
    "updated_at": "2020-11-13T23:23:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, crap -- I forgot that there can be more that may need stripping beyond just the metadata.  Oh well... it's probably OK to have extra stuff, I guess?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/727082202/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/730825306",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3528#issuecomment-730825306",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3528",
    "id": 730825306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDgyNTMwNg==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-20T03:40:45Z",
    "updated_at": "2020-11-20T03:40:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is released now, we went with option (3).  (So, not a new option, just an adjustment to the behavior.)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/730825306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
