{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/709",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/709/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/709/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/709/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/709",
  "id": 281229646,
  "node_id": "MDU6SXNzdWUyODEyMjk2NDY=",
  "number": 709,
  "title": "Async/await test ISSUE vs promise chaining ",
  "user": {
    "login": "jorgeog96",
    "id": 29740800,
    "node_id": "MDQ6VXNlcjI5NzQwODAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/29740800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jorgeog96",
    "html_url": "https://github.com/jorgeog96",
    "followers_url": "https://api.github.com/users/jorgeog96/followers",
    "following_url": "https://api.github.com/users/jorgeog96/following{/other_user}",
    "gists_url": "https://api.github.com/users/jorgeog96/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jorgeog96/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jorgeog96/subscriptions",
    "organizations_url": "https://api.github.com/users/jorgeog96/orgs",
    "repos_url": "https://api.github.com/users/jorgeog96/repos",
    "events_url": "https://api.github.com/users/jorgeog96/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jorgeog96/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2017-12-12T01:51:34Z",
  "updated_at": "2017-12-22T02:45:06Z",
  "closed_at": "2017-12-22T02:45:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ Yes] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nI´m trying to call a mapping variable from my contract: \r\n\r\n    mapping(address => uint[29]) balanceOf;\r\n\r\nIn order to get that, know that mapping can´t be returned, I´ve created my own getter function. \r\n\r\n    //TESTING purposes\r\n    function getSlots() public returns (uint[]) {\r\n        slots.length = 0;\r\n        for(uint k = 0; k <= 28; k ++) {\r\n            slots.push(balanceOf[msg.sender][k]);\r\n        }\r\n        return slots;\r\n    }\r\n    \r\nHowever, when i´m calling that function on my test, works perfectly using promise chaining but doesn´t work if I use async/await. \r\n## Steps to Reproduce\r\n\r\n1)Promise chaining (part of the code):\r\n\r\n            return ovxet.getSlots.call({from: accounts[0]});\r\n        }).then(function(balances) {\r\n            console.log(\"Owner balance slots \" + balances);\r\n\r\n2)Returns me:\r\n\r\n          Owner balance slots 1000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\r\n\r\nIf I use the other way:\r\n\r\n1)Async/await:\r\n\r\n        var balanceArray = await instance.getSlots({from: accounts[0]});\r\n        console.log(balanceArray);\r\n2)Returns me:\r\n\r\n{ tx: '0x709a622b9d10a1803cdbf4485670576e71a1778a7bc955a94661fedc7df0b212',\r\n  receipt:\r\n   { transactionHash: '0x709a622b9d10a1803cdbf4485670576e71a1778a7bc955a94661fedc7df0b212',\r\n     transactionIndex: 0,\r\n     blockHash: '0x54a1333857c7187ebc0fb359083a1d1bc63577344fe4985de03c5b1e1f515f0e',\r\n     blockNumber: 127,\r\n     gasUsed: 389349,\r\n     cumulativeGasUsed: 389349,\r\n     contractAddress: null,\r\n     logs: [],\r\n     status: 1 },\r\n  logs: [] }\r\n\r\n3)   I´ve also tried adding JSON.Stringify().tx javascript method...but returns:\r\n\r\n                 undefined\r\n## Expected Behavior\r\n\r\nOwner balance slots 1000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\r\nin async/await code\r\n\r\n## Actual Results\r\n\r\n{ tx: '0x709a622b9d10a1803cdbf4485670576e71a1778a7bc955a94661fedc7df0b212',\r\n  receipt:\r\n   { transactionHash: '0x709a622b9d10a1803cdbf4485670576e71a1778a7bc955a94661fedc7df0b212',\r\n     transactionIndex: 0,\r\n     blockHash: '0x54a1333857c7187ebc0fb359083a1d1bc63577344fe4985de03c5b1e1f515f0e',\r\n     blockNumber: 127,\r\n     gasUsed: 389349,\r\n     cumulativeGasUsed: 389349,\r\n     contractAddress: null,\r\n     logs: [],\r\n     status: 1 },\r\n  logs: [] }\r\n\r\nor\r\n\r\nUndefined\r\n\r\n## Environment\r\n\r\n* Operating System: Windows 10 using Ubuntu Subsystem for Windows\r\n* Truffle version: v4.0.1\r\n* Ethereum client: ganache-cli\r\n* node version: v9.2.0\r\n* npm version: v5.5.1\r\n",
  "closed_by": {
    "login": "jorgeog96",
    "id": 29740800,
    "node_id": "MDQ6VXNlcjI5NzQwODAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/29740800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jorgeog96",
    "html_url": "https://github.com/jorgeog96",
    "followers_url": "https://api.github.com/users/jorgeog96/followers",
    "following_url": "https://api.github.com/users/jorgeog96/following{/other_user}",
    "gists_url": "https://api.github.com/users/jorgeog96/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jorgeog96/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jorgeog96/subscriptions",
    "organizations_url": "https://api.github.com/users/jorgeog96/orgs",
    "repos_url": "https://api.github.com/users/jorgeog96/repos",
    "events_url": "https://api.github.com/users/jorgeog96/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jorgeog96/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/709/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/709/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/352885195",
    "html_url": "https://github.com/trufflesuite/truffle/issues/709#issuecomment-352885195",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/709",
    "id": 352885195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Mjg4NTE5NQ==",
    "user": {
      "login": "pabloruiz55",
      "id": 526558,
      "node_id": "MDQ6VXNlcjUyNjU1OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/526558?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pabloruiz55",
      "html_url": "https://github.com/pabloruiz55",
      "followers_url": "https://api.github.com/users/pabloruiz55/followers",
      "following_url": "https://api.github.com/users/pabloruiz55/following{/other_user}",
      "gists_url": "https://api.github.com/users/pabloruiz55/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pabloruiz55/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pabloruiz55/subscriptions",
      "organizations_url": "https://api.github.com/users/pabloruiz55/orgs",
      "repos_url": "https://api.github.com/users/pabloruiz55/repos",
      "events_url": "https://api.github.com/users/pabloruiz55/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pabloruiz55/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-19T21:01:46Z",
    "updated_at": "2017-12-19T21:03:51Z",
    "author_association": "NONE",
    "body": "The problem is that you haven't marked your function as view/constant in solidity, so when you do `await instance.getSlots(.....)` without the .call(), Truffle assumes it is a transaction that intends to modify the state, so it executes it and gives you the transaction hash instead of the return value.\r\n\r\nadding \"view\" to function getSlots() should fix it.\r\n\r\n```\r\nfunction getSlots() public view returns (uint[]) {\r\n...\r\n}\r\n```\r\n\r\nor probably, calling the function like this:\r\n\r\n```\r\nvar balanceArray = await instance.getSlots.call({from: accounts[0]});\r\n    console.log(balanceArray); \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/352885195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/353509066",
    "html_url": "https://github.com/trufflesuite/truffle/issues/709#issuecomment-353509066",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/709",
    "id": 353509066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzUwOTA2Ng==",
    "user": {
      "login": "jorgeog96",
      "id": 29740800,
      "node_id": "MDQ6VXNlcjI5NzQwODAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/29740800?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorgeog96",
      "html_url": "https://github.com/jorgeog96",
      "followers_url": "https://api.github.com/users/jorgeog96/followers",
      "following_url": "https://api.github.com/users/jorgeog96/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorgeog96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorgeog96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorgeog96/subscriptions",
      "organizations_url": "https://api.github.com/users/jorgeog96/orgs",
      "repos_url": "https://api.github.com/users/jorgeog96/repos",
      "events_url": "https://api.github.com/users/jorgeog96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorgeog96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-22T02:45:06Z",
    "updated_at": "2017-12-22T02:45:06Z",
    "author_association": "NONE",
    "body": "You´re right using the second way can work without problems: \r\n\r\n        var balanceArray = await ovxet.getSlots.call();\r\n        console.log(balanceArray.toString());\r\n\r\nDon´t forget to add the .toString() to handle the BigNumber´s...\r\nAnd also I´ve change the state of the mapping BalanceOf to public. \r\n\r\nThanks!!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/353509066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
