{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4559",
  "id": 1085000917,
  "node_id": "I_kwDOAkfq-c5Aq8zV",
  "number": 4559,
  "title": "Truffle displays an incorrect cost deploying to Arbitrum Rinkeby",
  "user": {
    "login": "kevinweaver",
    "id": 1020682,
    "node_id": "MDQ6VXNlcjEwMjA2ODI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kevinweaver",
    "html_url": "https://github.com/kevinweaver",
    "followers_url": "https://api.github.com/users/kevinweaver/followers",
    "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
    "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
    "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
    "repos_url": "https://api.github.com/users/kevinweaver/repos",
    "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 🔧",
      "color": "006b75",
      "default": false,
      "description": ""
    },
    {
      "id": 2959810160,
      "node_id": "MDU6TGFiZWwyOTU5ODEwMTYw",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/L2",
      "name": "L2",
      "color": "c5def5",
      "default": false,
      "description": "Issues Related to layer two support inside Truffle"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "kevinweaver",
    "id": 1020682,
    "node_id": "MDQ6VXNlcjEwMjA2ODI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kevinweaver",
    "html_url": "https://github.com/kevinweaver",
    "followers_url": "https://api.github.com/users/kevinweaver/followers",
    "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
    "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
    "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
    "repos_url": "https://api.github.com/users/kevinweaver/repos",
    "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "kevinweaver",
      "id": 1020682,
      "node_id": "MDQ6VXNlcjEwMjA2ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinweaver",
      "html_url": "https://github.com/kevinweaver",
      "followers_url": "https://api.github.com/users/kevinweaver/followers",
      "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
      "repos_url": "https://api.github.com/users/kevinweaver/repos",
      "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-12-20T16:49:01Z",
  "updated_at": "2022-11-17T18:59:19Z",
  "closed_at": "2022-11-17T18:59:19Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "- [x] I've [opened a support ticket](https://trufflesuite.zendesk.com/hc/en-us/requests/new) before filing this issue. (Ticket 617473)\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen deploying a contract to Arbitrum, truffle displays a total cost that is different from the actual cost.\r\n\r\n## Steps to Reproduce\r\n\r\n`truffle unbox arbitrum`\r\n*in .env, set an infura key and a mnemonic* with Arbitrum Rinkeby ETH accessible [here](https://faucets.chain.link/arbitrum-rinkeby)\r\n`npm run compile:arbitrum`\r\n`npm run migrate:arbitrum --network=arbitrum_testnet`\r\n\r\nYou will see something like:\r\n```\r\n   Deploying 'SimpleStorage'\r\n   -------------------------\r\n   > transaction hash:    0xb3142a02eb78cc5f6f682100bc9a13cdc94c9cb3b45ddcae85739d3416266caf\r\n      ...\r\n   > total cost:          0.000013137251486502 ETH\r\n```\r\nTake this transaction ID to https://testnet.arbiscan.io.\r\n\r\n\r\n## Expected Behavior\r\n\r\nThe cost that truffle reports should be the same as the cost arbiscan reports.\r\n\r\n## Actual Results\r\n\r\ntruffle total cost: 0.000013137251486502 ETH\r\n[arbiscan](https://testnet.arbiscan.io/tx/0xb3142a02eb78cc5f6f682100bc9a13cdc94c9cb3b45ddcae85739d3416266caf) total cost: 0.00001050980184 ETH\r\n\r\nThe support ticket example showed an even larger difference using a much larger contract:\r\n\r\ntruffle total cost: 2.69049662 ETH\r\n[arbiscan](https://testnet.arbiscan.io/tx/0x016a9a31d47447104c1ef71b1f9ebe06ac4fa45c6e0dbd21cd0e6a192ca4de66) total cost:  0.00271965395244 ETH.\r\n\r\n## Note\r\nI confirmed that this is specific to Arbitrum and not other L2s like Optimism\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client:\r\n* Truffle version (`truffle version`):  v5.4.16\r\n* node version (`node --version`): c14.18.0\r\n* npm version (`npm --version`):  8.3.0\r\n",
  "closed_by": {
    "login": "cds-amal",
    "id": 2529600,
    "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cds-amal",
    "html_url": "https://github.com/cds-amal",
    "followers_url": "https://api.github.com/users/cds-amal/followers",
    "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
    "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
    "organizations_url": "https://api.github.com/users/cds-amal/orgs",
    "repos_url": "https://api.github.com/users/cds-amal/repos",
    "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cds-amal/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/998951277",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-998951277",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 998951277,
    "node_id": "IC_kwDOAkfq-c47islt",
    "user": {
      "login": "kevinweaver",
      "id": 1020682,
      "node_id": "MDQ6VXNlcjEwMjA2ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinweaver",
      "html_url": "https://github.com/kevinweaver",
      "followers_url": "https://api.github.com/users/kevinweaver/followers",
      "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
      "repos_url": "https://api.github.com/users/kevinweaver/repos",
      "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-21T17:10:18Z",
    "updated_at": "2022-01-06T20:07:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah! It looks like we aren't [accounting](https://github.com/trufflesuite/truffle/blob/a6418b7347139eaf2fa4ae0328a824a98d5434be/packages/interface-adapter/lib/adapter/web3/index.ts#L82) for the fact that Arbitrum fees are surfaced differently than mainnet fees:\r\n\r\nArbitrum receipt:\r\n```javascript\r\n{\r\n    \"blockHash\": \"0x46b4605bb9c89f3f2c19b74b5c5aa1d77a4af090bba473b4d49396fd6b0cc564\",\r\n    \"blockNumber\": 7794449,\r\n    \"contractAddress\": \"0x0EA91c4d350458880BADf654031E1FcA30B3C2Eb\",\r\n    \"cumulativeGasUsed\": 4053,\r\n    \"effectiveGasPrice\": \"0xa02494\",\r\n    \"feeStats\": {\r\n        \"paid\": {\r\n            \"l1Calldata\": \"0x4bbb9c60620\",\r\n            \"l1Transaction\": \"0x4640cbf4d10\",\r\n            \"l2Computation\": \"0x9e7631b24\",\r\n            \"l2Storage\": \"0x0\"\r\n        },\r\n        \"prices\": {\r\n            \"l1Calldata\": \"0x47f06e8c\",\r\n            \"l1Transaction\": \"0x4640cbf4d10\",\r\n            \"l2Computation\": \"0xa02494\",\r\n            \"l2Storage\": \"0x1e8b7a11660\"\r\n        },\r\n        \"unitsUsed\": {\r\n            \"l1Calldata\": \"0x10d8\",\r\n            \"l1Transaction\": \"0x1\",\r\n            \"l2Computation\": \"0xfd5\",\r\n            \"l2Storage\": \"0x0\"\r\n        }\r\n    },\r\n    \"from\": \"0x61de0bbb6c8215af3f821fe4884a28bc737f98d3\",\r\n    \"gasUsed\": 959933,\r\n    \"l1BlockNumber\": \"0x965b70\",\r\n    \"l1InboxBatchInfo\": null,\r\n    \"logs\": [],\r\n    \"logsBloom\": \"0x0...0\",\r\n    \"returnCode\": \"0x0\",\r\n    \"returnData\": \"0x0...0\",\r\n    \"status\": true,\r\n    \"to\": null,\r\n    \"transactionHash\": \"0x5c6c6befbf30fec1643ca6acb00c6afb78759c9038d75fedfe7534b94d4bf6da\",\r\n    \"transactionIndex\": 0,\r\n    \"rawLogs\": []\r\n}\r\n```\r\nLocal Ethereum receipt:\r\n```javascript\r\n{\r\n    \"transactionHash\": \"0xf2843b54d907a0eccfbec804699a4237857f7d8257ef55d1dc4c62b648c127f1\",\r\n    \"transactionIndex\": 0,\r\n    \"blockHash\": \"0x0d196855441c0aeb4fe04a0303f949a555acedd061cddbb6ee13749c6c58d89f\",\r\n    \"blockNumber\": 9853902,\r\n    \"from\": \"0x61de0bbb6c8215af3f821fe4884a28bc737f98d3\",\r\n    \"to\": null,\r\n    \"gasUsed\": 96405,\r\n    \"cumulativeGasUsed\": 96405,\r\n    \"contractAddress\": \"0xa6839894F879b3cb0FfB9F5Df467e1DFf1ED4Aa9\",\r\n    \"logs\": [],\r\n    \"status\": true,\r\n    \"logsBloom\": \"0x0...0\",\r\n    \"rawLogs\": []\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/998951277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/999942232",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-999942232",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 999942232,
    "node_id": "IC_kwDOAkfq-c47mehY",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T23:38:39Z",
    "updated_at": "2021-12-22T23:38:39Z",
    "author_association": "MEMBER",
    "body": "Whoa this is really weird. Good digging @kevinweaver! Is there any documentation for this receipt format?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/999942232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1004341624",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1004341624",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1004341624,
    "node_id": "IC_kwDOAkfq-c473Ql4",
    "user": {
      "login": "fainashalts",
      "id": 8952139,
      "node_id": "MDQ6VXNlcjg5NTIxMzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8952139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fainashalts",
      "html_url": "https://github.com/fainashalts",
      "followers_url": "https://api.github.com/users/fainashalts/followers",
      "following_url": "https://api.github.com/users/fainashalts/following{/other_user}",
      "gists_url": "https://api.github.com/users/fainashalts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fainashalts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fainashalts/subscriptions",
      "organizations_url": "https://api.github.com/users/fainashalts/orgs",
      "repos_url": "https://api.github.com/users/fainashalts/repos",
      "events_url": "https://api.github.com/users/fainashalts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fainashalts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-03T20:31:56Z",
    "updated_at": "2022-01-03T20:31:56Z",
    "author_association": "MEMBER",
    "body": "There is some documentation on the tx receipt format for Arbitrum [here](https://developer.offchainlabs.com/docs/arbos_formats). \r\n\r\nHowever, I wonder if this is actually a problem that these receipts look different. @kevinweaver will try this again and run the exact same transaction to be sure we are comparing truffles to truffles, but it looks like on the Truffle side we report this based on the `gasUsed` field which exists in both receipts (see [line 80 here](https://github.com/trufflesuite/truffle/blob/develop/packages/interface-adapter/lib/adapter/web3/index.ts#L80)). Will be helpful to compare this value in both receipts when running the exact same tx I think.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1004341624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1005228471",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1005228471",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1005228471,
    "node_id": "IC_kwDOAkfq-c476pG3",
    "user": {
      "login": "kevinweaver",
      "id": 1020682,
      "node_id": "MDQ6VXNlcjEwMjA2ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinweaver",
      "html_url": "https://github.com/kevinweaver",
      "followers_url": "https://api.github.com/users/kevinweaver/followers",
      "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
      "repos_url": "https://api.github.com/users/kevinweaver/repos",
      "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-04T22:48:24Z",
    "updated_at": "2022-01-05T15:49:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "It looks like the `feeStats` metadata above is more of a symptom than the specific issue.   Truffle uses some data from the transaction response and some from the receipt we get back:\r\n\r\n```js\r\nconst gasPrice = new BN(tx.gasPrice);\r\nconst gas = new BN(receipt.gasUsed);\r\nconst value = new BN(tx.value);\r\n```\r\n\r\nto calculate the cost: \r\n```js\r\nconst cost = gasPrice.mul(gas).add(value);\r\n```\r\n\r\nRun with an example [transaction](https://testnet.arbiscan.io/tx/0x82c589b6c1703bfe48c8555f990e995fdf3ab0df7386222528fcca5bcb632bda), using these values gives us:\r\n```js\r\nconst gasPrice = 13671205\r\nconst gas = 959032\r\nconst value = 0\r\n```\r\nand the calculated cost:\r\n```js\r\nconst cost = 1.3111123e+13 // 13671205 * 959032 + 0;\r\n//      0.00001311112307356 ETH formatted correctly\r\n```\r\n\r\nMeanwhile Arbiscan displays the real transaction fee as:\r\n```\r\nTransaction Fee: 0.00001048913955 ETH  \r\nGas Price Bid:   0.000000000013671205 ETH\r\nGas Price Paid:  0.000000000010936964 ETH\r\n```\r\n\r\nNotice the “Gas Price Bid” is the same `gasPrice` amount we rely on in our calculations.  “Price Bid” does not exist on main net/rinkeby etherscan and doesn’t seem relevant to the price paid.   To solve this, we can’t rely on the `gasPrice` in the transaction.  If we pull from the new `effectiveGasPrice` field in the receipt, we get a closer answer, but it’s still not 100%\r\n```js\r\neffectiveGasPrice: '0xa6e284' // 10936964 in decimal\r\n```\r\n\r\nReplacing gasPrice with effectiveGasPrice  in our calculations:\r\n```js\r\nconst cost = 1.0488898e+13 // 10936964 * 959032 + 0;\r\n```\r\ngives us something closer to the correct cost:\r\n```js\r\n1.0488898e+13.   \r\n// 0.00001048913955 is the “correct” answer.\r\n```\r\nCurrently looking through their docs to understand this better, I'm assuming it has to do with the complexity discussed here: https://developer.offchainlabs.com/docs/arbgas",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1005228471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1005269371",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1005269371",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1005269371,
    "node_id": "IC_kwDOAkfq-c476zF7",
    "user": {
      "login": "fainashalts",
      "id": 8952139,
      "node_id": "MDQ6VXNlcjg5NTIxMzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8952139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fainashalts",
      "html_url": "https://github.com/fainashalts",
      "followers_url": "https://api.github.com/users/fainashalts/followers",
      "following_url": "https://api.github.com/users/fainashalts/following{/other_user}",
      "gists_url": "https://api.github.com/users/fainashalts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fainashalts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fainashalts/subscriptions",
      "organizations_url": "https://api.github.com/users/fainashalts/orgs",
      "repos_url": "https://api.github.com/users/fainashalts/repos",
      "events_url": "https://api.github.com/users/fainashalts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fainashalts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-05T00:12:12Z",
    "updated_at": "2022-01-05T00:12:12Z",
    "author_association": "MEMBER",
    "body": "Thanks for digging into this @kevinweaver! I suggest you reach out in their discord (not in the support channel though, ConsenSys runs that so it will just go to us!) with a question about this discrepancy in case they have any additional info. \r\n\r\nI think it makes sense to dig more here and figure out what exactly goes into the calculation we see on Arbiscan. Looking forward to seeing what you find out!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1005269371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1005618497",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1005618497",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1005618497,
    "node_id": "IC_kwDOAkfq-c478IVB",
    "user": {
      "login": "fredlacs",
      "id": 32464905,
      "node_id": "MDQ6VXNlcjMyNDY0OTA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32464905?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fredlacs",
      "html_url": "https://github.com/fredlacs",
      "followers_url": "https://api.github.com/users/fredlacs/followers",
      "following_url": "https://api.github.com/users/fredlacs/following{/other_user}",
      "gists_url": "https://api.github.com/users/fredlacs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fredlacs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fredlacs/subscriptions",
      "organizations_url": "https://api.github.com/users/fredlacs/orgs",
      "repos_url": "https://api.github.com/users/fredlacs/repos",
      "events_url": "https://api.github.com/users/fredlacs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fredlacs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-05T11:49:24Z",
    "updated_at": "2022-01-05T11:49:24Z",
    "author_association": "NONE",
    "body": "Heya, you can find the custom tx receipt fields documented [here](https://developer.offchainlabs.com/docs/differences_overview#transaction-receipts)\r\n\r\nThe gas fee market in Arbitrum works a bit differently to the L1 - it is inspired by EIP 1559 but adapted to fit the L2 requirements.\r\nThere is a base cost of getting your tx processed. If demand for L2 resources are high, the base cost rises. If demand is low, it decreases.\r\n\r\nThe gas price submitted in a tx only represents the maximum you are willing to pay, the value actually charged will depend on network congestion, similar to a 2nd price auction.\r\n\r\nThe gasPrice in the tx response is the bid a user submitted. The value actually charged is available in the feeStats object under `feeStats.price.l2Computation`. This is also the same value that is surfaced on the `effectiveGasPrice` field.\r\n\r\nFor most accurate view on values charged users I would suggest you add the fields returned in the receipt's `feeStats.paid` as these are the values that the user was charged for (all denominated in wei)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1005618497/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006107222",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1006107222",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1006107222,
    "node_id": "IC_kwDOAkfq-c479_pW",
    "user": {
      "login": "kevinweaver",
      "id": 1020682,
      "node_id": "MDQ6VXNlcjEwMjA2ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinweaver",
      "html_url": "https://github.com/kevinweaver",
      "followers_url": "https://api.github.com/users/kevinweaver/followers",
      "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
      "repos_url": "https://api.github.com/users/kevinweaver/repos",
      "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-05T21:52:35Z",
    "updated_at": "2022-01-05T21:52:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Understood, thanks for the clarification @fredlacs!  I just tried adding those 4 `feeStats.paid` values with my example transaction and came up with the accurate cost.  \r\n\r\nTo support this from the truffle side, I see a few ways forward that I'm curious to hear your thoughts on @gnidan:\r\n\r\n1. Add support within truffle/interface-adapter. Something like this, but cleaner:\r\n```js\r\nif(\"feeStats\" in receipt && \"paid\" in receipt[\"feeStats\"]){\r\n  //Arbitrum\r\n  cost = new BN(Object.values(receipt[\"feeStats\"][\"paid\"]).reduce((sum, value) => sum + value));\r\n} else {\r\n  cost = new BN(gasPrice.mul(gas).add(value));\r\n}\r\n```\r\nA little strange to find L2 specific code in truffle and though this isn't the case with Optimism, it's potentially something we could continue to see in the future.\r\n\r\n2. Add support within the arbitrum-box.  I'm not sure what this looks like off the top of my head, perhaps some sort of migrate command wrapper that appends a warning with the correct value after? Very weird UX, unless there's a better way to approach from the box direction.\r\n\r\n3. Create something like an Arbitrum plugin that overrides Truffle components with Arb specific logic. (I'm not familiar enough with truffle plugins to even say that's how they work).\r\n\r\nAny other ideas?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006107222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006596674",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1006596674",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1006596674,
    "node_id": "IC_kwDOAkfq-c47_3JC",
    "user": {
      "login": "fredlacs",
      "id": 32464905,
      "node_id": "MDQ6VXNlcjMyNDY0OTA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32464905?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fredlacs",
      "html_url": "https://github.com/fredlacs",
      "followers_url": "https://api.github.com/users/fredlacs/followers",
      "following_url": "https://api.github.com/users/fredlacs/following{/other_user}",
      "gists_url": "https://api.github.com/users/fredlacs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fredlacs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fredlacs/subscriptions",
      "organizations_url": "https://api.github.com/users/fredlacs/orgs",
      "repos_url": "https://api.github.com/users/fredlacs/repos",
      "events_url": "https://api.github.com/users/fredlacs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fredlacs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-06T13:34:25Z",
    "updated_at": "2022-01-06T13:34:25Z",
    "author_association": "NONE",
    "body": "If it's worth anything, here are my 2 cents: I think that the `effectiveGasPrice` from the tx receipt should be used instead of the `gasPrice` from the response when deriving this cost (regardless of the network).\r\n\r\nThe calculation using `effectiveGasPrice` instead of the `feeStats` in Arbitrum seems to be a bit off due to rounding on the node - which is something that we've flagged internally. While `feeStats` will give you the exact cost, the `effectiveGasPrice * gasUsed` will be pretty accurate. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006596674/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006776697",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1006776697",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1006776697,
    "node_id": "IC_kwDOAkfq-c48AjF5",
    "user": {
      "login": "kevinweaver",
      "id": 1020682,
      "node_id": "MDQ6VXNlcjEwMjA2ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinweaver",
      "html_url": "https://github.com/kevinweaver",
      "followers_url": "https://api.github.com/users/kevinweaver/followers",
      "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
      "repos_url": "https://api.github.com/users/kevinweaver/repos",
      "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-06T17:36:47Z",
    "updated_at": "2022-01-06T17:37:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "If `effectiveGasPrice` will eventually be updated to fix the inaccuracy, then this^ would definitely simplify things.  And as per [the spec](https://github.com/ethereum/execution-specs/pull/251), we should be migrating toward `effectiveGasPrice` regardless as `gasPrice` was deprecated post-EIP-1559. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006776697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006838313",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1006838313",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1006838313,
    "node_id": "IC_kwDOAkfq-c48AyIp",
    "user": {
      "login": "kevinweaver",
      "id": 1020682,
      "node_id": "MDQ6VXNlcjEwMjA2ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1020682?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinweaver",
      "html_url": "https://github.com/kevinweaver",
      "followers_url": "https://api.github.com/users/kevinweaver/followers",
      "following_url": "https://api.github.com/users/kevinweaver/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinweaver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinweaver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinweaver/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinweaver/orgs",
      "repos_url": "https://api.github.com/users/kevinweaver/repos",
      "events_url": "https://api.github.com/users/kevinweaver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinweaver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-06T18:58:50Z",
    "updated_at": "2022-01-06T18:59:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Just chatted with @davidmurdoch: in ganache v7 eth_getTransactionReceipt returns `effectiveGasPrice`, but no `gasPrice`. In v6 we'd only have `gasPrice`. \r\n\r\nI _think_ \r\n```js\r\nconst gasPrice = new BN(receipt.effectiveGasPrice ?? tx.gasPrice);\r\n``` \r\nshould work with no other changes, but I'll test on different ganache versions and networks.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1006838313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1319070617",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4559#issuecomment-1319070617",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4559",
    "id": 1319070617,
    "node_id": "IC_kwDOAkfq-c5On2uZ",
    "user": {
      "login": "cds-amal",
      "id": 2529600,
      "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds-amal",
      "html_url": "https://github.com/cds-amal",
      "followers_url": "https://api.github.com/users/cds-amal/followers",
      "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
      "organizations_url": "https://api.github.com/users/cds-amal/orgs",
      "repos_url": "https://api.github.com/users/cds-amal/repos",
      "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds-amal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-17T18:59:19Z",
    "updated_at": "2022-11-17T18:59:19Z",
    "author_association": "MEMBER",
    "body": "@fainashalts says this is no longer true!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1319070617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
