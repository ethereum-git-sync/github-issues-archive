{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4161",
  "id": 939806420,
  "node_id": "MDU6SXNzdWU5Mzk4MDY0MjA=",
  "number": 4161,
  "title": "Direct imports from project directory do not have the `project:/` prefix",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1675041356,
      "node_id": "MDU6TGFiZWwxNjc1MDQxMzU2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority2%20%E2%9A%A0%EF%B8%8F",
      "name": "priority2 ⚠️",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-07-08T12:26:56Z",
  "updated_at": "2021-07-24T03:05:21Z",
  "closed_at": "2021-07-24T03:05:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\nWhen using [direct imports](https://docs.soliditylang.org/en/latest/path-resolution.html#direct-imports) (i.e. ones not starting with `./` or `../`) that reference files in project directory Truffle finds the file and includes it in JSON input for the compiler but without the `project:/` prefix (#4137). This results in the file being present in the input twice, under different paths which may lead to errors that seem inexplicable to users.\r\n\r\nSince dropping the `project:/` prefix is not an option (I know that Truffle needs some prefix for internal reasons), the only solution I can suggest is to disallow such imports.\r\n\r\n## Steps to Reproduce\r\nHere's an example situation where this causes a real issue:\r\n```bash\r\nmkdir truffle-test/\r\ncd truffle-test/\r\nnpm install truffle\r\nnpx truffle init\r\necho 'module.exports.compilers.solc.version = \"0.8.6\";' >> truffle-config.js\r\n\r\necho 'interface I {}' > contracts/I.sol\r\necho 'import \"contracts/I.sol\"; contract C is I {}' > contracts/C.sol\r\necho 'import \"./C.sol\"; import \"./I.sol\"; contract D is I, C {}' > contracts/D.sol\r\nnpx truffle compile\r\n```\r\n\r\n## Actual Results\r\n```solidity\r\nDeclarationError: Identifier already declared.\r\n --> project:/contracts/D.sol:1:19:\r\n  |\r\n1 | import \"./C.sol\"; import \"./I.sol\"; contract D is I, C {}\r\n  |                   ^^^^^^^^^^^^^^^^^\r\nNote: The previous declaration is here:\r\n --> contracts/I.sol:1:1:\r\n  |\r\n1 | interface I {}\r\n  | ^^^^^^^^^^^^^^\r\n\r\nCompilation failed. See above.\r\n```\r\n\r\nThe `sources` dict in the JSON input contains these entries:\r\n```json\r\n\"project:/contracts/C.sol\": { \"content\": \"import \\\"contracts/I.sol\\\"; contract C is I {}\\n\" },\r\n\"project:/contracts/D.sol\": { \"content\": \"import \\\"./C.sol\\\"; import \\\"./I.sol\\\"; contract D is I, C {}\\n\" },\r\n\"project:/contracts/I.sol\": { \"content\": \"interface I {}\\n\" },\r\n\"project:/contracts/Migrations.sol\": { \"content\": \"// SPDX-License-Identifier: MIT\\npragma solidity >=0.4.22 <0.9.0;\\n\\ncontract Migrations {\\n  address public owner = msg.sender;\\n  uint public last_completed_migration;\\n\\n  modifier restricted() {\\n    require(\\n      msg.sender == owner,\\n      \\\"This function is restricted to the contract's owner\\\"\\n    );\\n    _;\\n  }\\n\\n  function setCompleted(uint completed) public restricted {\\n    last_completed_migration = completed;\\n  }\\n}\\n\" },\r\n\"contracts/I.sol\": { \"content\": \"interface I {}\\n\" }\r\n```\r\n\r\nCompiler reports an error because it sees interface `I` defined in what seems to be two independent source units: `project:/contracts/I.sol` and `contracts/I.sol`. In effect there are two different interfaces that just happen to share the same name (which is fine unless they're imported from the same file without changing the name).\r\n\r\nI think that this error would be very confusing to users.\r\n\r\n## Expected Behavior\r\nThe above example would compile if we changed the content of `C.sol` to:\r\n```solidity\r\nimport \"./I.sol\";\r\ncontract C is I {}\r\n```\r\n\r\nI would be reasonable to expect both to compile without errors but I don't think this can be achieved without rewriting imports or dropping the `project:/` prefix. Therefore my proposal would be for Truffle to report imports like `import \"contracts/I.sol\"` as errors and only support relative imports (i.e. `import \"./I.sol\"`) for files within project directory.\r\n\r\n## Environment\r\n\r\n* Operating System: Arch Linux\r\n* Truffle version: both `5.3.14` and current `develop` (abfb3646eea9d57e0a6f9186c12bb51680c181d8)\r\n* node version: `v16.4.2`\r\n* npm version: `7.17.0`",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/881776521",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4161#issuecomment-881776521",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161",
    "id": 881776521,
    "node_id": "IC_kwDOAkfq-c40jteJ",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-16T23:56:31Z",
    "updated_at": "2021-07-16T23:56:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, I don't think there's any reasonable way to make this work.  We either have to just disallow such imports (you already weren't really supposed to be doing that, direct imports are for NPM and such!), or get rid of `project:/` (in which case we can make it work but I don't think @gnidan will like that :P ).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/881776521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/885991223",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4161#issuecomment-885991223",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4161",
    "id": 885991223,
    "node_id": "IC_kwDOAkfq-c40zyc3",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-24T03:05:21Z",
    "updated_at": "2021-07-24T03:05:21Z",
    "author_association": "MEMBER",
    "body": "Closing this as no-longer-relevant, as of Truffle v5.4.2 (see [release notes](https://github.com/trufflesuite/truffle/releases/tag/v5.4.2)).\r\n\r\nThanks both of you!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/885991223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
