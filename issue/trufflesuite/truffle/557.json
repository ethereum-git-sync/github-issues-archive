{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/557",
  "id": 254892704,
  "node_id": "MDU6SXNzdWUyNTQ4OTI3MDQ=",
  "number": 557,
  "title": "Truffle Tests using TestRPC appear unstable/inconsistent, passing/failing on same test without cause.",
  "user": {
    "login": "pmumby",
    "id": 1260658,
    "node_id": "MDQ6VXNlcjEyNjA2NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1260658?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pmumby",
    "html_url": "https://github.com/pmumby",
    "followers_url": "https://api.github.com/users/pmumby/followers",
    "following_url": "https://api.github.com/users/pmumby/following{/other_user}",
    "gists_url": "https://api.github.com/users/pmumby/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pmumby/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pmumby/subscriptions",
    "organizations_url": "https://api.github.com/users/pmumby/orgs",
    "repos_url": "https://api.github.com/users/pmumby/repos",
    "events_url": "https://api.github.com/users/pmumby/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pmumby/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 20,
  "created_at": "2017-09-03T18:41:33Z",
  "updated_at": "2022-05-03T23:33:58Z",
  "closed_at": "2017-09-10T06:50:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nGiven the sample project in the repo at: https://github.com/BattleDrome/truffle_bug\r\ntruffle test is experiencing some sort of race condition where running subsequent tests sometimes passes all tests, and sometimes fails some tests. Sometimes it takes 4-5 subsequent tests to encounter the issue. But as test complexity increases, number of failures increases.\r\n\r\nSeems to be a race condition between the migration scripts, and the tests, where the migrations sometimes fail during the test, resulting in state not being properly applied.\r\n\r\n## Steps to Reproduce\r\n\r\n1. Check out the repo from https://github.com/BattleDrome/truffle_bug\r\n2. `truffle compile`\r\n3. `truffle migrate --reset`\r\n4. `truffle test`\r\n\r\nRepeat step 4 as many times as needed to see inconsistent tests.\r\n\r\n## Expected Behavior\r\n\r\nTests should behave consistently. If failures occur randomly we can't \"trust\" the tests, defeating the purpose.\r\n\r\n## Actual Results\r\n\r\nTests pass sometimes, and fail sometimes.\r\n\r\nScreenshot of passed test:\r\n![trufflepass](https://user-images.githubusercontent.com/1260658/30005657-454537d2-90b5-11e7-99d6-b34a49111af6.PNG)\r\n\r\nScreenshot of failed test:\r\n![trufflefail](https://user-images.githubusercontent.com/1260658/30005660-4bf7515a-90b5-11e7-95da-3ef536965e6d.PNG)\r\n\r\nThese tests were run immediately subsequent to one another with no other changes either to code or environment.\r\n\r\n## Environment\r\n\r\n* Operating System: Windows, using bash on ubuntu environment in windows (truffle installed within ubuntu vm)\r\n* Truffle version: 3.4.9\r\n* Ethereum client: TestRPC 4,1,1\r\n* node version: 8.2.1\r\n* npm version: 5.4.0\r\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/557/reactions",
    "total_count": 4,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328232163",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328232163",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328232163,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODIzMjE2Mw==",
    "user": {
      "login": "SCBuergel",
      "id": 11379673,
      "node_id": "MDQ6VXNlcjExMzc5Njcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11379673?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SCBuergel",
      "html_url": "https://github.com/SCBuergel",
      "followers_url": "https://api.github.com/users/SCBuergel/followers",
      "following_url": "https://api.github.com/users/SCBuergel/following{/other_user}",
      "gists_url": "https://api.github.com/users/SCBuergel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SCBuergel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SCBuergel/subscriptions",
      "organizations_url": "https://api.github.com/users/SCBuergel/orgs",
      "repos_url": "https://api.github.com/users/SCBuergel/repos",
      "events_url": "https://api.github.com/users/SCBuergel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SCBuergel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-08T22:54:09Z",
    "updated_at": "2017-09-08T22:54:09Z",
    "author_association": "NONE",
    "body": "We ran into the same issue. It is hard to reproduce and it is hard to provide a minimum working example. [I cannot post the code that we got from the customer to audit.] When minimizing the contract that failed to a hello-world-style example with getter and setter functions all tests seemed to always be working well. The issue seems to surface beyond a certain complexity.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328232163/reactions",
      "total_count": 5,
      "+1": 5,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328281731",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328281731",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328281731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODI4MTczMQ==",
    "user": {
      "login": "pmumby",
      "id": 1260658,
      "node_id": "MDQ6VXNlcjEyNjA2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1260658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pmumby",
      "html_url": "https://github.com/pmumby",
      "followers_url": "https://api.github.com/users/pmumby/followers",
      "following_url": "https://api.github.com/users/pmumby/following{/other_user}",
      "gists_url": "https://api.github.com/users/pmumby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pmumby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pmumby/subscriptions",
      "organizations_url": "https://api.github.com/users/pmumby/orgs",
      "repos_url": "https://api.github.com/users/pmumby/repos",
      "events_url": "https://api.github.com/users/pmumby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pmumby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-09T14:47:44Z",
    "updated_at": "2017-09-09T14:47:44Z",
    "author_association": "NONE",
    "body": "Yeah I found the same thing. The example code repo I linked is a minimal working example. I slowly added complexity until the issue presented itself regularly enough to verify. Still intermittent, but doing 5-6 subsequent tests should exhibit the instability.\r\n\r\nThe more the complexity ramps up, the more frequently the test failures are encountered (until you hit a point where you have to run it 8-9 times just to get a passed test). Which is where I'm at in my main project currently.\r\n\r\nThe issue *appears* to be a race condition between the migration scripts, and the test framework. ie: somehow the migrations are not fully completing on the chain in TestRPC before the tests run, and as a result the tests fail for various reasons.\r\n\r\nSo far I've been unable to nail down exactly where this race condition is though.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328281731/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328304175",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328304175",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328304175,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODMwNDE3NQ==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-09T21:20:19Z",
    "updated_at": "2017-09-09T21:20:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "As a workaround you can change the migration code to not use `async`.  For example, with the repo you linked you can change `migrations/4_setup.js` to be\r\n\r\n```\r\nmodule.exports = function(deployer, network, accounts) {\r\n    var primary = accounts[0];\r\n    return ContractA.deployed().then(aInstance => {\r\n        return ContractB.deployed().then(bInstance => {\r\n            return aInstance.setBAddress(bInstance.address).then(() => {\r\n                return bInstance.setAAddress(aInstance.address);\r\n            });\r\n        });\r\n    });\r\n};\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328304175/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328306714",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328306714",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328306714,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODMwNjcxNA==",
    "user": {
      "login": "SCBuergel",
      "id": 11379673,
      "node_id": "MDQ6VXNlcjExMzc5Njcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11379673?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SCBuergel",
      "html_url": "https://github.com/SCBuergel",
      "followers_url": "https://api.github.com/users/SCBuergel/followers",
      "following_url": "https://api.github.com/users/SCBuergel/following{/other_user}",
      "gists_url": "https://api.github.com/users/SCBuergel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SCBuergel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SCBuergel/subscriptions",
      "organizations_url": "https://api.github.com/users/SCBuergel/orgs",
      "repos_url": "https://api.github.com/users/SCBuergel/repos",
      "events_url": "https://api.github.com/users/SCBuergel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SCBuergel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-09T22:18:04Z",
    "updated_at": "2017-09-09T22:18:04Z",
    "author_association": "NONE",
    "body": "Some observations, that might help:\r\n- When contract is \"too simple\" (too fast?) this issue happens less frequently.\r\n- When javascript is \"too slow\" this issue happens less frequently, e.g. a simple `console.log` before proceeding usually prevents the issue from happening at all.\r\n- This issue usually surfaces more frequently with promises than with `async`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328306714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328314487",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328314487",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328314487,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODMxNDQ4Nw==",
    "user": {
      "login": "pmumby",
      "id": 1260658,
      "node_id": "MDQ6VXNlcjEyNjA2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1260658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pmumby",
      "html_url": "https://github.com/pmumby",
      "followers_url": "https://api.github.com/users/pmumby/followers",
      "following_url": "https://api.github.com/users/pmumby/following{/other_user}",
      "gists_url": "https://api.github.com/users/pmumby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pmumby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pmumby/subscriptions",
      "organizations_url": "https://api.github.com/users/pmumby/orgs",
      "repos_url": "https://api.github.com/users/pmumby/repos",
      "events_url": "https://api.github.com/users/pmumby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pmumby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T01:59:33Z",
    "updated_at": "2017-09-10T01:59:33Z",
    "author_association": "NONE",
    "body": "Thanks for the suggestion, but I should note, that before creating this\ntest case, the problem originally showed in code that was NOT using async\nat all...\n\nIn the case of my example yes I'm using async, but it doesn't matter. This\nproblem will exhibit without async as well. Async does seem to make it\nworse however (why I added it to make this example). For example turning\nasync on in the example code appears to alleviate it, until you push the\ncomplexity up a little more, then it shows up again anyway.\n\nIn my main project, with async on in the migrations, it errors out 100% of\nthe time, with async removed using nested promises with .then() it only\nfails 60% to 75% of the time, but still a major issue.\n\nOn Sat, Sep 9, 2017 at 5:20 PM, Jim McDonald <notifications@github.com>\nwrote:\n\n> As a workaround you can change the migration code to not use async. For\n> example, with the repo you linked you can change migrations/4_setup.js to\n> be\n>\n> module.exports = function(deployer, network, accounts) {\n>     var primary = accounts[0];\n>     return ContractA.deployed().then(aInstance => {\n>         return ContractB.deployed().then(bInstance => {\n>             return aInstance.setBAddress(bInstance.address).then(() => {\n>                 return bInstance.setAAddress(aInstance.address);\n>             });\n>         });\n>     });\n> };\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/trufflesuite/truffle/issues/557#issuecomment-328304175>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABM8ckQtoLyZkAfUiUZDrDKPmBVJyA9Gks5sgwEXgaJpZM4PLRD3>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328314487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328314543",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328314543",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328314543,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODMxNDU0Mw==",
    "user": {
      "login": "pmumby",
      "id": 1260658,
      "node_id": "MDQ6VXNlcjEyNjA2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1260658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pmumby",
      "html_url": "https://github.com/pmumby",
      "followers_url": "https://api.github.com/users/pmumby/followers",
      "following_url": "https://api.github.com/users/pmumby/following{/other_user}",
      "gists_url": "https://api.github.com/users/pmumby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pmumby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pmumby/subscriptions",
      "organizations_url": "https://api.github.com/users/pmumby/orgs",
      "repos_url": "https://api.github.com/users/pmumby/repos",
      "events_url": "https://api.github.com/users/pmumby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pmumby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T02:01:24Z",
    "updated_at": "2017-09-10T02:01:24Z",
    "author_association": "NONE",
    "body": "Yes thanks for this, you are correct, adding some additional \"time\nconsuming\" tasks in the right spot can sometimes bounce you out of the\napparent race condition.\n\nAlso your comment about promises vs async, I should further clarify my\nother note.\n\nAsync in the migrations seems to make it much worse.\nAsync in the tests seems to alleviate the problem somewhat.\n\nOn Sat, Sep 9, 2017 at 6:18 PM, Sebastian C. Bürgel <\nnotifications@github.com> wrote:\n\n> Some observations, that might help:\n>\n>    - When contract is \"too simple\" (too fast?) this issue happens less\n>    frequently.\n>    - When javascript is \"too slow\" this issue happens less frequently,\n>    e.g. a simple console.log before proceeding usually prevents the issue\n>    from happening at all.\n>    - This issue usually surfaces more frequently with promises than with\n>    async.\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/trufflesuite/truffle/issues/557#issuecomment-328306714>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABM8cr20acGl8Zz_xZh4maMODOUNllTmks5sgw6fgaJpZM4PLRD3>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328314543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328323842",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328323842",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328323842,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODMyMzg0Mg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T06:50:39Z",
    "updated_at": "2017-09-10T06:52:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi there. Creator of Truffle here. \r\n\r\nWhen your migrations are run, your contracts aren't being deployed. Instead, the migrations are staging deployment tasks to be later performed by the migration system. So the code: \r\n\r\n```\r\ndeployer.deploy(A);\r\n```\r\n\r\nDoesn't actually deploy `A`. Instead it says, \"Please deploy A for me.\" Making the request for `A`'s deployment `async` doesn't make much sense in this context. You can think of the deployer as a deployment stager; it'll stage deployment tasks for later execution. \r\n\r\nAs of yet, Truffle's migration system doesn't yet support `async`. Your best bet at this moment is to not use `async` code in your migrations. And you don't really need to. For most tasks, say, two deployments, you can simply say: \r\n\r\n```\r\ndeployer.deploy(A);\r\ndeployer.deploy(B); \r\n```\r\n\r\nThe deployer knows that the deployment of A is staged before B, and it'll run the deployments sequentially.\r\n\r\nIf you need more specialty deployments, like deploying B by passing A's address into B's constructor, you'd do something like this:\r\n\r\n```\r\ndeployer.deploy(A).then(function() {\r\n  return deployer.deploy(B, A.address);\r\n});\r\n```\r\n\r\nThis will ensure deployment of B happens after the deployment of A, and the code that evaluates `A.address` is also run after A is deployed.\r\n\r\nSo, with that in mind, this is all a long way of saying that `async` is the cause of your race condition. We'll likely upgrade the migration system some time in the future to support `async`/instantaneous deployments (i.e., the removal of staged deploys), but that will be after `async` is included in node's LTS support.  \r\n\r\n(As an aside, the reason your tests work well with `async` is because you're not using the deployer.)\r\n\r\nI'm going to close this ticket as this isn't a bug, per se. Please see [our documentation](http://truffleframework.com/docs/getting_started/migrations) for more information on migrations.\r\n\r\nCheers! \r\n\r\nCC @gnidan \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328323842/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328348642",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328348642",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328348642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM0ODY0Mg==",
    "user": {
      "login": "pmumby",
      "id": 1260658,
      "node_id": "MDQ6VXNlcjEyNjA2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1260658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pmumby",
      "html_url": "https://github.com/pmumby",
      "followers_url": "https://api.github.com/users/pmumby/followers",
      "following_url": "https://api.github.com/users/pmumby/following{/other_user}",
      "gists_url": "https://api.github.com/users/pmumby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pmumby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pmumby/subscriptions",
      "organizations_url": "https://api.github.com/users/pmumby/orgs",
      "repos_url": "https://api.github.com/users/pmumby/repos",
      "events_url": "https://api.github.com/users/pmumby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pmumby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T15:07:06Z",
    "updated_at": "2017-09-10T15:07:06Z",
    "author_association": "NONE",
    "body": "Hi Tim, and thanks for the detailed response.\n\nPerhaps I shouldn't have used Async in my example, but as I commented in my\nearlier note. This issue DOES present itself when no use of async exists.\n(in either the tests or the migrations).\n\nIn my original project I had used promises with .then() throughout the\nmigrations and the tests. And that's where I first experienced it. Again as\ncomplexity increases, probability of a randomly failed test increases.\n\nUse of async in the tests seems to reduce this probability, and use of\nasync in the migrations seems to increase it. But the problem is still\npresent. And at the current size of my project even with pure promise based\ncode, I'm seeing failed tests very frequently. (with the exact same\nbehavior outlined in this issue).\n\nMy problem is that it seems the steps of the migration are not always\ncompleted before the tests are run. And using for example A.deployed() to\nget a promise for the eventual deployed contract which is queued, should\nwait until the migration is successful, and then return. But it in fact\ndoes not appear to (in some cases).\n\nThe example code was meant to demonstrate that, and the use of async seemed\nto help it along, but I could modify that repo to exhibit the problem using\nnothing but promises if that would be helpful.\n\nOn Sun, Sep 10, 2017 at 2:50 AM, Tim Coulter <notifications@github.com>\nwrote:\n\n> Hi there. Creator of Truffle here.\n>\n> When your migrations are run, your contracts aren't being deployed.\n> Instead, they are staging deployment tasks to be later performed by the\n> migration system. So the code:\n>\n> deployer.deploy(A);\n>\n> Doesn't actually deploy A. Instead it says, \"Please deploy A for me.\"\n> Making the request for A's deployment async doesn't make much sense in\n> this context. You can think of the deployer as a deployment stager; it'll\n> stage deployments tasks for later execution.\n>\n> As of yet, Truffle's migration system doesn't yet support async. Your\n> best bet at this moment is to not use async code in your migrations. And\n> you don't really need to. For most tasks, say, two deployments, you can\n> simply say:\n>\n> deployer.deploy(A);\n> deployer.deploy(B);\n>\n> The deployer knows that the deployment of A is staged before B, and it'll\n> run the deployments sequentially.\n>\n> If you need more specialty deployments, like deploying B by passing A's\n> address into B's constructor, you'd do something like this:\n>\n> deployer.deploy(A).then(function() {\n>   return deployer.deploy(B, A.address);\n> });\n>\n> This will ensure deployment of B happens after the deployment of A, and\n> the code that evaluates A.address is also run after A is deployed.\n>\n> So, with that in mind, this is all a long way of saying that async is the\n> cause of your race condition. We'll likely upgrade the migration system\n> some time in the future to support async/instantaneous deployments (i.e.,\n> the remove of staged deploys), but that will be after async is included\n> in node's LTS support.\n>\n> (As an aside, the reason your tests work well with async is because\n> you're not using the deployer.)\n>\n> I'm going to close this ticket as this isn't a bug, per se. Please see our\n> documentation\n> <http://truffleframework.com/docs/getting_started/migrations> for more\n> information on migrations.\n>\n> Cheers!\n>\n> CC @gnidan <https://github.com/gnidan>\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/trufflesuite/truffle/issues/557#issuecomment-328323842>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABM8clJGuwVsXxZQd5xWaqUHI_Pia5DBks5sg4bCgaJpZM4PLRD3>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328348642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328355636",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328355636",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328355636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM1NTYzNg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T16:52:17Z",
    "updated_at": "2017-09-10T16:52:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Before I look into this further, can you remove all `async` and `await` expressions from  your migrations? The migrations themselves shouldn't be `async`, and you shouldn't be calling `await` with the deployer.\r\n\r\nIf migrations still aren't being set up correctly, then I'll look into this further. As it stands now, the most likely culprit is `async`/`await`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328355636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328356802",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328356802",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328356802,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM1NjgwMg==",
    "user": {
      "login": "pmumby",
      "id": 1260658,
      "node_id": "MDQ6VXNlcjEyNjA2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1260658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pmumby",
      "html_url": "https://github.com/pmumby",
      "followers_url": "https://api.github.com/users/pmumby/followers",
      "following_url": "https://api.github.com/users/pmumby/following{/other_user}",
      "gists_url": "https://api.github.com/users/pmumby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pmumby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pmumby/subscriptions",
      "organizations_url": "https://api.github.com/users/pmumby/orgs",
      "repos_url": "https://api.github.com/users/pmumby/repos",
      "events_url": "https://api.github.com/users/pmumby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pmumby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T17:09:54Z",
    "updated_at": "2017-09-10T17:09:54Z",
    "author_association": "NONE",
    "body": "Hi Tim, thanks!\n\nI've updated the example repo. All migrations have been updated to use\npromises. All references to async/await have been removed from the 4\nmigration files:\n1_initial_migration.js\n2_deploy_a.js\n3_deploy_b.js\n4_setup.js\n\nIt should also be noted, I've previously verified this issue continues to\nexist even if I condense these down to a single migration script which does\nthe deployment/setup of all contracts all with proper chained promises as\nwell. The same problem occurs.\n\nI've verified this is still failing at least 50% of the time (in my case it\nfailed 3 times, before I got a successful test).\n\nThanks for looking into it further!\n\n\nOn Sun, Sep 10, 2017 at 12:52 PM, Tim Coulter <notifications@github.com>\nwrote:\n\n> Before I look into this further, can you remove all async and await\n> expressions from your migrations? The migrations themselves shouldn't be\n> async, and you shouldn't be calling await with the deployer.\n>\n> If migrations still aren't being set up correctly, then I'll look into\n> this further. As it stands now, the most likely culprit is async/await.\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/trufflesuite/truffle/issues/557#issuecomment-328355636>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABM8cka5JrMxL2pOwH09Z_rmPL0dCPp9ks5shBPFgaJpZM4PLRD3>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328356802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328368544",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328368544",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328368544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM2ODU0NA==",
    "user": {
      "login": "SCBuergel",
      "id": 11379673,
      "node_id": "MDQ6VXNlcjExMzc5Njcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11379673?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SCBuergel",
      "html_url": "https://github.com/SCBuergel",
      "followers_url": "https://api.github.com/users/SCBuergel/followers",
      "following_url": "https://api.github.com/users/SCBuergel/following{/other_user}",
      "gists_url": "https://api.github.com/users/SCBuergel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SCBuergel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SCBuergel/subscriptions",
      "organizations_url": "https://api.github.com/users/SCBuergel/orgs",
      "repos_url": "https://api.github.com/users/SCBuergel/repos",
      "events_url": "https://api.github.com/users/SCBuergel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SCBuergel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T20:12:06Z",
    "updated_at": "2017-09-10T20:12:06Z",
    "author_association": "NONE",
    "body": "Same thing here, failing for a vanilla migrations script without `async` if\r\n1) the contract is sufficiently complex AND\r\n2) the JS test code is sufficiently efficient (no `console.logs`, statements ideally inlined)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328368544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328373432",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328373432",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328373432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM3MzQzMg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T21:31:23Z",
    "updated_at": "2017-09-10T21:31:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "If using `deployer.then()`, which you are in the fourth migration, you should return further promises so they're included in the chain. e.g., [this line](https://github.com/BattleDrome/truffle_bug/blob/master/migrations/4_setup.js#L10) will run asynchronously because the enclosing `.then()` doesn't know they're executing.\r\n\r\nTL;DR: stick a `return` on the start of that line, it should fix your issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328373432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328380468",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328380468",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328380468,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM4MDQ2OA==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T23:32:33Z",
    "updated_at": "2017-09-10T23:32:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Better yet, make it a single chain, without nested promises:\r\n\r\n```\r\n    var aInstance;\r\n    var bInstance;\r\n    deployer.then(function(){\r\n        return ContractA.deployed();\r\n    }).then(function(instance){\r\n        aInstance = instance;\r\n        return ContractB.deployed();\r\n    }).then(function(instance){\r\n        bInstance = instance;\r\n    }).then(function(){            \r\n        aInstance.setBAddress(bInstance.address);\r\n        bInstance.setAAddress(aInstance.address);\r\n        console.log(\"Setup Migration Done!\");\r\n    });\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328380468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328381176",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-328381176",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 328381176,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODM4MTE3Ng==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-10T23:39:18Z",
    "updated_at": "2017-09-10T23:39:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "And I just noticed: `aInstance.setBAddress()` is a transaction, hence, a promise. You should do these individually (or use `Promise.all()` to put them in one `.then()`):\r\n\r\n```\r\n    var aInstance;\r\n    var bInstance;\r\n    deployer.then(function(){\r\n        return ContractA.deployed();\r\n    }).then(function(instance){\r\n        aInstance = instance;\r\n        return ContractB.deployed();\r\n    }).then(function(instance){\r\n        bInstance = instance;\r\n    }).then(function(){            \r\n        return aInstance.setBAddress(bInstance.address);\r\n    }).then(function() {\r\n        return bInstance.setAAddress(aInstance.address);\r\n    }).then(function() {\r\n        console.log(\"Setup Migration Done!\");\r\n    });\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328381176/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/400282161",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-400282161",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 400282161,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDI4MjE2MQ==",
    "user": {
      "login": "JonathanScialpi",
      "id": 14203015,
      "node_id": "MDQ6VXNlcjE0MjAzMDE1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14203015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JonathanScialpi",
      "html_url": "https://github.com/JonathanScialpi",
      "followers_url": "https://api.github.com/users/JonathanScialpi/followers",
      "following_url": "https://api.github.com/users/JonathanScialpi/following{/other_user}",
      "gists_url": "https://api.github.com/users/JonathanScialpi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JonathanScialpi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JonathanScialpi/subscriptions",
      "organizations_url": "https://api.github.com/users/JonathanScialpi/orgs",
      "repos_url": "https://api.github.com/users/JonathanScialpi/repos",
      "events_url": "https://api.github.com/users/JonathanScialpi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JonathanScialpi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-26T12:02:20Z",
    "updated_at": "2018-06-26T12:02:20Z",
    "author_association": "NONE",
    "body": "This article helped me resolve this issue and made my code much cleaner: https://medium.com/coinmonks/testing-solidity-with-truffle-and-async-await-396e81c54f93",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/400282161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/555550556",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-555550556",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 555550556,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTU1MDU1Ng==",
    "user": {
      "login": "Shirikatsu",
      "id": 4716816,
      "node_id": "MDQ6VXNlcjQ3MTY4MTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4716816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Shirikatsu",
      "html_url": "https://github.com/Shirikatsu",
      "followers_url": "https://api.github.com/users/Shirikatsu/followers",
      "following_url": "https://api.github.com/users/Shirikatsu/following{/other_user}",
      "gists_url": "https://api.github.com/users/Shirikatsu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Shirikatsu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Shirikatsu/subscriptions",
      "organizations_url": "https://api.github.com/users/Shirikatsu/orgs",
      "repos_url": "https://api.github.com/users/Shirikatsu/repos",
      "events_url": "https://api.github.com/users/Shirikatsu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Shirikatsu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-19T15:09:28Z",
    "updated_at": "2019-11-19T15:09:28Z",
    "author_association": "NONE",
    "body": "Is this still the same on latest versions?\r\n\r\nNow we can simply run `truffle test` without prior compilation or deployment and it gets compiled and deployed on the fly. This means we don't have control over how this happens yet I am still having issues where there seem to be race conditions and tests fail mid-execution throwing errors like:\r\n\r\n```\r\n{ AssertionError: expected promise to be rejected but it was fulfilled with { Object (tx, receipt, ...) }\r\n  message: 'expected promise to be rejected but it was fulfilled with { Object (tx, receipt, ...) }',\r\n  showDiff: true,\r\n  actual: \r\n   { tx: '0xeb51cef6708fe4a17c6a9f4eca4de0178795c3ae1738e3d1fc74931fe7ea72a7',\r\n     receipt: \r\n      { transactionHash: '0xeb51cef6708fe4a17c6a9f4eca4de0178795c3ae1738e3d1fc74931fe7ea72a7',\r\n        transactionIndex: 0,\r\n        blockHash: '0xd0f18a5f18a03001e7b63554834712634578bc4ab9c10dcf3fe3d5b0bc553fe2',\r\n        blockNumber: 172,\r\n        from: '0xf8dee77490590ec7c9856caa79bf680474cac8af',\r\n        to: '0x0e60af7ee2e62e24f39de38ee052907357cfa07e',\r\n        gasUsed: 50648,\r\n        cumulativeGasUsed: 50648,\r\n        contractAddress: null,\r\n        logs: [],\r\n        status: true,\r\n        logsBloom: '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\r\n        v: '0x1c',\r\n        r: '0x3de661523731aa289b925600eebe1dd7e2a33ffe201dd1b9102b1d0d6351abf7',\r\n        s: '0x32346a8b7b0345a5660258059b734066cf58c5b8d83058646becc41b7d2a5949',\r\n        rawLogs: [] },\r\n     logs: [] },\r\n  expected: undefined }\r\nTruffleConfig {\r\n  _deepCopy: [ 'compilers' ],\r\n  _values: \r\n   { truffle_directory: '/home/cc/Repositories/ion/node_modules/truffle',\r\n     working_directory: '/home/cc/Repositories/ion',\r\n     network: 'development',\r\n     networks: { development: [Object], clique: [Object], coverage: [Object] },\r\n     verboseRpc: false,\r\n     gas: null,\r\n     gasPrice: null,\r\n     from: null,\r\n     confirmations: 0,\r\n     timeoutBlocks: 0,\r\n     production: false,\r\n     skipDryRun: false,\r\n     build: null,\r\n     resolver: \r\n      TestResolver {\r\n        resolver: [Object],\r\n        source: [Object],\r\n        search_path: '/tmp/test-1191019-11489-7ctub6.kmz2',\r\n        seen: [],\r\n        require_cache: {},\r\n        cache_on: true },\r\n     artifactor: Artifactor { destination: '/tmp/test-1191019-11489-7ctub6.kmz2' },\r\n     ethpm: \r\n      { ipfs_host: 'ipfs.infura.io',\r\n        ipfs_protocol: 'https',\r\n        registry: '0x8011df4830b4f696cd81393997e5371b93338878',\r\n        install_provider_uri: 'https://ropsten.infura.io/truffle' },\r\n     ens: { enabled: false, registryAddress: null },\r\n     compilers: { solc: [Object], vyper: {} },\r\n     logger: \r\n      Console {\r\n        log: [Function: bound consoleCall],\r\n        debug: [Function: bound consoleCall],\r\n        info: [Function: bound consoleCall],\r\n        warn: [Function],\r\n        error: [Function: bound consoleCall],\r\n        dir: [Function: bound consoleCall],\r\n        time: [Function: bound consoleCall],\r\n        timeEnd: [Function: bound consoleCall],\r\n        trace: [Function: bound consoleCall],\r\n        assert: [Function: bound consoleCall],\r\n        clear: [Function: bound consoleCall],\r\n        count: [Function: bound consoleCall],\r\n        countReset: [Function: bound countReset],\r\n        group: [Function: bound consoleCall],\r\n        groupCollapsed: [Function: bound consoleCall],\r\n        groupEnd: [Function: bound consoleCall],\r\n        Console: [Function: Console],\r\n        dirxml: [Function: dirxml],\r\n        table: [Function: table],\r\n        markTimeline: [Function: markTimeline],\r\n        profile: [Function: profile],\r\n        profileEnd: [Function: profileEnd],\r\n        timeline: [Function: timeline],\r\n        timelineEnd: [Function: timelineEnd],\r\n        timeStamp: [Function: timeStamp],\r\n        context: [Function: context],\r\n        [Symbol(counts)]: Map {} },\r\n     build_directory: '/home/cc/Repositories/ion/build',\r\n     contracts_directory: '/home/cc/Repositories/ion/contracts',\r\n     contracts_build_directory: '/tmp/test-1191019-11489-7ctub6.kmz2',\r\n     migrations_directory: '/home/cc/Repositories/ion/migrations',\r\n     migrations_file_extension_regexp: /^\\.(js|es6?)$/,\r\n     test_directory: '/home/cc/Repositories/ion/test',\r\n     test_file_extension_regexp: /.*\\.(js|ts|es|es6|jsx|sol)$/,\r\n     example_project_directory: '/home/cc/Repositories/ion/node_modules/truffle/example' },\r\n  truffle_directory: '/home/cc/Repositories/ion/node_modules/truffle',\r\n  working_directory: '/home/cc/Repositories/ion',\r\n  network: 'development',\r\n  networks: \r\n   { development: \r\n      { host: 'localhost',\r\n        port: 8545,\r\n        gas: 4503599627370495,\r\n        network_id: 1234,\r\n        from: '0xf8DEE77490590ec7c9856CAa79bf680474Cac8AF' },\r\n     clique: { host: 'localhost', port: 8501, network_id: '*' },\r\n     coverage: \r\n      { host: 'localhost',\r\n        port: 8555,\r\n        network_id: '*',\r\n        gas: 268435455,\r\n        gasprice: 1 } },\r\n  verboseRpc: false,\r\n  build: null,\r\n  resolver: \r\n   Resolver {\r\n     options: \r\n      TruffleConfig {\r\n        _deepCopy: [Array],\r\n        _values: [Object],\r\n        truffle_directory: [Getter/Setter],\r\n        working_directory: [Getter/Setter],\r\n        network: [Getter/Setter],\r\n        networks: [Getter/Setter],\r\n        verboseRpc: [Getter/Setter],\r\n        build: [Getter/Setter],\r\n        resolver: [Getter/Setter],\r\n        artifactor: [Getter/Setter],\r\n        ethpm: [Getter/Setter],\r\n        logger: [Getter/Setter],\r\n        compilers: [Getter/Setter],\r\n        ens: [Getter/Setter],\r\n        build_directory: [Getter/Setter],\r\n        contracts_directory: [Getter/Setter],\r\n        contracts_build_directory: [Getter/Setter],\r\n        migrations_directory: [Getter/Setter],\r\n        migrations_file_extension_regexp: [Getter/Setter],\r\n        test_directory: [Getter/Setter],\r\n        test_file_extension_regexp: [Getter/Setter],\r\n        example_project_directory: [Getter/Setter],\r\n        network_id: [Getter/Setter],\r\n        network_config: [Getter/Setter],\r\n        from: [Getter/Setter],\r\n        gas: [Getter/Setter],\r\n        gasPrice: [Getter/Setter],\r\n        provider: [Getter/Setter],\r\n        confirmations: [Getter/Setter],\r\n        production: [Getter/Setter],\r\n        timeoutBlocks: [Getter/Setter],\r\n        mocha: [Object],\r\n        solc: [Object],\r\n        _: [],\r\n        'show-events': false,\r\n        showEvents: false,\r\n        debug: false,\r\n        'runner-output-only': false,\r\n        runnerOutputOnly: false,\r\n        'debug-global': 'debug',\r\n        debugGlobal: 'debug' },\r\n     sources: [ [Object], [Object], GlobalNPM {}, [Object] ] },\r\n  artifactor: Artifactor { destination: '/tmp/test-1191019-11489-7ctub6.kmz2' },\r\n  ethpm: \r\n   { ipfs_host: 'ipfs.infura.io',\r\n     ipfs_protocol: 'https',\r\n     registry: '0x8011df4830b4f696cd81393997e5371b93338878',\r\n     install_provider_uri: 'https://ropsten.infura.io/truffle' },\r\n  logger: \r\n   Console {\r\n     log: [Function: bound consoleCall],\r\n     debug: [Function: bound consoleCall],\r\n     info: [Function: bound consoleCall],\r\n     warn: [Function],\r\n     error: [Function: bound consoleCall],\r\n     dir: [Function: bound consoleCall],\r\n     time: [Function: bound consoleCall],\r\n     timeEnd: [Function: bound consoleCall],\r\n     trace: [Function: bound consoleCall],\r\n     assert: [Function: bound consoleCall],\r\n     clear: [Function: bound consoleCall],\r\n     count: [Function: bound consoleCall],\r\n     countReset: [Function: bound countReset],\r\n     group: [Function: bound consoleCall],\r\n     groupCollapsed: [Function: bound consoleCall],\r\n     groupEnd: [Function: bound consoleCall],\r\n     Console: [Function: Console],\r\n     dirxml: [Function: dirxml],\r\n     table: [Function: table],\r\n     markTimeline: [Function: markTimeline],\r\n     profile: [Function: profile],\r\n     profileEnd: [Function: profileEnd],\r\n     timeline: [Function: timeline],\r\n     timelineEnd: [Function: timelineEnd],\r\n     timeStamp: [Function: timeStamp],\r\n     context: [Function: context],\r\n     [Symbol(counts)]: Map {} },\r\n  compilers: { solc: { settings: [Object] }, vyper: {} },\r\n  ens: { enabled: false, registryAddress: null },\r\n  build_directory: '/home/cc/Repositories/ion/build',\r\n  contracts_directory: '/home/cc/Repositories/ion/contracts',\r\n  contracts_build_directory: '/tmp/test-1191019-11489-7ctub6.kmz2',\r\n  migrations_directory: '/home/cc/Repositories/ion/migrations',\r\n  migrations_file_extension_regexp: /^\\.(js|es6?)$/,\r\n  test_directory: '/home/cc/Repositories/ion/test',\r\n  test_file_extension_regexp: /.*\\.(js|ts|es|es6|jsx|sol)$/,\r\n  example_project_directory: '/home/cc/Repositories/ion/node_modules/truffle/example',\r\n  network_id: 1234,\r\n  network_config: \r\n   { gas: 4503599627370495,\r\n     gasPrice: 20000000000,\r\n     from: '0xf8DEE77490590ec7c9856CAa79bf680474Cac8AF',\r\n     host: 'localhost',\r\n     port: 8545,\r\n     network_id: 1234 },\r\n  from: '0xf8DEE77490590ec7c9856CAa79bf680474Cac8AF',\r\n  gas: 4503599627370495,\r\n  gasPrice: 20000000000,\r\n  provider: \r\n   HttpProvider {\r\n     host: 'http://localhost:8545',\r\n     httpAgent: \r\n      Agent {\r\n        domain: null,\r\n        _events: [Object],\r\n        _eventsCount: 1,\r\n        _maxListeners: undefined,\r\n        defaultPort: 80,\r\n        protocol: 'http:',\r\n        options: [Object],\r\n        requests: {},\r\n        sockets: {},\r\n        freeSockets: {},\r\n        keepAliveMsecs: 1000,\r\n        keepAlive: false,\r\n        maxSockets: Infinity,\r\n        maxFreeSockets: 256 },\r\n     withCredentials: false,\r\n     timeout: 0,\r\n     headers: undefined,\r\n     connected: false,\r\n     send: [Function],\r\n     _alreadyWrapped: true },\r\n  confirmations: undefined,\r\n  production: undefined,\r\n  timeoutBlocks: undefined,\r\n  mocha: \r\n   { useColors: true,\r\n     enableTimeouts: false,\r\n     reporterOptions: undefined,\r\n     files: \r\n      [ '/home/cc/Repositories/ion/test/clique.js',\r\n        '/home/cc/Repositories/ion/test/helpers/encoder.js',\r\n        '/home/cc/Repositories/ion/test/helpers/utils.js',\r\n        '/home/cc/Repositories/ion/test/ibft.js',\r\n        '/home/cc/Repositories/ion/test/integration-base_fabric.js',\r\n        '/home/cc/Repositories/ion/test/integration-clique_ethereum.js',\r\n        '/home/cc/Repositories/ion/test/ion.js',\r\n        '/home/cc/Repositories/ion/test/patricia_trie_test.js',\r\n        '/home/cc/Repositories/ion/test/storage-ethereum.js',\r\n        '/home/cc/Repositories/ion/test/storage-fabric.js' ] },\r\n  solc: { optimizer: { enabled: true, runs: 200 } },\r\n  _: [],\r\n  'show-events': false,\r\n  showEvents: false,\r\n  debug: false,\r\n  'runner-output-only': false,\r\n  runnerOutputOnly: false,\r\n  'debug-global': 'debug',\r\n  debugGlobal: 'debug',\r\n  test_files: \r\n   [ '/home/cc/Repositories/ion/test/clique.js',\r\n     '/home/cc/Repositories/ion/test/helpers/encoder.js',\r\n     '/home/cc/Repositories/ion/test/helpers/utils.js',\r\n     '/home/cc/Repositories/ion/test/ibft.js',\r\n     '/home/cc/Repositories/ion/test/integration-base_fabric.js',\r\n     '/home/cc/Repositories/ion/test/integration-clique_ethereum.js',\r\n     '/home/cc/Repositories/ion/test/ion.js',\r\n     '/home/cc/Repositories/ion/test/patricia_trie_test.js',\r\n     '/home/cc/Repositories/ion/test/storage-ethereum.js',\r\n     '/home/cc/Repositories/ion/test/storage-fabric.js' ] }\r\n/home/cc/Repositories/ion/node_modules/truffle/node_modules/mocha/lib/runner.js:726\r\n  err.uncaught = true;\r\n               ^\r\n\r\nTypeError: Cannot create property 'uncaught' on string 'abort({\"name\":\"AssertionError\",\"message\":\"expected promise to be rejected but it was fulfilled with { Object (tx, receipt, ...) }\",\"showDiff\":true,\"actual\":{\"tx\":\"0xeb51cef6708fe4a17c6a9f4eca4de0178795c3ae1738e3d1fc74931fe7ea72a7\",\"receipt\":{\"transactionHash\":\"0xeb51cef6708fe4a17c6a9f4eca4de0178795c3ae1738e3d1fc74931fe7ea72a7\",\"transactionIndex\":0,\"blockHash\":\"0xd0f18a5f18a03001e7b63554834712634578bc4ab9c10dcf3fe3d5b0bc553fe2\",\"blockNumber\":172,\"from\":\"0xf8dee77490590ec7c9856caa79bf680474cac8af\",\"to\":\"0x0e60af7ee2e62e24f39de38ee052907357cfa07e\",\"gasUsed\":50648,\"cumulativeGasUsed\":50648,\"contractAddress\":null,\"logs\":[],\"status\":true,\"logsBloom\":\"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\"v\":\"0x1c\",\"r\":\"0x3de661523731aa289b925600eebe1dd7e2a33ffe201dd1b9102b1d0d6351abf7\",\"s\":\"0x32346a8b7b0345a5660258059b734066cf58c5b8d83058646becc41b7d2a5949\",\"rawLogs\":[]},\"logs\":[]},\"stack\":\"AssertionError: expected promise to be rejected but it was fulfilled with { Object (tx, receipt, ...) }\"}). Build with -s ASSERTIONS=1 for more info.'\r\n    at Runner.uncaught (/home/cc/Repositories/ion/node_modules/truffle/node_modules/mocha/lib/runner.js:726:16)\r\n    at process.uncaught (/home/cc/Repositories/ion/node_modules/truffle/node_modules/mocha/lib/runner.js:839:10)\r\n    at emitOne (events.js:116:13)\r\n    at process.emit (events.js:211:7)\r\n    at process.emit (/home/cc/Repositories/ion/node_modules/truffle/build/webpack:/~/source-map-support/source-map-support.js:465:1)\r\n    at process._fatalException (bootstrap_node.js:375:26)\r\n```\r\n\r\nChanging some of the functions from `async` to not changes where this error happens but it still occurs with the same error message.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/555550556/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/555551790",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-555551790",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 555551790,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTU1MTc5MA==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-19T15:12:12Z",
    "updated_at": "2019-11-19T15:12:12Z",
    "author_association": "MEMBER",
    "body": "@Shirikatsu no way this is the same issue as the original. Mind opening your issue as a new one, to reduce the noise? Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/555551790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/555951151",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-555951151",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 555951151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTk1MTE1MQ==",
    "user": {
      "login": "Shirikatsu",
      "id": 4716816,
      "node_id": "MDQ6VXNlcjQ3MTY4MTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4716816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Shirikatsu",
      "html_url": "https://github.com/Shirikatsu",
      "followers_url": "https://api.github.com/users/Shirikatsu/followers",
      "following_url": "https://api.github.com/users/Shirikatsu/following{/other_user}",
      "gists_url": "https://api.github.com/users/Shirikatsu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Shirikatsu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Shirikatsu/subscriptions",
      "organizations_url": "https://api.github.com/users/Shirikatsu/orgs",
      "repos_url": "https://api.github.com/users/Shirikatsu/repos",
      "events_url": "https://api.github.com/users/Shirikatsu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Shirikatsu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-20T10:54:35Z",
    "updated_at": "2019-11-20T10:54:35Z",
    "author_association": "NONE",
    "body": "Sure! Sorry :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/555951151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/570142632",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-570142632",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 570142632,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDE0MjYzMg==",
    "user": {
      "login": "Nicca42",
      "id": 42095633,
      "node_id": "MDQ6VXNlcjQyMDk1NjMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/42095633?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nicca42",
      "html_url": "https://github.com/Nicca42",
      "followers_url": "https://api.github.com/users/Nicca42/followers",
      "following_url": "https://api.github.com/users/Nicca42/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nicca42/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nicca42/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nicca42/subscriptions",
      "organizations_url": "https://api.github.com/users/Nicca42/orgs",
      "repos_url": "https://api.github.com/users/Nicca42/repos",
      "events_url": "https://api.github.com/users/Nicca42/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nicca42/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-02T08:22:45Z",
    "updated_at": "2020-01-02T08:22:45Z",
    "author_association": "NONE",
    "body": "Has this issue been opened with Ganache? I don't use truffle at all (using Etherlime) and I get the same inconsistent failing tests. (Same issues as mentioned by others above, a big contract ecosystem, complex testing and every couple of times when testing a random test will fail). ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/570142632/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1116760589",
    "html_url": "https://github.com/trufflesuite/truffle/issues/557#issuecomment-1116760589",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/557",
    "id": 1116760589,
    "node_id": "IC_kwDOAkfq-c5CkGoN",
    "user": {
      "login": "ggogel",
      "id": 13143850,
      "node_id": "MDQ6VXNlcjEzMTQzODUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13143850?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ggogel",
      "html_url": "https://github.com/ggogel",
      "followers_url": "https://api.github.com/users/ggogel/followers",
      "following_url": "https://api.github.com/users/ggogel/following{/other_user}",
      "gists_url": "https://api.github.com/users/ggogel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ggogel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ggogel/subscriptions",
      "organizations_url": "https://api.github.com/users/ggogel/orgs",
      "repos_url": "https://api.github.com/users/ggogel/repos",
      "events_url": "https://api.github.com/users/ggogel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ggogel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-03T23:33:58Z",
    "updated_at": "2022-05-03T23:33:58Z",
    "author_association": "NONE",
    "body": "I had the same issue when running `truffle test`. It was clearly some kind of race condition. I've fixed it by adding `await` to all `deployer.deploy` calls in my migration script.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1116760589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
