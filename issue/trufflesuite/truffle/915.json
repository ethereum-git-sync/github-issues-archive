{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/915",
  "id": 317416090,
  "node_id": "MDU6SXNzdWUzMTc0MTYwOTA=",
  "number": 915,
  "title": "`truffle test` fails with 'out of gas' on all solidity tests",
  "user": {
    "login": "nbauernfeind",
    "id": 1030443,
    "node_id": "MDQ6VXNlcjEwMzA0NDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1030443?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbauernfeind",
    "html_url": "https://github.com/nbauernfeind",
    "followers_url": "https://api.github.com/users/nbauernfeind/followers",
    "following_url": "https://api.github.com/users/nbauernfeind/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbauernfeind/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbauernfeind/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbauernfeind/subscriptions",
    "organizations_url": "https://api.github.com/users/nbauernfeind/orgs",
    "repos_url": "https://api.github.com/users/nbauernfeind/repos",
    "events_url": "https://api.github.com/users/nbauernfeind/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbauernfeind/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-04-24T22:21:49Z",
  "updated_at": "2019-06-20T12:42:34Z",
  "closed_at": "2018-04-25T14:42:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nTruffle v4.1.7 fails to run simple solidity test contract. Note that v4.1.6 works fine.\r\n\r\n## Steps to Reproduce\r\n\r\nnpm -g install truffle@4.1.7\r\nTry to run test:\r\n```solidity\r\npragma solidity ^0.4.21;\r\n\r\nimport \"truffle/Assert.sol\";\r\n\r\ncontract Test {\r\n  function testRun() {\r\n  }\r\n}\r\n```\r\n\r\n## Expected Behavior\r\n\r\n```text\r\n  Test\r\n    âœ“ testRun (51ms)\r\n\r\n\r\n  1 passing (1s)\r\n```\r\n\r\n## Actual Results\r\n\r\n```text\r\n  Test\r\n    1) \"before all\" hook: prepare suite\r\n\r\n\r\n  0 passing (989ms)\r\n  1 failing\r\n\r\n  1) Test \"before all\" hook: prepare suite:\r\n     Error: VM Exception while processing transaction: out of gas\r\n      at Object.InvalidResponse (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/errors.js:38:1)\r\n      at /usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/requestmanager.js:86:1\r\n      at /usr/local/lib/node_modules/truffle/build/webpack:/~/truffle-provider/wrapper.js:134:1\r\n      at XMLHttpRequest.request.onreadystatechange (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/httpprovider.js:128:1)\r\n      at XMLHttpRequestEventTarget.dispatchEvent (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:64:1)\r\n      at XMLHttpRequest._setReadyState (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:354:1)\r\n      at XMLHttpRequest._onHttpResponseEnd (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:509:1)\r\n      at IncomingMessage.<anonymous> (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:469:1)\r\n      at endReadableNT (_stream_readable.js:1101:12)\r\n      at process._tickCallback (internal/process/next_tick.js:114:19)\r\n\r\n```\r\n## Environment\r\n\r\n* Operating System: osx\r\n* Ethereum client: n/a\r\n* Truffle version (`truffle version`): 4.1.7\r\n* node version (`node --version`): 9.9.0\r\n* npm version (`npm --version`): 5.8.0\r\n",
  "closed_by": {
    "login": "nbauernfeind",
    "id": 1030443,
    "node_id": "MDQ6VXNlcjEwMzA0NDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1030443?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nbauernfeind",
    "html_url": "https://github.com/nbauernfeind",
    "followers_url": "https://api.github.com/users/nbauernfeind/followers",
    "following_url": "https://api.github.com/users/nbauernfeind/following{/other_user}",
    "gists_url": "https://api.github.com/users/nbauernfeind/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nbauernfeind/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nbauernfeind/subscriptions",
    "organizations_url": "https://api.github.com/users/nbauernfeind/orgs",
    "repos_url": "https://api.github.com/users/nbauernfeind/repos",
    "events_url": "https://api.github.com/users/nbauernfeind/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nbauernfeind/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/915/reactions",
    "total_count": 5,
    "+1": 5,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384121741",
    "html_url": "https://github.com/trufflesuite/truffle/issues/915#issuecomment-384121741",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
    "id": 384121741,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDEyMTc0MQ==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T00:26:03Z",
    "updated_at": "2018-04-25T00:26:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "@nbauernfeind Was not able to reproduce this unfortunately. We run MetaCoin's solidity tests as part of our CI and those are passing as well. In your issue you've left the client info out - could you clarify how you're launching the tests?\r\n\r\nI'm also on OSX, in an empty project, running a fresh install of `4.1.7`. Added your test and ran:\r\n```\r\ntruffle test\r\n```\r\n**Output**\r\n\r\n![screen shot 2018-04-24 at 5 24 20 pm](https://user-images.githubusercontent.com/7332026/39220238-760ebf3c-47e4-11e8-8719-a626a9a68db6.png)\r\n\r\n\r\nCan you identify a difference here? ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384121741/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384280027",
    "html_url": "https://github.com/trufflesuite/truffle/issues/915#issuecomment-384280027",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
    "id": 384280027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI4MDAyNw==",
    "user": {
      "login": "nbauernfeind",
      "id": 1030443,
      "node_id": "MDQ6VXNlcjEwMzA0NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1030443?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nbauernfeind",
      "html_url": "https://github.com/nbauernfeind",
      "followers_url": "https://api.github.com/users/nbauernfeind/followers",
      "following_url": "https://api.github.com/users/nbauernfeind/following{/other_user}",
      "gists_url": "https://api.github.com/users/nbauernfeind/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nbauernfeind/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nbauernfeind/subscriptions",
      "organizations_url": "https://api.github.com/users/nbauernfeind/orgs",
      "repos_url": "https://api.github.com/users/nbauernfeind/repos",
      "events_url": "https://api.github.com/users/nbauernfeind/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nbauernfeind/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T13:08:21Z",
    "updated_at": "2018-04-25T13:08:21Z",
    "author_association": "NONE",
    "body": "@cgewecke Thanks for your quick reply. You're right, on a fresh init it works fine. The problem seems to introduce itself when I override the `gas` property in `truffle.js`. I'm running through Ganache and the limit I have here is definitely under the configured gas limit in Ganache.\r\n\r\nThis is my truffle.js:\r\n```js\r\nmodule.exports = {\r\n  networks: {\r\n    development: {\r\n      host: \"127.0.0.1\",\r\n      port: 7545,\r\n      network_id: \"*\",\r\n      gasPrice: 1,\r\n      gas: 6000000,\r\n    }\r\n  }\r\n};\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384280027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384298414",
    "html_url": "https://github.com/trufflesuite/truffle/issues/915#issuecomment-384298414",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
    "id": 384298414,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI5ODQxNA==",
    "user": {
      "login": "nbauernfeind",
      "id": 1030443,
      "node_id": "MDQ6VXNlcjEwMzA0NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1030443?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nbauernfeind",
      "html_url": "https://github.com/nbauernfeind",
      "followers_url": "https://api.github.com/users/nbauernfeind/followers",
      "following_url": "https://api.github.com/users/nbauernfeind/following{/other_user}",
      "gists_url": "https://api.github.com/users/nbauernfeind/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nbauernfeind/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nbauernfeind/subscriptions",
      "organizations_url": "https://api.github.com/users/nbauernfeind/orgs",
      "repos_url": "https://api.github.com/users/nbauernfeind/repos",
      "events_url": "https://api.github.com/users/nbauernfeind/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nbauernfeind/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T14:03:26Z",
    "updated_at": "2018-04-25T14:03:26Z",
    "author_association": "NONE",
    "body": "Ahh.. actually I see what's going on. Turns out that simple test contract is getting more and more expensive. Does `truffle test` use a different default gas limit than `truffle migrate`? I had tuned it up to handle the migration and must have been lucky. It seems on v4.1.6 it cost `5913212` gas and now on v4.1.7 it costs `6109322` to deploy the test contract.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384298414/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384307103",
    "html_url": "https://github.com/trufflesuite/truffle/issues/915#issuecomment-384307103",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
    "id": 384307103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDMwNzEwMw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T14:28:33Z",
    "updated_at": "2018-04-25T14:28:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "@nbauernfeind  Ah yes that makes sense, good to know. It was modified to clear warnings produced by solc `0.4.22`. Could be that the new solc compiles things a little more expensively as well. . .",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/384307103/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/503902849",
    "html_url": "https://github.com/trufflesuite/truffle/issues/915#issuecomment-503902849",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
    "id": 503902849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMzkwMjg0OQ==",
    "user": {
      "login": "storebot",
      "id": 32689322,
      "node_id": "MDQ6VXNlcjMyNjg5MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/32689322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/storebot",
      "html_url": "https://github.com/storebot",
      "followers_url": "https://api.github.com/users/storebot/followers",
      "following_url": "https://api.github.com/users/storebot/following{/other_user}",
      "gists_url": "https://api.github.com/users/storebot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/storebot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/storebot/subscriptions",
      "organizations_url": "https://api.github.com/users/storebot/orgs",
      "repos_url": "https://api.github.com/users/storebot/repos",
      "events_url": "https://api.github.com/users/storebot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/storebot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-20T06:59:52Z",
    "updated_at": "2019-06-20T06:59:52Z",
    "author_association": "NONE",
    "body": "> Ahh.. actually I see what's going on. Turns out that simple test contract is getting more and more expensive. Does `truffle test` use a different default gas limit than `truffle migrate`? I had tuned it up to handle the migration and must have been lucky. It seems on v4.1.6 it cost `5913212` gas and now on v4.1.7 it costs `6109322` to deploy the test contract.\r\n\r\n@nbauernfeind  I tested on Truffle v4.1.15 (core: 4.1.15) the exact values are between 6109258 - 6721975, anything less or more of this range does not work. Would you be able to explain why?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/503902849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/504010616",
    "html_url": "https://github.com/trufflesuite/truffle/issues/915#issuecomment-504010616",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/915",
    "id": 504010616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNDAxMDYxNg==",
    "user": {
      "login": "nbauernfeind",
      "id": 1030443,
      "node_id": "MDQ6VXNlcjEwMzA0NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1030443?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nbauernfeind",
      "html_url": "https://github.com/nbauernfeind",
      "followers_url": "https://api.github.com/users/nbauernfeind/followers",
      "following_url": "https://api.github.com/users/nbauernfeind/following{/other_user}",
      "gists_url": "https://api.github.com/users/nbauernfeind/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nbauernfeind/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nbauernfeind/subscriptions",
      "organizations_url": "https://api.github.com/users/nbauernfeind/orgs",
      "repos_url": "https://api.github.com/users/nbauernfeind/repos",
      "events_url": "https://api.github.com/users/nbauernfeind/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nbauernfeind/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-20T12:42:34Z",
    "updated_at": "2019-06-20T12:42:34Z",
    "author_association": "NONE",
    "body": "I no longer work at that company and don't have an environment setup to further investigate. If I recall correctly, I used a value higher than 6.7M -- but at first I was trying to keep it high enough but not super close to the block limit. Things greatly improved when I turned on compiler optimizations... Sorry I'm not super interested anymore and can't quite help you further.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/504010616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
