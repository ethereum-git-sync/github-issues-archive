{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1509",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1509/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1509/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1509/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1509",
  "id": 388993115,
  "node_id": "MDU6SXNzdWUzODg5OTMxMTU=",
  "number": 1509,
  "title": "Vyper bytecode invalid on Windows",
  "user": {
    "login": "sgryphon",
    "id": 339293,
    "node_id": "MDQ6VXNlcjMzOTI5Mw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/339293?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sgryphon",
    "html_url": "https://github.com/sgryphon",
    "followers_url": "https://api.github.com/users/sgryphon/followers",
    "following_url": "https://api.github.com/users/sgryphon/following{/other_user}",
    "gists_url": "https://api.github.com/users/sgryphon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sgryphon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sgryphon/subscriptions",
    "organizations_url": "https://api.github.com/users/sgryphon/orgs",
    "repos_url": "https://api.github.com/users/sgryphon/repos",
    "events_url": "https://api.github.com/users/sgryphon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sgryphon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2018-12-09T06:43:24Z",
  "updated_at": "2018-12-09T20:45:00Z",
  "closed_at": "2018-12-09T20:45:00Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "- [ ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue. => No\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhat the issue is, in broad strokes.\r\n\r\n## Steps to Reproduce\r\n\r\nOn Windows: \r\n\r\n* install ganache\r\n* install truffle\r\n* install python\r\n* git clone vyper v0.1.0-beta.5 \r\n* Work around: vyper Make doesn't work on Windows, so need to manually build:\r\n`python install.py setup`\r\n* Work around: vyper doesn't install Windows script, only shell script. Create `vyper.cmd` in the folder %AppData%\\Local\\Programs\\Python\\Python37\\Scripts\r\n\r\nFile should contain:\r\n@python C:\\Dev\\vyper\\build\\scripts-3.7\\vyper %*\r\n\r\nAdjust pointing to where your cloned repo is.\r\n\r\n* download the vyper-example code\r\n* truffle compile\r\n* truffle migrate\r\n\r\n## Expected Behavior\r\n\r\nCompile and then migrate the vyper contract.\r\n\r\n## Actual Results\r\n\r\nCompile appears to work, but actually outputs the wrong bytecode. Note: If you don't have the work around, then it won't be able to find `vyper` to execute.\r\n\r\nError message on migrate\r\n\r\nError:  *** Deployment Failed ***\r\n\"VyperStorage\" -- The data field must be HEX encoded data..\r\n\r\nTruffle captures the first line of output from the vyper compiler, which is the bytecode, but it (presumably) looks for the '\\n' to truncate, however the Windows output ends with '\\r\\n', so the bytecode inserted into VyperStorage.json contains a trailing '\\r' and can not be migrated.\r\n\r\n## Work Around ##\r\n\r\nAfter compiling, before migrating, edit the VyperStorage.json file and remove the trailing '\\r' from the bytecode and deployedBytecode fields. \r\n\r\nAfter that, `truffle migrate` works as expected.\r\n\r\n## Fix\r\n\r\nWhen parsing the first line of compiler output from Vyper, truncate the '\\r' (if present) as well as the '\\n'. Test the changes works on Windows, linux, and MacOS.\r\n\r\n## Environment\r\n\r\n* Operating System: windows 10\r\n* Ethereum client: Metamask\r\n* Truffle version (`truffle version`): Truffle v5.0.0-beta.2 (core: 5.0.0-beta.2)\r\n* Solidity v0.5.0 (solc-js)\r\n* node version (`node --version`): Node v10.13.0\r\n* npm version (`npm --version`): 6.4.1\r\n* Python version: 3.7\r\n* vyper Version: v0.1.0-beta.5",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1509/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1509/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
