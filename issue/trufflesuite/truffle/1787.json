{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1787",
  "id": 416935991,
  "node_id": "MDU6SXNzdWU0MTY5MzU5OTE=",
  "number": 1787,
  "title": "Truffle debug crashes when inspecting memory array",
  "user": {
    "login": "pertsev",
    "id": 11399003,
    "node_id": "MDQ6VXNlcjExMzk5MDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11399003?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pertsev",
    "html_url": "https://github.com/pertsev",
    "followers_url": "https://api.github.com/users/pertsev/followers",
    "following_url": "https://api.github.com/users/pertsev/following{/other_user}",
    "gists_url": "https://api.github.com/users/pertsev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pertsev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pertsev/subscriptions",
    "organizations_url": "https://api.github.com/users/pertsev/orgs",
    "repos_url": "https://api.github.com/users/pertsev/repos",
    "events_url": "https://api.github.com/users/pertsev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pertsev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 971535002,
      "node_id": "MDU6TGFiZWw5NzE1MzUwMDI=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Debugger",
      "name": "Debugger",
      "color": "7911ad",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-03-04T18:34:15Z",
  "updated_at": "2019-03-05T19:37:46Z",
  "closed_at": "2019-03-05T19:37:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nTruffle debug crashes when inspecting memory array\r\n\r\n## Steps to Reproduce\r\nGames.sol\r\n```js\r\npragma solidity 0.5.4;\r\n\r\ncontract Games {\r\n    enum GameState { \r\n        Invalid,\r\n        odd,\r\n        even\r\n    }\r\n\r\n    struct Game {\r\n        GameState state;\r\n        bytes32 gameId;\r\n    }\r\n\r\n    mapping(bytes32 => Game) public games;\r\n\r\n    function recordMany(bytes32[] memory _games) public {\r\n        for (uint i=0; i<_games.length; i++) {\r\n            Game storage game = games[_games[i]];\r\n            game.state = GameState.odd;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\ngames.test.js\r\n```js\r\nconst Games = artifacts.require(\"Games\")\r\n\r\nconst {randomHex} = web3.utils\r\n\r\ncontract('Games', async (accounts) => {\r\n  let gameIds = []\r\n  let gamesInstance\r\n\r\n  before(async () => {\r\n    for(i=0; i < 2; i++) {\r\n      gameIds.push(randomHex(32))\r\n    }\r\n    gamesInstance = await Games.deployed()\r\n  })\r\n\r\n  describe.only('#recordMany', async () => {\r\n    it('get all games states', async () => {\r\n      await gamesInstance.recordMany(gameIds)\r\n    })\r\n  })\r\n})\r\n\r\n```\r\n\r\n1. run tests\r\n2. start debugging of test's tx\r\n3. show local variables (`v`) at line 19\r\n\r\n![truffle_debug](https://user-images.githubusercontent.com/11399003/53754390-e0f25200-3ec4-11e9-9486-3176eab5cb26.gif)\r\n\r\n## Expected Behavior\r\n\r\n`v` should show local variables\r\n\r\n## Actual Results\r\n\r\nan exception thrown\r\n\r\n```js\r\nTypeError: Cannot read property '10' of undefined\r\n    at Object.storageSize (/usr/local/lib/node_modules/truffle/build/webpack:/packages/truffle-decoder/dist/allocate/storage.js:162:1)\r\n    at storageSizeAndAllocate (/usr/local/lib/node_modules/truffle/build/webpack:/packages/truffle-decoder/dist/allocate/storage.js:245:1)\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client:\r\nTruffle v5.0.6 (core: 5.0.6)\r\nSolidity - 0.5.4 (solc-js)\r\nNode v11.8.0\r\n\r\n-----\r\nBug submitted by [peppersec.com](https://peppersec.com)",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469373219",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1787#issuecomment-469373219",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787",
    "id": 469373219,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTM3MzIxOQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-04T18:48:14Z",
    "updated_at": "2019-03-04T18:48:14Z",
    "author_association": "MEMBER",
    "body": "Thanks for raising this issue! We'll look into it and someone will get back to you.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469373219/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469421342",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1787#issuecomment-469421342",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787",
    "id": 469421342,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTQyMTM0Mg==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-04T21:05:26Z",
    "updated_at": "2019-03-04T21:17:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, I've created PR #1788 to fix this bug.  For what it's worth, the problem is not related to memory arrays; rather it was related to local variables of struct `storage` type, hence why it occurred on line 19, where the local `Game storage` `game` was declared.\r\n\r\n(Edit: For what it's worth, a local storage variable that was a statically-sized array of structs would also have triggered the bug.)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469421342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469522607",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1787#issuecomment-469522607",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787",
    "id": 469522607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTUyMjYwNw==",
    "user": {
      "login": "rstormsf",
      "id": 9360827,
      "node_id": "MDQ6VXNlcjkzNjA4Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9360827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rstormsf",
      "html_url": "https://github.com/rstormsf",
      "followers_url": "https://api.github.com/users/rstormsf/followers",
      "following_url": "https://api.github.com/users/rstormsf/following{/other_user}",
      "gists_url": "https://api.github.com/users/rstormsf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rstormsf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rstormsf/subscriptions",
      "organizations_url": "https://api.github.com/users/rstormsf/orgs",
      "repos_url": "https://api.github.com/users/rstormsf/repos",
      "events_url": "https://api.github.com/users/rstormsf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rstormsf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-05T03:29:56Z",
    "updated_at": "2019-03-05T03:29:56Z",
    "author_association": "NONE",
    "body": "It was discovered during one of the security audits we have been performing with truffle suite. Thanks again to Truffle team for building amazing tools for auditors. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469522607/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469828305",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1787#issuecomment-469828305",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1787",
    "id": 469828305,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTgyODMwNQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-05T19:37:46Z",
    "updated_at": "2019-03-05T19:37:46Z",
    "author_association": "MEMBER",
    "body": "Just released Truffle v5.0.7 containing the fix for this. Could you try it out and let us know if it's not fixed? Thanks again!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/469828305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
