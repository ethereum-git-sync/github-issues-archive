{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5235",
  "id": 1285454622,
  "node_id": "I_kwDOAkfq-c5Mnnse",
  "number": 5235,
  "title": "truffle workflow-compile lost dashboard-message-bus-client dependency",
  "user": {
    "login": "moshmage",
    "id": 1077079,
    "node_id": "MDQ6VXNlcjEwNzcwNzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1077079?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/moshmage",
    "html_url": "https://github.com/moshmage",
    "followers_url": "https://api.github.com/users/moshmage/followers",
    "following_url": "https://api.github.com/users/moshmage/following{/other_user}",
    "gists_url": "https://api.github.com/users/moshmage/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/moshmage/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/moshmage/subscriptions",
    "organizations_url": "https://api.github.com/users/moshmage/orgs",
    "repos_url": "https://api.github.com/users/moshmage/repos",
    "events_url": "https://api.github.com/users/moshmage/events{/privacy}",
    "received_events_url": "https://api.github.com/users/moshmage/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-06-27T08:42:13Z",
  "updated_at": "2022-07-01T22:02:30Z",
  "closed_at": "2022-07-01T22:02:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nThe package lost dependencies but still relies on them\r\n\r\n## Steps to Reproduce\r\n\r\nVisit this public github action log, check build stage.\r\n[Please provide the shortest amount of steps to reproduce your issue.](https://github.com/taikai/dappkit/runs/7069036809?check_suite_focus=true)\r\n\r\n## Expected Behavior\r\n\r\nThe compile action to work\r\n\r\n## Actual Results\r\n\r\ntruffle/workflow-compile complains about missing dependency,\r\n```\r\nError: Cannot find module '@truffle/dashboard-message-bus-client'\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client:\r\n* Truffle version: \"@truffle/workflow-compile\": \"4.0.20\",\r\n* node version:  v14.17.0\r\n* npm version: 6.14.13\r\n",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1167098750",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1167098750",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1167098750,
    "node_id": "IC_kwDOAkfq-c5FkIN-",
    "user": {
      "login": "moshmage",
      "id": 1077079,
      "node_id": "MDQ6VXNlcjEwNzcwNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1077079?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moshmage",
      "html_url": "https://github.com/moshmage",
      "followers_url": "https://api.github.com/users/moshmage/followers",
      "following_url": "https://api.github.com/users/moshmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/moshmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moshmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moshmage/subscriptions",
      "organizations_url": "https://api.github.com/users/moshmage/orgs",
      "repos_url": "https://api.github.com/users/moshmage/repos",
      "events_url": "https://api.github.com/users/moshmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moshmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T09:16:52Z",
    "updated_at": "2022-06-27T10:57:37Z",
    "author_association": "NONE",
    "body": "after providing `dashboard-message-bus-client` manually via package.json dependencies, this shows up\r\n\r\n```\r\ninternal/modules/cjs/loader.js:885\r\n  const err = new Error(message);\r\n              ^\r\nError: Cannot find module './messages'\r\nRequire stack:\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/dashboard-message-bus-common/dist/index.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/dashboard-message-bus-client/dist/client.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/dashboard-message-bus-client/dist/index.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/events/defaultSubscribers/dashboard.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/events/defaultSubscribers/index.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/events/EventManager.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/events/index.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/config/dist/index.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/workflow-compile/utils.js\r\n- /home/runner/work/dappkit/dappkit/node_modules/@truffle/workflow-compile/index.js\r\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:885:15)\r\n```\r\n\r\nI can't figure it out, indeed the source code of `-common` has no `./messages` file on its dist folder, nor is there a `index.js.map` on the folder, so I understand why the error occurs I just can't understand how that happens.\r\n\r\n---\r\n\r\n*edit* it appears that `truffle/workflow-compile` has a hard-dependency on `dashboard-message-bus-client` for a defaultSubscriber to work with dashboard -- but I have no requirement for dashboard, nor does my configuration state one. how can I overcome this ?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1167098750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1167238978",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1167238978",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1167238978,
    "node_id": "IC_kwDOAkfq-c5FkqdC",
    "user": {
      "login": "moshmage",
      "id": 1077079,
      "node_id": "MDQ6VXNlcjEwNzcwNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1077079?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moshmage",
      "html_url": "https://github.com/moshmage",
      "followers_url": "https://api.github.com/users/moshmage/followers",
      "following_url": "https://api.github.com/users/moshmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/moshmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moshmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moshmage/subscriptions",
      "organizations_url": "https://api.github.com/users/moshmage/orgs",
      "repos_url": "https://api.github.com/users/moshmage/repos",
      "events_url": "https://api.github.com/users/moshmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moshmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T11:31:41Z",
    "updated_at": "2022-06-27T11:31:41Z",
    "author_association": "NONE",
    "body": "For time travelers, I've locked `@truffle/events` to `0.1.6` since the dashboard dependency was added on `0.1.7` via `npm overrides`,\r\n\r\n```json\r\n  \"overrides\": {\r\n    \"@truffle/events\": \"0.1.6\"\r\n  }\r\n```\r\n\r\nThis happened because `worklow-compile@4.0.20` depends on `config: ^x.x.x` and this will install _the latest_ version of the config module -- even tho breaking changes were introduced on the `events` thats required by config, again on `^x.x.x`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1167238978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1167521765",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1167521765",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1167521765,
    "node_id": "IC_kwDOAkfq-c5Flvfl",
    "user": {
      "login": "cds-amal",
      "id": 2529600,
      "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds-amal",
      "html_url": "https://github.com/cds-amal",
      "followers_url": "https://api.github.com/users/cds-amal/followers",
      "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
      "organizations_url": "https://api.github.com/users/cds-amal/orgs",
      "repos_url": "https://api.github.com/users/cds-amal/repos",
      "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds-amal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T15:48:52Z",
    "updated_at": "2022-06-27T15:48:52Z",
    "author_association": "MEMBER",
    "body": "Hi @moshmage, thanks for raising this dependency issue. Hopefully #5230 resolves this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1167521765/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1170503178",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1170503178",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1170503178,
    "node_id": "IC_kwDOAkfq-c5FxHYK",
    "user": {
      "login": "cliffoo",
      "id": 41348973,
      "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cliffoo",
      "html_url": "https://github.com/cliffoo",
      "followers_url": "https://api.github.com/users/cliffoo/followers",
      "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
      "organizations_url": "https://api.github.com/users/cliffoo/orgs",
      "repos_url": "https://api.github.com/users/cliffoo/repos",
      "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cliffoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-29T21:18:59Z",
    "updated_at": "2022-06-29T21:18:59Z",
    "author_association": "MEMBER",
    "body": "Hey @moshmage, [the fix](https://github.com/trufflesuite/truffle/pull/5246) should make it into this week's release. Thanks for providing a workaround by pinning the version!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1170503178/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1171351394",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1171351394",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1171351394,
    "node_id": "IC_kwDOAkfq-c5F0Wdi",
    "user": {
      "login": "moshmage",
      "id": 1077079,
      "node_id": "MDQ6VXNlcjEwNzcwNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1077079?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moshmage",
      "html_url": "https://github.com/moshmage",
      "followers_url": "https://api.github.com/users/moshmage/followers",
      "following_url": "https://api.github.com/users/moshmage/following{/other_user}",
      "gists_url": "https://api.github.com/users/moshmage/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moshmage/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moshmage/subscriptions",
      "organizations_url": "https://api.github.com/users/moshmage/orgs",
      "repos_url": "https://api.github.com/users/moshmage/repos",
      "events_url": "https://api.github.com/users/moshmage/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moshmage/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-30T15:18:54Z",
    "updated_at": "2022-06-30T15:24:53Z",
    "author_association": "NONE",
    "body": "> Hey @moshmage, [the fix](https://github.com/trufflesuite/truffle/pull/5246) should make it into this week's release. Thanks for providing a workaround by pinning the version!\r\n\r\nHey @cliffoo while that fix _might_ solve some instances on the truffle plugin itself, if changes aren't made to the dependencies on what truffle depends on we will keep having these problems as every dependency on every package on truffle repository uses a \"at least\" approach, meaning that whenever you bump to `0.0.2` and introduce new stuff, even if I require `0.0.1` _the dependencies_ will still require `0.0.2` because the dependencies on `0.0.1` are written as `^0.0.1` which will target `0.0.2`\r\n\r\ncase in point [this dependency will not let me _choose_ a version, it will always install the latest version of that dependency](https://github.com/trufflesuite/truffle/blob/develop/packages/workflow-compile/package.json#L26)\r\n\r\nAnd since clearly we are not respecting semver (or the changes to events would have raised a version instead of a _patch_) we need to lock each version to its deployed counterpart _or this will keep happening_\r\n\r\n---\r\n\r\nedit changed the \"case in point\" link because I had a bad paste :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1171351394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1171546055",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1171546055",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1171546055,
    "node_id": "IC_kwDOAkfq-c5F1F_H",
    "user": {
      "login": "cliffoo",
      "id": 41348973,
      "node_id": "MDQ6VXNlcjQxMzQ4OTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/41348973?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cliffoo",
      "html_url": "https://github.com/cliffoo",
      "followers_url": "https://api.github.com/users/cliffoo/followers",
      "following_url": "https://api.github.com/users/cliffoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/cliffoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cliffoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cliffoo/subscriptions",
      "organizations_url": "https://api.github.com/users/cliffoo/orgs",
      "repos_url": "https://api.github.com/users/cliffoo/repos",
      "events_url": "https://api.github.com/users/cliffoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cliffoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-30T18:32:20Z",
    "updated_at": "2022-06-30T18:32:20Z",
    "author_association": "MEMBER",
    "body": "@moshmage It's not that semver isn't respected, but a lapse on our end that caused this breaking behavior to slide into the release. We probably don't want to pin versions as there are other implications.\r\n\r\nWe are looking to integrate CI checks (outlined in [this PR](https://github.com/trufflesuite/truffle/pull/5246)) that can make us aware of such issues (by simulating install from registry) and gives us a chance to fix them before merging to develop.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1171546055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1172725787",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5235#issuecomment-1172725787",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5235",
    "id": 1172725787,
    "node_id": "IC_kwDOAkfq-c5F5mAb",
    "user": {
      "login": "lsqproduction",
      "id": 12772017,
      "node_id": "MDQ6VXNlcjEyNzcyMDE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/12772017?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsqproduction",
      "html_url": "https://github.com/lsqproduction",
      "followers_url": "https://api.github.com/users/lsqproduction/followers",
      "following_url": "https://api.github.com/users/lsqproduction/following{/other_user}",
      "gists_url": "https://api.github.com/users/lsqproduction/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lsqproduction/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lsqproduction/subscriptions",
      "organizations_url": "https://api.github.com/users/lsqproduction/orgs",
      "repos_url": "https://api.github.com/users/lsqproduction/repos",
      "events_url": "https://api.github.com/users/lsqproduction/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lsqproduction/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-01T21:30:01Z",
    "updated_at": "2022-07-01T21:30:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yay. Fixed in [Truffle 5.5.20](https://github.com/trufflesuite/truffle/releases/tag/v5.5.20)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1172725787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
