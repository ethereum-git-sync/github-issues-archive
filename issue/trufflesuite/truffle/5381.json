{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5381",
  "id": 1323838947,
  "node_id": "I_kwDOAkfq-c5O6C3j",
  "number": 5381,
  "title": "Bug: `@truffle/require` not able to resolve locally-installed modules (e.g. `ts-node`, `typescript`) when running under the globally-installed truffle bundle",
  "user": {
    "login": "benjamincburns",
    "id": 803016,
    "node_id": "MDQ6VXNlcjgwMzAxNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjamincburns",
    "html_url": "https://github.com/benjamincburns",
    "followers_url": "https://api.github.com/users/benjamincburns/followers",
    "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
    "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
    "repos_url": "https://api.github.com/users/benjamincburns/repos",
    "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 1675041356,
      "node_id": "MDU6TGFiZWwxNjc1MDQxMzU2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority2%20%E2%9A%A0%EF%B8%8F",
      "name": "priority2 ⚠️",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "benjamincburns",
    "id": 803016,
    "node_id": "MDQ6VXNlcjgwMzAxNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjamincburns",
    "html_url": "https://github.com/benjamincburns",
    "followers_url": "https://api.github.com/users/benjamincburns/followers",
    "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
    "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
    "repos_url": "https://api.github.com/users/benjamincburns/repos",
    "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-08-01T05:20:08Z",
  "updated_at": "2022-08-01T06:08:43Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nWhen testing TypeScript migrations under the latest Truffle release, we observe `@truffle/require` fails to resolve `ts-node`, `typescript`, or other locally-installed modules when attempting to run TypeScript modules.\r\n\r\n## Steps to Reproduce\r\n\r\n**Important Note:** This issue does not reproduce when running truffle from the local dev environment (either via `cli.js` or the webpack bundle). If you are using the truffle dotfiles scripts for truffle devs, be sure to run `use-truffle-stable` before doing any of this (runs the global NPM install when executing the `truffle` command).\r\n\r\n1. `npm install -g truffle@5.5.24`\r\n2. `truffle unbox pet-shop pet-shop`\r\n3. `cd pet-shop`\r\n4. `npm install`\r\n5. `npm install -D typescript`\r\n6. `npm install -D ts-node`\r\n7. Modify `truffle-config.js` to remove the `develop` network and switch the port of the `development` network to `8545`.\r\n8. `mv migrations/1_initial_migration.js migrations/1_initial_migration.ts`\r\n9. Replace the contents of `migrations/1_initial_migration.ts` with the file below\r\n10. In a separate terminal run `ganache`\r\n11. run `truffle migrate --reset`\r\n\r\nContents of `migrations/1_initial_migration.ts`:\r\n\r\n```typescript\r\nconst Migrations = artifacts.require(\"./Migrations\");\r\n\r\nexport default function(deployer: any) {\r\n  deployer.deploy(Migrations);\r\n};\r\n```\r\n\r\n## Expected Behavior\r\n\r\nThe migration should succeed without error.\r\n\r\n## Actual Results\r\nThe migration fails after compilation with an error similar to the following:\r\n\r\n```\r\nTsNodeDependencyError: Attempted to execute module at path /home/username/projects/petshop/migrations/1_initial_migration.ts, but the 'ts-node' module, or one of its required peers has not been installed.\r\n    at _getOrCreateCompilationService (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/require/dist/typescript.js:61:1)\r\n    at Object.compile (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/require/dist/typescript.js:41:1)\r\n    at Object.file (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/require/dist/index.js:88:1)\r\n    at Migration._load (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:42:1)\r\n    at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\n    at Migration.run (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:202:1)\r\n    at Object.runMigrations (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:142:1)\r\n    at Object.runFrom (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:107:1)\r\n    at Object.runAll (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:111:1)\r\n    at Object.run (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:84:1)\r\n    at module.exports (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate/runMigrations.js:10:1)\r\n    at Object.module.exports [as run] (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate/run.js:41:1)\r\n    at runCommand (/home/username/.nvm/versions/node/v12.22.12/lib/node_modules/truffle/build/webpack:/packages/core/lib/command-utils.js:184:1)\r\n```\r\n\r\n## Environment\r\n\r\n**Important Note:** This issue does not reproduce when running truffle from the local dev environment (either via `cli.js` or the webpack bundle)\r\n\r\n* Truffle version (`truffle version`): v5.5.24\r\n* node version (`node --version`): >= v12",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1200725286",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5381#issuecomment-1200725286",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381",
    "id": 1200725286,
    "node_id": "IC_kwDOAkfq-c5HkZ0m",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T05:27:53Z",
    "updated_at": "2022-08-01T05:27:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note that when I attempt to work around the issue by installing `ts-node` and `typescript` globally, it will then fail on a missing `@truffle/resolver` package. It _should_ be resolving this from the bundle, but that doesn't seem to be happening. That said, if I go ahead and install that package (globally - yuck), it does work.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1200725286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1200752127",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5381#issuecomment-1200752127",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5381",
    "id": 1200752127,
    "node_id": "IC_kwDOAkfq-c5HkgX_",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T06:08:27Z",
    "updated_at": "2022-08-01T06:08:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note: the simplest workaround that I've found so far is to install truffle locally and run it from `node_modules/.bin/truffle` or via the `npx` or `yarn exec` commands (I generally recommend projects do this anyway, in support of repeatable builds).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1200752127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
