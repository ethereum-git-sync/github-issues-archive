{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5958",
  "id": 1615662722,
  "node_id": "I_kwDOAkfq-c5gTQ6C",
  "number": 5958,
  "title": "Allow the Dashboard host and port to be configurable when using the Dashboard Hardhat Plugin",
  "user": {
    "login": "kevinbluer",
    "id": 210755,
    "node_id": "MDQ6VXNlcjIxMDc1NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/210755?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kevinbluer",
    "html_url": "https://github.com/kevinbluer",
    "followers_url": "https://api.github.com/users/kevinbluer/followers",
    "following_url": "https://api.github.com/users/kevinbluer/following{/other_user}",
    "gists_url": "https://api.github.com/users/kevinbluer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kevinbluer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kevinbluer/subscriptions",
    "organizations_url": "https://api.github.com/users/kevinbluer/orgs",
    "repos_url": "https://api.github.com/users/kevinbluer/repos",
    "events_url": "https://api.github.com/users/kevinbluer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kevinbluer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 1086852667,
      "node_id": "MDU6TGFiZWwxMDg2ODUyNjY3",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20requirements",
      "name": "needs requirements",
      "color": "d4c5f9",
      "default": false,
      "description": "feature request is unclear"
    },
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-03-08T17:42:15Z",
  "updated_at": "2023-04-10T23:24:04Z",
  "closed_at": "2023-04-10T23:24:03Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nWhen using the Truffle Dashboard Hardhat Plugin, the target [host and port are currently hardcoded](https://github.com/trufflesuite/truffle/blob/develop/packages/dashboard-hardhat-plugin/src/index.ts#L23-L26) to the defaults (`localhost` and `24012` respectively). As highlighted in [this conversation](https://github.com/trufflesuite/truffle/pull/5927#discussion_r1122179058) this should be made user configurable by allowing users to specifying them in the Hardhat config. \r\n",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1463163642",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5958#issuecomment-1463163642",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958",
    "id": 1463163642,
    "node_id": "IC_kwDOAkfq-c5XNhr6",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-10T02:46:55Z",
    "updated_at": "2023-03-10T03:04:41Z",
    "author_association": "MEMBER",
    "body": "You know what I just realized... maybe there's a way for this plugin to remove the need for the user to define the dashboard network themselves. Can HH plugins define networks... is that kosher?\r\n\r\nOoh yeah OK I think we should probably read up on how [hardhat-foundry](https://github.com/NomicFoundation/hardhat/blob/main/packages/hardhat-foundry) works ~~and just emulate that~~. Nevermind, it doesn't specifically add networks from Foundry to HH. But it does make use of `extendConfig`, which I think is what we want.\r\n\r\nSo that being said, I think we should update the plugin to add a `\"truffle-dashboard\"` network automatically and manage it entirely. That name is a little long, so users might want to change it to something other than the default, so we should still allow configuration. I'm thinking this:\r\n\r\n```typescript\r\nimport { HardhatUserConfig } from \"hardhat/config\";\r\nimport \"@nomicfoundation/hardhat-toolbox\";\r\nimport \"@truffle/dashboard-hardhat-plugin\";\r\n\r\nconst config: HardhatUserConfig = {\r\n  // ... rest of hh config ...\r\n\r\n  truffle: {\r\n    dashboardNetworkName: \"truffle-dashboard\"\r\n  }\r\n};\r\n\r\nexport default config;\r\n```\r\n\r\nI was originally thinking we needed a whole section for Truffle Dashboard, but that would mean we'd have to decide between `truffle: { dashboard: { ... } }` and `\"truffle-dashboard\": { ... }` (neither of which is ideal). And it's clunky.\r\n\r\nBut! We don't need to add all that configuration if we just assume that the user is configuring Truffle Dashboard via `truffle-config.js` in their HH project directory. _We already have a way to configure Truffle Dashboard, and that's `truffle-config.js`!_ We can just have this plugin just do a `TruffleConfig.detect()` and use the Dashboard configuration automatically from that!\r\n\r\nThis eliminates support for the case where users want to run a customized `truffle dashboard` from a different directory, but I'm not sure that's necessary? This path forward just seems too good to pass up with the de-duplication it offers.\r\n\r\nThe only thing left for the user to configure in `hardhat.config.ts` is the name of the Dashboard network we add automatically. Neat huh?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1463163642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1474552333",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5958#issuecomment-1474552333",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958",
    "id": 1474552333,
    "node_id": "IC_kwDOAkfq-c5X4-IN",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-18T00:56:22Z",
    "updated_at": "2023-03-20T17:03:18Z",
    "author_association": "MEMBER",
    "body": "Did some more digging on the above and chatted with @alcuadrado, who confirms the limitation I describe here.\r\n\r\nSo I really want this sort of thing:\r\n\r\n<details>\r\n<summary>Example <code>hardhat.config.ts</code></summary>\r\n\r\n```typescript\r\nimport { HardhatUserConfig } from \"hardhat/config\";\r\nimport \"@nomicfoundation/hardhat-toolbox\";\r\nimport \"@truffle/dashboard-hardhat-plugin\";\r\n\r\nconst config: HardhatUserConfig = {\r\n  networks: {\r\n    \"truffle-dashboard\": {\r\n      timeout: 60 // override **only** the default timeout in seconds\r\n    },\r\n\r\n    // ... rest of HardhatNetworksUserConfig\r\n  },\r\n\r\n  truffle: {\r\n    dashboardNetworkName: \"truffle-dashboard\"\r\n  },\r\n\r\n  // ... rest of HardhatUserConfig ...\r\n};\r\n\r\nexport default config;\r\n```\r\n\r\n</details>\r\n\r\ni.e., the plugin should minimize the configuration options it adds in that `truffle` namespace. Instead, we should allow people to override the Dashboard network the same way they would override any HTTP network in their Hardhat config. This plugin should then fill in the gaps between Hardhat's defaults and the user-specified network params.\r\n\r\nIt's worth noting here that the way Hardhat does config is by separating user config from complete config with defaults. It defines types for the `HardhatUserConfig` (e.g. `HttpNetworkUserConfig`), where most fields are optional, and it has separate types for the `HardhatConfig`, where everything is filled in. Key points here:\r\n\r\n- Plugins have the chance to read the user-config and modify the config however they want. So we can add a network just fine.\r\n- Hardhat generates the config from the user-config **before** plugins run. _This importantly includes validation._\r\n\r\nThe problem with my example is that Hardhat does this:\r\n1. Attempt to validate that network with the `timeout` property.\r\n2. Try to interpret it as a [`HttpNetworkUserConfig`](https://github.com/NomicFoundation/hardhat/blob/9fa977b4a7416f9c6466541144abc495b5c732a4/packages/hardhat-core/src/types/config.ts#L100-L110).\r\n3. Observe that `url` is missing and fail.\r\n\r\nPresumably this fails because there's no good default value for Hardhat to use for `url` in the output [`HttpNetworkConfig`](https://github.com/NomicFoundation/hardhat/blob/9fa977b4a7416f9c6466541144abc495b5c732a4/packages/hardhat-core/src/types/config.ts#L183-L193), and Hardhat isn't architected to consult plugins for missing network configurations.\r\n\r\nNow, we can _add_ a fresh network just fine, but if we want users to override this Truffle Dashboard network, I can think of two options:\r\n- Force users to supply a blank `url: \"\"` property, which the plugin would overwrite, or,\r\n- _Completely manage_ the Dashboard network and have users configure specific properties somewhere outside the usual `userConfig.networks[networkName]` object.\r\n\r\nWith the latter option, we're looking at something like this:\r\n\r\n<details>\r\n<summary>Less ideal example <code>hardhat.config.ts</code></summary>\r\n\r\n```typescript\r\nimport { HardhatUserConfig } from \"hardhat/config\";\r\nimport \"@nomicfoundation/hardhat-toolbox\";\r\nimport \"@truffle/dashboard-hardhat-plugin\";\r\n\r\nconst config: HardhatUserConfig = {\r\n  networks: {\r\n    // ... entire HardhatNetworksUserConfig\r\n    // !! MUST NOT INCLUDE THE TRUFFLE DASHBOARD NETWORK !!\r\n  },\r\n\r\n  truffle: {\r\n    dashboard: {\r\n      networkName: \"truffle-dashboard\",\r\n      timeout: 60\r\n    }\r\n  },\r\n\r\n  // ... rest of HardhatUserConfig ...\r\n};\r\n\r\nexport default config;\r\n```\r\n\r\n(_I'm back to thinking we need a `truffle: { dashboard: { } }` namespace, but please someone convince me otherwise!_)\r\n</details>\r\n\r\n\r\nNot ideal. I'm thinking this approach is probably still not terrible... it still seems nice for @truffle/dashboard-hardhat-plugin to supply the network config itself.\r\n\r\nBut... will lots of people want to configure the timeout or other settings? I was going to suggest default to just disable the timeout altogether for this network, but seems like opinions could easily differ for that (and other settings like `gasMultiplier`). Bit annoying for these settings to live inside this other `truffle.dashboard` namespace.\r\n\r\nAs a small consolation, we _can_ control whether the plugin does this network management by adding a `truffle.dashboard.manageNetwork: boolean` property, so there's a trivial way to offer an \"eject button\" to the old/plugin-less behavior.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1474552333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1502463730",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5958#issuecomment-1502463730",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5958",
    "id": 1502463730,
    "node_id": "IC_kwDOAkfq-c5Zjcby",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-10T23:24:03Z",
    "updated_at": "2023-04-10T23:24:03Z",
    "author_association": "MEMBER",
    "body": "This is now done!\r\n\r\n@truffle/dashboard-hardhat-plugin supports customization starting in v0.2.0 of that package.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1502463730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
