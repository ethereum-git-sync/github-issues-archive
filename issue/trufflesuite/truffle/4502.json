{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4502",
  "id": 1073823522,
  "node_id": "I_kwDOAkfq-c5AAT8i",
  "number": 4502,
  "title": "Step out steps too far out at the start of an internal function call",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 971535002,
      "node_id": "MDU6TGFiZWw5NzE1MzUwMDI=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Debugger",
      "name": "Debugger",
      "color": "7911ad",
      "default": false,
      "description": ""
    },
    {
      "id": 1675041996,
      "node_id": "MDU6TGFiZWwxNjc1MDQxOTk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority4%20%F0%9F%93%8B",
      "name": "priority4 ðŸ“‹",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-12-07T23:02:23Z",
  "updated_at": "2021-12-20T20:07:16Z",
  "closed_at": "2021-12-20T20:07:16Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nLet's say you're in the debugger, stepping through a function `f`, and it calls a function `g`.  You're now at the declaration of the function `g`:\r\n\r\n```\r\nfunction g() public {\r\n^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\nYou don't want to step through `g`, so you press `u`, to step out to `f`.  Oops!  You stepped all the way out to `f`'s caller.  What happened?\r\n\r\nWell, what happened is that, from the debugger's perspective, you were still in `f`, and not in `g`, so of course you stepped out to `f`'s caller.  Why is that?\r\n\r\nThe debugger uses the source map's jump markings to determine when it has successfully stepped out.  But, when you make an internal function call to `g`, you reach the declaration node *before* you reach the jump marking; the jump marking occurs at a *later* instruction at that node.\r\n\r\nThere are, I think, multiple possible approaches to fixing this.  One would be an ad-hoc fix, where you detect this situation and adjust for it.  Another would be to rework how `stepNext()` works, so that it stops on the last instruction of each source range rather than the beginning... although, that might be a good idea, but it also might not solve the problem by itself (what if the jump marking is on the last instruction of the source range, rather than in the middle?).  It's not obvious to me which approach is better here.\r\n\r\n(See also #3843, although that one is admittedly mostly unrelated.)\r\n\r\n## Environment\r\n\r\n* Truffle version (`truffle version`): 5.4.23",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/996232753",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4502#issuecomment-996232753",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502",
    "id": 996232753,
    "node_id": "IC_kwDOAkfq-c47YU4x",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-16T22:11:09Z",
    "updated_at": "2021-12-16T22:11:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, @gnidan notes that if we change `stepNext()` to stop at the end of a source range, we might want to add another command to stop at the beginning of the source range.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/996232753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/998233207",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4502#issuecomment-998233207",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4502",
    "id": 998233207,
    "node_id": "IC_kwDOAkfq-c47f9R3",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-20T20:07:16Z",
    "updated_at": "2021-12-20T20:07:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Nevermind, this issue doesn't seem to exist.  Closing.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/998233207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
