{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1724",
  "id": 411411999,
  "node_id": "MDU6SXNzdWU0MTE0MTE5OTk=",
  "number": 1724,
  "title": "Bug: Truffle fails ungracefully when web3 throws due to an invalid provider.",
  "user": {
    "login": "dan-turner",
    "id": 814113,
    "node_id": "MDQ6VXNlcjgxNDExMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/814113?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dan-turner",
    "html_url": "https://github.com/dan-turner",
    "followers_url": "https://api.github.com/users/dan-turner/followers",
    "following_url": "https://api.github.com/users/dan-turner/following{/other_user}",
    "gists_url": "https://api.github.com/users/dan-turner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dan-turner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dan-turner/subscriptions",
    "organizations_url": "https://api.github.com/users/dan-turner/orgs",
    "repos_url": "https://api.github.com/users/dan-turner/repos",
    "events_url": "https://api.github.com/users/dan-turner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dan-turner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1088150379,
      "node_id": "MDU6TGFiZWwxMDg4MTUwMzc5",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/error%20better",
      "name": "error better",
      "color": "f27915",
      "default": false,
      "description": "issue indicates improvement to error messaging"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-02-18T10:43:29Z",
  "updated_at": "2020-03-11T17:50:21Z",
  "closed_at": "2020-03-11T17:50:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\nNote: this issue description has been edited from its original content by @benjamincburns to capture our current understanding of the problem:\r\n\r\n## Issue\r\n\r\nSpecifying a `provider` in `truffle-config.js` is broken with web3 versions `>=1.0.0-beta.38`. This issue is captured already by ethereum/web3.js#2266. However, the error thrown by web3 in this case (`Error: Please provide an valid Web3 provider`) is silenced, likely somewhere in `truffle-config`.\r\n\r\n## Steps to Reproduce\r\n\r\nThe following `truffle-config.js` does not notify the user of the issue when using `web3@1.0.0-beta.38` and all later versions (at time of writing):\r\n```\r\nconst Web3 = require('web3');\r\n\r\nconst host = \"localhost\";\r\nconst port = 8545\r\n\r\nconst httpProvider = new Web3.providers.HttpProvider(`http://${host}:${port}`);\r\nconst web3 = new Web3(httpProvider);\r\n\r\n/* The following line does actually work */\r\nweb3.eth.getBlockNumber().then(d => console.log(`Current block: ${d}`));\r\n\r\nmodule.exports = {\r\n  networks: {\r\n    development: {\r\n      provider: function() {\r\n        return httpProvider;\r\n      },\r\n      network_id: '*'\r\n    }\r\n  }\r\n};\r\n```\r\nOutput:\r\n```\r\n› yarn truffle console --network development --verbose-rpc\r\nyarn run v1.13.0\r\n$ /Users/dan/code/consensys/drizzle/node_modules/.bin/truffle console --network development --verbose-rpc\r\n   > {\r\n   >   \"jsonrpc\": \"2.0\",\r\n   >   \"id\": 1,\r\n   >   \"method\": \"net_version\",\r\n   >   \"params\": []\r\n   > }\r\nCurrent block: 0\r\n✨  Done in 7.40s.\r\n```\r\n\r\n## Expected Behavior\r\n\r\nTruffle should inform the user that web3 has failed to accept the provider, either by bubbling up the exception message directly, or by wrapping it in an error of our own.\r\n\r\n## Actual Results\r\n\r\nThe provider scenario silently fails.\r\n\r\n## Environment\r\n\r\n* Operating System:  MacOS\r\n* Ethereum client: Any\r\n* Truffle version (`truffle version`): Truffle (unbundled) (core: 5.0.4)\r\n* node version (`node --version`): v11.7.0\r\n* npm version (`npm --version`): 6.7.0\r\n",
  "closed_by": {
    "login": "eggplantzzz",
    "id": 14827965,
    "node_id": "MDQ6VXNlcjE0ODI3OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eggplantzzz",
    "html_url": "https://github.com/eggplantzzz",
    "followers_url": "https://api.github.com/users/eggplantzzz/followers",
    "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
    "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
    "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
    "repos_url": "https://api.github.com/users/eggplantzzz/repos",
    "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/465370681",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1724#issuecomment-465370681",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724",
    "id": 465370681,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NTM3MDY4MQ==",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-20T00:39:24Z",
    "updated_at": "2019-02-20T00:57:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Users experiencing this problem or other invalid provider issues should pin their web3 dependency to `1.0.0-beta.37` until a workaround for ethereum/web3.js#2266 is developed. I'd advise users impacted by this issue to voice their concerns  over on that thread.\r\n\r\nethereum/web3.js#2266, which was introduced in `web3@1.0.0-beta.38` and at time of writing is still present in the current version of web3.\r\n\r\nTo confirm this was the cause of the issue, we asked @dan-turner to pin his web3 dependency to `1.0.0-beta.37` (was previously `^1.0.0-beta.35`). This corrected the problem. We think that this was likely resolving to some version of web3 that is `>=1.0.0-beta.38`. \r\n\r\nThere's an outside chance that this was actually caused by other truffle breaking bugs that were present in `web3@1.0.0-beta.36`, but these issues were fixed in the `1.0.0-beta.37` release.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/465370681/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/465371159",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1724#issuecomment-465371159",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724",
    "id": 465371159,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NTM3MTE1OQ==",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-20T00:41:48Z",
    "updated_at": "2019-02-20T00:41:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this issue, as it's redundant to the one over on the web3 issue tracker.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/465371159/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/465372528",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1724#issuecomment-465372528",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724",
    "id": 465372528,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NTM3MjUyOA==",
    "user": {
      "login": "benjamincburns",
      "id": 803016,
      "node_id": "MDQ6VXNlcjgwMzAxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjamincburns",
      "html_url": "https://github.com/benjamincburns",
      "followers_url": "https://api.github.com/users/benjamincburns/followers",
      "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
      "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
      "repos_url": "https://api.github.com/users/benjamincburns/repos",
      "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-20T00:48:19Z",
    "updated_at": "2019-02-20T00:48:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually, it's a bug that the error from ethereum/web3.js#2266 didn't bubble up to the user in any form. Reopening this case (and lightly editing the description) so we can action that change.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/465372528/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/481794535",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1724#issuecomment-481794535",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724",
    "id": 481794535,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTc5NDUzNQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-10T17:51:36Z",
    "updated_at": "2019-04-10T17:51:36Z",
    "author_association": "MEMBER",
    "body": "Is this still an issue? We can improve the error handling here to notify unsupported web3 versions. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/481794535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/597776897",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1724#issuecomment-597776897",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1724",
    "id": 597776897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5Nzc3Njg5Nw==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-11T17:50:20Z",
    "updated_at": "2020-03-11T17:50:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "I believe this got solved a while back with [this](https://github.com/trufflesuite/truffle/pull/2510). Thanks for suggesting this kind of thing!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/597776897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
