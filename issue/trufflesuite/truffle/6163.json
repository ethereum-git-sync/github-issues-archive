{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/6163",
  "id": 1851885209,
  "node_id": "I_kwDOAkfq-c5uYYaZ",
  "number": 6163,
  "title": "`truffle test --debug` hangs without starting the debugger",
  "user": {
    "login": "aardvarkk",
    "id": 1251092,
    "node_id": "MDQ6VXNlcjEyNTEwOTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1251092?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aardvarkk",
    "html_url": "https://github.com/aardvarkk",
    "followers_url": "https://api.github.com/users/aardvarkk/followers",
    "following_url": "https://api.github.com/users/aardvarkk/following{/other_user}",
    "gists_url": "https://api.github.com/users/aardvarkk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aardvarkk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aardvarkk/subscriptions",
    "organizations_url": "https://api.github.com/users/aardvarkk/orgs",
    "repos_url": "https://api.github.com/users/aardvarkk/repos",
    "events_url": "https://api.github.com/users/aardvarkk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aardvarkk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-08-15T18:00:55Z",
  "updated_at": "2023-08-24T17:44:35Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've [opened a support ticket](https://trufflesuite.zendesk.com/hc/en-us/requests/new) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen I try to use in-test debugging, it hangs my terminal. Ganache seems to show the contract getting deployed successfully, and the output from the `truffle test` command shows the contract getting successfully compiled.\r\n\r\n```\r\n\r\n> Artifacts written to /var/folders/4x/gnfwkbhn3dv7277cbcd0wjr80000gn/T/test--3627-470AjUBtVWpk\r\n> Compiled successfully using:\r\n   - solc: 0.8.21+commit.d9974bed.Emscripten.clang\r\n\r\n```\r\n\r\nHowever, then it just says \"Contract: MyContract\" and stalls. I can see pairs of calls to eth_getBlockByNumber being called about once per second in the ganache output. My contract \r\n\r\n## Steps to Reproduce\r\n\r\n- Create a brand new project created with the latest version of Truffle\r\n- Create a contract function (mine is a tokenURI function of the following form: `function tokenURI(address creator, uint256 tokenId) external view returns (string memory);`)\r\n- Add a test to call the `tokenURI` function in the contract, and wrap it in `debug()`\r\n\r\n## Expected Behavior\r\n\r\nThe debugger should start in the terminal when running `truffle test --debug`\r\n\r\n## Actual Results\r\n\r\nThe terminal hangs, showing only \"Contract: MyContract\".\r\n\r\n## Environment\r\n\r\n* Operating System: macOS (M2 Max)\r\n* Ethereum client: Ganache\r\n* Truffle version (`truffle version`): 5.11.2\r\n* node version (`node --version`): 18.17.2\r\n* npm version (`npm --version`): 8.19.4\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1679953410",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6163#issuecomment-1679953410",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163",
    "id": 1679953410,
    "node_id": "IC_kwDOAkfq-c5kIg4C",
    "user": {
      "login": "aardvarkk",
      "id": 1251092,
      "node_id": "MDQ6VXNlcjEyNTEwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1251092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aardvarkk",
      "html_url": "https://github.com/aardvarkk",
      "followers_url": "https://api.github.com/users/aardvarkk/followers",
      "following_url": "https://api.github.com/users/aardvarkk/following{/other_user}",
      "gists_url": "https://api.github.com/users/aardvarkk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aardvarkk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aardvarkk/subscriptions",
      "organizations_url": "https://api.github.com/users/aardvarkk/orgs",
      "repos_url": "https://api.github.com/users/aardvarkk/repos",
      "events_url": "https://api.github.com/users/aardvarkk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aardvarkk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-16T04:46:22Z",
    "updated_at": "2023-08-16T04:56:17Z",
    "author_association": "NONE",
    "body": "For more context, I've started diving into the debugger a bit and it looks like it's stuck in the `checkConfirmation` function inside web3.js? It keeps getting called over and over and doesn't seem to resolve properly for some reason.\r\n\r\nIt looks like `confirmationCount` keeps having the value 2, and it maybe wants to equal `method.transactionConfirmationBlocks + 1`, which is 25. Every time the polling happens the values stay the same.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1679953410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1681205577",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6163#issuecomment-1681205577",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163",
    "id": 1681205577,
    "node_id": "IC_kwDOAkfq-c5kNSlJ",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-16T20:08:26Z",
    "updated_at": "2023-08-16T20:08:26Z",
    "author_association": "MEMBER",
    "body": "Hm, you can try disabling the confirmation listener. Not sure if that would make it work better or if it'd cause it to stop working altogether, but it's worth a shot :)\r\n\r\nSee docs [here](https://trufflesuite.com/docs/truffle/reference/configuration/#networks) about how to specify `disableConfirmationListener`",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1681205577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1683364654",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6163#issuecomment-1683364654",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163",
    "id": 1683364654,
    "node_id": "IC_kwDOAkfq-c5kVhsu",
    "user": {
      "login": "aardvarkk",
      "id": 1251092,
      "node_id": "MDQ6VXNlcjEyNTEwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1251092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aardvarkk",
      "html_url": "https://github.com/aardvarkk",
      "followers_url": "https://api.github.com/users/aardvarkk/followers",
      "following_url": "https://api.github.com/users/aardvarkk/following{/other_user}",
      "gists_url": "https://api.github.com/users/aardvarkk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aardvarkk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aardvarkk/subscriptions",
      "organizations_url": "https://api.github.com/users/aardvarkk/orgs",
      "repos_url": "https://api.github.com/users/aardvarkk/repos",
      "events_url": "https://api.github.com/users/aardvarkk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aardvarkk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-18T05:16:02Z",
    "updated_at": "2023-08-18T05:16:17Z",
    "author_association": "NONE",
    "body": "@gnidan Well it changed the output a bit, but it's still hanging. Now when I inspect the ganache output I see a bit more \"stuff\":\r\n\r\n```\r\neth_getTransactionReceipt\r\neth_getCode\r\nevm_snapshot\r\nSaved snapshot #1\r\nnet_version\r\neth_blockNumber\r\neth_getBlockByNumber\r\neth_call\r\n```\r\n\r\nNormally it'd just keep repeating the `eth_getBlockByNumber` until I set up the `disableConfirmationListener`. Now it actually tries to call it, but then the truffle test code just sits indefinitely as it did before.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1683364654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1685193342",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6163#issuecomment-1685193342",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163",
    "id": 1685193342,
    "node_id": "IC_kwDOAkfq-c5kcgJ-",
    "user": {
      "login": "aardvarkk",
      "id": 1251092,
      "node_id": "MDQ6VXNlcjEyNTEwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1251092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aardvarkk",
      "html_url": "https://github.com/aardvarkk",
      "followers_url": "https://api.github.com/users/aardvarkk/followers",
      "following_url": "https://api.github.com/users/aardvarkk/following{/other_user}",
      "gists_url": "https://api.github.com/users/aardvarkk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aardvarkk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aardvarkk/subscriptions",
      "organizations_url": "https://api.github.com/users/aardvarkk/orgs",
      "repos_url": "https://api.github.com/users/aardvarkk/repos",
      "events_url": "https://api.github.com/users/aardvarkk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aardvarkk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-20T05:51:55Z",
    "updated_at": "2023-08-20T05:51:55Z",
    "author_association": "NONE",
    "body": "I thought maybe this was a MacOS problem so I tried on my Linux machine with the exact same results.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1685193342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1692154253",
    "html_url": "https://github.com/trufflesuite/truffle/issues/6163#issuecomment-1692154253",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/6163",
    "id": 1692154253,
    "node_id": "IC_kwDOAkfq-c5k3DmN",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-24T17:44:35Z",
    "updated_at": "2023-08-24T17:44:35Z",
    "author_association": "MEMBER",
    "body": "Hm, really weird. How much gas does the `eth_call` require? It's possible that the hanging you're observing is just Ganache taking a long time to execute `eth_call`. This guess is a long shot.\r\n\r\nNot sure what else might be going wrong here. Maybe you could try running `truffle test --debug` inside `truffle console --verbose-rpc` (while connecting to a separately running Ganache instance). That might give you a bit more detail.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1692154253/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
