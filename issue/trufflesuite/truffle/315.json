{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/315",
  "id": 196243652,
  "node_id": "MDU6SXNzdWUxOTYyNDM2NTI=",
  "number": 315,
  "title": "Tries to link library to itself if self-referential using...for statement is used.",
  "user": {
    "login": "raineorshine",
    "id": 750276,
    "node_id": "MDQ6VXNlcjc1MDI3Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/750276?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/raineorshine",
    "html_url": "https://github.com/raineorshine",
    "followers_url": "https://api.github.com/users/raineorshine/followers",
    "following_url": "https://api.github.com/users/raineorshine/following{/other_user}",
    "gists_url": "https://api.github.com/users/raineorshine/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/raineorshine/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/raineorshine/subscriptions",
    "organizations_url": "https://api.github.com/users/raineorshine/orgs",
    "repos_url": "https://api.github.com/users/raineorshine/repos",
    "events_url": "https://api.github.com/users/raineorshine/events{/privacy}",
    "received_events_url": "https://api.github.com/users/raineorshine/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2016-12-17T21:23:06Z",
  "updated_at": "2018-08-20T22:07:11Z",
  "closed_at": "2017-03-20T21:54:45Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nAdding `using MyLib for Data` inside `MyLib` itself causes the contract to compile without error but then the linker will try to link the library to itself, which fails.\r\n\r\n## Steps to Reproduce\r\n\r\n./contracts/MyLib.sol:\r\n```\r\npragma solidity ^0.4.4;\r\n\r\nlibrary MyLib {\r\n    struct Data {\r\n        uint a;\r\n    }\r\n\r\n    using MyLib for Data;\r\n\r\n    function foo(Data storage self) returns (uint) {\r\n        self.bar();\r\n    }\r\n\r\n    function bar(Data storage self) returns (uint) {\r\n        self.a = 10;\r\n        return self.a;\r\n    }\r\n}\r\n\r\ncontract MyContract {\r\n  using MyLib for MyLib.Data;\r\n  MyLib.Data data;\r\n\r\n  function a() returns (uint) {\r\n      return data.foo();\r\n  }\r\n}\r\n```\r\n\r\n./migrations/2_libraries.js:\r\n```\r\nmodule.exports = function(deployer) {\r\n  deployer.deploy(MyLib);\r\n  deployer.deploy(MyContract);\r\n};\r\n```\r\n\r\n## Expected Behavior\r\n\r\nNeed to confirm, but I assume this is simply invalid code.\r\n\r\nAs rare as this is, maybe someone else will make the same mistake, and it would be nice to have an intelligent error message.\r\n\r\n## Actual Results\r\n\r\n```\r\nRunning migration: 1_initial_migration.js\r\n  Deploying Migrations...\r\n  Migrations: 0x600bd8882fe9d3b6f2afbb6d1aa3e863fa8a9aaa\r\nSaving successful migration to network...\r\nSaving artifacts...\r\nRunning migration: 2_libraries.js\r\nError encountered, bailing. Network state unknown. Review successful transactions manually.\r\nError: Cannot link library: MyLib has no address. Has it been deployed?\r\n    at Object.module.exports.link (/Users/raine/projects/test-contracts/node_modules/truffle/lib/linker.js:16:13)\r\n    at /Users/raine/projects/test-contracts/node_modules/truffle/lib/linker.js:65:12\r\n    at Array.forEach (native)\r\n    at Object.module.exports.autolink (/Users/raine/projects/test-contracts/node_modules/truffle/lib/linker.js:58:24)\r\n    at /Users/raine/projects/test-contracts/node_modules/truffle/lib/deployer.js:12:14\r\n    at /Users/raine/projects/test-contracts/node_modules/truffle/lib/deferredchain.js:20:15\r\n    at run (/Users/raine/projects/test-contracts/node_modules/core-js/modules/es6.promise.js:87:22)\r\n    at /Users/raine/projects/test-contracts/node_modules/core-js/modules/es6.promise.js:100:28\r\n    at flush (/Users/raine/projects/test-contracts/node_modules/core-js/modules/_microtask.js:18:9)\r\n    at _combinedTickCallback (internal/process/next_tick.js:67:7)\r\n    at process._tickDomainCallback (internal/process/next_tick.js:122:9)\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: OSX El Capitan\r\n* Truffle version: 3.0.0-4\r\n* Ethereum client: Forked from TestRPC v3.0.2\r\n* node version: 6.1.0\r\n* npm version: 3.8.6\r\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/315/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/268287262",
    "html_url": "https://github.com/trufflesuite/truffle/issues/315#issuecomment-268287262",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
    "id": 268287262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2ODI4NzI2Mg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-20T16:23:18Z",
    "updated_at": "2016-12-20T16:23:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Good catch, thanks @raineorshine ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/268287262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/287910319",
    "html_url": "https://github.com/trufflesuite/truffle/issues/315#issuecomment-287910319",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
    "id": 287910319,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzkxMDMxOQ==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-20T21:54:45Z",
    "updated_at": "2017-03-20T21:54:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "As late-introduced changes in the 3.x release, this should no longer be an issue since the `autolink` features have been removed. If you're still running into this issue, please reopen. Thanks @raineorshine!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/287910319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414154423",
    "html_url": "https://github.com/trufflesuite/truffle/issues/315#issuecomment-414154423",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
    "id": 414154423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDE1NDQyMw==",
    "user": {
      "login": "sebasgoldberg",
      "id": 1379852,
      "node_id": "MDQ6VXNlcjEzNzk4NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1379852?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebasgoldberg",
      "html_url": "https://github.com/sebasgoldberg",
      "followers_url": "https://api.github.com/users/sebasgoldberg/followers",
      "following_url": "https://api.github.com/users/sebasgoldberg/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebasgoldberg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebasgoldberg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebasgoldberg/subscriptions",
      "organizations_url": "https://api.github.com/users/sebasgoldberg/orgs",
      "repos_url": "https://api.github.com/users/sebasgoldberg/repos",
      "events_url": "https://api.github.com/users/sebasgoldberg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebasgoldberg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-19T20:42:34Z",
    "updated_at": "2018-08-19T20:42:34Z",
    "author_association": "NONE",
    "body": "Hi @raineorshine , did you solve your problem for library linking to itself?\r\n\r\nI am using Truffle v4.1.13 (core: 4.1.13)/Solidity v0.4.24 (solc-js) and I get this error when try to deploy MyLib:\r\n\r\n```\r\nError: MyLib contains unresolved libraries. You must deploy and link the following libraries before you can deploy a new version of MyLib: MyLib\r\n    at /usr/lib/node_modules/truffle/build/webpack:/packages/truffle-contract/contract.js:371:1\r\n    at <anonymous>\r\n    at process._tickCallback (internal/process/next_tick.js:188:7)\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414154423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414394453",
    "html_url": "https://github.com/trufflesuite/truffle/issues/315#issuecomment-414394453",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
    "id": 414394453,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDM5NDQ1Mw==",
    "user": {
      "login": "raineorshine",
      "id": 750276,
      "node_id": "MDQ6VXNlcjc1MDI3Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/750276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/raineorshine",
      "html_url": "https://github.com/raineorshine",
      "followers_url": "https://api.github.com/users/raineorshine/followers",
      "following_url": "https://api.github.com/users/raineorshine/following{/other_user}",
      "gists_url": "https://api.github.com/users/raineorshine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/raineorshine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/raineorshine/subscriptions",
      "organizations_url": "https://api.github.com/users/raineorshine/orgs",
      "repos_url": "https://api.github.com/users/raineorshine/repos",
      "events_url": "https://api.github.com/users/raineorshine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/raineorshine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-20T17:17:29Z",
    "updated_at": "2018-08-20T17:17:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sebasgoldberg I think I had to put the library in a separate file and import it.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414394453/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414396855",
    "html_url": "https://github.com/trufflesuite/truffle/issues/315#issuecomment-414396855",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
    "id": 414396855,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDM5Njg1NQ==",
    "user": {
      "login": "sebasgoldberg",
      "id": 1379852,
      "node_id": "MDQ6VXNlcjEzNzk4NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1379852?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebasgoldberg",
      "html_url": "https://github.com/sebasgoldberg",
      "followers_url": "https://api.github.com/users/sebasgoldberg/followers",
      "following_url": "https://api.github.com/users/sebasgoldberg/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebasgoldberg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebasgoldberg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebasgoldberg/subscriptions",
      "organizations_url": "https://api.github.com/users/sebasgoldberg/orgs",
      "repos_url": "https://api.github.com/users/sebasgoldberg/repos",
      "events_url": "https://api.github.com/users/sebasgoldberg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebasgoldberg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-20T17:25:15Z",
    "updated_at": "2018-08-20T17:25:15Z",
    "author_association": "NONE",
    "body": "@raineorshine, thanks for your response, but I am already have the library in a separate file.\r\n\r\nI think it is not possible yet a 'use' statement inside a library that references to itself:\r\n\r\n```\r\nlibrary MyLib{\r\n  ...\r\n  use MyLib for MyType;\r\n  ...\r\n}\r\n```\r\n\r\nI tried to deploy your example in remix, and was not possible.\r\n\r\nIf I remove the 'use' statement inside the library, and pass 'self' as parameter (inside the library too), then the deploy is possible.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414396855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414479082",
    "html_url": "https://github.com/trufflesuite/truffle/issues/315#issuecomment-414479082",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/315",
    "id": 414479082,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDQ3OTA4Mg==",
    "user": {
      "login": "raineorshine",
      "id": 750276,
      "node_id": "MDQ6VXNlcjc1MDI3Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/750276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/raineorshine",
      "html_url": "https://github.com/raineorshine",
      "followers_url": "https://api.github.com/users/raineorshine/followers",
      "following_url": "https://api.github.com/users/raineorshine/following{/other_user}",
      "gists_url": "https://api.github.com/users/raineorshine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/raineorshine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/raineorshine/subscriptions",
      "organizations_url": "https://api.github.com/users/raineorshine/orgs",
      "repos_url": "https://api.github.com/users/raineorshine/repos",
      "events_url": "https://api.github.com/users/raineorshine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/raineorshine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-20T22:07:11Z",
    "updated_at": "2018-08-20T22:07:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sebasgoldberg That's too bad. It's a good syntax. You may have to use the normal syntax instead. :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/414479082/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
