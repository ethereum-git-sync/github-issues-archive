{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/650",
  "id": 270241678,
  "node_id": "MDU6SXNzdWUyNzAyNDE2Nzg=",
  "number": 650,
  "title": "Migrating multiple contracts where a subsequent contract is deployed in a .then clause or after an await results in only first contract being deployed",
  "user": {
    "login": "mhchu",
    "id": 8302177,
    "node_id": "MDQ6VXNlcjgzMDIxNzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8302177?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mhchu",
    "html_url": "https://github.com/mhchu",
    "followers_url": "https://api.github.com/users/mhchu/followers",
    "following_url": "https://api.github.com/users/mhchu/following{/other_user}",
    "gists_url": "https://api.github.com/users/mhchu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mhchu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mhchu/subscriptions",
    "organizations_url": "https://api.github.com/users/mhchu/orgs",
    "repos_url": "https://api.github.com/users/mhchu/repos",
    "events_url": "https://api.github.com/users/mhchu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mhchu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 971536096,
      "node_id": "MDU6TGFiZWw5NzE1MzYwOTY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Migrations",
      "name": "Migrations",
      "color": "b887db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2017-11-01T09:07:51Z",
  "updated_at": "2019-08-05T15:42:14Z",
  "closed_at": "2018-02-08T21:06:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [X] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen migrating more than one contract the following works:\r\n````\r\ndeployer.deploy(contractA);\r\ndeployer.deploy(contractB);\r\n````\r\nbut if the second contract needs information from the first contract to be deployed, then this:\r\n````\r\nawait deployer.deploy(contractA);\r\nconst instanceA = await contractA.deployed();\r\nconst value = await instanceA.getValue();\r\ndeployer.deploy(contractB, value);\r\n````\r\ndoes not work. Only contractA is deployed to the network and `truffle migrate` ends after showing contractB's address and does not say \"Saving successful migration to network...\"\r\n\r\nThis is true even in the simplified example of:\r\n````\r\nawait deployer.deploy(contractA);\r\ndeployer.deploy(contractB);\r\n````\r\n\r\nThe use of .then() or deployer.then() results in the same behavior - only the first contract is saved to the network.\r\n````\r\ndeployer.deploy(contractA).then( ()=>{ deployer.deploy(contractB); });\r\n````\r\n````\r\ndeployer.deploy(contractA);\r\ndeployer.then( ()=> deployer.deploy(contractB); );\r\n````\r\nIn all cases, `truffle migrate` says `Deploying contractB` and provides `contractB: <contractB address>` but it does not say `Saving successful migration to network...`\r\n\r\n## Steps to Reproduce\r\n\r\nRunning truffle 3.4.11, node 7.10.1, and TestRPC 4.1.3 and simple contractA in contracts/contractA.sol and contractB in contracts/contractB.sol with migrations/2_deploy_contracts.js containing:\r\n````\r\nvar contractA = artifacts.require(\"../contracts/contractA.sol\");\r\nvar contractB = artifacts.require(\"../contracts/contractB.sol\");\r\n\r\nmodule.exports = async function(deployer, network, accounts) {\r\n\tawait deployer.deploy(contractA);\r\n\tdeployer.deploy(contractB);\r\n}\r\n````\r\ncontractA will be deployed on the network while contractB will not. (Obviously, this is not the use case, this is the simplest replication. The use case would be something closer to:\r\n````\r\nvar contractA = artifacts.require(\"../contracts/contractA.sol\");\r\nvar contractB = artifacts.require(\"../contracts/contractB.sol\");\r\n\r\nmodule.exports = async function(deployer, network, accounts) {\r\n\tconst addr = accounts[0];\r\n\r\n\tawait deployer.deploy(contractA, addr);\r\n\tconst instance = await contractA.deployed();\r\n\tconst value = await instance.getValue();\r\n\tconsole.log('DEBUG:', value); // provides an expected value\r\n\tdeployer.deploy(contractB, value);\r\n}\r\n````\r\n\r\n## Expected Behavior\r\n\r\nBoth contracts should be on the network.\r\n\r\n## Actual Results\r\n\r\n`truffle network` shows only the first contract. Using `truffle console` and trying to access `contractB.deployed()` results in a message that the contract is not deployed on the network.\r\n",
  "closed_by": {
    "login": "cgewecke",
    "id": 7332026,
    "node_id": "MDQ6VXNlcjczMzIwMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cgewecke",
    "html_url": "https://github.com/cgewecke",
    "followers_url": "https://api.github.com/users/cgewecke/followers",
    "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
    "organizations_url": "https://api.github.com/users/cgewecke/orgs",
    "repos_url": "https://api.github.com/users/cgewecke/repos",
    "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cgewecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/650/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/342751957",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-342751957",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 342751957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0Mjc1MTk1Nw==",
    "user": {
      "login": "Velenir",
      "id": 5121491,
      "node_id": "MDQ6VXNlcjUxMjE0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5121491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Velenir",
      "html_url": "https://github.com/Velenir",
      "followers_url": "https://api.github.com/users/Velenir/followers",
      "following_url": "https://api.github.com/users/Velenir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Velenir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Velenir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Velenir/subscriptions",
      "organizations_url": "https://api.github.com/users/Velenir/orgs",
      "repos_url": "https://api.github.com/users/Velenir/repos",
      "events_url": "https://api.github.com/users/Velenir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Velenir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-08T08:55:28Z",
    "updated_at": "2017-11-08T09:01:22Z",
    "author_association": "NONE",
    "body": "You need to return `deployer.deploy(...)` from inside `.then(() => {...})`\r\nFor me it works with\r\n```\r\ndeployer.deploy(contractA).then( ()=> deployer.deploy(contractB) );\r\n```\r\nor\r\n```\r\ndeployer.then( ()=> {\r\n  ...\r\n return deployer.deploy(contractB);\r\n);\r\n```\r\n\r\n`async...await` and any `Promise.*` don't work as per [#501](https://github.com/trufflesuite/truffle/issues/501#issuecomment-332589663)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/342751957/reactions",
      "total_count": 7,
      "+1": 7,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/342991148",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-342991148",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 342991148,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0Mjk5MTE0OA==",
    "user": {
      "login": "mhchu",
      "id": 8302177,
      "node_id": "MDQ6VXNlcjgzMDIxNzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8302177?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mhchu",
      "html_url": "https://github.com/mhchu",
      "followers_url": "https://api.github.com/users/mhchu/followers",
      "following_url": "https://api.github.com/users/mhchu/following{/other_user}",
      "gists_url": "https://api.github.com/users/mhchu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mhchu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mhchu/subscriptions",
      "organizations_url": "https://api.github.com/users/mhchu/orgs",
      "repos_url": "https://api.github.com/users/mhchu/repos",
      "events_url": "https://api.github.com/users/mhchu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mhchu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-08T23:04:04Z",
    "updated_at": "2017-11-08T23:04:04Z",
    "author_association": "NONE",
    "body": "I will give it a try and report back (probably in a couple days when I can return to my project).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/342991148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/351604419",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-351604419",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 351604419,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTYwNDQxOQ==",
    "user": {
      "login": "zcstarr",
      "id": 173187,
      "node_id": "MDQ6VXNlcjE3MzE4Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/173187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zcstarr",
      "html_url": "https://github.com/zcstarr",
      "followers_url": "https://api.github.com/users/zcstarr/followers",
      "following_url": "https://api.github.com/users/zcstarr/following{/other_user}",
      "gists_url": "https://api.github.com/users/zcstarr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zcstarr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zcstarr/subscriptions",
      "organizations_url": "https://api.github.com/users/zcstarr/orgs",
      "repos_url": "https://api.github.com/users/zcstarr/repos",
      "events_url": "https://api.github.com/users/zcstarr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zcstarr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-14T04:19:17Z",
    "updated_at": "2017-12-14T04:19:41Z",
    "author_association": "NONE",
    "body": "This is still an issue in 4.0.1 only .then and Promise chaining seems to work",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/351604419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/361607835",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-361607835",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 361607835,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTYwNzgzNQ==",
    "user": {
      "login": "dzentota",
      "id": 834595,
      "node_id": "MDQ6VXNlcjgzNDU5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/834595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dzentota",
      "html_url": "https://github.com/dzentota",
      "followers_url": "https://api.github.com/users/dzentota/followers",
      "following_url": "https://api.github.com/users/dzentota/following{/other_user}",
      "gists_url": "https://api.github.com/users/dzentota/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dzentota/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dzentota/subscriptions",
      "organizations_url": "https://api.github.com/users/dzentota/orgs",
      "repos_url": "https://api.github.com/users/dzentota/repos",
      "events_url": "https://api.github.com/users/dzentota/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dzentota/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-30T14:23:26Z",
    "updated_at": "2018-01-30T14:23:26Z",
    "author_association": "NONE",
    "body": "Tried every possible combination, async + await, then()  and async+await+then(), it doesn't work. In fact it always save Artifacts before deploying second contract, that's why you do not see address of the second contract. In my case I see address of the second contract after saving artifacts:\r\nRunning step...\r\n  Deploying SampleCampaign...\r\n  ... 0x68e6e16d86617689f9522e6dc9b56e0e9f66c7400e7c101fd3e0afaf5ffe8ca4\r\nSaving artifacts...\r\n  ... 0xdc7a4c7cdc7634c1b68fa254f863b2d54edbb475100f52fe87f084c63dcbd95d\r\n  SampleCampaign: 0xad89528ffe22aa057cfbec6c9ccf2367a638eb79\r\n\r\nSo if I run `truffle console` and then in console:\r\n`SampleCampaign.deployed()`\r\n\r\nI get:\r\nSampleCampaign has not been deployed to detected network (network/artifact mismatch)\r\n    at /usr/lib/node_modules/truffle/build/cli.bundled.js:318327:17\r\n    at <anonymous>\r\n    at process._tickDomainCallback (internal/process/next_tick.js:228:7)\r\n\r\nBut if I check address \"0xad89528ffe22aa057cfbec6c9ccf2367a638eb79\" I see that contract is there:\r\n`SampleCampaign.at(\"0xad89528ffe22aa057cfbec6c9ccf2367a638eb79\")`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/361607835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/363526084",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-363526084",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 363526084,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzUyNjA4NA==",
    "user": {
      "login": "ismaelbej",
      "id": 79440,
      "node_id": "MDQ6VXNlcjc5NDQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/79440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ismaelbej",
      "html_url": "https://github.com/ismaelbej",
      "followers_url": "https://api.github.com/users/ismaelbej/followers",
      "following_url": "https://api.github.com/users/ismaelbej/following{/other_user}",
      "gists_url": "https://api.github.com/users/ismaelbej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ismaelbej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ismaelbej/subscriptions",
      "organizations_url": "https://api.github.com/users/ismaelbej/orgs",
      "repos_url": "https://api.github.com/users/ismaelbej/repos",
      "events_url": "https://api.github.com/users/ismaelbej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ismaelbej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-06T18:52:43Z",
    "updated_at": "2018-02-06T18:52:43Z",
    "author_association": "NONE",
    "body": "This issue seems to be a duplicate of https://github.com/trufflesuite/truffle/issues/501.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/363526084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364248253",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-364248253",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 364248253,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDI0ODI1Mw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-08T21:06:29Z",
    "updated_at": "2018-02-08T21:06:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ismaelbej Thank you for noting this, closing here in favor of #501..\r\n\r\n@dzentota @mhchu \r\nThe deployer stages deployments rather than running them at the execution time of the migration function. It's possible to use async/await within its context but ultimately you also have to follow the deployer's interface by returning a promise to its `.then` property. More guidance on this at the other issue [here](https://github.com/trufflesuite/truffle/issues/501#issuecomment-332589663)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364248253/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364372270",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-364372270",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 364372270,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDM3MjI3MA==",
    "user": {
      "login": "dzentota",
      "id": 834595,
      "node_id": "MDQ6VXNlcjgzNDU5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/834595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dzentota",
      "html_url": "https://github.com/dzentota",
      "followers_url": "https://api.github.com/users/dzentota/followers",
      "following_url": "https://api.github.com/users/dzentota/following{/other_user}",
      "gists_url": "https://api.github.com/users/dzentota/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dzentota/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dzentota/subscriptions",
      "organizations_url": "https://api.github.com/users/dzentota/orgs",
      "repos_url": "https://api.github.com/users/dzentota/repos",
      "events_url": "https://api.github.com/users/dzentota/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dzentota/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-09T08:49:08Z",
    "updated_at": "2018-02-09T08:49:08Z",
    "author_association": "NONE",
    "body": "I saw #501 before and some similar. But approach mentioned in #501 doesn't work, output is the same",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364372270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364453343",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-364453343",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 364453343,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDQ1MzM0Mw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-09T14:46:16Z",
    "updated_at": "2018-02-09T14:46:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dzentota Could you share the code from your migrations that's not working?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364453343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364670606",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-364670606",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 364670606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDY3MDYwNg==",
    "user": {
      "login": "dzentota",
      "id": 834595,
      "node_id": "MDQ6VXNlcjgzNDU5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/834595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dzentota",
      "html_url": "https://github.com/dzentota",
      "followers_url": "https://api.github.com/users/dzentota/followers",
      "following_url": "https://api.github.com/users/dzentota/following{/other_user}",
      "gists_url": "https://api.github.com/users/dzentota/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dzentota/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dzentota/subscriptions",
      "organizations_url": "https://api.github.com/users/dzentota/orgs",
      "repos_url": "https://api.github.com/users/dzentota/repos",
      "events_url": "https://api.github.com/users/dzentota/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dzentota/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-10T16:47:55Z",
    "updated_at": "2018-02-10T16:47:55Z",
    "author_association": "NONE",
    "body": "Hi, unfortunately I don't have all the variants I've tried. Here is an example with `then()`\r\n\r\n```js\r\nvar Crowdsale = artifacts.require(\"./Crowdsale.sol\");\r\nvar SampleCampaign = artifacts.require('./SampleCampaign.sol');\r\n\r\nmodule.exports = function (deployer) {\r\n    Crowdsale.deployed().then(function (_) {\r\n        console.log(Crowdsale.address);\r\n       return _.token.call();\r\n    }).then(function(tokenAddress) {\r\n        let crowdsaleAddress = Crowdsale.address;\r\n        let minContribution = 1000000000000000000;\r\n        let maxContribution = 10000000000000000000;\r\n        let softCap = 5000000000000000000;\r\n        let hardCap = 100000000000000000000;\r\n        let startTime = Math.floor(Date.now() / 1000);\r\n        let endTime = Math.floor(Date.now() / 1000) + 100000;\r\n        let fee = 1;\r\n        let bountyFee = 1;\r\n\r\n        deployer.deploy(\r\n            SampleCampaign,\r\n            crowdsaleAddress,\r\n            tokenAddress,\r\n            minContribution,\r\n            maxContribution,\r\n            softCap,\r\n            hardCap,\r\n            startTime,\r\n            endTime,\r\n            fee,\r\n            bountyFee\r\n        );\r\n    })\r\n\r\n}\r\n\r\n```\r\n\r\nOutput:\r\n```\r\nmigrate -f 4\r\nUsing network 'develop'.\r\n\r\nRunning migration: 4_deploy_campaign.js\r\nSaving successful migration to network...\r\n  Replacing SampleCampaign...\r\n  ... 0x87e580340a0fdff84559a1bb014f08f281476024af9f32a8036e4743f19f9f2d\r\nSaving artifacts...\r\ntruffle(develop)>   ... 0x2606dfbc10b81afaa9d780e64c1612cea03e27dea943b48b2f3c40b4d03b3856\r\n  SampleCampaign: 0xbaaa2a3237035a2c7fa2a33c76b44a8c6fe18e87\r\n\r\nundefined\r\n\r\n```\r\n\r\nActually, I see all this text except `undefined`. Undefined appears after I hit `enter` (otherwise it hangs)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364670606/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364782897",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-364782897",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 364782897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc4Mjg5Nw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T20:03:06Z",
    "updated_at": "2018-02-11T20:03:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dzentota The example @Velenir gives in this issue [above](https://github.com/trufflesuite/truffle/issues/650#issuecomment-342751957) is the model you should follow. If you want to run async logic in the migrations you must return it as a promise to the **`deployer`** method. In your case, \r\n```javascript\r\nmodule.exports = function (deployer) {\r\n  deployer.then( function() {\r\n     return Crowdsale.deployed() .... etc ...\r\n);\r\n```\r\n\r\nAdditionally make sure you return **everything** async in the promise chain. For example the `deployer.deploy` in your final clause should also be prefaced with a return. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364782897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364851647",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-364851647",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 364851647,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDg1MTY0Nw==",
    "user": {
      "login": "dzentota",
      "id": 834595,
      "node_id": "MDQ6VXNlcjgzNDU5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/834595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dzentota",
      "html_url": "https://github.com/dzentota",
      "followers_url": "https://api.github.com/users/dzentota/followers",
      "following_url": "https://api.github.com/users/dzentota/following{/other_user}",
      "gists_url": "https://api.github.com/users/dzentota/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dzentota/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dzentota/subscriptions",
      "organizations_url": "https://api.github.com/users/dzentota/orgs",
      "repos_url": "https://api.github.com/users/dzentota/repos",
      "events_url": "https://api.github.com/users/dzentota/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dzentota/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-12T08:08:22Z",
    "updated_at": "2018-02-12T08:08:22Z",
    "author_association": "NONE",
    "body": "Thanks @cgewecke now it works!!!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/364851647/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/518287440",
    "html_url": "https://github.com/trufflesuite/truffle/issues/650#issuecomment-518287440",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/650",
    "id": 518287440,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODI4NzQ0MA==",
    "user": {
      "login": "benediamond",
      "id": 30356252,
      "node_id": "MDQ6VXNlcjMwMzU2MjUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30356252?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benediamond",
      "html_url": "https://github.com/benediamond",
      "followers_url": "https://api.github.com/users/benediamond/followers",
      "following_url": "https://api.github.com/users/benediamond/following{/other_user}",
      "gists_url": "https://api.github.com/users/benediamond/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benediamond/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benediamond/subscriptions",
      "organizations_url": "https://api.github.com/users/benediamond/orgs",
      "repos_url": "https://api.github.com/users/benediamond/repos",
      "events_url": "https://api.github.com/users/benediamond/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benediamond/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-05T15:42:14Z",
    "updated_at": "2019-08-05T15:42:14Z",
    "author_association": "NONE",
    "body": "> Additionally make sure you return everything async in the promise chain\r\n\r\n@dzentota @cgewecke yes, this part is key in a way I can't quite understand yet. Is this because the main deployment function \"knows to wait\" for the promise chain to finish executing when it depends on its return value?\r\n\r\nIs the value returned from the deployment function actually used by truffle in any way...?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/518287440/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
