{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4617",
  "id": 1099933025,
  "node_id": "I_kwDOAkfq-c5Bj6Vh",
  "number": 4617,
  "title": "`truffle debug --fetch-external` mixes compilation options for different contracts when on Node 12",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 971535002,
      "node_id": "MDU6TGFiZWw5NzE1MzUwMDI=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Debugger",
      "name": "Debugger",
      "color": "7911ad",
      "default": false,
      "description": ""
    },
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-12T06:31:09Z",
  "updated_at": "2022-10-20T20:32:36Z",
  "closed_at": "2022-10-20T20:32:35Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nWhen using `truffle debug --fetch-external` on Node 12, compilation options will be carried over inbetween contracts.  This means that some contracts will get compiled using the wrong options; this can result in compilation failure, or it can result in the compilation being sucessful but the debugger then failing to recognize the contract.\r\n\r\nThe problem seems to stem from the line `options = Config.default().merge(options)` in `sources()` in `compile-solidity`; for some reason, on Node 12, this call to `merge` modifies the `config` object in `fetch-and-compile` (which doesn't even get passed to `Compile.sources()`!).  Since this doesn't happen on Node 14, this is presumably a bug in Node; nonetheless, we might want to figure out some workaround here so that things will work on Node 12.\r\n\r\n## Steps to Reproduce\r\n\r\nYou can reproduce this error with the same example from #4616, except you use node 12, rather than node 14.  And you don't need to advance into the contract once you've started up the debugger.\r\n\r\n## Expected results\r\n\r\nIf you use node 14, which doesn't have this issue, on starting up the debugger you'll see\r\n\r\n```\r\nâœ” Getting and compiling external sources...\r\nâœ” Gathering information about your project and the transaction...\r\n\r\nAddresses affected:\r\n 0xC558F600B34A5f69dD2f0D06Cb8A88d829B7420a - UniswapV2Pair\r\n 0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32 - MiniMeToken\r\n 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 - WETH9\r\n 0xf73a1260d222f447210581DDf212D915c09a3249 - AppProxyUpgradeable\r\n 0xb8FFC3Cd6e7Cf5a098A1c92F48009765B24088Dc - KernelProxy\r\n 0x2b33CF282f867A7FF693A66e11B0FcC5552e4425 - Kernel\r\n 0xde3A93028F2283cc28756B3674BD657eaFB992f4 - TokenManager\r\n 0x0000000000004946c0e9F43F4Dee607b0eF1fA1c - ChiToken\r\n 0x0df6Ddf485395fd174ecd35acBac1e8476c89d12(UNKNOWN)\r\n 0x971b3eB9913093797d650D978Fa1E52E244Cce1a(UNKNOWN)\r\n 0x63CA114093159628070b24dC40C1b53c28dFC4ff(UNKNOWN)\r\n 0xFC45eE420599e0cC3c241273F50d9cF7e294aF2e(UNKNOWN)\r\n 0xE09a59A19C34E25c9E8783FBB45a2461E4C280D5(UNKNOWN)\r\n 0x000000bd31c24A2bd2835028c8F1E4D9d3f37108(UNKNOWN)\r\n```\r\n\r\n## Actual Results\r\n\r\nIf you've correctly reproduced the issue, you'll instead see\r\n\r\n```\r\nâš  Errors occurred while compiling sources for addresses 0x0000000000004946c0e9F43F4Dee607b0eF1fA1c.\r\nâœ” Gathering information about your project and the transaction...\r\n\r\nAddresses affected:\r\n 0xC558F600B34A5f69dD2f0D06Cb8A88d829B7420a - UniswapV2Pair\r\n 0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32(UNKNOWN)\r\n 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2 - WETH9\r\n 0xf73a1260d222f447210581DDf212D915c09a3249(UNKNOWN)\r\n 0xb8FFC3Cd6e7Cf5a098A1c92F48009765B24088Dc(UNKNOWN)\r\n 0x2b33CF282f867A7FF693A66e11B0FcC5552e4425(UNKNOWN)\r\n 0xde3A93028F2283cc28756B3674BD657eaFB992f4(UNKNOWN)\r\n 0x0000000000004946c0e9F43F4Dee607b0eF1fA1c(UNKNOWN)\r\n 0x0df6Ddf485395fd174ecd35acBac1e8476c89d12(UNKNOWN)\r\n 0x971b3eB9913093797d650D978Fa1E52E244Cce1a(UNKNOWN)\r\n 0x63CA114093159628070b24dC40C1b53c28dFC4ff(UNKNOWN)\r\n 0xFC45eE420599e0cC3c241273F50d9cF7e294aF2e(UNKNOWN)\r\n 0xE09a59A19C34E25c9E8783FBB45a2461E4C280D5(UNKNOWN)\r\n 0x000000bd31c24A2bd2835028c8F1E4D9d3f37108(UNKNOWN)\r\n```\r\n\r\nNotice how one address failed to compile, while lots of others (that get recognized on Node 14) instead get marked as unknown.  This is because they were compiled with the wrong options; more specifically, they were compiled using options carried over from other contracts in the transaction.\r\n\r\n## Environment\r\n\r\n* Truffle version (`truffle version`): 5.4.28\r\n* node version (`node --version`): 12.22.9",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1286111791",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4617#issuecomment-1286111791",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4617",
    "id": 1286111791,
    "node_id": "IC_kwDOAkfq-c5MqIIv",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-20T20:32:35Z",
    "updated_at": "2022-10-20T20:32:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "We no longer support node 12 so I'm closing this!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1286111791/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
