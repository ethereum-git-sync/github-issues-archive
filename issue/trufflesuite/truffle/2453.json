{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2453",
  "id": 507157696,
  "node_id": "MDU6SXNzdWU1MDcxNTc2OTY=",
  "number": 2453,
  "title": "\"truffle test\" failing while \"../\" within \"contracts_build_directory\" in \"truffle-config.js\"",
  "user": {
    "login": "PyrateAkananto",
    "id": 11444373,
    "node_id": "MDQ6VXNlcjExNDQ0Mzcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11444373?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PyrateAkananto",
    "html_url": "https://github.com/PyrateAkananto",
    "followers_url": "https://api.github.com/users/PyrateAkananto/followers",
    "following_url": "https://api.github.com/users/PyrateAkananto/following{/other_user}",
    "gists_url": "https://api.github.com/users/PyrateAkananto/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PyrateAkananto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PyrateAkananto/subscriptions",
    "organizations_url": "https://api.github.com/users/PyrateAkananto/orgs",
    "repos_url": "https://api.github.com/users/PyrateAkananto/repos",
    "events_url": "https://api.github.com/users/PyrateAkananto/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PyrateAkananto/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-10-15T10:35:35Z",
  "updated_at": "2019-10-16T14:33:29Z",
  "closed_at": "2019-10-16T14:33:28Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nThe command `truffle test` fails and creates error messages if the the value `contracts_build_directory` inside `truffle-config.js` uses a directory \"outside\" the current directory, for example `contracts_build_directory: \"./../somewhere/build\"` (note the `/../` part).\r\n\r\nFailing or working, I cannot see `truffle test` generating `.json` files and using the specified directory in any way.\r\n\r\nAll other Truffle commands do not have this issue.\r\n\r\n## Steps to Reproduce\r\n\r\nCall `truffle test` with `truffle-config.js` containing `/../` within the value for `contracts_build_directory`.\r\n\r\n## Expected Behavior\r\n\r\n`truffle test` working without error messages.\r\n\r\n## Actual Results\r\n\r\n`truffle test` fails with this error message:\r\n\r\n```\r\nCompiling your contracts...\r\n===========================\r\nSyntaxError: Unexpected token P in JSON at position 0\r\n    at JSON.parse (<anonymous>)\r\n    at filesData.map.data (E:\\myProjectsJavaScript\\InnovationEconomyCryptoGame2019\\smartcontracts\\node_modules\\truffle\\build\\webpack:\\packages\\core\\lib\\testing\\testsource.js:62:1)\r\n    at Array.map (<anonymous>)\r\n    at Promise.all.then.filesData (E:\\myProjectsJavaScript\\InnovationEconomyCryptoGame2019\\smartcontracts\\node_modules\\truffle\\build\\webpack:\\packages\\core\\lib\\testing\\testsource.js:62:1)\r\nTruffle v5.0.39 (core: 5.0.39)\r\nNode v10.16.3\r\n```\r\n\r\n## Environment\r\n\r\n* Windows 10 64 Bit German\r\n* Truffle v5.0.39 (core: 5.0.39)\r\n* Solidity - ^0.5.10 (solc-js)\r\n* Node v10.16.3\r\n* npm v6.9.0\r\n* [nvm](https://github.com/coreybutler/nvm-windows) v1.1.7\r\n* Web3.js v1.2.1\r\n\r\n## Workaround\r\n\r\nMy current workaround is the following code within `truffle-config.js`:\r\n```javascript\r\n  get contracts_build_directory() {\r\n    if (process.argv.length >= 3 && process.argv[2] === \"test\") {\r\n      return \"./whatever-because-it-is-ignored-anyway\";\r\n    } else {\r\n      return \"./../somewhere/build\";\r\n    }\r\n  },\r\n```\r\n",
  "closed_by": {
    "login": "PyrateAkananto",
    "id": 11444373,
    "node_id": "MDQ6VXNlcjExNDQ0Mzcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11444373?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PyrateAkananto",
    "html_url": "https://github.com/PyrateAkananto",
    "followers_url": "https://api.github.com/users/PyrateAkananto/followers",
    "following_url": "https://api.github.com/users/PyrateAkananto/following{/other_user}",
    "gists_url": "https://api.github.com/users/PyrateAkananto/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PyrateAkananto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PyrateAkananto/subscriptions",
    "organizations_url": "https://api.github.com/users/PyrateAkananto/orgs",
    "repos_url": "https://api.github.com/users/PyrateAkananto/repos",
    "events_url": "https://api.github.com/users/PyrateAkananto/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PyrateAkananto/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542217889",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2453#issuecomment-542217889",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
    "id": 542217889,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjIxNzg4OQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T13:41:54Z",
    "updated_at": "2019-10-15T13:41:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the writeup @PyrateAkananto! I'll look into this soon!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542217889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542240630",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2453#issuecomment-542240630",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
    "id": 542240630,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjI0MDYzMA==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T14:27:50Z",
    "updated_at": "2019-10-15T14:27:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@PyrateAkananto I can't seem to duplicate your issue. I set the `contracts_build_directory` to `../build` but it doesn't fail like you describe above. If you have a toy project that I could try and clone to investigate it would be appreciated!\r\n\r\nHowever, when you run `truffle test` it creates it's own version of the artifacts and copies them to a temporary directory. It then deletes them afterwards. That is why you are not seeing the results of those compilations saved anywhere after running the tests.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542240630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542241318",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2453#issuecomment-542241318",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
    "id": 542241318,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjI0MTMxOA==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T14:29:15Z",
    "updated_at": "2019-10-15T14:29:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually, try deleting your `build` folder. The error that you mentioned seems to indicate that your artifacts are messed up somehow. See if that solves your problem.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542241318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542251962",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2453#issuecomment-542251962",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
    "id": 542251962,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjI1MTk2Mg==",
    "user": {
      "login": "PyrateAkananto",
      "id": 11444373,
      "node_id": "MDQ6VXNlcjExNDQ0Mzcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11444373?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PyrateAkananto",
      "html_url": "https://github.com/PyrateAkananto",
      "followers_url": "https://api.github.com/users/PyrateAkananto/followers",
      "following_url": "https://api.github.com/users/PyrateAkananto/following{/other_user}",
      "gists_url": "https://api.github.com/users/PyrateAkananto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PyrateAkananto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PyrateAkananto/subscriptions",
      "organizations_url": "https://api.github.com/users/PyrateAkananto/orgs",
      "repos_url": "https://api.github.com/users/PyrateAkananto/repos",
      "events_url": "https://api.github.com/users/PyrateAkananto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PyrateAkananto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T14:50:56Z",
    "updated_at": "2019-10-15T14:50:56Z",
    "author_association": "NONE",
    "body": "First of all, thank you for your help!\r\n\r\nIt seems the `contracts_build_directory` folder has to be empty or at least contain no other files than the generated `.json` files. I had a `.keep` file in that directory, for version control to keep this directory. `truffle test` seems to try to parse all files within that folder as if they are JSON files. If I delete my `.keep` file, it works fine. But still only `truffle test` is having this issue. I'm still not sure why it needs that directory or why it parses all the files in it, not just `.json` files.\r\n\r\nBy the way the error message gets a little bit more helpful if the file, for example `dummy.txt` actually contains valid JSON, for example `{ }`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542251962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542254265",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2453#issuecomment-542254265",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
    "id": 542254265,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjI1NDI2NQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T14:55:32Z",
    "updated_at": "2019-10-15T14:55:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, it says you are on `5.0.39`. In `5.0.40` there was a bug fixed related to problems with empty or near empty test folders. Try upgrading :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542254265/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542731618",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2453#issuecomment-542731618",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2453",
    "id": 542731618,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjczMTYxOA==",
    "user": {
      "login": "PyrateAkananto",
      "id": 11444373,
      "node_id": "MDQ6VXNlcjExNDQ0Mzcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11444373?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PyrateAkananto",
      "html_url": "https://github.com/PyrateAkananto",
      "followers_url": "https://api.github.com/users/PyrateAkananto/followers",
      "following_url": "https://api.github.com/users/PyrateAkananto/following{/other_user}",
      "gists_url": "https://api.github.com/users/PyrateAkananto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PyrateAkananto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PyrateAkananto/subscriptions",
      "organizations_url": "https://api.github.com/users/PyrateAkananto/orgs",
      "repos_url": "https://api.github.com/users/PyrateAkananto/repos",
      "events_url": "https://api.github.com/users/PyrateAkananto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PyrateAkananto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T14:33:28Z",
    "updated_at": "2019-10-16T14:33:28Z",
    "author_association": "NONE",
    "body": "I upgraded Truffle from `5.0.39` to `5.0.40` but its behavior is exactly the same regarding this problem.\r\n\r\nI will close this issue because its initial error description (directory outside current directory) is totally different from the actual problem (directory not empty).\r\n\r\nBecause I consider the behavior of `truffle test` to parse all the files, even those not related to Truffle, a bug, I just created new issue, with a better description: https://github.com/trufflesuite/truffle/issues/2464",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542731618/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
