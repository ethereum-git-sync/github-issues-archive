{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2134",
  "id": 461112974,
  "node_id": "MDU6SXNzdWU0NjExMTI5NzQ=",
  "number": 2134,
  "title": "Truffle fails due to presence of swap files in build folder",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 230393329,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjk=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/help%20wanted",
      "name": "help wanted",
      "color": "159818",
      "default": true,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "CruzMolina",
    "id": 7537712,
    "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/CruzMolina",
    "html_url": "https://github.com/CruzMolina",
    "followers_url": "https://api.github.com/users/CruzMolina/followers",
    "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
    "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
    "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
    "repos_url": "https://api.github.com/users/CruzMolina/repos",
    "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
    "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-06-26T18:15:10Z",
  "updated_at": "2019-08-04T03:23:42Z",
  "closed_at": "2019-08-04T03:23:42Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nIf you have an artifact file open in a text editor that creates swap files or backup files, various truffle commands will attempt to read this as JSON and then fail when it's improperly formatted.  (I've noticed this issue specifically with Vim; I don't know offhand how it would differ for other text editors.)  It comes up with both `truffle migrate` and `truffle console`, for instance.\r\n\r\nNote: This seems to have been raised as an issue before regarding `.DS_Store` files on Macintosh.  So I guess it's not just swapfiles, but other hidden files that may pop up without deliberate user action.\r\n\r\n## Expected Behavior\r\n\r\nTruffle should have some way of recognizing naming conventions for such files and skipping them.  Actually, it might just suffice to skip all files with names not ending in `.json`.  Then we don't have to worry about the precise naming conventions.  (We could also skip all hidden files or dotfiles as well, perhaps.)\r\n\r\n## Actual Results\r\n\r\nAn example, with `truffle migrate`:\r\n\r\n```\r\nsniffnoy@hyperpotato ~/truffle/test-cases/malformed-test $ truffle-next migrate\r\n\r\nCompiling your contracts...\r\n===========================\r\n> Everything is up to date, there is nothing to compile.\r\n\r\nError: Could not find built Migrations contract: Unexpected token b in JSON at position 0\r\n    at Object.lastCompletedMigration (/home/sniffnoy/truffle/truffle/packages/truffle-migrate/index.js:190:13)\r\n    at Promise (/home/sniffnoy/truffle/truffle/packages/truffle-migrate/index.js:227:19)\r\n    at new Promise (<anonymous>)\r\n    at Object.needsMigrating (/home/sniffnoy/truffle/truffle/packages/truffle-migrate/index.js:224:12)\r\n    at runMigrations (/home/sniffnoy/truffle/truffle/packages/truffle-core/lib/commands/migrate.js:238:46)\r\n    at Contracts.compile.then (/home/sniffnoy/truffle/truffle/packages/truffle-core/lib/commands/migrate.js:204:17)\r\n    at process._tickCallback (internal/process/next_tick.js:68:7)\r\nTruffle (unbundled) (core: 5.0.24)\r\nNode v10.15.3\r\n```\r\n\r\n(Here I have `MalformedTest.json` open in Vim.)\r\n\r\nHere's a different error caused by this, in `truffle console`:\r\n\r\n```\r\nsniffnoy@hyperpotato ~/truffle/test-cases/malformed-test $ truffle-next console\r\nUnexpected error: Cannot provision contracts while instantiating the console.\r\nError: Cannot parse .MalformedTest.json.swp: Unexpected token b in JSON at position 0\r\n    at /home/sniffnoy/truffle/truffle/packages/truffle-core/lib/console.js:109:19\r\n    at FSReqWrap.readFileAfterClose [as oncomplete] (internal/fs/read_file_context.js:53:3)\r\ntruffle(development)> \r\n```\r\n\r\nOf course, if I close the file, the swapfile goes away and everything is fine.",
  "closed_by": {
    "login": "CruzMolina",
    "id": 7537712,
    "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/CruzMolina",
    "html_url": "https://github.com/CruzMolina",
    "followers_url": "https://api.github.com/users/CruzMolina/followers",
    "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
    "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
    "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
    "repos_url": "https://api.github.com/users/CruzMolina/repos",
    "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
    "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134/reactions",
    "total_count": 3,
    "+1": 0,
    "-1": 0,
    "laugh": 1,
    "hooray": 2,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/505989594",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2134#issuecomment-505989594",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2134",
    "id": 505989594,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNTk4OTU5NA==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-26T18:20:23Z",
    "updated_at": "2019-06-26T18:20:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Good find @haltman-at !",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/505989594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
