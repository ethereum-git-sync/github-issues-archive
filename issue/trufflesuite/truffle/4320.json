{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4320",
  "id": 1003758889,
  "node_id": "I_kwDOAkfq-c471CUp",
  "number": 4320,
  "title": "Truffle 5.4.11 gas exceeded the block limit on Optimism Kovan",
  "user": {
    "login": "matYang",
    "id": 2754307,
    "node_id": "MDQ6VXNlcjI3NTQzMDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2754307?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matYang",
    "html_url": "https://github.com/matYang",
    "followers_url": "https://api.github.com/users/matYang/followers",
    "following_url": "https://api.github.com/users/matYang/following{/other_user}",
    "gists_url": "https://api.github.com/users/matYang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matYang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matYang/subscriptions",
    "organizations_url": "https://api.github.com/users/matYang/orgs",
    "repos_url": "https://api.github.com/users/matYang/repos",
    "events_url": "https://api.github.com/users/matYang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matYang/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-09-22T04:09:56Z",
  "updated_at": "2021-12-22T19:23:55Z",
  "closed_at": "2021-12-22T19:23:55Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've [opened a support ticket](https://trufflesuite.zendesk.com/hc/en-us/requests/new) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen trying to deploy a new contract to Optimism Kovan with Truffle 5.4.11, I am consistently getting\r\n\r\n```\r\nError:  *** Deployment Failed ***\r\n\r\n\"SimpleStorage\" exceeded the block limit ...\r\n```\r\n\r\nIf I do not set a gas limit manually, I get\r\n```\r\n\"SimpleStorage\" exceeded the block limit (using Truffle's estimate).\r\n   * Block limit: 11000000 (0xa7d8c0)\r\n   * Report this error in the Truffle issues on Github. It should not happen.\r\n   * Try: setting gas manually in 'truffle-config.js' or as parameter to 'deployer.deploy'\r\n```\r\n\r\nIf I set a gas limit manually, for example 4999999, I get\r\n```\r\n\"SimpleStorage\" exceeded the block limit (with a gas value you set).\r\n   * Block limit:  11000000 (0xa7d8c0)\r\n   * Gas sent:     4999999 (0x4c4b3f)\r\n   * Try:\r\n      + Sending less gas.\r\n      + Setting a higher network block limit if you are on a\r\n        private network or test client (like ganache).\r\n```\r\n\r\n\r\n## Steps to Reproduce\r\n\r\n1. Go to https://github.com/truffle-box/optimism-box\r\n2. Do truffle unbox optimism\r\n3. Set `KOVAN_MNEMONIC` and `INFURA_KEY`\r\n4. Run `truffle migrate --config truffle-config.ovm.js --network optimistic_kovan`\r\n5. Observe contract is deployed successfully\r\n6. Edit ./contracts/optimism/SimpleStorage.sol, change a few lines, e.g. change `storedData = x`; to `storedData = x + 1;`\r\n7. Run `truffle migrate --config truffle-config.ovm.js --network optimistic_kovan` again\r\n8. Observe failure as specified above\r\n\r\n## Expected Behavior\r\n\r\nContract gets deployed successfully when Truffle is estimating gas, or at the very least, contract is deployed successfully with a gas limit set manually.\r\n\r\n## Actual Results\r\n\r\nVery confusing error message, how does 4999999 exceed block gas limit of 11000000\r\n\r\n## Environment\r\n\r\n* Operating System: Mac OS Big Sur\r\n* Ethereum client: OVM ^0.7.6, also tried 0.6.12 same issue\r\n* Truffle version (`truffle version`): 5.4.11\r\n* node version (`node --version`): v14.17.3\r\n* npm version (`npm --version`): 6.14.13\r\n",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/924572416",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4320#issuecomment-924572416",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320",
    "id": 924572416,
    "node_id": "IC_kwDOAkfq-c43G9sA",
    "user": {
      "login": "matYang",
      "id": 2754307,
      "node_id": "MDQ6VXNlcjI3NTQzMDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2754307?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matYang",
      "html_url": "https://github.com/matYang",
      "followers_url": "https://api.github.com/users/matYang/followers",
      "following_url": "https://api.github.com/users/matYang/following{/other_user}",
      "gists_url": "https://api.github.com/users/matYang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matYang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matYang/subscriptions",
      "organizations_url": "https://api.github.com/users/matYang/orgs",
      "repos_url": "https://api.github.com/users/matYang/repos",
      "events_url": "https://api.github.com/users/matYang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matYang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T04:25:02Z",
    "updated_at": "2021-09-22T04:25:02Z",
    "author_association": "NONE",
    "body": "This may be related to https://github.com/ethereum-optimism/optimism/issues/1415\r\n\r\nI was hoping Truffle 5.4.11 should have fixed the issue, because calling eth_estimateGas should just make gas limit work for Optimism, I've been using Remix & Metamask to deploy to Optimism Kovan without any issues, while Truffle fails",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/924572416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/925178756",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4320#issuecomment-925178756",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320",
    "id": 925178756,
    "node_id": "IC_kwDOAkfq-c43JRuE",
    "user": {
      "login": "fainashalts",
      "id": 8952139,
      "node_id": "MDQ6VXNlcjg5NTIxMzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8952139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fainashalts",
      "html_url": "https://github.com/fainashalts",
      "followers_url": "https://api.github.com/users/fainashalts/followers",
      "following_url": "https://api.github.com/users/fainashalts/following{/other_user}",
      "gists_url": "https://api.github.com/users/fainashalts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fainashalts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fainashalts/subscriptions",
      "organizations_url": "https://api.github.com/users/fainashalts/orgs",
      "repos_url": "https://api.github.com/users/fainashalts/repos",
      "events_url": "https://api.github.com/users/fainashalts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fainashalts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T18:26:03Z",
    "updated_at": "2021-09-22T18:26:03Z",
    "author_association": "MEMBER",
    "body": "Hi @matYang there is one additional issue on the Optimism side regarding how they calculate the Optimistic Ethereum blockLimit. To bypass from the Truffle side, add `YourContract.gasMultiplier = 0.9` to your migration files. Optimism is coming out with changes in October that will hopefully fix this completely and remove the need for the `gasMultiplier` line.\r\n\r\nPlease let me know if that helps!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/925178756/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/925385386",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4320#issuecomment-925385386",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320",
    "id": 925385386,
    "node_id": "IC_kwDOAkfq-c43KEKq",
    "user": {
      "login": "matYang",
      "id": 2754307,
      "node_id": "MDQ6VXNlcjI3NTQzMDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2754307?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matYang",
      "html_url": "https://github.com/matYang",
      "followers_url": "https://api.github.com/users/matYang/followers",
      "following_url": "https://api.github.com/users/matYang/following{/other_user}",
      "gists_url": "https://api.github.com/users/matYang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matYang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matYang/subscriptions",
      "organizations_url": "https://api.github.com/users/matYang/orgs",
      "repos_url": "https://api.github.com/users/matYang/repos",
      "events_url": "https://api.github.com/users/matYang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matYang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T22:54:01Z",
    "updated_at": "2021-09-22T23:01:38Z",
    "author_association": "NONE",
    "body": "So I tried \r\n\r\n`SimpleStorage.gasMultiplier = 0.9;`\r\n\r\nNot sure why but it is still giving me the same exceed block gas limit error\r\n\r\nAs noted in the re-pro steps, what is werid is that, the SimpleStorage contract as is can be deployed, but after a 1 line change, such as x  to x+1, it fails, so do all of my custom contracts that can be deployed with Remix",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/925385386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/942664314",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4320#issuecomment-942664314",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320",
    "id": 942664314,
    "node_id": "IC_kwDOAkfq-c44L-p6",
    "user": {
      "login": "fainashalts",
      "id": 8952139,
      "node_id": "MDQ6VXNlcjg5NTIxMzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8952139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fainashalts",
      "html_url": "https://github.com/fainashalts",
      "followers_url": "https://api.github.com/users/fainashalts/followers",
      "following_url": "https://api.github.com/users/fainashalts/following{/other_user}",
      "gists_url": "https://api.github.com/users/fainashalts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fainashalts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fainashalts/subscriptions",
      "organizations_url": "https://api.github.com/users/fainashalts/orgs",
      "repos_url": "https://api.github.com/users/fainashalts/repos",
      "events_url": "https://api.github.com/users/fainashalts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fainashalts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T19:49:32Z",
    "updated_at": "2021-10-13T19:49:32Z",
    "author_association": "MEMBER",
    "body": "@matYang last time I tried this I was able to get it deployed. I just wanted to check in and see if this is still an issue! \r\n\r\nWe are eagerly awaiting the Optimism v2 release this month, at which time I will run through all the gas estimation stuff in detail and see if there is anything we need to change on the Truffle side. Thanks so much for your patience!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/942664314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/999810602",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4320#issuecomment-999810602",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4320",
    "id": 999810602,
    "node_id": "IC_kwDOAkfq-c47l-Yq",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T19:23:55Z",
    "updated_at": "2021-12-22T19:23:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, we're going to close this for issue maintenance; @matYang, please let us know if there's still a problem here and we'll see what we can do.  Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/999810602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
