{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3130",
  "id": 647327546,
  "node_id": "MDU6SXNzdWU2NDczMjc1NDY=",
  "number": 3130,
  "title": "Bug in @trufflesuite/web3-provider-engine 14.0.6 (dependency of @truffle/hdwallet-provider 1.0.36 where getBlockByNumber function of the blockTracker event listener sometimes returns a null block object and crashes applications with error `TypeError: Cannot read property 'number' of null`",
  "user": {
    "login": "ltfschoen",
    "id": 6226175,
    "node_id": "MDQ6VXNlcjYyMjYxNzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6226175?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ltfschoen",
    "html_url": "https://github.com/ltfschoen",
    "followers_url": "https://api.github.com/users/ltfschoen/followers",
    "following_url": "https://api.github.com/users/ltfschoen/following{/other_user}",
    "gists_url": "https://api.github.com/users/ltfschoen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ltfschoen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ltfschoen/subscriptions",
    "organizations_url": "https://api.github.com/users/ltfschoen/orgs",
    "repos_url": "https://api.github.com/users/ltfschoen/repos",
    "events_url": "https://api.github.com/users/ltfschoen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ltfschoen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2020-06-29T12:21:54Z",
  "updated_at": "2020-07-01T19:52:29Z",
  "closed_at": "2020-06-29T22:43:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nTruffle's fork of the Metamask web3-provider-engine doesn't include changes such as adding a `_getBlockByNumberWithRetry` and catering for when the block tracker event listener occasionally returns a block object that has a `null` value. As a result, when you use the dependency \"@truffle/hdwallet-provider\": \"^1.0.36\" (which depends on \"@trufflesuite/web3-provider-engine\" \"14.0.6\") in your project, it will eventually crash.\r\n\r\n## Steps to Reproduce\r\n\r\nIt requires patience to reproduce because you have to wait until `_getBlockByNumber` eventually returns a `null` value, which could take over an hour.\r\n\r\nTo reproduce, clone my faucet project https://github.com/DataHighway-DHX/faucet, set it up by following the instructions in the README, which include installing Node.js 14.4.0 and Yarn.\r\n\r\nThen modify the dependencies to add some console.logs for debugging by editing DataHighway-DHX/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js, and modifying the code by adding the section shown below between `// MODIFICATIONS START HERE` and `// MODIFICATIONS END HERE`:\r\n```\r\n  self._blockTracker.on('latest', (blockNumber) => {\r\n    // get block body\r\n    self._getBlockByNumber(blockNumber, (err, block) => {\r\n      if (err) {\r\n        this.emit('error', err)\r\n        return\r\n      }\r\n      // MODIFICATIONS START HERE\r\n      if (!block) {\r\n        console.error('NO BLOCK: ', typeof block);\r\n      }\r\n      console.log('BLOCK: ', block);\r\n      // MODIFICATIONS END HERE\r\n      const bufferBlock = toBufferBlock(block)\r\n```\r\nThen run the code:\r\n```\r\nyarn global add nodemon;\r\nDEBUG=app yarn dev;\r\n```\r\nAnd watch the terminal logs until the output becomes\r\n```\r\n[0] BLOCK: {\r\n[0]   difficulty: '0x9bdeaf63',\r\n[0]   extraData: '0x74657374',\r\n[0]   gasLimit: '0x7a121d',\r\n[0]   gasUsed: '0x20c1c',\r\n[0]   hash: '0x593679a19b9cc02e52d819d9256d2c5e9a131cdecda98ef7dac144b240397720',\r\n[0]   logsBloom: '0x00000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000',\r\n[0]   miner: '0xbbf5029fd710d227630c8b7d338051b8e76d50b3',\r\n[0]   mixHash: '0x97232baa933ebee13b4e14447ea8114bb8fc5652ee5dfc35caca3a4afb0f4ebd',\r\n[0]   nonce: '0x0c736d40080dda7b',\r\n[0]   number: '0x7d02c5',\r\n[0]   parentHash: '0xbfc6dfaed1488da8edd72b18e9f770c0911b3a9f5edce5294e306a474824eb97',\r\n[0]   receiptsRoot: '0xf279f211e14db07e36961789f6ba968f94b7b2413b3df218ca98effeeaab29a2',\r\n[0]   sha3Uncles: '0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347',\r\n[0]   size: '0x36b',\r\n[0]   stateRoot: '0x042ad505ab14e8dfb0bcba694418ea1b1a535ae4cbab3d04e69f0226e7bef091',\r\n[0]   timestamp: '0x5ef9cb84',\r\n[0]   totalDifficulty: '0x6cdaa9a19c28f4',\r\n[0]   transactions: [\r\n[0]     '0x86a58956c34fe668f0a9b3031b424939eb014112e351f7bd09140e62ab667ddf',\r\n[0]     '0x8d37315790bf1ec21a27bf2acbac464035d18ec838e768235dd588d40956622b'\r\n[0]   ],\r\n[0]   transactionsRoot: '0x3bc040f4ab29394a3000efb4f88b6d6933b760d3da7e0bcd08d90b7b81ddf510',\r\n[0]   uncles: []\r\n[0] }\r\n[0] NO BLOCK: object\r\n[0] BLOCK: null\r\n[0] \r\n[0] /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js:223\r\n[0]     number:           ethUtil.toBuffer(jsonBlock.number),\r\n[0]                                                  ^\r\n[0] TypeError: Cannot read property 'number' of null\r\n[0]     at toBufferBlock (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js:223:50)\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js:64:27\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js:140:12\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js:203:9\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/async/internal/once.js:12:16\r\n[0]     at replenish (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/async/internal/eachOfLimit.js:61:25)\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/async/internal/eachOfLimit.js:71:9\r\n[0]     at eachLimit (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/async/eachLimit.js:43:36)\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/async/internal/doLimit.js:9:16\r\n[0]     at end (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/index.js:180:5)\r\n[0]     at /Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/@trufflesuite/web3-provider-engine/subproviders/provider.js:19:5\r\n[0]     at XMLHttpRequest.request.onreadystatechange (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/web3-providers-http/src/index.js:96:13)\r\n[0]     at XMLHttpRequestEventTarget.dispatchEvent (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/xhr2-cookies/xml-http-request-event-target.ts:44:13)\r\n[0]     at XMLHttpRequest._setReadyState (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/xhr2-cookies/xml-http-request.ts:219:8)\r\n[0]     at XMLHttpRequest._onHttpResponseEnd (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/xhr2-cookies/xml-http-request.ts:345:8)\r\n[0]     at IncomingMessage.<anonymous> (/Users/ls/code/src/DataHighway-com/faucet-mining/node_modules/xhr2-cookies/xml-http-request.ts:311:39)\r\n[0] [nodemon] app crashed - waiting for file changes before starting...\r\n```\r\n\r\nThen you've got evidence of where and why it crashed.\r\n\r\n## Expected Behavior\r\n\r\nI expected it not to crash. But now that I know that it crashes because the block object sometimes returns a `null` object, I know that to fix it we just need to make the same changes that MetaMask's web3-provider-engine did. They previously fixed that bug by exiting early from that getBlockByNumber function here https://github.com/MetaMask/web3-provider-engine/blob/master/index.js#L57, and more recently they just replaced the _getBlockByNumber function with a _getBlockByNumberWithRetry function in this commit https://github.com/MetaMask/web3-provider-engine/commit/caaf92bd472c8738d508181d7fd5445df8da432f\r\n\r\n## Actual Results\r\n\r\nRefer to actual results in the above \"Steps to Reproduce\" section\r\n## Environment\r\n\r\n* Operating System: macOS Mojave 10.14.6\r\n* Ethereum client: Infura\r\n* Truffle version (`truffle version`): N/A (\"@truffle/hdwallet-provider\": \"^1.0.36\")\r\n* node version (`node --version`): v14.4.0\r\n* npm version (`npm --version`): 6.14.5\r\n",
  "closed_by": {
    "login": "CruzMolina",
    "id": 7537712,
    "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/CruzMolina",
    "html_url": "https://github.com/CruzMolina",
    "followers_url": "https://api.github.com/users/CruzMolina/followers",
    "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
    "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
    "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
    "repos_url": "https://api.github.com/users/CruzMolina/repos",
    "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
    "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/651209067",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-651209067",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 651209067,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTIwOTA2Nw==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-29T15:55:01Z",
    "updated_at": "2020-06-29T15:55:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Nice sleuthing @ltfschoen ! Glad to hear this was a known issue MM resolved in a later version of `web3-provider-engine`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/651209067/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/651416238",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-651416238",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 651416238,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTQxNjIzOA==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-29T23:13:28Z",
    "updated_at": "2020-06-29T23:13:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Until this goes out in our official weekly release, the fix for this is out at `@truffle/hdwallet-provider@next`.\r\n\r\nPlease give it a shot and let us know if this particular error has been resolved! 🙏 ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/651416238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/651679074",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-651679074",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 651679074,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MTY3OTA3NA==",
    "user": {
      "login": "boolafish",
      "id": 6198848,
      "node_id": "MDQ6VXNlcjYxOTg4NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6198848?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/boolafish",
      "html_url": "https://github.com/boolafish",
      "followers_url": "https://api.github.com/users/boolafish/followers",
      "following_url": "https://api.github.com/users/boolafish/following{/other_user}",
      "gists_url": "https://api.github.com/users/boolafish/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/boolafish/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/boolafish/subscriptions",
      "organizations_url": "https://api.github.com/users/boolafish/orgs",
      "repos_url": "https://api.github.com/users/boolafish/repos",
      "events_url": "https://api.github.com/users/boolafish/events{/privacy}",
      "received_events_url": "https://api.github.com/users/boolafish/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-30T09:31:57Z",
    "updated_at": "2020-06-30T09:31:57Z",
    "author_association": "NONE",
    "body": "just to confirm this works :) \r\nOur deployment start to re-work after using `@truffle/hdwallet-provider@next`",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/651679074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652271132",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652271132",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652271132,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjI3MTEzMg==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T08:22:27Z",
    "updated_at": "2020-07-01T08:22:27Z",
    "author_association": "NONE",
    "body": "Is there something I can do to work around this? I tried to update my package.json file to use a different version of \"@truffle/hdwallet-provider\": \"^1.0.36\".\r\n\r\nIs there something I can do while this is down? ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652271132/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652280793",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652280793",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652280793,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjI4MDc5Mw==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T08:41:16Z",
    "updated_at": "2020-07-01T08:41:16Z",
    "author_association": "NONE",
    "body": "Oh I saw you can do `\"@truffle/hdwallet-provider\": \"next\",` and then run `npm install` Thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652280793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652289239",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652289239",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652289239,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjI4OTIzOQ==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T08:56:57Z",
    "updated_at": "2020-07-01T09:04:42Z",
    "author_association": "NONE",
    "body": "Ah now my script is just hanging instead of breaking. I'm using `npx truffle exec scripts/fund-contract.js --network live` in my chainlink truffle box.\r\n\r\nIt's freezing at `const token = await LinkToken.at(tokenAddress);` The `tokenAddress` seems to be correct when I console.log it for ropsten. The LinkToken is from `const { LinkToken } = require(\"@chainlink/contracts/truffle/v0.4/LinkToken\");`\r\n\r\nNot sure if that is enough information. Sounds like we may have to update the script or the box",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652289239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652474065",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652474065",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652474065,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjQ3NDA2NQ==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T15:05:28Z",
    "updated_at": "2020-07-01T15:06:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @PatrickAlphaC , does the script consistently fail on that line? I assume you're referring to the official box [here](https://github.com/smartcontractkit/box). I'm wondering if the issue you're seeing is related to https://github.com/trufflesuite/truffle/issues/3133. Will take a look and try to reproduce!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652474065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652522211",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652522211",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652522211,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjUyMjIxMQ==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T16:30:17Z",
    "updated_at": "2020-07-01T16:32:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "@PatrickAlphaC following up, the issue you're seeing isn't #3133.\r\n\r\nLooking at the script I believe you're referring to [here](https://github.com/smartcontractkit/box/blob/master/scripts/fund-contract.js)...\r\n\r\nYou'll need to set the provider on `LinkToken` before calling `.at`.\r\nFor example, say you'd like to run the script on `ropsten`....\r\n\r\n```javascript\r\nconst MyContract = artifacts.require('MyContract')\r\nconst { LinkToken } = require('@chainlink/contracts/truffle/v0.4/LinkToken')\r\n\r\nmodule.exports = async callback => {\r\n  const mc = await MyContract.deployed()\r\n  const tokenAddress = await mc.getChainlinkToken()\r\n  LinkToken.setProvider(process.env.RPC_URL) // <-------------------- ropsten infura api url\r\n  const token = await LinkToken.at(tokenAddress)\r\n  console.log('Funding contract:', mc.address)\r\n  const tx = await token.transfer(mc.address, payment)\r\n  callback(tx.tx)\r\n}\r\n```\r\n\r\nWe also expose `web3` with HDWalletProvider loaded in the `truffle exec` context, so instead of `RPC_URL`, you can pass `web3.currentProvider`.\r\n\r\nThe other hiccup is that you'll need to specify the sender in the `token.transfer` call.\r\n\r\nie.\r\n\r\n```javascript\r\n\r\nconst tx = await token.transfer(mc.address, payment, {\r\n  from: web3.currentProvider.addresses[0],\r\n});\r\n```\r\n\r\nIn migration & testing contexts, `truffle` does some magic to require and provision contracts with the provider already set along with default params (happens underneath `artifacts.require`).\r\n\r\nAnd finally... because the script is attempting to interact with contracts already live on the network, I don't believe you'll be able to successfully transfer tokens unless the loaded account/sender already has tokens assigned to it on the live contract.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652522211/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652602489",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652602489",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652602489,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjYwMjQ4OQ==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T19:22:57Z",
    "updated_at": "2020-07-01T19:22:57Z",
    "author_association": "NONE",
    "body": "@CruzMolina thank you so much for this detailed response. With your suggestions it now hangs at the part that you said wouldn't work:\r\n```\r\nconst tx = await token.transfer(mc.address, payment, {\r\n  from: web3.currentProvider.addresses[0],\r\n});\r\n```\r\nI guess I don't understand why this isn't working. \r\n\r\n> because the script is attempting to interact with contracts already live on the network, I don't believe you'll be able to successfully transfer tokens unless the loaded account/sender already has tokens assigned to it on the live contract.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652602489/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652613124",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652613124",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652613124,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjYxMzEyNA==",
    "user": {
      "login": "CruzMolina",
      "id": 7537712,
      "node_id": "MDQ6VXNlcjc1Mzc3MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7537712?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CruzMolina",
      "html_url": "https://github.com/CruzMolina",
      "followers_url": "https://api.github.com/users/CruzMolina/followers",
      "following_url": "https://api.github.com/users/CruzMolina/following{/other_user}",
      "gists_url": "https://api.github.com/users/CruzMolina/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CruzMolina/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CruzMolina/subscriptions",
      "organizations_url": "https://api.github.com/users/CruzMolina/orgs",
      "repos_url": "https://api.github.com/users/CruzMolina/repos",
      "events_url": "https://api.github.com/users/CruzMolina/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CruzMolina/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T19:47:26Z",
    "updated_at": "2020-07-01T19:47:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "@PatrickAlphaC You should be able to see the rpc error bubble up by wrapping the exec script in a `try/catch`\r\n\r\n```javascript\r\n\r\nconst MyContract = artifacts.require(\"MyContract\");\r\nconst { LinkToken } = require(\"@chainlink/contracts/truffle/v0.4/LinkToken\");\r\n\r\nmodule.exports = async (callback) => {\r\n  try {\r\n    const mc = await MyContract.deployed();\r\n    const tokenAddress = await mc.getChainlinkToken();\r\n    LinkToken.setProvider(process.env.RPC_URL);\r\n    const token = await LinkToken.at(tokenAddress);\r\n    console.log(\"Funding contract:\", mc.address);\r\n    const tx = await token.transfer(mc.address, payment, {\r\n      from: web3.currentProvider.addresses[0],\r\n    });\r\n    callback(tx.tx);\r\n  } catch (error) {\r\n    callback(error);\r\n  }\r\n};\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652613124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652615059",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3130#issuecomment-652615059",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3130",
    "id": 652615059,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjYxNTA1OQ==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T19:52:29Z",
    "updated_at": "2020-07-01T19:52:29Z",
    "author_association": "NONE",
    "body": "Very helpful, thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/652615059/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
