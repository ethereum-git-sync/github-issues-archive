{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4119",
  "id": 924284785,
  "node_id": "MDU6SXNzdWU5MjQyODQ3ODU=",
  "number": 4119,
  "title": "Absolute paths in contract metadata",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2021-06-17T20:03:35Z",
  "updated_at": "2021-07-12T20:57:37Z",
  "closed_at": "2021-07-01T23:40:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\nWhen compiling a Solidity project, Truffle gives the compiler absolute paths of all source files. Relative paths are used only for source located in libraries found by the [resolver](https://github.com/trufflesuite/truffle/tree/develop/packages/resolver) (e.g. when importing from `node_modules/`) but the `fs` module of the resolver sometimes creates absolute paths too.\r\n\r\nThe use of absolute paths to refer to Solidity source files makes it harder to reproduce the same bytecode on different machines because they are included in contract metadata,the hash of which is always appended at the end of the bytecode. It also potentially leaks user's local information (the name of the home directory if the contract is stored there).\r\n\r\nTruffle uses [Standard JSON](https://docs.soliditylang.org/en/latest/using-the-compiler.html#compiler-input-and-output-json-description), which [gives it complete control over paths in compiler's VFS](https://docs.soliditylang.org/en/latest/path-resolution.html#initial-content-of-the-virtual-filesystem). The only real constraint is that they should match imports. Using relative paths for files from main project directory should be completely doable according to my knowledge.\r\n\r\nThere are two potential problems:\r\n1. Files located somewhere outside of the main project directory and not being a part of a library.\r\n2. Absolute paths used in imports.\r\n\r\nI see several ways to deal with them, depending on how backwards-compatible this change needs to be:\r\n1. Keep using absolute paths in those cases but warn the user that his file structure may leak into metadata.\r\n2. Add extra features to keep fully support such use cases. For example let the user have multiple project directories (declared in the config file) so that paths can be made relative to them.\r\n3. Disallow them completely (that's for example what Hardhat does).\r\n\r\n## Context\r\nWe're also currently working on solving this problem in the Solidity compiler (https://github.com/ethereum/solidity/issues/11408, https://github.com/ethereum/solidity/issues/11409, https://github.com/ethereum/solidity/issues/11410). Unfortunately this will only help people who use the CLI. Truffle's use of Standard JSON mode isolates it from such changes as it's the path resolver that determines paths here.\r\n\r\nThis problem is also a direct cause of #1621 (and https://github.com/trufflesuite/truffle-compile/issues/77). \r\n\r\n## Steps to Reproduce\r\n```bash\r\nmkdir /tmp/path-test/\r\ncd /tmp/path-test/\r\ntruffle init\r\necho 'module.exports.compilers.solc.version = \"0.8.5\";' >> truffle-config.js\r\n\r\nnpm install @openzeppelin/contracts\r\ntruffle create contract C\r\necho 'import \"../node_modules/@openzeppelin/contracts/utils/Arrays.sol\";' >> contracts/C.sol\r\ntruffle compile\r\ngrep '\\.sol' build/contracts/C.json\r\n```\r\n```json\r\n  \"metadata\": \"{\\\"compiler\\\":{\\\"version\\\":\\\"0.8.5+commit.a4f2e591\\\"},\\\"language\\\":\\\"Solidity\\\",\\\"output\\\":{\\\"abi\\\":[{\\\"inputs\\\":[],\\\"stateMutability\\\":\\\"nonpayable\\\",\\\"type\\\":\\\"constructor\\\"}],\\\"devdoc\\\":{\\\"kind\\\":\\\"dev\\\",\\\"methods\\\":{},\\\"version\\\":1},\\\"userdoc\\\":{\\\"kind\\\":\\\"user\\\",\\\"methods\\\":{},\\\"version\\\":1}},\\\"settings\\\":{\\\"compilationTarget\\\":{\\\"/tmp/path-test/contracts/C.sol\\\":\\\"C\\\"},\\\"evmVersion\\\":\\\"berlin\\\",\\\"libraries\\\":{},\\\"metadata\\\":{\\\"bytecodeHash\\\":\\\"ipfs\\\"},\\\"optimizer\\\":{\\\"enabled\\\":false,\\\"runs\\\":200},\\\"remappings\\\":[]},\\\"sources\\\":{\\\"/tmp/path-test/contracts/C.sol\\\":{\\\"keccak256\\\":\\\"0x832eeeb2ab4434a1868d494358fd6f19436af78d9508d535d1b114fede11aee9\\\",\\\"license\\\":\\\"MIT\\\",\\\"urls\\\":[\\\"bzz-raw://08773a2a54b143ff179fd0103d917109c72a81d8afdec908993f14b3edeeb048\\\",\\\"dweb:/ipfs/QmRu2UgdBpZ8reaYJmdYQhnGc6qACs62SUVYEXt3cM5YM2\\\"]},\\\"/tmp/path-test/node_modules/@openzeppelin/contracts/utils/Arrays.sol\\\":{\\\"keccak256\\\":\\\"0x415faff3ea57601e0d5ebb1f02b0b808a302f8b661ff08d6b4a00c0ee00fa57e\\\",\\\"license\\\":\\\"MIT\\\",\\\"urls\\\":[\\\"bzz-raw://0520bd87d3e82f9761054220cc1c58b92598852d99e5ec090b427f3ae9d67a2c\\\",\\\"dweb:/ipfs/QmYTbyVy45dzkWnjvb9jhgVCfycEiefbATvusxk1Wepz32\\\"]},\\\"/tmp/path-test/node_modules/@openzeppelin/contracts/utils/math/Math.sol\\\":{\\\"keccak256\\\":\\\"0xa1477864def7febd9826918e50482a1ee7068b337b03804a7e0e98c674ac57c2\\\",\\\"license\\\":\\\"MIT\\\",\\\"urls\\\":[\\\"bzz-raw://5bdd8ea2ace1bf716007318f8aca21d32384f0b8b295adac55147270767441fa\\\",\\\"dweb:/ipfs/QmSv235N45Ub3wFXdTLNiS3k4b7FAudtEL8s6g1PwcsCcS\\\"]}},\\\"version\\\":1}\",\r\n  \"source\": \"// SPDX-License-Identifier: MIT\\npragma solidity >=0.4.22 <0.9.0;\\n\\ncontract C {\\n  constructor() public {\\n  }\\n}\\nimport \\\"../node_modules/@openzeppelin/contracts/utils/Arrays.sol\\\";\\n\",\r\n  \"sourcePath\": \"/tmp/path-test/contracts/C.sol\",\r\n    \"absolutePath\": \"/tmp/path-test/contracts/C.sol\",\r\n        \"absolutePath\": \"/tmp/path-test/node_modules/@openzeppelin/contracts/utils/Arrays.sol\",\r\n        \"file\": \"../node_modules/@openzeppelin/contracts/utils/Arrays.sol\",\r\n    \"absolutePath\": \"/tmp/path-test/contracts/C.sol\",\r\n        \"absolutePath\": \"/tmp/path-test/node_modules/@openzeppelin/contracts/utils/Arrays.sol\",\r\n        \"file\": \"../node_modules/@openzeppelin/contracts/utils/Arrays.sol\",\r\n```\r\n\r\n## Expected Behavior\r\n- `/tmp/path-test/contracts/C.sol` should not be present anywhere in metadata. `contracts/C.sol` should be there instead.\r\n- I think that importing files directly from npm's package directories should be disallowed or at least generate a warning. Users should be directed to import `@openzeppelin/contracts/utils/Arrays.sol` instead. Otherwise it's possible for the same file to end up under two different names in the JSON input.\r\n    - **If** such imports are to be allowed, the path in the JSON input should be `node_modules/@openzeppelin/contracts/utils/Arrays.sol` because that's how the compiler would resolve `../node_modules/@openzeppelin/contracts/utils/Arrays.sol` (which is a special, [relative import](https://docs.soliditylang.org/en/latest/path-resolution.html#relative-imports)).\r\n\r\n## Actual Results\r\nAbsolute paths present in metadata.\r\n\r\n## Environment\r\n\r\n* Operating System: Arch Linux\r\n* Truffle version: 5.2.4\r\n* node version: v16.2.0\r\n* npm version: 7.15.1",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/863527272",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-863527272",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 863527272,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzUyNzI3Mg==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T20:05:06Z",
    "updated_at": "2021-06-17T20:05:06Z",
    "author_association": "NONE",
    "body": "@gnidan, @haltman-at, @eggplantzzz would you be up for a call with Solidity team on this topic? We're very interested in solving this problem and would like to hear if there are any obstacles and how we could help.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/863527272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/863529586",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-863529586",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 863529586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzUyOTU4Ng==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T20:08:40Z",
    "updated_at": "2021-06-17T20:08:40Z",
    "author_association": "MEMBER",
    "body": "@cameel getting on a call sounds great. How should I reach out to schedule this?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/863529586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/863531508",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-863531508",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 863531508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzUzMTUwOA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T20:11:21Z",
    "updated_at": "2021-06-17T20:11:21Z",
    "author_association": "NONE",
    "body": "We could discuss details on the #solc-tooling channel. Everyone is there from our side and any others from your team are welcome too :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/863531508/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865191902",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-865191902",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 865191902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTE5MTkwMg==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T16:53:20Z",
    "updated_at": "2021-06-21T16:57:26Z",
    "author_association": "NONE",
    "body": "Here's my summary from the call. Sorry if I missed something. My notes were a bit chaotic unfortunately so please correct me if something's not right. The main takeaways are in bold.\r\n\r\n- Why is Truffle using absolute paths?\r\n    - Truffle needs to uniquely identify files internally.\r\n    - Currently absolute paths are used as canonical IDs.\r\n    - **Truffle could convert them before passing them to the compiler but the requirement is that it has to be able to translate back.**\r\n- Changing paths in artifacts would be a breaking change and would have to wait for Truffle 6. Changing how it interfaces with the compiler is fine though.\r\n- Problems with getting unique paths:\r\n    - Generated files, e.g. for test assertions. These do not exist at all on disk.\r\n    - Packages installed in home directory by EthPM.\r\n- The files in the project directory could have some prefix in the JSON input to be distinguishable.\r\n    - The lack of prefix in `solc` after https://github.com/ethereum/solidity/issues/11411 will make conflicts possible where the same path is present in project dir and in another location. In the compiler this will be solved by issuing an error or warning if a conflicting file actually exists.\r\n    - Why not use a prefix only for generated files and leave everything without one?\r\n        - This would require rewriting imports and Truffle does not do this.\r\n    - First idea: prefix files from project directory with `./` and `../`\r\n        - Problem: such paths will likely be disallowed by the compiler in JSON input in the future.\r\n            - (This was not on the call but please take a look at the new docs for [relative imports](https://docs.soliditylang.org/en/latest/path-resolution.html#relative-imports) for some context)\r\n            - The way such imports interact with `../` used in imports is very unintuitive. If a file is called `../../a.sol` and you put `import \"../b.sol\"` in it, the compiler will look for `../a.sol`, not `../../../a.sol` as one might expect.\r\n    - Other ideas for a prefix: `!/`, `@/`.\r\n        - What if someone has a directory name like that in his project directory?\r\n        - Also, could a npm package have such a name?\r\n            - Probably not.\r\n    - Prefix that looks like a protocol: `source://` or `project://`.\r\n        - **We agreed on `project://`. Truffle will start converting paths inside project directory to relative ones and prepending this prefix.**\r\n    - How will Sourcify deal with the prefix?\r\n- Will prefixed files line up will what Remix or Hardhat do?\r\n    - They will not but it's a separate concern.\r\n    - There's a similar concern with files compiled on the command line with `solc`.\r\n        - The way it is handled in `solc` is being reworked in https://github.com/ethereum/solidity/issues/11409 but there's no provision for such a prefix. **Tentative decision from @chriseth on the call was that the compiler will not be adding such a prefix** (though there might be a way to specify a name for base path in the future).\r\n- Files outside of the project directory imported directly:\r\n    - Could be something like `!/../../../file.sol`.\r\n        - This would not work as expected with import paths containing `../`.\r\n    - Hardhat disallows importing them.\r\n    - **It would be reasonable to disallow these in Truffle too.**",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865191902/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865273843",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-865273843",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 865273843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTI3Mzg0Mw==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T19:04:38Z",
    "updated_at": "2021-06-21T19:04:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "So, as to how this could actually be done -- we actually already do something very similar with Vyper!  When compiling Vyper, we remove the contracts directory, and treat it as the root directory.  (This is for technical reasons involving how Vyper handles imports that I'm going to skip going into right now.)\r\n\r\nSpecifically, this happens in the [collectSources](https://github.com/trufflesuite/truffle/blob/develop/packages/compile-common/src/sources.ts) function here; this is used for both Solidity and Vyper, but that third argument, `contractsDirectory`, is currently used only by Vyper.  ([Here](https://github.com/trufflesuite/truffle/blob/develop/packages/compile-solidity/run.js#L21) is where Solidity invokes it, and [here](https://github.com/trufflesuite/truffle/blob/develop/packages/compile-vyper/vyper-json.js#L19) is where Vyper invokes it.)\r\n\r\nSo, this should be a fairly simple change.  Say we rename the variable from `contractsDirectory` to something like `baseDirectory` (because for Vyper we'd still want to remove the contracts directory, whereas for Solidity it'd be the project directory we want to remove), and then maybe add a fourth argument that gives something to replace that directory with; and then of course just modify the invocation in `compile-solidity` appropriately.\r\n\r\nSo yay, we already mostly have machinery for this!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865273843/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865391851",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-865391851",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 865391851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTM5MTg1MQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T22:43:57Z",
    "updated_at": "2021-06-21T22:43:57Z",
    "author_association": "MEMBER",
    "body": "Appreciate the excellent notes @cameel 🙇 ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865391851/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/872614085",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-872614085",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 872614085,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjYxNDA4NQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T23:40:40Z",
    "updated_at": "2021-07-01T23:40:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, closing this now that the \"project:/\" fix is out.  (We changed it from double-slash to single-slash in #4157 as double-slash was causing problems.)  Let us know if there's more to do here.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/872614085/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/876588311",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-876588311",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 876588311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NjU4ODMxMQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-08T16:43:35Z",
    "updated_at": "2021-07-08T16:43:35Z",
    "author_association": "NONE",
    "body": "Thanks! I did some testing to see if it handles all paths correctly and found a few issues. I think all of these are relatively minor problems:\r\n1. #4161\r\n2. #4163\r\n3. #4165\r\n4. #4166\r\n5. #4167\r\n\r\nAnother one I did not report: the way `..` is resolved in relative imports slightly differs from how compiler does it (see [docs for relative imports](https://docs.soliditylang.org/en/latest/path-resolution.html#relative-imports)). When the path to the file containing an import contains `..` or `.`, a relative import will \"cancel\" these instead of behaving like in an actual filesystem. E.g. `import \"../a.sol\"` inside `/a/b/../c.sol` will resolve into `/a/b/a.sol`, not `/a/a.sol` as one might expect. I could not find any situation where this discrepancy would do anything more than make a weird import not compile so I guess this is not a big issue. I did not report this because, the compiler's behavior here is not very intuitive I think it should be changed. The current behavior will still remain in released versions though so I'm just letting you know about this quirk in case you want to take it into account after all.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/876588311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/877003530",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-877003530",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 877003530,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzAwMzUzMA==",
    "user": {
      "login": "aaronmboyd",
      "id": 13218496,
      "node_id": "MDQ6VXNlcjEzMjE4NDk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/13218496?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aaronmboyd",
      "html_url": "https://github.com/aaronmboyd",
      "followers_url": "https://api.github.com/users/aaronmboyd/followers",
      "following_url": "https://api.github.com/users/aaronmboyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/aaronmboyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aaronmboyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aaronmboyd/subscriptions",
      "organizations_url": "https://api.github.com/users/aaronmboyd/orgs",
      "repos_url": "https://api.github.com/users/aaronmboyd/repos",
      "events_url": "https://api.github.com/users/aaronmboyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aaronmboyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-09T08:12:33Z",
    "updated_at": "2021-07-09T08:12:33Z",
    "author_association": "NONE",
    "body": "Fantastic, this makes verification so much easier, assuming the buidler is using the latest truffle version including the `project://` fix.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/877003530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/878589743",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4119#issuecomment-878589743",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4119",
    "id": 878589743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODU4OTc0Mw==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-12T20:57:37Z",
    "updated_at": "2021-07-12T20:57:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "@aaronmboyd Yes, note we ultimately changed it to `project:/` rather than `project://`, though.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/878589743/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
