{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/988",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/988/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/988/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/988/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/988",
  "id": 330057702,
  "node_id": "MDU6SXNzdWUzMzAwNTc3MDI=",
  "number": 988,
  "title": "How do you export variables to the Truffle console global namespace from an external script?",
  "user": {
    "login": "roschler",
    "id": 4660487,
    "node_id": "MDQ6VXNlcjQ2NjA0ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4660487?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roschler",
    "html_url": "https://github.com/roschler",
    "followers_url": "https://api.github.com/users/roschler/followers",
    "following_url": "https://api.github.com/users/roschler/following{/other_user}",
    "gists_url": "https://api.github.com/users/roschler/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roschler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roschler/subscriptions",
    "organizations_url": "https://api.github.com/users/roschler/orgs",
    "repos_url": "https://api.github.com/users/roschler/repos",
    "events_url": "https://api.github.com/users/roschler/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roschler/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 971680115,
      "node_id": "MDU6TGFiZWw5NzE2ODAxMTU=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Console",
      "name": "Console",
      "color": "fbca04",
      "default": false,
      "description": ""
    },
    {
      "id": 1120350502,
      "node_id": "MDU6TGFiZWwxMTIwMzUwNTAy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/stale",
      "name": "stale",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-06-06T22:40:13Z",
  "updated_at": "2018-11-15T10:10:36Z",
  "closed_at": "2018-11-15T10:10:36Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I created the code below to help me during Truffle console debug sessions with the Zeppelin OS proxy contract library.  Unfortunately I can't figure out how to create a variable that persists into the Truffle console session once my script has exited.  As you can see there is a global variable I declare named `abiProxy`.  However, after the script executes successfully and I find myself back in the Truffle console, `abiProxy` is **not defined**.  I can't export the variable because the Truffle external script interface demands that the only entity allowed in the `module.exports` section is a single function, directly assigned to the `exports` property, that takes a single parameter (i.e. - the _error_ parameter).\r\n\r\nHow do I put things into the Truffle console global namespace so I can use them with my console commands?  In this context, I am loading the Zeppelin OS `Proxy` contract ABI in JSON format so I can use it in a debug session.\r\n\r\n```js\r\n/**\r\n * This file contains scripts to help with debugging Zeppelin OS proxy contracts.\r\n */\r\n\r\n// We need these packages to load the ZOS-LIB JSON files that contain\r\n\t//  the proxy library support contracts.\r\nvar fs = require('fs');\r\n// Read/Write JSON easily to/from files.\r\nvar jsonfile = require('jsonfile');\r\n\r\n// The ABI JSON data for the ZeppelinOS contracts we load.\r\nvar abiProxy = null;\r\n\r\n/**\r\n * Loads the Application Binary Interface (ABI) for the given ZeppelinOS\r\n * \tproxy library contract.\r\n *\r\n * @param {String} contractName - The name of the contract.  Do not add\r\n * \tany path information or the JSON file extension, just the bare contract\r\n * \tname!\r\n *\r\n * @return {*} - Returns the JSON content that was loaded from the specified\r\n * \tcontract's JSON file.\r\n */\r\nfunction loadZosLibContractABI(contractName)\r\n{\r\n\tif (!contractName || contractName.length < 1)\r\n\t\tthrow new Error('The contract name is empty.');\r\n\r\n\tlet jsonFileExt = 'json';\r\n\tlet zosLibBasePath = './node_modules/zos-lib/build/contracts/';\r\n\tlet proxyContractFilename = contractName + '.' + jsonFileExt;\r\n\t\r\n\tlet fullFilePath = zosLibBasePath + proxyContractFilename;\r\n\t\r\n\tconsole.log(\r\n\t\t'Attempting  to load the following ZeppelinOS contract Application Binary Interface (ABI) file: '\r\n\t\t+ fullFilePath);\r\n\t\r\n\t// Check to see if a JSON data file exists for the Proxy contract.\r\n\tif (!fs.existsSync(fullFilePath))\r\n\t{\r\n\t\t// File not found.\r\n\t\tthrow new Error('Unable to find the JSON file containing the Application Binary Interface (ABI) for the following Zeppelin OS contract -> ' + proxyContractFilename);\r\n\t}\r\n\t\r\n\t// Read it and return the result.\r\n\tlet results = jsonfile.readFileSync(fullFilePath);\r\n\t\r\n\tconsole.log('Contract ABI load succeeded.');\r\n\treturn results;\r\n}\r\n \r\nfunction doBasilDebugWork()\r\n{\r\n\tlet errPrefix = '(doBasilDebugWork) ';\r\n\t\r\n\ttry {\r\n\t\tlet proxyContractFilename = 'Proxy';\r\n\t\t\r\n\t\t// Load the Proxy contract ABI from the ZOS-LIB json.  Put it in the global namespace so\r\n\t\t//  other code can find it.\r\n\t\tabiProxy = loadZosLibContractABI(proxyContractFilename)\r\n\t\tconsole.log('ABI data is available in the global variable named: abiProxy');\r\n\t}\r\n\tcatch (err)\r\n\t{\r\n\t\t// Log the error and return a non-zero exit code.\r\n\t\tconsole.error(errPrefix + err.message);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t// No errors occurred.\r\n\treturn 0;\r\n}\r\n\r\n/**'\r\n * See this web page for details on creating a Truffle EXEC command compatible\r\n * \tJavascript function.\r\n *\r\n * @param {Function} callback - This function, given to us by the Truffle console,\r\n * \tmust be called when our script processing is done.  It takes a single error\r\n * \tparameter that if is set to a non-zero value, tells the Truffle console to\r\n * \thalt execution and return a non-zero exit code.  If the error parameter value\r\n * \tis zero, then execution in the Truffle console continues normally.\r\n */\r\nmodule.exports = {function(callback)\r\n{\r\n\tconsole.log('---->>>> Beginning user processing.');\r\n\t\r\n\t// Call our function that does the real work.\r\n\tlet retVal = doBasilDebugWork();\r\n\t\r\n\t// Tell the Truffle console the results of our processing.\r\n\tcallback(retVal);\r\n}\r\n```",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/988/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/988/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/436927212",
    "html_url": "https://github.com/trufflesuite/truffle/issues/988#issuecomment-436927212",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/988",
    "id": 436927212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjkyNzIxMg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-08T09:21:45Z",
    "updated_at": "2018-11-08T09:21:45Z",
    "author_association": "NONE",
    "body": "Thank you for raising this issue! It has been automatically marked as stale because it has not had recent activity. It will be closed in 7 days if no further activity occurs. If you would like to keep this issue open, please respond with information about the current state of this problem.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/436927212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/438987446",
    "html_url": "https://github.com/trufflesuite/truffle/issues/988#issuecomment-438987446",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/988",
    "id": 438987446,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODk4NzQ0Ng==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-15T10:10:07Z",
    "updated_at": "2018-11-15T10:10:07Z",
    "author_association": "NONE",
    "body": "There has been no new activity on this issue since it was marked as stale 7 days ago, so it is being automatically closed.  If you'd like help with this or a different problem, please open a new issue. Thanks!\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/438987446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
