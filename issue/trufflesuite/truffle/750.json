{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/750",
  "id": 288463148,
  "node_id": "MDU6SXNzdWUyODg0NjMxNDg=",
  "number": 750,
  "title": "Using Truffle to deploy to mainnet",
  "user": {
    "login": "skmgoldin",
    "id": 6937058,
    "node_id": "MDQ6VXNlcjY5MzcwNTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6937058?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/skmgoldin",
    "html_url": "https://github.com/skmgoldin",
    "followers_url": "https://api.github.com/users/skmgoldin/followers",
    "following_url": "https://api.github.com/users/skmgoldin/following{/other_user}",
    "gists_url": "https://api.github.com/users/skmgoldin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/skmgoldin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/skmgoldin/subscriptions",
    "organizations_url": "https://api.github.com/users/skmgoldin/orgs",
    "repos_url": "https://api.github.com/users/skmgoldin/repos",
    "events_url": "https://api.github.com/users/skmgoldin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/skmgoldin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-01-15T02:18:47Z",
  "updated_at": "2018-03-22T11:28:47Z",
  "closed_at": "2018-01-18T02:30:04Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nMainnet is different than a test RPC. Mainnet is different from Rinkeby. It's even different from Ropsten! Its differences cause some of Truffle's deploy logic to get in the way of being useful. Here are two things that can break in `truffle publish` because of mainnet's differences:\r\n\r\n`Error: Transaction 0xdeadbeef wasn't processed in 240 seconds!`\r\nEthereum has 15 second block times, sure, but in 2018 taking advantage of those means paying a lot in gas. More often, particularly when deploying contracts, you're more likely to be willing to wait, so you can pay a low gas price. It's _expected_ that in today's congested network, some transactions will take well more than 240 seconds to succeed.\r\n\r\nMy suggestion: drop this timeout completely. Alternatively, make it user-configurable.\r\n\r\n`replacement transaction underpriced`\r\nThis is a less surface-level issue whose root cause I can only speculate at, but I bet I'm right.\r\n\r\nThe uncle rate is high these days. This means it's possible that whatever node Truffle is attached to can receive a block with a transaction Truffle was waiting to see mined in it, but that block can wind up an uncle in actuality. Truffle acts on the \"first contact\" and goes to fetch a nonce from somewhere that has different information on the world state than the node it originally talked to (if you're talking to INFURA, as I often do, it's probable that blocks don't propagate around their nodes instantly). So Truffle sends out a transaction with a nonce that's already in the mempool, and because the transaction gas hasn't changed, this transaction gets rejected by the node for being \"underpriced\" (you have to up the price to do a replace-by-fee for most nodes I believe).\r\n\r\nHere's a full example of what this looks like on the console. It's supposed to skip the contents of migration 2 for mainnet deploys, it's just choking on the save transaction which is supposed to follow:\r\n```\r\nRunning migration: 1_initial_migration.js\r\n  Deploying Migrations...\r\n  ... 0x7977d780417552dab8ab579316274455be65a0e86a609ebf49adca32a12b6895\r\n  Migrations: 0xa62c7f5038060dc25dc233e77ff7e69fa9d84ac7\r\nSaving successful migration to network...\r\n  ... 0xb84beb10b1d19d92607f05d8878f78efe3c195b7935d677d151f0a29fef033f9\r\nSaving artifacts...\r\nRunning migration: 2_optional_for_test.js\r\nskipping optional dev-only deploy of optional contracts.\r\nSaving successful migration to network...\r\nError encountered, bailing. Network state unknown. Review successful transactions manually.\r\nreplacement transaction underpriced\r\n```\r\n\r\nMy suggestion: let the user specify a block depth to wait on a transaction being mined to before sending follow-on transactions, set the default for mainnet to 10.\r\n\r\nThese things make it frustrating to use Truffle to deploy to mainnet, and it _does_ have the potential to be expensive: you have a multi-tx script that runs, but then the migration save transaction gets an underpriced error, for example. ",
  "closed_by": {
    "login": "cgewecke",
    "id": 7332026,
    "node_id": "MDQ6VXNlcjczMzIwMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cgewecke",
    "html_url": "https://github.com/cgewecke",
    "followers_url": "https://api.github.com/users/cgewecke/followers",
    "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
    "organizations_url": "https://api.github.com/users/cgewecke/orgs",
    "repos_url": "https://api.github.com/users/cgewecke/repos",
    "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cgewecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/750/reactions",
    "total_count": 6,
    "+1": 6,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357787952",
    "html_url": "https://github.com/trufflesuite/truffle/issues/750#issuecomment-357787952",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
    "id": 357787952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Nzc4Nzk1Mg==",
    "user": {
      "login": "skmgoldin",
      "id": 6937058,
      "node_id": "MDQ6VXNlcjY5MzcwNTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6937058?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skmgoldin",
      "html_url": "https://github.com/skmgoldin",
      "followers_url": "https://api.github.com/users/skmgoldin/followers",
      "following_url": "https://api.github.com/users/skmgoldin/following{/other_user}",
      "gists_url": "https://api.github.com/users/skmgoldin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skmgoldin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skmgoldin/subscriptions",
      "organizations_url": "https://api.github.com/users/skmgoldin/orgs",
      "repos_url": "https://api.github.com/users/skmgoldin/repos",
      "events_url": "https://api.github.com/users/skmgoldin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skmgoldin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-15T20:59:46Z",
    "updated_at": "2018-01-15T21:26:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "So this is actually really messing up my productivity! I spend 80% of my time on a testRPC and 19% on Rinkeby... But this is kinda blocking me from going to mainnet.\r\n\r\nI've re-written my deploy pipeline to fail less hard if I get `transaction underpriced` errors, but to get around the 240 second timeout I'm just going to have to specify a very high gas price. I could end up paying hundreds of dollars to deploy, when I'd be happy deploying overnight with a lower gas price.\r\n\r\nI think these two things together are kind of an emergent \"bug\" in Truffle given the recent rise of persistent network congestion.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357787952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358479458",
    "html_url": "https://github.com/trufflesuite/truffle/issues/750#issuecomment-358479458",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
    "id": 358479458,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODQ3OTQ1OA==",
    "user": {
      "login": "elie222",
      "id": 3090527,
      "node_id": "MDQ6VXNlcjMwOTA1Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3090527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elie222",
      "html_url": "https://github.com/elie222",
      "followers_url": "https://api.github.com/users/elie222/followers",
      "following_url": "https://api.github.com/users/elie222/following{/other_user}",
      "gists_url": "https://api.github.com/users/elie222/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elie222/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elie222/subscriptions",
      "organizations_url": "https://api.github.com/users/elie222/orgs",
      "repos_url": "https://api.github.com/users/elie222/repos",
      "events_url": "https://api.github.com/users/elie222/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elie222/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-17T23:04:37Z",
    "updated_at": "2018-01-17T23:04:37Z",
    "author_association": "NONE",
    "body": "How do you get it to skip `1_initial_migration.js` when deploying to `rinkeby` or `mainnet`?\r\n\r\nAny ways around all these issues by not using truffle? If so, what would you recommend?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358479458/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358518041",
    "html_url": "https://github.com/trufflesuite/truffle/issues/750#issuecomment-358518041",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
    "id": 358518041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODUxODA0MQ==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-18T02:30:04Z",
    "updated_at": "2018-01-18T02:30:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "@skmgoldin Thanks for pressing for a fix for this. \r\n\r\nFor anyone else running into this problem, Truffle had a bug that accidentally limited the wait time to 4 minutes. It's fixed in the latest release. \r\n\r\nUnfortunately, while looking into this issue, it's been discovered that that `web3` has it's own hardcoded wait limit: 50 blocks. (Code [here](https://github.com/ethereum/web3.js/blob/develop/lib/web3/contract.js#L105-L115)). \r\n\r\nFor the moment anyway, to be mined via `web3` (which Truffle uses), you'll have to set your deployment gas price high enough to get picked up within 50 blocks.\r\n\r\n@elie222 Apparently web3 1.0 does *not* contain this limit. Truffle currently uses `web3 0.x` while `1.0` remains in beta. You could try writing your own deployment script with that? Not sure what else is available but please feel free to list anything you find here. Could be helpful to others. \r\n \r\nClosing, thanks for reporting.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358518041/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/366484984",
    "html_url": "https://github.com/trufflesuite/truffle/issues/750#issuecomment-366484984",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
    "id": 366484984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NjQ4NDk4NA==",
    "user": {
      "login": "nickjm",
      "id": 7245435,
      "node_id": "MDQ6VXNlcjcyNDU0MzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7245435?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nickjm",
      "html_url": "https://github.com/nickjm",
      "followers_url": "https://api.github.com/users/nickjm/followers",
      "following_url": "https://api.github.com/users/nickjm/following{/other_user}",
      "gists_url": "https://api.github.com/users/nickjm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nickjm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nickjm/subscriptions",
      "organizations_url": "https://api.github.com/users/nickjm/orgs",
      "repos_url": "https://api.github.com/users/nickjm/repos",
      "events_url": "https://api.github.com/users/nickjm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nickjm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-18T01:25:43Z",
    "updated_at": "2018-02-18T01:25:43Z",
    "author_association": "NONE",
    "body": "@cgewecke to my knowledge web3 1.0 is not in beta, while web3 2.0 is in beta. What's the current status of this issue? Does the latest truffle (v4.0.6) still use web3 0.0? Is there a way to circumvent these timeouts now?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/366484984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/366538630",
    "html_url": "https://github.com/trufflesuite/truffle/issues/750#issuecomment-366538630",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
    "id": 366538630,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NjUzODYzMA==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-18T19:02:18Z",
    "updated_at": "2018-02-18T19:02:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@nickjm Not sure how meaningful this is but if you `npm view web3`, every `1.x` release is tagged beta. That said, it seems stable and we've started upgrading `truffle-contract`  to `web3 1.0` at [truffle-contract 95](https://github.com/trufflesuite/truffle-contract/pull/95). \r\n\r\nUnfortunately I was wrong about the 50 blocks limits being removed in 1.0 - it remains in the new code [here](https://github.com/ethereum/web3.js/blob/1.0/packages/web3-core-method/src/index.js#L33) and ultimately [here](https://github.com/ethereum/web3.js/blob/1.0/packages/web3-core-method/src/index.js#L368). In order to circumvent this we'll need to catch the error when it comes back from web3 and continue to poll the chain indefinitely if necessary. I'll put that logic into 95 next week. \r\n\r\nWill probably be a while before 95 makes it into a release because it comes with numerous breaking changes. However, will ping you here as soon as it goes out in a pre-release build so you can test it if you're interested - would be super helpful to get some feedback on whether or not this problem is fixed. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/366538630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375271395",
    "html_url": "https://github.com/trufflesuite/truffle/issues/750#issuecomment-375271395",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/750",
    "id": 375271395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTI3MTM5NQ==",
    "user": {
      "login": "moda20",
      "id": 23613485,
      "node_id": "MDQ6VXNlcjIzNjEzNDg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23613485?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moda20",
      "html_url": "https://github.com/moda20",
      "followers_url": "https://api.github.com/users/moda20/followers",
      "following_url": "https://api.github.com/users/moda20/following{/other_user}",
      "gists_url": "https://api.github.com/users/moda20/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moda20/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moda20/subscriptions",
      "organizations_url": "https://api.github.com/users/moda20/orgs",
      "repos_url": "https://api.github.com/users/moda20/repos",
      "events_url": "https://api.github.com/users/moda20/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moda20/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-22T11:28:40Z",
    "updated_at": "2018-03-22T11:28:47Z",
    "author_association": "NONE",
    "body": "I had the issue with the 240 second timeout, on transactions made by truffle contract but not eth mainnet. i had it on my local quorum network with 5 nodes. i can't understand why would a transaction have to wait in an enviroment where there is no gas at all. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375271395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
