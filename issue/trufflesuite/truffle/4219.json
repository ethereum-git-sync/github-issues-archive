{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4219",
  "id": 959172790,
  "node_id": "MDU6SXNzdWU5NTkxNzI3OTA=",
  "number": 4219,
  "title": "Issue when using truffle testing environment without using artifacts",
  "user": {
    "login": "albert-llimos",
    "id": 53186777,
    "node_id": "MDQ6VXNlcjUzMTg2Nzc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/53186777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/albert-llimos",
    "html_url": "https://github.com/albert-llimos",
    "followers_url": "https://api.github.com/users/albert-llimos/followers",
    "following_url": "https://api.github.com/users/albert-llimos/following{/other_user}",
    "gists_url": "https://api.github.com/users/albert-llimos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/albert-llimos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/albert-llimos/subscriptions",
    "organizations_url": "https://api.github.com/users/albert-llimos/orgs",
    "repos_url": "https://api.github.com/users/albert-llimos/repos",
    "events_url": "https://api.github.com/users/albert-llimos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/albert-llimos/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-03T14:24:57Z",
  "updated_at": "2021-08-04T20:08:33Z",
  "closed_at": "2021-08-04T19:40:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nI am currently building the frontend to interact with a contract. I have read that the \"artifacts.require\" function isn't meant to be used outside of a truffle testing environment. So be able to test my contract properly, I would like to have my testing enviroment work the exact way as my frontend. Therefore, I am setting up a test file without using artifact.require, so only importing a JSON file with require().\r\n\r\nWhen using artifacts, I don't need to require web3 and pass a provider, I assume that is done automatically , and then I can deploy and call any function from the contract, like written below. I assume that the provider (and network ID) is fetched from truffle-config file depending on the network selected (truffle test --network XXX). All of this works well.\r\n```\r\nconst MyContract = artifacts.require(\"myContract\");\r\ncontractInstance = await MyContract.new();\r\nconst result = await contractInstance.myFunction();\r\n```\r\n However, when doing it without artifact, I need to require web3 and inject a provider. \r\n```\r\nconst MyContract = require('../build/contracts/myContract.json');\r\nconst Web3 = require('web3');\r\nconst provider = ????\r\nconst web3 = new Web3(provider);\r\ncontractInstance = await new web3.eth.Contract(myContract.abi).deploy({data: myContract.bytecode }).send({});\r\nconst result = await contractInstance.methods.myFunction().call();\r\n```\r\nWhen I manually add a provider in the test, adding the HDWalletProvider with the nemonic as done in the truffle-config gile where there is \"???\" written above) it works. However, I would like to have it working the same way as when using artifacts, getting the provider from truffle-config file depending on the network selected (with --network ...). How can I get the adequate provider from truffle-config depending on network parameter that I have entered when runing truffle test --network XXX?\r\n\r\n## Steps to Reproduce\r\n\r\nCreate any contract and it's corresponding test file. Then deploying it in the test without using artifacts (as show above). I can't find a way on how to get in the test the correct provider from the truffle-config file according to the user's input (truffle test --network XXX).\r\n\r\n## Expected Behavior\r\n\r\nI would expect that there is a way to get the correct provider (and network ID) outputed by the truffle-config file when running the test command. \r\n\r\n## Actual Results\r\n\r\nI can't get the correct provider and network ID in my test without using \"artifacts.require\".\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client:\r\n* Truffle version (`truffle version`): v5.3.9\r\n* node version (`node --version`): v.14.16.1\r\n* npm version (`npm --version`):  6.14.12\r\n",
  "closed_by": {
    "login": "albert-llimos",
    "id": 53186777,
    "node_id": "MDQ6VXNlcjUzMTg2Nzc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/53186777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/albert-llimos",
    "html_url": "https://github.com/albert-llimos",
    "followers_url": "https://api.github.com/users/albert-llimos/followers",
    "following_url": "https://api.github.com/users/albert-llimos/following{/other_user}",
    "gists_url": "https://api.github.com/users/albert-llimos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/albert-llimos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/albert-llimos/subscriptions",
    "organizations_url": "https://api.github.com/users/albert-llimos/orgs",
    "repos_url": "https://api.github.com/users/albert-llimos/repos",
    "events_url": "https://api.github.com/users/albert-llimos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/albert-llimos/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/892864588",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4219#issuecomment-892864588",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219",
    "id": 892864588,
    "node_id": "IC_kwDOAkfq-c41OAhM",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-04T18:08:37Z",
    "updated_at": "2021-08-04T18:08:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm a little confused at what you're trying to do here.  Are you simply trying to get the provider inside the test, or are you trying to manually extract the provider from the config?\r\n\r\nIf the former, well, the test environment should supply a `web3`, so you can get the provider as `web3.currentProvider`.  If the latter... well, manually extracting it is a thing you could do, but if you insist on doing it manually, then there's not really anything for us to do there, is there?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/892864588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/892923506",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4219#issuecomment-892923506",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219",
    "id": 892923506,
    "node_id": "IC_kwDOAkfq-c41OO5y",
    "user": {
      "login": "albert-llimos",
      "id": 53186777,
      "node_id": "MDQ6VXNlcjUzMTg2Nzc3",
      "avatar_url": "https://avatars.githubusercontent.com/u/53186777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/albert-llimos",
      "html_url": "https://github.com/albert-llimos",
      "followers_url": "https://api.github.com/users/albert-llimos/followers",
      "following_url": "https://api.github.com/users/albert-llimos/following{/other_user}",
      "gists_url": "https://api.github.com/users/albert-llimos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/albert-llimos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/albert-llimos/subscriptions",
      "organizations_url": "https://api.github.com/users/albert-llimos/orgs",
      "repos_url": "https://api.github.com/users/albert-llimos/repos",
      "events_url": "https://api.github.com/users/albert-llimos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/albert-llimos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-04T19:40:56Z",
    "updated_at": "2021-08-04T19:40:56Z",
    "author_association": "NONE",
    "body": "I think I have now understood the problem. I was not aware that the test environment was already supplying the web3. Therefore, when not using artifacts.require I was providing my own web3 and that is where the problem was.\r\n\r\nI just removed all the web3 lines in the second snippet of code and it worked well.\r\n\r\nThank you for the help!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/892923506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/892940017",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4219#issuecomment-892940017",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4219",
    "id": 892940017,
    "node_id": "IC_kwDOAkfq-c41OS7x",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-04T20:08:32Z",
    "updated_at": "2021-08-04T20:08:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah, I see, I thought you were providing your own web3 purely as part of your insistence on doing things manually, rather than because you didn't know it was already provided. :)  Glad we could help!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/892940017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
