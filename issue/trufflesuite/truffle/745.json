{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/745",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/745",
  "id": 287556660,
  "node_id": "MDU6SXNzdWUyODc1NTY2NjA=",
  "number": 745,
  "title": "Never failing Solidity unit testing ",
  "user": {
    "login": "GNSPS",
    "id": 4008213,
    "node_id": "MDQ6VXNlcjQwMDgyMTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4008213?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/GNSPS",
    "html_url": "https://github.com/GNSPS",
    "followers_url": "https://api.github.com/users/GNSPS/followers",
    "following_url": "https://api.github.com/users/GNSPS/following{/other_user}",
    "gists_url": "https://api.github.com/users/GNSPS/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/GNSPS/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/GNSPS/subscriptions",
    "organizations_url": "https://api.github.com/users/GNSPS/orgs",
    "repos_url": "https://api.github.com/users/GNSPS/repos",
    "events_url": "https://api.github.com/users/GNSPS/events{/privacy}",
    "received_events_url": "https://api.github.com/users/GNSPS/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-01-10T19:52:00Z",
  "updated_at": "2018-01-18T02:42:47Z",
  "closed_at": "2018-01-18T02:35:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nSolidity unit testing in Truffle doesn't work (no tests fail) unless you invoke any method of Truffle's `Assert` library.\r\n\r\nFound this while doing unit testing with an assertion library of my own which complies with Truffle's `TestEvent` firing.\r\n\r\n## Steps to Reproduce\r\n\r\nRun the tests from this repo: \r\n\r\nhttps://github.com/GNSPS/solidity-bytes-utils\r\n\r\nBut remove this line:\r\n\r\nhttps://github.com/GNSPS/solidity-bytes-utils/blob/master/test/TestBytesLib1.sol#L45\r\n\r\nWhich is the fix for the affliction I mentioned.\r\n\r\n## Expected Behavior\r\n\r\nFor the test to run independent of calling a method from `Assert.sol`\r\n\r\n## Actual Results\r\n\r\nAll tests were passing irregardless of wether they were firing false `TestEvent`s or not.\r\n\r\n## Environment\r\n\r\n* Operating System: macOS\r\n* Truffle version: 4.0.4\r\n* Ethereum client: ganache-cli\r\n* node version: 8.9.1\r\n* npm version: 5.6.0",
  "closed_by": {
    "login": "cgewecke",
    "id": 7332026,
    "node_id": "MDQ6VXNlcjczMzIwMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cgewecke",
    "html_url": "https://github.com/cgewecke",
    "followers_url": "https://api.github.com/users/cgewecke/followers",
    "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
    "organizations_url": "https://api.github.com/users/cgewecke/orgs",
    "repos_url": "https://api.github.com/users/cgewecke/repos",
    "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cgewecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/745/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357395833",
    "html_url": "https://github.com/trufflesuite/truffle/issues/745#issuecomment-357395833",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745",
    "id": 357395833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzM5NTgzMw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-13T01:00:01Z",
    "updated_at": "2018-01-13T01:00:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @GNSPS. It seems like the underlying issue might be a quirk relating to `libraries` and `events`.  Everything about the way `AssertBytes` mimics Truffle's `Assert` is correct and seems like it should work. \r\n\r\nHowever, if the only defined `TestEvent` is located in a library, the transaction result that Truffle inspects for failing event logs always has an empty logs arrary.  The events fire but they aren't decoded at the `web3` level, which is what Truffle expects. \r\n\r\nJorge Izquierdo at Aragon has written a nice Medium [post](https://blog.aragon.one/library-driven-development-in-solidity-2bebcaf88736) about libraries and says there:\r\n> as of right now, the contract ABI does not reflect the events that the libraries it uses may emit. This confuses clients such as web3, that wonâ€™t be able to decode what event was called or figure out how to decode its arguments.\r\n\r\n> There is a quick hack for this, defining the event both in the contract and the library will trick clients into thinking that it was actually the main contract who sent the event and not the library.\r\n\r\nSo one fix would be to additionally define `TestEvent` in the test suite contracts, which would allow you to remove the fake test. If that solution works for you, maybe we should rename this issue a little - it's an unexpected problem that other people might run into as well. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357395833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357413025",
    "html_url": "https://github.com/trufflesuite/truffle/issues/745#issuecomment-357413025",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745",
    "id": 357413025,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzQxMzAyNQ==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-13T06:12:36Z",
    "updated_at": "2018-01-13T06:21:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looking at this more i wonder if linking the AssertBytes library and the test suite contracts in a deployment step is what really needs to be done here. The comment above has the glaring flaw that Assert is also a library, so . . . why does it work ok? ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/357413025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358518990",
    "html_url": "https://github.com/trufflesuite/truffle/issues/745#issuecomment-358518990",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745",
    "id": 358518990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODUxODk5MA==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-18T02:35:45Z",
    "updated_at": "2018-01-18T02:35:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "@GNSPS This should be fixed in the latest release. Please re-open if continue to see this problem, or the patch doesn't work for any other reason. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358518990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358519903",
    "html_url": "https://github.com/trufflesuite/truffle/issues/745#issuecomment-358519903",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/745",
    "id": 358519903,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1ODUxOTkwMw==",
    "user": {
      "login": "GNSPS",
      "id": 4008213,
      "node_id": "MDQ6VXNlcjQwMDgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4008213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GNSPS",
      "html_url": "https://github.com/GNSPS",
      "followers_url": "https://api.github.com/users/GNSPS/followers",
      "following_url": "https://api.github.com/users/GNSPS/following{/other_user}",
      "gists_url": "https://api.github.com/users/GNSPS/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GNSPS/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GNSPS/subscriptions",
      "organizations_url": "https://api.github.com/users/GNSPS/orgs",
      "repos_url": "https://api.github.com/users/GNSPS/repos",
      "events_url": "https://api.github.com/users/GNSPS/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GNSPS/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-18T02:41:46Z",
    "updated_at": "2018-01-18T02:42:47Z",
    "author_association": "NONE",
    "body": "Thank you so much @cgewecke!! ðŸ™Œ And sorry for the delay! Appreciated very much your prompt response! ðŸ˜„",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/358519903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
