{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1329",
  "id": 368686476,
  "node_id": "MDU6SXNzdWUzNjg2ODY0NzY=",
  "number": 1329,
  "title": "deployer.deploy() does not throw when a create fails",
  "user": {
    "login": "pieterhartel",
    "id": 22255740,
    "node_id": "MDQ6VXNlcjIyMjU1NzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22255740?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pieterhartel",
    "html_url": "https://github.com/pieterhartel",
    "followers_url": "https://api.github.com/users/pieterhartel/followers",
    "following_url": "https://api.github.com/users/pieterhartel/following{/other_user}",
    "gists_url": "https://api.github.com/users/pieterhartel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pieterhartel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pieterhartel/subscriptions",
    "organizations_url": "https://api.github.com/users/pieterhartel/orgs",
    "repos_url": "https://api.github.com/users/pieterhartel/repos",
    "events_url": "https://api.github.com/users/pieterhartel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pieterhartel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 971536096,
      "node_id": "MDU6TGFiZWw5NzE1MzYwOTY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Migrations",
      "name": "Migrations",
      "color": "b887db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-10-10T14:12:27Z",
  "updated_at": "2020-12-09T19:14:17Z",
  "closed_at": "2020-12-09T19:14:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nHow do I catch a failed require in the Truffle migration script?\r\n\r\n## Steps to Reproduce\r\n\r\n`$ truffle init`\r\n\r\n```\r\n$ cat <<end >contracts/Test.sol\r\npragma solidity ^0.4.25;\r\ncontract Test {\r\n        constructor( uint a ) {\r\n                require( a == 2, \"illegal value for a\" ) ;\r\n        }\r\n}\r\nend\r\n$ cat <<end >test/test.js\r\nconst Test = artifacts.require( \"./Test.sol\" );\r\ncontract( \"Test\", function( accounts ) {\r\n        it( \"Deploy\", async function( ) {\r\n                try{\r\n                        await Test.deployed( ) ;\r\n                        console.log( \"deployment succeeded\" )\r\n                } catch( error ) {\r\n                        console.log( \"deployment failed %s\", error.message )\r\n                }\r\n        } );\r\n} )\r\nend\r\n$ cat <<end >migrations/2_deploy_contracts.js\r\nvar Test = artifacts.require(\"./Test.sol\");\r\nmodule.exports = async function(deployer) {\r\n        try {\r\n                await deployer.deploy( Test, 1 ) ;\r\n                console.log( \"migration succeed\" ) ;\r\n        } catch( error ) {\r\n                console.log( \"migration failed %s\", error.message ) ;\r\n        }\r\n};\r\nend\r\n```\r\n```\r\n$ truffle test\r\nCompiling ./contracts/Migrations.sol...\r\nCompiling ./contracts/Test.sol...\r\nCompilation warnings encountered:\r\n/Users/pieter/Documents/pieter/Ethereum/Truffle/Test/contracts/Test.sol:3:2: Warning: No visibility specified. Defaulting to \"public\". \r\n\tconstructor( uint a ) {\r\n ^ (Relevant source part starts here and spans across multiple lines).\r\nmigration succeed\r\nError: while migrating Test: Returned error: VM Exception while processing transaction: revert illegal value for a -- Reason given: illegal value for a.\r\n    at /usr/local/lib/node_modules/truffle/build/webpack:/packages/truffle-deployer/src/deployment.js:361:1\r\n    at process._tickCallback (internal/process/next_tick.js:68:7)\r\n```\r\n \r\n\r\n## Expected Behavior\r\n\r\nI would have expected the catch block in the migration script to be able to deal with the failed require.\r\n\r\n## Actual Results\r\n\r\nI get a VM exception that I do not know how to catch.\r\n\r\n## Environment\r\n\r\n* Operating System: MacOS Mojave 10.14\r\n* Ethereum client: built into truffle\r\n* Truffle version (`truffle version`): Truffle v5.0.0-beta.1 (core: 5.0.0-beta.1)\r\nSolidity v0.4.25 (solc-js)\r\n* node version (`node --version`): v10.11.0\r\n* npm version (`npm --version`): 6.4.1",
  "closed_by": {
    "login": "gnidan",
    "id": 151065,
    "node_id": "MDQ6VXNlcjE1MTA2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnidan",
    "html_url": "https://github.com/gnidan",
    "followers_url": "https://api.github.com/users/gnidan/followers",
    "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
    "organizations_url": "https://api.github.com/users/gnidan/orgs",
    "repos_url": "https://api.github.com/users/gnidan/repos",
    "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnidan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/428785803",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1329#issuecomment-428785803",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329",
    "id": 428785803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODc4NTgwMw==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-11T01:23:38Z",
    "updated_at": "2018-10-11T01:23:38Z",
    "author_association": "MEMBER",
    "body": "Ooh this is kind of tricky.\r\n\r\nRight now, `deployer.deploy()` effectively just stages your deployments, so there's no way the exception could get bubbled up where you want.\r\n\r\nThis is certainly a useful feature. We will have to look into prioritizing it, although feel free to open a PR!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/428785803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/481570926",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1329#issuecomment-481570926",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329",
    "id": 481570926,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTU3MDkyNg==",
    "user": {
      "login": "pieterhartel",
      "id": 22255740,
      "node_id": "MDQ6VXNlcjIyMjU1NzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22255740?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pieterhartel",
      "html_url": "https://github.com/pieterhartel",
      "followers_url": "https://api.github.com/users/pieterhartel/followers",
      "following_url": "https://api.github.com/users/pieterhartel/following{/other_user}",
      "gists_url": "https://api.github.com/users/pieterhartel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pieterhartel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pieterhartel/subscriptions",
      "organizations_url": "https://api.github.com/users/pieterhartel/orgs",
      "repos_url": "https://api.github.com/users/pieterhartel/repos",
      "events_url": "https://api.github.com/users/pieterhartel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pieterhartel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-10T07:31:30Z",
    "updated_at": "2019-04-10T07:31:30Z",
    "author_association": "NONE",
    "body": "There is a workaround for this issue that is actually really simple. It consists of dispensing with the second migration script. Instead the contract is deployed in the test script. Then exceptions can be caught, await works etc.\r\n\r\nFor details and an example see: [https://github.com/trufflesuite/ganache-core/issues/388#issuecomment-480951656](url)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/481570926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/721920170",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1329#issuecomment-721920170",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329",
    "id": 721920170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMTkyMDE3MA==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-04T19:10:50Z",
    "updated_at": "2020-11-04T19:10:50Z",
    "author_association": "MEMBER",
    "body": "Does anyone know if this is still an issue? Looks like something we might be able to sort out pretty easily, but would be nice to have confirmation.\r\n\r\nThanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/721920170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/741988911",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1329#issuecomment-741988911",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1329",
    "id": 741988911,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MTk4ODkxMQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-09T19:14:17Z",
    "updated_at": "2020-12-09T19:14:17Z",
    "author_association": "MEMBER",
    "body": "Closing this for issue maintenance, then. Happy to revisit this if it bothers someone in the future. Let us know!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/741988911/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
