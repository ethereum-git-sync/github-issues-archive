{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3756",
  "id": 797712095,
  "node_id": "MDU6SXNzdWU3OTc3MTIwOTU=",
  "number": 3756,
  "title": "Bug: truffle test async function failure should cause a shell exit with error code",
  "user": {
    "login": "zhouhanseng",
    "id": 63733714,
    "node_id": "MDQ6VXNlcjYzNzMzNzE0",
    "avatar_url": "https://avatars.githubusercontent.com/u/63733714?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhouhanseng",
    "html_url": "https://github.com/zhouhanseng",
    "followers_url": "https://api.github.com/users/zhouhanseng/followers",
    "following_url": "https://api.github.com/users/zhouhanseng/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhouhanseng/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhouhanseng/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhouhanseng/subscriptions",
    "organizations_url": "https://api.github.com/users/zhouhanseng/orgs",
    "repos_url": "https://api.github.com/users/zhouhanseng/repos",
    "events_url": "https://api.github.com/users/zhouhanseng/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhouhanseng/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393326,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 1041903922,
      "node_id": "MDU6TGFiZWwxMDQxOTAzOTIy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/truffle%20test",
      "name": "truffle test",
      "color": "bfdadc",
      "default": false,
      "description": ""
    },
    {
      "id": 1675041356,
      "node_id": "MDU6TGFiZWwxNjc1MDQxMzU2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority2%20%E2%9A%A0%EF%B8%8F",
      "name": "priority2 ⚠️",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-01-31T13:31:29Z",
  "updated_at": "2022-06-30T12:40:00Z",
  "closed_at": "2022-06-30T12:39:59Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nHello, everyone. I find that Truffle async function without done() test failure does not cause a shell exit with error code which can lead to a wrong CI report. And through my test, this is not a mocha bug. I guess this bug is introduced by this shell script https://github.com/trufflesuite/truffle/blob/develop/packages/truffle/scripts/test.sh\r\n\r\n## Steps to Reproduce\r\n\r\n`$ truffle test`\r\n\r\n```ts\r\n// exit with error code.\r\nit('should return -1 when the value is not present', (done) => {\r\n  assert.equal([1, 2, 3].indexOf(2), -1);\r\n  done()\r\n});\r\n\r\n// does not exit with error code.\r\nit('should return -1 when the value is not present', async () => {\r\n  assert.equal([1, 2, 3].indexOf(2), -1);\r\n});\r\n```\r\n\r\nPlease provide the shortest amount of steps to reproduce your issue.\r\n\r\n## Expected Behavior\r\n\r\n`it('', async () => {//...})` failure should exit with error code.\r\n\r\n![image](https://user-images.githubusercontent.com/63733714/106385502-91e42d00-640b-11eb-9148-86a65436c6ef.png)\r\n\r\n## Actual Results\r\n\r\n`it('', async () => {//...})` failure does not exit with error code.\r\n\r\n![image](https://user-images.githubusercontent.com/63733714/106385480-83961100-640b-11eb-9bf7-6873a2b53400.png)\r\n\r\n## Environment\r\n\r\n* Operating System: macOS 10.15.7 and ubuntu-latest\r\n* Ethereum client: ganache\r\n* Truffle version (`truffle version`): ^5.1.64\r\n* node version (`node --version`): 14.13.0\r\n* npm version (`npm --version`): 7.1.0\r\n",
  "closed_by": {
    "login": "MicaiahReid",
    "id": 17027138,
    "node_id": "MDQ6VXNlcjE3MDI3MTM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17027138?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MicaiahReid",
    "html_url": "https://github.com/MicaiahReid",
    "followers_url": "https://api.github.com/users/MicaiahReid/followers",
    "following_url": "https://api.github.com/users/MicaiahReid/following{/other_user}",
    "gists_url": "https://api.github.com/users/MicaiahReid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MicaiahReid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MicaiahReid/subscriptions",
    "organizations_url": "https://api.github.com/users/MicaiahReid/orgs",
    "repos_url": "https://api.github.com/users/MicaiahReid/repos",
    "events_url": "https://api.github.com/users/MicaiahReid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MicaiahReid/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/772738644",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3756#issuecomment-772738644",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756",
    "id": 772738644,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MjczODY0NA==",
    "user": {
      "login": "davidmurdoch",
      "id": 187813,
      "node_id": "MDQ6VXNlcjE4NzgxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/187813?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidmurdoch",
      "html_url": "https://github.com/davidmurdoch",
      "followers_url": "https://api.github.com/users/davidmurdoch/followers",
      "following_url": "https://api.github.com/users/davidmurdoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidmurdoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davidmurdoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidmurdoch/subscriptions",
      "organizations_url": "https://api.github.com/users/davidmurdoch/orgs",
      "repos_url": "https://api.github.com/users/davidmurdoch/repos",
      "events_url": "https://api.github.com/users/davidmurdoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davidmurdoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-03T18:53:17Z",
    "updated_at": "2021-02-03T18:53:17Z",
    "author_association": "MEMBER",
    "body": "Thanks @zhouhanseng for opening this issue! I've moved it to our backlog to be worked ASAP.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/772738644/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/777853858",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3756#issuecomment-777853858",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756",
    "id": 777853858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3Nzg1Mzg1OA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T23:08:56Z",
    "updated_at": "2021-02-11T23:08:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi, we've just released Truffle 5.1.66 which fixes the problem of exit statuses not being propagated.  However it seems like your problem may be more specific.  Does Truffle 5.1.66 fix your problem, or is there still more to do here?  Thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/777853858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1171170261",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3756#issuecomment-1171170261",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3756",
    "id": 1171170261,
    "node_id": "IC_kwDOAkfq-c5FzqPV",
    "user": {
      "login": "MicaiahReid",
      "id": 17027138,
      "node_id": "MDQ6VXNlcjE3MDI3MTM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17027138?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MicaiahReid",
      "html_url": "https://github.com/MicaiahReid",
      "followers_url": "https://api.github.com/users/MicaiahReid/followers",
      "following_url": "https://api.github.com/users/MicaiahReid/following{/other_user}",
      "gists_url": "https://api.github.com/users/MicaiahReid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MicaiahReid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MicaiahReid/subscriptions",
      "organizations_url": "https://api.github.com/users/MicaiahReid/orgs",
      "repos_url": "https://api.github.com/users/MicaiahReid/repos",
      "events_url": "https://api.github.com/users/MicaiahReid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MicaiahReid/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-30T12:39:59Z",
    "updated_at": "2022-06-30T12:39:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "We haven't heard anything back on this, so we're calling it fixed! Please open another issue if you're finding that this is still happening.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1171170261/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
