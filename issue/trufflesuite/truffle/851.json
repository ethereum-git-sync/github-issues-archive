{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/851",
  "id": 305979513,
  "node_id": "MDU6SXNzdWUzMDU5Nzk1MTM=",
  "number": 851,
  "title": "`truffle test` uses old sources for /contracts",
  "user": {
    "login": "ScJa",
    "id": 17674888,
    "node_id": "MDQ6VXNlcjE3Njc0ODg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17674888?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ScJa",
    "html_url": "https://github.com/ScJa",
    "followers_url": "https://api.github.com/users/ScJa/followers",
    "following_url": "https://api.github.com/users/ScJa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ScJa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ScJa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ScJa/subscriptions",
    "organizations_url": "https://api.github.com/users/ScJa/orgs",
    "repos_url": "https://api.github.com/users/ScJa/repos",
    "events_url": "https://api.github.com/users/ScJa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ScJa/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-03-16T15:48:08Z",
  "updated_at": "2018-03-30T01:43:15Z",
  "closed_at": "2018-03-30T01:43:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen running `truffle test` old sources for smart contracts are being used. If this happens, the old build is still used if running `truffle compile -all`. Only way to fix it I have found is deleting the build folder.\r\n\r\nE.g. if I add an additional event, emit it and add a test for the event, the test will fail because the event does not exist. This happens to me about 1 in 10-20 times when changing contracts and running tests afterwards.\r\n\r\nWhat might be important to note is that for my tests I don't use deployed contracts and I have no migrations implemented. I test all smart contracts by created them like so `SmartContract.new()`.\r\n\r\n## Steps to Reproduce\r\n\r\nIssue is not reliably reproduce-able and only happens every 1 in 10-20 times.\r\n\r\n1) Have a successful test which uses smart contract function.\r\n2) Run `truffle compile -all`.\r\n3) Delete said smart contract function from source file.\r\n4) Run `truffle test`.\r\n\r\n## Expected Behavior\r\n\r\nTesting should produce an error because the function does not exist anymore.\r\n\r\n## Actual Results\r\n\r\nThe test sometimes still passes because the old source is still used. If this happens, even running `truffle compile -all` again then test again will not fix the issue.\r\n\r\n## Environment\r\n\r\n* Operating System: ubuntu 16.04 LTS\r\n* Ethereum client: Ganache CLI v6.0.3 (ganache-core: 2.0.2)\r\n* Truffle version (`truffle version`): Truffle v4.0.0 (core: 4.0.0)\r\n* node version (`node --version`): v6.13.0\r\n* npm version (`npm --version`): 3.10.10\r\n",
  "closed_by": {
    "login": "cgewecke",
    "id": 7332026,
    "node_id": "MDQ6VXNlcjczMzIwMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cgewecke",
    "html_url": "https://github.com/cgewecke",
    "followers_url": "https://api.github.com/users/cgewecke/followers",
    "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
    "organizations_url": "https://api.github.com/users/cgewecke/orgs",
    "repos_url": "https://api.github.com/users/cgewecke/repos",
    "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cgewecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/851/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374241659",
    "html_url": "https://github.com/trufflesuite/truffle/issues/851#issuecomment-374241659",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
    "id": 374241659,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDI0MTY1OQ==",
    "user": {
      "login": "ScJa",
      "id": 17674888,
      "node_id": "MDQ6VXNlcjE3Njc0ODg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17674888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ScJa",
      "html_url": "https://github.com/ScJa",
      "followers_url": "https://api.github.com/users/ScJa/followers",
      "following_url": "https://api.github.com/users/ScJa/following{/other_user}",
      "gists_url": "https://api.github.com/users/ScJa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ScJa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ScJa/subscriptions",
      "organizations_url": "https://api.github.com/users/ScJa/orgs",
      "repos_url": "https://api.github.com/users/ScJa/repos",
      "events_url": "https://api.github.com/users/ScJa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ScJa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T14:57:16Z",
    "updated_at": "2018-03-19T14:57:16Z",
    "author_association": "NONE",
    "body": "Issue also present in v4.1.3 and on a Windows operating system.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374241659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374293491",
    "html_url": "https://github.com/trufflesuite/truffle/issues/851#issuecomment-374293491",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
    "id": 374293491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDI5MzQ5MQ==",
    "user": {
      "login": "fdouglis",
      "id": 4999923,
      "node_id": "MDQ6VXNlcjQ5OTk5MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4999923?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fdouglis",
      "html_url": "https://github.com/fdouglis",
      "followers_url": "https://api.github.com/users/fdouglis/followers",
      "following_url": "https://api.github.com/users/fdouglis/following{/other_user}",
      "gists_url": "https://api.github.com/users/fdouglis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fdouglis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fdouglis/subscriptions",
      "organizations_url": "https://api.github.com/users/fdouglis/orgs",
      "repos_url": "https://api.github.com/users/fdouglis/repos",
      "events_url": "https://api.github.com/users/fdouglis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fdouglis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T17:17:04Z",
    "updated_at": "2018-03-19T17:17:04Z",
    "author_association": "NONE",
    "body": "I'm a bit confused by this bug report, because I was told by a truffle developer that \"truffle test\" compiles a new version and ignores anything you may previously have done with \"truffle compile\" or \"truffle migrate\".  Maybe that only applies to solidity tests rather than JS?  ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374293491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374353555",
    "html_url": "https://github.com/trufflesuite/truffle/issues/851#issuecomment-374353555",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
    "id": 374353555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDM1MzU1NQ==",
    "user": {
      "login": "ScJa",
      "id": 17674888,
      "node_id": "MDQ6VXNlcjE3Njc0ODg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17674888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ScJa",
      "html_url": "https://github.com/ScJa",
      "followers_url": "https://api.github.com/users/ScJa/followers",
      "following_url": "https://api.github.com/users/ScJa/following{/other_user}",
      "gists_url": "https://api.github.com/users/ScJa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ScJa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ScJa/subscriptions",
      "organizations_url": "https://api.github.com/users/ScJa/orgs",
      "repos_url": "https://api.github.com/users/ScJa/repos",
      "events_url": "https://api.github.com/users/ScJa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ScJa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T20:06:16Z",
    "updated_at": "2018-03-19T20:06:16Z",
    "author_association": "NONE",
    "body": "If you run truffle compile once before, truffle test (tries) to re-compile only the .sol files which have had changes since the last test run.\r\nIf you have never run truffle compile before, truffle test will always re-compile every .sol file - even completely unrelated once.\r\n\r\nThis is at least the behaviour judging by the console output, actual might be different.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374353555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374393239",
    "html_url": "https://github.com/trufflesuite/truffle/issues/851#issuecomment-374393239",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
    "id": 374393239,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDM5MzIzOQ==",
    "user": {
      "login": "fdouglis",
      "id": 4999923,
      "node_id": "MDQ6VXNlcjQ5OTk5MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4999923?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fdouglis",
      "html_url": "https://github.com/fdouglis",
      "followers_url": "https://api.github.com/users/fdouglis/followers",
      "following_url": "https://api.github.com/users/fdouglis/following{/other_user}",
      "gists_url": "https://api.github.com/users/fdouglis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fdouglis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fdouglis/subscriptions",
      "organizations_url": "https://api.github.com/users/fdouglis/orgs",
      "repos_url": "https://api.github.com/users/fdouglis/repos",
      "events_url": "https://api.github.com/users/fdouglis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fdouglis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T21:51:15Z",
    "updated_at": "2018-03-19T21:51:15Z",
    "author_association": "NONE",
    "body": "ScJa, perhaps things have changed since I last installed truffle  2-3 weeks ago, but I definitely saw \"test\" recompiling things regardless of whether I'd explicitly compiled.  And similarly, running \"migrate\" made no difference, because it'd deploy a fresh version for the test.  ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374393239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374431795",
    "html_url": "https://github.com/trufflesuite/truffle/issues/851#issuecomment-374431795",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
    "id": 374431795,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDQzMTc5NQ==",
    "user": {
      "login": "ScJa",
      "id": 17674888,
      "node_id": "MDQ6VXNlcjE3Njc0ODg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17674888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ScJa",
      "html_url": "https://github.com/ScJa",
      "followers_url": "https://api.github.com/users/ScJa/followers",
      "following_url": "https://api.github.com/users/ScJa/following{/other_user}",
      "gists_url": "https://api.github.com/users/ScJa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ScJa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ScJa/subscriptions",
      "organizations_url": "https://api.github.com/users/ScJa/orgs",
      "repos_url": "https://api.github.com/users/ScJa/repos",
      "events_url": "https://api.github.com/users/ScJa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ScJa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-20T00:31:24Z",
    "updated_at": "2018-03-20T00:31:24Z",
    "author_association": "NONE",
    "body": "Thanks for bringing it up, I have tested the exact behaviour again and found out it is different than to what I described. I found out three different cases.\r\n\r\n1.  If you run `truffle compile` and afterwards run `truffle test` with NO file changed in between only the Migrations.sol file will be re-compiled.\r\n2.  If you run `truffle compile` and afterwards run `truffle test` with ONE file changed in between all .sol files which are used in the test cases will be re-compiled, but not saved in the build folder. This means it will always re-compile even if there are no changes afterwards.\r\n3.  If you don't run `truffle compile` and have no build folder (or an empty one),  `truffle test` will re-compile every single .sol file (also ones which are not used by any tests) and save nothing in the build folder. \r\n\r\nOverall the behaviour 2 and 3 seem inconsistent to me and can lead to a lot of unnecessary compiling, but I'm not sure how this all relates to my original issue.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/374431795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/377421683",
    "html_url": "https://github.com/trufflesuite/truffle/issues/851#issuecomment-377421683",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/851",
    "id": 377421683,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NzQyMTY4Mw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-30T01:43:15Z",
    "updated_at": "2018-03-30T01:43:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ScJa We think this bug is fixed with `4.1.5`.  Current behavior should be that if a file has been changed, `test` will compile all the files that are connected to that file in an inheritance chain. Hoping to minimize this set in an upcoming release, but at the moment, the current compilation level is necessary.\r\n\r\nClosing, please re-open if you continue to have problems with this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/377421683/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
