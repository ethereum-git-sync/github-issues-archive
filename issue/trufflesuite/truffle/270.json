{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/270",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/270/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/270/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/270/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/270",
  "id": 178291686,
  "node_id": "MDU6SXNzdWUxNzgyOTE2ODY=",
  "number": 270,
  "title": "Serve uses the wrong contract addresses",
  "user": {
    "login": "chevdor",
    "id": 738724,
    "node_id": "MDQ6VXNlcjczODcyNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/738724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chevdor",
    "html_url": "https://github.com/chevdor",
    "followers_url": "https://api.github.com/users/chevdor/followers",
    "following_url": "https://api.github.com/users/chevdor/following{/other_user}",
    "gists_url": "https://api.github.com/users/chevdor/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chevdor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chevdor/subscriptions",
    "organizations_url": "https://api.github.com/users/chevdor/orgs",
    "repos_url": "https://api.github.com/users/chevdor/repos",
    "events_url": "https://api.github.com/users/chevdor/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chevdor/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2016-09-21T09:21:29Z",
  "updated_at": "2017-03-20T22:54:52Z",
  "closed_at": "2017-03-20T22:54:52Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\n\nFirst, here is an output:\n\n```\n$ truffle networks\n\nNetwork: dev\n  ConvertLib: 0xdd24425a04cba4c9d8950f3c79536f30cb5ba55b\n  Migrations: 0x1bf51dfb837f6c927f2810487d84ad2346e3d9f0\n  PRNG1: 0xf0c19643f903b2ea13834db790671de862613eff\n\nNetwork: morden\n  ConvertLib: 0x7034b88136de7ca975d88b83acb989748bce3352\n  Migrations: 0x57401056f09c30651738911961f013276abebe5f\n  PRNG1: 0xd8ff9b4345b99bccb2242d8cd66d33bc21578a9c\n\n```\n\nSo we see that I deployed to dev (testrpc) and morden.\nIf I run `truffle serve` things work all good and the 'dev' contract addresses are used.\nIf I run `truffle serve --network dev`, the problem occurs and the contract on 'dev' are used instead of the morden network.\n\nIn build/contract/PRNG1, I noticed the following (truncated to keep it readable):\n\n```\n Contract.all_networks = {\n  \"2\": {                                                    <== Issue here?\n    \"abi\": [....\n        ],\n        \"type\": \"constructor\"\n      }\n    ],\n   ...\n  },\n  \"default\": {\n    \"abi\": [\n      {\n    ...\n      }\n    ],\n    ...\n  }\n};\n```\n\nI suspect the issue to be that instead of the network NAME, the network ID is stored (ie 2 instead of the string 'morden').\n## Steps to Reproduce\n\nBuild for 2 networks such as testrpc AND morden.\n## Expected Behavior\n\n`truffle serve --network dev` uses the addresses from dev\n`truffle serve --network morden` uses the addresses from morden\n## Actual Results\n\nIn any case, the default addresses are used.\n## Environment\n- Operating System: OSX\n- Truffle version: v2.0.8\n- Ethereum client: testrpc for dev + geth --testnet for moden\n- node version: 6.6.0\n- npm version: 3.10.7\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/270/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/270/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/248906616",
    "html_url": "https://github.com/trufflesuite/truffle/issues/270#issuecomment-248906616",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/270",
    "id": 248906616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0ODkwNjYxNg==",
    "user": {
      "login": "chevdor",
      "id": 738724,
      "node_id": "MDQ6VXNlcjczODcyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/738724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chevdor",
      "html_url": "https://github.com/chevdor",
      "followers_url": "https://api.github.com/users/chevdor/followers",
      "following_url": "https://api.github.com/users/chevdor/following{/other_user}",
      "gists_url": "https://api.github.com/users/chevdor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chevdor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chevdor/subscriptions",
      "organizations_url": "https://api.github.com/users/chevdor/orgs",
      "repos_url": "https://api.github.com/users/chevdor/repos",
      "events_url": "https://api.github.com/users/chevdor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chevdor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-22T13:42:05Z",
    "updated_at": "2016-09-22T13:42:05Z",
    "author_association": "NONE",
    "body": "After some reading, I suspect that the issue has nothing to do with the serve task itself but with the build process.\n\nTo test, in truffle.js, declare 2 instances of testnet for instance:\n\n```\n\"testnet\": {\n            network_id: 2, // Official Ethereum test network\n            host: \"localhost\",\n            port: 8546\n        },\n\"parity\": {\n            network_id: 2, // Official Ethereum test network\n            host: \"localhost\",\n            port: 8547\n        },\n```\n\nAs the names suggest, I am running geth on testnet on port 8546 and parity also on testnet on port 8547.\n\nTry deploying to 'testnet': `truffle migrate --network testnet`\nThis will for fine.\n\nNow try deploying to 'parity':  `truffle migrate --network parity`\nNothing will happen unless you specify `--reset` as truffle thinks that we deployed already on network '2'.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/248906616/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/287923586",
    "html_url": "https://github.com/trufflesuite/truffle/issues/270#issuecomment-287923586",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/270",
    "id": 287923586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzkyMzU4Ng==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-20T22:54:52Z",
    "updated_at": "2017-03-20T22:54:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "This has been fixed on Truffle 3.x. If you continue to run into this error please open a new ticket. Thanks for the report!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/287923586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
