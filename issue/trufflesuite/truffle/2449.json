{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2449",
  "id": 506313253,
  "node_id": "MDU6SXNzdWU1MDYzMTMyNTM=",
  "number": 2449,
  "title": "Truffle error when executing method call. Probably, error with event parsing.",
  "user": {
    "login": "chebykin",
    "id": 2095757,
    "node_id": "MDQ6VXNlcjIwOTU3NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2095757?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chebykin",
    "html_url": "https://github.com/chebykin",
    "followers_url": "https://api.github.com/users/chebykin/followers",
    "following_url": "https://api.github.com/users/chebykin/following{/other_user}",
    "gists_url": "https://api.github.com/users/chebykin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chebykin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chebykin/subscriptions",
    "organizations_url": "https://api.github.com/users/chebykin/orgs",
    "repos_url": "https://api.github.com/users/chebykin/repos",
    "events_url": "https://api.github.com/users/chebykin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chebykin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393329,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjk=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/help%20wanted",
      "name": "help wanted",
      "color": "159818",
      "default": true,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-10-13T11:39:02Z",
  "updated_at": "2021-09-20T21:30:20Z",
  "closed_at": "2019-10-25T18:21:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "- [ no] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen calling a contract method in my tests I'm getting `Error: TypeError: Cannot read property 'toString' of null Given value: \"null\"`.\r\n\r\nWhat I've found is when two different contracts have two events with the same signatures but different argument names, truffle parses the event using a wrong argument set. In my case the event is ERC721 Transfer:\r\n\r\n`event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);`\r\n\r\nbut truffle parses it as ERC20 Transfer:\r\n\r\n`event Transfer(address indexed from, address indexed to, uint256 amount);`\r\n\r\n## Steps to Reproduce\r\n\r\nUse the following set of contracts:\r\n\r\n```solidity\r\npragma solidity ^0.4.24;\r\n\r\n\r\ncontract MyERC20 {\r\n  event Transfer(address indexed from, address indexed to, uint256 amount);\r\n\r\n  function transferFrom(address _from, address _to, uint256 _amount) public {\r\n    emit Transfer(_from, _to, _amount);\r\n  }\r\n}\r\n\r\ncontract MyERC721 {\r\n  event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);\r\n\r\n  function transferFrom(address _from, address _to, uint256 _tokenId) public {\r\n    emit Transfer(_from, _to, _tokenId);\r\n  }\r\n}\r\n\r\n\r\ncontract Foo is MyERC20 {\r\n  MyERC721 public erc721Contract;\r\n\r\n  constructor() public {\r\n    erc721Contract = new MyERC721();\r\n  }\r\n\r\n  function myTransfer() public {\r\n    erc721Contract.transferFrom(msg.sender, address(this), 1);\r\n  }\r\n}\r\n```\r\n\r\nand run this test:\r\n\r\n```javascript\r\nconst Foo = artifacts.require('Foo.sol');\r\n\r\ncontract('Foo test', accounts => {\r\n  it('should execute #myTransfer()', async function() {\r\n    const foo = await Foo.new();\r\n    await foo.myTransfer();\r\n  });\r\n});\r\n```\r\n\r\n## Expected Behavior\r\n\r\nThe test should pass without errors\r\n\r\n## Actual Results\r\n\r\nThe test fails with \r\n```\r\n  1) Contract: Foo test\r\n       should execute #myTransfer():\r\n     Error: TypeError: Cannot read property 'toString' of null Given value: \"null\"\r\n      at Object.toBN (node_modules/web3-utils/src/utils.js:64:15)\r\n      at _convertNumber (node_modules/@truffle/contract/lib/reformat.js:21:24)\r\n      at abiSegment.forEach (node_modules/@truffle/contract/lib/reformat.js:77:33)\r\n      at Array.forEach (<anonymous>)\r\n      at Function.numbers (node_modules/@truffle/contract/lib/reformat.js:52:14)\r\n      at logs.map.log (node_modules/@truffle/contract/lib/utils.js:78:38)\r\n      at Array.map (<anonymous>)\r\n      at Function.decodeLogs (node_modules/@truffle/contract/lib/utils.js:50:8)\r\n      at Promise.receipt (node_modules/@truffle/contract/lib/handlers.js:98:28)\r\n      at Promise.emit (node_modules/eventemitter3/index.js:181:35)\r\n      at /Users/nikita/projects/tokenizable-erc721-locker/node_modules/web3-core-method/src/index.js:353:44\r\n      at process._tickCallback (internal/process/next_tick.js:68:7)\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client: ganache-core\r\n* Solidity version: 0.4.26\r\n* Truffle version (`truffle version`): 5.0.40\r\n* node version (`node --version`): 10.15.3\r\n* npm version (`npm --version`): 6.4.1\r\n",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/541493694",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-541493694",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 541493694,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MTQ5MzY5NA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-14T03:39:40Z",
    "updated_at": "2019-10-14T03:39:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, this is a problem with event decoding at the moment, which is currently done by an external library that doesn't know how to handle such cases of overlapping signature.  I'm working on writing a new decoder that will be able to handle such cases, but it will be a while until it's fully ready and integrated into the rest of Truffle.  In the meantime perhaps we can find a workaround -- perhaps just ignoring events that cause errors?  Not a real solution, but a real solution will have to wait for the new decoder.  Sorry about this!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/541493694/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542820857",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-542820857",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 542820857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjgyMDg1Nw==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T17:59:27Z",
    "updated_at": "2019-10-16T17:59:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, a simple workaround to this is to put a try/catch around event decoding and just to print a warning if event decoding fails, rather than letting that cause the test to fail.  If anyone has time to do this, it'd be much appreciated.  Otherwise, I'll probably get to it in a few weeks.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/542820857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/543357114",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-543357114",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 543357114,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MzM1NzExNA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-17T20:52:59Z",
    "updated_at": "2019-10-17T20:52:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, started on this and turns out it's more complicated than that actually.  Doing that just results in an error stemming from `contract`.  Indeed, now that I look again, the originally reported error stems from `contract` -- it's not even the error I was thinking of!  The `null` here is presumably coming from when I wrapped event decoding in `contract` in a try/catch as well a while back; I returned `null` on decoding failure.  But now that `null` is causing problems, it seems.  Will have to track this down...",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/543357114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/543365507",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-543365507",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 543365507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MzM2NTUwNw==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-17T21:16:54Z",
    "updated_at": "2019-10-17T21:16:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, nope -- it's not that null at all!  The decoding itself isn't crashing.  I'm having trouble finding what is...",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/543365507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/543865185",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-543865185",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 543865185,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0Mzg2NTE4NQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-18T18:05:25Z",
    "updated_at": "2019-10-18T18:05:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, put up PR #2474 as a temporary workaround for this (thanks to @eggplantzzz for figuring out a significant part of the problem).  Again, a real fix will have to wait until the new decoder is ready.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/543865185/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/546458938",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-546458938",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 546458938,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NjQ1ODkzOA==",
    "user": {
      "login": "chebykin",
      "id": 2095757,
      "node_id": "MDQ6VXNlcjIwOTU3NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2095757?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chebykin",
      "html_url": "https://github.com/chebykin",
      "followers_url": "https://api.github.com/users/chebykin/followers",
      "following_url": "https://api.github.com/users/chebykin/following{/other_user}",
      "gists_url": "https://api.github.com/users/chebykin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chebykin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chebykin/subscriptions",
      "organizations_url": "https://api.github.com/users/chebykin/orgs",
      "repos_url": "https://api.github.com/users/chebykin/repos",
      "events_url": "https://api.github.com/users/chebykin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chebykin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-25T18:18:38Z",
    "updated_at": "2019-10-25T18:18:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "@haltman-at Thanks for this hotfix! Should we keep this ticket open until the new decoder?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/546458938/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/546459849",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2449#issuecomment-546459849",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2449",
    "id": 546459849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NjQ1OTg0OQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-25T18:21:27Z",
    "updated_at": "2019-10-25T18:21:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "No, I don't think that's necessary.  I'll go ahead and close this.  We can look at this again once the new decoder is ready.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/546459849/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
