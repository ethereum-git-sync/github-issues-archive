{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3164",
  "id": 656058186,
  "node_id": "MDU6SXNzdWU2NTYwNTgxODY=",
  "number": 3164,
  "title": "Compilation fails with JSON parsing error",
  "user": {
    "login": "robert-e-davidson3",
    "id": 45945043,
    "node_id": "MDQ6VXNlcjQ1OTQ1MDQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/45945043?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/robert-e-davidson3",
    "html_url": "https://github.com/robert-e-davidson3",
    "followers_url": "https://api.github.com/users/robert-e-davidson3/followers",
    "following_url": "https://api.github.com/users/robert-e-davidson3/following{/other_user}",
    "gists_url": "https://api.github.com/users/robert-e-davidson3/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/robert-e-davidson3/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/robert-e-davidson3/subscriptions",
    "organizations_url": "https://api.github.com/users/robert-e-davidson3/orgs",
    "repos_url": "https://api.github.com/users/robert-e-davidson3/repos",
    "events_url": "https://api.github.com/users/robert-e-davidson3/events{/privacy}",
    "received_events_url": "https://api.github.com/users/robert-e-davidson3/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 644098328,
      "node_id": "MDU6TGFiZWw2NDQwOTgzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20reproduced",
      "name": "needs reproduced",
      "color": "fbca04",
      "default": false,
      "description": null
    },
    {
      "id": 1403343142,
      "node_id": "MDU6TGFiZWwxNDAzMzQzMTQy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20investigated",
      "name": "needs investigated",
      "color": "b7410e",
      "default": false,
      "description": ""
    },
    {
      "id": 1675041996,
      "node_id": "MDU6TGFiZWwxNjc1MDQxOTk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority4%20%F0%9F%93%8B",
      "name": "priority4 ðŸ“‹",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-07-13T18:39:12Z",
  "updated_at": "2020-08-26T18:15:38Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ + ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue. https://gitter.im/ConsenSys/truffle?at=5f07b7dd86ccb45b599737fa\r\n\r\nThey didn't think it was related to truffle but when using solc directly we don't have this issue. Some differences though:\r\n1. When calling solc, we use the --standard-json flag.\r\n2. Our contracts have a remapping \"ROOT\" defined but that doesn't work in truffle so first we replace that in every contract, moving them to a new directory.\r\n3. The \"sources\" field in the config file is populated but with truffle it isn't.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nThe command `truffle compile` fails with a JSON parsing error.\r\n\r\n## Steps to Reproduce\r\n\r\n```\r\ngit clone git@github.com:AugurProject/augur.git\r\ncd augur\r\ngit checkout robert/echidna2\r\nyarn\r\ncd packages/augur-core\r\nyarn node --max-old-space-size=12288 ./src/tools/truffle-compile.js\r\n```\r\n\r\nThis attempts to compile but if you want to verify that the error happens from the truffle command itself, you can now run `yarn truffle compile --all` for the same result. The truffle-compile.js file is copying the contracts into a separate directory plus changing its imports to match, then actually running `truffle compile`.\r\n\r\n## Expected Behavior\r\n\r\nCompilation succeeds.\r\n\r\n## Actual Results\r\n\r\nThis error is printed:\r\n```\r\n* Line 1, Column 1\r\n  Syntax error: value, object or array expected.\r\n* Line 1, Column 2\r\n  Extra non-whitespace after JSON value.\r\n\r\nCompilation failed. See above.\r\nTruffle v5.1.33 (core: 5.1.33)\r\nNode v10.21.0\r\n```\r\n\r\nThe compile script also prints the config object:\r\n```\r\n{\r\n  \"networks\": {},\r\n  \"mocha\": {},\r\n  \"compilers\": {\r\n    \"solc\": {\r\n      \"language\": \"Solidity\",\r\n      \"version\": \"0.5.15\",\r\n      \"settings\": {\r\n        \"optimizer\": {\r\n          \"enabled\": true,\r\n          \"runs\": 200,\r\n          \"details\": {\r\n            \"yul\": true,\r\n            \"deduplicate\": true,\r\n            \"cse\": true,\r\n            \"constantOptimizer\": true\r\n          }\r\n        },\r\n        \"outputSelection\": {\r\n          \"*\": {\r\n            \"\": [\r\n              \"ast\"\r\n            ],\r\n            \"*\": [\r\n              \"abi\",\r\n              \"devdoc\",\r\n              \"userdoc\",\r\n              \"evm.bytecode.object\",\r\n              \"evm.methodIdentifiers\"\r\n            ]}}}}}}\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: 30~18.04.1-Ubuntu\r\n* Ethereum client: N/A\r\n* Truffle version (`truffle version`): v5.1.33 (core: 5.1.33)\r\n* node version (`node --version`): v10.21.0\r\n* npm version (`npm --version`): 6.14.4\r\n* yarn version(`yarn --version`): 1.22.4\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/658907014",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3164#issuecomment-658907014",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164",
    "id": 658907014,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODkwNzAxNA==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-15T17:42:48Z",
    "updated_at": "2020-07-15T17:42:48Z",
    "author_association": "MEMBER",
    "body": "Hm, interesting. Just FYI - you can't currently specify `outputSelection` yourself. I don't think that's the cause of the JSON parsing error, but probably something to be aware of. There's an [open issue](https://github.com/trufflesuite/truffle/issues/2769) to support configuring `outputSelection`, but there's some trickiness involved there â€“ e.g. getting the `evm.methodIdentifiers` from solc is one thing, but some logic would need to put that information in the artifacts... this is fine for this specific case, but it's unclear how to handle the problem more generally.\r\n\r\nRegardless, I think there's follow-up here for us to look into why the JSON going into Solidity is invalid. Adding this to our backlog to investigate, thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/658907014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/659552629",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3164#issuecomment-659552629",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164",
    "id": 659552629,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTU1MjYyOQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T17:17:35Z",
    "updated_at": "2020-07-16T17:17:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @robert-e-davidson3! I've been looking into your issue here and have reproduced your error. You mentioned that you were able to successfully compile this using another method, could you describe how you were able to successfully compile this?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/659552629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/681042420",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3164#issuecomment-681042420",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3164",
    "id": 681042420,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTA0MjQyMA==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-26T18:15:25Z",
    "updated_at": "2020-08-26T18:15:25Z",
    "author_association": "MEMBER",
    "body": "This is all very unclear with regards to how to proceed.\r\n\r\nMoving this to the backlog to make sense of.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/681042420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
