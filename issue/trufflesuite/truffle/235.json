{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/235",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/235",
  "id": 170610019,
  "node_id": "MDU6SXNzdWUxNzA2MTAwMTk=",
  "number": 235,
  "title": "Truffle test environment not cleaned up properly",
  "user": {
    "login": "zweicoder",
    "id": 3684550,
    "node_id": "MDQ6VXNlcjM2ODQ1NTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3684550?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zweicoder",
    "html_url": "https://github.com/zweicoder",
    "followers_url": "https://api.github.com/users/zweicoder/followers",
    "following_url": "https://api.github.com/users/zweicoder/following{/other_user}",
    "gists_url": "https://api.github.com/users/zweicoder/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zweicoder/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zweicoder/subscriptions",
    "organizations_url": "https://api.github.com/users/zweicoder/orgs",
    "repos_url": "https://api.github.com/users/zweicoder/repos",
    "events_url": "https://api.github.com/users/zweicoder/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zweicoder/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2016-08-11T10:01:55Z",
  "updated_at": "2016-08-23T17:46:59Z",
  "closed_at": "2016-08-23T16:09:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "During my tests I realize that unless I redeploy contracts into the blockchain via `truffle migrate --reset`, the state of the contracts are persisted sometimes. \n\nSpecifically running `truffle test afile.js` caused the state to not be properly cleaned up, causing subsequent tests to fail:\n\n```\n truffle test test/src/CheapArrayLib.js\nCompiling CheapArrayLib.sol...\nCompiling JudgeSubscriber.sol...\nCompiling test/CheapArrayLibTest.sol...\nCompiling test/JudgeSubImpl.sol...\n\n\n  Contract: CheapArrayLib\n    ✓ should start with an empty array\n    ✓ should insertAll elements (104ms)\n    ✓ should return the correct size\n    ✓ should clear elements (42ms)\n    ✓ should throw if idx for get(idx) is out of bounds\n    ✓ should still insert properly after clearing (157ms)\n    ✓ should return all elements with getAll() (70ms)\n\n\n  7 passing (2s)\n\n[pewpew:/media/code/ethereum/Judge] test(+104/-247)* ± truffle test test/src/CheapArrayLib.js\nCompiling CheapArrayLib.sol...\nCompiling JudgeSubscriber.sol...\nCompiling test/CheapArrayLibTest.sol...\nCompiling test/JudgeSubImpl.sol...\n\n\n  Contract: CheapArrayLib\n    1) should start with an empty array\n    > No events were emitted\n    ✓ should insertAll elements (97ms)\n    2) should return the correct size\n    > No events were emitted\n    ✓ should clear elements (49ms)\n    ✓ should throw if idx for get(idx) is out of bounds\n    ✓ should still insert properly after clearing (178ms)\n    ✓ should return all elements with getAll() (79ms)\n\n```\n\nI'd be happy to point you guys to the repo if more info is needed\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/235/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241542258",
    "html_url": "https://github.com/trufflesuite/truffle/issues/235#issuecomment-241542258",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235",
    "id": 241542258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTU0MjI1OA==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T20:37:46Z",
    "updated_at": "2016-08-22T20:37:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @zweicoder, would love to see the repo. If you can get this to me this week (preferably sooner) I can verify and fix this week. Sounds like a good bug.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241542258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241697192",
    "html_url": "https://github.com/trufflesuite/truffle/issues/235#issuecomment-241697192",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235",
    "id": 241697192,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTY5NzE5Mg==",
    "user": {
      "login": "zweicoder",
      "id": 3684550,
      "node_id": "MDQ6VXNlcjM2ODQ1NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3684550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zweicoder",
      "html_url": "https://github.com/zweicoder",
      "followers_url": "https://api.github.com/users/zweicoder/followers",
      "following_url": "https://api.github.com/users/zweicoder/following{/other_user}",
      "gists_url": "https://api.github.com/users/zweicoder/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zweicoder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zweicoder/subscriptions",
      "organizations_url": "https://api.github.com/users/zweicoder/orgs",
      "repos_url": "https://api.github.com/users/zweicoder/repos",
      "events_url": "https://api.github.com/users/zweicoder/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zweicoder/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-23T11:00:13Z",
    "updated_at": "2016-08-23T11:00:43Z",
    "author_association": "NONE",
    "body": "@tcoulter [Here](https://github.com/zweicoder/Judge/tree/test) it is. Haven't touched it in a while, but to reproduce you can try:\n1.  `npm install && npm build:test` \n2. `truffle test test/src/CheapArrayLib.js`\n3. `truffle test` or run 2. again.\n\nTell me if it doesn't reproduce / was due to some bugs in my tests!\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241697192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241786392",
    "html_url": "https://github.com/trufflesuite/truffle/issues/235#issuecomment-241786392",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235",
    "id": 241786392,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTc4NjM5Mg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-23T16:09:54Z",
    "updated_at": "2016-08-23T16:09:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Unfortunately I can't reproduce this. The second run seems to work fine for me.\n\nHowever, I did find something interesting. Specifically, on this line here: https://github.com/zweicoder/Judge/blob/test/migrations/2_deploy_contracts.js#L6\n\nYou shouldn't use `NODE_ENV` in this case -- at least, I wouldn't recommend it. Instead, you should specifically code for the network you're planning to use: e.g., http://truffle.readthedocs.io/en/latest/getting_started/migrations/#network-considerations\n\nIn this case, you should use check to see if `network == \"test\"`, as that would produce the desired result, using a workflow that is also supported by Truffle. `NODE_ENV` might just work, actually, but I can't make any guarantees, but it could also be the cause of the issue.\n\nI'm going to close this one for now. If you continue to run into it, please reopen this ticket or create a new one. Thanks!\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241786392/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241812454",
    "html_url": "https://github.com/trufflesuite/truffle/issues/235#issuecomment-241812454",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235",
    "id": 241812454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTgxMjQ1NA==",
    "user": {
      "login": "zweicoder",
      "id": 3684550,
      "node_id": "MDQ6VXNlcjM2ODQ1NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3684550?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zweicoder",
      "html_url": "https://github.com/zweicoder",
      "followers_url": "https://api.github.com/users/zweicoder/followers",
      "following_url": "https://api.github.com/users/zweicoder/following{/other_user}",
      "gists_url": "https://api.github.com/users/zweicoder/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zweicoder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zweicoder/subscriptions",
      "organizations_url": "https://api.github.com/users/zweicoder/orgs",
      "repos_url": "https://api.github.com/users/zweicoder/repos",
      "events_url": "https://api.github.com/users/zweicoder/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zweicoder/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-23T17:37:03Z",
    "updated_at": "2016-08-23T17:37:03Z",
    "author_association": "NONE",
    "body": "@tcoulter  Indeed you are right! I made the amendments you suggested and it works fine now, thanks!\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241812454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241815565",
    "html_url": "https://github.com/trufflesuite/truffle/issues/235#issuecomment-241815565",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/235",
    "id": 241815565,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTgxNTU2NQ==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-23T17:46:59Z",
    "updated_at": "2016-08-23T17:46:59Z",
    "author_association": "CONTRIBUTOR",
    "body": ":clap: No problem. :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/241815565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
