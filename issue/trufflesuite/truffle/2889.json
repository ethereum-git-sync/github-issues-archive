{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2889",
  "id": 582670298,
  "node_id": "MDU6SXNzdWU1ODI2NzAyOTg=",
  "number": 2889,
  "title": "Cannot inspect mappings with addresses as keys",
  "user": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-03-17T00:14:14Z",
  "updated_at": "2020-03-18T17:35:34Z",
  "closed_at": "2020-03-17T05:07:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue. ([Link](https://gitter.im/ConsenSys/truffle?at=5e6ad246d8cd7e214f03ddf2))\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nMappings that have addresses as keys can't be inspected in debugger.\r\n\r\n## Steps to Reproduce\r\n\r\n1. Run `truffle unbox metacoin` in some directory\r\n2. Start `ganache-cli` in another terminal\r\n3. Configure the development network to use 8545 as port (probably not necessary if you start ganache-cli in 7545, but that's how I did it)\r\n4. Run `truffle test`\r\n5. Run `truffle compile` (`truffle debug` doesn't seem to compile the contracts if they weren't compiled yet, maybe another issue?)\r\n6. Run `truffle debug` with the last transaction, that calls the `sendCoin` method\r\n7. Step over until you reach the first line of the method\r\n8. Run `:balances` or `:balances[msg.sender]`\r\n\r\n## Expected Behavior\r\n\r\n`:balances` should show the map with the proper contents, and `:balances[msg.sender]` should show 10000\r\n\r\n## Actual Results\r\n\r\nI got `Map {}` and `undefined`, respectively.\r\n\r\n## Environment\r\n\r\n* Operating System: Ubuntu 19.10\r\n* Ethereum client: Not relevant?\r\n* Truffle version (`truffle version`): 5.1.17\r\n* node version (`node --version`): 10.18.1\r\n* npm version (`npm --version`): 6.13.4\r\n",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/599880339",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2889#issuecomment-599880339",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889",
    "id": 599880339,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTg4MDMzOQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-17T05:07:22Z",
    "updated_at": "2020-03-17T05:07:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah, I see the problem.  I'm afraid I'm going to have to close this as a won't-fix for now.  The problem has nothing to do with using addresses as mapping keys.\r\n\r\nThe problem is that you're asking to see `msg.sender` appear in the list of keys for `balances` at the start of the function, before `balances[msg.sender]` is accessed in the transaction.  Step a bit further, to after this is accessed, and you'll see both `balances` and `balances[msg.sender]` appear correctly.\r\n\r\nOK, but why should you have to step that far to see the correct value?  Shouldn't it be correct as soon as `balances` comes in scope?  Well, that would certainly be nice, ideally that's how it would work, but unfortunately this touches on several fundamental limitations of the debugger:\r\n1. First and most obviously, even if we got `balances[msg.sender]` right, there's simply no way that `balances` can appear with `msg.sender` as a key before `balances[msg.sender]` has been accessed, because before that there simply isn't any way for the debugger to know that `msg.sender` even is a key.  This one isn't so much a limitation of the debugger as a limitation of Solidity -- mappings don't track their keys, so there's no way for the debugger to know a given mapping's keys before those keys are accessed.  Now you might ask, OK, maybe I could manually enter keys for it to watch?  Unfortunately that runs up against the other problems, as you'll see...\r\n2. So on seeing the above, you might say, OK, sure, the debugger can't get `balances` right due to Solidity's limitations, but maybe it could at least get `balances[msg.sender]` right, given that determining that doesn't require knowing what the keys are?  And, yes, notionally such a thing would be possible.  But right now that's not how watch expressions work; watch expressions (as opposed to watch individual variables) are kind of a crude hack where we take the decoded Solidity variables and then interpret the expression as JavaScript.  It's awful, yes.  But in order to do better, we'd need, basically, a Solidity interpreter, and we don't have that at the moment, unless we're going to write our own, which would be a substantial undertaking.  So that's out.  But OK -- maybe we could at least add a way that you could manually add `msg.sender` as a key to watch, as I suggested above?  And then things would be OK?  And this is where we run into the biggest problem...\r\n3. The problem that all of the above suggestions run into is that the debugger can only see storage that has been accessed during the transaction.  Even if you could inspect `balances[msg.sender]` before that key was accessed, you wouldn't get the right value for it; you'd just get 0.  (You can try this yourself with other sorts of state variables -- you'll notice the debugger always shows them as 0 until accessed, or until something sharing a slot with them is accessed.)  See, the debugger works by analyzing a trace it gets from the ethereum client, and these traces only show the storage that was accessed, not all the storage.  So, if a storage slot hasn't been accessed, we simply have no way to know its value, under the current architecture.  In order to provide correct values for storage variables before they're accessed, we'd have to do a bunch of additional work to determine their starting values at the beginning of the transaction.  And, let me tell you, that is not as easy as it might sound.\r\n\r\nNow, in the long run, I'm planning to write a \"reconstruct mode\" for the debugger, that will *do* that additional work, remove limitation (3) (well, mostly, anyway), and allow manual watching of mapping keys, at the cost of a longer startup time.  However, that's a long way off, and there's simply no way to fix the problem you describe without that.  In the meantime, I'm closing this issue.  For now I'm afraid you're just going to have to content yourself with only being able to see mapping values after the corresponding keys have been accessed.  Sorry...\r\n\r\n(Meanwhile, trying this example has made me realize that we don't handle tabs properly when it comes to positioning the carets that show where in the code you are, yikes!  I'll have to fix that...)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/599880339/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600290656",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2889#issuecomment-600290656",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889",
    "id": 600290656,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMDI5MDY1Ng==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-17T20:51:03Z",
    "updated_at": "2020-03-17T20:51:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "All that said, I should really open an issue for this reconstruct mode I've been talking about, even if it's not high-priority at the moment and so won't be gotten to for a while.  I'll go do that and it'll be linked here! :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600290656/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600761863",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2889#issuecomment-600761863",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889",
    "id": 600761863,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMDc2MTg2Mw==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-18T17:24:47Z",
    "updated_at": "2020-03-18T17:24:47Z",
    "author_association": "NONE",
    "body": "Thank you for the detailed explanation! It totally makes sense for this to be a won't fix. Keep up the amazing work :smiley: ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600761863/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600767212",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2889#issuecomment-600767212",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2889",
    "id": 600767212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMDc2NzIxMg==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-18T17:35:33Z",
    "updated_at": "2020-03-18T17:35:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks!  We will get to making reconstruct mode eventually, it's just pretty low-priority at the moment. :)  Unfortunately making it work for mappings runs into additional complications and will probably never really be convenient, but I'm hopeful that I can at least make it workable...",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600767212/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
