{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3873",
  "id": 815454213,
  "node_id": "MDU6SXNzdWU4MTU0NTQyMTM=",
  "number": 3873,
  "title": "Support of solidity new overflow and divide by 0 error messages",
  "user": {
    "login": "sirhill",
    "id": 4115788,
    "node_id": "MDQ6VXNlcjQxMTU3ODg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4115788?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sirhill",
    "html_url": "https://github.com/sirhill",
    "followers_url": "https://api.github.com/users/sirhill/followers",
    "following_url": "https://api.github.com/users/sirhill/following{/other_user}",
    "gists_url": "https://api.github.com/users/sirhill/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sirhill/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sirhill/subscriptions",
    "organizations_url": "https://api.github.com/users/sirhill/orgs",
    "repos_url": "https://api.github.com/users/sirhill/repos",
    "events_url": "https://api.github.com/users/sirhill/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sirhill/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-02-24T12:58:10Z",
  "updated_at": "2022-03-03T22:55:31Z",
  "closed_at": "2022-03-03T22:55:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nSolidity are now preventing overflow and division by 0 errors which were previously managed by `SafeMath.sol` lib.\r\nAs stated by @chriseth, solidity should now returns nice error messages.\r\n\r\nIt's interesting to note that ganache support partially this as it may returns out-of-bounds in the case of positive overflows (both for `add` and `mul`).\r\n \r\n\r\n## Steps to Reproduce\r\n\r\n```\r\ncontract SafeMath {\r\n\r\n  function mul(uint256 a, uint256 b) public pure returns (uint256 c) {\r\n    return a * b;\r\n  }\r\n\r\n  function div(uint256 a, uint256 b) public pure returns (uint256) {\r\n    return a / b;\r\n  }\r\n\r\n  function sub(uint256 a, uint256 b) public pure returns (uint256) {\r\n    return a - b;\r\n  }\r\n\r\n  function add(uint256 a, uint256 b) public pure returns (uint256 c) {\r\n    return a + b;\r\n  }\r\n}\r\n```\r\n\r\n## Expected Behavior\r\n\r\nA nice error message saying the call or the transaction reverted due of an overflow error or a division by 0.\r\n\r\n## Actual Results\r\n\r\nIn truffle (rpc@ropsten):\r\n\r\nAs a call:\r\n```\r\ntruffle(goerli01)> safeMath.add(MAX_UINT, 1).then((x) => x.toString())\r\n'35408467139433450592217433187231851964531694900788300625387963629091585785856'\r\n```\r\n\r\nAs a transaction:\r\n``` reason: undefined,\r\n  hijackedStack: 'StatusError: Transaction: 0x......  exited with an error (status 0). \\n' +\r\n    '     Please check that the transaction:\\n' +\r\n    '     - satisfies all conditions set by Solidity `require` statements.\\n' +\r\n    '     - does not trigger a Solidity `revert` statement.\\n' +\r\n    '\\n' +\r\n    '    at Object.receipt (/home/node/.config/yarn/global/node_modules/truffle/build/webpack:/packages/contract/lib/handlers.js:128:1)\\n' +\r\n    '    at runMicrotasks (<anonymous>)\\n' +\r\n    '    at processTicksAndRejections (internal/process/task_queues.js:93:5)\\n' +\r\n    '    at Function.start (/home/node/.config/yarn/global/node_modules/truffle/build/webpack:/packages/contract/lib/override.js:49:1)'\r\n}\r\n```\r\n\r\nIn Ganache\r\n```\r\n  1) Contract: SafeMath\r\n       should prevent add overflow:\r\n     AssertionError: Expected 'invalid opcode', got Error: value out-of-bounds (argument=\"a\", value=-1, code=INVALID_ARGUMENT, version=abi/5.0.0-beta.153) instead\r\n      at module.exports (test/helpers/assertJump.js:12:5)\r\n      at runMicrotasks (<anonymous>)\r\n      at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n      at Context.<anonymous> (test/math/SafeMath.js:23:5)\r\n\r\n  2) Contract: SafeMath\r\n       should prevent sub overflow:\r\n     AssertionError: Expected 'invalid opcode', got Error: Returned error: VM Exception while processing transaction: revert instead\r\n      at module.exports (test/helpers/assertJump.js:12:5)\r\n      at Context.<anonymous> (test/math/SafeMath.js:32:5)\r\n```\r\n\r\n## Environment\r\n\r\nbash-5.1$ truffle version\r\nTruffle v5.1.66 (core: 5.1.66)\r\nSolidity - 0.8.1 (solc-js)\r\nNode v14.15.4\r\nWeb3.js v1.2.9\r\n",
  "closed_by": {
    "login": "lsqproduction",
    "id": 12772017,
    "node_id": "MDQ6VXNlcjEyNzcyMDE3",
    "avatar_url": "https://avatars.githubusercontent.com/u/12772017?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lsqproduction",
    "html_url": "https://github.com/lsqproduction",
    "followers_url": "https://api.github.com/users/lsqproduction/followers",
    "following_url": "https://api.github.com/users/lsqproduction/following{/other_user}",
    "gists_url": "https://api.github.com/users/lsqproduction/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lsqproduction/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lsqproduction/subscriptions",
    "organizations_url": "https://api.github.com/users/lsqproduction/orgs",
    "repos_url": "https://api.github.com/users/lsqproduction/repos",
    "events_url": "https://api.github.com/users/lsqproduction/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lsqproduction/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785285894",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3873#issuecomment-785285894",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
    "id": 785285894,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTI4NTg5NA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T18:36:01Z",
    "updated_at": "2021-02-24T18:36:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Worth noting, we do support this in `truffle test --stacktrace`. :)  But I agree, it would be good to support this more generally!  Of course some of this is a Ganache matter, so I'll ping @davidmurdoch here.  Also some of this may have to wait as it may require rewriting quite a bit, so not all of this will be coming so soon...",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785285894/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785292271",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3873#issuecomment-785292271",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
    "id": 785292271,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTI5MjI3MQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T18:45:29Z",
    "updated_at": "2021-02-24T18:45:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "In more detail -- the first problem you point out actually has nothing to do with the new panics; if you used a revert message there instead, you'd see that that also currently doesn't work properly!  Fixing that case is I'm hard I'm afraid, but we're working on it.\r\n\r\nThe second case, again, fixing that is also troublesome, but we're working on it.  At least, if I understand it correctly -- there's not a lot of detail there.  Like, I'm not clear on why you're looking at `hijackedStack`?  What about the actual main stacktrace?  (Not that you'll get a good error message there either, but it would seem to be the more relevant thing to look at?)\r\n\r\nAs for the last of these, with Ganache... I'm not entirely clear on what you're doing there, so I'm not entirely clear on what the issue is.  Still, you might want to file a separate issue [there](https://github.com/trufflesuite/ganache-core/) regarding whatever the problem is.  It is true that Ganache does not currently have handling for the new panics.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785292271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785387715",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3873#issuecomment-785387715",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
    "id": 785387715,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTM4NzcxNQ==",
    "user": {
      "login": "sirhill",
      "id": 4115788,
      "node_id": "MDQ6VXNlcjQxMTU3ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4115788?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sirhill",
      "html_url": "https://github.com/sirhill",
      "followers_url": "https://api.github.com/users/sirhill/followers",
      "following_url": "https://api.github.com/users/sirhill/following{/other_user}",
      "gists_url": "https://api.github.com/users/sirhill/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sirhill/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sirhill/subscriptions",
      "organizations_url": "https://api.github.com/users/sirhill/orgs",
      "repos_url": "https://api.github.com/users/sirhill/repos",
      "events_url": "https://api.github.com/users/sirhill/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sirhill/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T21:12:48Z",
    "updated_at": "2021-02-24T21:13:38Z",
    "author_association": "NONE",
    "body": "This issue not urgent. It's neither business critical or blocking.\r\nI've reported for general improvement as I think it shall improve the developer experience.\r\n\r\nAll the logs provided refers to the same issue but in different context.\r\nIn the first two, I am using truffle on goerli (ie through geth rpc)\r\n1) is a call (the natural use since the function are pure),\r\n2) is a force transaction to see how the transaction will be reverted. If desired I can definetely provide you with the Tx hash but the only interested part where there is the reason of what it fails is in the hijack part of the result.\r\n\r\nThe last one,\r\n3) is using ganache and chai on testcases of SafeMath.\r\n\r\nMy testcase was designed for 0.6.12 and hence expect the invalid opcode result.\r\nYou may find it here: https://github.com/c-layer/contracts/blob/d2605ee58bc89941c1e2da61077d1f441914fe6f/common/test/math/SafeMath.js#L22\r\nHowever here the same testcases are run against a 0.8.1 compiled contract which does not use the usual SafeMath assert.\r\nWhat's interesting is that the exception is catched with a surprisingly `out-of-bounds exception` and return a specific message when the overflow is on the upper bound (`add` and `mul`). However, we only have a trivial VM Exception when the overflow is from the lower bound (`sub`) or when there is a divide by 0 (`div`)\r\n\r\nI hope the context of the different logs are clearer now.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785387715/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785401417",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3873#issuecomment-785401417",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
    "id": 785401417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTQwMTQxNw==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T21:37:52Z",
    "updated_at": "2021-02-24T21:37:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, thanks for the extra info!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/785401417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1035391589",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3873#issuecomment-1035391589",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
    "id": 1035391589,
    "node_id": "IC_kwDOAkfq-c49ttJl",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-10T19:29:41Z",
    "updated_at": "2022-02-10T19:29:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "(Re-upping this issue per discussion on trufflesuite/ganache#758 -- maybe we should get to the panic codes part of this sooner, even if custom errors have to wait?)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1035391589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1058603116",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3873#issuecomment-1058603116",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3873",
    "id": 1058603116,
    "node_id": "IC_kwDOAkfq-c4_GQBs",
    "user": {
      "login": "lsqproduction",
      "id": 12772017,
      "node_id": "MDQ6VXNlcjEyNzcyMDE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/12772017?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsqproduction",
      "html_url": "https://github.com/lsqproduction",
      "followers_url": "https://api.github.com/users/lsqproduction/followers",
      "following_url": "https://api.github.com/users/lsqproduction/following{/other_user}",
      "gists_url": "https://api.github.com/users/lsqproduction/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lsqproduction/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lsqproduction/subscriptions",
      "organizations_url": "https://api.github.com/users/lsqproduction/orgs",
      "repos_url": "https://api.github.com/users/lsqproduction/repos",
      "events_url": "https://api.github.com/users/lsqproduction/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lsqproduction/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-03T22:55:31Z",
    "updated_at": "2022-03-03T22:55:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "added in release v5.5.3",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1058603116/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
