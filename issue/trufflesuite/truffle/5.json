{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5",
  "id": 93532980,
  "node_id": "MDU6SXNzdWU5MzUzMjk4MA==",
  "number": 5,
  "title": "Support synchronous testing of transactions",
  "user": {
    "login": "tymat",
    "id": 849457,
    "node_id": "MDQ6VXNlcjg0OTQ1Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/849457?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tymat",
    "html_url": "https://github.com/tymat",
    "followers_url": "https://api.github.com/users/tymat/followers",
    "following_url": "https://api.github.com/users/tymat/following{/other_user}",
    "gists_url": "https://api.github.com/users/tymat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tymat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tymat/subscriptions",
    "organizations_url": "https://api.github.com/users/tymat/orgs",
    "repos_url": "https://api.github.com/users/tymat/repos",
    "events_url": "https://api.github.com/users/tymat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tymat/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2015-07-07T13:42:59Z",
  "updated_at": "2015-07-07T16:21:33Z",
  "closed_at": "2015-07-07T16:21:33Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Given a Solidity code that looks like this:\n\n```\ncontract TestContract\n   address public addr;\n   function setter(address a) {\n      addr = a;\n   }\n}\n```\n\nWe would get:\n\n```\nTestContract.at(TestContract.deployed_address).setter(val).sendTransaction({from: caller})\n```\n\nand\n\n```\nTestContract.at(TestContract.deployed_address).addr.call()\n```\n\nIt would be nice to have a way to be able to synchronously test this by making the test framework determine the tx_blocknumber where the transaction was created then wait a few blocks until such that current_blocknumber > (tx_blocknumber + number) to ensure that the transaction commits to TX storage and be able to make assertions on the results.  \n\nThere will be situations where the value of addr can be changed by other contracts or EOAs and we would like to be able to elegantly test these different cases.\n",
  "closed_by": {
    "login": "tymat",
    "id": 849457,
    "node_id": "MDQ6VXNlcjg0OTQ1Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/849457?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tymat",
    "html_url": "https://github.com/tymat",
    "followers_url": "https://api.github.com/users/tymat/followers",
    "following_url": "https://api.github.com/users/tymat/following{/other_user}",
    "gists_url": "https://api.github.com/users/tymat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tymat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tymat/subscriptions",
    "organizations_url": "https://api.github.com/users/tymat/orgs",
    "repos_url": "https://api.github.com/users/tymat/repos",
    "events_url": "https://api.github.com/users/tymat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tymat/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119225858",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5#issuecomment-119225858",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5",
    "id": 119225858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExOTIyNTg1OA==",
    "user": {
      "login": "tymat",
      "id": 849457,
      "node_id": "MDQ6VXNlcjg0OTQ1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/849457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tymat",
      "html_url": "https://github.com/tymat",
      "followers_url": "https://api.github.com/users/tymat/followers",
      "following_url": "https://api.github.com/users/tymat/following{/other_user}",
      "gists_url": "https://api.github.com/users/tymat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tymat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tymat/subscriptions",
      "organizations_url": "https://api.github.com/users/tymat/orgs",
      "repos_url": "https://api.github.com/users/tymat/repos",
      "events_url": "https://api.github.com/users/tymat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tymat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-07T14:45:37Z",
    "updated_at": "2015-07-07T14:45:37Z",
    "author_association": "NONE",
    "body": "See this for our rationale:\n\nhttps://github.com/LeastAuthority/ethereum-analyses/blob/master/GasEcon.md#predictability\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119225858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119237694",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5#issuecomment-119237694",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5",
    "id": 119237694,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExOTIzNzY5NA==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-07T15:22:33Z",
    "updated_at": "2015-07-07T15:22:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @tymat. If I understand what you wrote correctly, this is already built in. Truffle uses [Pudding](https://github.com/ConsenSys/ether-pudding) under the hood, which makes ABI functions and sendTransaction() not call their callback until the transaction has been processed. The syntax is different than your example, but the effect is the same. Pudding uses promises to allow you to write the following:\n\n``` coffeescript\nval = \"...\" # some address\ntest = TestContract.at(TestContract.deployed_address)\ntest.setter(val, {from: caller}).then (tx) ->\n  # This code block won't be executed until the transaction tx has been processed.\n  # Note: The next line returns a promise.\n  test.addr.call()\n.then (addr) ->\n  assert.isEqual(addr, val)\n```\n\nThis should produce the effect you're looking for. Let me know if I misunderstood.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119237694/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119238101",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5#issuecomment-119238101",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5",
    "id": 119238101,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExOTIzODEwMQ==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-07T15:24:17Z",
    "updated_at": "2015-07-07T15:24:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "The function within Pudding that does exactly what you described is here: https://github.com/ConsenSys/ether-pudding/blob/master/src/pudding.coffee#L100\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119238101/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119249611",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5#issuecomment-119249611",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5",
    "id": 119249611,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExOTI0OTYxMQ==",
    "user": {
      "login": "tymat",
      "id": 849457,
      "node_id": "MDQ6VXNlcjg0OTQ1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/849457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tymat",
      "html_url": "https://github.com/tymat",
      "followers_url": "https://api.github.com/users/tymat/followers",
      "following_url": "https://api.github.com/users/tymat/following{/other_user}",
      "gists_url": "https://api.github.com/users/tymat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tymat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tymat/subscriptions",
      "organizations_url": "https://api.github.com/users/tymat/orgs",
      "repos_url": "https://api.github.com/users/tymat/repos",
      "events_url": "https://api.github.com/users/tymat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tymat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-07T16:03:19Z",
    "updated_at": "2015-07-07T16:03:19Z",
    "author_association": "NONE",
    "body": "@tcoulter Thanks.  That seems to work.  Is there a way to set the timeout values?   \n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119249611/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119258445",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5#issuecomment-119258445",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5",
    "id": 119258445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExOTI1ODQ0NQ==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-07T16:19:10Z",
    "updated_at": "2015-07-07T16:19:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ya, that's a feature of mocha. There are three different scopes the timeouts can apply to. Consider this example:\n\n``` coffeescript\ncontract \"TestContract\", (accounts) ->\n  # Each test has a timeout of ten seconds.\n  @timeout(10000) \n\n  before \"do something before\", (done) ->\n    # This before() hook has a timeout of 15 seconds.\n    @timeout(15000)\n\n  it \"should test something\", (done) ->\n    # This test has a timeout of 30 seconds.\n    @timeout(30000)\n\n  it \"should do something else\", (done) ->\n    # This test only has a timeout of 10 seconds, based on the timeout above.\n```\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/119258445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
