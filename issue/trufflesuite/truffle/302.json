{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/302",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/302",
  "id": 189233852,
  "node_id": "MDU6SXNzdWUxODkyMzM4NTI=",
  "number": 302,
  "title": "Generated getter for mapping from address => uint256[] generating incorrect ABI",
  "user": {
    "login": "dob",
    "id": 10389,
    "node_id": "MDQ6VXNlcjEwMzg5",
    "avatar_url": "https://avatars.githubusercontent.com/u/10389?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dob",
    "html_url": "https://github.com/dob",
    "followers_url": "https://api.github.com/users/dob/followers",
    "following_url": "https://api.github.com/users/dob/following{/other_user}",
    "gists_url": "https://api.github.com/users/dob/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dob/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dob/subscriptions",
    "organizations_url": "https://api.github.com/users/dob/orgs",
    "repos_url": "https://api.github.com/users/dob/repos",
    "events_url": "https://api.github.com/users/dob/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dob/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2016-11-14T21:39:28Z",
  "updated_at": "2018-08-18T20:23:18Z",
  "closed_at": "2016-11-14T21:50:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [X] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nIn my contract I have:\r\n   \r\n    mapping (address => uint256[]) public idsForContract;\r\n\r\nThe ABI in the truffle generated app.js file Contracts.all_networks object lists the output as\r\n\r\n    \"name\": \"idsForContract\",\r\n    \"outputs\": [\r\n      {\r\n        \"name\": \"\",\r\n        \"type\": \"uint256\"\r\n      }\r\n    ],\r\n\r\nNote that the output is of type `uint256` instead of `uint256[]` which means that when I invoked the getter through web3, I get the `Unhandled rejection BigNumber Error: new BigNumber() not a number: [object Object]` which seems to occur on invalid deserializations when the ABI doesn't match what's being returned from the contract.\r\n\r\nIf I write my own getter\r\n\r\n    function getIdsForContract(address _contractAddress) returns (uint256[]) {\r\n        return idsForContract[_contractAddress];\r\n    }\r\n\r\nThe ABI for this method is correct with `uint256[]` as the output type, and invoking through web3 works correctly.\r\n\r\n## Steps to Reproduce\r\n\r\n1. `truffle init`\r\n2. Open `MetaCoin.sol` and add the line `mapping (address => uint256[]) public myMapping;`\r\n2. Run `truffle build`\r\n3. Look at the Contracts.all_networks object in build/app.js for myMapping's generated getter.\r\n4. See if it has an output with type `uint256` instead of `uint256[]`.\r\n\r\n## Expected Behavior\r\n\r\nOutput type should be `uint256[]`.\r\n\r\n## Actual Results\r\n\r\nOutput type is `uint256`.\r\n\r\nExamples listed above, with the main symptom being that web3 can't deserialize return value from the getter via `contractObject.myMapping.call(....)`\r\n\r\n## Environment\r\n\r\n* Operating System: OS X 10.11.4\r\n* Truffle version: 2.1.1\r\n* Ethereum client: Geth 1.4.18\r\n* node version: 4.6.0\r\n* npm version: 2.15.9\r\n",
  "closed_by": {
    "login": "tcoulter",
    "id": 92629,
    "node_id": "MDQ6VXNlcjkyNjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tcoulter",
    "html_url": "https://github.com/tcoulter",
    "followers_url": "https://api.github.com/users/tcoulter/followers",
    "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
    "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
    "organizations_url": "https://api.github.com/users/tcoulter/orgs",
    "repos_url": "https://api.github.com/users/tcoulter/repos",
    "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tcoulter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/302/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260473997",
    "html_url": "https://github.com/trufflesuite/truffle/issues/302#issuecomment-260473997",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302",
    "id": 260473997,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDQ3Mzk5Nw==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-14T21:50:08Z",
    "updated_at": "2016-11-14T21:50:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "This ABI interface isn't created by Truffle. Instead, it's created by the `solc` compiler. Solidity doesn't create a function for you that returns an array; instead, it creates a function that takes (in this case) an address as the input and returns the associated uint256 based on the mapping. Calling this function might look something like this:\n\n``` javascript\ncontractObject.myMapping.call(\"0x1234...\") // => 5\n```\n\nBecause Solidity creates this function and ABI, there's nothing Truffle can do about it. This isn't a Truffle issue, and is instead \"as designed\" by the Solidity language designers. Please bring an issue up with them if you believe this to be incorrect.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260473997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260493753",
    "html_url": "https://github.com/trufflesuite/truffle/issues/302#issuecomment-260493753",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302",
    "id": 260493753,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDQ5Mzc1Mw==",
    "user": {
      "login": "dob",
      "id": 10389,
      "node_id": "MDQ6VXNlcjEwMzg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/10389?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dob",
      "html_url": "https://github.com/dob",
      "followers_url": "https://api.github.com/users/dob/followers",
      "following_url": "https://api.github.com/users/dob/following{/other_user}",
      "gists_url": "https://api.github.com/users/dob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dob/subscriptions",
      "organizations_url": "https://api.github.com/users/dob/orgs",
      "repos_url": "https://api.github.com/users/dob/repos",
      "events_url": "https://api.github.com/users/dob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-14T23:08:28Z",
    "updated_at": "2016-11-14T23:08:28Z",
    "author_association": "NONE",
    "body": "Thanks. Figured it may be a solc issue, so I'll hunt down where to bring that up with them. I don't understand the design decision that a `mapping (address => uint[])` would return \"an associated uint\", since the address is clearly associated with an array of uint and not a single one.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260493753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260495736",
    "html_url": "https://github.com/trufflesuite/truffle/issues/302#issuecomment-260495736",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302",
    "id": 260495736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDQ5NTczNg==",
    "user": {
      "login": "tcoulter",
      "id": 92629,
      "node_id": "MDQ6VXNlcjkyNjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/92629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tcoulter",
      "html_url": "https://github.com/tcoulter",
      "followers_url": "https://api.github.com/users/tcoulter/followers",
      "following_url": "https://api.github.com/users/tcoulter/following{/other_user}",
      "gists_url": "https://api.github.com/users/tcoulter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tcoulter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tcoulter/subscriptions",
      "organizations_url": "https://api.github.com/users/tcoulter/orgs",
      "repos_url": "https://api.github.com/users/tcoulter/repos",
      "events_url": "https://api.github.com/users/tcoulter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tcoulter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-14T23:18:16Z",
    "updated_at": "2016-11-14T23:18:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh wow. I didn't actually see that the mapping mapped addresses to a uint array. I admittedly wrote this hastily. Thanks for bringing this up.\n\nMy hunch is that the above is still correct, in that this is not a Truffle issue. Truffle never generates or modifies ABIs, so this has to come from a solidity compiler. However, I'm not sure what it should do in this case. \n\nIt might actually create a function that takes in two parameters, like so:\n\n``` javascript\ncontractObject.myMapping.call(\"0x1234...\", 7) // => 5\n```\n\nWhere the `7` is the array index of the array specified by the address in the mapping. This is my hunch. \n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260495736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260496801",
    "html_url": "https://github.com/trufflesuite/truffle/issues/302#issuecomment-260496801",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302",
    "id": 260496801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDQ5NjgwMQ==",
    "user": {
      "login": "dob",
      "id": 10389,
      "node_id": "MDQ6VXNlcjEwMzg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/10389?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dob",
      "html_url": "https://github.com/dob",
      "followers_url": "https://api.github.com/users/dob/followers",
      "following_url": "https://api.github.com/users/dob/following{/other_user}",
      "gists_url": "https://api.github.com/users/dob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dob/subscriptions",
      "organizations_url": "https://api.github.com/users/dob/orgs",
      "repos_url": "https://api.github.com/users/dob/repos",
      "events_url": "https://api.github.com/users/dob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-14T23:23:28Z",
    "updated_at": "2016-11-14T23:23:28Z",
    "author_association": "NONE",
    "body": "Wow, just tested it and you're right\n\n```\ntap.idsForContract.call(\"0x131bec75342a54ffea3087bda5ba720394c486a9\", 0).then(function(res){ console.log(res.toNumber())}) // => 5\n```\n\nI didn't expect that, since I didn't see a second argument to a getter documented anywhere...but there it is in the ABI. \n\n```\n\"inputs\": [\n      {\n        \"name\": \"\",\n        \"type\": \"address\"\n      },\n      {\n        \"name\": \"\",\n        \"type\": \"uint256\"\n      }\n    ],\n```\n\nSo I guess the pattern is to call some sort of `getLengthForAddress(address)` function first, and then make successive calls for each element in the array. Thanks.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/260496801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328293484",
    "html_url": "https://github.com/trufflesuite/truffle/issues/302#issuecomment-328293484",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/302",
    "id": 328293484,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODI5MzQ4NA==",
    "user": {
      "login": "mattlockyer",
      "id": 321340,
      "node_id": "MDQ6VXNlcjMyMTM0MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/321340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattlockyer",
      "html_url": "https://github.com/mattlockyer",
      "followers_url": "https://api.github.com/users/mattlockyer/followers",
      "following_url": "https://api.github.com/users/mattlockyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattlockyer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattlockyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattlockyer/subscriptions",
      "organizations_url": "https://api.github.com/users/mattlockyer/orgs",
      "repos_url": "https://api.github.com/users/mattlockyer/repos",
      "events_url": "https://api.github.com/users/mattlockyer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattlockyer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-09T17:55:06Z",
    "updated_at": "2017-09-09T17:56:03Z",
    "author_association": "NONE",
    "body": "You can make a constant function that returns the array, this will allow you to get the whole array in one shot:\r\n```\r\nmapping(address => uint256[]) indicies;\r\nfunction getIndicies(address who) constant returns (uint256[]) {\r\n  return indicies[who];\r\n}\r\n```\r\nNote: only the type uint can be returned as an array",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/328293484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
