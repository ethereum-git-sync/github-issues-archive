{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4059",
  "id": 897417905,
  "node_id": "MDU6SXNzdWU4OTc0MTc5MDU=",
  "number": 4059,
  "title": "Error in Open Zeppelin's `expectRevert` when used with `truffle run coverage`",
  "user": {
    "login": "David-Kneel",
    "id": 83882373,
    "node_id": "MDQ6VXNlcjgzODgyMzcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/83882373?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/David-Kneel",
    "html_url": "https://github.com/David-Kneel",
    "followers_url": "https://api.github.com/users/David-Kneel/followers",
    "following_url": "https://api.github.com/users/David-Kneel/following{/other_user}",
    "gists_url": "https://api.github.com/users/David-Kneel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/David-Kneel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/David-Kneel/subscriptions",
    "organizations_url": "https://api.github.com/users/David-Kneel/orgs",
    "repos_url": "https://api.github.com/users/David-Kneel/repos",
    "events_url": "https://api.github.com/users/David-Kneel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/David-Kneel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-20T20:32:41Z",
  "updated_at": "2021-05-25T23:08:35Z",
  "closed_at": "2021-05-25T23:08:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [✔️] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen run `truffle run coverage`, the `expectRevert` command results in a failure. Now if triggered by `truffle test`, there is no failure in `expectRevert`'s execution.\r\n\r\n## Steps to Reproduce\r\n\r\n- clone [this repository](https://github.com/David-Kneel/faster-than-light.git)\r\n- run:\r\n```terminal\r\ngit submodule init\r\ngit submodule update\r\nyarn install\r\nyarn coverage\r\n```\r\n\r\n## Expected Behavior\r\n\r\nAll tests should pass regardless if triggered by `yarn coverage` or `yarn test`\r\n\r\n## Actual Results\r\n\r\n```zsh\r\n❯ yarn coveralls\r\nyarn run v1.22.10\r\n$ yarn coverage && cat coverage/lcov.info | coveralls\r\n$ truffle run coverage\r\n\r\n> Using Truffle library from local node_modules.\r\n\r\n> server:            http://127.0.0.1:8555\r\n> truffle:           v5.3.6\r\n> ganache-core:      v2.13.0\r\n> solidity-coverage: v0.7.16\r\n\r\nNetwork Info\r\n============\r\n> id:      *\r\n> port:    8555\r\n> network: soliditycoverage\r\n\r\n\r\nInstrumenting for coverage...\r\n=============================\r\n\r\n> abdk-libraries-solidity/ABDKMath64x64.sol\r\n> abdk-libraries-solidity/ABDKMathQuad.sol\r\n> YieldFarming.sol\r\n> YieldFarmingToken.sol\r\n\r\nCoverage skipped for:\r\n=====================\r\n\r\n> Migrations.sol\r\n\r\nCompiling your contracts...\r\n===========================\r\n✔ Fetching solc version list from solc-bin. Attempt #1\r\n> Compiling ./.coverage_contracts/Migrations.sol\r\n> Compiling ./.coverage_contracts/YieldFarming.sol\r\n> Compiling ./.coverage_contracts/YieldFarmingToken.sol\r\n> Compiling ./.coverage_contracts/abdk-libraries-solidity/ABDKMath64x64.sol\r\n> Compiling ./.coverage_contracts/abdk-libraries-solidity/ABDKMathQuad.sol\r\n> Compiling @openzeppelin/contracts/access/Ownable.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/ERC20.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/IERC20.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/extensions/ERC20Burnable.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/utils/TokenTimelock.sol\r\n> Compiling @openzeppelin/contracts/utils/Address.sol\r\n> Compiling @openzeppelin/contracts/utils/Context.sol\r\n✔ Fetching solc version list from solc-bin. Attempt #1\r\n> Artifacts written to /home/daniel/Workspaces/Tachyonic/Personal/faster-than-light/.coverage_artifacts/contracts\r\n> Compiled successfully using:\r\n   - solc: 0.8.4+commit.c7e474f2.Emscripten.clang\r\n\r\n\r\nCompiling your contracts...\r\n===========================\r\n✔ Fetching solc version list from solc-bin. Attempt #1\r\n> Everything is up to date, there is nothing to compile.\r\n\r\n\r\n\r\n  Contract: YieldFarming\r\n    ✓ Ownership (136ms)\r\n    Release token\r\n      ✓ after unlock (2144ms)\r\n\r\n\r\n  2 passing (3s)\r\n\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\nFile                                |  % Stmts | % Branch |  % Funcs |  % Lines |Uncovered Lines |\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\n contracts/                         |      100 |       50 |      100 |      100 |                |\r\n  YieldFarming.sol                  |      100 |       50 |      100 |      100 |                |\r\n  YieldFarmingToken.sol             |      100 |      100 |      100 |      100 |                |\r\n contracts/abdk-libraries-solidity/ |      100 |      100 |    15.79 |    15.79 |                |\r\n  ABDKMath64x64.sol                 |      100 |      100 |        0 |        0 |... 659,678,728 |\r\n  ABDKMathQuad.sol                  |      100 |      100 |       30 |       30 |... 66,990,1198 |\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\nAll files                           |      100 |       50 |       25 |    33.33 |                |\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\n\r\n> Istanbul reports written to ./coverage/ and ./coverage.json\r\n> solidity-coverage cleaning up, shutting down ganache server\r\nDone in 28.92s.\r\n❯ yarn coveralls\r\nyarn run v1.22.10\r\n$ yarn coverage && cat coverage/lcov.info | coveralls\r\n$ truffle run coverage\r\n\r\n> Using Truffle library from local node_modules.\r\n\r\n> server:            http://127.0.0.1:8555\r\n> truffle:           v5.3.6\r\n> ganache-core:      v2.13.0\r\n> solidity-coverage: v0.7.16\r\n\r\nNetwork Info\r\n============\r\n> id:      *\r\n> port:    8555\r\n> network: soliditycoverage\r\n\r\n\r\nInstrumenting for coverage...\r\n=============================\r\n\r\n> abdk-libraries-solidity/ABDKMath64x64.sol\r\n> abdk-libraries-solidity/ABDKMathQuad.sol\r\n> YieldFarming.sol\r\n> YieldFarmingToken.sol\r\n\r\nCoverage skipped for:\r\n=====================\r\n\r\n> Migrations.sol\r\n\r\nCompiling your contracts...\r\n===========================\r\n✔ Fetching solc version list from solc-bin. Attempt #1\r\n> Compiling ./.coverage_contracts/Migrations.sol\r\n> Compiling ./.coverage_contracts/YieldFarming.sol\r\n> Compiling ./.coverage_contracts/YieldFarmingToken.sol\r\n> Compiling ./.coverage_contracts/abdk-libraries-solidity/ABDKMath64x64.sol\r\n> Compiling ./.coverage_contracts/abdk-libraries-solidity/ABDKMathQuad.sol\r\n> Compiling @openzeppelin/contracts/access/Ownable.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/ERC20.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/IERC20.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/extensions/ERC20Burnable.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/extensions/IERC20Metadata.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol\r\n> Compiling @openzeppelin/contracts/token/ERC20/utils/TokenTimelock.sol\r\n> Compiling @openzeppelin/contracts/utils/Address.sol\r\n> Compiling @openzeppelin/contracts/utils/Context.sol\r\n✔ Fetching solc version list from solc-bin. Attempt #1\r\n> Artifacts written to /home/daniel/Workspaces/Tachyonic/Personal/faster-than-light/.coverage_artifacts/contracts\r\n> Compiled successfully using:\r\n   - solc: 0.8.4+commit.c7e474f2.Emscripten.clang\r\n\r\n\r\nCompiling your contracts...\r\n===========================\r\n✔ Fetching solc version list from solc-bin. Attempt #1\r\n> Everything is up to date, there is nothing to compile.\r\n\r\n\r\n\r\n  Contract: YieldFarming\r\n    ✓ Ownership (200ms)\r\n    Release token\r\n      1) before unlock\r\n\r\n    Events emitted during test:\r\n    ---------------------------\r\n\r\n    Ownable.OwnershipTransferred(\r\n      previousOwner: <indexed> 0x0000000000000000000000000000000000000000 (type: address),\r\n      newOwner: <indexed> 0x8C62793E27cf14e3074be39817F84faabc39c8be (type: address)\r\n    )\r\n\r\n    Ownable.OwnershipTransferred(\r\n      previousOwner: <indexed> 0x0000000000000000000000000000000000000000 (type: address),\r\n      newOwner: <indexed> 0x6a4F343faC135136b6482B280df8305B03018F51 (type: address)\r\n    )\r\n\r\n    IERC20.Transfer(\r\n      from: <indexed> 0x0000000000000000000000000000000000000000 (type: address),\r\n      to: <indexed> 0x6d0982d6A0f46aE78141cDB761a5455241D4812f (type: address),\r\n      value: 14426950408889 (type: uint256)\r\n    )\r\n\r\n\r\n    ---------------------------\r\n      ✓ after unlock (2141ms)\r\n\r\n\r\n  2 passing (5s)\r\n  1 failing\r\n\r\n  1) Contract: YieldFarming\r\n       Release token\r\n         before unlock:\r\n     Error: Invalid JSON RPC response: \"\"\r\n      at Object.InvalidResponse (node_modules/@openzeppelin/test-helpers/node_modules/web3-core-helpers/lib/errors.js:43:16)\r\n      at XMLHttpRequest.request.onreadystatechange (node_modules/@openzeppelin/test-helpers/node_modules/web3-providers-http/lib/index.js:95:32)\r\n      at XMLHttpRequestEventTarget.dispatchEvent (node_modules/xhr2-cookies/xml-http-request-event-target.ts:44:13)\r\n      at XMLHttpRequest._setReadyState (node_modules/xhr2-cookies/xml-http-request.ts:219:8)\r\n      at XMLHttpRequest._onHttpRequestError (node_modules/xhr2-cookies/xml-http-request.ts:379:8)\r\n      at ClientRequest.<anonymous> (node_modules/xhr2-cookies/xml-http-request.ts:266:37)\r\n      at Socket.socketErrorListener (_http_client.js:427:9)\r\n      at emitErrorNT (internal/streams/destroy.js:92:8)\r\n      at emitErrorAndCloseNT (internal/streams/destroy.js:60:3)\r\n      at processTicksAndRejections (internal/process/task_queues.js:84:21)\r\n\r\n\r\n\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\nFile                                |  % Stmts | % Branch |  % Funcs |  % Lines |Uncovered Lines |\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\n contracts/                         |      100 |       50 |      100 |      100 |                |\r\n  YieldFarming.sol                  |      100 |       50 |      100 |      100 |                |\r\n  YieldFarmingToken.sol             |      100 |      100 |      100 |      100 |                |\r\n contracts/abdk-libraries-solidity/ |      100 |      100 |    15.79 |    15.79 |                |\r\n  ABDKMath64x64.sol                 |      100 |      100 |        0 |        0 |... 659,678,728 |\r\n  ABDKMathQuad.sol                  |      100 |      100 |       30 |       30 |... 66,990,1198 |\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\nAll files                           |      100 |       50 |       25 |    33.33 |                |\r\n------------------------------------|----------|----------|----------|----------|----------------|\r\n\r\n> Istanbul reports written to ./coverage/ and ./coverage.json\r\n> solidity-coverage cleaning up, shutting down ganache server\r\nError: ❌ 1 test(s) failed under coverage.\r\n    at plugin (/home/daniel/Workspaces/Tachyonic/Personal/faster-than-light/node_modules/solidity-coverage/plugins/truffle.plugin.js:121:27)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\nTruffle v5.3.6 (core: 5.3.6)\r\nNode v12.22.1\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n```\r\n\r\nThis situation is evidenced in the following [GitHub actions run](https://github.com/David-Kneel/faster-than-light/runs/2632461150?check_suite_focus=true)\r\n\r\n## Environment\r\n\r\n* Operating System: Ubuntu LTS 20.04.2\r\n* Ethereum client: ganache\r\n* Truffle version (`truffle version`): 5.3.6\r\n* node version (`node --version`): 10.x and 12.x\r\n* npm version (`npm --version`): 7.13.0\r\n",
  "closed_by": {
    "login": "David-Kneel",
    "id": 83882373,
    "node_id": "MDQ6VXNlcjgzODgyMzcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/83882373?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/David-Kneel",
    "html_url": "https://github.com/David-Kneel",
    "followers_url": "https://api.github.com/users/David-Kneel/followers",
    "following_url": "https://api.github.com/users/David-Kneel/following{/other_user}",
    "gists_url": "https://api.github.com/users/David-Kneel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/David-Kneel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/David-Kneel/subscriptions",
    "organizations_url": "https://api.github.com/users/David-Kneel/orgs",
    "repos_url": "https://api.github.com/users/David-Kneel/repos",
    "events_url": "https://api.github.com/users/David-Kneel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/David-Kneel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/848329036",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4059#issuecomment-848329036",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4059",
    "id": 848329036,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0ODMyOTAzNg==",
    "user": {
      "login": "David-Kneel",
      "id": 83882373,
      "node_id": "MDQ6VXNlcjgzODgyMzcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/83882373?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/David-Kneel",
      "html_url": "https://github.com/David-Kneel",
      "followers_url": "https://api.github.com/users/David-Kneel/followers",
      "following_url": "https://api.github.com/users/David-Kneel/following{/other_user}",
      "gists_url": "https://api.github.com/users/David-Kneel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/David-Kneel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/David-Kneel/subscriptions",
      "organizations_url": "https://api.github.com/users/David-Kneel/orgs",
      "repos_url": "https://api.github.com/users/David-Kneel/repos",
      "events_url": "https://api.github.com/users/David-Kneel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/David-Kneel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-25T23:08:35Z",
    "updated_at": "2021-05-25T23:08:35Z",
    "author_association": "NONE",
    "body": "Worked around with this: https://github.com/sc-forks/solidity-coverage/issues/634#issuecomment-846261108",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/848329036/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
