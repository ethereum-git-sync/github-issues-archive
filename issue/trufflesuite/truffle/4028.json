{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4028",
  "id": 886364210,
  "node_id": "MDU6SXNzdWU4ODYzNjQyMTA=",
  "number": 4028,
  "title": "Deploying contracts to Avalanche results in an 'invalid sender' error",
  "user": {
    "login": "Klemah",
    "id": 36085723,
    "node_id": "MDQ6VXNlcjM2MDg1NzIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/36085723?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Klemah",
    "html_url": "https://github.com/Klemah",
    "followers_url": "https://api.github.com/users/Klemah/followers",
    "following_url": "https://api.github.com/users/Klemah/following{/other_user}",
    "gists_url": "https://api.github.com/users/Klemah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Klemah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Klemah/subscriptions",
    "organizations_url": "https://api.github.com/users/Klemah/orgs",
    "repos_url": "https://api.github.com/users/Klemah/repos",
    "events_url": "https://api.github.com/users/Klemah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Klemah/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-05-11T07:42:09Z",
  "updated_at": "2021-05-12T16:11:00Z",
  "closed_at": "2021-05-12T16:11:00Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nMy colleagues and I are completely unable to deploy any contract on the Avalanche testnet using Truffle.\r\nThe issue started occurring at the beginning of May.\r\n\r\nThe scripts I am using for deployment are the same I have always used, and they all started failing for me, my colleagues, as well as others, at the same time. We think this is linked to a recent update on Avalanche, the Avalanche Berlin update.\r\n\r\nSo far, most people who encountered this issue just decided to stop using Truffle and started using Hardhat or Remix instead, whether they like it or not, as no problem is occurring on their side. I cannot do the same, as this issue also occurs when using ChainBridge's `cb-sol-cli` commands.\r\n\r\n[A similar issue happened for Ropsten back in March.](https://stackoverflow.com/questions/66735307/truffle-contract-deployment-failed-invalid-sender)\r\n\r\n## Steps to Reproduce\r\n\r\nThe error you will get depends of what version of `@truffle/hdwallet-provider` or `truffle-hdwallet-provider` you use.\r\n\r\nTry to deploy a basic ERC20 token contract to the Avalanche testnet using a basic NodeJS script, using Truffle's hdwallet-provider.\r\n\r\n## Expected Behavior\r\n\r\nI expect a successful token deployment.\r\n\r\n## Actual Results\r\n\r\nIf using `@truffle/hdwallet-provider: 1.3.x` or newer: we get the `invalid sender` error.\r\nIf using `@truffle/hdwallet-provider: 1.2.x` or older, or any version of `truffle-hdwallet-provider`: the error will be either `cannot query unfinalized data` or `only replay-protected (EIP-155) transactions allowed over RPC` depending on the contract you want to deploy. Sometimes, you will even get both errors at the same time.\r\n\r\nBefore this error started occurring, I was using the latest version of `truffle-hdwallet-provider`.\r\n\r\n## Environment\r\n\r\n* Operating System: Windows 10\r\n* node version (`node --version`): `10.24.0`\r\n* npm version (`npm --version`): `6.14.11`\r\n\r\n## More info\r\n\r\nYou can find more info [here](https://community.figment.io/t/error-invalid-sender-while-deploying-contracts-using-truffle/238).\r\nSome of the posts suggested adding the chain ID to the hdwallet-provider constructor, but this does not fix the issue.\r\n\r\nTrying to deploy bridge contracts on the Avalanche testnet using ChainBridge's `cb-sol-cli` commands also fails with the `invalid sender` error.\r\n",
  "closed_by": {
    "login": "Klemah",
    "id": 36085723,
    "node_id": "MDQ6VXNlcjM2MDg1NzIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/36085723?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Klemah",
    "html_url": "https://github.com/Klemah",
    "followers_url": "https://api.github.com/users/Klemah/followers",
    "following_url": "https://api.github.com/users/Klemah/following{/other_user}",
    "gists_url": "https://api.github.com/users/Klemah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Klemah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Klemah/subscriptions",
    "organizations_url": "https://api.github.com/users/Klemah/orgs",
    "repos_url": "https://api.github.com/users/Klemah/repos",
    "events_url": "https://api.github.com/users/Klemah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Klemah/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/838614629",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4028#issuecomment-838614629",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028",
    "id": 838614629,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzODYxNDYyOQ==",
    "user": {
      "login": "NHebrard",
      "id": 6865690,
      "node_id": "MDQ6VXNlcjY4NjU2OTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6865690?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NHebrard",
      "html_url": "https://github.com/NHebrard",
      "followers_url": "https://api.github.com/users/NHebrard/followers",
      "following_url": "https://api.github.com/users/NHebrard/following{/other_user}",
      "gists_url": "https://api.github.com/users/NHebrard/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NHebrard/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NHebrard/subscriptions",
      "organizations_url": "https://api.github.com/users/NHebrard/orgs",
      "repos_url": "https://api.github.com/users/NHebrard/repos",
      "events_url": "https://api.github.com/users/NHebrard/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NHebrard/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-11T14:50:57Z",
    "updated_at": "2021-05-11T14:50:57Z",
    "author_association": "NONE",
    "body": "Hello,\r\n\r\nI am also experiencing the same issue. As @Klemah, the issue started beginning of May.\r\nI had to switch to hardhat.\r\n\r\nHere is my setup:\r\n* `@truffle/hdwallet-provider`: `1.3.1`\r\n* `@truffle`: `5.3.5`\r\n* `web3`: `1.3.5`\r\n* `node`: `14.16.1` (latest LTS)\r\n\r\nThanks.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/838614629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/838639629",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4028#issuecomment-838639629",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028",
    "id": 838639629,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzODYzOTYyOQ==",
    "user": {
      "login": "blackwidoq",
      "id": 77246667,
      "node_id": "MDQ6VXNlcjc3MjQ2NjY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/77246667?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blackwidoq",
      "html_url": "https://github.com/blackwidoq",
      "followers_url": "https://api.github.com/users/blackwidoq/followers",
      "following_url": "https://api.github.com/users/blackwidoq/following{/other_user}",
      "gists_url": "https://api.github.com/users/blackwidoq/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blackwidoq/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blackwidoq/subscriptions",
      "organizations_url": "https://api.github.com/users/blackwidoq/orgs",
      "repos_url": "https://api.github.com/users/blackwidoq/repos",
      "events_url": "https://api.github.com/users/blackwidoq/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blackwidoq/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-11T15:03:18Z",
    "updated_at": "2021-05-11T15:03:18Z",
    "author_association": "NONE",
    "body": "Hello, I believe I was running into the same issue. I chatted with the OP on Discord. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/838639629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839430222",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4028#issuecomment-839430222",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028",
    "id": 839430222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzOTQzMDIyMg==",
    "user": {
      "login": "rajranjan0608",
      "id": 40765810,
      "node_id": "MDQ6VXNlcjQwNzY1ODEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40765810?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rajranjan0608",
      "html_url": "https://github.com/rajranjan0608",
      "followers_url": "https://api.github.com/users/rajranjan0608/followers",
      "following_url": "https://api.github.com/users/rajranjan0608/following{/other_user}",
      "gists_url": "https://api.github.com/users/rajranjan0608/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rajranjan0608/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rajranjan0608/subscriptions",
      "organizations_url": "https://api.github.com/users/rajranjan0608/orgs",
      "repos_url": "https://api.github.com/users/rajranjan0608/repos",
      "events_url": "https://api.github.com/users/rajranjan0608/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rajranjan0608/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-12T04:47:43Z",
    "updated_at": "2021-05-12T04:47:43Z",
    "author_association": "NONE",
    "body": "Yes. This issue started appearing eventually from the last few weeks, while deploying contracts using Truffle.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839430222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839877960",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4028#issuecomment-839877960",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028",
    "id": 839877960,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzOTg3Nzk2MA==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-12T15:43:42Z",
    "updated_at": "2021-05-12T15:43:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "We released version 1.4.0 of @truffle/hdwallet-provider yesterday. We made some improvements that might fix your issue, can you upgrade and see if it fixes this issue? Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839877960/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839907627",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4028#issuecomment-839907627",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4028",
    "id": 839907627,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzOTkwNzYyNw==",
    "user": {
      "login": "Klemah",
      "id": 36085723,
      "node_id": "MDQ6VXNlcjM2MDg1NzIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/36085723?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Klemah",
      "html_url": "https://github.com/Klemah",
      "followers_url": "https://api.github.com/users/Klemah/followers",
      "following_url": "https://api.github.com/users/Klemah/following{/other_user}",
      "gists_url": "https://api.github.com/users/Klemah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Klemah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Klemah/subscriptions",
      "organizations_url": "https://api.github.com/users/Klemah/orgs",
      "repos_url": "https://api.github.com/users/Klemah/repos",
      "events_url": "https://api.github.com/users/Klemah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Klemah/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-12T16:10:56Z",
    "updated_at": "2021-05-12T16:10:56Z",
    "author_association": "NONE",
    "body": "> We released version 1.4.0 of @truffle/hdwallet-provider yesterday. We made some improvements that might fix your issue, can you upgrade and see if it fixes this issue? Thanks!\r\n\r\nHey, it fixes the issue indeed!\r\n\r\nThank you sir!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839907627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
