{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2838",
  "id": 567678109,
  "node_id": "MDU6SXNzdWU1Njc2NzgxMDk=",
  "number": 2838,
  "title": "Link an address to a contract as a library in deployer",
  "user": {
    "login": "bwheeler96",
    "id": 1840364,
    "node_id": "MDQ6VXNlcjE4NDAzNjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1840364?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bwheeler96",
    "html_url": "https://github.com/bwheeler96",
    "followers_url": "https://api.github.com/users/bwheeler96/followers",
    "following_url": "https://api.github.com/users/bwheeler96/following{/other_user}",
    "gists_url": "https://api.github.com/users/bwheeler96/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bwheeler96/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bwheeler96/subscriptions",
    "organizations_url": "https://api.github.com/users/bwheeler96/orgs",
    "repos_url": "https://api.github.com/users/bwheeler96/repos",
    "events_url": "https://api.github.com/users/bwheeler96/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bwheeler96/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 971536096,
      "node_id": "MDU6TGFiZWw5NzE1MzYwOTY=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Migrations",
      "name": "Migrations",
      "color": "b887db",
      "default": false,
      "description": ""
    },
    {
      "id": 1086852667,
      "node_id": "MDU6TGFiZWwxMDg2ODUyNjY3",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20requirements",
      "name": "needs requirements",
      "color": "d4c5f9",
      "default": false,
      "description": "feature request is unclear"
    },
    {
      "id": 1675041356,
      "node_id": "MDU6TGFiZWwxNjc1MDQxMzU2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority2%20%E2%9A%A0%EF%B8%8F",
      "name": "priority2 ⚠️",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 17,
  "created_at": "2020-02-19T16:27:07Z",
  "updated_at": "2022-02-24T21:20:53Z",
  "closed_at": "2022-02-24T21:20:53Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nMy contract has a `libary Lib {}` in it. I would like to use an existing library in the migrations script.\r\n\r\nSomething like:\r\n\r\n`deployer.linkAddressAsLibrary('0xabcde...', 'AnExistingLibraryOnChain')`\r\n\r\n",
  "closed_by": {
    "login": "lsqproduction",
    "id": 12772017,
    "node_id": "MDQ6VXNlcjEyNzcyMDE3",
    "avatar_url": "https://avatars.githubusercontent.com/u/12772017?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lsqproduction",
    "html_url": "https://github.com/lsqproduction",
    "followers_url": "https://api.github.com/users/lsqproduction/followers",
    "following_url": "https://api.github.com/users/lsqproduction/following{/other_user}",
    "gists_url": "https://api.github.com/users/lsqproduction/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lsqproduction/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lsqproduction/subscriptions",
    "organizations_url": "https://api.github.com/users/lsqproduction/orgs",
    "repos_url": "https://api.github.com/users/lsqproduction/repos",
    "events_url": "https://api.github.com/users/lsqproduction/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lsqproduction/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/588388330",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-588388330",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 588388330,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4ODM4ODMzMA==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-19T18:58:02Z",
    "updated_at": "2020-02-19T18:58:02Z",
    "author_association": "MEMBER",
    "body": "Looks like the missing piece is an equivalent for `deployer.deploy()`... right now the process is:\r\n\r\n```javascript\r\ndeployer.deploy(MyLibrary);\r\ndeployer.link(MyLibrary, MyContract);\r\ndeployer.deploy(MyContract);\r\n```\r\n\r\nBut you already have a deployed library... you just need that instance to be recorded in the artifact JSON. So I think a better solution is a deployer method to record the already-deployed library. Maybe something like this:\r\n\r\n```javascript\r\ndeployer.recordDeployed(MyLibrary, \"<address>\");\r\ndeployer.link(MyLibrary, MyContract);\r\ndeployer.deploy(MyContract);\r\n```\r\n\r\nSomething like that?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/588388330/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/588450841",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-588450841",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 588450841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4ODQ1MDg0MQ==",
    "user": {
      "login": "bwheeler96",
      "id": 1840364,
      "node_id": "MDQ6VXNlcjE4NDAzNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1840364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bwheeler96",
      "html_url": "https://github.com/bwheeler96",
      "followers_url": "https://api.github.com/users/bwheeler96/followers",
      "following_url": "https://api.github.com/users/bwheeler96/following{/other_user}",
      "gists_url": "https://api.github.com/users/bwheeler96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bwheeler96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bwheeler96/subscriptions",
      "organizations_url": "https://api.github.com/users/bwheeler96/orgs",
      "repos_url": "https://api.github.com/users/bwheeler96/repos",
      "events_url": "https://api.github.com/users/bwheeler96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bwheeler96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-19T20:46:20Z",
    "updated_at": "2020-02-19T20:46:20Z",
    "author_association": "NONE",
    "body": "@gnidan something like that yes. Here is the simplest use case I can think of:\r\n\r\n`Library A` exists on main chain/kovan wherever, but for local development you want to use your own.\r\n\r\nIn local development, you link your own `Library A`, but then for mainnet migrations you use the on-chain version.\r\n\r\nThere are more complex cases, like what I am trying to do saving code by embedding constant addresses that don't belong in the code itself, but also don't belong in the constructor of the contract. So I use `library` as a way to embed constant addresses dynamically.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/588450841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/592017743",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-592017743",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 592017743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjAxNzc0Mw==",
    "user": {
      "login": "bwheeler96",
      "id": 1840364,
      "node_id": "MDQ6VXNlcjE4NDAzNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1840364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bwheeler96",
      "html_url": "https://github.com/bwheeler96",
      "followers_url": "https://api.github.com/users/bwheeler96/followers",
      "following_url": "https://api.github.com/users/bwheeler96/following{/other_user}",
      "gists_url": "https://api.github.com/users/bwheeler96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bwheeler96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bwheeler96/subscriptions",
      "organizations_url": "https://api.github.com/users/bwheeler96/orgs",
      "repos_url": "https://api.github.com/users/bwheeler96/repos",
      "events_url": "https://api.github.com/users/bwheeler96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bwheeler96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-27T15:21:24Z",
    "updated_at": "2020-02-27T15:21:24Z",
    "author_association": "NONE",
    "body": "@gnidan This actually already works, the key is that `.link` returns a thenable, so it must be awaited. Here is what works for me\r\n\r\n```\r\nawait MyContract.link('CustomLibraryName', '0xabcde...')\r\n```\r\n\r\nAlternatively you could use `.then()` syntax.\r\n\r\nAlso, it should be noted that my deploy script must be setup like this for `async` to work:\r\n\r\n```\r\nasync function doDeploy() {\r\n  await ...\r\n}\r\n\r\nmodule.exports = (deployer, network) => {\r\n  deployer.then(async () => {\r\n    await doDeploy(deployer, network)\r\n  })\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/592017743/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/593480212",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-593480212",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 593480212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MzQ4MDIxMg==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-02T16:09:58Z",
    "updated_at": "2020-03-02T16:09:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Do note @bwheeler96 that the exported function in your migration can be `async`. So you can do\r\n```\r\nmodule.exports = async (deployer, network) => {\r\n  const instance = await deployer.deploy(MyContract);\r\n  ... // do other stuff\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/593480212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/593497827",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-593497827",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 593497827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MzQ5NzgyNw==",
    "user": {
      "login": "bwheeler96",
      "id": 1840364,
      "node_id": "MDQ6VXNlcjE4NDAzNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1840364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bwheeler96",
      "html_url": "https://github.com/bwheeler96",
      "followers_url": "https://api.github.com/users/bwheeler96/followers",
      "following_url": "https://api.github.com/users/bwheeler96/following{/other_user}",
      "gists_url": "https://api.github.com/users/bwheeler96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bwheeler96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bwheeler96/subscriptions",
      "organizations_url": "https://api.github.com/users/bwheeler96/orgs",
      "repos_url": "https://api.github.com/users/bwheeler96/repos",
      "events_url": "https://api.github.com/users/bwheeler96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bwheeler96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-02T16:44:28Z",
    "updated_at": "2020-03-02T16:44:28Z",
    "author_association": "NONE",
    "body": "@eggplantzzz I agree that this **should** be true, but someone, somewhere showed an example where there appeared to be some issue with exporting an async function.\r\n\r\nI'm not sure if this is node version thing, not really a thing at all, or some other weirdness, but this code works for me and I'm afraid to change it :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/593497827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/599578756",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-599578756",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 599578756,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTU3ODc1Ng==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T14:50:13Z",
    "updated_at": "2020-03-16T14:50:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, I have never had any problems making the exported migration functions async. If you come across a specific example where this doesn't work I would be very interested in seeing it to troubleshoot it!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/599578756/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/859124768",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-859124768",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 859124768,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1OTEyNDc2OA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-10T22:31:12Z",
    "updated_at": "2021-06-10T22:31:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, I had been thinking `deployer.link(Library, Contract, libraryAddress)` for the syntax, but this approach possibly makes more sense, as my way might lead to a bunch of repetition.  We probably don't want to call it `linkAddressAsLibrary`, as it's not performing linking per se... `setAddressForLibrary`?  IDK, we can come up with something to call it.  Anyway I suppose any of these approaches would essentially solve the problem.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/859124768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/938605113",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-938605113",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 938605113,
    "node_id": "IC_kwDOAkfq-c438fo5",
    "user": {
      "login": "blockchainguyy",
      "id": 29248543,
      "node_id": "MDQ6VXNlcjI5MjQ4NTQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29248543?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blockchainguyy",
      "html_url": "https://github.com/blockchainguyy",
      "followers_url": "https://api.github.com/users/blockchainguyy/followers",
      "following_url": "https://api.github.com/users/blockchainguyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/blockchainguyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blockchainguyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blockchainguyy/subscriptions",
      "organizations_url": "https://api.github.com/users/blockchainguyy/orgs",
      "repos_url": "https://api.github.com/users/blockchainguyy/repos",
      "events_url": "https://api.github.com/users/blockchainguyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blockchainguyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-08T12:30:30Z",
    "updated_at": "2021-10-08T12:49:15Z",
    "author_association": "NONE",
    "body": "Hi @bwheeler96 , @gnidan , @eggplantzzz , @haltman-at \r\n\r\nI tried the recommended solution: `await MyContract.link('CustomLibraryName', '0xabcde...')` with the following truffle version:\r\n```\r\nTruffle v5.4.14 (core: 5.4.14)\r\nSolidity v0.5.16 (solc-js)\r\nNode v16.1.0\r\nWeb3.js v1.5.3\r\n\r\n```\r\nand it is not working for me. \r\n\r\nThese are the example contracts I'm using:\r\n\r\nB.sol:\r\n```js\r\n// SPDX-License-Identifier: MIT\r\npragma solidity >=0.4.22 <0.9.0;\r\n\r\nlibrary B {\r\n    function b() public view returns (address) {\r\n        return address(this);\r\n    }\r\n}\r\n\r\n```\r\n\r\nA.sol:\r\n```js\r\n// SPDX-License-Identifier: MIT\r\npragma solidity >=0.4.22 <0.9.0;\r\n\r\nimport \"./B.sol\";\r\n\r\ncontract A {\r\n    constructor() public {\r\n        require(B.b() != address(this), \"Lib not linked\");\r\n    }\r\n}\r\n\r\n```\r\n\r\nIn the migration script I have tried both:\r\n```js\r\nawait A.link(B, \"0xe78A0F7E598Cc8b0Bb87894B0F60dD2a88d6a8Ab\"); // this is a ganache address for Lib B\r\nawait deployer.deploy(A);\r\n```\r\nand\r\n\r\n```js\r\nB = await B.at(\"0xe78A0F7E598Cc8b0Bb87894B0F60dD2a88d6a8Ab\");\r\nawait deployer.link(B, A);\r\n```\r\n\r\nPlease help me here. I really need this feature because it does not make sense to deploy contract libraries on mainnet with unchanged bytecode.\r\n\r\nLinking works fine if I deploy the Lib and link it in one go, but I am unable to link a previously deployed Lib using truffle.\r\n\r\nPS: I can create a truffle project and push it if you want.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/938605113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/938879951",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-938879951",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 938879951,
    "node_id": "IC_kwDOAkfq-c439ivP",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-08T17:08:21Z",
    "updated_at": "2021-10-08T17:08:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ayusht11 The various syntaxes discussed in this issue weren't recommendations for solutions you presently use, but rather were suggestions for features we could implement.  We have not in fact implemented any of these, so presently none of these will work.  This issue remains open; we still need to create a syntax for doing this.  Sorry about that, but thank you for reminding us of this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/938879951/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/938883867",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-938883867",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 938883867,
    "node_id": "IC_kwDOAkfq-c439jsb",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-08T17:10:14Z",
    "updated_at": "2021-10-08T17:10:14Z",
    "author_association": "MEMBER",
    "body": "(Moving this to \"new issues\" so that we can triage as a team next ticket processing)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/938883867/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1041080370",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1041080370",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1041080370,
    "node_id": "IC_kwDOAkfq-c4-DaAy",
    "user": {
      "login": "cyrto",
      "id": 17877883,
      "node_id": "MDQ6VXNlcjE3ODc3ODgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17877883?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cyrto",
      "html_url": "https://github.com/cyrto",
      "followers_url": "https://api.github.com/users/cyrto/followers",
      "following_url": "https://api.github.com/users/cyrto/following{/other_user}",
      "gists_url": "https://api.github.com/users/cyrto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cyrto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cyrto/subscriptions",
      "organizations_url": "https://api.github.com/users/cyrto/orgs",
      "repos_url": "https://api.github.com/users/cyrto/repos",
      "events_url": "https://api.github.com/users/cyrto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cyrto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-16T04:04:34Z",
    "updated_at": "2022-02-19T04:33:56Z",
    "author_association": "NONE",
    "body": "It worked for me, but still have some problem, It ’s not a real link, just like skip the validation.\r\n```\r\nMyLibrary.address = \"<address>\"\r\ndeployer.link(MyLibrary, MyContract);\r\ndeployer.deploy(MyContract);\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1041080370/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1041966775",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1041966775",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1041966775,
    "node_id": "IC_kwDOAkfq-c4-Gya3",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-16T18:14:26Z",
    "updated_at": "2022-02-16T18:14:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "That's an interesting hack that I imagine might work in some cases, but isn't really a general solution, and directly modifiying `MyLibrary.address` like that isn't really something we can endorse or support.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1041966775/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1043627162",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1043627162",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1043627162,
    "node_id": "IC_kwDOAkfq-c4-NHya",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-17T23:37:41Z",
    "updated_at": "2022-02-17T23:37:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey, I just had an idea for how to handle this.  (Which I am realizing now was implcitly suggested by @ayusht11 above, but we don't seem to have taken much notice of it at the time, presumably because it wasn't given as an explicit suggestion.)\r\n\r\nWe could handle this by allowing the first argument of `link` to be a library *instance* rather than a library class.  Then you could do `await library = Library.at(address); deployer.link(library, Contract)`.  That seems like it would be a fairly natural extension of the current syntax.  What do people think of that?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1043627162/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1043628663",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1043628663",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1043628663,
    "node_id": "IC_kwDOAkfq-c4-NIJ3",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-17T23:39:12Z",
    "updated_at": "2022-02-17T23:39:12Z",
    "author_association": "MEMBER",
    "body": "> We could handle this by allowing the first argument of link to be a library instance rather than a library class. Then you could do await library = Library.at(address); deployer.link(library, Contract). That seems like it would be a fairly natural extension of the current syntax. What do people think of that?\n\nThat's great! Sorry we missed the suggestion @ayusht11!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1043628663/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1043678129",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1043678129",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1043678129,
    "node_id": "IC_kwDOAkfq-c4-NUOx",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T00:38:00Z",
    "updated_at": "2022-02-18T00:38:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Cool, I've put up #4752 to finally do something about this!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1043678129/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1044082959",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1044082959",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1044082959,
    "node_id": "IC_kwDOAkfq-c4-O3EP",
    "user": {
      "login": "blockchainguyy",
      "id": 29248543,
      "node_id": "MDQ6VXNlcjI5MjQ4NTQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29248543?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blockchainguyy",
      "html_url": "https://github.com/blockchainguyy",
      "followers_url": "https://api.github.com/users/blockchainguyy/followers",
      "following_url": "https://api.github.com/users/blockchainguyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/blockchainguyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blockchainguyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blockchainguyy/subscriptions",
      "organizations_url": "https://api.github.com/users/blockchainguyy/orgs",
      "repos_url": "https://api.github.com/users/blockchainguyy/repos",
      "events_url": "https://api.github.com/users/blockchainguyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blockchainguyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T07:50:10Z",
    "updated_at": "2022-02-18T07:50:10Z",
    "author_association": "NONE",
    "body": "Thanks @gnidan @haltman-at\r\n\r\nThis would save me from a lot of trouble. :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1044082959/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1050276099",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2838#issuecomment-1050276099",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2838",
    "id": 1050276099,
    "node_id": "IC_kwDOAkfq-c4-mfED",
    "user": {
      "login": "lsqproduction",
      "id": 12772017,
      "node_id": "MDQ6VXNlcjEyNzcyMDE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/12772017?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsqproduction",
      "html_url": "https://github.com/lsqproduction",
      "followers_url": "https://api.github.com/users/lsqproduction/followers",
      "following_url": "https://api.github.com/users/lsqproduction/following{/other_user}",
      "gists_url": "https://api.github.com/users/lsqproduction/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lsqproduction/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lsqproduction/subscriptions",
      "organizations_url": "https://api.github.com/users/lsqproduction/orgs",
      "repos_url": "https://api.github.com/users/lsqproduction/repos",
      "events_url": "https://api.github.com/users/lsqproduction/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lsqproduction/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-24T21:20:53Z",
    "updated_at": "2022-02-24T21:20:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Addressed in the release v5.5.2.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1050276099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
