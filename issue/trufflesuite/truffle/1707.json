{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1707",
  "id": 408174868,
  "node_id": "MDU6SXNzdWU0MDgxNzQ4Njg=",
  "number": 1707,
  "title": "Add support for mocha-parallel-tests",
  "user": {
    "login": "PhABC",
    "id": 9306422,
    "node_id": "MDQ6VXNlcjkzMDY0MjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9306422?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PhABC",
    "html_url": "https://github.com/PhABC",
    "followers_url": "https://api.github.com/users/PhABC/followers",
    "following_url": "https://api.github.com/users/PhABC/following{/other_user}",
    "gists_url": "https://api.github.com/users/PhABC/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PhABC/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PhABC/subscriptions",
    "organizations_url": "https://api.github.com/users/PhABC/orgs",
    "repos_url": "https://api.github.com/users/PhABC/repos",
    "events_url": "https://api.github.com/users/PhABC/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PhABC/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 230393328,
      "node_id": "MDU6TGFiZWwyMzAzOTMzMjg=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/enhancement",
      "name": "enhancement",
      "color": "84b6eb",
      "default": true,
      "description": null
    },
    {
      "id": 1041903922,
      "node_id": "MDU6TGFiZWwxMDQxOTAzOTIy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/truffle%20test",
      "name": "truffle test",
      "color": "bfdadc",
      "default": false,
      "description": ""
    },
    {
      "id": 1086852667,
      "node_id": "MDU6TGFiZWwxMDg2ODUyNjY3",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20requirements",
      "name": "needs requirements",
      "color": "d4c5f9",
      "default": false,
      "description": "feature request is unclear"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2019-02-08T14:27:20Z",
  "updated_at": "2020-12-18T20:54:30Z",
  "closed_at": "2020-01-30T22:18:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "It would be great if truffle could add a flag (or make it as a default) such that tests can be executed in parallel, perhaps via https://www.npmjs.com/package/mocha-parallel-tests \r\n\r\nThere might be  need to run multiple ganache / nodes instances in parallel as well to make sure there are no transaction nonce conflicts, but maybe a ganache fork could also work. \r\n\r\nRunning tests in parallel could drastically reduce testing times, which in many cases can take a while. ",
  "closed_by": {
    "login": "eggplantzzz",
    "id": 14827965,
    "node_id": "MDQ6VXNlcjE0ODI3OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eggplantzzz",
    "html_url": "https://github.com/eggplantzzz",
    "followers_url": "https://api.github.com/users/eggplantzzz/followers",
    "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
    "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
    "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
    "repos_url": "https://api.github.com/users/eggplantzzz/repos",
    "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/477279807",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-477279807",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 477279807,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzI3OTgwNw==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T17:54:54Z",
    "updated_at": "2019-03-27T17:54:54Z",
    "author_association": "MEMBER",
    "body": "This would be great! But it's tricky and would constitute a breaking change, were it to be default. Have you tried configuring Mocha via Truffle's config (see docs [here](https://www.truffleframework.com/docs/truffle/reference/configuration#mocha))? It might work that way, without a change to Truffle itself.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/477279807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/530986670",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-530986670",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 530986670,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDk4NjY3MA==",
    "user": {
      "login": "k06a",
      "id": 702124,
      "node_id": "MDQ6VXNlcjcwMjEyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/k06a",
      "html_url": "https://github.com/k06a",
      "followers_url": "https://api.github.com/users/k06a/followers",
      "following_url": "https://api.github.com/users/k06a/following{/other_user}",
      "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
      "organizations_url": "https://api.github.com/users/k06a/orgs",
      "repos_url": "https://api.github.com/users/k06a/repos",
      "events_url": "https://api.github.com/users/k06a/events{/privacy}",
      "received_events_url": "https://api.github.com/users/k06a/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-12T20:12:11Z",
    "updated_at": "2019-09-12T20:12:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "@PhABC any success on this?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/530986670/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/535440892",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-535440892",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 535440892,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNTQ0MDg5Mg==",
    "user": {
      "login": "kkx",
      "id": 1530467,
      "node_id": "MDQ6VXNlcjE1MzA0Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kkx",
      "html_url": "https://github.com/kkx",
      "followers_url": "https://api.github.com/users/kkx/followers",
      "following_url": "https://api.github.com/users/kkx/following{/other_user}",
      "gists_url": "https://api.github.com/users/kkx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kkx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kkx/subscriptions",
      "organizations_url": "https://api.github.com/users/kkx/orgs",
      "repos_url": "https://api.github.com/users/kkx/repos",
      "events_url": "https://api.github.com/users/kkx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kkx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-26T10:24:10Z",
    "updated_at": "2019-09-26T10:24:10Z",
    "author_association": "NONE",
    "body": "@gnidan \r\nThe config used in truffle-config is for configuring mocha itself, there is no way to change using other enchanced mocha library instead of the standard mocha.\r\nwould be great if user can select the mocha library to use and import it dynamically when creating Mocha instance here in this line:\r\nhttps://github.com/trufflesuite/truffle/blob/b4b26add0239bb89da0aa562e730023d5eb35341/packages/core/lib/test.js#L124\r\n\r\nlike this:\r\n```\r\n// mocha-parallel-tests example\r\n// if you're using TypeScript you don't need to install @types/mocha-parallel-tests\r\n// because package comes with typings in it\r\nimport Mocha from 'mocha-parallel-tests'; // or `const Mocha = require('mocha-parallel-tests').default` if you're using CommonJS\r\nconst mocha = new Mocha();\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/535440892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/535555039",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-535555039",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 535555039,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNTU1NTAzOQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-26T15:21:32Z",
    "updated_at": "2019-09-26T15:21:32Z",
    "author_association": "MEMBER",
    "body": "Sure @kkx I think that can work by adding a field to the `mocha` part of the Truffle config: https://www.trufflesuite.com/docs/truffle/reference/configuration#mocha\r\n\r\nFeel free to open a PR for this and we can make sure it won't break anything. Seems straightforward though... good idea!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/535555039/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/549151740",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-549151740",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 549151740,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTE1MTc0MA==",
    "user": {
      "login": "k06a",
      "id": 702124,
      "node_id": "MDQ6VXNlcjcwMjEyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/k06a",
      "html_url": "https://github.com/k06a",
      "followers_url": "https://api.github.com/users/k06a/followers",
      "following_url": "https://api.github.com/users/k06a/following{/other_user}",
      "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
      "organizations_url": "https://api.github.com/users/k06a/orgs",
      "repos_url": "https://api.github.com/users/k06a/repos",
      "events_url": "https://api.github.com/users/k06a/events{/privacy}",
      "received_events_url": "https://api.github.com/users/k06a/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-03T16:01:47Z",
    "updated_at": "2019-11-03T16:01:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "@kkx any chance you will contribute this?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/549151740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/549155058",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-549155058",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 549155058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTE1NTA1OA==",
    "user": {
      "login": "k06a",
      "id": 702124,
      "node_id": "MDQ6VXNlcjcwMjEyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/k06a",
      "html_url": "https://github.com/k06a",
      "followers_url": "https://api.github.com/users/k06a/followers",
      "following_url": "https://api.github.com/users/k06a/following{/other_user}",
      "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
      "organizations_url": "https://api.github.com/users/k06a/orgs",
      "repos_url": "https://api.github.com/users/k06a/repos",
      "events_url": "https://api.github.com/users/k06a/events{/privacy}",
      "received_events_url": "https://api.github.com/users/k06a/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-03T16:34:03Z",
    "updated_at": "2019-11-03T16:34:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is my try: https://github.com/trufflesuite/truffle/pull/2540",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/549155058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/580488291",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-580488291",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 580488291,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDQ4ODI5MQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T22:18:16Z",
    "updated_at": "2020-01-30T22:18:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Merged in Truffle [v5.1.11](https://github.com/trufflesuite/truffle/releases/tag/v5.1.11)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/580488291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/649833124",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-649833124",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 649833124,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0OTgzMzEyNA==",
    "user": {
      "login": "mrice32",
      "id": 11791551,
      "node_id": "MDQ6VXNlcjExNzkxNTUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/11791551?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrice32",
      "html_url": "https://github.com/mrice32",
      "followers_url": "https://api.github.com/users/mrice32/followers",
      "following_url": "https://api.github.com/users/mrice32/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrice32/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrice32/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrice32/subscriptions",
      "organizations_url": "https://api.github.com/users/mrice32/orgs",
      "repos_url": "https://api.github.com/users/mrice32/repos",
      "events_url": "https://api.github.com/users/mrice32/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrice32/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-25T21:44:09Z",
    "updated_at": "2020-06-25T21:44:09Z",
    "author_association": "NONE",
    "body": "Should this be reopened? Parallel tests seem to only be supported in principle. They are not supported in practice due to the issue raised [here](https://github.com/trufflesuite/truffle/pull/2540#issuecomment-585804084). Is there any way to get artifacts to work in this context? Otherwise, this feature isn't usable (as far as I can tell).",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/649833124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/748313997",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1707#issuecomment-748313997",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1707",
    "id": 748313997,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODMxMzk5Nw==",
    "user": {
      "login": "leovigna",
      "id": 19425448,
      "node_id": "MDQ6VXNlcjE5NDI1NDQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/19425448?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leovigna",
      "html_url": "https://github.com/leovigna",
      "followers_url": "https://api.github.com/users/leovigna/followers",
      "following_url": "https://api.github.com/users/leovigna/following{/other_user}",
      "gists_url": "https://api.github.com/users/leovigna/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leovigna/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leovigna/subscriptions",
      "organizations_url": "https://api.github.com/users/leovigna/orgs",
      "repos_url": "https://api.github.com/users/leovigna/repos",
      "events_url": "https://api.github.com/users/leovigna/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leovigna/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-18T20:54:30Z",
    "updated_at": "2020-12-18T20:54:30Z",
    "author_association": "NONE",
    "body": "I've been able to run parallel smart contract tests but as mentioned in the comment you linked, one has to overcome the limitations posed by truffle's globals.\r\nHere are the steps I took to enable parallel mocha tests.\r\n### Install required packages\r\n* `npm install -D ganache-core`: We will use this to spawn a separate ganache-core per process. This avoids nonce conflicts and reduces IO bottlenecks. Even in the non-parallelized tests I've found some speedup by using ganache-core as provider instead of server. https://github.com/trufflesuite/ganache-cli#options\r\n* `npm install -D @truffle/contract`: We use this to bypass the artifacts global and create our own contracts.\r\n### Remove Globals\r\nWe first have to remove references to all Truffle globals `contract()`, `assert()`, `artifacts` and replace these with substitutes.\r\n* `contract()` replaced with mocha `describe()`. You must also replace `(accounts) => { ... }` with `() => { ... }` \r\n* `assert()` fixed by adding missing import `import assert from 'assert'`\r\n* `artifacts` this is the trickiest to replace.Use the `@truffle/contract` package to create the contracts manually. You can do this for each test file but it's simpler to just have a separate `artifacts.ts` file from which tests import. We use the build output to create the contract and connect it to the ganache provider.\r\n```typescript\r\nimport TestTokenArtifact from \"../build/contracts/TestToken.json\"\r\n\r\nconst Contract = require(\"@truffle/contract\");\r\nconst TestToken = Contract(TestTokenArtifact)\r\nconst provider = ganache.provider()\r\nTestToken.setProvider(provider)\r\n\r\nexport {\r\n    TestToken\r\n}\r\n```\r\nNow you can import the contract in your test file.\r\n```typescript\r\nimport { TestToken } from \"../../artifacts\"\r\n```\r\nIf you wish to preserve backwards compatibility with the artifacts interface you can also add this to the `artifacts.ts`:\r\n```typescript\r\nconst contracts = {\r\n    \"TestToken\": TestToken\r\n}\r\n\r\n//patch mock artifacts object for backwards-compatibility\r\nconst artifacts: Truffle.Artifacts = {\r\n    require(name: string) {\r\n        //@ts-ignore\r\n        return contracts[name]\r\n    }\r\n}\r\n\r\nexport {\r\n    artifacts,\r\n    TestToken\r\n}\r\n```\r\n\r\n### Configure Accounts\r\nRecall we lost access to the accounts list provided from the `contract()` test function. Add the following to the `artifacts.ts` file.  \r\n```typescript\r\nlet accounts: string[]\r\nlet configured = false\r\n\r\nasync function configureAccounts() {\r\n    if (!configured) {\r\n        accounts = await web3.eth.getAccounts()\r\n        for (let k in contracts) {\r\n            //@ts-ignore\r\n            contracts[k].web3.eth.defaultAccount = accounts[0]\r\n        }\r\n\r\n        configured = true\r\n    }\r\n}\r\nexport {\r\n    accounts...\r\n}\r\n```\r\nIn your test files, import accounts and add a `before()` hook:\r\n```typescript\r\nimport { accounts, configureAccounts } from \"../artifacts\"\r\n\r\n//contract('TestToken', function (accounts) {  //incompatible with mocha parrallel\r\ndescribe('TestToken', function () {\r\n    before(async () => {\r\n        await configureAccounts()\r\n    })\r\n})\r\n```\r\n\r\n### Configure Mocha\r\nEdit your `truffle-config.json`. We turn on the parallel flag and increase timeout (individual tests can take more time depending on how they are scheduled on the CPU).\r\n```typescript\r\nmodule.exports =  {\r\n  //...\r\n  mocha: {\r\n        parallel: true,\r\n        timeout: 300000 //5min\r\n    }\r\n}\r\n```\r\n### Conclusion\r\nMocha spawns processes on a per-file basis so you will only experience performance improvements if your test suite includes multiple long-running tests in separate files. You will also be limited by the number of CPU cores you have. This post by IBM goes through the details of how it works https://developer.ibm.com/languages/node-js/articles/parallel-tests-mocha-v8/.\r\n\r\nIn my case I had 5 test files. Initially ran in 4min which I was able to bring down to 50sec with this method. Exactly the 5x improvement you'd expect assuming you had the CPU cores.\r\n\r\nHow could parallel tests be enabled by default with truffle? I think clearly the long-term solution would be to enable a functional way to generate/import `artifacts`, `contract()` and have it all be configured in a process spawned by mocha. Maybe this is already possible but not well documented? I'm not familiar enough with the full truffle suite to know where changes would be necessary.\r\n\r\nAll the patched I've listed above are basically just removing globals and having them be created on a per-process basis. While this adds some slight overhead (eg. 1 artifact per process) this is insignificant compared to the speedup achieved by parallelized tests.\r\n\r\nNote: All tests are in Typescript so you might also have to configure that or adapt the imports if using Javascript.\r\n\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/748313997/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
