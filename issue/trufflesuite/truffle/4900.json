{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4900",
  "id": 1174469126,
  "node_id": "I_kwDOAkfq-c5GAPoG",
  "number": 4900,
  "title": "`require` statement does not emit the given error-message",
  "user": {
    "login": "barakman",
    "id": 7003246,
    "node_id": "MDQ6VXNlcjcwMDMyNDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7003246?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barakman",
    "html_url": "https://github.com/barakman",
    "followers_url": "https://api.github.com/users/barakman/followers",
    "following_url": "https://api.github.com/users/barakman/following{/other_user}",
    "gists_url": "https://api.github.com/users/barakman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barakman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barakman/subscriptions",
    "organizations_url": "https://api.github.com/users/barakman/orgs",
    "repos_url": "https://api.github.com/users/barakman/repos",
    "events_url": "https://api.github.com/users/barakman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barakman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2022-03-20T08:04:44Z",
  "updated_at": "2022-06-10T17:07:06Z",
  "closed_at": "2022-06-10T17:07:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nI believe that this is a bug in the compiler, in which, under very specific circumstances, a `require` statement does not emit the given error-message.\r\n\r\nSo I have initially posted it on [Solc GitHub](https://github.com/ethereum/solidity/issues/12819).\r\n\r\nHowever, the issue might actually be on Truffle and/or Ganache side, so I am posting it here as well.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.12\r\n- Ganache version: 7.0.1\r\n- Truffle version: 5.4.33\r\n- Operating system: MacOS\r\n- node version (`node --version`): v16.13.0\r\n- npm version (`npm --version`): 8.1.0\r\n- yarn version (`yarn --version`): 1.22.10\r\n\r\n## Steps to Reproduce\r\n\r\n```solidity\r\ncontract MyContract {\r\n    struct Set {\r\n        address[] _values;\r\n        mapping(address => uint256) _indexes;\r\n    }\r\n\r\n    Set private addressSet;\r\n\r\n    function test(address[] calldata addresses) external {\r\n        for (uint256 i = 0; i < addresses.length; i++)\r\n            require(add(addresses[i]), \"already exists\");\r\n    }\r\n\r\n    function add(address value) internal returns (bool) {\r\n        return _add(addressSet, value);\r\n    }\r\n\r\n    function _add(Set storage set, address value) private returns (bool) {\r\n        if (set._indexes[value] == 0) {\r\n            set._values.push(value);\r\n            set._indexes[value] = set._values.length;\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n}\r\n```\r\nWhen function `test(addresses)` is executed with an address which has already been passed to it in a previous execution, it should revert with an error-message `\"already exists\"`.\r\n\r\nIndeed, this error-message is emitted when we do so in two different transactions:\r\n```\r\nawait myContract.test([ADDRESS1, ADDRESS2]);\r\nawait myContract.test([ADDRESS1, ADDRESS2]); // reverts with `already exists`\r\n```\r\nHowever, when we do so in a single transaction:\r\n```\r\nawait myContract.test([ADDRESS1, ADDRESS1]);\r\n```\r\nThe transaction reverts with `exited with an error (status 0) after consuming all gas`.\r\nI suppose that this error-message is a Truffle and/or Ganache implementation detail, so theoretically, the bug is there and not in the compiler.\r\n\r\nHowever, each one of the following observations leads me to believe that this is in fact a compiler issue:\r\n1. The correct error-message is emitted if we change the input type from a dynamic array `address[] calldata addresses` to a static array `address[2] calldata addresses`.\r\n2. The correct error-message is emitted if we \"merge\" function `_add` into function `add`, as if some different \"stack behavior\" took place during runtime, and somehow made this work correctly. I would tend to relate this to the passing by reference of variable `addressSet` from function `add` to function `_add`, but using this variable in function `_add` directly (i.e., not via the reference input variable) results with the same (wrong) error-message.\r\n\r\nPlease find below the full Truffle test:\r\n```\r\nconst MyContract = artifacts.require(\"MyContract\");\r\n\r\nconst ADDRESS1 = \"0x1234567812345678123456781234567812345678\";\r\nconst ADDRESS2 = \"0x8765432187654321876543218765432187654321\";\r\n\r\nasync function assertRevert(promise, message) {\r\n    try {\r\n        await promise;\r\n        throw null;\r\n    }\r\n    catch (error) {\r\n        assert(error, \"Expected an error but did not get one\");\r\n        assert(error.message.includes(message), `Expected an error with '${message}' but got '${error.message}' instead`);\r\n    }\r\n}\r\n\r\ncontract(\"MyContract\", (accounts) => {\r\n    let myContract;\r\n\r\n    beforeEach(async () => {\r\n        myContract = await MyContract.new();\r\n    });\r\n\r\n    it(\"revert in the 2nd transaction\", async () => {\r\n        await myContract.test([ADDRESS1, ADDRESS2]);\r\n        await assertRevert(myContract.test([ADDRESS1, ADDRESS2]), \"already exists\");\r\n    });\r\n\r\n    it(\"revert in the 1st transaction\", async () => {\r\n        await assertRevert(myContract.test([ADDRESS1, ADDRESS1]), \"already exists\");\r\n    });\r\n});\r\n```\r\nMy `truffle-config.js` is the bare minimum; no special configuration other than `optimizer-runs` set to 20000, but all of the above seems to hold also when `optimizer-runs = 200`, and even when `optimizer-enabled = false`, so this is probably not a compiler optimization issue.",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1075495647",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1075495647",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1075495647,
    "node_id": "IC_kwDOAkfq-c5AGsLf",
    "user": {
      "login": "davidmurdoch",
      "id": 187813,
      "node_id": "MDQ6VXNlcjE4NzgxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/187813?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidmurdoch",
      "html_url": "https://github.com/davidmurdoch",
      "followers_url": "https://api.github.com/users/davidmurdoch/followers",
      "following_url": "https://api.github.com/users/davidmurdoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidmurdoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davidmurdoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidmurdoch/subscriptions",
      "organizations_url": "https://api.github.com/users/davidmurdoch/orgs",
      "repos_url": "https://api.github.com/users/davidmurdoch/repos",
      "events_url": "https://api.github.com/users/davidmurdoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davidmurdoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-22T18:39:51Z",
    "updated_at": "2022-03-22T18:39:51Z",
    "author_association": "MEMBER",
    "body": "@barakman, thanks for opening this issue, looks like an interesting one! We're also leaning towards this being a Solidity compiler bug, and not a Ganache/Truffle bug. We'll keep this issue around on our side so we can follow up on this Soonâ„¢ðŸ˜….",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1075495647/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1076886906",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1076886906",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1076886906,
    "node_id": "IC_kwDOAkfq-c5AL_16",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-23T22:33:30Z",
    "updated_at": "2022-03-23T22:33:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, so I took a look at this and can reproduce the error.  In actual fact it does *not* seem to be a compiler error after all like we thought.  Rather, the reason you're getting an out of gas message, rather than the intended revert message, is because the transaction does in fact run out of gas before it can revert.\r\n\r\n(If you're interested, it specifically runs out of gas when attempting to jump back to the test `i < addresses.length` after having incremented `i` from 0 to 1.)\r\n\r\nI determined this using Truffle Debugger, but this can also be easily verified by running the transaction with a larger, specified amount of gas; you will indeed get the expected revert message in that case.\r\n\r\nSo, this isn't a compiler error.  But, that leaves the question of what the actual error here is.  I suppose the error, if there is one, is that Truffle doesn't send enough gas to hit the revert message.  Of course, Truffle determines how much gas to send using `estimateGas`, which I don't believe works for transactions that are bound to fail anyway; I think in such cases Truffle just uses a fixed default which in this case turned out not to be enough.\r\n\r\nI'm not certain if I have all of that correct; I believe @fainashalts can say more, I believe it's she who last worked on this and has done a lot more thinking about these gas problems than I have.  So hopefully she can bring some clarity here.  However I should note that I'm not confident there's any good solution to this problem at present; I'm not sure we presently have any good way to determine the amount of gas to use for a transaction that is going to fail anyway, because my understanding is that the underlying tools currently don't presently support that case very well -- which doesn't rule out that possibility that we might be able to handle this anyway, but it does make it harder.\r\n\r\nAnyway, thanks for filing this.  I guess we'll have to discuss this.  In the meantime, I suppose you can manually turn up the gas!  Hope that's helpful.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1076886906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077283477",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1077283477",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1077283477,
    "node_id": "IC_kwDOAkfq-c5ANgqV",
    "user": {
      "login": "barakman",
      "id": 7003246,
      "node_id": "MDQ6VXNlcjcwMDMyNDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7003246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barakman",
      "html_url": "https://github.com/barakman",
      "followers_url": "https://api.github.com/users/barakman/followers",
      "following_url": "https://api.github.com/users/barakman/following{/other_user}",
      "gists_url": "https://api.github.com/users/barakman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barakman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barakman/subscriptions",
      "organizations_url": "https://api.github.com/users/barakman/orgs",
      "repos_url": "https://api.github.com/users/barakman/repos",
      "events_url": "https://api.github.com/users/barakman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barakman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-24T06:32:20Z",
    "updated_at": "2022-03-24T06:33:40Z",
    "author_association": "NONE",
    "body": "@haltman-at : Thank you for your detailed explanation!\r\n\r\nFrom your description, I understand that as part of Truffle implementation, for every transaction, you first call `estimateGas` in order to determine how much gas to pass to the transaction.\r\nAnd whenever the transaction fails, you have no way of determining how much gas it really needs in order to reach the point of failure, because `estimateGas` itself fails.\r\nSo you just pass some arbitrary gas amount, which in this specific case does not allow the transaction to actually reach that point, and instead, the transaction indeed runs out of gas.\r\n\r\nWhat I don't understand is, why don't you simply take the revert reason of your call to `estimateGas` itself?\r\n\r\nI actually tried that in my test, and it worked exactly as I'd hoped the original code would:\r\n```\r\nawait assertRevert(myContract.test.estimateGas([ADDRESS1, ADDRESS1]), \"already exists\");\r\n```\r\n\r\nSo I'm kinda having a problem understanding Truffle's conceptual method of work to begin with.\r\nI'd be happy if you could clarify this for me.\r\n\r\nThanks again :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077283477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077720318",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1077720318",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1077720318,
    "node_id": "IC_kwDOAkfq-c5APLT-",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-24T14:56:24Z",
    "updated_at": "2022-03-24T14:56:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can you clarify a bit more about what you mean by \"take the revert reason of your call to `estimateGas` itself\"? I'm not sure I understand what you are asking.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077720318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077731185",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1077731185",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1077731185,
    "node_id": "IC_kwDOAkfq-c5APN9x",
    "user": {
      "login": "barakman",
      "id": 7003246,
      "node_id": "MDQ6VXNlcjcwMDMyNDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7003246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barakman",
      "html_url": "https://github.com/barakman",
      "followers_url": "https://api.github.com/users/barakman/followers",
      "following_url": "https://api.github.com/users/barakman/following{/other_user}",
      "gists_url": "https://api.github.com/users/barakman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barakman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barakman/subscriptions",
      "organizations_url": "https://api.github.com/users/barakman/orgs",
      "repos_url": "https://api.github.com/users/barakman/repos",
      "events_url": "https://api.github.com/users/barakman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barakman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-24T15:05:53Z",
    "updated_at": "2022-03-24T15:05:53Z",
    "author_association": "NONE",
    "body": "@eggplantzzz : Check out the code example at the bottom of my response (above).\r\n\r\nWhenever `myContract.test` is designated to revert, so is `myContract.test.estimateGas`, with the same revert reason.\r\n\r\nSo instead of executing `myContract.test` with some arbitrary gas amount and hoping that it will suffice for the function to reach the point where it reverts (according to the description given by @haltman-at above), I am asking, why don't you simply execute `myContract.test.estimateGas`?\r\n\r\nAt least from @haltman-at's description, I am under the impression that prior to executing `myContract.test`, Truffle executes `myContract.test.estimateGas`, in order to get the gas required for executing `myContract.test`.\r\nSo my suggestion is, whenever `myContract.test.estimateGas` reverts, just through the revert message right away.\r\n\r\nI think it might make more sense to you if you go through the entire thread above (in particularly, though @haltman-at's response).\r\n\r\nThanks :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077731185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077752365",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1077752365",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1077752365,
    "node_id": "IC_kwDOAkfq-c5APTIt",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-24T15:25:04Z",
    "updated_at": "2022-03-24T15:25:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah I understand, so we'll have to see if we have access to the revert reason when `estimateGas` fails. @haltman-at might know more about whether that is available.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077752365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077771637",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1077771637",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1077771637,
    "node_id": "IC_kwDOAkfq-c5APX11",
    "user": {
      "login": "barakman",
      "id": 7003246,
      "node_id": "MDQ6VXNlcjcwMDMyNDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7003246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barakman",
      "html_url": "https://github.com/barakman",
      "followers_url": "https://api.github.com/users/barakman/followers",
      "following_url": "https://api.github.com/users/barakman/following{/other_user}",
      "gists_url": "https://api.github.com/users/barakman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barakman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barakman/subscriptions",
      "organizations_url": "https://api.github.com/users/barakman/orgs",
      "repos_url": "https://api.github.com/users/barakman/repos",
      "events_url": "https://api.github.com/users/barakman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barakman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-24T15:44:06Z",
    "updated_at": "2022-03-24T15:44:39Z",
    "author_association": "NONE",
    "body": "@eggplantzzz:\r\nWell, when I call it from a Truffle test, it reverts with that reason string, so you should definitely be able to access it.\r\n\r\nBut more generally, I'm wondering what kind of approach you have taken up until now, with regards to cases where your call to `estimateGas` has failed... have you just used an arbitrary gas amount?\r\n\r\nHave you always used `estimateGas`, or is that a recent optimization of some sort?\r\nAt least for unit-testing, it doesn't even seem necessary, since there are no miners or anything like that, so you could simply input the maximum possible value. I guess it might be useful for deployments, as well as other types of public-network interactions. Other than that, I'm wondering if it would be best to just use the block gas limit to begin with.\r\n\r\nThanks :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077771637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077780341",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1077780341",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1077780341,
    "node_id": "IC_kwDOAkfq-c5APZ91",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-24T15:53:57Z",
    "updated_at": "2022-03-24T15:53:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yep, I just did the same test using a simple contract with a function that fails in the Truffle development console. I think the current approach has been in place for a while, though something did change about the gas estimation maybe 6 months ago (which @fainashalts worked on as @haltman-at may have mentioned above). I suppose we could afford to use the maximum gas if we knew in advance it was a test environment and the user doesn't care about gas...we'll have a discussion and try and see if there is a better solution here. Thanks @barakman!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1077780341/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1081040426",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1081040426",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1081040426,
    "node_id": "IC_kwDOAkfq-c5Ab14q",
    "user": {
      "login": "barakman",
      "id": 7003246,
      "node_id": "MDQ6VXNlcjcwMDMyNDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7003246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/barakman",
      "html_url": "https://github.com/barakman",
      "followers_url": "https://api.github.com/users/barakman/followers",
      "following_url": "https://api.github.com/users/barakman/following{/other_user}",
      "gists_url": "https://api.github.com/users/barakman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/barakman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/barakman/subscriptions",
      "organizations_url": "https://api.github.com/users/barakman/orgs",
      "repos_url": "https://api.github.com/users/barakman/repos",
      "events_url": "https://api.github.com/users/barakman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/barakman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-28T19:16:14Z",
    "updated_at": "2022-03-28T19:17:27Z",
    "author_association": "NONE",
    "body": "@eggplantzzz:\r\n\r\nFYI, this issue significantly hinders the ability to debug contract code using `require` and/or `revert` stubs (added specifically for debug purpose), since these statements are not guaranteed to be reached when the transaction is executed with Truffle.\r\n\r\nMore specifically, they are guaranteed to be reached only for successful transactions.\r\nBut in many (and perhaps even in most) cases, one wishes to debug non-successful transactions.\r\nAnd there is not much that one could gather from `exited with an error (status 0) after consuming all gas`...",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1081040426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1081122425",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1081122425",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1081122425,
    "node_id": "IC_kwDOAkfq-c5AcJ55",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-28T20:43:18Z",
    "updated_at": "2022-03-28T20:43:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "I hear you @barakman, like I said, we'll have to have a discussion here to hash out details involving a fix etc.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1081122425/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1118846780",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1118846780",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1118846780,
    "node_id": "IC_kwDOAkfq-c5CsD88",
    "user": {
      "login": "minhsieh",
      "id": 7061413,
      "node_id": "MDQ6VXNlcjcwNjE0MTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7061413?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/minhsieh",
      "html_url": "https://github.com/minhsieh",
      "followers_url": "https://api.github.com/users/minhsieh/followers",
      "following_url": "https://api.github.com/users/minhsieh/following{/other_user}",
      "gists_url": "https://api.github.com/users/minhsieh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/minhsieh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/minhsieh/subscriptions",
      "organizations_url": "https://api.github.com/users/minhsieh/orgs",
      "repos_url": "https://api.github.com/users/minhsieh/repos",
      "events_url": "https://api.github.com/users/minhsieh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/minhsieh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T17:11:26Z",
    "updated_at": "2022-05-05T17:11:26Z",
    "author_association": "NONE",
    "body": "Hi, I also encountered the same problem today. I used truffle v5.4.26 initially and then upgraded to v5.5.12.\r\nI didn't encounter this problem after upgrading my truffle.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1118846780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1119067744",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1119067744",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1119067744,
    "node_id": "IC_kwDOAkfq-c5Cs55g",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T21:33:58Z",
    "updated_at": "2022-05-05T21:33:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hm, so, one approach we could take here is, we could reserve the gas default for `sendTransactionManual`.  After all, if we're not doing a stacktrace, we don't really need to make sure the transaction actually happens, do we?\r\n\r\nSo, we could have the `send` function throw if `estimateGas` fails in non-debug conditions (and use the error returned from `estimateGas`); but if we're doing `truffle test --stacktrace`, so a debugger is present and we're going to do `sendTransactionManual`, then we can forge ahead and use a default amount of gas.  Since that should never happen in production!\r\n\r\nI think that solution should be amenable to everyone. :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1119067744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1140080450",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1140080450",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1140080450,
    "node_id": "IC_kwDOAkfq-c5D9D9C",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T22:29:48Z",
    "updated_at": "2022-05-27T22:29:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh interesting -- I'm looking through the code right now and it appears that what I just described is in fact how it was *intended* to work, according to the comments.  Just, it doesn't actually at present.  So by fixing this is actually just implementing a bug fix!  Could have saved us some trouble deciding what to do if we'd just read the comments!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1140080450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1143820609",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1143820609",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1143820609,
    "node_id": "IC_kwDOAkfq-c5ELVFB",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T16:19:55Z",
    "updated_at": "2022-06-01T16:19:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "OK, I've put up #5158 to address this.  Sorry about taking so long to get to this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1143820609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1151696270",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4900#issuecomment-1151696270",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4900",
    "id": 1151696270,
    "node_id": "IC_kwDOAkfq-c5EpX2O",
    "user": {
      "login": "kevinbluer",
      "id": 210755,
      "node_id": "MDQ6VXNlcjIxMDc1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/210755?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevinbluer",
      "html_url": "https://github.com/kevinbluer",
      "followers_url": "https://api.github.com/users/kevinbluer/followers",
      "following_url": "https://api.github.com/users/kevinbluer/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevinbluer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevinbluer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevinbluer/subscriptions",
      "organizations_url": "https://api.github.com/users/kevinbluer/orgs",
      "repos_url": "https://api.github.com/users/kevinbluer/repos",
      "events_url": "https://api.github.com/users/kevinbluer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevinbluer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-09T23:00:11Z",
    "updated_at": "2022-06-09T23:00:49Z",
    "author_association": "MEMBER",
    "body": "Hey @barakman, fix for this is now available in [v5.5.18](https://github.com/trufflesuite/truffle/releases/tag/v5.5.18) which has just gone out ðŸ‘ ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1151696270/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
