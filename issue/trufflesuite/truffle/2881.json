{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/2881",
  "id": 579675618,
  "node_id": "MDU6SXNzdWU1Nzk2NzU2MTg=",
  "number": 2881,
  "title": "better logging on revert",
  "user": {
    "login": "pdlla",
    "id": 108157,
    "node_id": "MDQ6VXNlcjEwODE1Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/108157?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pdlla",
    "html_url": "https://github.com/pdlla",
    "followers_url": "https://api.github.com/users/pdlla/followers",
    "following_url": "https://api.github.com/users/pdlla/following{/other_user}",
    "gists_url": "https://api.github.com/users/pdlla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pdlla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pdlla/subscriptions",
    "organizations_url": "https://api.github.com/users/pdlla/orgs",
    "repos_url": "https://api.github.com/users/pdlla/repos",
    "events_url": "https://api.github.com/users/pdlla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pdlla/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-03-12T03:55:22Z",
  "updated_at": "2020-05-06T18:11:21Z",
  "closed_at": "2020-05-06T18:11:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Right now, if a contract ever reverts, `truffle test` just crashes and gives no useful error messages. This seems like a big miss as one expects test to fail during development. It would be really nice if:\r\n\r\n1. it gave better output. In particular, it would great if it could print the failed transaction so it can be used for debugging. Right now I have to find it inside of my ganache console. \r\n2. it didn't crash\r\n\r\n```\r\ntruffle(development)> test\r\n\r\n....\r\n\r\n  Contract: Helper\r\n    ✓ print code sizes\r\n\r\n  Contract: Government\r\nGovernment: 6888 bytes out of 24577 %0.2802620336086585 capacity.\r\n    ✓ initial state test (68ms)\r\n    ✓ PotatoERC20 test (92ms)\r\n    ✓ Animal (107ms)\r\nError: Returned error: VM Exception while processing transaction: revert ERC20: transfer amount exceeds allowance -- Reason given: ERC20: transfer amount exceeds allowance.\r\nError: Returned error: VM Exception while processing transaction: revert ERC20: transfer amount exceeds allowance -- Reason given: ERC20: transfer amount exceeds allowance.\r\n\r\n/Users/user/.config/truffle/compilers/node_modules/soljson-v0.6.0+commit.26b70077.js:1\r\n\"use strict\";var Module=typeof Module!==\"undefined\"?Module:{};var moduleOverrides={};var key;for(key in Module){if(Module.hasOwnProperty(key)){moduleOverrides[key]=Module[key]}}var arguments_=[];var thisProgram=\"./this.program\";var quit_=function(status,toThrow){throw toThrow};var ENVIRONMENT_IS_WEB=false;var ENVIRONMENT_IS_WORKER=false;var ENVIRONMENT_IS_NODE=false;var ENVIRONMENT_HAS_NODE=false;var ENVIRONMENT_IS_SHELL=false;ENVIRONMENT_IS_WEB=typeof window===\"object\";ENVIRONMENT_IS_WORKER=typeof importScripts===\"function\";ENVIRONMENT_HAS_NODE=typeof process===\"object\"&&typeof process.versions===\"object\"&&typeof process.versions.node===\"string\";ENVIRONMENT_IS_NODE=ENVIRONMENT_HAS_NODE&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER;ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;var scriptDirectory=\"\";function locateFile(path){if(Module[\"locateFile\"]){return Module[\"locateFile\"](path,\r\nabort(Error: Returned error: VM Exception while processing transaction: revert ERC20: transfer amount exceeds allowance -- Reason given: ERC20: transfer amount exceeds allowance.). Build with -s ASSERTIONS=1 for more info.\r\n(Use `node --trace-uncaught ...` to show where the exception was thrown)\r\n~/kitchen/faucet/P2CBG_design/potato_game_code:master$\r\n```\r\n\r\nNote the above example was fairly benign. The really annoying one I had was when it reverted because my contract size exceeded the 24kb limit but the VM reported \"out of gas\" for some reason (I had plenty of gas left). The 24kb limit issue (during deployments) is probably a separate issue but the lack of good error messages on VM reverts is seems to be the root cause.",
  "closed_by": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600771238",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2881#issuecomment-600771238",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881",
    "id": 600771238,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMDc3MTIzOA==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-18T17:43:43Z",
    "updated_at": "2020-03-18T17:43:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "@pdlla Thanks for reporting this! Actually this is partially a duplicate of [this](https://github.com/trufflesuite/truffle/issues/1655). The \"out of gas\" error is actually the specification. See [this](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-170.md).\r\n\r\nWhat are you doing to get your tests failing as they do in your example? I don't think tests always fail like that. If you can give me repro steps we can try and figure out why the output is so junky.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600771238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600785801",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2881#issuecomment-600785801",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881",
    "id": 600785801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMDc4NTgwMQ==",
    "user": {
      "login": "pdlla",
      "id": 108157,
      "node_id": "MDQ6VXNlcjEwODE1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/108157?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pdlla",
      "html_url": "https://github.com/pdlla",
      "followers_url": "https://api.github.com/users/pdlla/followers",
      "following_url": "https://api.github.com/users/pdlla/following{/other_user}",
      "gists_url": "https://api.github.com/users/pdlla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pdlla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pdlla/subscriptions",
      "organizations_url": "https://api.github.com/users/pdlla/orgs",
      "repos_url": "https://api.github.com/users/pdlla/repos",
      "events_url": "https://api.github.com/users/pdlla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pdlla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-18T18:15:20Z",
    "updated_at": "2020-03-18T18:15:20Z",
    "author_association": "NONE",
    "body": "I set gananche block gas limit to something very high. I deployed like 3 variations of ERC20/ERC721 contracts in my contract and that was enough to exceed the code size limit. I didn't realize it was so small D:.\r\n\r\nI've since split them out and added this helper function to my migrations to track how close I'm getting to the limit\r\n\r\n```\r\nasync function logGasContract(instance) {\r\n  txr = await web3.eth.getTransactionReceipt(instance.transactionHash)\r\n  const gasUsed = parseInt(txr.gasUsed);\r\n  logGasUsed(gasUsed, instance.constructor._json.contractName);\r\n}\r\n```\r\n\r\nThx for sharing the EIP. Kind of makes sense they piggy backed on an existing error message to make the hardfork as seamless as possible. Thanks for the info. \r\n\r\nGenerally speaking, it would be great if truffle gave better logging and analytics for gas usage both in test cases and deployments. These issues are very hard to comprehend and even harder to track down for new developers. Thankfully, I've worked with geth a lot so it was much easier for me.\r\n\r\nI've been adding my own helper methods like the above to track things like this. Maybe I'll look into making a PR. Unfortunately I'm not exactly a JS developer so these helper functions are just `console.log` hacks to get me through my task.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/600785801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/603994018",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2881#issuecomment-603994018",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881",
    "id": 603994018,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzk5NDAxOA==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T17:59:17Z",
    "updated_at": "2020-03-25T17:59:17Z",
    "author_association": "MEMBER",
    "body": "Hey do you know about [eth-gas-reporter](https://github.com/cgewecke/eth-gas-reporter)? It plugs into your `truffle test` and gives you a table listing gas cost of each contract function as executed by your tests. Might be what you're looking for? Let us know! Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/603994018/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/607396169",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2881#issuecomment-607396169",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881",
    "id": 607396169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNzM5NjE2OQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-01T17:47:36Z",
    "updated_at": "2020-04-01T17:47:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "@pdlla Do you get the kind of garbage output you pasted above? There might have been something that fixed this recently...I can't remember. Let us know so we can address it if so!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/607396169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/624806001",
    "html_url": "https://github.com/trufflesuite/truffle/issues/2881#issuecomment-624806001",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/2881",
    "id": 624806001,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDgwNjAwMQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-06T18:11:21Z",
    "updated_at": "2020-05-06T18:11:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing for issue maintenance.  Please let us know if there's still a problem and we can reopen this.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/624806001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
