{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4471",
  "id": 1065053238,
  "node_id": "I_kwDOAkfq-c4_e2w2",
  "number": 4471,
  "title": "Use ganache core as provider",
  "user": {
    "login": "lughino",
    "id": 3275254,
    "node_id": "MDQ6VXNlcjMyNzUyNTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3275254?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lughino",
    "html_url": "https://github.com/lughino",
    "followers_url": "https://api.github.com/users/lughino/followers",
    "following_url": "https://api.github.com/users/lughino/following{/other_user}",
    "gists_url": "https://api.github.com/users/lughino/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lughino/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lughino/subscriptions",
    "organizations_url": "https://api.github.com/users/lughino/orgs",
    "repos_url": "https://api.github.com/users/lughino/repos",
    "events_url": "https://api.github.com/users/lughino/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lughino/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1088150379,
      "node_id": "MDU6TGFiZWwxMDg4MTUwMzc5",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/error%20better",
      "name": "error better",
      "color": "f27915",
      "default": false,
      "description": "issue indicates improvement to error messaging"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-11-27T14:19:26Z",
  "updated_at": "2022-02-16T19:12:32Z",
  "closed_at": "2022-02-16T18:14:42Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ ] I've [opened a support ticket](https://trufflesuite.zendesk.com/hc/en-us/requests/new) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nI'm trying to use ganache-core as a provider for the development network.\r\nThe reason for this is to have a clean environment to run my tests and avoid spinning up the ganache-cli or gui.\r\nIt seems to work well if I run the migrate command, but it fails during testing, especially when I try to access to a value inside the contract.\r\n\r\n## Steps to Reproduce\r\n\r\nThis is my contract:\r\n```sol\r\npragma solidity >=0.8.10;\r\n\r\nimport './Campaign.sol';\r\n\r\n/**\r\n * @title CampaignFactory\r\n * @dev\r\n */\r\ncontract CampaignFactory {\r\n    address[] public campaigns;\r\n\r\n    function createCampaign(uint256 minimumContribution) public {\r\n        Campaign newCampaign = new Campaign(minimumContribution, msg.sender);\r\n        address newCampaignAddress = address(newCampaign);\r\n        campaigns.push(newCampaignAddress);\r\n    }\r\n\r\n    function getDeployedCampaigns() public view returns (address[] memory) {\r\n        return campaigns;\r\n    }\r\n}\r\n```\r\n\r\nThis is my truffle configuration:\r\n```js\r\nconst ganache = require('ganache-cli');\r\n\r\nmodule.exports = {\r\n  networks: {\r\n    development: {\r\n      host: '127.0.0.1',\r\n      port: 8545,\r\n      network_id: '*',\r\n      provider: function() {\r\n        return ganache.provider({\r\n          network_id: '1638017666257',\r\n          gasPrice: '0x77359400',\r\n          gasLimit: '0x6691b7',\r\n          callGasLimit: '0x1fffffffffffff',\r\n          accounts: [\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0xb1630540f208e55d3837d33186940c69a4a7f8befd277f9371e86475cab74f05',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x63200de6db357083e94d36fa61af687099963001fcf7d0b41a5f2d226d8d7fb1',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x3c933b0cb73160953df050e21c28bbdd703c3578d275ff024a2989141816b355',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x2bd7e16e9afbf7c75c212287c7a5f462f0fb9d95eae24aed3aa47d8485d2fa09',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x0b3e3836d95c5054473d1f07e45816d683d4ee8534e5dc8d1f70e3a794694205',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x6bace9f5dedc020c6d9394caa6d8e9ad78355f70010ec34fca9ff4c0f2c632b8',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x25288af18c33f7c5aa472203256cca9c65bb7f0f630f90fa5d7faaea18e6e596',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0xee520411581c6fdc355c32297b9dcf65f0862f14a4c1e41c114412a14683be80',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0x3d44fe3aa7fa08db700238b1608ef3205ee721a2468796f29e0660f9568ac51d',\r\n            },\r\n            {\r\n              balance: '0x56bc75e2d63100000',\r\n              secretKey:\r\n                '0xd1eded9528e73c6699f6520801e7b4d08a1442a4c68f9cb64d335d0067df153e',\r\n            },\r\n          ],\r\n        });\r\n      },\r\n    },\r\n  },\r\n  compilers: {\r\n    solc: {\r\n      version: '>=0.8.0',\r\n      settings: {\r\n        optimizer: {\r\n          enabled: true,\r\n          runs: 200,\r\n        },\r\n      },\r\n    },\r\n  },\r\n};\r\n```\r\nThe reason for setting those options in the provider is because of several errors I received.\r\n\r\nThis is the test:\r\n```js\r\nimport {CampaignInstance} from '../types/truffle-contracts/Campaign.d';\r\nimport {CampaignFactoryInstance} from '../types/truffle-contracts/CampaignFactory.d';\r\n\r\nconst CampaignFactory = artifacts.require('CampaignFactory');\r\nconst Campaign = artifacts.require('Campaign');\r\n\r\ncontract('CampaignFactory', async (accounts) => {\r\n  let campaignFactory: CampaignFactoryInstance;\r\n  let campaign: CampaignInstance;\r\n  let campaignAddress: string;\r\n\r\n  beforeEach(async () => {\r\n    campaignFactory = await CampaignFactory.deployed();\r\n    await campaignFactory.createCampaign('100');\r\n    [campaignAddress] = await campaignFactory.getDeployedCampaigns(); // the error happen here\r\n    campaign = await Campaign.at(campaignAddress);\r\n  });\r\n\r\n  it('should deploys a factory contract and a campaign', () => {\r\n    expect(campaignFactory.address).to.exist;\r\n    expect(campaign.address).to.exist;\r\n  });\r\n});\r\n\r\n```\r\n\r\n## Expected Behavior\r\n\r\nTo work properly in the same way as with ganache cli.\r\nIf I run the same test pointing to ganache-cli, everything works properly.\r\n\r\n## Actual Results\r\n\r\nI receive this error:\r\n```\r\nError: Returned values aren't valid, did it run Out of Gas? You might also see this error if you are not using the correct ABI for the contract you are retrieving data from, requesting data from a block number that does not exist, or querying a node which is not fully synced.\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: \r\n* Ethereum client: ganache-cli 6.12.2\r\n* Truffle version (`truffle version`): 5.4.22\r\n* node version (`node --version`): 16.13.0\r\n* npm version (`npm --version`): yarn 1.22.17\r\n",
  "closed_by": {
    "login": "MicaiahReid",
    "id": 17027138,
    "node_id": "MDQ6VXNlcjE3MDI3MTM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17027138?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MicaiahReid",
    "html_url": "https://github.com/MicaiahReid",
    "followers_url": "https://api.github.com/users/MicaiahReid/followers",
    "following_url": "https://api.github.com/users/MicaiahReid/following{/other_user}",
    "gists_url": "https://api.github.com/users/MicaiahReid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MicaiahReid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MicaiahReid/subscriptions",
    "organizations_url": "https://api.github.com/users/MicaiahReid/orgs",
    "repos_url": "https://api.github.com/users/MicaiahReid/repos",
    "events_url": "https://api.github.com/users/MicaiahReid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MicaiahReid/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/983977340",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4471#issuecomment-983977340",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471",
    "id": 983977340,
    "node_id": "IC_kwDOAkfq-c46pk18",
    "user": {
      "login": "fainashalts",
      "id": 8952139,
      "node_id": "MDQ6VXNlcjg5NTIxMzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8952139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fainashalts",
      "html_url": "https://github.com/fainashalts",
      "followers_url": "https://api.github.com/users/fainashalts/followers",
      "following_url": "https://api.github.com/users/fainashalts/following{/other_user}",
      "gists_url": "https://api.github.com/users/fainashalts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fainashalts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fainashalts/subscriptions",
      "organizations_url": "https://api.github.com/users/fainashalts/orgs",
      "repos_url": "https://api.github.com/users/fainashalts/repos",
      "events_url": "https://api.github.com/users/fainashalts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fainashalts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-01T19:18:04Z",
    "updated_at": "2021-12-01T19:18:04Z",
    "author_association": "MEMBER",
    "body": "HI @lughino, can you try removing the `host` and `port` in your network setting and see if that helps? It is our hunch that the issue is that these settings are competing with `provider`. \n\nWe think Truffle could definitely provide a better error here if this is the problem, so please let us know so we can make the needed changes. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/983977340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1041967114",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4471#issuecomment-1041967114",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4471",
    "id": 1041967114,
    "node_id": "IC_kwDOAkfq-c4-GygK",
    "user": {
      "login": "MicaiahReid",
      "id": 17027138,
      "node_id": "MDQ6VXNlcjE3MDI3MTM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17027138?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MicaiahReid",
      "html_url": "https://github.com/MicaiahReid",
      "followers_url": "https://api.github.com/users/MicaiahReid/followers",
      "following_url": "https://api.github.com/users/MicaiahReid/following{/other_user}",
      "gists_url": "https://api.github.com/users/MicaiahReid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MicaiahReid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MicaiahReid/subscriptions",
      "organizations_url": "https://api.github.com/users/MicaiahReid/orgs",
      "repos_url": "https://api.github.com/users/MicaiahReid/repos",
      "events_url": "https://api.github.com/users/MicaiahReid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MicaiahReid/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-16T18:14:42Z",
    "updated_at": "2022-02-16T19:12:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing for issue maintenance. Please open another issue if this is still happening.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1041967114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
