{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/866",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/866",
  "id": 308236412,
  "node_id": "MDU6SXNzdWUzMDgyMzY0MTI=",
  "number": 866,
  "title": "compiler optimization broken since v4.0.6",
  "user": {
    "login": "chris-shyft",
    "id": 34154131,
    "node_id": "MDQ6VXNlcjM0MTU0MTMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/34154131?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chris-shyft",
    "html_url": "https://github.com/chris-shyft",
    "followers_url": "https://api.github.com/users/chris-shyft/followers",
    "following_url": "https://api.github.com/users/chris-shyft/following{/other_user}",
    "gists_url": "https://api.github.com/users/chris-shyft/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chris-shyft/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chris-shyft/subscriptions",
    "organizations_url": "https://api.github.com/users/chris-shyft/orgs",
    "repos_url": "https://api.github.com/users/chris-shyft/repos",
    "events_url": "https://api.github.com/users/chris-shyft/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chris-shyft/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-03-24T07:24:22Z",
  "updated_at": "2018-03-24T19:56:46Z",
  "closed_at": "2018-03-24T19:56:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "using truffle compile --all:\r\n\r\ntruffle v4.0.7+ (tested all releases via \"npm install -g truffle:@4.0.7\", \"npm install -g truffle:@4.1.0\", etc until the latest 4.1.3) \r\n\r\n![screen shot 2018-03-24 at 3 08 15 am](https://user-images.githubusercontent.com/34154131/37861531-2135bc94-2f12-11e8-80a4-8228511073a3.png)\r\n\r\n\r\ntruffle v4.0.6 \"npm install -g truffle:@4.0.6\"\r\n\r\ndoes indeed respect the \r\n\r\nsolc: {\r\n        optimizer: {\r\n            enabled: true,\r\n            runs: 5000000\r\n        }\r\n    }\r\n\r\ncommands within truffle.js. changing enabled to false does indeed result in less optimized contracts (1.9mb vs the 1.8mb for \"ShyftKycContract\" as detailed)\r\n\r\n![screen shot 2018-03-24 at 3 12 52 am](https://user-images.githubusercontent.com/34154131/37861532-2317cf2a-2f12-11e8-97d6-c69b32b5fdba.png)\r\n\r\n\r\nI've done by best to track down where or why this occurred, and the logic seems sound within the command structure (still using \"solc\": \"^0.4.19\" to this day), and the compiler passing options etc.\r\n\r\nwondering what the fix for this might be.",
  "closed_by": {
    "login": "chris-shyft",
    "id": 34154131,
    "node_id": "MDQ6VXNlcjM0MTU0MTMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/34154131?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chris-shyft",
    "html_url": "https://github.com/chris-shyft",
    "followers_url": "https://api.github.com/users/chris-shyft/followers",
    "following_url": "https://api.github.com/users/chris-shyft/following{/other_user}",
    "gists_url": "https://api.github.com/users/chris-shyft/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chris-shyft/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chris-shyft/subscriptions",
    "organizations_url": "https://api.github.com/users/chris-shyft/orgs",
    "repos_url": "https://api.github.com/users/chris-shyft/repos",
    "events_url": "https://api.github.com/users/chris-shyft/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chris-shyft/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/866/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375906524",
    "html_url": "https://github.com/trufflesuite/truffle/issues/866#issuecomment-375906524",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866",
    "id": 375906524,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTkwNjUyNA==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-24T16:41:00Z",
    "updated_at": "2018-03-24T17:32:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@chris-shyft Thanks for such a clear report. \r\n\r\nStarting in 4.0.7, the artifact contains 2 versions of the AST - the legacyAST and solc's newer AST. This duplication was necessary because `truffle-debugger` requires the latter and it's possible that users consume the former as well.  From what I understand of the above, your proxy measurement for optimization is the size of the artifact file. \r\n\r\nI think in this case we'd have to compare bytecode / binary sizes directly to determine that the optimizer is behaving differently between versions. Those are available as a key on the artifact, in addition to lots of other stuff like the ABI, AST, etc.\r\n\r\nOut of curiosity, what would be your 'top-level' bug description for this? Are you trying to publish to etherscan and it's not happening? \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375906524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375919442",
    "html_url": "https://github.com/trufflesuite/truffle/issues/866#issuecomment-375919442",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866",
    "id": 375919442,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTkxOTQ0Mg==",
    "user": {
      "login": "chris-shyft",
      "id": 34154131,
      "node_id": "MDQ6VXNlcjM0MTU0MTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/34154131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-shyft",
      "html_url": "https://github.com/chris-shyft",
      "followers_url": "https://api.github.com/users/chris-shyft/followers",
      "following_url": "https://api.github.com/users/chris-shyft/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-shyft/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-shyft/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-shyft/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-shyft/orgs",
      "repos_url": "https://api.github.com/users/chris-shyft/repos",
      "events_url": "https://api.github.com/users/chris-shyft/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-shyft/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-24T19:41:55Z",
    "updated_at": "2018-03-24T19:41:55Z",
    "author_association": "NONE",
    "body": "publishing to a ganache-cli running locally.\r\n\r\nnamely, I'm getting an \"out of gas\" when running with anything above 4.0.6, which is the same behaviour as removing the \"optimize\" flag when in remix and trying to publish the contract to the same ganache-cli instance.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375919442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375920507",
    "html_url": "https://github.com/trufflesuite/truffle/issues/866#issuecomment-375920507",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/866",
    "id": 375920507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTkyMDUwNw==",
    "user": {
      "login": "chris-shyft",
      "id": 34154131,
      "node_id": "MDQ6VXNlcjM0MTU0MTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/34154131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chris-shyft",
      "html_url": "https://github.com/chris-shyft",
      "followers_url": "https://api.github.com/users/chris-shyft/followers",
      "following_url": "https://api.github.com/users/chris-shyft/following{/other_user}",
      "gists_url": "https://api.github.com/users/chris-shyft/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chris-shyft/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chris-shyft/subscriptions",
      "organizations_url": "https://api.github.com/users/chris-shyft/orgs",
      "repos_url": "https://api.github.com/users/chris-shyft/repos",
      "events_url": "https://api.github.com/users/chris-shyft/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chris-shyft/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-24T19:56:42Z",
    "updated_at": "2018-03-24T19:56:42Z",
    "author_association": "NONE",
    "body": "On closer inspection, I think I'm mistaken.\r\n\r\ndue to the nature of my build process, I missed the \"--all\" flag with the truffle compile process.\r\n#lessons :D",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/375920507/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
