{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3934",
  "id": 836764525,
  "node_id": "MDU6SXNzdWU4MzY3NjQ1MjU=",
  "number": 3934,
  "title": "Truffle crash on running tests",
  "user": {
    "login": "k06a",
    "id": 702124,
    "node_id": "MDQ6VXNlcjcwMjEyNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/k06a",
    "html_url": "https://github.com/k06a",
    "followers_url": "https://api.github.com/users/k06a/followers",
    "following_url": "https://api.github.com/users/k06a/following{/other_user}",
    "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
    "organizations_url": "https://api.github.com/users/k06a/orgs",
    "repos_url": "https://api.github.com/users/k06a/repos",
    "events_url": "https://api.github.com/users/k06a/events{/privacy}",
    "received_events_url": "https://api.github.com/users/k06a/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-03-20T09:28:10Z",
  "updated_at": "2021-05-12T18:12:30Z",
  "closed_at": "2021-05-12T18:12:30Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nTruffle crash, demo is here: https://github.com/k06a/truffle-string-multi-literal\r\n\r\nCrash happens because of multi-line string literal:\r\n```solidity\r\nbytes32 constant public HUMAN_TYPEHASH = keccak256(\r\n    \"Human(\"\r\n    \"string name,\"\r\n    \"string surname,\"\r\n    \"string street,\"\r\n    \"address wallet,\"\r\n    \"uint256 age,\"\r\n    \"uint256 birth\"\r\n    \")\"\r\n);\r\n```\r\n\r\n## Steps to Reproduce\r\n\r\n1. `git clone \"https://github.com/k06a/truffle-string-multi-literal\"`\r\n2. `cd truffle-string-multi-literal`\r\n3. `npm install` or `yarn`\r\n4. `npm test` or `yarn test`\r\n\r\n## Expected Behavior\r\n\r\nSuccessful test passing\r\n\r\n## Actual Results\r\n\r\n```\r\nyarn run v1.22.10\r\n$ scripts/test.sh\r\nStarting our own ganache instance\r\nTruffle v5.2.5 (core: 5.2.5)\r\nSolidity - 0.8.2 (solc-js)\r\nNode v10.19.0\r\nWeb3.js v1.2.9\r\n\r\nCompiling your contracts...\r\n===========================\r\n> Compiling ./contracts/Migrations.sol\r\n> Compiling ./contracts/MultiLiteral.sol\r\n> Artifacts written to /var/folders/6x/vgh3wd655gn6nt72hbqydd240000gn/T/test--39890-HPtdScBB6ytf\r\n> Compiled successfully using:\r\n   - solc: 0.8.2+commit.661d1103.Emscripten.clang\r\n\r\n\r\n<--- Last few GCs --->\r\n\r\n[39890:0x110008000]    81824 ms: Mark-sweep 1325.6 (1443.9) -> 1312.0 (1444.9) MB, 306.4 / 0.0 ms  (average mu = 0.235, current mu = 0.197) allocation failure scavenge might not succeed\r\n[39890:0x110008000]    82183 ms: Mark-sweep 1326.6 (1444.9) -> 1313.2 (1445.9) MB, 285.9 / 0.0 ms  (average mu = 0.220, current mu = 0.203) allocation failure scavenge might not succeed\r\n\r\n\r\n<--- JS stacktrace --->\r\n\r\n==== JS stack trace =========================================\r\n\r\n    0: ExitFrame [pc: 0x39cb808dbe3d]\r\n    1: StubFrame [pc: 0x39cb808dd1ff]\r\nSecurity context: 0x3e858121e6e9 <JSObject>\r\n    2: combineCommonParents(aka combineCommonParents) [0x3e8554f88b89] [/Users/k06a/Projects/truffle-string-multi-literal/node_modules/@solidity-parser/parser/dist/index.cjs.js:~3568] [pc=0x39cb819ce469](this=0x3e8501f026f1 <undefined>,parents=0x3e8539fb59f1 <JSArray[4363]>)\r\n    3: mergeArrays(aka mergeArrays) [0x3e8554f...\r\n\r\nFATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory\r\n 1: 0x10003d051 node::Abort() [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 2: 0x10003d25b node::OnFatalError(char const*, char const*) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 3: 0x1001b90e5 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, bool) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 4: 0x100587042 v8::internal::Heap::FatalProcessOutOfMemory(char const*) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 5: 0x100589b15 v8::internal::Heap::CheckIneffectiveMarkCompact(unsigned long, double) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 6: 0x1005859bf v8::internal::Heap::PerformGarbageCollection(v8::internal::GarbageCollector, v8::GCCallbackFlags) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 7: 0x100583b94 v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 8: 0x10059042c v8::internal::Heap::AllocateRawWithLigthRetry(int, v8::internal::AllocationSpace, v8::internal::AllocationAlignment) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n 9: 0x1005904af v8::internal::Heap::AllocateRawWithRetryOrFail(int, v8::internal::AllocationSpace, v8::internal::AllocationAlignment) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n10: 0x10055fdf4 v8::internal::Factory::NewFillerObject(int, bool, v8::internal::AllocationSpace) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n11: 0x1007e80d4 v8::internal::Runtime_AllocateInNewSpace(int, v8::internal::Object**, v8::internal::Isolate*) [/Users/k06a/.nvm/versions/node/v10.19.0/bin/node]\r\n12: 0x39cb808dbe3d \r\n13: 0x39cb808dd1ff \r\nscripts/test.sh: line 72: 39890 Abort trap: 6           node_modules/.bin/truffle test \"$@\"\r\nerror Command failed with exit code 134.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n```\r\n\r\n## Environment\r\n\r\n* Operating System: macOS 10.11.2\r\n* Ethereum client: ganache-cli\r\n* Truffle version (`truffle version`): 5.2.5\r\n* node version (`node --version`): v10.19.0\r\n* npm version (`npm --version`): 6.14.8\r\n",
  "closed_by": {
    "login": "cds-amal",
    "id": 2529600,
    "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cds-amal",
    "html_url": "https://github.com/cds-amal",
    "followers_url": "https://api.github.com/users/cds-amal/followers",
    "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
    "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
    "organizations_url": "https://api.github.com/users/cds-amal/orgs",
    "repos_url": "https://api.github.com/users/cds-amal/repos",
    "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cds-amal/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/815126049",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3934#issuecomment-815126049",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934",
    "id": 815126049,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTEyNjA0OQ==",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T18:22:01Z",
    "updated_at": "2021-04-07T18:22:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@k06a offhand I'm not sure why you are getting an out of memory error - and it might be unrelated to the multiline string. Why do you think that is causing this?\r\n\r\nYou are using a version of Node that is not the most recent version of 10. You might try upgrading to a more recent version of 10 or using something even newer than that.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/815126049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839990574",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3934#issuecomment-839990574",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3934",
    "id": 839990574,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzOTk5MDU3NA==",
    "user": {
      "login": "cds-amal",
      "id": 2529600,
      "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds-amal",
      "html_url": "https://github.com/cds-amal",
      "followers_url": "https://api.github.com/users/cds-amal/followers",
      "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
      "organizations_url": "https://api.github.com/users/cds-amal/orgs",
      "repos_url": "https://api.github.com/users/cds-amal/repos",
      "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds-amal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-12T18:12:30Z",
    "updated_at": "2021-05-12T18:12:30Z",
    "author_association": "MEMBER",
    "body": "Hi @k06a, we're closing this for issue maintenance. If this is still an issue please comment and we'll reopen. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/839990574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
