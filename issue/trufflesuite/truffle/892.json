{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/892",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/892",
  "id": 314360607,
  "node_id": "MDU6SXNzdWUzMTQzNjA2MDc=",
  "number": 892,
  "title": "Migrating to rinkeby hangs indefinitely",
  "user": {
    "login": "lsankar4033",
    "id": 451947,
    "node_id": "MDQ6VXNlcjQ1MTk0Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/451947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lsankar4033",
    "html_url": "https://github.com/lsankar4033",
    "followers_url": "https://api.github.com/users/lsankar4033/followers",
    "following_url": "https://api.github.com/users/lsankar4033/following{/other_user}",
    "gists_url": "https://api.github.com/users/lsankar4033/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lsankar4033/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lsankar4033/subscriptions",
    "organizations_url": "https://api.github.com/users/lsankar4033/orgs",
    "repos_url": "https://api.github.com/users/lsankar4033/repos",
    "events_url": "https://api.github.com/users/lsankar4033/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lsankar4033/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-04-14T20:47:04Z",
  "updated_at": "2018-04-16T05:45:33Z",
  "closed_at": "2018-04-15T17:23:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [x] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\nI'm deploying some contracts to rinkeby via geth/truffle, but see the following whenever I try to deploy:\r\n```\r\n➜  lsankar git:(master) ✗ truffle migrate --reset --compile-all --network rinkeby\r\n... (contract names redacted)\r\nWriting artifacts to ./build/contracts\r\n\r\nUsing network 'rinkeby'.\r\n\r\nRunning migration: 1_initial_migration.js\r\n  Deploying Migrations...\r\n  ... 0x10a02c7ab65b43e3d6940ac1f08d2afcd56660a11bfee8df042699c47ac2bed8\r\n```\r\nWhat's strange is that that first migration seems to create its contract properly; it actually shows up on etherscan. Because the command hangs though, I can't run all of my migrations!\r\n\r\nNormally this wouldn't be an issue as I'd just split my migrations up and run them individually, but I have a few linked contracts (via `deployer.link`), so this wouldn't actually work here...\r\n\r\n## Steps to Reproduce\r\n\r\nGeth cmd: \r\n`geth --syncmode=fast --datadir=./chaindata --rinkeby --rpc --rpcapi eth,net,web3,personal,admin`\r\n\r\ntruffle.js:\r\n```\r\nmodule.exports = {\r\n  networks: {\r\n    development: {\r\n      host: \"127.0.0.1\",\r\n      port: 7545,\r\n      network_id: \"*\", // match any network\r\n    },\r\n\r\n    // via geth\r\n    rinkeby: {\r\n      host: \"127.0.0.1\",\r\n      port: 8545,\r\n      network_id: \"4\", // Rinkeby\r\n      from: \"0x96470e37772648882b94adefc1e99f4564b45d90\",\r\n      gas: 4700000,\r\n    }\r\n  }\r\n};\r\n```\r\n\r\nmigrate cmd:\r\n`truffle migrate --reset --compile-all --network rinkeby`\r\n\r\nAnd, I manually unlocked the address in question via the geth console.\r\n\r\n## Environment\r\n\r\n* Operating System: macOS 10.13.3\r\n* Truffle version: 4.0.6\r\n* Ethereum client: geth 1.6.7-stable-ab5646c5\r\n* node version: 8.9.0\r\n* npm version: 5.8.0\r\n",
  "closed_by": {
    "login": "lsankar4033",
    "id": 451947,
    "node_id": "MDQ6VXNlcjQ1MTk0Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/451947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lsankar4033",
    "html_url": "https://github.com/lsankar4033",
    "followers_url": "https://api.github.com/users/lsankar4033/followers",
    "following_url": "https://api.github.com/users/lsankar4033/following{/other_user}",
    "gists_url": "https://api.github.com/users/lsankar4033/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lsankar4033/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lsankar4033/subscriptions",
    "organizations_url": "https://api.github.com/users/lsankar4033/orgs",
    "repos_url": "https://api.github.com/users/lsankar4033/repos",
    "events_url": "https://api.github.com/users/lsankar4033/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lsankar4033/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/892/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/381379687",
    "html_url": "https://github.com/trufflesuite/truffle/issues/892#issuecomment-381379687",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892",
    "id": 381379687,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTM3OTY4Nw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-15T04:39:29Z",
    "updated_at": "2018-04-15T04:41:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "@lsankar4033 Would you be open to debugging this using `geth` in dev mode? You can pull down a `geth` instance through docker and run it without syncing anything (or doing any setup) to see if your migrations execute completely against a test client.  \r\n```shell\r\ndocker pull ethereum/client-go\r\ndocker run -it -p 8545:8545 -p 30303:30303 ethereum/client-go --rpc --rpcaddr \"0.0.0.0 --dev --period 2\"\r\n```\r\nDefine a new network:\r\n```javascript\r\ngeth: {\r\n   host: \"127.0.0.1\",\r\n   port: 8545,\r\n   network_id: \"*\", // match any network\r\n},\r\n```\r\nRun:\r\n```\r\ntruffle migrate --reset --compile-all --network geth\r\n```\r\nGeth --dev seeds with one funded, unlocked account so if you're migrating everything from a single account it should work (or fail for the same reason the Rinkeby's failing). I believe you can also specify the version when you pull from docker - there's more info [here](https://github.com/ethereum/go-ethereum/wiki/Running-in-Docker).\r\n\r\nWe've recently begun running our integration tests in CI against Geth. They include several migrations, and they've been executing successfully with latest Geth (1.8.x). Getting success or failure with the dev client might help isolate what the underlying cause of this problem is. ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/381379687/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/381422986",
    "html_url": "https://github.com/trufflesuite/truffle/issues/892#issuecomment-381422986",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892",
    "id": 381422986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTQyMjk4Ng==",
    "user": {
      "login": "lsankar4033",
      "id": 451947,
      "node_id": "MDQ6VXNlcjQ1MTk0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/451947?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lsankar4033",
      "html_url": "https://github.com/lsankar4033",
      "followers_url": "https://api.github.com/users/lsankar4033/followers",
      "following_url": "https://api.github.com/users/lsankar4033/following{/other_user}",
      "gists_url": "https://api.github.com/users/lsankar4033/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lsankar4033/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lsankar4033/subscriptions",
      "organizations_url": "https://api.github.com/users/lsankar4033/orgs",
      "repos_url": "https://api.github.com/users/lsankar4033/repos",
      "events_url": "https://api.github.com/users/lsankar4033/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lsankar4033/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-15T17:23:58Z",
    "updated_at": "2018-04-15T17:23:58Z",
    "author_association": "NONE",
    "body": "Thanks for the quick response! I ended up having success deploying my contract from a fresh geth node running on ubuntu via AWS, so this isn't a huge problem for me anymore. Will close the issue for now.\r\n\r\nFor completeness, tried using a geth --dev instance like you suggest as well, but ran into this issue on geth startup:\r\n```\r\n...\r\nINFO [04-15|17:20:44] Stopping Ethereum protocol\r\nINFO [04-15|17:20:44] RLPx listener up                         self=enode://ae08f736b4eee8e9fec0a532abc1c8f710550e744b564094ff21cc06e67029175a5a33fa9aa8206ed60f21d5dbdcb33f2eb7a4f59aa18b9bfa20f0c2afd8358a@[::]:30303\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xa6c21b]\r\n\r\ngoroutine 87 [running]:\r\ngithub.com/ethereum/go-ethereum/eth/filters.(*EventSystem).eventLoop(0xc420323740)\r\n        /go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/filters/filter_system.go:434 +0x2eb\r\ncreated by github.com/ethereum/go-ethereum/eth/filters.NewEventSystem\r\n        /go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/filters/filter_system.go:113 +0x104\r\n```\r\n\r\nAny chance you've seen that before?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/381422986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/381486092",
    "html_url": "https://github.com/trufflesuite/truffle/issues/892#issuecomment-381486092",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/892",
    "id": 381486092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTQ4NjA5Mg==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-16T05:45:33Z",
    "updated_at": "2018-04-16T05:45:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "@lsankar4033 Good to know! No, that's too bad about geth `dev`. I've been using the latest build without any issues. . . ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/381486092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
