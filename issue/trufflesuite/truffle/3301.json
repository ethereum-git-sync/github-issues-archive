{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/3301",
  "id": 685083781,
  "node_id": "MDU6SXNzdWU2ODUwODM3ODE=",
  "number": 3301,
  "title": "Inject bytecode for a contract/ how to debug when only have interface for already deployed contracts ",
  "user": {
    "login": "fxfactorial",
    "id": 3036816,
    "node_id": "MDQ6VXNlcjMwMzY4MTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fxfactorial",
    "html_url": "https://github.com/fxfactorial",
    "followers_url": "https://api.github.com/users/fxfactorial/followers",
    "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
    "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
    "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
    "repos_url": "https://api.github.com/users/fxfactorial/repos",
    "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-08-25T01:15:23Z",
  "updated_at": "2020-08-27T01:10:59Z",
  "closed_at": "2020-08-27T01:09:49Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Somewhat related to this other recently opened issue \r\n\r\nhttps://github.com/0xProject/0x-monorepo/issues/2679\r\n\r\nI have interfaces that I'm using in my contract which I deployed against my forked ganache node - and interacting with the deployed contract via `truffle console --network forked` \r\n\r\nthe contract has a method call that is exploding and via the 0x stack tracer , I get the line that is exploding, but no deeper insight into the stack because i don't have the bytecode of the external libraries, just their interfaces. \r\n\r\n```\r\ntruffle(forked)> Unable to find matching bytecode for contract address 0x45f783cce6b7ff23b2ab2d70e416cdb7d6055f51, please check your artifacts. Ignoring...\r\n```\r\n\r\nin principle, the chain does have the bytecode, and I tried adding the byte code into the build aritifacts by hand for the bytecode key value but this is hacky and it didn't produce any good results either. \r\n\r\nI also tried `truffle debug ` but truffle debug itself broke on \r\n\r\n```\r\n\r\ndebug(forked:0x8ed58570...)> n\r\n⠋ Stepping...TypeError: Cannot read property 'stack' of undefined\r\n    at /home/edgar/.nvm/versions/node/v12.18.3/lib/node_modules/truffle/build/webpack:/packages/debugger/dist/debugger.js:1:10570\r\n\r\n```\r\n\r\nso its not clear to me, what is the right flow to debug when you use external, already deployed contracts \r\n\r\nI suppose I can build all my dependencies as well - but I am not sure how to do that either because curve.fi uses vyber and contracts expects everything to be just `.sol` \r\n\r\nthank you ",
  "closed_by": {
    "login": "fxfactorial",
    "id": 3036816,
    "node_id": "MDQ6VXNlcjMwMzY4MTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fxfactorial",
    "html_url": "https://github.com/fxfactorial",
    "followers_url": "https://api.github.com/users/fxfactorial/followers",
    "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
    "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
    "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
    "repos_url": "https://api.github.com/users/fxfactorial/repos",
    "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/679846739",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3301#issuecomment-679846739",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301",
    "id": 679846739,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3OTg0NjczOQ==",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-25T07:09:29Z",
    "updated_at": "2020-08-25T07:09:29Z",
    "author_association": "MEMBER",
    "body": "Thanks for opening this!\r\n\r\nFor the stacktrace problem, I'm not sure there's a fix right now, but sounds like something @haltman-at will want to know about!\r\n\r\nFor `truffle debug`, try adding this flag:\r\n\r\n```\r\n$ truffle debug --fetch-external <tx-hash>\r\n```\r\n(or `-x` for short)\r\n\r\n**This will tell Truffle to download verified contracts from Etherscan and allow you to debug them.** Note that your forked network's network ID must match the network ID for the network you're forking from (This is default behavior with ganache-cli, but wanted to warn you in case you're overriding the network ID yourself!) For more info, see [our recent blog post about `--fetch-external`](https://www.trufflesuite.com/blog/debugging-verified-external-contracts-with-truffle-debugger), which includes a step-by-step that should serve as a reference for you in case of potential gotchas.\r\n\r\n(If you try this, please let us know if you get it working or not!)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/679846739/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/680444061",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3301#issuecomment-680444061",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301",
    "id": 680444061,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MDQ0NDA2MQ==",
    "user": {
      "login": "fxfactorial",
      "id": 3036816,
      "node_id": "MDQ6VXNlcjMwMzY4MTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fxfactorial",
      "html_url": "https://github.com/fxfactorial",
      "followers_url": "https://api.github.com/users/fxfactorial/followers",
      "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
      "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
      "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
      "repos_url": "https://api.github.com/users/fxfactorial/repos",
      "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-26T02:48:58Z",
    "updated_at": "2020-08-26T02:50:51Z",
    "author_association": "NONE",
    "body": "Cool - thank you for the quick reply - \r\n\r\nmy attempt: \r\n\r\n```\r\ntruffle debug --network forked --fetch-external 0x85aeb3f89b43428fe59cf4305a0725f3bbaefe6e77d0c86c41e8841af028b246\r\n```\r\n\r\nso I tried it against a forked ganache and it errored out with \r\n\r\n```\r\n truffle debug --network forked --fetch-external 0x85aeb3f89b43428fe59cf4305a0725f3bbaefe6e77d0c86c41e8841af028b246\r\nStarting Truffle Debugger...\r\n⠋ Getting and compiling external sources...\r\n/home/edgar/Repos/hye-token/node_modules/web3-provider-engine/subproviders/websocket.js:120\r\n    end(null, payload.result)\r\n    ^\r\nTypeError: end is not a function\r\n    at WebsocketSubprovider._handleSocketMessage (/home/edgar/Repos/hye-token/node_modules/web3-provider-engine/subproviders/websocket.js:120:5)\r\n    at WebSocket.onMessage (/home/edgar/Repos/hye-token/node_modules/ws/lib/event-target.js:120:16)\r\n    at WebSocket.emit (events.js:315:20)\r\n    at WebSocket.EventEmitter.emit (domain.js:483:12)\r\n    at Receiver.receiverOnMessage (/home/edgar/Repos/hye-token/node_modules/ws/lib/websocket.js:720:20)\r\n    at Receiver.emit (events.js:315:20)\r\n```\r\n\r\nwhich might or not be related to how i set up my config, based off how sol-trace had in their exmaple truffle repo \r\n\r\n```js\r\nconst ProviderEngine = require('web3-provider-engine');\r\nconst WebsocketSubprovider = require('web3-provider-engine/subproviders/websocket.js');\r\nconst {\r\n  TruffleArtifactAdapter,\r\n  RevertTraceSubprovider,\r\n} = require('@0x/sol-trace');\r\n\r\nconst projectRoot = '.';\r\nconst solcVersion = '0.6.5+commit.f956cc89';\r\nconst defaultFromAddress = '0xe8B479...0';\r\nconst isVerbose = true;\r\n\r\nconst artifactAdapter = new TruffleArtifactAdapter(projectRoot, solcVersion);\r\n\r\nconst revertTraceSubprovider = new RevertTraceSubprovider(\r\n  artifactAdapter,\r\n  defaultFromAddress,\r\n  isVerbose\r\n);\r\n\r\nconst provider = new ProviderEngine();\r\n\r\nprovider.addProvider(revertTraceSubprovider);\r\nprovider.addProvider(\r\n  new WebsocketSubprovider({rpcUrl: 'http://localhost:8545'})\r\n);\r\n\r\nprovider.start((err) => {\r\n  if (err !== undefined) {\r\n    console.log(err);\r\n    process.exit(1);\r\n  }\r\n});\r\n\r\nprovider.send = provider.sendAsync.bind(provider);\r\n\r\nmodule.exports = {\r\n  networks: {\r\n    forked: {\r\n      provider,\r\n      network_id: '1',\r\n      skipDryRun: true,\r\n    },\r\n  },\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/680444061/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/681179837",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3301#issuecomment-681179837",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301",
    "id": 681179837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTE3OTgzNw==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-26T23:44:59Z",
    "updated_at": "2020-08-26T23:44:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "So taking a look at this -- it looks like a lot of the issue is with this external tool, the 0x tracer?  I don't think we can help you with that.  However, it seems you're also reporting a crash in the Truffle debugger?  That I should be able to do something about if I can reproduce it.  Do you have reproduction steps for that, or perhaps a reproduction project I could take a look at?  Thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/681179837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/681203377",
    "html_url": "https://github.com/trufflesuite/truffle/issues/3301#issuecomment-681203377",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/3301",
    "id": 681203377,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTIwMzM3Nw==",
    "user": {
      "login": "fxfactorial",
      "id": 3036816,
      "node_id": "MDQ6VXNlcjMwMzY4MTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fxfactorial",
      "html_url": "https://github.com/fxfactorial",
      "followers_url": "https://api.github.com/users/fxfactorial/followers",
      "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
      "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
      "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
      "repos_url": "https://api.github.com/users/fxfactorial/repos",
      "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-27T01:09:49Z",
    "updated_at": "2020-08-27T01:10:59Z",
    "author_association": "NONE",
    "body": "ya - apologies - so I removed the sol-trace stuff and the debugger did give awesome stack trace! \r\n\r\nI'll also mention that since posting issue - I switched to ganache built off beta branch , which works better than current release \r\n\r\n```\r\nRevert message: UniswapV2: LOCKED\r\nPlease inspect your transaction parameters and contract code to determine the meaning of this error.\r\n\r\nStacktrace:\r\nError: Revert (message: UniswapV2: LOCKED)\r\n  at UniswapV2Pair.swap [address 0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc] (/tmp/tmp--635257-MrbdG7tPt4pm/UniswapV2Pair.sol:327:9)\r\n  at UniswapV2Pair [address 0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc] (/tmp/tmp--635257-MrbdG7tPt4pm/UniswapV2Pair.sol:454:5)\r\n  at Hye.kick_off_uniswap [address 0x3a173729D0De183d4d937e9cb7E28b95F4574946] (/home/edgar/Repos/hye-token/contracts/Hye.sol:310:5)\r\n  at Hye [address 0x3a173729D0De183d4d937e9cb7E28b95F4574946] (/home/edgar/Repos/hye-token/contracts/Hye.sol:285:3)\r\ndebug(forked:0x1068db59...)> \r\n```\r\n\r\nthe line numbers don't match up with original source but that's totally fine - the temp files are correct wrt content of source. AMAZING JOB FOLKS!! I love this feature.\r\n\r\nI will close because now there is a different issue - \r\n\r\nthe real revert reason is \r\n\r\n```\r\n        require(balance0Adjusted.mul(balance1Adjusted) >= uint(_reserve0).mul(_reserve1).mul(1000**2), 'UniswapV2: K');\r\n```\r\n\r\nin UniswapV2Pair.sol:182, \r\n\r\nbut after reverting the txn, ganache keeps the lock value - so the debug is going to the wrong place, reported many times in uniswap discord chat & \r\n\r\nhttps://github.com/Uniswap/uniswap-v2-periphery/issues/44\r\n\r\nafter a failed swap iteration, I restart ganache so the locked value is fresh again. \r\n\r\nThank you so much team - this is an amazing project - amazing tools ",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/681203377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
