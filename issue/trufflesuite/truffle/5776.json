{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/5776",
  "id": 1486615179,
  "node_id": "I_kwDOAkfq-c5Ym_KL",
  "number": 5776,
  "title": "[feature request] Truffle test should have a way to bypass ethEstimateGas",
  "user": {
    "login": "cds-amal",
    "id": 2529600,
    "node_id": "MDQ6VXNlcjI1Mjk2MDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2529600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cds-amal",
    "html_url": "https://github.com/cds-amal",
    "followers_url": "https://api.github.com/users/cds-amal/followers",
    "following_url": "https://api.github.com/users/cds-amal/following{/other_user}",
    "gists_url": "https://api.github.com/users/cds-amal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cds-amal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cds-amal/subscriptions",
    "organizations_url": "https://api.github.com/users/cds-amal/orgs",
    "repos_url": "https://api.github.com/users/cds-amal/repos",
    "events_url": "https://api.github.com/users/cds-amal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cds-amal/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1086852667,
      "node_id": "MDU6TGFiZWwxMDg2ODUyNjY3",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/needs%20requirements",
      "name": "needs requirements",
      "color": "d4c5f9",
      "default": false,
      "description": "feature request is unclear"
    },
    {
      "id": 1675041796,
      "node_id": "MDU6TGFiZWwxNjc1MDQxNzk2",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority3%20%F0%9F%94%A7",
      "name": "priority3 ðŸ”§",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-12-09T11:45:52Z",
  "updated_at": "2022-12-15T21:19:31Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "When you interact with a `@truffle/contract` in `truffle test` without specifying gas in the send parameters, ethEstimateGas is run to, uh, estimate the gas. If the transaction were to fail, in this step, the entire process stops and the reasons are reported. However, this results in no transaction persisted to Ganache, preventing one from followup investigation with the debugger. This nuance has foiled me and other maintainers multiple times, and recently [a user who wanted to use the debugger](https://github.com/trufflesuite/truffle/discussions/5774)! \r\n\r\nWe should have a flag to bypass the estimate gas check for `truffle test`, `truffle develop`, and perhaps `truffle console`? In the console environments, the feature should be toggle-able? I'm not actually sure how, but I added `needs-requirements`\r\n\r\n    ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1344628997",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5776#issuecomment-1344628997",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776",
    "id": 1344628997,
    "node_id": "IC_kwDOAkfq-c5QJWkF",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-09T18:31:03Z",
    "updated_at": "2022-12-09T18:31:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rather than making a special flag that people have to turn on, if we're creating this functionality, perhaps it should simply be on all the time in `truffle test`?  (It could potentially also be a flag in `truffle console` and `truffle develop`, I suppose, but see below about that.)  Remember that we actually already *have* this functionality in a slightly different form; if you do `truffle test --stacktrace` then it will bypass `estimateGas` in the way you describe, for instance (although it will then also do other things that we wouldn't want to do in general).\r\n\r\n(Actually, what it does is not bypass `estimateGas` entirely, but rather simply to not throw if `estimateGas` *fails*; if `estimateGas` succeeds it continues as normal, but if it fails rather than throwing it simply continues with a high gas limit for the transaction.  That's probably more like the behavior we want, I imagine.)\r\n\r\nAs for `console` and `develop`, rather than adding this flag, here's another possibility that came up in discussion with @jeffsmale90 -- we could simply adjust the error message.  If a transaction fails at the estimateGas stage, we could adjust the error message to make it clear that it failed at `estimateGas`, that no transaction was actually sent, and maybe even say something about how you can add a specified gas amount if you want to attempt the transaction anyway.\r\n\r\nSo, there are more alternatives here than simply adding a flag.  For `truffle test` I think probably we want this behavior on all the time; for the others I think there are more possibilities.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1344628997/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1347243874",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5776#issuecomment-1347243874",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776",
    "id": 1347243874,
    "node_id": "IC_kwDOAkfq-c5QTU9i",
    "user": {
      "login": "eggplantzzz",
      "id": 14827965,
      "node_id": "MDQ6VXNlcjE0ODI3OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eggplantzzz",
      "html_url": "https://github.com/eggplantzzz",
      "followers_url": "https://api.github.com/users/eggplantzzz/followers",
      "following_url": "https://api.github.com/users/eggplantzzz/following{/other_user}",
      "gists_url": "https://api.github.com/users/eggplantzzz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eggplantzzz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eggplantzzz/subscriptions",
      "organizations_url": "https://api.github.com/users/eggplantzzz/orgs",
      "repos_url": "https://api.github.com/users/eggplantzzz/repos",
      "events_url": "https://api.github.com/users/eggplantzzz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eggplantzzz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-12T20:15:59Z",
    "updated_at": "2022-12-12T20:15:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "If we were to add a flag for disabling this call to `estimateGas`, what value(s) would we use for gas when running the tx?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1347243874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1347694573",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5776#issuecomment-1347694573",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776",
    "id": 1347694573,
    "node_id": "IC_kwDOAkfq-c5QVC_t",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-13T03:27:40Z",
    "updated_at": "2022-12-13T03:27:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Right now, `truffle test` will set gas equal to half the block gas limit when `--stacktrace` is turned on.  (Again, that's only if the estimateGas fails -- we don't need to disable the call entirely!)  It's probably be fine to do that in `truffle test` more generally, and possibly even in `truffle develop`, but I'd be quite wary of doing it in `truffle console` where we might not be connected to a development network.  But then, I guess that's why one might restrict it to a flag in that case?  (Or use the error-better approach instead...)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1347694573/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1353720180",
    "html_url": "https://github.com/trufflesuite/truffle/issues/5776#issuecomment-1353720180",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/5776",
    "id": 1353720180,
    "node_id": "IC_kwDOAkfq-c5QsCF0",
    "user": {
      "login": "gnidan",
      "id": 151065,
      "node_id": "MDQ6VXNlcjE1MTA2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/151065?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnidan",
      "html_url": "https://github.com/gnidan",
      "followers_url": "https://api.github.com/users/gnidan/followers",
      "following_url": "https://api.github.com/users/gnidan/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnidan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnidan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnidan/subscriptions",
      "organizations_url": "https://api.github.com/users/gnidan/orgs",
      "repos_url": "https://api.github.com/users/gnidan/repos",
      "events_url": "https://api.github.com/users/gnidan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnidan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-15T21:19:30Z",
    "updated_at": "2022-12-15T21:19:30Z",
    "author_association": "MEMBER",
    "body": "Seems like the first course of action here is \"error better\"",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1353720180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
