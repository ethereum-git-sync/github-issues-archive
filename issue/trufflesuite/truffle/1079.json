{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/1079",
  "id": 337231784,
  "node_id": "MDU6SXNzdWUzMzcyMzE3ODQ=",
  "number": 1079,
  "title": "Error: replacement transaction underpriced (Infura)",
  "user": {
    "login": "mmezian",
    "id": 36275335,
    "node_id": "MDQ6VXNlcjM2Mjc1MzM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/36275335?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mmezian",
    "html_url": "https://github.com/mmezian",
    "followers_url": "https://api.github.com/users/mmezian/followers",
    "following_url": "https://api.github.com/users/mmezian/following{/other_user}",
    "gists_url": "https://api.github.com/users/mmezian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mmezian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mmezian/subscriptions",
    "organizations_url": "https://api.github.com/users/mmezian/orgs",
    "repos_url": "https://api.github.com/users/mmezian/repos",
    "events_url": "https://api.github.com/users/mmezian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mmezian/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1120350502,
      "node_id": "MDU6TGFiZWwxMTIwMzUwNTAy",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/stale",
      "name": "stale",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-06-30T17:51:37Z",
  "updated_at": "2018-11-15T09:10:30Z",
  "closed_at": "2018-11-15T09:10:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "- [ ] I've asked for help in the [Truffle Gitter](http://gitter.im/Consensys/truffle) before filing this issue.\r\n\r\n---------------------------\r\n\r\n## Issue\r\n\r\nWhen I launch many functions that write into storage through the truffle \"exec\" command into RINKEBY, I often get Error: replacement transaction underpriced for some of the calls. \r\n\r\nI'm using the HDWALLETPROVIDER to execute storage functions on RINKEBY.\r\n\r\n>   provider: function() {\r\n>         return new HDWalletProvider(process.env['RINKEBYNETMNEMONIC'], `https://rinkeby.infura.io/${process.env['INFURATOKEN']}`);\r\n>       },\r\n\r\nI tried searching the issue online, but its pointing me to other issues regarding NONCE and executing byte transactions.\r\n\r\n## Steps to Reproduce\r\n\r\nUsing truffle exec --network rinkeby, I have a file that launches 50 to 100 functions that write into storage. \r\n\r\nWhen I use \"await\" it works, but it takes too long (15-30min...), so I am now trying without await, synchronously.\r\n\r\nBut when I arrive at the 80th function, all the next ones have the following error : \r\nError: replacement transaction underpriced\r\n\r\nI tried adding a 500 ms timeout between each function, this doesn't seem to help.\r\n\r\nStrangely, this seems to happen more often when I have more storage function calls (100 instead of 50)\r\n\r\n## Expected Behavior\r\n\r\nTransactions should go through normally and appear in the blockchain once mined. Here only 3/4 of them are stored, all those with errors are not.\r\n\r\n## Actual Results\r\n\r\n(node:4092) UnhandledPromiseRejectionWarning: Error: replacement transaction underpriced\r\n    at ProviderError.ExtendableError (C:\\Users\\mezia_000\\AppData\\Roaming\\npm\\node_modules\\truffle\\build\\webpack:\\.-error\\index.js:10:1)\r\n    at new ProviderError (C:\\Users\\mezia_000\\AppData\\Roaming\\npm\\node_modules\\truffle\\build\\webpack:\\.-provider\\error.js:17:1)\r\n    at C:\\Users\\mezia_000\\AppData\\Roaming\\npm\\node_modules\\truffle\\build\\webpack:\\.-provider\\wrapper.js:71:1\r\n    at C:\\Users\\mezia_000\\AppData\\Roaming\\npm\\node_modules\\truffle\\build\\webpack:\\.-provider\\wrapper.js:129:1\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\web3-provider-engine\\index.js:150:9\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\once.js:12:16\r\n    at replenish (C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\eachOfLimit.js:61:25)\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\eachOfLimit.js:71:9\r\n    at eachLimit (C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\eachLimit.js:43:36)\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\doLimit.js:9:16\r\n    at end (C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\web3-provider-engine\\index.js:127:5)\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\once.js:12:16\r\n    at next (C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\waterfall.js:21:29)\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\onlyOnce.js:12:16\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\once.js:12:16\r\n    at next (C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\waterfall.js:21:29)\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\onlyOnce.js:12:16\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\web3-provider-engine\\subproviders\\hooked-wallet.js:460:23\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\once.js:12:16\r\n    at next (C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\waterfall.js:21:29)\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\async\\internal\\onlyOnce.js:12:16\r\n    at C:\\Users\\mezia_000\\Documents\\Work\\Ject\\POLY\\ERC721Token\\node_modules\\web3-provider-engine\\subproviders\\hooked-wallet.js:488:21\r\n(node:4092) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection\r\nid: 13)\r\n\r\n## Environment\r\n\r\nwindows 10 / truffle v4.1.12 and solidity v0.4.24\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/401624573",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1079#issuecomment-401624573",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079",
    "id": 401624573,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTYyNDU3Mw==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-01T18:36:19Z",
    "updated_at": "2018-07-01T18:37:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mmezian There's more discussion of this specific error [here](https://ethereum.stackexchange.com/questions/27256/error-replacement-transaction-underpriced). \r\n\r\nQuestions:\r\n+ Are these txs meant to occur in a strict sequence / can they run in parallel? \r\n+ If parallel, is it possible for you to distribute them across many accounts? I'm not sure how viable this is with `truffle-hdwallet-provider` itself, although there are [some forks](https://github.com/crypedit/truffle-wallet-provider) of that repo which allow you to generate several accounts and use a keystore.\r\n\r\nThe `nonce too low` issue may come into play here as well because infura load-balances its traffic across various nodes and network latency seems to result in some txs that were sent 'second', propagating 'first'.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/401624573/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/401637026",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1079#issuecomment-401637026",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079",
    "id": 401637026,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTYzNzAyNg==",
    "user": {
      "login": "mmezian",
      "id": 36275335,
      "node_id": "MDQ6VXNlcjM2Mjc1MzM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/36275335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mmezian",
      "html_url": "https://github.com/mmezian",
      "followers_url": "https://api.github.com/users/mmezian/followers",
      "following_url": "https://api.github.com/users/mmezian/following{/other_user}",
      "gists_url": "https://api.github.com/users/mmezian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mmezian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mmezian/subscriptions",
      "organizations_url": "https://api.github.com/users/mmezian/orgs",
      "repos_url": "https://api.github.com/users/mmezian/repos",
      "events_url": "https://api.github.com/users/mmezian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mmezian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-01T22:14:13Z",
    "updated_at": "2018-07-01T22:14:13Z",
    "author_association": "NONE",
    "body": "hi @cgewecke , thanks for your answer!\r\n\r\nUnlike contract deployment, I don't need these to run in strict sequence, that's why I'm trying to run them synchronously. \r\n\r\nI need it to be from one single account, as the contract verification requires those actions to be performed by the owner of the contract.\r\n\r\nDoes anyone have a workaround ? \r\n\r\nShould I setup a higher timeout, like 5 seconds, between each of them ? Which would be 500 seconds for 100... but it's fine. \r\n\r\nMaybe I should only do async ones for MAIN NET to avoid these issues\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/401637026/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/419167915",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1079#issuecomment-419167915",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079",
    "id": 419167915,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTE2NzkxNQ==",
    "user": {
      "login": "cgewecke",
      "id": 7332026,
      "node_id": "MDQ6VXNlcjczMzIwMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7332026?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cgewecke",
      "html_url": "https://github.com/cgewecke",
      "followers_url": "https://api.github.com/users/cgewecke/followers",
      "following_url": "https://api.github.com/users/cgewecke/following{/other_user}",
      "gists_url": "https://api.github.com/users/cgewecke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cgewecke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cgewecke/subscriptions",
      "organizations_url": "https://api.github.com/users/cgewecke/orgs",
      "repos_url": "https://api.github.com/users/cgewecke/repos",
      "events_url": "https://api.github.com/users/cgewecke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cgewecke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-06T16:59:59Z",
    "updated_at": "2018-09-06T16:59:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mmezian Status update: this topic has come up at truffle-hdwallet-provider recently and a little bit of headway has made there in [issue 65](https://github.com/trufflesuite/truffle-hdwallet-provider/issues/65). Did you ever find a workable solution for your use case?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/419167915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/436910731",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1079#issuecomment-436910731",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079",
    "id": 436910731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjkxMDczMQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-08T08:21:44Z",
    "updated_at": "2018-11-08T08:21:44Z",
    "author_association": "NONE",
    "body": "Thank you for raising this issue! It has been automatically marked as stale because it has not had recent activity. It will be closed in 7 days if no further activity occurs. If you would like to keep this issue open, please respond with information about the current state of this problem.\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/436910731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/438969540",
    "html_url": "https://github.com/trufflesuite/truffle/issues/1079#issuecomment-438969540",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/1079",
    "id": 438969540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODk2OTU0MA==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-15T09:10:05Z",
    "updated_at": "2018-11-15T09:10:05Z",
    "author_association": "NONE",
    "body": "There has been no new activity on this issue since it was marked as stale 7 days ago, so it is being automatically closed.  If you'd like help with this or a different problem, please open a new issue. Thanks!\n",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/438969540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
