{
  "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
  "repository_url": "https://api.github.com/repos/trufflesuite/truffle",
  "labels_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123/labels{/name}",
  "comments_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123/comments",
  "events_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123/events",
  "html_url": "https://github.com/trufflesuite/truffle/issues/4123",
  "id": 925568035,
  "node_id": "MDU6SXNzdWU5MjU1NjgwMzU=",
  "number": 4123,
  "title": "Custom error info not shown on method interaction using truffle develop",
  "user": {
    "login": "Aniket-Engg",
    "id": 30843294,
    "node_id": "MDQ6VXNlcjMwODQzMjk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/30843294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Aniket-Engg",
    "html_url": "https://github.com/Aniket-Engg",
    "followers_url": "https://api.github.com/users/Aniket-Engg/followers",
    "following_url": "https://api.github.com/users/Aniket-Engg/following{/other_user}",
    "gists_url": "https://api.github.com/users/Aniket-Engg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Aniket-Engg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Aniket-Engg/subscriptions",
    "organizations_url": "https://api.github.com/users/Aniket-Engg/orgs",
    "repos_url": "https://api.github.com/users/Aniket-Engg/repos",
    "events_url": "https://api.github.com/users/Aniket-Engg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Aniket-Engg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 971535002,
      "node_id": "MDU6TGFiZWw5NzE1MzUwMDI=",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/Debugger",
      "name": "Debugger",
      "color": "7911ad",
      "default": false,
      "description": ""
    },
    {
      "id": 1675042518,
      "node_id": "MDU6TGFiZWwxNjc1MDQyNTE4",
      "url": "https://api.github.com/repos/trufflesuite/truffle/labels/priority6%20%F0%9F%92%AD",
      "name": "priority6 💭",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-06-20T10:27:29Z",
  "updated_at": "2023-08-12T22:48:59Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\n  Truffle does not show solidity custom error information while calling a method using `truffle develop`\r\n## Steps to Reproduce\r\nCall a method which fails by reverting with custom error.\r\n\r\n## Expected Behaviour\r\nCustom error information with `revert` opcode\r\n## Actual Results\r\n\r\nShows plain `revert` as:\r\n```\r\ntruffle(develop)> instance.list({value: 15})\r\nThrown:\r\n{ Error: Returned error: VM Exception while processing transaction: revert\r\n```\r\n\r\n## Environment\r\nOperating System: MacOS\r\nTruffle v5.3.11 (core: 5.3.11)\r\nSolidity - 0.8.4 (solc-js)\r\nNode v11.15.0\r\nWeb3.js v1.3.6\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865463585",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-865463585",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 865463585,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTQ2MzU4NQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T02:03:26Z",
    "updated_at": "2021-06-22T02:03:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, unfortunately this is not so easy.  This is of course related to #3873.  Unfortunately addressing this sort of thing is likely going to require some serious rewriting.  We're planning to do that rewriting!  But ti's not happening yet.\r\n\r\nBut then in addition we run into some more fundamental problems.  Is `instance.list` a transaction or a call?  I'm guessing the latter.  Either way we have some problems:\r\n1. If it's a transaction, then we can't actually get the returned value to decode.  This is already a problem currently with revert strings!  Of course, if you're using Ganache in what is currently its default mode, where it errors on reverts and includes the revert string, that gets around this somewhat, but it won't get around it when interacting with a more standard Ethereum node.  Also note that this method of getting around things relies on Ganache doing the decoding, and so won't work with custom errors, as Ganache can't really know about that sort of thing.\r\n2. If it's a call... well, that case is more handleable.  (But, like I said, will require some serious rewriting before we can handle it.)  We *are* hoping to get this case working eventually, but it's likely going to be a while.  And that said, even in the cases we can handle, it should be noted that due to their nature one can never *guarantee* that decoding of a custom error will work.\r\n\r\nSo, this is something I would hope we can address eventually, but it's not likely to be soon.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865463585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865463939",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-865463939",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 865463939,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTQ2MzkzOQ==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T02:04:16Z",
    "updated_at": "2021-06-22T02:04:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "All that said, we did recently add support for custom errors in the Truffle Debugger, if you're looking for more information on what you can do in the meantime until we resolve this properly. :)",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/865463939/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/894451631",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-894451631",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 894451631,
    "node_id": "IC_kwDOAkfq-c41UD-v",
    "user": {
      "login": "johnnylambada",
      "id": 180409,
      "node_id": "MDQ6VXNlcjE4MDQwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/180409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/johnnylambada",
      "html_url": "https://github.com/johnnylambada",
      "followers_url": "https://api.github.com/users/johnnylambada/followers",
      "following_url": "https://api.github.com/users/johnnylambada/following{/other_user}",
      "gists_url": "https://api.github.com/users/johnnylambada/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/johnnylambada/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/johnnylambada/subscriptions",
      "organizations_url": "https://api.github.com/users/johnnylambada/orgs",
      "repos_url": "https://api.github.com/users/johnnylambada/repos",
      "events_url": "https://api.github.com/users/johnnylambada/events{/privacy}",
      "received_events_url": "https://api.github.com/users/johnnylambada/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-06T18:46:49Z",
    "updated_at": "2021-08-06T18:46:49Z",
    "author_association": "NONE",
    "body": "Not 100% on topic, but I ran across this when trying to find a way to discriminate between custom errors introduced in Solidity 0.8.4. I ended up writing the following `expectRevertError` function [with the help of this article](https://blog.soliditylang.org/2021/04/21/custom-errors/). I hope it's helpful:\r\n\r\n```\r\n  const expectRevertError = async function(promise, expectedErrorSignature) {\r\n    try {\r\n      await promise;\r\n    } catch (error) {\r\n      const encoded = web3.eth.abi.encodeFunctionSignature(expectedErrorSignature);\r\n      const returnValue = Object.entries(error.data).filter(it=>it.length>1).map(it=>it[1]).find(it=>it!=null && it.constructor.name===\"Object\" && \"return\" in it).return\r\n      expect(returnValue).to.startWith(encoded);\r\n      return;\r\n    }\r\n    expect.fail('Expected an exception but none was received');\r\n  }\r\n  ```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/894451631/reactions",
      "total_count": 4,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 3
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1285228328",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-1285228328",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 1285228328,
    "node_id": "IC_kwDOAkfq-c5Mmwco",
    "user": {
      "login": "ko1ebayev",
      "id": 47644077,
      "node_id": "MDQ6VXNlcjQ3NjQ0MDc3",
      "avatar_url": "https://avatars.githubusercontent.com/u/47644077?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ko1ebayev",
      "html_url": "https://github.com/ko1ebayev",
      "followers_url": "https://api.github.com/users/ko1ebayev/followers",
      "following_url": "https://api.github.com/users/ko1ebayev/following{/other_user}",
      "gists_url": "https://api.github.com/users/ko1ebayev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ko1ebayev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ko1ebayev/subscriptions",
      "organizations_url": "https://api.github.com/users/ko1ebayev/orgs",
      "repos_url": "https://api.github.com/users/ko1ebayev/repos",
      "events_url": "https://api.github.com/users/ko1ebayev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ko1ebayev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-20T09:34:23Z",
    "updated_at": "2022-10-20T09:35:21Z",
    "author_association": "NONE",
    "body": "hey @johnnylambada I understand that I'm asking a year later😁, but what is the error model that you get from the revert? I'm working with handling reverts made with customErrors now and getting just `{ message: string; stack: string }` from revert. which is strange, information about the error lies as a string inside the message field, for example: \r\n```\r\n{\r\nstack: 'Some javascript error description',\r\nmessage: 'Error: Internal JSON-RPC error. { \"code\": 3, \"message\": \"execution reverted\", \"data\": \"0x336cc9a5000000000000....00000000000182bbd86e62cfca\"'\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1285228328/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1483895684",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-1483895684",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 1483895684,
    "node_id": "IC_kwDOAkfq-c5YcnOE",
    "user": {
      "login": "johnnyshankman",
      "id": 6632701,
      "node_id": "MDQ6VXNlcjY2MzI3MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6632701?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/johnnyshankman",
      "html_url": "https://github.com/johnnyshankman",
      "followers_url": "https://api.github.com/users/johnnyshankman/followers",
      "following_url": "https://api.github.com/users/johnnyshankman/following{/other_user}",
      "gists_url": "https://api.github.com/users/johnnyshankman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/johnnyshankman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/johnnyshankman/subscriptions",
      "organizations_url": "https://api.github.com/users/johnnyshankman/orgs",
      "repos_url": "https://api.github.com/users/johnnyshankman/repos",
      "events_url": "https://api.github.com/users/johnnyshankman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/johnnyshankman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-25T18:50:02Z",
    "updated_at": "2023-03-25T18:50:20Z",
    "author_association": "NONE",
    "body": "> Not 100% on topic, but I ran across this when trying to find a way to discriminate between custom errors introduced in Solidity 0.8.4. I ended up writing the following `expectRevertError` function [with the help of this article](https://blog.soliditylang.org/2021/04/21/custom-errors/). I hope it's helpful:\r\n> \r\n> ```\r\n>   const expectRevertError = async function(promise, expectedErrorSignature) {\r\n>     try {\r\n>       await promise;\r\n>     } catch (error) {\r\n>       const encoded = web3.eth.abi.encodeFunctionSignature(expectedErrorSignature);\r\n>       const returnValue = Object.entries(error.data).filter(it=>it.length>1).map(it=>it[1]).find(it=>it!=null && it.constructor.name===\"Object\" && \"return\" in it).return\r\n>       expect(returnValue).to.startWith(encoded);\r\n>       return;\r\n>     }\r\n>     expect.fail('Expected an exception but none was received');\r\n>   }\r\n> ```\r\n\r\nThank you for this, works like a charm for me.\r\n\r\nUsage is exactly like `await truffleAssert.reverts`. Second parameter should be you're error definition as a string. So for me things like `\"TokenDNE()\"`.",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1483895684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1669464365",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-1669464365",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 1669464365,
    "node_id": "IC_kwDOAkfq-c5jggEt",
    "user": {
      "login": "DanielKillenberger",
      "id": 5844780,
      "node_id": "MDQ6VXNlcjU4NDQ3ODA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5844780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielKillenberger",
      "html_url": "https://github.com/DanielKillenberger",
      "followers_url": "https://api.github.com/users/DanielKillenberger/followers",
      "following_url": "https://api.github.com/users/DanielKillenberger/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielKillenberger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielKillenberger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielKillenberger/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielKillenberger/orgs",
      "repos_url": "https://api.github.com/users/DanielKillenberger/repos",
      "events_url": "https://api.github.com/users/DanielKillenberger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielKillenberger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-08T11:49:21Z",
    "updated_at": "2023-08-08T11:49:21Z",
    "author_association": "NONE",
    "body": "any updates on this issue?",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1669464365/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1675967486",
    "html_url": "https://github.com/trufflesuite/truffle/issues/4123#issuecomment-1675967486",
    "issue_url": "https://api.github.com/repos/trufflesuite/truffle/issues/4123",
    "id": 1675967486,
    "node_id": "IC_kwDOAkfq-c5j5Tv-",
    "user": {
      "login": "GorgeousPuree",
      "id": 46875481,
      "node_id": "MDQ6VXNlcjQ2ODc1NDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/46875481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GorgeousPuree",
      "html_url": "https://github.com/GorgeousPuree",
      "followers_url": "https://api.github.com/users/GorgeousPuree/followers",
      "following_url": "https://api.github.com/users/GorgeousPuree/following{/other_user}",
      "gists_url": "https://api.github.com/users/GorgeousPuree/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GorgeousPuree/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GorgeousPuree/subscriptions",
      "organizations_url": "https://api.github.com/users/GorgeousPuree/orgs",
      "repos_url": "https://api.github.com/users/GorgeousPuree/repos",
      "events_url": "https://api.github.com/users/GorgeousPuree/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GorgeousPuree/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-12T15:36:26Z",
    "updated_at": "2023-08-12T15:36:26Z",
    "author_association": "NONE",
    "body": "it's been two years guys",
    "reactions": {
      "url": "https://api.github.com/repos/trufflesuite/truffle/issues/comments/1675967486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
