{
  "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
  "repository_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto",
  "labels_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067/labels{/name}",
  "comments_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067/comments",
  "events_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067/events",
  "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067",
  "id": 958403593,
  "node_id": "MDU6SXNzdWU5NTg0MDM1OTM=",
  "number": 4067,
  "title": "Potential Issue with maxPriorityFeePerGas estimation",
  "user": {
    "login": "cloudonshore",
    "id": 1197232,
    "node_id": "MDQ6VXNlcjExOTcyMzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1197232?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cloudonshore",
    "html_url": "https://github.com/cloudonshore",
    "followers_url": "https://api.github.com/users/cloudonshore/followers",
    "following_url": "https://api.github.com/users/cloudonshore/following{/other_user}",
    "gists_url": "https://api.github.com/users/cloudonshore/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cloudonshore/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cloudonshore/subscriptions",
    "organizations_url": "https://api.github.com/users/cloudonshore/orgs",
    "repos_url": "https://api.github.com/users/cloudonshore/repos",
    "events_url": "https://api.github.com/users/cloudonshore/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cloudonshore/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "FrederikBolding",
    "id": 1561200,
    "node_id": "MDQ6VXNlcjE1NjEyMDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/FrederikBolding",
    "html_url": "https://github.com/FrederikBolding",
    "followers_url": "https://api.github.com/users/FrederikBolding/followers",
    "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
    "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
    "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
    "repos_url": "https://api.github.com/users/FrederikBolding/repos",
    "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
    "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "FrederikBolding",
      "id": 1561200,
      "node_id": "MDQ6VXNlcjE1NjEyMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrederikBolding",
      "html_url": "https://github.com/FrederikBolding",
      "followers_url": "https://api.github.com/users/FrederikBolding/followers",
      "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
      "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
      "repos_url": "https://api.github.com/users/FrederikBolding/repos",
      "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-08-02T18:29:45Z",
  "updated_at": "2021-08-16T11:55:56Z",
  "closed_at": "2021-08-03T12:15:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "_Github issues are primarily for reporting bugs or getting assistance with development-related items. If you have a question or need support with our product, please email support@mycrypto.com for faster attention._\r\n\r\n_If you are reporting an issue, please use the template below so we can reproduce, determine the cause of the issue, and fix it! If you are not reporting an issue, delete this entire thing and type away. Thanks!_\r\n\r\n---\r\n\r\n### Description of Issue\r\n\r\nIn the code for fetching the fee history you use the 1st percentile.\r\nhttps://github.com/MyCryptoHQ/MyCrypto/blob/fb/eip-1559/src/services/ApiService/Gas/eip1559.ts#L10\r\n\r\nHowever, looking at the current fee history on mainnet, fetching the last 5 blocks, there are many `0` value `reward` responses at the 1st percentile. (this is a response to `provider.send('eth_feeHistory', [\r\n    5,\r\n    hexlify(latestBlock.number),\r\n    1,\r\n  ])`)\r\n\r\n```\r\n{\r\n   \"baseFeePerGas\":[\r\n      \"0\",\r\n      \"0\",\r\n      \"0\",\r\n      \"0\",\r\n      \"0\",\r\n      \"0\"\r\n   ],\r\n   \"gasUsedRatio\":[\r\n      0.9998642662182998,\r\n      0.9987883963929768,\r\n      0.9998072632102536,\r\n      0.998654061598854,\r\n      0.999909687412393\r\n   ],\r\n   \"oldestBlock\":12947488,\r\n   \"reward\":[\r\n      [\r\n         \"0\"\r\n      ],\r\n      [\r\n         \"44850000000\"\r\n      ],\r\n      [\r\n         \"1000000000\"\r\n      ],\r\n      [\r\n         \"0\"\r\n      ],\r\n      [\r\n         \"0\"\r\n      ]\r\n   ]\r\n}\r\n```\r\nThis is most likely due to flashbot transactions that are being inserted directly by the miner. I've found that using the 10th percentile generally filters these out, but is by no means a programmatically dependable method. \r\n\r\nBasically, I think you might potentially be suggesting users use a priority fee of `0` once 1559 goes live on mainnet, because the 1st percentile is often `0` when flashbot transactions are included in the block. I've also seen flashbot transactions submitted with `1` wei for gas price as well, so filtering out for just `0` doesn't seem like a good enough way to catch the issue.\r\n\r\nI'm currently developing the 1559 gas fee algorithm for metamask. If you think of other clever ways to get around this issue I would love to jump on a call. My email is sam.walker@consensys.net.\r\n",
  "closed_by": {
    "login": "FrederikBolding",
    "id": 1561200,
    "node_id": "MDQ6VXNlcjE1NjEyMDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/FrederikBolding",
    "html_url": "https://github.com/FrederikBolding",
    "followers_url": "https://api.github.com/users/FrederikBolding/followers",
    "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
    "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
    "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
    "repos_url": "https://api.github.com/users/FrederikBolding/repos",
    "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
    "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891247249",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-891247249",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 891247249,
    "node_id": "IC_kwDOBIA0fM41H1qR",
    "user": {
      "login": "FrederikBolding",
      "id": 1561200,
      "node_id": "MDQ6VXNlcjE1NjEyMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrederikBolding",
      "html_url": "https://github.com/FrederikBolding",
      "followers_url": "https://api.github.com/users/FrederikBolding/followers",
      "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
      "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
      "repos_url": "https://api.github.com/users/FrederikBolding/repos",
      "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-02T18:40:53Z",
    "updated_at": "2021-08-02T18:43:34Z",
    "author_association": "COLLABORATOR",
    "body": "Thanks for the report!\r\n\r\nI hadn't seen these values being returned before. But I will definitely look into this. I'll let you know what I find.",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891247249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891259054",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-891259054",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 891259054,
    "node_id": "IC_kwDOBIA0fM41H4iu",
    "user": {
      "login": "FrederikBolding",
      "id": 1561200,
      "node_id": "MDQ6VXNlcjE1NjEyMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrederikBolding",
      "html_url": "https://github.com/FrederikBolding",
      "followers_url": "https://api.github.com/users/FrederikBolding/followers",
      "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
      "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
      "repos_url": "https://api.github.com/users/FrederikBolding/repos",
      "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-02T19:02:03Z",
    "updated_at": "2021-08-02T19:02:03Z",
    "author_association": "COLLABORATOR",
    "body": "@cloudonshore I can indeed see that this is behaviour that happens on mainnet. My initial instinct is that we should probably look at more blocks and then filter out values that are \"obviously wrong\". But don't have a solution at this time. Let me know if you want to discuss it further.",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891259054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891363199",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-891363199",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 891363199,
    "node_id": "IC_kwDOBIA0fM41IR9_",
    "user": {
      "login": "FrederikBolding",
      "id": 1561200,
      "node_id": "MDQ6VXNlcjE1NjEyMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrederikBolding",
      "html_url": "https://github.com/FrederikBolding",
      "followers_url": "https://api.github.com/users/FrederikBolding/followers",
      "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
      "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
      "repos_url": "https://api.github.com/users/FrederikBolding/repos",
      "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-02T22:03:07Z",
    "updated_at": "2021-08-02T22:04:25Z",
    "author_association": "COLLABORATOR",
    "body": "@cloudonshore The solution I came up in the latest commit consists of multiple things:\r\n\r\n- Remove all zero values\r\n- Consider `10` blocks instead of `5`\r\n- Consider `5` percentile instead of `1`\r\n- Slice off values that are significantly lower than the rest of the values (have a 200%+ increase in value) (See: https://github.com/MyCryptoHQ/MyCrypto/blob/fb/eip-1559/src/services/ApiService/Gas/eip1559.ts#L64-L81)\r\n\r\nLet me know your thoughts and if you want to discuss any of this more! 😄 ",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891363199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891393044",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-891393044",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 891393044,
    "node_id": "IC_kwDOBIA0fM41IZQU",
    "user": {
      "login": "cloudonshore",
      "id": 1197232,
      "node_id": "MDQ6VXNlcjExOTcyMzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1197232?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cloudonshore",
      "html_url": "https://github.com/cloudonshore",
      "followers_url": "https://api.github.com/users/cloudonshore/followers",
      "following_url": "https://api.github.com/users/cloudonshore/following{/other_user}",
      "gists_url": "https://api.github.com/users/cloudonshore/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cloudonshore/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cloudonshore/subscriptions",
      "organizations_url": "https://api.github.com/users/cloudonshore/orgs",
      "repos_url": "https://api.github.com/users/cloudonshore/repos",
      "events_url": "https://api.github.com/users/cloudonshore/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cloudonshore/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-02T23:12:47Z",
    "updated_at": "2021-08-02T23:12:47Z",
    "author_association": "NONE",
    "body": "I think that sounds like a very sane solution. Was implementing something along the same lines. ",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891393044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891798617",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-891798617",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 891798617,
    "node_id": "IC_kwDOBIA0fM41J8RZ",
    "user": {
      "login": "FrederikBolding",
      "id": 1561200,
      "node_id": "MDQ6VXNlcjE1NjEyMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrederikBolding",
      "html_url": "https://github.com/FrederikBolding",
      "followers_url": "https://api.github.com/users/FrederikBolding/followers",
      "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
      "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
      "repos_url": "https://api.github.com/users/FrederikBolding/repos",
      "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-03T12:15:41Z",
    "updated_at": "2021-08-03T12:15:41Z",
    "author_association": "COLLABORATOR",
    "body": "> I think that sounds like a very sane solution. Was implementing something along the same lines.\r\n\r\nGreat to hear! Thanks again for reporting!",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/891798617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/899449055",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-899449055",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 899449055,
    "node_id": "IC_kwDOBIA0fM41nIDf",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T11:53:18Z",
    "updated_at": "2021-08-16T11:53:18Z",
    "author_association": "NONE",
    "body": "FYI: these zeroes are happening for empty blocks",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/899449055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/899450477",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/4067#issuecomment-899450477",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/4067",
    "id": 899450477,
    "node_id": "IC_kwDOBIA0fM41nIZt",
    "user": {
      "login": "FrederikBolding",
      "id": 1561200,
      "node_id": "MDQ6VXNlcjE1NjEyMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1561200?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrederikBolding",
      "html_url": "https://github.com/FrederikBolding",
      "followers_url": "https://api.github.com/users/FrederikBolding/followers",
      "following_url": "https://api.github.com/users/FrederikBolding/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrederikBolding/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrederikBolding/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrederikBolding/subscriptions",
      "organizations_url": "https://api.github.com/users/FrederikBolding/orgs",
      "repos_url": "https://api.github.com/users/FrederikBolding/repos",
      "events_url": "https://api.github.com/users/FrederikBolding/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrederikBolding/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T11:55:56Z",
    "updated_at": "2021-08-16T11:55:56Z",
    "author_association": "COLLABORATOR",
    "body": "> FYI: these zeroes are happening for empty blocks\r\n\r\nAlso that, yes 👍",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/899450477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
