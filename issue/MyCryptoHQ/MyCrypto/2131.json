{
  "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131",
  "repository_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto",
  "labels_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131/labels{/name}",
  "comments_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131/comments",
  "events_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131/events",
  "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/2131",
  "id": 353245223,
  "node_id": "MDU6SXNzdWUzNTMyNDUyMjM=",
  "number": 2131,
  "title": "Keystore Support is non-universal",
  "user": {
    "login": "ChosunOne",
    "id": 5751289,
    "node_id": "MDQ6VXNlcjU3NTEyODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5751289?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ChosunOne",
    "html_url": "https://github.com/ChosunOne",
    "followers_url": "https://api.github.com/users/ChosunOne/followers",
    "following_url": "https://api.github.com/users/ChosunOne/following{/other_user}",
    "gists_url": "https://api.github.com/users/ChosunOne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ChosunOne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ChosunOne/subscriptions",
    "organizations_url": "https://api.github.com/users/ChosunOne/orgs",
    "repos_url": "https://api.github.com/users/ChosunOne/repos",
    "events_url": "https://api.github.com/users/ChosunOne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ChosunOne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-08-23T06:43:41Z",
  "updated_at": "2018-09-04T06:47:58Z",
  "closed_at": "2018-08-31T15:08:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description of the Issue\r\n\r\nLoaded keystore files do not support files generated from web3js v3 encrypted wallets.  \r\n\r\n### Steps to Reproduce\r\n\r\nCreate a wallet via the following code in Web3js:\r\n```\r\nvar wallet = require(\"ethereumjs-wallet\")\r\nlet private_key = Buffer.from([0x75, 0xca, 0x59, 0x3e, 0xcb, 0x74, 0x06, 0x79, 0x19, 0x10, 0xff, 0x87, 0x0d, 0x0f, 0x8d, 0xd0,0x4d, 0x13, 0x00, 0xf2, 0xc0, 0xfd, 0x17, 0xaf,0xa6, 0xff, 0xbb, 0x60, 0x51, 0xbf, 0x4a, 0xc2])\r\nlet salt = Buffer.from([0xae, 0x3c, 0xd4, 0xe7, 0x01, 0x38, 0x36, 0xa3,0xdf, 0x6b, 0xd7, 0x24, 0x1b, 0x12, 0xdb, 0x06,0x1d, 0xbe, 0x2c, 0x67, 0x85, 0x85, 0x3c, 0xce,0x42, 0x2d, 0x14, 0x8a, 0x62, 0x4c, 0xe0, 0xbd])\r\nlet iv = Buffer.from([0x60, 0x87, 0xda, 0xb2, 0xf9, 0xfd, 0xbb, 0xfa,0xdd, 0xc3, 0x1a, 0x90, 0x97, 0x35, 0xc1, 0xe6])\r\nlet ether_wallet = wallet.fromPrivateKey(private_key)\r\nlet options = {salt, iv, kdf: 'scrypt', cipher: 'aes-128-cbc'}\r\nether_wallet.toV3(\"testpassword\", options)\r\n```\r\nwhich will generate a wallet like the following:\r\n```\r\n{ version: 3,\r\n  id: '2a6ccdc7-18cf-477e-86b7-f40b4b4b91e7',\r\n  address: '89e07f904e53d9604261698e87c69146b9acb79c',\r\n  crypto:\r\n   { ciphertext:\r\n      '052643cd39cd9e2e0f045ebcfec424d33a9fa6135f363d94a95cb09abc4d086a1c7eecc132c966e2a6691c6640605615',\r\n     cipherparams: { iv: '6087dab2f9fdbbfaddc31a909735c1e6' },\r\n     cipher: 'aes-128-cbc',\r\n     kdf: 'scrypt',\r\n     kdfparams:\r\n      { dklen: 32,\r\n        salt:\r\n         'ae3cd4e7013836a3df6bd7241b12db061dbe2c6785853cce422d148a624ce0bd',\r\n        n: 262144,\r\n        r: 8,\r\n        p: 1 },\r\n     mac:\r\n      '44c8b015c8702b9a315644725ca2c780605d62f56583ec43c140c14860ef807a' } }\r\n```\r\nyou can then load this json using something like:\r\n```\r\nlet other_wallet = wallet.fromV3(ether_wallet_json, \"testpassword\")\r\n```\r\nwhich will successfully decrypt the key and generate a wallet.  \r\n\r\nAttempting to load this keystore in the Desktop Mycrypto app however will give an invalid password error.  \r\n\r\n### Description of Your Machine\r\n\r\nUbuntu 18.04 LTS\r\n",
  "closed_by": {
    "login": "blurpesec",
    "id": 29407814,
    "node_id": "MDQ6VXNlcjI5NDA3ODE0",
    "avatar_url": "https://avatars.githubusercontent.com/u/29407814?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/blurpesec",
    "html_url": "https://github.com/blurpesec",
    "followers_url": "https://api.github.com/users/blurpesec/followers",
    "following_url": "https://api.github.com/users/blurpesec/following{/other_user}",
    "gists_url": "https://api.github.com/users/blurpesec/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/blurpesec/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/blurpesec/subscriptions",
    "organizations_url": "https://api.github.com/users/blurpesec/orgs",
    "repos_url": "https://api.github.com/users/blurpesec/repos",
    "events_url": "https://api.github.com/users/blurpesec/events{/privacy}",
    "received_events_url": "https://api.github.com/users/blurpesec/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/416288306",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/2131#issuecomment-416288306",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131",
    "id": 416288306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNjI4ODMwNg==",
    "user": {
      "login": "blurpesec",
      "id": 29407814,
      "node_id": "MDQ6VXNlcjI5NDA3ODE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/29407814?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blurpesec",
      "html_url": "https://github.com/blurpesec",
      "followers_url": "https://api.github.com/users/blurpesec/followers",
      "following_url": "https://api.github.com/users/blurpesec/following{/other_user}",
      "gists_url": "https://api.github.com/users/blurpesec/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blurpesec/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blurpesec/subscriptions",
      "organizations_url": "https://api.github.com/users/blurpesec/orgs",
      "repos_url": "https://api.github.com/users/blurpesec/repos",
      "events_url": "https://api.github.com/users/blurpesec/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blurpesec/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-27T16:41:16Z",
    "updated_at": "2018-08-27T16:52:06Z",
    "author_association": "COLLABORATOR",
    "body": "Hey @ChosunOne, is the exact error you're receiving \"Please enter a valid password\"? The reason why this isn't working is because its not a valid json file or password. I was able to get this working using the same method you used with one modification. \r\n\r\nThe output would look like this (note this is similar to the output when you generate a keystore using our desktop app):\r\n\r\n```\r\n{\r\n  \"version\": 3,\r\n  \"id\": \"eef962e9-0664-4670-92d5-84fd81c65b4e\",\r\n  \"address\": \"89e07f904e53d9604261698e87c69146b9acb79c\",\r\n  \"crypto\": {\r\n    \"ciphertext\": \"052643cd39cd9e2e0f045ebcfec424d33a9fa6135f363d94a95cb09abc4d086a1c7eecc132c966e2a6691c6640605615\",\r\n    \"cipherparams\": {\r\n      \"iv\": \"6087dab2f9fdbbfaddc31a909735c1e6\"\r\n    },\r\n    \"cipher\": \"aes-128-cbc\",\r\n    \"kdf\": \"scrypt\",\r\n    \"kdfparams\": {\r\n      \"dklen\": 32,\r\n      \"salt\": \"ae3cd4e7013836a3df6bd7241b12db061dbe2c6785853cce422d148a624ce0bd\",\r\n      \"n\": 262144,\r\n      \"r\": 8,\r\n      \"p\": 1\r\n    },\r\n    \"mac\": \"44c8b015c8702b9a315644725ca2c780605d62f56583ec43c140c14860ef807a\"\r\n  }\r\n}\r\n```\r\n\r\nThe edits I made are marked with double-asterisks: \r\n\r\n```\r\nvar wallet = require(\"ethereumjs-wallet\")\r\n**var fs = require('fs')**\r\nlet private_key = Buffer.from([0x75, 0xca, 0x59, 0x3e, 0xcb, 0x74, 0x06, 0x79, 0x19, 0x10, 0xff, 0x87, 0x0d, 0x0f, 0x8d, 0xd0,0x4d, 0x13, 0x00, 0xf2, 0xc0, 0xfd, 0x17, 0xaf,0xa6, 0xff, 0xbb, 0x60, 0x51, 0xbf, 0x4a, 0xc2])\r\nlet salt = Buffer.from([0xae, 0x3c, 0xd4, 0xe7, 0x01, 0x38, 0x36, 0xa3,0xdf, 0x6b, 0xd7, 0x24, 0x1b, 0x12, 0xdb, 0x06,0x1d, 0xbe, 0x2c, 0x67, 0x85, 0x85, 0x3c, 0xce,0x42, 0x2d, 0x14, 0x8a, 0x62, 0x4c, 0xe0, 0xbd])\r\nlet iv = Buffer.from([0x60, 0x87, 0xda, 0xb2, 0xf9, 0xfd, 0xbb, 0xfa,0xdd, 0xc3, 0x1a, 0x90, 0x97, 0x35, 0xc1, 0xe6])\r\nlet ether_wallet = wallet.fromPrivateKey(private_key)\r\nlet options = {salt, iv, kdf: 'scrypt', cipher: 'aes-128-cbc'}\r\n**fs.writeFileSync(\"wallet\",JSON.stringify(ether_wallet.toV3(\"testpassword\", options),null,2))**\r\n```\r\n\r\nJSON.stringify() should allow you to create a compatible wallet. I have tested this and verified that it works.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/416288306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/418259003",
    "html_url": "https://github.com/MyCryptoHQ/MyCrypto/issues/2131#issuecomment-418259003",
    "issue_url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/2131",
    "id": 418259003,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODI1OTAwMw==",
    "user": {
      "login": "ChosunOne",
      "id": 5751289,
      "node_id": "MDQ6VXNlcjU3NTEyODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5751289?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChosunOne",
      "html_url": "https://github.com/ChosunOne",
      "followers_url": "https://api.github.com/users/ChosunOne/followers",
      "following_url": "https://api.github.com/users/ChosunOne/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChosunOne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChosunOne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChosunOne/subscriptions",
      "organizations_url": "https://api.github.com/users/ChosunOne/orgs",
      "repos_url": "https://api.github.com/users/ChosunOne/repos",
      "events_url": "https://api.github.com/users/ChosunOne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChosunOne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T06:47:21Z",
    "updated_at": "2018-09-04T06:47:58Z",
    "author_association": "NONE",
    "body": "Ah I see.  Thanks for the response",
    "reactions": {
      "url": "https://api.github.com/repos/MyCryptoHQ/MyCrypto/issues/comments/418259003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
