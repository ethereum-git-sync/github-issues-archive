{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2908",
  "id": 956319604,
  "node_id": "MDU6SXNzdWU5NTYzMTk2MDQ=",
  "number": 2908,
  "title": "altair-devnet-2: Invalid signature SignedAggregateAndProof at the fork slot",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2159934357,
      "node_id": "MDU6TGFiZWwyMTU5OTM0MzU3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-testnet-debugging",
      "name": "scope-testnet-debugging",
      "color": "980043",
      "default": false,
      "description": "Issues uncovered through running a node on a public testnet."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-07-30T01:20:49Z",
  "updated_at": "2022-05-12T03:11:59Z",
  "closed_at": "2022-05-12T03:11:58Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nFrom Teku:\r\n\r\n\"At the same time I got the following invalid signed aggregate and proof (which I think comes from a lodestar validator):\"\r\n```\r\n0x64000000b80c5d8233733f9684fef1edee56603df7cf4700d13e9532c338fac1fcbe2886209c94490e09082430a94d0bdaf04ad11827be97358d114dece6b81c298ff427294d64d7efab8b19eaacb6a77916931770aaed3eeafa4d6b93573c271e4377e86e290000000000006c00000093a901006eaf8c2e5d8ea94939d631247984180c4faad3e3646ca112c467e419a2f7308fc5abc79ba99a07999362b1c30ec28bccbfd7bd0a60f58a2fab272edb0256309219eff2493e7ea52b7d73ce2dc0bbac27120d7997d9a6944e3a1e4255e40000004001000000000000020000000000000039998ed61f601fed3e21059e7f99dfc31a5ee8ecb34e22e2790f09095397997d0900000000000000b523c2bc822f304369018e505920e3f5451b0616fb2b6750eaeb5273f76f72050a0000000000000039998ed61f601fed3e21059e7f99dfc31a5ee8ecb34e22e2790f09095397997db945ebbf87891cd5c47df4c7110282948b129bb56fb73d570ce3c05cad7db58592f477669996d086e73d73ebf7c850c10828071f3b54a7e24a9868072197df6bd90c59fa0322b718d055044ed4d91cff5756f328430e70dca1d6824bb4df5f2730000122c07600a040604000420000700001\r\n```\r\n\r\nThis is decoded at:\r\n```yaml\r\nmessage:\r\n  aggregatorIndex: '10606'\r\n  aggregate:\r\n    aggregationBits: '0x30000122c07600a040604000420000700001'\r\n    data:\r\n      slot: '320'\r\n      index: '2'\r\n      beaconBlockRoot: '0x39998ed61f601fed3e21059e7f99dfc31a5ee8ecb34e22e2790f09095397997d'\r\n      source:\r\n        epoch: '9'\r\n        root: '0xb523c2bc822f304369018e505920e3f5451b0616fb2b6750eaeb5273f76f7205'\r\n      target:\r\n        epoch: '10'\r\n        root: '0x39998ed61f601fed3e21059e7f99dfc31a5ee8ecb34e22e2790f09095397997d'\r\n    signature: >-\r\n      0xb945ebbf87891cd5c47df4c7110282948b129bb56fb73d570ce3c05cad7db58592f477669996d086e73d73ebf7c850c10828071f3b54a7e24a9868072197df6bd90c59fa0322b718d055044ed4d91cff5756f328430e70dca1d6824bb4df5f27\r\n  selectionProof: >-\r\n    0x93a901006eaf8c2e5d8ea94939d631247984180c4faad3e3646ca112c467e419a2f7308fc5abc79ba99a07999362b1c30ec28bccbfd7bd0a60f58a2fab272edb0256309219eff2493e7ea52b7d73ce2dc0bbac27120d7997d9a6944e3a1e4255\r\nsignature: >-\r\n  0xb80c5d8233733f9684fef1edee56603df7cf4700d13e9532c338fac1fcbe2886209c94490e09082430a94d0bdaf04ad11827be97358d114dece6b81c298ff427294d64d7efab8b19eaacb6a77916931770aaed3eeafa4d6b93573c271e4377e8\r\n\r\n```\r\n\r\n**Expected behavior**\r\n\r\nLodestar should produce valid SignedAggregateAndProof at the fork slot\r\n",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/889593985",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2908#issuecomment-889593985",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908",
    "id": 889593985,
    "node_id": "IC_kwDOCD5_Gc41BiCB",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-30T03:06:54Z",
    "updated_at": "2021-07-30T03:06:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "I regen the state at slot 320 and verify that all signatures are correct (that's how it got through our gossip validation and published to other nodes).\r\nHowever, the `beaconBlockRoot` and targetStateRoot was for block 319, not 320. At that time, our node may not get block 320 (the fork block) at the right time.\r\nAll participations of the AggregateAndProof above are lodestar validators: `10606,10613,10642,10644,10724,10752,10803,10939,11067,11148,11214,11316,11504,11525,11574,11584,11588,11630,11774,11777,11785,11815,11891`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/889593985/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/889600159",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2908#issuecomment-889600159",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908",
    "id": 889600159,
    "node_id": "IC_kwDOCD5_Gc41Bjif",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-30T03:23:54Z",
    "updated_at": "2021-07-30T03:52:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Gossip block 320 came after 1/3 slot and did not have enough time to validate so we ignored all attestations:\r\n```\r\nJul-29 13:04:04.752 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=320, root=0x545a…5080\r\n...\r\nJul-29 13:04:04.974 [NETWORK]         ^[[34mdebug^[[39m: gossip - beacon_attestation - ignore code=ATTESTATION_ERROR_UNKNOWN_BEACON_BLOCK_ROOT, root=0x545a94134d4f24e5ef371e3c        7b23227f6b88967d76aebed9c01a9bd4002d5080\r\n...\r\nJul-29 13:04:05.081 [NETWORK]         ^[[34mdebug^[[39m: gossip - beacon_block - accept slot=320, root=0x545a94134d4f24e5ef371e3c7b23227f6b88967d76aebed9c01a9bd4002d5080\r\n```\r\n\r\nat 1/3 time of slot 320, all lodestar validators think block 319 as head so they voted the wrong SignedAggregateAndProof\r\n\r\nblock 319 and 322 were received right at the beginning of slot while block 320 is received right after 1/3 slot\r\n```\r\n 242234 Jul-29 13:03:48.001 [CHAIN]         ^[[36mverbose^[[39m: Clock slot slot=319\r\n242244 Jul-29 13:03:48.024 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=319, root=0x3999…997d\r\n242990 Jul-29 13:04:00.028 [CHAIN]         ^[[36mverbose^[[39m: Clock slot slot=320\r\n243018 Jul-29 13:04:04.752 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=320, root=0x545a…5080\r\n244402 Jul-29 13:04:12.001 [CHAIN]         ^[[36mverbose^[[39m: Clock slot slot=321\r\n[Block 321 is proposed by lodestar validator]\r\n245530 Jul-29 13:04:24.010 [CHAIN]         ^[[36mverbose^[[39m: Clock slot slot=322\r\n245540 Jul-29 13:04:24.133 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=322, root=0x4e57…0452\r\n```\r\n\r\nnot sure why block 320 came that late and other clients still can see and vote it while lodestar could not https://altair-devnet-2-explorer.ethdevops.io/block/320#votes. Maybe we have a performance issue of gossip?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/889600159/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/889722193",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2908#issuecomment-889722193",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908",
    "id": 889722193,
    "node_id": "IC_kwDOCD5_Gc41CBVR",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-30T08:14:49Z",
    "updated_at": "2021-07-30T08:14:49Z",
    "author_association": "MEMBER",
    "body": "> not sure why block 320 came that late and other clients still can see and vote it while lodestar could not https://altair-devnet-2-explorer.ethdevops.io/block/320#votes. Maybe we have a performance issue of gossip?\r\n\r\nMaybe! It might be good idea to add additional logs (under a flag) for when a gossip object is received. Many things could slow the block processing. Busy regen, busy bls workers, busy node in general, where promises take a long time to resolve.\r\n\r\nProbably it's time that we add a safe attestation cache back again https://github.com/ChainSafe/lodestar/issues/2788",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/889722193/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/893930201",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2908#issuecomment-893930201",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908",
    "id": 893930201,
    "node_id": "IC_kwDOCD5_Gc41SErZ",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-06T01:13:50Z",
    "updated_at": "2021-08-06T03:56:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "From Teku: `It was actually our validator that published block 320 and it was ontime - published at 2021-07-29T13:04:01,193 which is 1 second into the slot.` There are 2 issues\r\n\r\n+ seems like we have an issue at gossip since we can only receive the message 4s into the slot and the job wait time is not big per metric\r\n```\r\n242990 Jul-29 13:04:00.028 [CHAIN]         ^[[36mverbose^[[39m: Clock slot slot=320\r\n243018 Jul-29 13:04:04.752 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=320, root=0x545a…5080\r\n```\r\ncc @wemeetagain\r\n+ Teku found that it's an invalid signature but lodestar saw it's a valid one. Probably it's due to the incorrect domain somewhere at the altair fork slot by either lodestar or teku?! at least our validator 10606 did not miss attestation for slot 320 so signature for the attestation should be good and confirmed by other nodes https://altair-devnet-2-explorer.ethdevops.io/validator/10606#attestations",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/893930201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1124485053",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2908#issuecomment-1124485053",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2908",
    "id": 1124485053,
    "node_id": "IC_kwDOCD5_Gc5DBke9",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-12T03:11:58Z",
    "updated_at": "2022-05-12T03:11:58Z",
    "author_association": "MEMBER",
    "body": "Potentially related to https://github.com/ChainSafe/lodestar/issues/4002\r\n\r\nWe _could_ implement a test to go through a fork transition in that conditions to further analyze this if necessary. Closing for now",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1124485053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
