{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3389",
  "id": 1034654700,
  "node_id": "I_kwDOCD5_Gc49q5Ps",
  "number": 3389,
  "title": "Unable to publish SyncCommitteeContribution - SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-10-25T04:10:38Z",
  "updated_at": "2022-02-04T10:10:50Z",
  "closed_at": "2022-02-04T10:10:50Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nFound this error in lodestar-geth instance of pithos\r\n\r\n```\r\nOct-25 03:39:48.628 [API]             error: Req req-143nl publishContributionAndProofs error code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=76674, slot=76673\r\nError: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\n    at validateGossipSyncCommitteeExceptSig (/usr/app/node_modules/@chainsafe/lodestar/src/chain/validation/syncCommittee.ts:81:11)\r\n    at validateSyncCommitteeGossipContributionAndProof (/usr/app/node_modules/@chainsafe/lodestar/src/chain/validation/syncCommitteeContributionAndProof.ts:25:39)\r\n    at /usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:458:66\r\n    at Array.map (<anonymous>)\r\n    at Object.publishContributionAndProofs (/usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:455:31)\r\n    at Object.handler (/usr/app/node_modules/@chainsafe/lodestar-api/src/server/utils/server.ts:70:42)\r\n    at preHandlerCallback (/usr/app/node_modules/fastify/lib/handleRequest.js:124:28)\r\n    at preValidationCallback (/usr/app/node_modules/fastify/lib/handleRequest.js:107:5)\r\n    at handler (/usr/app/node_modules/fastify/lib/handleRequest.js:70:7)\r\n    at done (/usr/app/node_modules/fastify/lib/contentTypeParser.js:151:7)\r\n```\r\n\r\nit looks like the validator client is frequently late to submit ContributionAndProof\r\n\r\nat validator side\r\n\r\n```\r\nOct-25 03:46:50.227 []                error: Error publishing SyncCommitteeContribution slot=76708, index=0 message=Internal Server Error: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\nError: Internal Server Error: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\n    at HttpClient.request (/usr/app/node_modules/@chainsafe/lodestar-api/src/client/utils/httpClient.ts:91:15)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at HttpClient.json (/usr/app/node_modules/@chainsafe/lodestar-api/src/client/utils/httpClient.ts:58:12)\r\n    at Object.request [as publishContributionAndProofs] (/usr/app/node_modules/@chainsafe/lodestar-api/src/client/utils/client.ts:72:19)\r\n    at SyncCommitteeService.produceAndPublishAggregates (/usr/app/node_modules/@chainsafe/lodestar-validator/src/services/syncCommittee.ts:178:9)\r\n    at /usr/app/node_modules/@chainsafe/lodestar-validator/src/services/syncCommittee.ts:67:11\r\n    at async Promise.all (index 3)\r\n    at SyncCommitteeService.runSyncCommitteeTasks (/usr/app/node_modules/@chainsafe/lodestar-validator/src/services/syncCommittee.ts:62:7)\r\n    at Clock.runAtMostEvery (/usr/app/node_modules/@chainsafe/lodestar-validator/src/util/clock.ts:70:7)\r\n```\r\n\r\nthe consensus node\r\n\r\n```\r\nOct-25 03:46:49.476 [CHAIN]         verbose: Clock slot slot=76709\r\n```\r\n\r\n```\r\nOct-25 03:46:50.219 [API]             error: Error on publishContributionAndProofs [0] slot=76708, subCommitteeIndex=1 code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=76709, slot=76708\r\nError: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\nOct-25 03:46:50.221 [API]             error: Req req-14487 publishContributionAndProofs error code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=76709, slot=76708\r\nError: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\nOct-25 03:46:50.226 [API]             error: Req req-14488 publishContributionAndProofs error code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=76709, slot=76708\r\nError: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\nOct-25 03:46:50.224 [API]             error: Error on publishContributionAndProofs [0] slot=76708, subCommitteeIndex=0 code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=76709, slot=76708\r\nError: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT\r\nOct-25 03:47:00.341 [CHAIN]         verbose: Clock slot slot=76710\r\n```\r\n\r\n**Expected behavior**\r\n\r\nNo error\r\n\r\n",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950691673",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3389#issuecomment-950691673",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389",
    "id": 950691673,
    "node_id": "IC_kwDOCD5_Gc44qmdZ",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T09:02:34Z",
    "updated_at": "2021-10-25T09:02:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "there seems to be performance issue at node side that make it unable to accept requests\r\n\r\nvalidator logs\r\n\r\n```\r\nOct-25 03:46:44.752 []              ^[[36mverbose^[[39m: Producing SyncCommitteeContribution slot=76708, index=1\r\nOct-25 03:46:44.753 []              ^[[36mverbose^[[39m: Producing SyncCommitteeContribution slot=76708, index=0\r\n```\r\n\r\nbut node can only accepts request ~3s later\r\n\r\n```\r\nOct-25 03:46:47.334 [API]             ^[[34mdebug^[[39m: Req req-14481 127.0.0.1 GET:/eth/v1/validator/sync_committee_contribution\r\nOct-25 03:46:47.335 [API]             ^[[34mdebug^[[39m: Res req-14481 produceSyncCommitteeContribution - 200\r\nOct-25 03:46:47.335 [API]             ^[[34mdebug^[[39m: Req req-14482 127.0.0.1 GET:/eth/v1/validator/sync_committee_contribution\r\nOct-25 03:46:47.335 [API]             ^[[34mdebug^[[39m: Res req-14482 produceSyncCommitteeContribution - 200\r\n```\r\n\r\nthen validator was able to sign `SyncCommitteeContribution`\r\n```\r\nOct-25 03:46:47.346 []                ^[[34mdebug^[[39m: Signed SyncCommitteeContribution slot=76708, index=1, validatorIndex=17782\r\nOct-25 03:46:47.348 []                ^[[34mdebug^[[39m: Signed SyncCommitteeContribution slot=76708, index=0, validatorIndex=17520\r\n```\r\n\r\nmaybe due to the same reason, server can only see `publishContributionAndProofs` request 3s later\r\n```\r\nOct-25 03:46:50.211 [API]             ^[[34mdebug^[[39m: Req req-14483 127.0.0.1 POST:/eth/v1/validator/aggregate_and_proofs\r\nOct-25 03:46:50.219 [API]             ^[[31merror^[[39m: Error on publishContributionAndProofs [0] slot=76708, subCommitteeIndex=1 code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=76709, slot=76708\r\nError: SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLO\r\n```\r\n\r\nslot 76708 started at 3:46:36",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950691673/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/953790337",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3389#issuecomment-953790337",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389",
    "id": 953790337,
    "node_id": "IC_kwDOCD5_Gc442a-B",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-28T12:18:47Z",
    "updated_at": "2021-10-28T12:18:47Z",
    "author_association": "MEMBER",
    "body": "It seems to show that the node is very busy delaying processing",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/953790337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/954339981",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3389#issuecomment-954339981",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389",
    "id": 954339981,
    "node_id": "IC_kwDOCD5_Gc444hKN",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-29T01:32:40Z",
    "updated_at": "2021-10-29T01:32:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "> It seems to show that the node is very busy delaying processing\r\n\r\nroot cause may be #3390 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/954339981/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1029825361",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3389#issuecomment-1029825361",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389",
    "id": 1029825361,
    "node_id": "IC_kwDOCD5_Gc49YeNR",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-04T10:05:20Z",
    "updated_at": "2022-02-04T10:05:20Z",
    "author_association": "MEMBER",
    "body": "I've also observed that any HTTP API request takes > 2 sec to be replied which makes it very likely for the contribution to be late",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1029825361/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1029829677",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3389#issuecomment-1029829677",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3389",
    "id": 1029829677,
    "node_id": "IC_kwDOCD5_Gc49YfQt",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-04T10:10:50Z",
    "updated_at": "2022-02-04T10:10:50Z",
    "author_association": "MEMBER",
    "body": "Closing for root cause https://github.com/ChainSafe/lodestar/issues/3694",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1029829677/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
