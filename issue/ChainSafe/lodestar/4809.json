{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4809",
  "id": 1463071425,
  "node_id": "I_kwDOCD5_Gc5XNLLB",
  "number": 4809,
  "title": "Dashboard metrics using `scrape_location` label in expression are broken",
  "user": {
    "login": "nflaig",
    "id": 38436224,
    "node_id": "MDQ6VXNlcjM4NDM2MjI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nflaig",
    "html_url": "https://github.com/nflaig",
    "followers_url": "https://api.github.com/users/nflaig/followers",
    "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
    "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
    "organizations_url": "https://api.github.com/users/nflaig/orgs",
    "repos_url": "https://api.github.com/users/nflaig/repos",
    "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nflaig/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-24T09:54:51Z",
  "updated_at": "2023-01-12T17:01:22Z",
  "closed_at": "2023-01-12T17:01:22Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "**Problem**\r\n\r\nAt the moment all dashboard metrics which use the label `scrape_location` in the expression are broken because this label is not set anywhere. Currently the expected label values used in the dashboards are either `validator` or `beacon`.\r\n\r\n**Possible solutions**\r\n\r\nI see three options how this could be fixed\r\n\r\n1. set `scrape_location` as [default label](https://github.com/siimon/prom-client#default-labels-segmented-by-registry)\r\n2. use `job` name or `instance` to differentiate between beacon node and validator\r\n3. set it in `prometheus.yml` file\r\n```\r\n    static_configs:\r\n      - targets: [\"localhost:8008\"]\r\n        labels:\r\n          scrape_location: \"beacon\"\r\n```\r\n\r\nIn my opinion option 1. is the best solution because it does not rely on the deployment configuration.\r\n\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/203752419-b2727722-4010-40f1-bcee-887bce077c40.png)\r\n\r\n",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1326281800",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4809#issuecomment-1326281800",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809",
    "id": 1326281800,
    "node_id": "IC_kwDOCD5_Gc5PDXRI",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-24T10:53:04Z",
    "updated_at": "2022-11-24T10:53:04Z",
    "author_association": "MEMBER",
    "body": "I've been struggling in how to be able to commit the dashboards we use internally for general use while not forcing our architecture decisions on others. Besides `scrape_location` have you found any other issues? I've had issues in the past with the default prometheus source not being applied correctly.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1326281800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1326360413",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4809#issuecomment-1326360413",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4809",
    "id": 1326360413,
    "node_id": "IC_kwDOCD5_Gc5PDqdd",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-24T12:05:52Z",
    "updated_at": "2022-11-24T18:17:01Z",
    "author_association": "MEMBER",
    "body": "I am using [eth-docker](https://github.com/eth-educators/eth-docker) at the moment to run lodestar beacon node and validator. By default it only uses the `lodestar_summary` dashboard which is [fetched from the stable branch](https://github.com/eth-educators/eth-docker/blob/main/grafana/provision-dashboards.sh#L58). I was mainly looking at this dashboard at the moment but also imported all other [lodestar dashboards](https://github.com/ChainSafe/lodestar/tree/unstable/dashboards) manually which mostly seem to work. Trying to get more insights on my peer count issue.\r\n\r\n>  Besides scrape_location have you found any other issues?\r\n\r\n`lodestar_clock_slot` is used in the dashboad but there is no metric for it. The libp2p dashboard does not work at all for me, there are no metrics for `libp2p_` but not sure might have other reasons, maybe just not enabled.\r\n\r\n>  I've had issues in the past with the default prometheus source not being applied correctly.\r\n\r\nI am still a bit confused where `scrape_location` label should be set. I did not find any reference to it in the code and it is not a label prometheus would apply by default. As far as I know the only default labels are `instance` and `job`.\r\n\r\n> I've been struggling in how to be able to commit the dashboards we use internally for general use while not forcing our architecture decisions on others\r\n\r\nwould be interesting to know what are the main pain points here, also need to find out where and how the metrics and dashboards are currently used by others\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1326360413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
