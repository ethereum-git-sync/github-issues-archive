{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3572",
  "id": 1094055501,
  "node_id": "I_kwDOCD5_Gc5BNfZN",
  "number": 3572,
  "title": "[Kintsugi] Error on publishContributionAndProofs",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-01-05T07:22:13Z",
  "updated_at": "2022-01-17T06:45:44Z",
  "closed_at": "2022-01-17T06:45:44Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nThere are a lot of errors like below in lodestar<>geth node\r\n\r\n```\r\nJan-04 16:11:20.245 [API]             ^[[31merror^[[39m: Error on publishContributionAndProofs [0] slot=137731        , subCommitteeIndex=2 code=SYNC_COMMITTEE_ERROR_VALIDATOR_NOT_IN_SYNC_COMMITTEE, validatorIndex=56062\r\n2213092 Error: SYNC_COMMITTEE_ERROR_VALIDATOR_NOT_IN_SYNC_COMMITTEE\r\n2213093     at validateGossipSyncCommitteeExceptSig (/usr/app/node_modules/@chainsafe/lodestar/src/chain/validation/sy        ncCommittee.ts:100:11)\r\n2213094     at validateSyncCommitteeGossipContributionAndProof (/usr/app/node_modules/@chainsafe/lodestar/src/chain/va        lidation/syncCommitteeContributionAndProof.ts:25:39)\r\n2213095     at /usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:504:66\r\n2213096     at Array.map (<anonymous>)\r\n2213097     at Object.publishContributionAndProofs (/usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/i        ndex.ts:501:31)\r\n2213098     at Object.handler (/usr/app/node_modules/@chainsafe/lodestar-api/src/server/utils/server.ts:70:42)\r\n2213099     at preHandlerCallback (/usr/app/node_modules/fastify/lib/handleRequest.js:124:28)\r\n2213100     at preValidationCallback (/usr/app/node_modules/fastify/lib/handleRequest.js:107:5)\r\n2213101     at handler (/usr/app/node_modules/fastify/lib/handleRequest.js:70:7)\r\n2213102     at done (/usr/app/node_modules/fastify/lib/contentTypeParser.js:151:7)\r\n```\r\n\r\n**Expected behavior**\r\nNo error",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1005589805",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3572#issuecomment-1005589805",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572",
    "id": 1005589805,
    "node_id": "IC_kwDOCD5_Gc478BUt",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-05T11:05:33Z",
    "updated_at": "2022-01-05T11:05:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I took a look at slot 142749, we published 12 SyncCommitteeMessage:\r\n\r\n```\r\nJan-05 08:54:52.002 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56062\r\nJan-05 08:54:52.004 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56548\r\nJan-05 08:54:52.005 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56364\r\nJan-05 08:54:52.006 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56411\r\nJan-05 08:54:52.007 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56423\r\nJan-05 08:54:52.008 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56071\r\nJan-05 08:54:52.009 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56550\r\nJan-05 08:54:52.010 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56918\r\nJan-05 08:54:52.011 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56852\r\nJan-05 08:54:52.012 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56690\r\nJan-05 08:54:52.013 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56506\r\nJan-05 08:54:52.014 []                ^[[34mdebug^[[39m: Signed SyncCommitteeMessage slot=142749, validatorIndex=56333\r\nJan-05 08:54:52.265 []                 ^[[32minfo^[[39m: Published SyncCommitteeMessage slot=142749, count=12\r\n```\r\n\r\nas confirmed in https://beaconchain.kintsugi.themerge.dev/block/142749 , only the first 3 validators stay in sync committee, others are redundant, this log confirms that:\r\n\r\n```\r\nJan-05 08:49:00.026 []                ^[[34mdebug^[[39m: Downloaded SyncDuties epoch=4460, dependentRoot=0x0000000000000000000000000000000000000000000000000000000000000000, count=3\r\n```\r\n\r\nit looks like there's a reorg and we keep merging different sync committee duties per epochs in same period https://github.com/ChainSafe/lodestar/blob/659e3e105aa934b4b638071a9e252ea0a4444c7d/packages/validator/src/services/syncCommitteeDuties.ts#L214 and it made a lot of redundant/wrong duties\r\n\r\nwe need to handle sync committee duties reorg anyway",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1005589805/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1005722755",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3572#issuecomment-1005722755",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572",
    "id": 1005722755,
    "node_id": "IC_kwDOCD5_Gc478hyD",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-05T14:16:50Z",
    "updated_at": "2022-01-05T14:16:50Z",
    "author_association": "MEMBER",
    "body": "> it looks like there's a reorg and we keep merging different sync committee duties per epochs in same period \r\n\r\nMakes sense! Thanks for looking into this :pray: ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1005722755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1011796399",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3572#issuecomment-1011796399",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3572",
    "id": 1011796399,
    "node_id": "IC_kwDOCD5_Gc48Tsmv",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-13T04:56:47Z",
    "updated_at": "2022-01-13T04:56:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "+ dependentRoot is not part of api spec and other clients (at least lighthouse) did not implement it. I think it's not likely the long reorg could happen over 256 epochs, it's not the same situation to attestation duties\r\n+ for each epoch, we query duties for next sync period as well so maybe the reorg comes for these next period duties query. And when next period becomes current period, our duties could contain some redundant ones (since we keep merging to the period map).\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1011796399/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
