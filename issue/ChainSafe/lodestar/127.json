{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/127",
  "id": 420020395,
  "node_id": "MDU6SXNzdWU0MjAwMjAzOTU=",
  "number": 127,
  "title": "P2P Architecture for Lodestar",
  "user": {
    "login": "Mikerah",
    "id": 4249799,
    "node_id": "MDQ6VXNlcjQyNDk3OTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4249799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Mikerah",
    "html_url": "https://github.com/Mikerah",
    "followers_url": "https://api.github.com/users/Mikerah/followers",
    "following_url": "https://api.github.com/users/Mikerah/following{/other_user}",
    "gists_url": "https://api.github.com/users/Mikerah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Mikerah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Mikerah/subscriptions",
    "organizations_url": "https://api.github.com/users/Mikerah/orgs",
    "repos_url": "https://api.github.com/users/Mikerah/repos",
    "events_url": "https://api.github.com/users/Mikerah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Mikerah/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-03-12T14:33:56Z",
  "updated_at": "2019-06-20T00:30:02Z",
  "closed_at": "2019-06-20T00:30:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Before opening up a PR for this, I am laying out a proposed architecture for the P2P networking stuff for Lodestar.\r\n\r\n## Recommended Reading\r\n* [High level overview of networking in ETH2.0 by yours truly](https://medium.com/@mikerahqc/networking-in-serenity-eth2-0-8bbdb5bd6dd4)\r\n* [Gossipsub specification](https://github.com/libp2p/specs/tree/master/pubsub/gossipsub)\r\n* [Proposed ETH2.0 Phase 0 Wire Protocol by Matt Slipper](https://github.com/ethereum/eth2.0-specs/issues/692)\r\n* [Proposed Node services by @wemeetagain](https://github.com/ChainSafeSystems/lodestar/pull/123)\r\n\r\n## High Level Overview of expected behavior\r\nWhen a node runs the Lodestar client, the node should act as a host so that other peers in the network can connect to it. These connections can potentially be reused by taking advantage of `libp2p`'s various stream multiplexing libraries. Every node needs to generate its own private/public key pair in order to identify itself in the network. A node needs to be able to handle incoming data streams (AKA messages) in order to process the messages according to the beacon chain protocol. Once the required processing is done, nodes need to propagate messages to other nodes in the network and store any necessary info required for future processing.\r\n\r\n## P2P stack\r\nThe proposed P2P stack is based on the current ideas around networking in ETH2.0 and is subject to change. Currently, it consists of \r\n* Kademlia DHT for peer discovery using UDP\r\n* TCP messaging for all other peer-to-peer messaging\r\n* Bootstrapping for discovery (However, for local testnets, we will be using multicastDNS)\r\n* Gossipsub for message propagation\r\n\r\nThere are other aspects of the P2P stack that are still undecided:\r\n* Which encryption protocol to use (might need to use secio as [TLS 1.3 is currently being spec'd out in libp2p](https://github.com/libp2p/specs/pull/151) and doesn't have a js implementation)\r\n* Whether to use stream multiplexing (I think we should)\r\n\r\n## Structure\r\n`/p2p` - Will contain all of the p2p related code \r\n* `server.js` - Will contain the p2p service as described by @wemeetagain \r\n* `libp2pNode.js` - Will define our own `libp2p` bundle with the required components. Will also be able to create nodes.\r\n* `utils.js` - Will contain any utility that we need for handling peers,etc\r\n* `config.json` - Contains all the configuration for our `libp2p` bundle\r\n\r\nIt is expected that some p2p functionality will be used by other components and coded into other components directly.\r\n\r\n## Note about Typescript\r\nWe will be needing typescript bindings for p2p communication. We have yet to make a decision about how to go about this. There are several suggestions [here](https://github.com/ChainSafeSystems/gossipsub-js/issues/4).\r\n\r\nSince there are a lot of unsolved questions regarding networking in ETH2.0, this is all that I have unfortunately. I can definitely add more details to this issue as I get more feedback.\r\n\r\nAny actionable feedback is highly needed. What is unclear/underspecified? What have I left out? Also, it is expected that this issue overlaps with @wemeetagain's work with services. ",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/472093337",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/127#issuecomment-472093337",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127",
    "id": 472093337,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjA5MzMzNw==",
    "user": {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-12T17:09:22Z",
    "updated_at": "2019-03-12T17:09:22Z",
    "author_association": "MEMBER",
    "body": "Related to\r\n> It is expected that some p2p functionality will be used by other components and coded into other components directly.\r\n\r\nI would take a look at how prysm structures their [p2p](https://github.com/prysmaticlabs/prysm/blob/master/shared/p2p/service.go) service and their [sync](https://github.com/prysmaticlabs/prysm/blob/master/beacon-chain/sync/service.go) service for some inspiration on how the p2p service could interplay with the rest of the system.\r\n\r\nIn their conception, the p2p service handles managing the gossipsub and dht machinery: fully configuring them, starting and stopping them.\r\nIt then provides some sort of api to listen for certain incoming messages / subscribe to a topic, broadcast messages, or send messages to a specific peer.\r\n\r\nThe sync service, depending on the sync \"strategy\" (initial sync vs regular sync), uses the p2p service to subscribe/unsubscribe to various p2p topics/feeds/events, uses the chain service to subscribe to various local chain updates, and relays the necessary data from one to the other.\r\n\r\nI think we could follow a similar strategy.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/472093337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/474339333",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/127#issuecomment-474339333",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127",
    "id": 474339333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDMzOTMzMw==",
    "user": {
      "login": "Mikerah",
      "id": 4249799,
      "node_id": "MDQ6VXNlcjQyNDk3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4249799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mikerah",
      "html_url": "https://github.com/Mikerah",
      "followers_url": "https://api.github.com/users/Mikerah/followers",
      "following_url": "https://api.github.com/users/Mikerah/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mikerah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mikerah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mikerah/subscriptions",
      "organizations_url": "https://api.github.com/users/Mikerah/orgs",
      "repos_url": "https://api.github.com/users/Mikerah/repos",
      "events_url": "https://api.github.com/users/Mikerah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mikerah/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-19T12:21:42Z",
    "updated_at": "2019-03-19T12:21:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "After a call with the other eth2.0 teams around networking and the wire protocol, as an interim solution, we will be implementing the hobbits wire protocol and opening up a tcp socket at port `9000` in order to enable cross-client communication. WhiteBlock will be providing a set of peers to connect to. \r\n\r\nAnother thing that was brought up during the call was testing devp2p. Since all eth1.0 clients have an implementation of devp2p, we should be able to use it as an interim solution as well. The Nimbus team has tested using both a libp2p daemon and their nim implementation of devp2p. I think it might be worthwhile to test devp2p as well. \r\n\r\nWe will still be using libp2p but in order to get more realistic testing done, we need some simple networking stack. This is when a lot of bugs will come out and will make Lodestar a better client.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/474339333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/503758667",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/127#issuecomment-503758667",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127",
    "id": 503758667,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMzc1ODY2Nw==",
    "user": {
      "login": "GregTheGreek",
      "id": 16929357,
      "node_id": "MDQ6VXNlcjE2OTI5MzU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/16929357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GregTheGreek",
      "html_url": "https://github.com/GregTheGreek",
      "followers_url": "https://api.github.com/users/GregTheGreek/followers",
      "following_url": "https://api.github.com/users/GregTheGreek/following{/other_user}",
      "gists_url": "https://api.github.com/users/GregTheGreek/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GregTheGreek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GregTheGreek/subscriptions",
      "organizations_url": "https://api.github.com/users/GregTheGreek/orgs",
      "repos_url": "https://api.github.com/users/GregTheGreek/repos",
      "events_url": "https://api.github.com/users/GregTheGreek/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GregTheGreek/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-19T21:45:39Z",
    "updated_at": "2019-06-19T21:45:39Z",
    "author_association": "MEMBER",
    "body": "Is this relevant?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/503758667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/503794304",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/127#issuecomment-503794304",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/127",
    "id": 503794304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMzc5NDMwNA==",
    "user": {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-20T00:30:01Z",
    "updated_at": "2019-06-20T00:30:01Z",
    "author_association": "MEMBER",
    "body": "I think its resolved",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/503794304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
