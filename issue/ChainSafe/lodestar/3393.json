{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3393",
  "id": 1036134210,
  "node_id": "I_kwDOCD5_Gc49widC",
  "number": 3393,
  "title": "lodestar/node_modules/snappy: Command failed.",
  "user": {
    "login": "q9f",
    "id": 58883403,
    "node_id": "MDQ6VXNlcjU4ODgzNDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/q9f",
    "html_url": "https://github.com/q9f",
    "followers_url": "https://api.github.com/users/q9f/followers",
    "following_url": "https://api.github.com/users/q9f/following{/other_user}",
    "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
    "organizations_url": "https://api.github.com/users/q9f/orgs",
    "repos_url": "https://api.github.com/users/q9f/repos",
    "events_url": "https://api.github.com/users/q9f/events{/privacy}",
    "received_events_url": "https://api.github.com/users/q9f/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-10-26T10:47:01Z",
  "updated_at": "2021-10-26T12:31:48Z",
  "closed_at": "2021-10-26T12:31:48Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\n`lerna bootstrap` fails on latest master with:\r\n\r\n```shell\r\nerror /home/user/.opt/ChainSafe/lodestar/node_modules/snappy: Command failed.\r\n``` \r\n\r\n**Expected behavior**\r\n\r\nshould compile snappy and build lodestar.\r\n\r\n**Steps to Reproduce**\r\n\r\n1. `nvm use stable`\r\n2. `npm i -g npm yarn lerna`\r\n3. `lerna bootstrap`\r\n\r\n**Screenshots**\r\n\r\n```shell\r\n~/.opt/ChainSafe/lodestar master 14s\r\n❯ lerna bootstrap        \r\nDebugger attached.\r\ninfo cli using local version of lerna\r\nlerna notice cli v4.0.0\r\nlerna info bootstrap root only\r\nDebugger attached.\r\nyarn install v1.22.17\r\n[1/5] Validating package.json...\r\n[2/5] Resolving packages...\r\n[3/5] Fetching packages...\r\n[4/5] Linking dependencies...\r\nwarning \" > typedoc@0.19.2\" has incorrect peer dependency \"typescript@3.9.x || 4.0.x\".\r\nwarning \" > @chainsafe/lodestar-api@0.31.0\" has unmet peer dependency \"fastify@3.15.1\".\r\nwarning \"workspace-aggregator-88371491-b021-4ab1-8026-70fbc47beae1 > @chainsafe/lodestar > prometheus-gc-stats@0.6.3\" has incorrect peer dependency \"prom-client@>= 10 <= 12\".\r\nwarning \"workspace-aggregator-88371491-b021-4ab1-8026-70fbc47beae1 > @chainsafe/lodestar-cli > multiaddr > dns-over-http-resolver > native-fetch@3.0.0\" has unmet peer dependency \"node-fetch@*\".\r\n[5/5] Building fresh packages...\r\n[10/12] ⠄ snappy\r\n[11/12] ⠄ gc-stats\r\n[3/12] ⠄ bcrypto\r\n[-/12] ⠄ waiting...\r\nerror /home/user/.opt/ChainSafe/lodestar/node_modules/snappy: Command failed.\r\nExit code: 1\r\nCommand: prebuild-install || node-gyp rebuild\r\nArguments: \r\nDirectory: /home/user/.opt/ChainSafe/lodestar/node_modules/snappy\r\nOutput:\r\nDebugger attached.\r\nprebuild-install WARN install No prebuilt binaries found (target=16.10.0 runtime=node arch=x64 libc= platform=linux)\r\nWaiting for the debugger to disconnect...\r\nDebugger attached.\r\ngyp info it worked if it ends with ok\r\ngyp info using node-gyp@7.1.2\r\ngyp info using node@16.10.0 | linux | x64\r\ngyp info find Python using Python version 3.9.7 found at \"/usr/bin/python3\"\r\n(node:27145) [DEP0150] DeprecationWarning: Setting process.config is deprecated. In the future the property will be read-only.\r\n(Use `node --trace-deprecation ...` to show where the warning was created)\r\ngyp info spawn /usr/bin/python3\r\ngyp info spawn args [\r\ngyp info spawn args   '/home/user/.opt/ChainSafe/lodestar/node_modules/node-gyp/gyp/gyp_main.py',\r\ngyp info spawn args   'binding.gyp',\r\ngyp info spawn args   '-f',\r\ngyp info spawn args   'make',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/home/user/.opt/ChainSafe/lodestar/node_modules/snappy/build/config.gypi',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/home/user/.opt/ChainSafe/lodestar/node_modules/node-gyp/addon.gypi',\r\ngyp info spawn args   '-I',\r\ngyp info spawn args   '/home/user/.cache/node-gyp/16.10.0/include/node/common.gypi',\r\ngyp info spawn args   '-Dlibrary=shared_library',\r\ngyp info spawn args   '-Dvisibility=default',\r\ngyp info spawn args   '-Dnode_root_dir=/home/user/.cache/node-gyp/16.10.0',\r\ngyp info spawn args   '-Dnode_gyp_dir=/home/user/.opt/ChainSafe/lodestar/node_modules/node-gyp',\r\ngyp info spawn args   '-Dnode_lib_file=/home/user/.cache/node-gyp/16.10.0/<(target_arch)/node.lib',\r\ngyp info spawn args   '-Dmodule_root_dir=/home/user/.opt/ChainSafe/lodestar/node_modules/snappy',\r\ngyp info spawn args   '-Dnode_engine=v8',\r\ngyp info spawn args   '--depth=.',\r\ngyp info spawn args   '--no-parallel',\r\ngyp info spawn args   '--generator-output',\r\ngyp info spawn args   'build',\r\ngyp info spawn args   '-Goutput_dir=.'\r\ngyp info spawn args ]\r\nDebugger attached.\r\nWaiting for the debugger to disconnect...\r\ngyp: Call to 'node -e \"require('nan')\"' returned exit status 0 while in binding.gyp. while trying to load binding.gyp\r\ngyp ERR! configure error \r\ngyp ERR! stack Error: `gyp` failed with exit code: 1\r\ngyp ERR! stack     at ChildProcess.onCpExit (/home/user/.opt/ChainSafe/lodestar/node_modules/node-gyp/lib/configure.js:351:16)\r\ngyp ERR! stack     at ChildProcess.emit (node:events:390:28)\r\ngyp ERR! stack     at Process.ChildProcess._handle.onexit (node:internal/child_process:290:12)\r\ngyp ERR! System Linux 5.14.14-arch1-1\r\ngyp ERR! command \"/home/user/.nvm/versions/node/v16.10.0/bin/node\" \"/home/user/.opt/ChainSafe/lodestar/node_modules/.bin/node-gyp\" \"rebuild\"\r\ngyp ERR! cwd /home/user/.opt/ChainSafe/lodestar/node_modules/snappy\r\ngyp ERR! node -v v16.10.0\r\n\r\n\r\n\r\n\r\nProcess stalled\r\nActive handles:\r\n  - WriteStream\r\n  - WriteStream\r\n  - ReadStream\r\n  - Socket\r\n  - Socket\r\n  - ChildProcess\r\nWaiting for the debugger to disconnect...\r\nlerna ERR! yarn install --mutex network:42424 --non-interactive exited 1 in 'root'\r\nWaiting for the debugger to disconnect...\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n- OS: I use [![ArchLinux](https://img.shields.io/badge/Arch_Linux-1793D1?style=for-the-badge&logo=arch-linux&logoColor=white)](https://archlinux.org/) btw!\r\n- Version: `Linux ceres 5.14.14-arch1-1 #1 SMP PREEMPT Wed, 20 Oct 2021 21:35:18 +0000 x86_64 GNU/Linux`\r\n- Branch: `master`\r\n- Commit hash: 7d744776efdfd0239928f8adde2be023032b5ff2\r\n\r\n```\r\n~/.opt/ChainSafe/lodestar master\r\n❯ node --version\r\nv16.10.0\r\n\r\n~/.opt/ChainSafe/lodestar master\r\n❯ npm --version\r\nDebugger attached.\r\n8.1.1\r\nWaiting for the debugger to disconnect...\r\n\r\n~/.opt/ChainSafe/lodestar master\r\n❯ yarn --version\r\nDebugger attached.\r\n1.22.17\r\nWaiting for the debugger to disconnect...\r\n\r\n~/.opt/ChainSafe/lodestar master\r\n❯ lerna --version\r\nDebugger attached.\r\n4.0.0\r\nWaiting for the debugger to disconnect...\r\n```",
  "closed_by": {
    "login": "q9f",
    "id": 58883403,
    "node_id": "MDQ6VXNlcjU4ODgzNDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/q9f",
    "html_url": "https://github.com/q9f",
    "followers_url": "https://api.github.com/users/q9f/followers",
    "following_url": "https://api.github.com/users/q9f/following{/other_user}",
    "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
    "organizations_url": "https://api.github.com/users/q9f/orgs",
    "repos_url": "https://api.github.com/users/q9f/repos",
    "events_url": "https://api.github.com/users/q9f/events{/privacy}",
    "received_events_url": "https://api.github.com/users/q9f/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/951835455",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3393#issuecomment-951835455",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393",
    "id": 951835455,
    "node_id": "IC_kwDOCD5_Gc44u9s_",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-26T11:19:05Z",
    "updated_at": "2021-10-26T11:19:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't have any issues with `lerna bootstrap` and latest master `7d74477`, my environment:\r\n\r\n```\r\nTuyens-MacBook-Pro-16519:lodestar tuyennguyen$ node --version\r\nv16.4.2\r\nTuyens-MacBook-Pro-16519:lodestar tuyennguyen$ npm --version\r\n7.18.1\r\nTuyens-MacBook-Pro-16519:lodestar tuyennguyen$ yarn --version\r\n1.22.10\r\nTuyens-MacBook-Pro-16519:lodestar tuyennguyen$ lerna --version\r\n4.0.0\r\n```\r\n\r\nalso normally I do `yarn & yarn build`, @q9f could you try this?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/951835455/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/951892189",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3393#issuecomment-951892189",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3393",
    "id": 951892189,
    "node_id": "IC_kwDOCD5_Gc44vLjd",
    "user": {
      "login": "q9f",
      "id": 58883403,
      "node_id": "MDQ6VXNlcjU4ODgzNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/q9f",
      "html_url": "https://github.com/q9f",
      "followers_url": "https://api.github.com/users/q9f/followers",
      "following_url": "https://api.github.com/users/q9f/following{/other_user}",
      "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
      "organizations_url": "https://api.github.com/users/q9f/orgs",
      "repos_url": "https://api.github.com/users/q9f/repos",
      "events_url": "https://api.github.com/users/q9f/events{/privacy}",
      "received_events_url": "https://api.github.com/users/q9f/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-26T12:31:48Z",
    "updated_at": "2021-10-26T12:31:48Z",
    "author_association": "MEMBER",
    "body": "Heisenbug, it works in a regular terminal now. I was using the VSCode debugger environment and this failed. It's all good now. Sorry.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/951892189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
