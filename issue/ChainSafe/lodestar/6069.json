{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/6069",
  "id": 1964547347,
  "node_id": "I_kwDOCD5_Gc51GJ0T",
  "number": 6069,
  "title": "\"PublishError.InsufficientPeers\" error on submitPoolBlsToExecutionChange",
  "user": {
    "login": "marioevz",
    "id": 11726710,
    "node_id": "MDQ6VXNlcjExNzI2NzEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marioevz",
    "html_url": "https://github.com/marioevz",
    "followers_url": "https://api.github.com/users/marioevz/followers",
    "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
    "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
    "organizations_url": "https://api.github.com/users/marioevz/orgs",
    "repos_url": "https://api.github.com/users/marioevz/repos",
    "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marioevz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5670219610,
      "node_id": "LA_kwDOCD5_Gc8AAAABUfivWg",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-bug",
      "name": "meta-bug",
      "color": "E79553",
      "default": false,
      "description": "Issues that identify a bug and require a fix."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-10-27T00:06:37Z",
  "updated_at": "2023-10-27T22:46:18Z",
  "closed_at": "2023-10-27T22:46:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nOn a hive testnet with Deneb genesis, sending a valid `/eth/v1/beacon/pool/bls_to_execution_changes` POST request to the Beacon API results in error:\r\n```\r\nOct-26 22:02:04.910[api]             \u001B[31merror\u001B[39m: Error on submitPoolBlsToExecutionChange [0] validatorIndex=0 - PublishError.InsufficientPeers\r\nError: PublishError.InsufficientPeers\r\n    at Eth2Gossipsub.publish (file:///usr/app/node_modules/@chainsafe/libp2p-gossipsub/dist/src/index.js:1547:19)\r\n    at async NetworkCore.publishGossip (file:///usr/app/packages/beacon-node/lib/network/core/networkCore.js:290:32)\r\n```\r\n\r\nEven when there is a second lodestar node connected and blocks and attestations are being gossiped correctly.\r\n\r\nThe error occurs in regardless of the epoch in which the request is sent to the beacon node.\r\n\r\nA similar test where the Deneb fork happens at epoch 1, and then the BLSToExecutionChanges are sent, does **not** exhibit the same issue, and the changes are broadcasted successfully.\r\n\r\nThe main difference in the lodestar logs between the two tests is that the successful test is subscribed to topics:\r\n```\r\nSubscribe to gossipsub topic topic=/eth2/<CAPELLA DIGEST>/bls_to_execution_change/ssz_snappy\r\nSubscribe to gossipsub topic topic=/eth2/<DENEB DIGEST>/bls_to_execution_change/ssz_snappy\r\n```\r\nwhereas the failing test is only subscribed to topic:\r\n```\r\nSubscribe to gossipsub topic topic=/eth2/<DENEB DIGEST>/bls_to_execution_change/ssz_snappy\r\n```\r\n\r\nAnd later in the logs of the successful test we can see that the message is indeed gossiped to topic `/eth2/<CAPELLA DIGEST>/bls_to_execution_change/ssz_snappy`, which leads me to believe that in fact none of the lodestar peers are listening to the topic where they both broadcast to.\n\n### Expected behavior\n\n`bls_to_execution_changes` should work.\n\n### Steps to reproduce\n\nUsing hive branch https://github.com/marioevz/hive/tree/eth2-dencun, run the following command:\r\n```bash\r\ngo build -v .\r\ncl=lodestar; ./hive --client-file ./configs/cancun.yaml --client go-ethereum,${cl}-bn,${cl}-vc --sim eth2/dencun --sim.limit \"eth2-deneb-sync/test-sync-from-deneb\"\r\n```\n\n### Additional context\n\n_No response_\n\n### Operating system\n\nLinux\n\n### Lodestar version or commit hash\n\nBranch deneb-builder",
  "closed_by": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1782341388",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/6069#issuecomment-1782341388",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6069",
    "id": 1782341388,
    "node_id": "IC_kwDOCD5_Gc5qPF8M",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T05:57:14Z",
    "updated_at": "2023-10-27T05:57:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks @marioevz for the snopsis, yea if the topic isn't subscribed this could lead to the failure ... will debug",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1782341388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
