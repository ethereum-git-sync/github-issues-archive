{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3853",
  "id": 1167199908,
  "node_id": "I_kwDOCD5_Gc5Fkg6k",
  "number": 3853,
  "title": "Investigate: ETH1_ERROR_NON_CONSECUTIVE_LOGS ",
  "user": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2159934357,
      "node_id": "MDU6TGFiZWwyMTU5OTM0MzU3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-testnet-debugging",
      "name": "scope-testnet-debugging",
      "color": "980043",
      "default": false,
      "description": "Issues uncovered through running a node on a public testnet."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-03-12T06:39:50Z",
  "updated_at": "2022-10-31T07:08:01Z",
  "closed_at": "2022-10-31T07:08:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Running on kiln testnet pre-merge, lodestar sometimes ends up with `ETH1_ERROR_NON_CONSECUTIVE_LOGS` which resolves itself on a restart of lodestar (without restarting ethereumjs). This got resolved each time via a restart.\r\n\r\nInvestigate/discuss and brainstorm and fix if any issue. The current hypothesis is PoW chain reorged which caused the deposit history to alter as the follow distance is just 16. restarting lodestar resets its tracker and everything gets back on track.\r\n\r\n\r\n\r\n```\r\nError: ETH1_ERROR_NON_CONSECUTIVE_LOGS\r\n    at Eth1DepositsCache.add (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositsCache.ts:93:15)\r\n    at Eth1DepositDataTracker.updateDepositCache (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositDataTracker.ts:178:5)\r\n    at Eth1DepositDataTracker.update (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositDataTracker.ts:159:33)\r\n    at Eth1DepositDataTracker.runAutoUpdate (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositDataTracker.ts:133:29)\r\n^CMar-12 06:31:10.104[]                 info: Stopping gracefully, use Ctrl+C again to force process exit\r\nMar-12 06:31:10.491[ETH1]            error: Error updating eth1 chain cache  code=ETH1_ERROR_NON_CONSECUTIVE_LOGS, newIndex=1333, lastLogIndex=1329\r\nError: ETH1_ERROR_NON_CONSECUTIVE_LOGS\r\n    at Eth1DepositsCache.add (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositsCache.ts:93:15)\r\n    at Eth1DepositDataTracker.updateDepositCache (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositDataTracker.ts:178:5)\r\n    at Eth1DepositDataTracker.update (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositDataTracker.ts:159:33)\r\n    at Eth1DepositDataTracker.runAutoUpdate (/usr/app/lodestar/packages/lodestar/src/eth1/eth1DepositDataTracker.ts:133:29)\r\n/usr/app/lodestar # /usr/app/lodestar/kintsugi/devnets/./runLodestarK8s.sh /usr/app/lodestar/kiln/devnets/kiln.vars /data/kiln-data\r\n./lodestar beacon --rootDir /data/kiln-data/lodestar --paramsFile /data/kiln-data/kiln/config.yaml --genesisStateFile /data/kiln-data/kiln/genesis.ssz --network.discv5.enabled true --eth1.enabled true --eth1.providerUrls http://127.0.0.1:8545 --execution.urls http://127.0.0.1:8551 --api.rest.enabled --api.rest.host 0.0.0.0 --eth1.depositContractDeployBlock 0x0000000000000000000000000000000000000000000000000000000000000000 --network.discv5.bootEnrs enr:-Iq4QMCTfIMXnow27baRUb35Q8iiFHSIDBJh6hQM5Axohhf4b6Kr_cOCu0htQ5WvVqKvFgY28893DHAg8gnBAXsAVqmGAX53x8JggmlkgnY0gmlwhLKAlv6Jc2VjcDI1NmsxoQK6S-Cii_KmfFdUJL2TANL3ksaKUnNXvTCv1tLwXs0QgIN1ZHCCIyk --network.connectToDiscv5Bootnodes --jwt-secret /data/kiln-data/jwtsecret\r\nMar-12 06:31:15.930[]                 info: Lodestar version=v0.26.0/master/+576/e30eca0b (git), network=mainnet\r\nMar-12 06:31:15.943[]                 info: Connected to LevelDB database name=/data/kiln-data/lodestar/peerstore\r\nMar-12 06:31:15.957[DB]               info: Connected to LevelDB database name=/data/kiln-data/lodestar/chain-db\r\nMar-12 06:31:19.170[]                 info: Initializing beacon state from anchor state slot=4224, epoch=132, stateRoot=0x29844cfef7e3b7b206a44f342966c49ad3386d43398b72295dafe707cb8b7e4f\r\nMar-12 06:31:19.476[ETH1]             info: Starting search for terminal POW block TERMINAL_TOTAL_DIFFICULTY=20000000000000\r\nMar-12 06:31:23.605[API]              info: Started REST api server address=http://0.0.0.0:9596, namespaces=beacon,config,events,node,validator\r\nMar-12 06:31:23.880[NETWORK]          info: PeerId 16Uiu2HAmJVZ1zB7kHtRJ7oe7pFVVDLxx2A4WKmvrRKbwCLMaCw7c, Multiaddrs /ip4/127.0.0.1/tcp/9000,/ip4/10.244.0.163/tcp/9000\r\nMar-12 06:31:23.880[]                 warn: Low peer count peers=0\r\nMar-12 06:31:23.881[]                 info: Searching peers - peers: 0 - slot: 4931 (skipped 707) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130\r\nMar-12 06:31:30.001[]                 info: Searching peers - peers: 0 - slot: 4932 (skipped 708) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130\r\nMar-12 06:31:42.003[]                 info: Searching peers - peers: 0 - slot: 4933 (skipped 709) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130\r\nMar-12 06:31:54.000[]                 info: Searching peers - peers: 0 - slot: 4934 (skipped 710) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130\r\nMar-12 06:32:06.001[]                 info: Searching peers - peers: 0 - slot: 4935 (skipped 711) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130\r\nMar-12 06:32:18.001[]                 info: Searching peers - peers: 0 - slot: 4936 (skipped 712) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130\r\nMar-12 06:32:30.024[]                 info: Syncing - ? left - 0.00 slots/s - slot: 4937 (skipped 713) - head: 4224 0xc1f9…9e43 - finalized: 0xfb59…aa64:130 - peers: 1\r\nMar-12 06:32:42.014[]                 info: Syncing - 4.9 minutes left - 1.67 slots/s - slot: 4938 (skipped 488) - head: 4450 0xb12b…2017 - finalized: 0x7be1…c72f:137 - peers: 1\r\nMar-12 06:32:54.010[]                 info: Syncing - 1.4 minutes left - 3.48 slots/s - slot: 4939 (skipped 288) - head: 4651 0x9bf7…5328 - finalized: 0x730b…eda4:143 - peers: 1\r\nMar-12 06:33:06.589[]                 info: Syncing - 29 seconds left - 4.87 slots/s - slot: 4940 (skipped 142) - head: 4798 0x97a6…12e3 - finalized: 0xffed…118c:148 - peers: 1\r\nMar-12 06:33:18.000[]                 info: Synced - slot: 4941 (skipped 23) - head: 4918 0x18bc…6ace - finalized: 0xe687…81e2:151 - peers: 1\r\nMar-12 06:33:19.491[NETWORK]          info: Subscribed gossip core topics\r\nMar-12 06:33:19.494[SYNC]             info: Subscribed gossip core topics\r\nMar-12 06:33:30.001[]                 info: Synced - slot: 4942 (skipped 1) - head: 4941 0xb86c…040a - finalized: 0x5b01…cd9d:152 - peers: 2\r\nMar-12 06:33:42.001[]                 info: Synced - slot: 4943 (skipped 2) - head: 4941 0xb86c…040a - finalized: 0x5b01…cd9d:152 - peers: 2\r\n\r\n```",
  "closed_by": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1122312310",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3853#issuecomment-1122312310",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853",
    "id": 1122312310,
    "node_id": "IC_kwDOCD5_Gc5C5SB2",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-10T12:15:28Z",
    "updated_at": "2022-05-10T12:15:54Z",
    "author_association": "MEMBER",
    "body": "Related https://github.com/ChainSafe/lodestar/issues/3845 the issue was triggered when switching EL nodes",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1122312310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1296676528",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3853#issuecomment-1296676528",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3853",
    "id": 1296676528,
    "node_id": "IC_kwDOCD5_Gc5NSbaw",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-31T07:08:01Z",
    "updated_at": "2022-10-31T07:08:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing as no more observed, #3845 might further address this ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1296676528/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
