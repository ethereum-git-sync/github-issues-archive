{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5851",
  "id": 1837932118,
  "node_id": "I_kwDOCD5_Gc5tjJ5W",
  "number": 5851,
  "title": "Memory Leak on node versions below 18.17.0",
  "user": {
    "login": "matthewkeil",
    "id": 18608739,
    "node_id": "MDQ6VXNlcjE4NjA4NzM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matthewkeil",
    "html_url": "https://github.com/matthewkeil",
    "followers_url": "https://api.github.com/users/matthewkeil/followers",
    "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
    "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
    "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
    "repos_url": "https://api.github.com/users/matthewkeil/repos",
    "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5670219610,
      "node_id": "LA_kwDOCD5_Gc8AAAABUfivWg",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-bug",
      "name": "meta-bug",
      "color": "E79553",
      "default": false,
      "description": "Issues that identify a bug and require a fix."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2023-08-05T20:41:27Z",
  "updated_at": "2023-08-12T17:05:23Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "_**NOTE**: There is a memory leak on Lodestar version 1.10 with node versions below **18.17.0**._\r\n\r\n_Make sure to update node to a version >=18.17.0 or >=20.1.0. We recommend to install the latest release of node 20._\r\n\r\n---\r\n\r\n### Describe the bug\r\n\r\nMemory is growing unbounded on a number of groups.\r\n\r\n### Affected Groups\r\n`beta` on version `v1.10.0/mkeil/network-worker-new-space/d0f01f3` (recently rebased onto unstable, no leak prior)\r\n`feat1` on version `v1.10.0/mkeil/network-worker-new-space/d0f01f3` (recently rebased onto unstable, no leak prior) \r\n`feat2` on version `v1.9.2/tuyen/gossipsub_protons/893eff7`\r\n`feat3` on version `v1.10.0/bbadfed`\r\n\r\n### Affected in `nogroup`\r\n`nogroup-ctvoss-2` on version `v1.10.0/tuyen/v1.10.0_rc.1_no_ee/83f6ba7`\r\n\r\n### Unaffected in `nogroup`\r\n`nogroup-ctvoss-0` on version `v1.8.0/stable/a4b29cf`\r\n`nogroup-ctvoss-1` on version `v1.8.0/tuyen/PR_5559_5592/b2a3949`\r\n`nogroup-ctvoss-3` on version `v1.8.0/tuyen/PR_5574_5592/2101f95`\r\n`nogroup-ctvoss-4` on version `v1.8.0/a4b29cf`\r\n`nogroup-hzax41-0` on version `v1.8.0/tuyen/network_thread_profile/f245849`\r\n\r\n### Unaffected Groups\r\n`unstable` on version `v1.10.0/a7466f5`\r\n`stable` on version `v1.10.0/7546292`\r\n`stress_test` on `v1.8.0/8464c6b`\r\n`goerli` on `v1.10.0/7546292`\r\n`lido-goerli` on `v1.10.0/7546292`\r\n`sepolia` on `v1.10.0/7546292`\r\n\r\n\r\n\r\n![Screenshot 2023-08-05 at 2 28 17 PM](https://github.com/ChainSafe/lodestar/assets/18608739/6ac4cfb6-9b66-47bd-afa5-1d8bb1ad978b)\r\n\r\n![Screenshot 2023-08-05 at 2 28 28 PM](https://github.com/ChainSafe/lodestar/assets/18608739/d6553e84-5c3c-41d3-895f-0f6ea05dcc7b)\r\n\r\n![Screenshot 2023-08-05 at 2 28 55 PM](https://github.com/ChainSafe/lodestar/assets/18608739/87671806-72f6-4eb8-a9d4-94c9094ef760)\r\n\r\n![Screenshot 2023-08-05 at 2 29 08 PM](https://github.com/ChainSafe/lodestar/assets/18608739/21ebe4de-0aaf-49f2-b8bc-29ac8b41a082)\r\n\r\n![Screenshot 2023-08-05 at 2 29 19 PM](https://github.com/ChainSafe/lodestar/assets/18608739/44477676-8f6a-4bb7-92b6-1a1d3ab00c31)\r\n\r\n### Expected behavior\r\n\r\nMemory should remain stable\r\n\r\n### Steps to reproduce\r\n\r\n_No response_\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Operating system\r\n\r\nLinux\r\n\r\n### Lodestar version or commit hash\r\n\r\nsomewhere post 1.9.2 or maybe 1.10.0",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1666971973",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1666971973",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1666971973,
    "node_id": "IC_kwDOCD5_Gc5jW_lF",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-06T21:29:39Z",
    "updated_at": "2023-08-06T21:30:57Z",
    "author_association": "MEMBER",
    "body": "rebased `beta` and `feat1` branches onto `stable` and will see if memory leak re-emerges to try and narrow down the commit where it originates.\r\n\r\nCurrent `stable` seems good so figured that was a good start for where to look after",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1666971973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1667317954",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1667317954",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1667317954,
    "node_id": "IC_kwDOCD5_Gc5jYUDC",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-07T07:16:26Z",
    "updated_at": "2023-08-08T02:55:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "`v1.9.2/tuyen/gossipsub_protons/893eff7` => ~~this branch has its own memory issue~~ https://github.com/ChainSafe/js-libp2p-gossipsub/issues/318#issuecomment-1666407160\r\n\r\nUpdate: protons may not be the root cause, could be the common issue of lodestar",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1667317954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1667451271",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1667451271",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1667451271,
    "node_id": "IC_kwDOCD5_Gc5jY0mH",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-07T08:46:11Z",
    "updated_at": "2023-08-07T08:46:11Z",
    "author_association": "MEMBER",
    "body": "> rebased `beta` and `feat1` branches onto `stable` and will see if memory leak re-emerges to try and narrow down the commit where it originates.\r\n> \r\n> Current `stable` seems good so figured that was a good start for where to look after\r\n\r\nTurns out the leak was also on `stable`.  Currently the `stable` and `unstable` groups are deployed using docker and do not show the leak.  I deployed `stable` to `feat2` and `unstable` to `feat3` using bare metal and will see if the leak shows up.  Will let run overnight and if it proves to be there (first hour of run looks like it is) I will use `beta`, `feat1`, `feat1` and `feat3`  and any other instance we have and will deploy a different sha to each in a methodical manner to see if i can find which commit it shows up in first to narrow down the code that is causing it.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1667451271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668108121",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1668108121",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1668108121,
    "node_id": "IC_kwDOCD5_Gc5jbU9Z",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-07T15:38:20Z",
    "updated_at": "2023-08-07T15:39:19Z",
    "author_association": "MEMBER",
    "body": "Leak is present on `stable` and `unstable` branches when running on bare metal but not when running in a container.  Confirmed code is running the same version just on a different platform.\r\n\r\n`stable` is version `7546292ef150c37a9a912b349d51f8ea59f686fb`\r\n`unstable` is version `bbadfed24a5dceeb6a21b5bba08c2965dabb630d`",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668108121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668833278",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1668833278",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1668833278,
    "node_id": "IC_kwDOCD5_Gc5jeF_-",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-08T02:57:39Z",
    "updated_at": "2023-08-08T02:57:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "All bare metal deployments go with NodeJS v18.16.1, docker deployments go with NodeJS 20, that's what we should use from Lodestar v1.10.0. I deployed `feat3` with NodeJS v20.5.0 to confirm.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668833278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673736546",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1673736546",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1673736546,
    "node_id": "IC_kwDOCD5_Gc5jwzFi",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T18:49:19Z",
    "updated_at": "2023-08-10T18:49:19Z",
    "author_association": "MEMBER",
    "body": "Deployed several commits from over the last couple weeks to `beta` and `feat2`.  `beta` was on node 18 and `feat2` on node 20.  No leaks were present on v20 but the instance running code after native fetch implementation on node 18 was leaking.  No other commits between the version leaking and version not leaking were suspect so narrowed it down to commit https://github.com/ChainSafe/lodestar/commit/3e65be7b895d845cce4fb9712b83e356c01f3fc6 . Looking through the node issues this one nodejs/node#46435 seemed a possibility and wanted to test for it.\r\n\r\nAs a note we are passing AbortSignal into fetch in beacon-node but not in validator but leak was present in both.\r\n\r\nBuilt a branch [`mkeil/revert-native-fetch`](https://github.com/ChainSafe/lodestar/tree/mkeil/revert-native-fetch) that came off of HEAD at yesterday and reverted the commit with native fetch swap.   Deployed to `beta` group on node 18 and leak is gone.\r\n\r\n![Screenshot 2023-08-10 at 12 48 28 PM](https://github.com/ChainSafe/lodestar/assets/18608739/4e8bf80f-71c9-4df6-9a24-a200005a82e0)\r\n\r\n![Screenshot 2023-08-10 at 12 48 40 PM](https://github.com/ChainSafe/lodestar/assets/18608739/284bd00e-fb89-4fee-af1a-1926dc087d1f)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673736546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673763032",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1673763032",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1673763032,
    "node_id": "IC_kwDOCD5_Gc5jw5jY",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T19:09:01Z",
    "updated_at": "2023-08-10T19:09:01Z",
    "author_association": "MEMBER",
    "body": "The leak was fixed in nodejs/undici#2049 and released in 5.21.1\r\nhttps://github.com/nodejs/undici/releases/tag/v5.21.1\r\n\r\nThat fix was applied to node 20.1.0\r\nhttps://github.com/nodejs/node/releases/tag/v20.1.0\r\n\r\n[[ba9ec91f0e](https://github.com/nodejs/node/commit/ba9ec91f0e)] - deps: update undici to 5.21.1 (Node.js GitHub Bot) https://github.com/nodejs/node/pull/47488\r\n\r\nI do not see that version of undici backported to node 18 which confirms the behavior we saw empirically.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673763032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673800961",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1673800961",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1673800961,
    "node_id": "IC_kwDOCD5_Gc5jxC0B",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T19:36:09Z",
    "updated_at": "2023-08-10T19:36:09Z",
    "author_association": "MEMBER",
    "body": "Thanks @matthewkeil for the thorough testing. I am also pretty confident this is related to native fetch on older node versions after reviewing all the PRs we did in 1.10 and going through the nodejs issues.  I also never saw this on my end on any server since I pretty early updated to node 20.\r\n\r\n> I do not see that version of undici backported to node 18 which confirms the behavior we saw empirically.\r\n\r\nThe fix has been backported to [v18.17.0](https://github.com/nodejs/node/releases/tag/v18.17.0) as well\r\n\r\n- [[6c8456d61f](https://github.com/nodejs/node/commit/6c8456d61f)] - deps: update undici to 5.21.1 (Node.js GitHub Bot) https://github.com/nodejs/node/pull/47488",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673800961/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673807280",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1673807280",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1673807280,
    "node_id": "IC_kwDOCD5_Gc5jxEWw",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T19:40:59Z",
    "updated_at": "2023-08-10T19:59:34Z",
    "author_association": "MEMBER",
    "body": "> The fix has been backported to [v18.17.0](https://github.com/nodejs/node/releases/tag/v18.17.0) as well\r\n> \r\n> * [[6c8456d61f](https://github.com/nodejs/node/commit/6c8456d61f)] - deps: update undici to 5.21.1 (Node.js GitHub Bot) [deps: update undici to 5.21.1 nodejs/node#47488](https://github.com/nodejs/node/pull/47488)\r\n\r\nNice catch @nflaig! I was looking at the synopsis on the releases page and didnt notice the tilde! 🤦‍♂️ \r\n\r\nOn the upside still does confirm because we were running 18.16.1. So i think we are safe with 18.17.0.  I will deploy that to beta with unstable to double check and we can make a docs note.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673807280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673809846",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1673809846",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1673809846,
    "node_id": "IC_kwDOCD5_Gc5jxE-2",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T19:43:19Z",
    "updated_at": "2023-08-10T19:43:19Z",
    "author_association": "MEMBER",
    "body": "> So i think we are safe with 18.17.0. I will deploy that to beta with unstable to double check and we can make a docs note.\r\n\r\nSounds good, maybe we just bump the version in package.json for next release\r\nhttps://github.com/ChainSafe/lodestar/blob/34d89556e4be5477d2743ec0ea8ffa720c93dfc9/package.json#L4-L6",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673809846/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673810648",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1673810648",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1673810648,
    "node_id": "IC_kwDOCD5_Gc5jxFLY",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T19:43:53Z",
    "updated_at": "2023-08-10T19:43:53Z",
    "author_association": "MEMBER",
    "body": "> > So i think we are safe with 18.17.0. I will deploy that to beta with unstable to double check and we can make a docs note.\r\n> \r\n> Sounds good, maybe we just bump the version in package.json for next release\r\n> \r\n> https://github.com/ChainSafe/lodestar/blob/34d89556e4be5477d2743ec0ea8ffa720c93dfc9/package.json#L4-L6\r\n\r\nEven better.  Test is deploying now! 🚀 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673810648/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 2,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1675989472",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5851#issuecomment-1675989472",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5851",
    "id": 1675989472,
    "node_id": "IC_kwDOCD5_Gc5j5ZHg",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-12T16:23:17Z",
    "updated_at": "2023-08-12T16:23:17Z",
    "author_association": "MEMBER",
    "body": "Re-opening for better visibility, would suggest we keep this open for a few more weeks",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1675989472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
