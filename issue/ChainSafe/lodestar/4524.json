{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4524",
  "id": 1366910608,
  "node_id": "I_kwDOCD5_Gc5ReWaQ",
  "number": 4524,
  "title": "When using --checkpointsync if the flag isn't at the head (see image) the sync download fails",
  "user": {
    "login": "philknows",
    "id": 58080811,
    "node_id": "MDQ6VXNlcjU4MDgwODEx",
    "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/philknows",
    "html_url": "https://github.com/philknows",
    "followers_url": "https://api.github.com/users/philknows/followers",
    "following_url": "https://api.github.com/users/philknows/following{/other_user}",
    "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
    "organizations_url": "https://api.github.com/users/philknows/orgs",
    "repos_url": "https://api.github.com/users/philknows/repos",
    "events_url": "https://api.github.com/users/philknows/events{/privacy}",
    "received_events_url": "https://api.github.com/users/philknows/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    },
    {
      "id": 4116885308,
      "node_id": "LA_kwDOCD5_Gc71Yq88",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-ux",
      "name": "scope-ux",
      "color": "980043",
      "default": false,
      "description": "Issues for CLI UX or general consumer UX."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/22",
    "html_url": "https://github.com/ChainSafe/lodestar/milestone/22",
    "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/22/labels",
    "id": 8630978,
    "node_id": "MI_kwDOCD5_Gc4Ag7LC",
    "number": 22,
    "title": "v1.4.0",
    "description": "",
    "creator": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 1,
    "closed_issues": 5,
    "state": "closed",
    "created_at": "2022-11-08T15:04:59Z",
    "updated_at": "2023-03-29T03:03:40Z",
    "due_on": null,
    "closed_at": "2023-02-12T16:38:23Z"
  },
  "comments": 14,
  "created_at": "2022-09-08T19:49:52Z",
  "updated_at": "2023-03-29T03:03:40Z",
  "closed_at": "2023-03-29T03:03:39Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nLodestar is unable to fetch a weak subjectivity state if the checkpoint fetched is not at the head. It returns:\r\n\r\n```\r\nSep 08 07:10:37 ETH-STAKER-001 lodestar[2124]: Sep-08 07:10:37.676[]                 info: Fetching weak subjectivity state weakSubjectivityServerUrl=https://goerli.beaconstate.info\r\nSep 08 07:10:38 ETH-STAKER-001 lodestar[2124]:  ✖ Error: Unable to fetch weak subjectivity state: Internal Server Error: block not found\r\nSep 08 07:10:38 ETH-STAKER-001 lodestar[2124]:     at fetchWeakSubjectivityState (file:///usr/local/bin/lodestar/packages/cli/src/networks/index.ts:157:11)\r\nSep 08 07:10:38 ETH-STAKER-001 lodestar[2124]:     at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\nSep 08 07:10:38 ETH-STAKER-001 lodestar[2124]:     at fetchWSStateFromBeaconApi (file:///usr/local/bin/lodestar/packages/cli/src/cmds/beacon/initBeaconState.ts:169:35)\r\nSep 08 07:10:38 ETH-STAKER-001 lodestar[2124]:     at initBeaconState (file:///usr/local/bin/lodestar/packages/cli/src/cmds/beacon/initBeaconState.ts:100:12)\r\nSep 08 07:10:38 ETH-STAKER-001 lodestar[2124]:     at Object.beaconHandler [as handler] (file:///usr/local/bin/lodestar/packages/cli/src/cmds/beacon/handler.ts:59:41)\r\nSep 08 07:10:38 ETH-STAKER-001 systemd[1]: lodestarbeacon.service: Main process exited, code=exited, status=1/FAILURE\r\nSep 08 07:10:38 ETH-STAKER-001 systemd[1]: lodestarbeacon.service: Failed with result 'exit-code'.\r\n```\r\n\r\n**Expected behavior**\r\n\r\nLodestar should be able to take any recent checkpoint for checkpointsync from a sync URL.\r\n\r\n**Screenshots**\r\n\r\nFlag is not at head. Fetch fails.\r\n\r\n![checkpoint](https://user-images.githubusercontent.com/58080811/189212928-764a07a1-afb9-479a-90d0-461063ee0ab1.png)\r\n",
  "closed_by": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1242801918",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1242801918",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1242801918,
    "node_id": "IC_kwDOCD5_Gc5KE6b-",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-10T20:42:30Z",
    "updated_at": "2022-09-10T20:42:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "This error seemed to be have thrown the URL from where its being synced, its *should* not be a problem with lodestar but worth checking out",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1242801918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1242819640",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1242819640",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1242819640,
    "node_id": "IC_kwDOCD5_Gc5KE-w4",
    "user": {
      "login": "SomerEsat",
      "id": 60827187,
      "node_id": "MDQ6VXNlcjYwODI3MTg3",
      "avatar_url": "https://avatars.githubusercontent.com/u/60827187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SomerEsat",
      "html_url": "https://github.com/SomerEsat",
      "followers_url": "https://api.github.com/users/SomerEsat/followers",
      "following_url": "https://api.github.com/users/SomerEsat/following{/other_user}",
      "gists_url": "https://api.github.com/users/SomerEsat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SomerEsat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SomerEsat/subscriptions",
      "organizations_url": "https://api.github.com/users/SomerEsat/orgs",
      "repos_url": "https://api.github.com/users/SomerEsat/repos",
      "events_url": "https://api.github.com/users/SomerEsat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SomerEsat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-10T23:29:54Z",
    "updated_at": "2022-09-10T23:29:54Z",
    "author_association": "NONE",
    "body": "Agreed. It seems like more of an issue with the checkpointsync provider. However - should the Lodestar client be more resilient to that sort of condition? E.g. As Phil suggests above, rather than error out, it could look back for the previous N blocks and then error out if not found.\r\n\r\nOne other thing to consider is that some clients will ignore the checkpointsync setting if the beacon chain DB exists. In Lodestar's case, it seems to do the download each time the client is restarted. One option could be to ignore the sync if the DB exists. Another could be to check the local DB current head against network current head, and if far back, execute the sync. But that may be too complicated/error prone.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1242819640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1243469740",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1243469740",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1243469740,
    "node_id": "IC_kwDOCD5_Gc5KHdes",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T09:33:51Z",
    "updated_at": "2022-09-12T09:33:51Z",
    "author_association": "MEMBER",
    "body": "This is a good point. Lodestar current logic is if `existing_db_last_state.slot < checkpoint_sync_state.slot`, then use the checkpoint sync state. We should change that to `existing_db_last_state.slot < checkpoint_sync_state.slot - offset` where offset is configurable parameter that default to the weak subjectivity period",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1243469740/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1373745044",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1373745044",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1373745044,
    "node_id": "IC_kwDOCD5_Gc5R4a-U",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-06T15:04:00Z",
    "updated_at": "2023-01-06T15:06:24Z",
    "author_association": "NONE",
    "body": "This issue would be worth resurrecting. Just tried it with `goerli.beaconstate.info` and am running into this.\r\n\r\n```\r\neth-docker-devel-consensus-1  | Checkpoint sync enabled\r\neth-docker-devel-consensus-1  | Jan-06 15:02:04.142[]                 info: Lodestar network=goerli, version=v1.3.0/031e42c, commit=031e42cbe8015109e2af6e9cdec1b15dd66fc937\r\neth-docker-devel-consensus-1  | Jan-06 15:02:04.161[]                 info: Connected to LevelDB database path=/var/lib/lodestar/consensus/chain-db\r\neth-docker-devel-consensus-1  | Jan-06 15:02:04.166[]                 info: Fetching checkpoint state checkpointSyncUrl=https://goerli.beaconstate.info\r\neth-docker-devel-consensus-1  |  ✖ Error: Unable to fetch weak subjectivity state: Internal Server Error: block not found\r\neth-docker-devel-consensus-1  |     at fetchWeakSubjectivityState (file:///usr/app/packages/cli/src/networks/index.ts:157:11)\r\neth-docker-devel-consensus-1  |     at processTicksAndRejections (node:internal/process/task_queues:95:5)\r\neth-docker-devel-consensus-1  |     at fetchWSStateFromBeaconApi (file:///usr/app/packages/cli/src/cmds/beacon/initBeaconState.ts:194:35)\r\neth-docker-devel-consensus-1  |     at initBeaconState (file:///usr/app/packages/cli/src/cmds/beacon/initBeaconState.ts:125:12)\r\neth-docker-devel-consensus-1  |     at Object.beaconHandler [as handler] (file:///usr/app/packages/cli/src/cmds/beacon/handler.ts:62:41)\r\n```\r\n\r\nIt will eventually succeed. This may be a corner case when the provider is moving to a fresh checkpoint.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1373745044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1396621087",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1396621087",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1396621087,
    "node_id": "IC_kwDOCD5_Gc5TPr8f",
    "user": {
      "login": "hiromaily",
      "id": 301692,
      "node_id": "MDQ6VXNlcjMwMTY5Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/301692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hiromaily",
      "html_url": "https://github.com/hiromaily",
      "followers_url": "https://api.github.com/users/hiromaily/followers",
      "following_url": "https://api.github.com/users/hiromaily/following{/other_user}",
      "gists_url": "https://api.github.com/users/hiromaily/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hiromaily/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hiromaily/subscriptions",
      "organizations_url": "https://api.github.com/users/hiromaily/orgs",
      "repos_url": "https://api.github.com/users/hiromaily/repos",
      "events_url": "https://api.github.com/users/hiromaily/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hiromaily/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-19T08:41:21Z",
    "updated_at": "2023-01-19T08:41:21Z",
    "author_association": "NONE",
    "body": "What is the current status? I'm facing this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1396621087/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403134127",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1403134127",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1403134127,
    "node_id": "IC_kwDOCD5_Gc5ToiCv",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T06:01:01Z",
    "updated_at": "2023-01-25T06:01:01Z",
    "author_association": "MEMBER",
    "body": "We're seeing a lot of missing states in the Goerli checkpoints @samcm and I'm unsure why this is happening. It's not just our checkpoint but also a continuous issue on other checkpoint providers as well. This issue may be related to it, but the checkpoint providers should also not be missing states, including the one EF Devops is hosting. Any ideas? \r\n\r\n![Screenshot 2023-01-24 at 10 54 56 PM](https://user-images.githubusercontent.com/58080811/214491739-3310175f-fbf3-4473-9aa7-2ba7b4b0a4a7.png)\r\n\r\nAlso please give EF Devops some time to respond since they're likely busy with the Interop this week.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403134127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403248846",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1403248846",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1403248846,
    "node_id": "IC_kwDOCD5_Gc5To-DO",
    "user": {
      "login": "samcm",
      "id": 8144395,
      "node_id": "MDQ6VXNlcjgxNDQzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8144395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samcm",
      "html_url": "https://github.com/samcm",
      "followers_url": "https://api.github.com/users/samcm/followers",
      "following_url": "https://api.github.com/users/samcm/following{/other_user}",
      "gists_url": "https://api.github.com/users/samcm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samcm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samcm/subscriptions",
      "organizations_url": "https://api.github.com/users/samcm/orgs",
      "repos_url": "https://api.github.com/users/samcm/repos",
      "events_url": "https://api.github.com/users/samcm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samcm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T08:24:47Z",
    "updated_at": "2023-01-25T08:24:47Z",
    "author_association": "NONE",
    "body": "👋  I'm fairly certain that missing states/blocks in Checkpointz is due to the slot on the epoch boundary not containing a block (i.e. it directly relates to network participation). That is to say: the table in the WebUI is showing a list of epoch boundaries (every 32 slots), _not_ a list of finalized states 👍 \r\n\r\nSince we only deal in epoch boundary slots, Checkpointz doesn't try and fetch finalized states/blocks that aren't on an epoch boundary (some clients dislike being served a finalized state that isn't on an epoch boundary) 🙏\r\n\r\nHope that helps 😄 \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403248846/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403763741",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1403763741",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1403763741,
    "node_id": "IC_kwDOCD5_Gc5Tq7wd",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T15:06:56Z",
    "updated_at": "2023-01-25T15:06:56Z",
    "author_association": "MEMBER",
    "body": "Thanks for the clarification @samcm. Looking to see if we can squeeze this into v1.4.0 or address it in a hotfix as it looks to be fairly annoying on the chance that people encounter this and have to wait an entire epoch or more to hopefully resolve it.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403763741/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1425313328",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1425313328",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1425313328,
    "node_id": "IC_kwDOCD5_Gc5U9I4w",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-10T07:32:49Z",
    "updated_at": "2023-02-10T07:32:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "> This is a good point. Lodestar current logic is if `existing_db_last_state.slot < checkpoint_sync_state.slot`, then use the checkpoint sync state. We should change that to `existing_db_last_state.slot < checkpoint_sync_state.slot - offset` where offset is configurable parameter that default to the weak subjectivity period\r\n\r\nummm this seems to be already in place: we have\r\n```typescript\r\nif (lastDbState) {\r\n    const config = createIBeaconConfig(chainForkConfig, lastDbState.genesisValidatorsRoot);\r\n    const wssCheck = isWithinWeakSubjectivityPeriod(config, lastDbState, getCheckpointFromState(lastDbState));\r\n    // All cases when we want to directly use lastDbState as the anchor state:\r\n    //  - if no checkpoint sync args provided, or\r\n    //  - the lastDbState is within weak subjectivity period:\r\n    if ((!args.checkpointState && !args.checkpointSyncUrl) || wssCheck) {\r\n      const anchorState = await initStateFromAnchorState(config, db, logger, lastDbState, {\r\n        isWithinWeakSubjectivityPeriod: wssCheck,\r\n        isCheckpointState: false,\r\n      });\r\n      return {anchorState};\r\n    }\r\n  }\r\n```\r\nso if db state is witnin the weak subjectivity perod, we just use it and don't even go for checking the slot/epoch of provided checkpoint",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1425313328/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1425326442",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1425326442",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1425326442,
    "node_id": "IC_kwDOCD5_Gc5U9MFq",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-10T07:42:17Z",
    "updated_at": "2023-02-10T07:42:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "> wave I'm fairly certain that missing states/blocks in Checkpointz is due to the slot on the epoch boundary not containing a block (i.e. it directly relates to network participation). That is to say: the table in the WebUI is showing a list of epoch boundaries (every 32 slots), _not_ a list of finalized states +1\r\n> \r\n> Since we only deal in epoch boundary slots, Checkpointz doesn't try and fetch finalized states/blocks that aren't on an epoch boundary (some clients dislike being served a finalized state that isn't on an epoch boundary) pray\r\n> \r\n> Hope that helps smile\r\n\r\nAhh our current approach is get finalized checkpoint, and get block corresponding to epoch * SLOTS_PER_EPOCH but a missing first boundary block (which could be common in the goerli) can cause state fetch to fail.\r\n\r\nInstead we should use the blockroot to fetch the state instead of using slots, that should ideally resolve the issue, will try to take take up the fix",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1425326442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1426704823",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1426704823",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1426704823,
    "node_id": "IC_kwDOCD5_Gc5VCcm3",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-11T11:30:19Z",
    "updated_at": "2023-02-11T11:30:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Debugging into the issue and rethinking on it:\r\n\r\nI think we are doing the right thing, the state corresponding to block's (fetched using checkpoint root) stateroot might or might not have been cached by the clients and clients should ideally have state cached/stored against a recent finalized checkpoint even if the checkpoint's blockroot doesn't belong to a bounday slot.\r\n\r\nIf a client is giving `block not found` error on state fetch on the epoch slot (checkpoint epoch * slot_per_epoch) then it means that the client is trying to lookup for the block first and then find its corresponding state, which is not a correct implementation (i think)\r\n\r\nWe need to see which client responded to this and why and discuss with the client team if the state for such a checkpoint should be available over the api \r\n\r\ncc @dapplion @wemeetagain @philknows ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1426704823/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1426705155",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1426705155",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1426705155,
    "node_id": "IC_kwDOCD5_Gc5VCcsD",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-11T11:32:25Z",
    "updated_at": "2023-02-11T11:32:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "@philknows  also is this a problem which is coming from using a checkpoint published by checkpointz? I think not if they only publishes those checkpoints whos roots are known to perfectly lie on epoch boundary? :thinking: ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1426705155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1426827872",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1426827872",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1426827872,
    "node_id": "IC_kwDOCD5_Gc5VC6pg",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-11T17:09:15Z",
    "updated_at": "2023-02-11T17:09:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "As we jointly debugged @philknows \r\n\r\nthe issue is when lodestar is not explicitly provided checkpoint from checkpointz (which only displays perfectly epoch boundary block checkpoints),\r\nlodestar fetches `finalized` from the checkpoint url, and it could be (and is likely on goerli) a checkpoint whos root's block is not the `epoch boundary slot`\r\n\r\nIn such cases, some clients like seemingly `lighthouse` seems to fail serving the state on the `epoch slot`, primarliy because they might not have cached it, or might be using slot -> block -> state lookup path, and since no block actually was produced/or is part of canonical chain at that slot, they throw with: `block not found`\r\n\r\nIts unlikely to happen with explicit checkpoints picked from checkpointz as @samcm mentioned that checkpointz servers `perfect` epoch boundary block root checkpoints.\r\n\r\nMay be this needs to be taken with appropriate client teams, since lodestar beacon node seems to be able to cache and serve such states",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1426827872/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1481045359",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4524#issuecomment-1481045359",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4524",
    "id": 1481045359,
    "node_id": "IC_kwDOCD5_Gc5YRvVv",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-23T11:46:56Z",
    "updated_at": "2023-03-23T18:42:21Z",
    "author_association": "MEMBER",
    "body": "also facing this issue using `https://beaconstate-goerli.chainsafe.io` as checkpoint sync endpoint\r\n\r\n```\r\nMar-23 11:43:56.214[]                 info: Lodestar network=goerli, version=v1.5.1/2115aa7, commit=2115aa7b688908472f82d3ee5d341cf314d5aff7\r\nMar-23 11:43:56.225[]                 info: Connected to LevelDB database path=/var/lib/data/chain-db\r\nMar-23 11:43:56.227[]                 info: Fetching checkpoint state checkpointSyncUrl=https://beaconstate-goerli.chainsafe.io\r\n ✖ Error: Unable to fetch weak subjectivity state: Internal Server Error: block not found\r\n    at fetchWeakSubjectivityState (file:///usr/app/packages/cli/src/networks/index.ts:174:11)\r\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at fetchWSStateFromBeaconApi (file:///usr/app/packages/cli/src/cmds/beacon/initBeaconState.ts:194:35)\r\n    at initBeaconState (file:///usr/app/packages/cli/src/cmds/beacon/initBeaconState.ts:125:12)\r\n    at Object.beaconHandler [as handler] (file:///usr/app/packages/cli/src/cmds/beacon/handler.ts:76:41)\r\n\r\n````",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1481045359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
