{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5392",
  "id": 1677429902,
  "node_id": "I_kwDOCD5_Gc5j-4yO",
  "number": 5392,
  "title": "Cannot import big slashing protection",
  "user": {
    "login": "caevv",
    "id": 1685482,
    "node_id": "MDQ6VXNlcjE2ODU0ODI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1685482?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/caevv",
    "html_url": "https://github.com/caevv",
    "followers_url": "https://api.github.com/users/caevv/followers",
    "following_url": "https://api.github.com/users/caevv/following{/other_user}",
    "gists_url": "https://api.github.com/users/caevv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/caevv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/caevv/subscriptions",
    "organizations_url": "https://api.github.com/users/caevv/orgs",
    "repos_url": "https://api.github.com/users/caevv/repos",
    "events_url": "https://api.github.com/users/caevv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/caevv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4116885308,
      "node_id": "LA_kwDOCD5_Gc71Yq88",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-ux",
      "name": "scope-ux",
      "color": "980043",
      "default": false,
      "description": "Issues for CLI UX or general consumer UX."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nflaig",
    "id": 38436224,
    "node_id": "MDQ6VXNlcjM4NDM2MjI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nflaig",
    "html_url": "https://github.com/nflaig",
    "followers_url": "https://api.github.com/users/nflaig/followers",
    "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
    "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
    "organizations_url": "https://api.github.com/users/nflaig/orgs",
    "repos_url": "https://api.github.com/users/nflaig/repos",
    "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nflaig/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-04-20T21:05:05Z",
  "updated_at": "2023-05-05T10:40:40Z",
  "closed_at": "2023-05-05T10:30:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "`Internal server error. Error: Maximum call stack size exceeded`\r\n\r\nRunning with `--keymanager.bodyLimit 11125829120`\r\n\r\n`28M` file",
  "closed_by": {
    "login": "nflaig",
    "id": 38436224,
    "node_id": "MDQ6VXNlcjM4NDM2MjI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nflaig",
    "html_url": "https://github.com/nflaig",
    "followers_url": "https://api.github.com/users/nflaig/followers",
    "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
    "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
    "organizations_url": "https://api.github.com/users/nflaig/orgs",
    "repos_url": "https://api.github.com/users/nflaig/repos",
    "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nflaig/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1517853297",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5392#issuecomment-1517853297",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392",
    "id": 1517853297,
    "node_id": "IC_kwDOCD5_Gc5aeJpx",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-21T13:41:13Z",
    "updated_at": "2023-04-21T13:41:13Z",
    "author_association": "MEMBER",
    "body": "Thanks for reporting @caevv, I will look into this",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1517853297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1528768355",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5392#issuecomment-1528768355",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392",
    "id": 1528768355,
    "node_id": "IC_kwDOCD5_Gc5bHydj",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-29T11:37:17Z",
    "updated_at": "2023-04-29T15:30:26Z",
    "author_association": "MEMBER",
    "body": "@caevv I am not able to reproduce the issue, even with a bigger slashing protection file it seems to work fine for me. Would it be possible for you to provide some logs of your validator client? The error log should contain the stack trace which would be really helpful to further analyse this issue.\r\n\r\nYou can observe the logs by running `./ethd logs -f validator` or you could just search for the specific log by running `./ethd logs validator | grep \"Maximum call stack size exceeded\" -A10 -B10`.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1528768355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1533655621",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5392#issuecomment-1533655621",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392",
    "id": 1533655621,
    "node_id": "IC_kwDOCD5_Gc5babpF",
    "user": {
      "login": "caevv",
      "id": 1685482,
      "node_id": "MDQ6VXNlcjE2ODU0ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1685482?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caevv",
      "html_url": "https://github.com/caevv",
      "followers_url": "https://api.github.com/users/caevv/followers",
      "following_url": "https://api.github.com/users/caevv/following{/other_user}",
      "gists_url": "https://api.github.com/users/caevv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caevv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caevv/subscriptions",
      "organizations_url": "https://api.github.com/users/caevv/orgs",
      "repos_url": "https://api.github.com/users/caevv/repos",
      "events_url": "https://api.github.com/users/caevv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caevv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-03T20:00:06Z",
    "updated_at": "2023-05-03T20:01:08Z",
    "author_association": "NONE",
    "body": "Sorry for the delay, here it is:\r\n```\r\neth-docker-validator-1  | May-03 19:45:18.833[]                 info: Verified connected beacon node and validator have the same genesisValidatorRoot\r\neth-docker-validator-1  | May-03 19:45:18.835[]                 info: doppelganger protection enabled detectionEpochs=1\r\neth-docker-validator-1  | May-03 19:45:18.872[]                 info: Started REST API server address=http://0.0.0.0:7500\r\neth-docker-validator-1  | May-03 19:45:18.872[]                 warn: REST API server is exposed, ensure untrusted traffic cannot reach this API\r\neth-docker-validator-1  | May-03 19:45:18.872[]                 info: REST api server keymanager bearer access token located at:\r\neth-docker-validator-1  |\r\neth-docker-validator-1  | /var/lib/lodestar/validators/validator-db/api-token.txt\r\neth-docker-validator-1  |\r\neth-docker-validator-1  | May-03 19:57:53.054[]                error: Req req-1 importKeystores error  Maximum call stack size exceeded\r\neth-docker-validator-1  | RangeError: Maximum call stack size exceeded\r\neth-docker-validator-1  |     at minEpoch (file:///usr/app/packages/validator/src/slashingProtection/utils.ts:31:35)\r\neth-docker-validator-1  |     at SlashingProtectionAttestationService.importAttestations (file:///usr/app/packages/validator/src/slashingProtection/attestation/index.ts:148:28)\r\neth-docker-validator-1  |     at processTicksAndRejections (node:internal/process/task_queues:95:5)\r\neth-docker-validator-1  |     at SlashingProtection.importInterchange (file:///usr/app/packages/validator/src/slashingProtection/index.ts:64:7)\r\neth-docker-validator-1  |     at KeymanagerApi.importKeystores (file:///usr/app/packages/cli/src/cmds/validator/keymanager/impl.ts:123:7)\r\neth-docker-validator-1  |     at Object.handler (file:///usr/app/packages/api/src/utils/server/genericJsonServer.ts:44:23)\r\n```\r\n\r\n```\r\n❯ ls -la ~/eth-docker/.eth/validator_keys/\r\ntotal 28544\r\ndrwxr-xr-x 2 a a       75 May  3 19:44 .\r\ndrwxr-xr-x 4 a a       58 Apr 19 21:17 ..\r\n-rw-r--r-- 1 a a      786 May  3 19:44 keystore-0.json\r\n-rwxr-xr-- 1 a a 29223063 May  3 19:44 slashing_protection.json\r\n```\r\n\r\n```\r\n❯ cat .env\r\n...\r\nVC_EXTRAS='--keymanager.bodyLimit 11125829120'\r\n...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1533655621/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1534587808",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5392#issuecomment-1534587808",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392",
    "id": 1534587808,
    "node_id": "IC_kwDOCD5_Gc5bd_Og",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T11:16:52Z",
    "updated_at": "2023-05-04T11:16:52Z",
    "author_association": "MEMBER",
    "body": "Thanks @caevv for providing the logs, that helped a lot, a fix is on the way!",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1534587808/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1536063931",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5392#issuecomment-1536063931",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5392",
    "id": 1536063931,
    "node_id": "IC_kwDOCD5_Gc5bjnm7",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T10:40:39Z",
    "updated_at": "2023-05-05T10:40:39Z",
    "author_association": "MEMBER",
    "body": "@caevv The issue should be fixed in [chainsafe/lodestar:next](https://hub.docker.com/layers/chainsafe/lodestar/next/images/sha256-da0d453345105343bc44062ded1aca7b796c8f89f934dced624263be11022b3a?context=explore) release and will be included in v1.9.0 which will be released in ~2-3 weeks\r\n\r\nUsing eth-docker you can test if it works by updating [LS_DOCKER_TAG](https://github.com/eth-educators/eth-docker/blob/3e5fd829f4be623ce30cbd8cf4048a2d353b0509/default.env#L184) in your `.env` file\r\n\r\n```\r\nLS_DOCKER_TAG=next\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1536063931/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
