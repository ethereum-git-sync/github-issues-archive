{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/6064",
  "id": 1961310950,
  "node_id": "I_kwDOCD5_Gc505zrm",
  "number": 6064,
  "title": "Checkpoint sync default behaviour for testnets",
  "user": {
    "login": "atkinsonholly",
    "id": 32036223,
    "node_id": "MDQ6VXNlcjMyMDM2MjIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/32036223?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/atkinsonholly",
    "html_url": "https://github.com/atkinsonholly",
    "followers_url": "https://api.github.com/users/atkinsonholly/followers",
    "following_url": "https://api.github.com/users/atkinsonholly/following{/other_user}",
    "gists_url": "https://api.github.com/users/atkinsonholly/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/atkinsonholly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/atkinsonholly/subscriptions",
    "organizations_url": "https://api.github.com/users/atkinsonholly/orgs",
    "repos_url": "https://api.github.com/users/atkinsonholly/repos",
    "events_url": "https://api.github.com/users/atkinsonholly/events{/privacy}",
    "received_events_url": "https://api.github.com/users/atkinsonholly/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1478321239,
      "node_id": "MDU6TGFiZWwxNDc4MzIxMjM5",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-discussion",
      "name": "meta-discussion",
      "color": "a6bddb",
      "default": false,
      "description": "Indicates a topic that requires input from various developers."
    },
    {
      "id": 4754137758,
      "node_id": "LA_kwDOCD5_Gc8AAAABG15ing",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-feature-request",
      "name": "meta-feature-request",
      "color": "B5CF5F",
      "default": false,
      "description": "Issues to track feature requests."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-10-25T12:30:13Z",
  "updated_at": "2023-10-27T12:30:42Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Problem description\n\nThis issue is being created to follow up on the [comment](https://github.com/ChainSafe/lodestar/pull/6054#discussion_r1370119474) in #6054 (ephemery testnet config) relating to checkpoint sync behaviour. [Ephemery testnet spec](https://github.com/taxmeifyoucan/EIPs/blob/d298cdd8eaf47a21e7770e5c6efef870587c924d/EIPS/eip-6916.md) requires _automatic_ use of checkpoint sync URL, unless overridden by the user with an alternative endpoint. \r\n\r\nIn Lodestar, however, the checkpoint sync URL has to be provided together with the `--checkpointSyncUrl` flag. Using the checkpoint sync URL is therefore not current \"default\" behaviour for testnets. \r\n\r\nThe purpose of this issue is to open discussion on the preferred default behaviour for ephemery, and other testnets, to obtain the genesis state.\n\n### Solution description\n\nOptions are discussed below.\r\n\r\nIf changing default behaviour for testnets:\r\n- add new property for each network `checkpointSyncUrl` (string), but keep it undefined for mainnet\r\n- add flag `--disableCheckpointSync` (bool)\r\nNote: For mainnet, a user will still have to choose the checkpoint sync provider they want to use (or none at all).\r\n\r\nOtherwise:\r\n- retain the `--checkpointSyncUrl` flag as it is currently implemented, and ensure this is properly documented as ephemery recommended usage. \n\n### Additional context\n\n_No response_",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1782690676",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/6064#issuecomment-1782690676",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064",
    "id": 1782690676,
    "node_id": "IC_kwDOCD5_Gc5qQbN0",
    "user": {
      "login": "taxmeifyoucan",
      "id": 61149543,
      "node_id": "MDQ6VXNlcjYxMTQ5NTQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/61149543?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/taxmeifyoucan",
      "html_url": "https://github.com/taxmeifyoucan",
      "followers_url": "https://api.github.com/users/taxmeifyoucan/followers",
      "following_url": "https://api.github.com/users/taxmeifyoucan/following{/other_user}",
      "gists_url": "https://api.github.com/users/taxmeifyoucan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/taxmeifyoucan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/taxmeifyoucan/subscriptions",
      "organizations_url": "https://api.github.com/users/taxmeifyoucan/orgs",
      "repos_url": "https://api.github.com/users/taxmeifyoucan/repos",
      "events_url": "https://api.github.com/users/taxmeifyoucan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/taxmeifyoucan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T10:38:39Z",
    "updated_at": "2023-10-27T10:39:13Z",
    "author_association": "NONE",
    "body": "The idea is that some networks might benefit from default checkpoint sync of genesis instead of keeping it hardcoded in the client. Especially testnets merged from genesis which include bunch of validators, like Holešky, are more practical to download from a server or via checkpoint sync from genesis. Ephemery can utilize this feature to avoid generating the genesis by itself each time. \r\n\r\nI am not sure what is the current state, e.g. whether Lodestar keeps whole ssz for Holešky, but some clients take approach of simply downloading it from a hardcoded server address upon start. More native approach would be to use checkpoint server which can provide the genesis state. And providing `--checkpointSyncUrl ` would override the default server address. \r\n\r\nI am not sure if this should be default with each testnet, right now it makes sense with Holešky and Ephemery and having the feature implemented would make it future-proof with more merged networks coming. Plus might it be beneficial for testing tools as well ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1782690676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1782835946",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/6064#issuecomment-1782835946",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/6064",
    "id": 1782835946,
    "node_id": "IC_kwDOCD5_Gc5qQ-rq",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T12:30:42Z",
    "updated_at": "2023-10-27T12:30:42Z",
    "author_association": "MEMBER",
    "body": "> but some clients take approach of simply downloading it from a hardcoded server address upon start\r\n\r\nThat's what Lodestar does as well, e.g. for Holesky it will [download the genesis state from github](https://github.com/ChainSafe/lodestar/blob/cf13ce9d154962b09fe4f8fc25e8de65a6eb77ca/packages/cli/src/networks/holesky.ts#L4-L5). There is an option to [initialize the state from execution layer (eth1)](https://github.com/ChainSafe/lodestar/blob/cf13ce9d154962b09fe4f8fc25e8de65a6eb77ca/packages/cli/src/cmds/beacon/initBeaconState.ts#L153) but this seems to be a pre-merge approach and not used with networks merged on genesis.\r\n\r\nLodestar will load the state based the following criteria\r\n- from db if it exists and state is within weak subjectivity period\r\n- otherwise download the state from `checkpointSyncUrl` if set (or `checkpointState` file)\r\n- or if not set then download from `genesisFileUrl` defined in network settings or use `--genesisStateFile` provided by user\r\n\r\nThe `genesisFileUrl`  is defined for all networks and will just download the genesis state, whereas `checkpointSyncUrl` will be used to get the last finalized state which means the client does not have to sync the chain from genesis.\r\n\r\nI am not sure if there is a huge difference for Ephemery as I'd assume the network syncs quite fast but for Holesky it definitely takes a few hours already to sync from genesis which means a user has to explicitly set a `checkpointSyncUrl`.\r\n\r\nWe could think about adding a `checkpointSyncUrl` to network settings (only for testnets) to make it easier for users to join the network. For Holesky, there have been issues with downloading the state from GitHub, might be better to use checkpoint sync providers for that anyways.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1782835946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
