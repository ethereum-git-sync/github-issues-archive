{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3752",
  "id": 1132864471,
  "node_id": "I_kwDOCD5_Gc5DhiPX",
  "number": 3752,
  "title": "Empty SyncCommitteeCache error on a local devnet run",
  "user": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-02-11T17:04:00Z",
  "updated_at": "2022-02-20T09:01:42Z",
  "closed_at": "2022-02-20T09:01:42Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "This error came up on the kurtosis local testnet runs (2 lodestar beacon nodes with attached validators), where altair epoch =1, bellatrix 2 and was consistently reproducible.\r\n```\r\nFeb-11 16:59:56.001 []                 info: Synced - slot: -1 - head: 0 0xf9ba…d781 - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-11 16:59:58.004 [NETWORK]          info: Subscribing gossip topics to next fork nextFork=bellatrix\r\nFeb-11 16:59:58.004 [NETWORK]          info: Suscribing to random attnets to next fork nextFork=bellatrix\r\nFeb-11 16:59:58.005 [NETWORK]          info: Suscribing to random attnets to next fork nextFork=bellatrix\r\nFeb-11 16:59:58.006 [NETWORK]          info: Subscribed gossip core topics\r\nFeb-11 16:59:58.012 [SYNC]             info: Subscribed gossip core topics\r\nFeb-11 16:59:58.477 [API]             error: Req req-h getSyncCommitteeDuties error message=Empty SyncCommitteeCache\r\nError: Empty SyncCommitteeCache\r\n    at SyncCommitteeCacheEmpty.get validatorIndexMap [as validatorIndexMap] (/usr/app/node_modules/@chainsafe/lodestar-beacon-state-transition/src/cache/syncCommitteeCache.ts:27:11)\r\n    at Object.getSyncCommitteeDuties (/usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:392:64)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at Object.handler (/usr/app/node_modules/@chainsafe/lodestar-api/src/server/utils/server.ts:70:23)\r\nFeb-11 16:59:58.535 [API]             error: Req req-j getSyncCommitteeDuties error message=Empty SyncCommitteeCache\r\nError: Empty SyncCommitteeCache\r\n    at SyncCommitteeCacheEmpty.get validatorIndexMap [as validatorIndexMap] (/usr/app/node_modules/@chainsafe/lodestar-beacon-state-transition/src/cache/syncCommitteeCache.ts:27:11)\r\n    at Object.getSyncCommitteeDuties (/usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:392:64)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at Object.handler (/usr/app/node_modules/@chainsafe/lodestar-api/src/server/utils/server.ts:70:23)\r\n```\r\n\r\nExpected: no error",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1040402882",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3752#issuecomment-1040402882",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752",
    "id": 1040402882,
    "node_id": "IC_kwDOCD5_Gc4-A0nC",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-15T15:21:41Z",
    "updated_at": "2022-02-15T15:21:41Z",
    "author_association": "MEMBER",
    "body": "So ALTAIR_FORK_EPOCH = 1, and this error happens at slot -1 all the way through epoch 1? Did the error stop at some point?\r\n\r\nSeems that the validator is requesting for sync committee too early, could that be?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1040402882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1040457548",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3752#issuecomment-1040457548",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752",
    "id": 1040457548,
    "node_id": "IC_kwDOCD5_Gc4-BB9M",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-15T16:01:51Z",
    "updated_at": "2022-02-15T16:02:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "> So ALTAIR_FORK_EPOCH = 1, and this error happens at slot -1 all the way through epoch 1? Did the error stop at some point?\r\n> \r\n> Seems that the validator is requesting for sync committee too early, could that be?\r\n\r\nAll i remember for now its a huge scroll of screen filled with these errors and yes, it resolves after this storm is over. Will replicate and update! :+1: ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1040457548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1042998931",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3752#issuecomment-1042998931",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752",
    "id": 1042998931,
    "node_id": "IC_kwDOCD5_Gc4-KuaT",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-17T14:19:40Z",
    "updated_at": "2022-02-17T14:19:40Z",
    "author_association": "MEMBER",
    "body": "The validator client starts requesting duties 1 epoch early\r\n\r\nhttps://github.com/ChainSafe/lodestar/blob/e274b2139d7603e89c8bed91197022d224451b0f/packages/validator/src/services/syncCommitteeDuties.ts#L17-L18\r\n\r\ncould this be the cause of the errors?\r\n\r\n- I'm not sure why that would result in a flood of errors. It should try once and error.\r\n- Is the beacon node able to provide syncCommittee one epoch early? Otherwise we should set the constant to zero",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1042998931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1044197859",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3752#issuecomment-1044197859",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3752",
    "id": 1044197859,
    "node_id": "IC_kwDOCD5_Gc4-PTHj",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T09:18:55Z",
    "updated_at": "2022-02-18T09:18:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "> The validator client starts requesting duties 1 epoch early\r\n> \r\n> https://github.com/ChainSafe/lodestar/blob/e274b2139d7603e89c8bed91197022d224451b0f/packages/validator/src/services/syncCommitteeDuties.ts#L17-L18\r\n> \r\n> could this be the cause of the errors?\r\n\r\nMost likely as timeline lines up!\r\n\r\n>     * I'm not sure why that would result in a flood of errors. It should try once and error.\r\n\r\nyes you are correct! just two throws for current and next\r\n```\r\nFeb-18 08:38:47.501[]                 info: Synced - slot: -3 - head: 0 0xed9b…c00a - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-18 08:38:50.502[]                 info: Synced - slot: -2 - head: 0 0xed9b…c00a - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-18 08:38:53.502[]                 info: Synced - slot: -1 - head: 0 0xed9b…c00a - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-18 08:38:55.017[NETWORK]          info: Subscribing gossip topics to next fork nextFork=bellatrix\r\nFeb-18 08:38:55.017[NETWORK]          info: Suscribing to random attnets to next fork nextFork=bellatrix\r\nFeb-18 08:38:55.018[NETWORK]          info: Suscribing to random attnets to next fork nextFork=bellatrix\r\nFeb-18 08:38:55.018[NETWORK]          info: Subscribed gossip core topics\r\nFeb-18 08:38:55.025[SYNC]             info: Subscribed gossip core topics\r\nFeb-18 08:38:55.027[API]             error: Req req-g getSyncCommitteeDuties error  Empty SyncCommitteeCache\r\nError: Empty SyncCommitteeCache\r\n    at SyncCommitteeCacheEmpty.get validatorIndexMap [as validatorIndexMap] (/usr/app/node_modules/@chainsafe/lodestar-beacon-state-transition/src/cache/syncCommitteeCache.ts:27:11)\r\n    at Object.getSyncCommitteeDuties (/usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:392:64)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at Object.handler (/usr/app/node_modules/@chainsafe/lodestar-api/src/server/utils/server.ts:70:23)\r\nFeb-18 08:38:55.126[API]             error: Req req-j getSyncCommitteeDuties error  Empty SyncCommitteeCache\r\nError: Empty SyncCommitteeCache\r\n    at SyncCommitteeCacheEmpty.get validatorIndexMap [as validatorIndexMap] (/usr/app/node_modules/@chainsafe/lodestar-beacon-state-transition/src/cache/syncCommitteeCache.ts:27:11)\r\n    at Object.getSyncCommitteeDuties (/usr/app/node_modules/@chainsafe/lodestar/src/api/impl/validator/index.ts:392:64)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at Object.handler (/usr/app/node_modules/@chainsafe/lodestar-api/src/server/utils/server.ts:70:23)\r\nFeb-18 08:38:56.500[]                 info: Synced - slot: 0 - head: 0 0xed9b…c00a - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-18 08:38:59.501[]                 info: Synced - slot: 1 - head: 1 0x911e…2c66 - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-18 08:39:02.500[]                 info: Synced - slot: 2 - head: 2 0xc22d…78d1 - finalized: 0x0000…0000:0 - peers: 1\r\nFeb-18 08:39:05.501[]                 info: Synced - slot: 3 - head: 3 0x4820…c399 - finalized: 0x0000…0000:0 - peers: 1\r\n```\r\n\r\nI think the scroll of error was for finalityHeader errors, for which I see you opened a PR! :slightly_smiling_face: \r\n\r\n> \r\n>     * Is the beacon node able to provide syncCommittee one epoch early? Otherwise we should set the constant to zero\r\n\r\nNo, we have this pre-altair:\r\n\r\n```\r\n/** Placeholder object for pre-altair fork */\r\nexport class SyncCommitteeCacheEmpty implements SyncCommitteeCache {\r\n  get validatorIndices(): ValidatorIndex[] {\r\n    throw Error(\"Empty SyncCommitteeCache\");\r\n  }\r\n\r\n  get validatorIndexMap(): SyncComitteeValidatorIndexMap {\r\n    throw Error(\"Empty SyncCommitteeCache\");\r\n  }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1044197859/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
