{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/1383",
  "id": 676650813,
  "node_id": "MDU6SXNzdWU2NzY2NTA4MTM=",
  "number": 1383,
  "title": "Find diverse peers",
  "user": {
    "login": "mpetrunic",
    "id": 8836210,
    "node_id": "MDQ6VXNlcjg4MzYyMTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8836210?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mpetrunic",
    "html_url": "https://github.com/mpetrunic",
    "followers_url": "https://api.github.com/users/mpetrunic/followers",
    "following_url": "https://api.github.com/users/mpetrunic/following{/other_user}",
    "gists_url": "https://api.github.com/users/mpetrunic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mpetrunic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mpetrunic/subscriptions",
    "organizations_url": "https://api.github.com/users/mpetrunic/orgs",
    "repos_url": "https://api.github.com/users/mpetrunic/repos",
    "events_url": "https://api.github.com/users/mpetrunic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mpetrunic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2020-08-11T07:31:37Z",
  "updated_at": "2020-09-01T15:27:13Z",
  "closed_at": "2020-09-01T15:27:13Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "<!--NOTE: \r\n- General questions should go to the discord chat instead of the issue tracker.\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\n<!--A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]-->\r\nWe should aim to have at least one peer from each subnet.\r\n\r\n**Describe the solution you'd like**\r\n<!--A clear and concise description of what you want to happen.-->\r\nUse discv5 to periodically search for peers with attestation subnets we are missing\r\n\r\n**Describe alternatives you've considered**\r\n<!--A clear and concise description of any alternative solutions or features you've considered.-->\r\n\r\n**Additional context**\r\n<!--Add any other context or screenshots about the feature request here.-->\r\n",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/671878425",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-671878425",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 671878425,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MTg3ODQyNQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-11T10:59:41Z",
    "updated_at": "2020-08-11T10:59:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is not normal from canbo's log:\r\n```\r\n2020-08-10 23:43:58  [CHAIN]            info: Initialize forkchoice with pre-finalized blocks from 17408 to 17408\r\n        and finalized block 17440\r\n```\r\nand from my log\r\n```\r\n2020-08-11 15:09:23  [CHAIN]            info: Initialize forkchoice with pre-finalized blocks from 28127 to 28127\r\n        and finalized block 28160\r\n```\r\nin my case, I debugged and found that finalized block still in `block` database so there is no pre-finalized blocks saved in ArchiveBlock db except for the justified block, it means ArchiveBlocks task not finished while ArchiveState finished already (because it's faster)\r\nthis may happen if we don't do a cleanup stop (`kill -9` to kill the process)",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/671878425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/671879297",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-671879297",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 671879297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MTg3OTI5Nw==",
    "user": {
      "login": "mpetrunic",
      "id": 8836210,
      "node_id": "MDQ6VXNlcjg4MzYyMTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8836210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mpetrunic",
      "html_url": "https://github.com/mpetrunic",
      "followers_url": "https://api.github.com/users/mpetrunic/followers",
      "following_url": "https://api.github.com/users/mpetrunic/following{/other_user}",
      "gists_url": "https://api.github.com/users/mpetrunic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mpetrunic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mpetrunic/subscriptions",
      "organizations_url": "https://api.github.com/users/mpetrunic/orgs",
      "repos_url": "https://api.github.com/users/mpetrunic/repos",
      "events_url": "https://api.github.com/users/mpetrunic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mpetrunic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-11T11:01:57Z",
    "updated_at": "2020-08-11T11:01:57Z",
    "author_association": "MEMBER",
    "body": "I think you posted this in wrong issue? :smile: ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/671879297/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/672714819",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-672714819",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 672714819,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MjcxNDgxOQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-12T08:12:05Z",
    "updated_at": "2020-08-12T08:12:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "the above comment should be for #1381 which is closed.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/672714819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673281696",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-673281696",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 673281696,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MzI4MTY5Ng==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-13T06:06:59Z",
    "updated_at": "2020-08-13T06:06:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mpetrunic what's the rationale of this?\r\n\r\nright now we have `ATTESTATION_SUBNET_COUNT`=64 so we should have at least 64 peers for each subnet?\r\n\r\nalso I see we have `maxPeers` as network option but I don't see where it's being used.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673281696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673324333",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-673324333",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 673324333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MzMyNDMzMw==",
    "user": {
      "login": "mpetrunic",
      "id": 8836210,
      "node_id": "MDQ6VXNlcjg4MzYyMTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8836210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mpetrunic",
      "html_url": "https://github.com/mpetrunic",
      "followers_url": "https://api.github.com/users/mpetrunic/followers",
      "following_url": "https://api.github.com/users/mpetrunic/following{/other_user}",
      "gists_url": "https://api.github.com/users/mpetrunic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mpetrunic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mpetrunic/subscriptions",
      "organizations_url": "https://api.github.com/users/mpetrunic/orgs",
      "repos_url": "https://api.github.com/users/mpetrunic/repos",
      "events_url": "https://api.github.com/users/mpetrunic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mpetrunic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-13T07:56:07Z",
    "updated_at": "2020-08-13T07:56:37Z",
    "author_association": "MEMBER",
    "body": "> right now we have ATTESTATION_SUBNET_COUNT=64 so we should have at least 64 peers for each subnet?\r\n\r\nAt least 1 peer for each subnet (single peer can be subscribed to multiple subnets so we don't actually need to have 64 peers at minimum). If you aren't subscribed to subnet and you are publishing attestation, you are doing fanout and you need peer with connection that is on that subnet in order for someone to aggregate your attestation.\r\n\r\n> also I see we have maxPeers as network option but I don't see where it's being used.\r\n\r\nI think we need to set it here, but we can have more peers in peer store but just maxPeers with connection.\r\nhttps://github.com/libp2p/js-libp2p/blob/master/doc/CONFIGURATION.md#configuring-connection-manager",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673324333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673368985",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-673368985",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 673368985,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MzM2ODk4NQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-13T09:25:39Z",
    "updated_at": "2020-08-13T09:25:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "> At least 1 peer for each subnet (single peer can be subscribed to multiple subnets so we don't actually need to have 64 peers at minimum). If you aren't subscribed to subnet and you are publishing attestation, you are doing fanout and you need peer with connection that is on that subnet in order for someone to aggregate your attestation.\r\n\r\nI see. Just a clarification that we have `RANDOM_SUBNETS_PER_VALIDATOR` as 1, it means 1 peer only subscribe to 1 subnet so if we want to have peers subscribing to all subnets we need to have 64 peers https://github.com/ChainSafe/lodestar/blob/master/packages/lodestar/src/tasks/tasks/interopSubnetsJoiningTask.ts",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673368985/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673375620",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1383#issuecomment-673375620",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1383",
    "id": 673375620,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MzM3NTYyMA==",
    "user": {
      "login": "mpetrunic",
      "id": 8836210,
      "node_id": "MDQ6VXNlcjg4MzYyMTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8836210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mpetrunic",
      "html_url": "https://github.com/mpetrunic",
      "followers_url": "https://api.github.com/users/mpetrunic/followers",
      "following_url": "https://api.github.com/users/mpetrunic/following{/other_user}",
      "gists_url": "https://api.github.com/users/mpetrunic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mpetrunic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mpetrunic/subscriptions",
      "organizations_url": "https://api.github.com/users/mpetrunic/orgs",
      "repos_url": "https://api.github.com/users/mpetrunic/repos",
      "events_url": "https://api.github.com/users/mpetrunic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mpetrunic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-13T09:39:34Z",
    "updated_at": "2020-08-13T09:39:34Z",
    "author_association": "MEMBER",
    "body": "> I see. Just a clarification that we have `RANDOM_SUBNETS_PER_VALIDATOR` as 1, it means 1 peer only subscribe to 1 subnet so if we want to have peers subscribing to all subnets we need to have 64 peers https://github.com/ChainSafe/lodestar/blob/master/packages/lodestar/src/tasks/tasks/interopSubnetsJoiningTask.ts\r\n\r\nThat's unreleated to that, we don't have to be subscribed to subnet to propagate attestation, we just need to have peer on our attestation subnet.\r\n\r\nBut since you've asked, we implement that incorrectly, we don't track how many active validators we have (so we are always subscribed to one random subnet). \r\nThere are couple of solutions to that\r\n- validator must send committee subscription request even if it's not aggregator (https://github.com/ethereum/eth2.0-APIs/pull/68)\r\n- we assume active validators based on attester duties",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/673375620/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
