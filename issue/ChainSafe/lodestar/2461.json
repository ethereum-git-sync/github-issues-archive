{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2461",
  "id": 873694652,
  "node_id": "MDU6SXNzdWU4NzM2OTQ2NTI=",
  "number": 2461,
  "title": "Node gets stuck in Prater - critical",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    },
    {
      "id": 2159934357,
      "node_id": "MDU6TGFiZWwyMTU5OTM0MzU3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-testnet-debugging",
      "name": "scope-testnet-debugging",
      "color": "980043",
      "default": false,
      "description": "Issues uncovered through running a node on a public testnet."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-01T14:57:15Z",
  "updated_at": "2021-05-03T15:12:37Z",
  "closed_at": "2021-05-03T15:12:37Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "<!--NOTE: -->\r\n<!--- General questions should go to the discord chat instead of the issue tracker.-->\r\n\r\n**Describe the bug**\r\n\r\nOur test node in Prater gets stuck sometimes and is not able to progress and go back to syncing.\r\n\r\n![Screenshot from 2021-05-01 16-53-38](https://user-images.githubusercontent.com/35266934/116786298-19d6e300-aa9e-11eb-9652-516272c7a6c9.png)\r\n\r\n- Investigate why the node gets so collapsed suddenly\r\n- Investigate why the node does not go back to syncing state. I think our syncing algorithm does not allow to do that.\r\n\r\n**Expected behavior**\r\n\r\nIf the node gets overloaded it should be able to sync to the head.",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/830766097",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2461#issuecomment-830766097",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2461",
    "id": 830766097,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMDc2NjA5Nw==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-02T07:42:06Z",
    "updated_at": "2021-05-02T07:42:06Z",
    "author_association": "MEMBER",
    "body": "It has happened again, the most telling metric about the incident is \r\n- gossip validation block processing time: it goes to about 5-10 min\r\n- gossip validation block wait time, climbed to 1 hour\r\n\r\n![Screenshot from 2021-05-02 09-26-49 (1)](https://user-images.githubusercontent.com/35266934/116805746-c9f12e00-ab28-11eb-91e2-61429a1bbc5b.png)\r\n\r\nSeems that the node is extremely busy doing something because the scrape time maxes out. The event loop stays low so the node has the event loop full of tasks that may not be synchronously long but compound to long times.\r\n\r\n![Screenshot from 2021-05-02 09-30-06](https://user-images.githubusercontent.com/35266934/116805827-44ba4900-ab29-11eb-8716-22737f596c90.png)\r\n\r\nMemory spikes like crazy too. Maybe something in the regen pulling up states from disk and filling the cache?\r\n\r\n![Screenshot from 2021-05-02 09-30-30](https://user-images.githubusercontent.com/35266934/116805834-556abf00-ab29-11eb-91fb-74d5ab25c239.png)\r\n\r\n-----\r\n\r\n**Logs**\r\n\r\nCharts are in CEST time, so the big fuck-up happen at 22:30 UTC time. \r\n\r\nThis one shows that the node's and validators clock are way off\r\n```\r\nMay-01 22:16:29.576 [API]             error: Request 4093 /eth/v1/validator/duties/proposer/:epoch failed with unexpected error:  Error: Requesting beacon proposer for different epoch current shuffling: 8851 != 8852\r\n    at Proxy.getBeaconProposer (/usr/app/packages/beacon-state-transition/src/fast/util/epochContext.ts:221:13)\r\n    at ValidatorApi.getProposerDuties (/usr/app/packages/lodestar/src/api/impl/validator/validator.ts:124:40)\r\n    at runMicrotasks (<anonymous>)\r\n    at runNextTicks (internal/process/task_queues.js:58:5)\r\n    at listOnTimeout (internal/timers.js:523:9)\r\n    at processTimers (internal/timers.js:497:7)\r\n    at Object.handler (/usr/app/packages/lodestar/src/api/rest/validator/duties/getProposerDuties.ts:9:19)\r\n```\r\nThere are a many many `ATTESTATION_ERROR_TARGET_STATE_MISSING`. The regen should attach the full error here\r\n```\r\nError: ATTESTATION_ERROR_TARGET_STATE_MISSING\r\n    at processAttestation (/usr/app/packages/lodestar/src/chain/attestation/process.ts:33:11)\r\n    at processAttestationJob (/usr/app/packages/lodestar/src/chain/attestation/processor.ts:51:5)\r\n    at AttestationProcessor.processAttestationJob (/usr/app/packages/lodestar/src/chain/attestation/processor.ts:34:5)\r\n```\r\nThen the node tries to get more peers but everything is timing out, the dials, ping requests, etc.\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/830766097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
