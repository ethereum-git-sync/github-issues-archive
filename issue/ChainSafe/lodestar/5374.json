{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5374",
  "id": 1672598797,
  "node_id": "I_kwDOCD5_Gc5jsdUN",
  "number": 5374,
  "title": "Lockfiles are not created/checked when loading from keystore cache",
  "user": {
    "login": "nflaig",
    "id": 38436224,
    "node_id": "MDQ6VXNlcjM4NDM2MjI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nflaig",
    "html_url": "https://github.com/nflaig",
    "followers_url": "https://api.github.com/users/nflaig/followers",
    "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
    "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
    "organizations_url": "https://api.github.com/users/nflaig/orgs",
    "repos_url": "https://api.github.com/users/nflaig/repos",
    "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nflaig/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    },
    {
      "id": 4116819988,
      "node_id": "LA_kwDOCD5_Gc71YbAU",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-security",
      "name": "scope-security",
      "color": "980043",
      "default": false,
      "description": "Issues that fix security issues: DOS, key leak, CVEs."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/29",
    "html_url": "https://github.com/ChainSafe/lodestar/milestone/29",
    "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/29/labels",
    "id": 9244445,
    "node_id": "MI_kwDOCD5_Gc4AjQ8d",
    "number": 29,
    "title": "v1.9.0",
    "description": "",
    "creator": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 7,
    "closed_issues": 13,
    "state": "open",
    "created_at": "2023-04-04T13:04:23Z",
    "updated_at": "2023-06-02T04:59:39Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2023-04-18T08:18:58Z",
  "updated_at": "2023-05-14T10:26:20Z",
  "closed_at": "2023-05-14T10:26:20Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "When loading from keystore cache file we are currently not checking if a `.lock` for any of the keystores exists and the cache file itself does not have a lock file.\r\n\r\nIt is not possible to load the cache file is stored in `dataDir` and if you start a 2nd validator with same `dataDir` you would get `âœ– Error: Database is not open` but if a VC has a cache file it will not create lock files which is dangerous.\r\n\r\n_Originally posted by @nflaig in https://github.com/ChainSafe/lodestar/pull/5357#discussion_r1167813508_\r\n            ",
  "closed_by": {
    "login": "nflaig",
    "id": 38436224,
    "node_id": "MDQ6VXNlcjM4NDM2MjI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nflaig",
    "html_url": "https://github.com/nflaig",
    "followers_url": "https://api.github.com/users/nflaig/followers",
    "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
    "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
    "organizations_url": "https://api.github.com/users/nflaig/orgs",
    "repos_url": "https://api.github.com/users/nflaig/repos",
    "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nflaig/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1524693985",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5374#issuecomment-1524693985",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374",
    "id": 1524693985,
    "node_id": "IC_kwDOCD5_Gc5a4Pvh",
    "user": {
      "login": "h4l",
      "id": 146503,
      "node_id": "MDQ6VXNlcjE0NjUwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/146503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/h4l",
      "html_url": "https://github.com/h4l",
      "followers_url": "https://api.github.com/users/h4l/followers",
      "following_url": "https://api.github.com/users/h4l/following{/other_user}",
      "gists_url": "https://api.github.com/users/h4l/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/h4l/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/h4l/subscriptions",
      "organizations_url": "https://api.github.com/users/h4l/orgs",
      "repos_url": "https://api.github.com/users/h4l/repos",
      "events_url": "https://api.github.com/users/h4l/events{/privacy}",
      "received_events_url": "https://api.github.com/users/h4l/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T04:46:13Z",
    "updated_at": "2023-04-27T05:15:20Z",
    "author_association": "NONE",
    "body": "I just discovered this behaviour myself while debugging an unrelated file permission error. A workaround (if running in a container) is to disable the cache by mounting a tmpfs at `<dataDir>/cache` so that the cached keys are not persisted.\r\n\r\nI would guess that the path of the cache could change across versions and shouldn't be relied on though. I could open another issue, but would you be open to having an option to disable the keystore cache? Aside from this workaround, It would be nice to not leave decrypted keys on disk. (I see the code has an option to disable it, but I think it's not possible to control that option via the global options.)",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1524693985/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1525221600",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5374#issuecomment-1525221600",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374",
    "id": 1525221600,
    "node_id": "IC_kwDOCD5_Gc5a6Qjg",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T09:13:58Z",
    "updated_at": "2023-04-27T09:14:46Z",
    "author_association": "MEMBER",
    "body": "We can add a CLI flag to disable the cache but there no disadvantage of having it enabled besides what is mentioned in this issue.\r\n\r\n>  It would be nice to not leave decrypted keys on disk.\r\n\r\nThere should not be decrypted keys on disk, the keystore cache file is encrypted by combining the password of all keystore files. This also means that if you remove or add a new keystore to `importKeystores`, the cache file will be invalidated as it can no longer be decrypted.\r\n\r\n> I could open another issue, but would you be open to having an option to disable the keystore cache?\r\n\r\nLet's discuss it here first, I can create an issue but would like to better understand what are the use cases for disabling the keystore cache.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1525221600/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1525433526",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5374#issuecomment-1525433526",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5374",
    "id": 1525433526,
    "node_id": "IC_kwDOCD5_Gc5a7ES2",
    "user": {
      "login": "h4l",
      "id": 146503,
      "node_id": "MDQ6VXNlcjE0NjUwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/146503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/h4l",
      "html_url": "https://github.com/h4l",
      "followers_url": "https://api.github.com/users/h4l/followers",
      "following_url": "https://api.github.com/users/h4l/following{/other_user}",
      "gists_url": "https://api.github.com/users/h4l/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/h4l/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/h4l/subscriptions",
      "organizations_url": "https://api.github.com/users/h4l/orgs",
      "repos_url": "https://api.github.com/users/h4l/repos",
      "events_url": "https://api.github.com/users/h4l/events{/privacy}",
      "received_events_url": "https://api.github.com/users/h4l/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T10:37:39Z",
    "updated_at": "2023-04-27T10:37:49Z",
    "author_association": "NONE",
    "body": "> There should not be decrypted keys on disk, the keystore cache file is encrypted by combining the password of all keystore files.\r\n\r\nAh OK good, I missed that. My concern is invalid then. I don't have a use case for disabling it other than as a workaround for this, so no need to add a flag I think. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1525433526/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
