{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3903",
  "id": 1198713480,
  "node_id": "I_kwDOCD5_Gc5HcuqI",
  "number": 3903,
  "title": "investigate and fix snappy stream encoding of a big bellatrix block which was rejected by the lighthouse bn",
  "user": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-04-09T16:56:59Z",
  "updated_at": "2022-05-04T15:26:53Z",
  "closed_at": "2022-05-04T15:26:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Pawan from lighthouse raised an issue where there snappy decoder rejected a lodestar encoded block. Apparently it was a big `bellatrix` block from `goerli shadowfork 2`.\r\n\r\nInvestigation Updates:\r\n- [x] After a bit of joint setup and investigation, pawan came up with theory that it was because of the snappy stream specification where a decoded/uncompressed chunk can't be > 65k bytes, and this particular block was around 130k bytes.\r\n- [x] Was able to stream decode the provided data, as suspected it was just `1` chunk, was able to successfully ssz decode bellatrix block\r\n  ![image](https://user-images.githubusercontent.com/76567250/162583587-125bd925-6a6f-4108-9638-a5837f74becf.png)\r\n- [x] Chunkified the uncompressed data into three chunks and reencoded it as a stream and dumped it into a file. Passed that re-encoded chunkified stream against the test code to confirm that it was now being decoded as 3 chunks `(60k,60k,13k)` something bytes. Provided the file to pawan over discord for him to run through his decoder and confirm\r\n- [x] Waiting on Pawan/Lighthouse team for confirmation on the chunk post, [details here in comment](https://github.com/ChainSafe/lodestar/issues/3903#issuecomment-1094113893)\r\n\r\nExpectation: Upon successful confirmation from Pawan/lighthouse regarding the successful decoding of the chunkified stream, do a PR in lodestar to chunkify the snappy stream payloads as well as add tests for the same using the same block data \r\n  ",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1094113893",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3903#issuecomment-1094113893",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3903",
    "id": 1094113893,
    "node_id": "IC_kwDOCD5_Gc5BNtpl",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-09T19:44:01Z",
    "updated_at": "2022-04-12T07:51:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "### lighthouse <> lodestar chunked encoding/decoding status\r\n\r\n- [x] Aparently, lighthouse is getting checksum error on the chunked stream encoded data by lodestar. \r\n   However the my decoder able to decode lighthouse chunk encoded data correctly. So apparently, there are two differentt encodings for the same uncompressed data. \r\n  Verified that the decoder was correctly decoding two different encodings/compressions into the same data.\r\n- [x] Check using other libraries/with other CLs\r\n ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1094113893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
