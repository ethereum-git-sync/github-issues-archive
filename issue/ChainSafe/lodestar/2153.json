{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2153",
  "id": 826603371,
  "node_id": "MDU6SXNzdWU4MjY2MDMzNzE=",
  "number": 2153,
  "title": "Implement regen metrics",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090446,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ2",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-medium",
      "name": "prio-medium",
      "color": "fdc09f",
      "default": false,
      "description": "Resolve this some time soon (tm)."
    },
    {
      "id": 2963898184,
      "node_id": "MDU6TGFiZWwyOTYzODk4MTg0",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-performance",
      "name": "scope-performance",
      "color": "980043",
      "default": false,
      "description": "Performance issue and ideas to improve performance."
    },
    {
      "id": 2966148095,
      "node_id": "MDU6TGFiZWwyOTY2MTQ4MDk1",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-metrics",
      "name": "scope-metrics",
      "color": "980043",
      "default": false,
      "description": "All issues with regards to the exposed metrics."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-03-09T20:40:41Z",
  "updated_at": "2021-09-03T08:20:37Z",
  "closed_at": "2021-09-03T08:20:37Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "- Cache hits vs cache miss\r\n- Cache frequency usage, last usage per item",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/817133134",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2153#issuecomment-817133134",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
    "id": 817133134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNzEzMzEzNA==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-10T13:00:32Z",
    "updated_at": "2021-04-10T13:00:44Z",
    "author_association": "MEMBER",
    "body": "> @dapplion I think we should close this in favor of suggestion above:\r\nadd metrics to regen module\r\n\r\nFrom https://github.com/ChainSafe/lodestar/pull/2285#issuecomment-816780773",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/817133134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/869162758",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2153#issuecomment-869162758",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
    "id": 869162758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTE2Mjc1OA==",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-27T13:30:07Z",
    "updated_at": "2021-06-27T13:30:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dapplion please assign",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/869162758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/869197684",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2153#issuecomment-869197684",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
    "id": 869197684,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTE5NzY4NA==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-27T17:22:18Z",
    "updated_at": "2021-06-27T17:22:18Z",
    "author_association": "MEMBER",
    "body": "> @dapplion please assign\r\n\r\nIf you need help to design the metrics on this component reach out to me or Cayman. Be aware that the regen logic is quite complex with many entrypoints. Doing the metrics right will be much harder than the fork choice and require a good understatement of it mechanics.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/869197684/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/869208163",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2153#issuecomment-869208163",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
    "id": 869208163,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTIwODE2Mw==",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-27T18:44:29Z",
    "updated_at": "2021-06-27T18:44:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dapplion thanks, will try to figure it out while I implement other simpler metrics. Will circle back on this once I get a priliminary understanding. üëç",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/869208163/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/877608829",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2153#issuecomment-877608829",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
    "id": 877608829,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NzYwODgyOQ==",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-10T09:52:36Z",
    "updated_at": "2021-07-10T09:52:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "ok, i think i have a preliminary understanding of the regen module basis which I propose following metrics structure:\r\n\r\nregenStateCacheLookupTotal: gauge<entrypointFn,callingModule>\r\nregenStateCacheLoopkupHits: gauge<entrypointFn,callingModule>\r\n\r\nregenCPStateCacheLookupTotal: gauge<entrypointFn,callingModule>\r\nregenCPStateCacheLookupHits: gauge<entrypointFn,callingModule>\r\n\r\nwhere entrypointFn label in ['getPreState','getCheckpointState','getState','getBlockSlotState']\r\ncallingModule label in ['validateGossipBlock','validateGossipAttestation','validateGossipAggregateAndProof','validateGossipVoluntaryExit','produceBlock','produceAttestationData', 'getProposerDuties', 'getAttesterDuties', 'getSyncCommitteeDuties',', 'onFinalized']\r\n\r\nThis will give a good slicing, dicing and rollups to figure out and debut what is happening.\r\ngrafana dashboard panel, can plot them up as stacked, and a  module wise sum by (callingModule) graphs can be plotted.\r\n\r\n@dapplion @wemeetagain  let me know your thoughts on the same.\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/877608829/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/879171006",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2153#issuecomment-879171006",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2153",
    "id": 879171006,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTE3MTAwNg==",
    "user": {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-13T15:08:47Z",
    "updated_at": "2021-07-13T15:08:47Z",
    "author_association": "MEMBER",
    "body": "I thinkthe lookup / hits is a good start.\r\n\r\nHere's how I see the regen module, there's a few different loads in the regen module that may happen, from best to worst:\r\n- the requested state is in the cache, no further processing required\r\n- the requested state _at a prior slot_ is in the cache, slots must be dialed forward, possibly hitting an epoch transition\r\n- a prior state is in the cache, blocks must be replayed to the requested state\r\n- a prior state is in the cache, blocks must be replayed to the requested state, then slots must be dialed forward\r\n\r\nAnd then there's the error case, when the state can't be regenerated for whatever reason.\r\n\r\nI think some other things I'd like to know, where metrics could help:\r\n- how often are we needing to reprocess slots? epochs? blocks?\r\n  - how many blocks? (not very actionable, but maybe interesting)\r\n- how long do regen tasks take?\r\n- how often are there regen errors?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/879171006/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
