{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2244",
  "id": 839582429,
  "node_id": "MDU6SXNzdWU4Mzk1ODI0Mjk=",
  "number": 2244,
  "title": "Prater logs - dialing local IP",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090453,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDUz",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-low",
      "name": "prio-low",
      "color": "fde2b4",
      "default": false,
      "description": "This is nice to have."
    },
    {
      "id": 2159934357,
      "node_id": "MDU6TGFiZWwyMTU5OTM0MzU3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-testnet-debugging",
      "name": "scope-testnet-debugging",
      "color": "980043",
      "default": false,
      "description": "Issues uncovered through running a node on a public testnet."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-03-24T10:35:09Z",
  "updated_at": "2023-05-26T15:53:31Z",
  "closed_at": "2023-05-26T15:53:30Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "<!--NOTE: -->\r\n<!--- General questions should go to the discord chat instead of the issue tracker.-->\r\n\r\n**Describe the bug**\r\n\r\nDuring Prater genesis I see some libp2p errors of failed dials to local IPs. Why does libp2p try to connect to local IPs for nodes? Do they advertise local IPs in their ENRs or ENRs contain multiple entries?\r\n\r\n```\r\n21-03-23 15:22:45 [NETWORK]         debug: Error dialing discovered peer peer=16Uiu2HAkw3emzXMPYuVoYM21DmRh832diFswxszxGdcv51F9HrtE message=\r\n    Error: connection error 0.0.0.0:9137: connect ECONNREFUSED 0.0.0.0:9137\r\nAggregateError: \r\n    Error: connection error 0.0.0.0:9137: connect ECONNREFUSED 0.0.0.0:9137\r\n    at maybeSettle (/root/lodestar/node_modules/p-some/index.js:31:11)\r\n    at /root/lodestar/node_modules/p-some/index.js:69:23\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\n```\r\n\r\nTo investigate:\r\n- How often does libp2p try to connect to local IPs when dialing peers?\r\n- What's the cost of doing so?\r\n\r\n",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/805732614",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2244#issuecomment-805732614",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
    "id": 805732614,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwNTczMjYxNA==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-24T11:08:57Z",
    "updated_at": "2021-03-24T11:08:57Z",
    "author_association": "MEMBER",
    "body": "Other log latter\r\n```\r\n2021-03-23 15:24:05 [NETWORK]         debug: Error dialing discovered peer peer=16Uiu2HAmBNaJnhXvy15fa5FCQNBVrN8fBvdkbeFWStvYJ7UPSELQ message=\r\n    Error: connection error 127.0.0.1:9150: connect ECONNREFUSED 127.0.0.1:9150\r\n    Error: connection error 172.17.0.1:9150: connect ECONNREFUSED 172.17.0.1:9150\r\n    Error: connection error 66.85.74.26:9150: connect ECONNREFUSED 66.85.74.26:9150\r\n    Error: The operation was aborted\r\n        at AbortSignal.onAbort (/root/lodestar/node_modules/libp2p-tcp/src/index.js:86:14)\r\n        at AbortSignal.dispatchEvent (/root/lodestar/node_modules/event-target-shim/src/event-target.mjs:337:35)\r\n        at abortSignal (/root/lodestar/node_modules/abort-controller/src/abort-signal.ts:68:12)\r\n        at AbortController.abort (/root/lodestar/node_modules/abort-controller/src/abort-controller.ts:26:9)\r\n        at AbortSignal.onAbort (/root/lodestar/node_modules/any-signal/index.js:13:16)\r\n        at AbortSignal.dispatchEvent (/root/lodestar/node_modules/event-target-shim/src/event-target.mjs:337:35)\r\n        at abortSignal (/root/lodestar/node_modules/abort-controller/src/abort-signal.ts:68:12)\r\n        at AbortController.abort (/root/lodestar/node_modules/abort-controller/src/abort-controller.ts:26:9)\r\n        at AbortSignal.onAbort (/root/lodestar/node_modules/any-signal/index.js:13:16)\r\n        at AbortSignal.dispatchEvent (/root/lodestar/node_modules/event-target-shim/src/event-target.mjs:337:35)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/805732614/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/853235104",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2244#issuecomment-853235104",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
    "id": 853235104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzIzNTEwNA==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-06-02T17:18:47Z",
    "updated_at": "2021-06-02T17:18:47Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed in 15 days if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/853235104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/912547118",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2244#issuecomment-912547118",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
    "id": 912547118,
    "node_id": "IC_kwDOCD5_Gc42ZF0u",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T13:38:06Z",
    "updated_at": "2021-09-03T13:38:06Z",
    "author_association": "MEMBER",
    "body": "@vasco-santos Can you take a look? Should we escalate this to some libp2p module?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/912547118/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/912555585",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2244#issuecomment-912555585",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
    "id": 912555585,
    "node_id": "IC_kwDOCD5_Gc42ZH5B",
    "user": {
      "login": "vasco-santos",
      "id": 7295071,
      "node_id": "MDQ6VXNlcjcyOTUwNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7295071?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasco-santos",
      "html_url": "https://github.com/vasco-santos",
      "followers_url": "https://api.github.com/users/vasco-santos/followers",
      "following_url": "https://api.github.com/users/vasco-santos/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasco-santos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasco-santos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasco-santos/subscriptions",
      "organizations_url": "https://api.github.com/users/vasco-santos/orgs",
      "repos_url": "https://api.github.com/users/vasco-santos/repos",
      "events_url": "https://api.github.com/users/vasco-santos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasco-santos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T13:51:01Z",
    "updated_at": "2021-09-03T13:51:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Why does libp2p try to connect to local IPs for nodes? \r\n\r\nIf it tries, that is because they are advertised. Check the [announceFilters option](https://github.com/libp2p/js-libp2p/blob/master/doc/CONFIGURATION.md#customizing-libp2p)\r\n\r\n> @vasco-santos Can you take a look? Should we escalate this to some libp2p module?\r\n\r\nI think this might be a re-connect attempt from both sides, resulting in a connection to happen from one side and the other is aborted as the connection was already established. Did you see if you have a connection after the error?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/912555585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/912634539",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2244#issuecomment-912634539",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
    "id": 912634539,
    "node_id": "IC_kwDOCD5_Gc42ZbKr",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T15:46:39Z",
    "updated_at": "2021-09-03T15:46:39Z",
    "author_association": "MEMBER",
    "body": "> > Why does libp2p try to connect to local IPs for nodes?\r\n> \r\n> If it tries, that is because they are advertised. Check the [announceFilters option](https://github.com/libp2p/js-libp2p/blob/master/doc/CONFIGURATION.md#customizing-libp2p)\r\n> \r\n> > @vasco-santos Can you take a look? Should we escalate this to some libp2p module?\r\n> \r\n> I think this might be a re-connect attempt from both sides, resulting in a connection to happen from one side and the other is aborted as the connection was already established. Did you see if you have a connection after the error?\r\n\r\nHmm the node should not assume that a valuable peer is the same host, tho unlikely. Should we filter 0.0.0.0, 127.0.0.1 addresses out by default, providing a flag to undo that?\r\n\r\nI will debug to see if the connection was established, would need more debugging to be sure",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/912634539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1564596876",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2244#issuecomment-1564596876",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2244",
    "id": 1564596876,
    "node_id": "IC_kwDOCD5_Gc5dQdqM",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T15:53:30Z",
    "updated_at": "2023-05-26T15:53:30Z",
    "author_association": "MEMBER",
    "body": "Closing here\r\n\r\n@wemeetagain @maschad do you think this issue is relevant in libp2p side?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1564596876/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
