{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4190",
  "id": 1283713229,
  "node_id": "I_kwDOCD5_Gc5Mg-jN",
  "number": 4190,
  "title": "Timeout downloading weak subjectivity state",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    },
    {
      "id": 4116885308,
      "node_id": "LA_kwDOCD5_Gc71Yq88",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-ux",
      "name": "scope-ux",
      "color": "980043",
      "default": false,
      "description": "Issues for CLI UX or general consumer UX."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/18",
    "html_url": "https://github.com/ChainSafe/lodestar/milestone/18",
    "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/18/labels",
    "id": 8146525,
    "node_id": "MI_kwDOCD5_Gc4AfE5d",
    "number": 18,
    "title": "Sprint: July 15, 2022",
    "description": "",
    "creator": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 18,
    "state": "closed",
    "created_at": "2022-06-29T13:27:28Z",
    "updated_at": "2023-05-26T18:37:27Z",
    "due_on": "2022-07-15T07:00:00Z",
    "closed_at": "2022-09-02T18:41:31Z"
  },
  "comments": 5,
  "created_at": "2022-06-24T12:49:48Z",
  "updated_at": "2022-07-06T03:31:33Z",
  "closed_at": "2022-07-06T03:31:33Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nGot this error when trying to download a weak subjectivity state:\r\n\r\n```\r\nJun 24 14:40:11 contabo-7 beacon_run.sh[2384756]:  ✖ Error: Unable to fetch weak subjectivity state: Timeout request\r\nJun 24 14:40:11 contabo-7 beacon_run.sh[2384756]:     at fetchWeakSubjectivityState (file:///usr/src/lodestar/packages/cli/src/networks/index.ts:190:11)\r\nJun 24 14:40:11 contabo-7 beacon_run.sh[2384756]:     at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\nJun 24 14:40:11 contabo-7 beacon_run.sh[2384756]:     at initFromWSState (file:///usr/src/lodestar/packages/cli/src/cmds/beacon/initBeaconState.ts:153:37)\r\nJun 24 14:40:11 contabo-7 beacon_run.sh[2384756]:     at initBeaconState (file:///usr/src/lodestar/packages/cli/src/cmds/beacon/initBeaconState.ts:94:12)\r\nJun 24 14:40:11 contabo-7 beacon_run.sh[2384756]:     at Object.beaconHandler [as handler] (file:///usr/src/lodestar/packages/cli/src/cmds/beacon/handler.ts:68:41)\r\n```\r\n\r\n**Expected behavior**\r\n\r\nSince the state is big, we should be able to increase the timeout at client api when downloading a state\r\n\r\n**Steps to Reproduce**\r\n\r\nUse below param:\r\n```\r\nweakSubjectivitySyncLatest: \"true\"\r\nweakSubjectivityServerUrl: \"https://some-server.io\"\r\nweakSubjectivityCheckpoint: \"checkpoint:epoch\"\r\n```",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1166319342",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4190#issuecomment-1166319342",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190",
    "id": 1166319342,
    "node_id": "IC_kwDOCD5_Gc5FhJ7u",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-25T16:23:30Z",
    "updated_at": "2022-06-25T16:23:30Z",
    "author_association": "MEMBER",
    "body": "What's the current timeout? It should also log the timeout time for better debugging",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1166319342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1172394818",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4190#issuecomment-1172394818",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190",
    "id": 1172394818,
    "node_id": "IC_kwDOCD5_Gc5F4VNC",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-01T14:13:48Z",
    "updated_at": "2022-07-01T15:19:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "60 seconds (`60_000`) is the default timeout which is also applicable here as we don't provide any, \r\n\r\nI think its sufficient for for 150/200MB downloading state (and most of time i have seen timeouts happening when server is genrally super slow or network is really very bad).\r\n\r\nIn this scenario others can offline download it (octect stream) via `curl` and dump into file (we can may be throw the command here) and provide that, may be we can log this message in the timeout error here\r\n\r\nBecause the issue with really big timeouts with (for really slow networks) would be to log status on the cli else the user wiil go wondering if lodestar is stuck",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1172394818/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1173486780",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4190#issuecomment-1173486780",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190",
    "id": 1173486780,
    "node_id": "IC_kwDOCD5_Gc5F8fy8",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-04T08:03:36Z",
    "updated_at": "2022-07-04T08:03:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I think its sufficient for for 150/200MB downloading state (and most of time i have seen timeouts happening when server is genrally super slow or network is really very bad).\r\n\r\nit usually takes more than 60s to download state:\r\n- contabo-20: 1m57s\r\n```\r\ndevops@contabo-20:~$ curl -H 'Accept: application/octet-stream' https://***.infura.io/eth/v2/debug/beacon/states/3367104 --output state_3367104.ssz\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 49.8M    0 49.8M    0     0   434k      0 --:--:--  0:01:57 --:--:--  884k\r\n```\r\n- hetzner-test0: 3m1s\r\n```\r\ndevops@hetzner-test0:~/tuyen/beacon$ curl -H 'Accept: application/octet-stream' https://***.infura.io/eth/v2/debug/beacon/states/3367104 --output state_3367104.ssz\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 49.8M    0 49.8M    0     0   281k      0 --:--:--  0:03:01 --:--:--  871k\r\n```\r\n- my localhost: 2m21s\r\n```\r\nTuyens-MacBook-Pro-16519:Downloads tuyennguyen$ curl -H 'Accept: application/octet-stream' https://***eth2-beacon-prater.infura.io/eth/v2/debug/beacon/states/3367104 --output state_3367104.ssz\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 49.8M    0 49.8M    0     0   359k      0 --:--:--  0:02:21 --:--:--  320k\r\n```\r\n\r\n> Because the issue with really big timeouts with (for really slow networks) would be to log status on the cli else the user wiil go wondering if lodestar is stuck\r\n\r\nthis is a valid concern 👍 , I think it's a matter of UX, not with the timeout. One thing we can do is periodically log to the screen while waiting for all state bytes to be downloaded\r\n\r\n> In this scenario others can offline download it (octect stream) via curl and dump into file (we can may be throw the command here) and provide that, may be we can log this message in the timeout error here\r\n\r\nthis is a good idea, we should improve our log to instruct users to do that\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1173486780/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1175345932",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4190#issuecomment-1175345932",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190",
    "id": 1175345932,
    "node_id": "IC_kwDOCD5_Gc5GDlsM",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-05T18:05:12Z",
    "updated_at": "2022-07-05T18:05:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "@tuyennhv thanks for the stats! is infura super slow generally or have speed rationing? very poor download speeds seems like.\r\n\r\nIn this case I would propose make kick it to 5 mins. multiple logs will take care of UX.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1175345932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1175727742",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4190#issuecomment-1175727742",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4190",
    "id": 1175727742,
    "node_id": "IC_kwDOCD5_Gc5GFC5-",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-06T03:06:30Z",
    "updated_at": "2022-07-06T03:06:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @tuyennhv thanks for the stats! is infura super slow generally or have speed rationing? very poor download speeds seems like.\r\n\r\nI'm not sure if that's the specific issue of infura or not since the node usually have to regen state (we store state per 1024 epochs)\r\n\r\n> In this case I would propose make kick it to 5 mins. multiple logs will take care of UX.\r\n\r\nI increased that to 5 mins in the PR 👍 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1175727742/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
