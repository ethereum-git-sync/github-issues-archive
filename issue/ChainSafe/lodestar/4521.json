{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4521",
  "id": 1366590231,
  "node_id": "I_kwDOCD5_Gc5RdIMX",
  "number": 4521,
  "title": "API base url parsing does not work for eventstream ",
  "user": {
    "login": "nazarhussain",
    "id": 112468,
    "node_id": "MDQ6VXNlcjExMjQ2OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/112468?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nazarhussain",
    "html_url": "https://github.com/nazarhussain",
    "followers_url": "https://api.github.com/users/nazarhussain/followers",
    "following_url": "https://api.github.com/users/nazarhussain/following{/other_user}",
    "gists_url": "https://api.github.com/users/nazarhussain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nazarhussain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nazarhussain/subscriptions",
    "organizations_url": "https://api.github.com/users/nazarhussain/orgs",
    "repos_url": "https://api.github.com/users/nazarhussain/repos",
    "events_url": "https://api.github.com/users/nazarhussain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nazarhussain/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-09-08T15:44:00Z",
  "updated_at": "2023-12-12T10:45:29Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nIf someone using a **base url** ending with `/` that make the `api.events.` namespace to not work. All other namespaces works fine. \r\n\r\n**Expected behavior**\r\n\r\nIt should work fine without any error by parsing the base url correctly. If not then it should throw some error to users to tell them base url format is not valid. \r\n\r\n**Steps to Reproduce**\r\n\r\n```ts\r\nimport {getClient} from \"@lodestar/api\";\r\n\r\nconst api =  getClient({baseUrl: \"http://127.0.0.1:5001/\"});\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n- Branch: [unstable]\r\n- Commit hash: [e8232]\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1793777249",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4521#issuecomment-1793777249",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521",
    "id": 1793777249,
    "node_id": "IC_kwDOCD5_Gc5q6t5h",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-05T16:04:04Z",
    "updated_at": "2023-11-05T16:04:04Z",
    "author_association": "MEMBER",
    "body": "Make sure it's not an issue after #5128 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1793777249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1851788363",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4521#issuecomment-1851788363",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4521",
    "id": 1851788363,
    "node_id": "IC_kwDOCD5_Gc5uYAxL",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-12T10:45:28Z",
    "updated_at": "2023-12-12T10:45:28Z",
    "author_association": "MEMBER",
    "body": "I have opened a PR to address this https://github.com/ChainSafe/lodestar/pull/6179 but I am not sure if we should throw an error if server responds with a 404 (which it did previously due to `//` in URL).\r\n\r\nRight now the only errors that are considered \"unrecoverable\" are 400 and 500 status codes, those are also defined in the spec.\r\nhttps://github.com/ChainSafe/lodestar/blob/959a8af1b757c46a0e57450788fb72773a372608/packages/api/src/beacon/client/events.ts#L36-L42\r\n\r\nThe problem is that the eventstream will be closed permanently if we reject on error here which might not be desired for 404 errors because the issue could be related to a proxy misconfiguration, same goes for 401 errors, those could be potentially recoverable and it might be safer to retry connecting the eventstream.\r\n\r\nEven if we don't consider 401 / 404 as fatal errors we should definitely find a solution to log those errors which is currently not done as handler does not have access to logger\r\nhttps://github.com/ChainSafe/lodestar/blob/959a8af1b757c46a0e57450788fb72773a372608/packages/api/src/beacon/client/events.ts#L44-L45\r\n\r\n> If not then it should throw some error to users to tell them base url format is not valid.\r\n\r\nThe http client throws an error if base url format is invalid, the expected behavior stated in this PR should be addressed once https://github.com/ChainSafe/lodestar/pull/6179 is merged",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1851788363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
