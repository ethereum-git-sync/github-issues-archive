{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5352",
  "id": 1659797637,
  "node_id": "I_kwDOCD5_Gc5i7oCF",
  "number": 5352,
  "title": "High mcache miss rate",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-04-09T08:34:07Z",
  "updated_at": "2023-04-14T08:55:42Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nThis is from a test mainnet node subscribing to all subnets.\r\n\r\nAfter #5350 there are high percentage (50% - 75%) of mcache miss, most of them are gossip attestation messages\r\n\r\n<img width=\"803\" alt=\"Screenshot 2023-04-09 at 15 20 18\" src=\"https://user-images.githubusercontent.com/10568965/230762175-f18574bd-a0cc-4037-b14c-a141da86ebf6.png\">\r\n\r\nSo even lodestar was able to process more gossip attestations, it could indicate some waste time because attestations are not processed fast enough to forward to peers\r\n\r\n**Expected behavior**\r\n\r\nIf a message is validated and processed at lodestar, it 's expected to contribute to the network. In the case of gossip attestation messages:\r\n- A lot of messages are not spread to the network\r\n- Some attestations' job wait time is up to 12s which is not beneficial to the aggregation\r\n<img width=\"889\" alt=\"Screenshot 2023-04-09 at 15 24 54\" src=\"https://user-images.githubusercontent.com/10568965/230762372-0432a3dc-52eb-427b-8910-67996644a2ca.png\">\r\n\r\nwe should improve the performance of gossip validation or increase mcache history (which could make us different from the spec) or it could indicate some waste time processing these messages and then cannot forward to the network due to gossipsub's mcache history is configured as 6 * 0.7s(per heartbeat) = 4.2s per spec. Notice that lodestar also experience I/O lag issue due to more attestations being processed.\r\n\r\ncc @dapplion ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1501619126",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5352#issuecomment-1501619126",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5352",
    "id": 1501619126,
    "node_id": "IC_kwDOCD5_Gc5ZgOO2",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-10T09:49:16Z",
    "updated_at": "2023-04-10T09:49:16Z",
    "author_association": "MEMBER",
    "body": "Let's focus first on understanding the high job process time and addressing it. I'm sure there are multiple optimizations possible we can leverage.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1501619126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
