{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2115",
  "id": 818292412,
  "node_id": "MDU6SXNzdWU4MTgyOTI0MTI=",
  "number": 2115,
  "title": "Consider increasing max_semi_space_size",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090453,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDUz",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-low",
      "name": "prio-low",
      "color": "fde2b4",
      "default": false,
      "description": "This is nice to have."
    },
    {
      "id": 2963898184,
      "node_id": "MDU6TGFiZWwyOTYzODk4MTg0",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-performance",
      "name": "scope-performance",
      "color": "980043",
      "default": false,
      "description": "Performance issue and ideas to improve performance."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2021-02-28T19:47:29Z",
  "updated_at": "2023-08-23T22:33:51Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "According to GC metrics on master the beacon node spends 10% of the time doing Scavenge GC runs. \r\n\r\n![Screenshot from 2021-02-28 20-45-51](https://user-images.githubusercontent.com/35266934/109431313-37d48880-7a06-11eb-8560-95d6b0db8f40.png)\r\n\r\nIf the metrics are correct this article suggests increasing `max_semi_space_size` with the flag `--max_semi_space_size` to reduce the frequency of these runs.\r\n\r\nhttps://www.alibabacloud.com/blog/better-node-application-performance-through-gc-optimization_595119",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/853235392",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-853235392",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 853235392,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzIzNTM5Mg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-06-02T17:19:09Z",
    "updated_at": "2021-06-02T17:19:09Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed in 15 days if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/853235392/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1253151954",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1253151954",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1253151954,
    "node_id": "IC_kwDOCD5_Gc5KsZTS",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-09-21T03:12:43Z",
    "updated_at": "2022-09-21T03:12:43Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed in 15 days if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1253151954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668652647",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1668652647",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1668652647,
    "node_id": "IC_kwDOCD5_Gc5jdZ5n",
    "user": {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-07T22:23:47Z",
    "updated_at": "2023-08-07T22:23:47Z",
    "author_association": "MEMBER",
    "body": "cc @matthewkeil re #5829 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668652647/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668665636",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1668665636",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1668665636,
    "node_id": "IC_kwDOCD5_Gc5jddEk",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-07T22:40:23Z",
    "updated_at": "2023-08-07T22:40:23Z",
    "author_association": "MEMBER",
    "body": "@wemeetagain I had this set on `beta` when we discovered the memory leak in #5851 so it was hard to see full effect but it did cut the Scavenge time in line with the worker new space adjustment before things started to get wonky when the heap grew from the leak.  It will most definitely be a nice tune-up though and I will get this set correctly once we get the leak addressed and can see the fruits of the change!!",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668665636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668669125",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1668669125",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1668669125,
    "node_id": "IC_kwDOCD5_Gc5jdd7F",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-07T22:44:46Z",
    "updated_at": "2023-08-07T22:44:46Z",
    "author_association": "MEMBER",
    "body": "As a note, the docs are not super clear about what \"semi\" space is.  But after digging in the codebase its related to young generation and `kNewLargeObjectSpaceToSemiSpaceRatio` which always equals `1`;\r\n\r\n```c++\r\nsize_t Heap::YoungGenerationSizeFromSemiSpaceSize(size_t semi_space_size) {\r\n  return semi_space_size * (2 + kNewLargeObjectSpaceToSemiSpaceRatio);\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1668669125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673790448",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1673790448",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1673790448,
    "node_id": "IC_kwDOCD5_Gc5jxAPw",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T19:28:21Z",
    "updated_at": "2023-08-10T19:29:27Z",
    "author_association": "MEMBER",
    "body": "Memory leak #5851 resolved.  Deploying `unstable` to `feat2` with `--max-semi-space-size=64`.  The max scavenge witnessed currently was on mainnet in the unstable group.  All other instances were lower and some substantially lower. \r\nUnsure how the larger value will affect performance on the smaller instances so will let run for a few days without the worker to see what turns up.\r\n\r\n`unstable-mainnet-hzax41`\r\n![Screenshot 2023-08-10 at 1 23 13 PM](https://github.com/ChainSafe/lodestar/assets/18608739/93f1e801-5e15-43a2-b539-154545e26d9a)\r\n\r\n`unstable-novc-ctvpss`\r\n![Screenshot 2023-08-10 at 1 25 03 PM](https://github.com/ChainSafe/lodestar/assets/18608739/7cb0297e-2acc-4e31-bcde-b0c717196aef)\r\n\r\n`unstable-sm1v-ctvpss`\r\n![Screenshot 2023-08-10 at 1 25 16 PM](https://github.com/ChainSafe/lodestar/assets/18608739/891ad195-341a-4766-8dca-588eb5d0b6ca)",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1673790448/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1676225833",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1676225833",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1676225833,
    "node_id": "IC_kwDOCD5_Gc5j6S0p",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-13T04:50:45Z",
    "updated_at": "2023-08-16T05:58:56Z",
    "author_association": "MEMBER",
    "body": "## Results \r\n\r\n`feat2` with `--max-semi-space-size=64`\r\n`feat1` with `--max-semi-space-size=128`\r\n`beta` with `--max-semi-space-size=256`\r\n\r\nall runs are with `use_worker=false`\r\n\r\n### `group-mainnet-hzax41`\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat2-mainnet-hzax41&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat1-mainnet-hzax41&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691832600000&to=1691904600000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cbeta-mainnet-hzax41&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\n#### `feat2`\r\n![Screenshot 2023-08-12 at 10 05 09 PM](https://github.com/ChainSafe/lodestar/assets/18608739/ba90cc52-79d5-4154-96c1-ecd4e000c76b)\r\n\r\n#### `feat1`\r\n![Screenshot 2023-08-12 at 10 53 57 PM](https://github.com/ChainSafe/lodestar/assets/18608739/c23dbc7e-0924-42de-ad16-d0c54a220fae)\r\n\r\n#### `beta`\r\n![Screenshot 2023-08-12 at 11 10 09 PM](https://github.com/ChainSafe/lodestar/assets/18608739/925099ff-17b9-46f6-8ad1-e5ade4446004)\r\n\r\n\r\n### `group-lg1k-hzax41`\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat2-lg1k-hzax41&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat1-lg1k-hzax41&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691832600000&to=1691904600000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cbeta-lg1k-hzax41&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\n#### `feat2`\r\n![Screenshot 2023-08-12 at 11 22 24 PM](https://github.com/ChainSafe/lodestar/assets/18608739/d8be1309-9f8b-447d-bb70-ed5618dff7f4)\r\n\r\n#### `feat1`\r\n![Screenshot 2023-08-12 at 11 22 34 PM](https://github.com/ChainSafe/lodestar/assets/18608739/7115012e-fec4-4303-a5ba-8f7fce59a3de)\r\n\r\n#### `beta`\r\n![Screenshot 2023-08-12 at 11 22 45 PM](https://github.com/ChainSafe/lodestar/assets/18608739/207027bb-e07c-4170-98bf-e32fae09071b)\r\n\r\n\r\n### `feat2-md16-ctvpsm`\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat2-md16-ctvpsm&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat1-md16-ctvpsm&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691832600000&to=1691904600000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cbeta-md16-ctvpsm&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\n#### `feat2`\r\n![Screenshot 2023-08-12 at 11 23 46 PM](https://github.com/ChainSafe/lodestar/assets/18608739/73303b10-b666-4830-802b-7aa327680260)\r\n\r\n#### `feat1`\r\n![Screenshot 2023-08-12 at 11 23 53 PM](https://github.com/ChainSafe/lodestar/assets/18608739/790edad8-aec9-46ab-a1bd-8c802e42d3b4)\r\n\r\n#### `beta`\r\n![Screenshot 2023-08-12 at 11 24 01 PM](https://github.com/ChainSafe/lodestar/assets/18608739/b2fe1840-6fa7-46f1-b2f9-360ee1eaa7bb)\r\n\r\n\r\n### `feat2-sm1v-ctvpss`\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat2-sm1v-ctvpss&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691814600000&to=1691901000000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cfeat1-sm1v-ctvpss&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\nhttps://grafana-lodestar.chainsafe.io/d/lodestar_vm_host/lodestar-vm-host?from=1691832600000&to=1691904600000&var-DS_PROMETHEUS=default&var-rate_interval=1h&var-Filters=instance%7C%3D%7Cbeta-sm1v-ctvpss&orgId=1&var-beacon_job=$%7BVAR_BEACON_JOB%7D\r\n\r\n#### `feat2`\r\n![Screenshot 2023-08-12 at 11 24 34 PM](https://github.com/ChainSafe/lodestar/assets/18608739/d513d4c7-57fb-4be0-ba61-81844099b572)\r\n\r\n#### `feat1`\r\n![Screenshot 2023-08-12 at 11 24 40 PM](https://github.com/ChainSafe/lodestar/assets/18608739/449b1088-b991-414a-8a35-02dec6c9feda)\r\n\r\n#### `beta`\r\n![Screenshot 2023-08-12 at 11 24 46 PM](https://github.com/ChainSafe/lodestar/assets/18608739/25eec984-7459-488d-804a-8697e358af01)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1676225833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1680009112",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1680009112",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1680009112,
    "node_id": "IC_kwDOCD5_Gc5kIueY",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-16T06:00:59Z",
    "updated_at": "2023-08-16T06:00:59Z",
    "author_association": "MEMBER",
    "body": "deployed `512mb` to `beta` at timestamp below.  Will pull metrics in a day after it stabilizes to see how they compare to `256mb` that was also on `beta`\r\n\r\n![Screenshot 2023-08-16 at 12 00 09 AM](https://github.com/ChainSafe/lodestar/assets/18608739/6e68c772-821e-42a8-bc27-cdb800cdf795)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1680009112/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1687860046",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1687860046",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1687860046,
    "node_id": "IC_kwDOCD5_Gc5kmrNO",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-22T09:52:55Z",
    "updated_at": "2023-08-22T09:52:55Z",
    "author_association": "MEMBER",
    "body": "Moving the new space to `512mb` was detrimental.  On mainnet the scavenge dropped but for some reason the mark-and-sweep started to climb considerably.  I am not sure of the phenomena here but it's not worth investigating.  \r\n\r\n![Screenshot 2023-08-22 at 5 27 38 AM](https://github.com/ChainSafe/lodestar/assets/18608739/2da5f5aa-2801-400a-b565-8347fa48021f)\r\n\r\nThe sweet spot for setting new space is at a value similar to the net rate at which objects are created/collected such that they exist in only the from space and do not get moved to the to space (as a net average) when collection occurs.  GC tends to drop a bit further (as a % of CPU time) up to roughly as threshold of two times the rate of object creation.  At this point though the space is so large that it tends to affect performance of the node, likely do to searching for objects during runtime.\r\n\r\nCurrent creation rate on `unstable-mainnet-hzax41`on a 30 day timeline with 7d `$rate_interval` is roughly `150mb`.  To keep the number to an even page interval a setting of `148mb` or `152mb` is recommended.\r\n\r\n![Screenshot 2023-08-22 at 5 38 07 AM](https://github.com/ChainSafe/lodestar/assets/18608739/e041df0d-a603-4e12-a6a9-dfa44ed65e0d)\r\n\r\nUsing a 6h `$rate_interval` to confirm makes those values seem appropriate for a first go.  We can reassess in another couple of weeks after setting to see how things proceed.\r\n\r\n![Screenshot 2023-08-22 at 5 42 33 AM](https://github.com/ChainSafe/lodestar/assets/18608739/eb1ff77b-461d-4a78-be88-0bab405090cf)\r\n\r\nThis value is set at the command line however it is possible to programmatically adjust it during startup from historical data.  The same is true of the new space adjustment for the network worker and assumptions made here apply to the worker as most of the scavenged garbage is network related.  This investigation started with #5829 and that fact was proven out there. As a note once the heap size is set at startup it is not possible to change the value in either case.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1687860046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1690731014",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2115#issuecomment-1690731014",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2115",
    "id": 1690731014,
    "node_id": "IC_kwDOCD5_Gc5kxoIG",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T22:33:51Z",
    "updated_at": "2023-08-23T22:33:51Z",
    "author_association": "MEMBER",
    "body": "Final not for reference:\r\n\r\n- A value that is too low results in excess scavenge GC time.\r\n- A value that is marginally too high results in node performance degradation from increased variable lookup time\r\n- A value that is very high results in mark-and-sweep collection (unknown reason because not researched further)\r\n\r\nTo set this value in the future run the node without setting a maxYoungGeneration size and see what the net scavenge collection rate is and set this to the same value.  See example in images above.  That value seems to be near the sweet spot.  If this methodology is refined in the future another note will be added below.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1690731014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
