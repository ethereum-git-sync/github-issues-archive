{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2631",
  "id": 911057208,
  "node_id": "MDU6SXNzdWU5MTEwNTcyMDg=",
  "number": 2631,
  "title": "Oonoonba sync - Invalid state root",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2021-06-04T02:47:35Z",
  "updated_at": "2021-06-09T14:31:34Z",
  "closed_at": "2021-06-09T14:31:34Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nGot this after we sync all the way to head\r\n```\r\nJun-04 02:45:20.080 [CHAIN]           error: Block error slot=14122 code=BLOCK_ERROR_PARENT_UNKNOWN, parentRoot=0x7b0e44370bc961b4a38d337ac0296c0395950fd4ff335e1225c1251f5c657f55\r\nError: BLOCK_ERROR_PARENT_UNKNOWN\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:38:11)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:11)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:38:48)\r\n    at Timeout._onTimeout (/usr/app/packages/lodestar/src/util/queue/index.ts:106:32)\r\n    at listOnTimeout (internal/timers.js:554:17)\r\n    at processTimers (internal/timers.js:497:7)\r\nJun-04 02:45:21.778 [CHAIN]           error: Block error slot=14122 code=BLOCK_ERROR_BEACON_CHAIN_ERROR, error={\"message\":\"Invalid state root\"}\r\nError: Invalid state root\r\n    at Object.stateTransition (/usr/app/packages/beacon-state-transition/src/allForks/stateTransition.ts:68:13)\r\n    at runStateTransition (/usr/app/packages/lodestar/src/chain/blocks/stateTransition.ts:86:30)\r\n    at processBlocksInEpoch (/usr/app/packages/lodestar/src/chain/blocks/process.ts:110:24)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:44:3)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:5)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:38:42)\r\n    at JobQueue.runJob (/usr/app/packages/lodestar/src/util/queue/index.ts:106:22)\r\nError: BLOCK_ERROR_BEACON_CHAIN_ERROR\r\n    at processBlocksInEpoch (/usr/app/packages/lodestar/src/chain/blocks/process.ts:151:11)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:44:3)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:5)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:38:42)\r\n    at JobQueue.runJob (/usr/app/packages/lodestar/src/util/queue/index.ts:106:22)\r\nJun-04 02:45:26.004 []                 info: Synced - finalized: 439 0x3fe0…ab21 - head: 14121 0x7b0e…7f55 - clockSlot: 14122 - peers: 2\r\n```\r\n\r\n**Expected behavior**\r\n\r\nNo error\r\n\r\n**Steps to Reproduce**\r\n\r\n`./bin/lodestar beacon --network oonoonba`",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/854325727",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-854325727",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 854325727,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NDMyNTcyNw==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-04T03:11:00Z",
    "updated_at": "2021-06-07T06:44:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "~~seems that this happens with docker sync only~~\r\n\r\nUpdate: ignore this",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/854325727/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/854337823",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-854337823",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 854337823,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NDMzNzgyMw==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-04T03:51:22Z",
    "updated_at": "2021-06-04T03:51:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "after a while it could process the same blocks and stay synced\r\n[beacon.log.bak.zip](https://github.com/ChainSafe/lodestar/files/6595639/beacon.log.bak.zip)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/854337823/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/854438948",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-854438948",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 854438948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NDQzODk0OA==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-04T07:29:05Z",
    "updated_at": "2021-06-04T07:33:03Z",
    "author_association": "MEMBER",
    "body": "Notable parts of the logs:\r\n- Our unknown parent root sync seems to stall if the first block is already known. So we are unable to catch up and need a full RangeSync to reach the head again\r\n- There are many \"invalid state root\" errors both getting the blocks from gossip and then getting the same from RangeSync. However eventually we can move forward.\r\n\r\n```\r\nJun-04 03:09:56.000 [CHAIN]         \u001B[36mverbose\u001B[39m: Clock slot slot=14245\r\nJun-04 03:09:56.000 [CHAIN]           \u001B[34mdebug\u001B[39m: Block pools:  pendingBlocks=0, currentSlot=14245\r\nJun-04 03:09:56.078 [NETWORK]       \u001B[36mverbose\u001B[39m: Received gossip block slot=14245\r\nJun-04 03:09:56.082 [CHAIN]           \u001B[31merror\u001B[39m: Block error slot=14245 code=BLOCK_ERROR_PARENT_UNKNOWN, parentRoot=0xd1882df259a549fbfd5e4bb71f95eff9ae85339729f2e0a4d49523934b93c72e\r\nError: BLOCK_ERROR_PARENT_UNKNOWN\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:38:11)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:11)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:38:48)\r\n    at Timeout._onTimeout (/usr/app/packages/lodestar/src/util/queue/index.ts:106:32)\r\n    at listOnTimeout (internal/timers.js:554:17)\r\n    at processTimers (internal/timers.js:497:7)\r\nJun-04 03:09:56.084 [CHAIN]           \u001B[34mdebug\u001B[39m: Add block to pool blockKey=0x643d4ea46a9968a72e890a33eccd807c57e2b05f03bdab0f87680daa29812ae8\r\nJun-04 03:09:56.086 [SYNC]          \u001B[36mverbose\u001B[39m: Finding block for unknown ancestor root parentRootHex=0xd1882df259a549fbfd5e4bb71f95eff9ae85339729f2e0a4d49523934b93c72e\r\nJun-04 03:09:56.086 [NETWORK]         \u001B[34mdebug\u001B[39m: Req  dialing peer method=beacon_blocks_by_root, encoding=ssz_snappy, agentVersion=teku/teku/v21.5.0+59-ga3cc317/linux-x86_64/-redhatinc-openjdk64bitservervm-java-16, peer=16...EAGj7C, requestId=470\r\nJun-04 03:09:56.313 [NETWORK]         \u001B[34mdebug\u001B[39m: Req  sending request method=beacon_blocks_by_root, encoding=ssz_snappy, agentVersion=teku/teku/v21.5.0+59-ga3cc317/linux-x86_64/-redhatinc-openjdk64bitservervm-java-16, peer=16...EAGj7C, requestId=470, requestBody=[\"0xd1882df259a549fbfd5e4bb71f95eff9ae85339729f2e0a4d49523934b93c72e\"]\r\nJun-04 03:09:56.316 [NETWORK]         \u001B[34mdebug\u001B[39m: Req  request sent method=beacon_blocks_by_root, encoding=ssz_snappy, agentVersion=teku/teku/v21.5.0+59-ga3cc317/linux-x86_64/-redhatinc-openjdk64bitservervm-java-16, peer=16...EAGj7C, requestId=470\r\nJun-04 03:09:56.592 [NETWORK]       \u001B[36mverbose\u001B[39m: Req  done method=beacon_blocks_by_root, encoding=ssz_snappy, agentVersion=teku/teku/v21.5.0+59-ga3cc317/linux-x86_64/-redhatinc-openjdk64bitservervm-java-16, peer=16...EAGj7C, requestId=470\r\nJun-04 03:09:56.592 [SYNC]          \u001B[36mverbose\u001B[39m: Found UnknownBlockRoot parentRootHex=0xd1882df259a549fbfd5e4bb71f95eff9ae85339729f2e0a4d49523934b93c72e\r\nJun-04 03:09:56.621 [CHAIN]         \u001B[36mverbose\u001B[39m: Block processed slot=14244, root=0xd1882df259a549fbfd5e4bb71f95eff9ae85339729f2e0a4d49523934b93c72e\r\nJun-04 03:09:56.622 [CHAIN]         \u001B[36mverbose\u001B[39m: New chain head headSlot=14244, headRoot=0xd1882df259a549fbfd5e4bb71f95eff9ae85339729f2e0a4d49523934b93c72e\r\nJun-04 03:09:56.630 [CHAIN]           \u001B[34mdebug\u001B[39m: Attestation processed slot=14243, index=0, targetRoot=0x401533d5acc60a6051f4102b64d50b67a555424c408ed73439e92a9f6b50eafe, aggregationBits=0xffffffffffffffffff0f\r\nJun-04 03:09:56.670 [CHAIN]           \u001B[31merror\u001B[39m: Block error slot=14245 code=BLOCK_ERROR_BEACON_CHAIN_ERROR, error={\"message\":\"Invalid state root\"}\r\nError: Invalid state root\r\n    at Object.stateTransition (/usr/app/packages/beacon-state-transition/src/allForks/stateTransition.ts:68:13)\r\n    at runStateTransition (/usr/app/packages/lodestar/src/chain/blocks/stateTransition.ts:86:30)\r\n    at processBlocksInEpoch (/usr/app/packages/lodestar/src/chain/blocks/process.ts:110:24)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:44:3)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:5)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:38:42)\r\n    at JobQueue.runJob (/usr/app/packages/lodestar/src/util/queue/index.ts:106:22)\r\nError: BLOCK_ERROR_BEACON_CHAIN_ERROR\r\n    at processBlocksInEpoch (/usr/app/packages/lodestar/src/chain/blocks/process.ts:151:11)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:44:3)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:5)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:38:42)\r\n    at JobQueue.runJob (/usr/app/packages/lodestar/src/util/queue/index.ts:106:22)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/854438948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/855666900",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-855666900",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 855666900,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NTY2NjkwMA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-07T07:23:27Z",
    "updated_at": "2021-06-07T07:23:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "These 2 errors actually have the same root cause: we cannot process a block after fetching it from `pendingBlock` db, and the pending blocks stay in `pendingBlock` db forever.\r\n\r\nIn the above log, 14255 came missing parent root, it' saved to `pendingBlocks` db, node fetched and processed the parent - 14244 successfully, then it fetched back 14255 from `pendingBlocks` db and it failed to process with `Invalid state root` error and it stayed in `pendingBlocks` db. From now all gossip blocks after 14255 comes to `pendingBlocks` db with `UNKNOWN_PARENT` error and couldn't be processed, it tried to get missing ancestor root which is 14244 and got `BLOCK_ERROR_BLOCK_IS_ALREADY_KNOWN` error.\r\n\r\nIf a gossip block come without being persisted to `pendingBlocks` db, it's fine to process and the node could be syned due to that.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/855666900/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/856372454",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-856372454",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 856372454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NjM3MjQ1NA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T01:36:45Z",
    "updated_at": "2021-06-08T01:36:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Update: this `Invalid state root` issue also happen with `processChainSegment`\r\n```\r\nJun-08 02:53:25.747 [SYNC]          verbose: Batch process error id=Finalized, startEpoch=1023, status=Processing code=BLOCK_ERROR_BEACON_CHAIN_ERROR, error={\"message\":\"Invalid state root\"}\r\nError: Invalid state root\r\n    at Object.stateTransition (/root/workspace/node/lodestar/packages/beacon-state-transition/src/allForks/stateTransition.ts:66:13)\r\n    at runStateTransition (/root/workspace/node/lodestar/packages/lodestar/src/chain/blocks/stateTransition.ts:83:30)\r\n    at processBlocksInEpoch (/root/workspace/node/lodestar/packages/lodestar/src/chain/blocks/process.ts:110:24)\r\n    at processChainSegment (/root/workspace/node/lodestar/packages/lodestar/src/chain/blocks/process.ts:79:7)\r\n    at processChainSegmentJob (/root/workspace/node/lodestar/packages/lodestar/src/chain/blocks/processor.ts:144:3)\r\n    at Object.job (/root/workspace/node/lodestar/packages/lodestar/src/chain/blocks/processor.ts:42:42)\r\n    at Timeout._onTimeout (/root/workspace/node/lodestar/packages/lodestar/src/util/queue/index.ts:106:22)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/856372454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/856488754",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-856488754",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 856488754,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NjQ4ODc1NA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T06:29:35Z",
    "updated_at": "2021-06-08T06:29:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "when we refetch a pending block from db, it's actually a struct and we have an issue with `hashTreeRoot` regarding `BitVectorType`, see #2648 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/856488754/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/856659325",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-856659325",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 856659325,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NjY1OTMyNQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T10:48:57Z",
    "updated_at": "2021-06-08T10:48:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "We always have `Invalid state root` issue with block 32768 of oonoonba network so I downloaded it\r\n[signed_block_32768.zip](https://github.com/ChainSafe/lodestar/files/6615809/signed_block_32768.zip)\r\n[pre_state_32767.zip](https://github.com/ChainSafe/lodestar/files/6615810/pre_state_32767.zip)\r\n[post_state_32768.zip](https://github.com/ChainSafe/lodestar/files/6615813/post_state_32768.zip)\r\n\r\n+ `post_state_32768` has the invalid root\r\n+ if I reprocess the signed block 32768 with pre state 32767, I don't see the issue\r\n+ comparing the resulting state and `post_state_32768`, the only difference is `balances` and it happens with most of validator\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/856659325/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/857321122",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2631#issuecomment-857321122",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2631",
    "id": 857321122,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NzMyMTEyMg==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T02:25:28Z",
    "updated_at": "2021-06-09T02:25:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "the root cause is we compute the next sync committee indices at wrong place - when rotating epoch. At that time the epoch in the state is increased already and we have different active validator indices https://github.com/ChainSafe/lodestar/blob/8e5c09c2ed432186d238c4c50a5aac7da07e0257/packages/beacon-state-transition/src/allForks/util/epochContext.ts#L265\r\n\r\nat that time we should simply get sync committee indices from the available next sync committee pubkeys calculated at previous epoch transition (at sync committee period boundary)",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/857321122/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
