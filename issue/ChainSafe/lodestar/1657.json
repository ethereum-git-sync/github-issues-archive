{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/1657",
  "id": 719231234,
  "node_id": "MDU6SXNzdWU3MTkyMzEyMzQ=",
  "number": 1657,
  "title": "Forkchoice head does not seem right after initial sync",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-12T09:39:33Z",
  "updated_at": "2020-11-19T23:43:40Z",
  "closed_at": "2020-11-19T23:43:40Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nAfter initial sync, we processed up to slot 495550. Right after that we start regular sync and head slot is at 495327.\r\n\r\n```\r\n2020-10-12 16:13:33 [SYNC]             ^[[32minfo^[[39m: Imported blocks for slots: 495520,495521,495524,495525,      495526,495527,495528,495529,495530,495531,495533,495534,495535,495539,495540,495543,495544,495547,495548,495549,      495550\r\n  368 2020-10-12 16:13:35 [CHAIN]         ^[[36mverbose^[[39m: Checkpoint processed epoch=15485, root=0x6ab0c7a7159257      cd51e87b483af63996f5fd64c69a528e0875181566ea2d7e17\r\n  369 2020-10-12 16:13:35 [SYNC]             ^[[32minfo^[[39m: Sync progress currentEpoch=15485, targetEpoch=15485, sp      eed=2.0 slots/s, estimatedTillComplete=0 hours\r\n  370 2020-10-12 16:13:35 [SYNC]             ^[[32minfo^[[39m: Reach common finalized checkpoint at epoch 15485\r\n  371 2020-10-12 16:13:35 [SYNC]             ^[[32minfo^[[39m: initial sync stop\r\n  372 2020-10-12 16:13:35 [CHAIN]           ^[[34mdebug^[[39m: Block processed slot=495520, root=0x6ab0c7a7159257cd51e      87b483af63996f5fd64c69a528e0875181566ea2d7e17\r\n  373 2020-10-12 16:13:36 [SYNC]             ^[[32minfo^[[39m: initial sync stop\r\n  374 2020-10-12 16:13:36 [CHAIN]           ^[[34mdebug^[[39m: Block processed slot=495521, root=0x6e7a8d9527110d78952      fe60de5cb20b691556fb05d0dfdd94c24e6d9c8823bd0\r\n  375 2020-10-12 16:13:36 [SYNC]             ^[[32minfo^[[39m: Started regular syncing currentSlot=495667, headSlot=49      5327\r\n```\r\n\r\nThe result of that is Regular Sync tried to fetch an old range `495328-495347` which we had blocks already.\r\n\r\n```\r\n2020-10-12 16:13:48 [SYNC]             ^[[32minfo^[[39m: Regular Sync: Found best peer 16Uiu2HAmFYMVzKz9wC2JfiMP      ZodA322v5iV9HAwnETnwHM5m53Gy peerHeadSlot=495662, currentSlot=495668\r\n  800 2020-10-12 16:13:48 [SYNC]             ^[[32minfo^[[39m: Regular Sync: Setting target newTargetSlot=495347\r\n  801 2020-10-12 16:13:48 [SYNC]             ^[[32minfo^[[39m: Regular Sync: Requesting blocks from slot 495328 to slo      t 495347\r\n```\r\n\r\nAlthough I can still catch up with head slot using `unknownBlockRoot` event, this is not nice.\r\n\r\n**Expected behavior**\r\nHead slot should normally around 495550 at the time of starting regular sync.\r\n",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/707098339",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1657#issuecomment-707098339",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657",
    "id": 707098339,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzA5ODMzOQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-12T12:46:18Z",
    "updated_at": "2020-10-12T12:46:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "So initial sync was started with the same head\r\n```\r\n2020-10-12 16:12:43 [SYNC]             ^[[32minfo^[[39m: Starting initial syncing\r\n   101 2020-10-12 16:12:44 [SYNC]             ^[[32minfo^[[39m: Start initial sync from finalized slot 495327\r\n   102 2020-10-12 16:12:44 [SYNC]             ^[[32minfo^[[39m: Fetching blocks for 495328...495391 slot range\r\n```\r\n\r\nIt means that the same head hasn't changed during the whole initial sync",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/707098339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/707121660",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1657#issuecomment-707121660",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657",
    "id": 707121660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzEyMTY2MA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-12T13:30:45Z",
    "updated_at": "2020-10-12T13:30:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "so from slot 495328 to 495550, corresponding states has lower finalized epoch, that's why it does not update finalized checkpoint in forkchoice and forkchoice does not update bestChild/bestDescendant\r\n```\r\n2020-10-12 16:12:46 [NETWORK]       ^[[36mverbose^[[39m: receive status response with 1 chunks from 16Uiu2HAmEPB       jHgMH4YZeNMFsMC6wrGWKcJR6uFL5j8oahyG2NKzz requestId=9fecc8b8c31e7ebe, encoding=ssz_snappy, body={\"forkDigest\":\"0       xe7a75d5a\",\"finalizedRoot\":\"0xd83d7fca8df089c868331a2a1e1f1e1d3b1b9ae429a56737c59843c28fb1b693\",\"finalizedEpoch\"       :\"15479\",\"headRoot\":\"0xd83d7fca8df089c868331a2a1e1f1e1d3b1b9ae429a56737c59843c28fb1b693\",\"headSlot\":\"495327\"}\r\n```\r\nonly get new head from slot 495552\r\n```\r\n20260 2020-10-12 16:19:12 [CHAIN]         ^[[36mverbose^[[39m: Fork choice justified epoch=15484, root=0x97bbb26bf1a00       38d9c99e7a7347577c801ed61e22e67a5d086c7978ca6a73d36\r\n 20261 2020-10-12 16:19:12 [CHAIN]         ^[[36mverbose^[[39m: Checkpoint processed epoch=15486, root=0xd64b6d69ba1fd0       50b5e7074a4e427eda7365c5d4fa4fc738c9a524e786d356c4\r\n 20262 2020-10-12 16:19:12 [CHAIN]           ^[[34mdebug^[[39m: Block processed slot=495552, root=0xd64b6d69ba1fd050b5e       7074a4e427eda7365c5d4fa4fc738c9a524e786d356c4\r\n 20263 2020-10-12 16:19:12 [CHAIN]         ^[[36mverbose^[[39m: New chain head headSlot=495552, headRoot=0xd64b6d69ba1f       d050b5e7074a4e427eda7365c5d4fa4fc738c9a524e786d356c4\r\n 20264 2020-10-12 16:19:12 [CHAIN]            ^[[32minfo^[[39m: Checkpoint justified epoch=15484, root=0x97bbb26bf1a003       8d9c99e7a7347577c801ed61e22e67a5d086c7978ca6a73d36\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/707121660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/711092565",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1657#issuecomment-711092565",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1657",
    "id": 711092565,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTA5MjU2NQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-17T23:19:38Z",
    "updated_at": "2020-10-17T23:19:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "with the current Medalla, I started from block 499648 and only get new head from 500629, after that I see new head happened regularly.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/711092565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
