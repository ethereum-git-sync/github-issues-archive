{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/1196",
  "id": 663837248,
  "node_id": "MDU6SXNzdWU2NjM4MzcyNDg=",
  "number": 1196,
  "title": "refactor (some) modules to respect the \"start should resolve quickly\" interface",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090446,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ2",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-medium",
      "name": "prio-medium",
      "color": "fdc09f",
      "default": false,
      "description": "Resolve this some time soon (tm)."
    },
    {
      "id": 1478321239,
      "node_id": "MDU6TGFiZWwxNDc4MzIxMjM5",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-discussion",
      "name": "meta-discussion",
      "color": "a6bddb",
      "default": false,
      "description": "Indicates a topic that requires input from various developers."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-07-22T15:09:11Z",
  "updated_at": "2021-03-18T16:34:19Z",
  "closed_at": "2021-03-18T16:34:19Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Follow up of https://github.com/ChainSafe/lodestar/pull/1179. At least the `sync` module should be refactored so it's start function resolves after the critical initial steps are completed.\r\n\r\nBut then: **How are the long-running processes handled**? How do they do error handling and communication with the top instance consumer or main process?\r\n\r\nAs of now most NodeJS versions and browsers log unhandled rejections but don't stop the main process. There should be some way for this long-running process to tell the main process to panic. But, how can we do that in a browser & NodeJS friendly way?\r\n\r\n----\r\n\r\nRelevant code snippets\r\nhttps://github.com/ChainSafe/lodestar/blob/5e8af2502c2716daa4efe90341d2a3923ded9d13/packages/lodestar/src/node/nodejs.ts#L151-L154\r\n\r\nhttps://github.com/ChainSafe/lodestar/blob/5e8af2502c2716daa4efe90341d2a3923ded9d13/packages/lodestar/src/eth1/impl/ethers.ts#L85-L86\r\n\r\nhttps://github.com/ChainSafe/lodestar/blob/5e8af2502c2716daa4efe90341d2a3923ded9d13/packages/lodestar/src/eth1/impl/ethers.ts#L104-L109\r\n\r\nhttps://github.com/ChainSafe/lodestar/blob/5e8af2502c2716daa4efe90341d2a3923ded9d13/packages/lodestar/src/chain/blocks/processor.ts#L61-L64\r\n\r\n----\r\n\r\nIMO the takeaway of PR https://github.com/ChainSafe/lodestar/pull/1179 should be:\r\n1. Determine root causes of problems here (eg: needing an error-handling strategy for long-running processes)\r\n2. Document problem areas in the code (there are a handful here)\r\n3. Eslint rule in place to prevent further unhandled rejections\r\n\r\nIn the problem cases, just add an eslint-disable line for now and document the specific case. Don't try to add hacks that just mask the problem, it won't really get us towards our goal. A real solution is bigger than can be solved here, likely involves refactoring in some small or large way.\r\n\r\n_Originally posted by @wemeetagain in https://github.com/ChainSafe/lodestar/pull/1179#discussion_r458841614_",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/706474568",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1196#issuecomment-706474568",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196",
    "id": 706474568,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjQ3NDU2OA==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2020-10-10T02:57:10Z",
    "updated_at": "2020-10-10T02:57:10Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed in 7 days if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/706474568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/710781972",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1196#issuecomment-710781972",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1196",
    "id": 710781972,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMDc4MTk3Mg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2020-10-17T09:17:34Z",
    "updated_at": "2020-10-17T09:17:34Z",
    "author_association": "NONE",
    "body": "This issue or pull request has been automatically been closed due to inactivity.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/710781972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
