{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5513",
  "id": 1718774795,
  "node_id": "I_kwDOCD5_Gc5mcmwL",
  "number": 5513,
  "title": "Investigate high block processor time",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2963898184,
      "node_id": "MDU6TGFiZWwyOTYzODk4MTg0",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-performance",
      "name": "scope-performance",
      "color": "980043",
      "default": false,
      "description": "Performance issue and ideas to improve performance."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-05-22T02:29:07Z",
  "updated_at": "2023-05-24T08:58:02Z",
  "closed_at": "2023-05-24T08:58:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nThis is on a mainnet node, after capella block processor time is high for some blocks\r\n\r\n<img width=\"1295\" alt=\"Screenshot 2023-05-22 at 09 25 47\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/d8dc0f51-08f3-4578-a30b-13704d4fa6ec\">\r\n\r\nis this due to high withdrawals on these blocks?\r\n\r\n**Expected behavior**\r\n\r\n- Track withdrawals per block in a metric\r\n- If it's not due to withdrawals per block, add more metrics/debugs to figure out the reason\r\n- Make sure block processor time is <100ms consistently",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1559956876",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5513#issuecomment-1559956876",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513",
    "id": 1559956876,
    "node_id": "IC_kwDOCD5_Gc5c-w2M",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-23T18:40:23Z",
    "updated_at": "2023-05-23T18:40:23Z",
    "author_association": "MEMBER",
    "body": "@tuyennhv for this type of issues switch to heatmap and render the % of samples above a certain threshold. The timeline chart of average does not accurately signal the relevance of this issue",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1559956876/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1560593872",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5513#issuecomment-1560593872",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513",
    "id": 1560593872,
    "node_id": "IC_kwDOCD5_Gc5dBMXQ",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-24T07:29:32Z",
    "updated_at": "2023-05-24T07:29:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dapplion I get what you mean but this is 1m chart and since we have 12s between blocks and a scrape duration of 10s this chart shows good result to some degree in a very short time :). More over bucket for this metric jump from 0.1s to 1s so you'll see no issue there\r\n\r\non each node it shows high block process time on random slots, number of withdrawals are 16 most of the time it's not likely a performance issue in state transition code, could be `gc` runs during state transition",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1560593872/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1560719426",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5513#issuecomment-1560719426",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5513",
    "id": 1560719426,
    "node_id": "IC_kwDOCD5_Gc5dBrBC",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-24T08:58:01Z",
    "updated_at": "2023-05-24T08:58:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is not an issue in current `unstable` since network thread is in\r\n\r\n<img width=\"1291\" alt=\"Screenshot 2023-05-24 at 15 56 24\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/3f1f42a8-c1d8-47eb-b1c4-a054c72221dc\">\r\n\r\nand we have way better `gc` metric\r\n\r\n<img width=\"789\" alt=\"Screenshot 2023-05-24 at 15 56 55\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/a8ce0d35-bc4a-405b-9da9-a70c5969792e\">\r\n\r\nshould be fixed in v1.9",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1560719426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
