{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4048",
  "id": 1245907192,
  "node_id": "I_kwDOCD5_Gc5KQwj4",
  "number": 4048,
  "title": "Nightly build published wrong commit to docker",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-05-24T02:47:56Z",
  "updated_at": "2022-05-24T08:12:52Z",
  "closed_at": "2022-05-24T08:12:52Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nRight now in master very few AggregateAndProof messages are ignored\r\n\r\n<img width=\"809\" alt=\"Screen Shot 2022-05-24 at 09 45 08\" src=\"https://user-images.githubusercontent.com/10568965/169938132-804cfbe5-2905-487c-9f2c-d23d9a64f7dc.png\">\r\n\r\n\r\n**Expected behavior**\r\n\r\nThe percentage of seen AggregateAndProof should be up to 70% as monitored in #4019\r\n",
  "closed_by": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135370748",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4048#issuecomment-1135370748",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048",
    "id": 1135370748,
    "node_id": "IC_kwDOCD5_Gc5DrGH8",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-24T03:47:28Z",
    "updated_at": "2022-05-24T03:47:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "+ docker image is really at `next` version:\r\n```\r\ndevops@contabo-16:~$ docker pull chainsafe/lodestar:next\r\nnext: Pulling from chainsafe/lodestar\r\nDigest: sha256:aa433da253ecd5f48a251c696c5b8d307beab5c4c47f61c870d63ec4b0dc26b0\r\nStatus: Image is up to date for chainsafe/lodestar:next\r\ndocker.io/chainsafe/lodestar:next\r\n```\r\n\r\n+ the above digest is really what we built in https://github.com/ChainSafe/lodestar/runs/6521655159?check_suite_focus=true\r\n```\r\n#11 pushing manifest for docker.io/chainsafe/lodestar:next@sha256:aa433da253ecd5f48a251c696c5b8d307beab5c4c47f61c870d63ec4b0dc26b0 0.2s done\r\n```\r\n\r\n+ confirm again in dockerhub: https://hub.docker.com/layers/chainsafe/lodestar/next/images/sha256-aa433da253ecd5f48a251c696c5b8d307beab5c4c47f61c870d63ec4b0dc26b0?context=explore\r\n\r\n+ when I inspect the image, it contains old version\r\n```\r\n/usr/app/node_modules/@chainsafe/lodestar $ cat package.json | grep version\r\n  \"version\": \"0.37.0-dev.fbfae0c4a0\",\r\n```\r\n\r\nit also does not contain the `seenAggregateAndProof.js` file.\r\n```\r\n/usr/app/node_modules/@chainsafe/lodestar/lib/chain/seenCache $ ls\r\nindex.d.ts                        seenAttesters.js.map              seenCommittee.js\r\nindex.js                          seenBlockProposers.d.ts           seenCommittee.js.map\r\nindex.js.map                      seenBlockProposers.js             seenCommitteeContribution.d.ts\r\nseenAttesters.d.ts                seenBlockProposers.js.map         seenCommitteeContribution.js\r\nseenAttesters.js                  seenCommittee.d.ts                seenCommitteeContribution.js.map\r\n```\r\n\r\n+ however grafana shows correct version\r\n\r\n<img width=\"1612\" alt=\"Screen Shot 2022-05-24 at 10 41 57\" src=\"https://user-images.githubusercontent.com/10568965/169944322-2bf297db-9935-4d8d-8440-6417eb38ae92.png\">\r\n\r\nthat's because the `.git-data.json` is correct\r\n```\r\n/usr/app/node_modules/@chainsafe/lodestar-cli $ cat .git-data.json\r\n{\r\n  \"branch\": \"master\",\r\n  \"commit\": \"ef9528aa5900a36952c89f749b1d126b056382e7\"\r\n}\r\n```\r\n\r\n\r\n=> we should investigate why `.git-data.json` is correct while the content in the docker image contains the commit before latest (current is `fbfae0c4a0`, expect `ef9528a`)",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135370748/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135373234",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4048#issuecomment-1135373234",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048",
    "id": 1135373234,
    "node_id": "IC_kwDOCD5_Gc5DrGuy",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-24T03:53:20Z",
    "updated_at": "2022-05-24T03:53:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "copying the commit order here:\r\n```\r\ngit log --oneline\r\n\r\nef9528aa59 (HEAD -> master, origin/master, origin/HEAD) Ignore gossip AggregateAndProof if aggregate is seen (#4019)\r\nfbfae0c4a0 Throw a more informative error on invalid keystore (#4022)\r\nb6e0dc2010 Modify gossipsub params following consensus spec v1.1.10 (#4011)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135373234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135387076",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4048#issuecomment-1135387076",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048",
    "id": 1135387076,
    "node_id": "IC_kwDOCD5_Gc5DrKHE",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-24T04:19:08Z",
    "updated_at": "2022-05-24T04:19:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "the npm version published from https://github.com/ChainSafe/lodestar/runs/6521604030?check_suite_focus=true was good\r\n\r\n```\r\nnpm i @chainsafe/lodestar@0.37.0-dev.ef9528aa59\r\n\r\ncat node_modules/\\@chainsafe/lodestar/package.json | grep version\r\n\"version\": \"0.37.0-dev.ef9528aa59\"\r\n```\r\n\r\nrefer to https://www.npmjs.com/package/@chainsafe/lodestar/v/0.37.0-dev.ef9528aa59",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135387076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135478310",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4048#issuecomment-1135478310",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4048",
    "id": 1135478310,
    "node_id": "IC_kwDOCD5_Gc5DrgYm",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-24T06:50:11Z",
    "updated_at": "2022-05-24T06:50:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "just inspect the lodestar container, lodestar-cli was at correct version (`ef9528aa59`):\r\n```\r\n\"version\": \"0.37.0-dev.ef9528aa59\"\r\n...\r\n\"dependencies\": {\r\n...\r\n\"@chainsafe/lodestar\": \"^0.37.0-dev.ef9528aa59\",\r\n \"@chainsafe/lodestar-api\": \"^0.37.0-dev.ef9528aa59\",\r\n...\r\n```\r\n\r\nnotice that generated package.json of lodestar-cli specified semver compatible (with a ^), that's why npm installed the old commit (probably npm thought `0.37.0-dev.fbfae0c4a0` is compatible to `^0.37.0-dev.ef9528aa59`)\r\n\r\n```\r\n{\r\n  \"name\": \"@chainsafe/lodestar\",\r\n  \"description\": \"A Typescript implementation of the beacon chain\",\r\n...\r\n\"version\": \"0.37.0-dev.fbfae0c4a0\",\r\n```\r\n\r\nthe generated `package.json` of lodestar-cli should specify exact version instead of semver.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1135478310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
