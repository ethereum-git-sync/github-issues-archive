{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5732",
  "id": 1792988215,
  "node_id": "I_kwDOCD5_Gc5q3tQ3",
  "number": 5732,
  "title": "Lodestar has more than 55 peers",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2155825090,
      "node_id": "MDU6TGFiZWwyMTU1ODI1MDkw",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-networking",
      "name": "scope-networking",
      "color": "980043",
      "default": false,
      "description": "All issues related to networking, gossip, and libp2p."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/30",
    "html_url": "https://github.com/ChainSafe/lodestar/milestone/30",
    "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/milestones/30/labels",
    "id": 9375506,
    "node_id": "MI_kwDOCD5_Gc4Ajw8S",
    "number": 30,
    "title": "v1.10.0",
    "description": "",
    "creator": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 1,
    "closed_issues": 15,
    "state": "open",
    "created_at": "2023-05-09T04:09:47Z",
    "updated_at": "2023-08-01T14:08:52Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2023-07-07T07:44:50Z",
  "updated_at": "2023-08-03T07:53:06Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nAfter we upgrade to libp2p 0.45.9, there are more than 55 peers\r\n\r\n<img width=\"1310\" alt=\"Screenshot 2023-07-07 at 14 43 48\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/2c84e03e-e186-403b-928c-a5bf92ff5d3f\">\r\n\r\ncc @wemeetagain \n\n### Expected behavior\n\nnode should consistently have 50 - 55 peers\n\n### Steps to reproduce\n\n_No response_\n\n### Additional context\n\n_No response_\n\n### Operating system\n\nLinux\n\n### Lodestar version or commit hash\n\n7280234",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1662196787",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5732#issuecomment-1662196787",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732",
    "id": 1662196787,
    "node_id": "IC_kwDOCD5_Gc5jExwz",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-02T13:17:02Z",
    "updated_at": "2023-08-02T13:17:02Z",
    "author_association": "MEMBER",
    "body": "I don't know if I would consider this an issue anymore @tuyennhv seeing as we want to increase it to 100-110 via #5799, but if it has to do with some issue on the peer manager, we should be more specific about it in this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1662196787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1663223187",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5732#issuecomment-1663223187",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732",
    "id": 1663223187,
    "node_id": "IC_kwDOCD5_Gc5jIsWT",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T02:59:20Z",
    "updated_at": "2023-08-03T02:59:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "this issue happens quite randomly, this is on a real mainnet node running almost `v1.10.0-rc.1`, the peers are consistently at around 60 in the last 2 days\r\n\r\n<img width=\"806\" alt=\"Screenshot 2023-08-03 at 09 55 50\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/a7977bd8-02ee-4a13-8a05-6efb97d41ec5\">\r\n\r\n\r\ntopic peers keep increasing, and it's all because of incoming peers\r\n\r\n<img width=\"790\" alt=\"Screenshot 2023-08-03 at 09 57 20\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/6aeae4df-d900-4b33-b48d-f5e70c0d185a\">\r\n\r\n<img width=\"798\" alt=\"Screenshot 2023-08-03 at 09 57 28\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/2abaaeac-7b28-4711-927c-b539921f7ed1\">\r\n\r\n\r\nit causes event loop lag to keep increasing cc @philknows \r\n<img width=\"1590\" alt=\"Screenshot 2023-08-03 at 09 58 41\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/8827d0ac-9462-4825-af77-4627e66199d1\">\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1663223187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1663467230",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5732#issuecomment-1663467230",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5732",
    "id": 1663467230,
    "node_id": "IC_kwDOCD5_Gc5jJn7e",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T07:53:06Z",
    "updated_at": "2023-08-03T07:53:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Previously we count on libp2p which prune connections per new one connected. Now we count on peer manager heartbeat which run every 30s so we can't get connections to 50-55 peers consistently given peers connected to this node quite frequently\r\n\r\n- Peer Manager does good job to remove ~20 peers per minute (= ~10 peers per heart beat, which is 60 - `targetPeers`)\r\n\r\n<img width=\"962\" alt=\"Screenshot 2023-08-03 at 14 45 48\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/f7ce9185-202f-44c4-aae9-796fb5d5084c\">\r\n\r\n- However peers want to connect to this node quite frequently (~0/3x per sec = ~20 peers per minute)\r\n\r\n<img width=\"782\" alt=\"Screenshot 2023-08-03 at 14 47 49\" src=\"https://github.com/ChainSafe/lodestar/assets/10568965/1458ad13-5cd2-4d58-9b46-a4a27fa7c5d7\">\r\n\r\n- libp2p-tcp is supposed not to listen for inbound connections if there are > 55 peers however there is a bug there, see https://github.com/libp2p/js-libp2p/issues/1927\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1663467230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
