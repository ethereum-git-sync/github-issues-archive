{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4330",
  "id": 1310316061,
  "node_id": "I_kwDOCD5_Gc5OGdYd",
  "number": 4330,
  "title": "Gossipsub: IWANT received we don't have",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090446,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ2",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-medium",
      "name": "prio-medium",
      "color": "fdc09f",
      "default": false,
      "description": "Resolve this some time soon (tm)."
    },
    {
      "id": 2155825090,
      "node_id": "MDU6TGFiZWwyMTU1ODI1MDkw",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-networking",
      "name": "scope-networking",
      "color": "980043",
      "default": false,
      "description": "All issues related to networking, gossip, and libp2p."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-07-20T02:31:43Z",
  "updated_at": "2022-09-23T01:54:30Z",
  "closed_at": "2022-09-23T01:54:30Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nAfter v0.36.0, there are a lot of IWANT messages received that we don't have messages to response. Note that this likely causes broken promises and we'll get P7 penalty and may get pruned by our peers. As a result:\r\n- we may have less mesh peers\r\n- backoff cache size is increased since peers prune us from their meshes more frequently\r\n\r\n- v0.36.0 - contabo-0\r\n<img width=\"1239\" alt=\"Screen Shot 2022-07-20 at 09 17 45\" src=\"https://user-images.githubusercontent.com/10568965/179881660-d45f6cde-bbeb-4030-98dc-d7429fd08190.png\">\r\n\r\n- v0.36.0 - contabo-20\r\n<img width=\"1267\" alt=\"Screen Shot 2022-07-20 at 09 18 31\" src=\"https://user-images.githubusercontent.com/10568965/179881787-5c369334-df92-4c54-bd11-c93d421c25e9.png\">\r\n\r\n- v0.41.0 - contabo-12\r\n\r\n<img width=\"1245\" alt=\"Screen Shot 2022-07-20 at 09 19 14\" src=\"https://user-images.githubusercontent.com/10568965/179881885-8583c879-4e2c-4e23-8657-16739566d6d3.png\">\r\n\r\n- v0.41.0 - contabo-11\r\n<img width=\"1222\" alt=\"Screen Shot 2022-07-20 at 09 20 53\" src=\"https://user-images.githubusercontent.com/10568965/179882070-5958b873-334c-4e72-88bc-6354d69ed48d.png\">\r\n\r\n\r\n\r\n**Expected behavior**\r\n\r\nAfter gossiping message ids to peers, we should be able to serve IWANT messages right after that. Expect a very small % of messages we can't serve due to messages being pruned.\r\n\r\n**Steps to Reproduce**\r\n\r\nMonitor Prater nodes",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1189753537",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4330#issuecomment-1189753537",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330",
    "id": 1189753537,
    "node_id": "IC_kwDOCD5_Gc5G6jLB",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-20T03:02:43Z",
    "updated_at": "2022-07-20T03:02:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "this could be due to the result of #4011 in v0.37.0\r\n- old mcacheLength is 5 and with a heartbeat interval of 1s => we keep message ids in mcache for 5s\r\n- new mcacheLength is 6 and with heartbeat interval of 0.7s => we keep message ids in mcache for 4.2s",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1189753537/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1255722184",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4330#issuecomment-1255722184",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4330",
    "id": 1255722184,
    "node_id": "IC_kwDOCD5_Gc5K2MzI",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-23T01:54:30Z",
    "updated_at": "2022-09-23T01:54:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "root cause could be https://github.com/ChainSafe/lodestar/pull/4427\r\n\r\nv1.0.0\r\n<img width=\"1273\" alt=\"Screen Shot 2022-09-23 at 08 53 26\" src=\"https://user-images.githubusercontent.com/10568965/191879088-3930230a-1dd6-45e9-b298-05a701f7bdb0.png\">\r\n\r\nv1.1.0 rc.0\r\n<img width=\"1251\" alt=\"Screen Shot 2022-09-23 at 08 54 06\" src=\"https://user-images.githubusercontent.com/10568965/191879139-78e203f3-fb70-4bea-a04d-13d326bb4aa1.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1255722184/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
