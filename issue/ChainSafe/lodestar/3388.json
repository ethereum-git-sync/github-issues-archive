{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3388",
  "id": 1034584091,
  "node_id": "I_kwDOCD5_Gc49qoAb",
  "number": 3388,
  "title": "Lodestar-besu error - BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-10-25T01:34:42Z",
  "updated_at": "2022-02-04T10:03:43Z",
  "closed_at": "2022-02-04T10:03:42Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nNode is out of synced:\r\n```\r\nOct-25 01:33:19.037 [CHAIN]           error: Block error slot=60943, errCode=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID code=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\nError: BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\n    at verifyBlockStateTransition (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:167:15)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at verifyBlock (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:38:10)\r\n    at processChainSegment (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/index.ts:101:34)\r\n    at JobItemQueue.runJob (/usr/app/node_modules/@chainsafe/lodestar/src/util/queue/itemQueue.ts:85:22)\r\nOct-25 01:33:28.243 [CHAIN]           error: Block error slot=60943, errCode=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID code=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\nError: BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\n    at verifyBlockStateTransition (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:167:15)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at verifyBlock (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:38:10)\r\n    at processChainSegment (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/index.ts:101:34)\r\n    at JobItemQueue.runJob (/usr/app/node_modules/@chainsafe/lodestar/src/util/queue/itemQueue.ts:85:22)\r\nOct-25 01:33:32.337 []                 info: Syncing - 44000000 days left - 3.99e-9 slots/s - slot: 76042 (skipped 15101) - head: 60941 0x6d96…16b9 - finalized: 0x5072…6107:1902 - peers: 13\r\n```\r\n\r\n**Expected behavior**\r\n\r\nNo error\r\n\r\n**Steps to Reproduce**\r\n\r\nSync pithos with lodestar - besu",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950456876",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3388#issuecomment-950456876",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388",
    "id": 950456876,
    "node_id": "IC_kwDOCD5_Gc44ptIs",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T01:50:37Z",
    "updated_at": "2021-10-25T01:50:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "More logs:\r\n```\r\nOct-22 23:13:34.423 [CHAIN]         ^[[36mverbose^[[39m: Block processed slot=60942, root=0x6ca1a0c068f1bbbd4f5290f3e1d6628761242fa4d960876707d210c0dbe6d4ee\r\n```\r\n\r\nnote that 60942 is a missed block https://pithos-explorer.ethdevops.io/block/60942\r\n\r\nthen\r\n\r\n```\r\nOct-22 23:13:36.546 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=60943, root=0xce3f�~@�1510, curentSlot=60943\r\n\r\nOct-22 23:13:39.784 [NETWORK]         ^[[34mdebug^[[39m: gossip - sync_committee - accept slot=60943, subnet=1\r\nOct-22 23:13:39.825 [CHAIN]           ^[[31merror^[[39m: Block error slot=60943, errCode=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID code=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\nError: BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\n    at verifyBlockStateTransition (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:167:15)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at verifyBlock (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:38:10)\r\n    at processBlock (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/index.ts:64:32)\r\n    at Timeout.JobItemQueue.runJob [as _onTimeout] (/usr/app/node_modules/@chainsafe/lodestar/src/util/queue/itemQueue.ts:85:22)\r\nOct-22 23:13:39.826 [NETWORK]         ^[[31merror^[[39m: Error receiving block slot=60943, peer=16Uiu2HAmVE3SgQq6D2WpNMgzLBaHDUW9TG8yT1MM34ZuCEVj2Ge1 code=BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\nError: BLOCK_ERROR_EXECUTION_PAYLOAD_NOT_VALID\r\n    at verifyBlockStateTransition (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:167:15)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n    at verifyBlock (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/verifyBlock.ts:38:10)\r\n    at processBlock (/usr/app/node_modules/@chainsafe/lodestar/src/chain/blocks/index.ts:64:32)\r\n    at Timeout.JobItemQueue.runJob [as _onTimeout] (/usr/app/node_modules/@chainsafe/lodestar/src/util/queue/itemQueue.ts:85:22)\r\n```\r\n\r\nnote that all block roots are correct as found in lodestar-geth:\r\n```\r\nOct-22 23:13:35.197 [CHAIN]         ^[[36mverbose^[[39m: Block processed slot=60942, root=0x6ca1a0c068f1bbbd4f5290f3e1d6628761242fa4d960876707d210c0dbe6d4ee\r\nOct-22 23:13:36.919 [NETWORK]       ^[[36mverbose^[[39m: Received gossip block slot=60943, root=0xce3f�~@�1510, curentSlot=60943\r\nOct-22 23:13:38.384 [CHAIN]         ^[[36mverbose^[[39m: Block processed slot=60943, root=0xce3f6417e64bd8c6c3ee1dc1f3b31adb8c6b9e8802c4f786b3688a32fe191510\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950456876/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950470577",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3388#issuecomment-950470577",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388",
    "id": 950470577,
    "node_id": "IC_kwDOCD5_Gc44pwex",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T02:23:42Z",
    "updated_at": "2021-10-25T02:23:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "found this from besu docker log\r\n\r\n```\r\n2021-10-25 02:18:51.123+00:00 | vert.x-worker-thread-0 | ERROR | MainnetBlockValidator | Attempted to import block 52223 with hash 0x6d5744a9f813f81bdd90e517c85bc4e273e758eda93cbdcca525a91d684cc518 but parent block 0x19f2b43ef5572883499a7560f68ed718ce7095bc83d3b1fee3e425ce9b93e191 was not present\r\n```\r\n\r\n`0x6d5744a9f813f81bdd90e517c85bc4e273e758eda93cbdcca525a91d684cc518` is eth1 block hash of block 60943 and `0x19f2b43ef5572883499a7560f68ed718ce7095bc83d3b1fee3e425ce9b93e191` is eth1 block of block 60941\r\n\r\nBlock 60941 was processed successfully in lodestar \r\n```\r\nOct-22 23:13:30.586 [CHAIN]         ^[[36mverbose^[[39m: Block processed slot=60941, root=0x6d964c2b6f6ccef1125e89e7e5fc0d5490aa13c53db9af585acd974eba1816b9\r\n```\r\n\r\nneed to investigate why execution layer could not process the payload of block slot 60941",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950470577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950476175",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3388#issuecomment-950476175",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388",
    "id": 950476175,
    "node_id": "IC_kwDOCD5_Gc44px2P",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T02:40:52Z",
    "updated_at": "2021-10-25T02:40:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "this log shows that `0x19f2b43ef5572883499a7560f68ed718ce7095bc83d3b1fee3e425ce9b93e191` was really imported to the execution layer, however it was not found later\r\n\r\n```\r\ndevops@pithos-lodestar-besu-1 ➜  ~ docker logs a1454e465b6c | grep 0x19f2b43ef5572883499a7560f68ed718ce7095bc83d3b1fee3e425ce9b93e191 | head -n 10\r\nSLF4J: Class path contains multiple SLF4J bindings.\r\nSLF4J: Found binding in [jar:file:/opt/besu/lib/log4j-slf4j-impl-2.14.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]\r\nSLF4J: Found binding in [jar:file:/opt/besu/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]\r\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\r\nSLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]\r\n2021-10-22 23:13:30.660+00:00 | vert.x-worker-thread-0 | INFO  | EngineForkchoiceUpdated | Consensus fork-choice-update: head: 0x19f2b43ef5572883499a7560f68ed718ce7095bc83d3b1fee3e425ce9b93e191, finalized: 0x926181c832f182f7b0442ee9f26e40824e644167c71fb16b793cf62e41c63940\r\n2021-10-22 23:13:39.685+00:00 | vert.x-worker-thread-0 | ERROR | MainnetBlockValidator | Attempted to import block 52223 with hash 0x6d5744a9f813f81bdd90e517c85bc4e273e758eda93cbdcca525a91d684cc518 but parent block 0x19f2b43ef5572883499a7560f68ed718ce7095bc83d3b1fee3e425ce9b93e191 was not present\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/950476175/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1029824006",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3388#issuecomment-1029824006",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3388",
    "id": 1029824006,
    "node_id": "IC_kwDOCD5_Gc49Yd4G",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-04T10:03:42Z",
    "updated_at": "2022-02-04T10:03:42Z",
    "author_association": "MEMBER",
    "body": "Old devnet, open new issue if it happens again",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1029824006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
