{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3360",
  "id": 1024843808,
  "node_id": "I_kwDOCD5_Gc49FeAg",
  "number": 3360,
  "title": "Error lightclientUpdater.onFinalized",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-10-13T06:30:31Z",
  "updated_at": "2021-10-14T13:00:19Z",
  "closed_at": "2021-10-14T13:00:19Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nGot this error while syncing lodestar:\r\n```\r\nOct-13 06:16:45.755 [CHAIN]           error: Error lightclientUpdater.onFinalized epoch=1056 message=No block found for checkpoint 1056 : 0xc384ee5dda94f049e564dfcb7e120234e8575b51448f9e21f3343258f3644ce5\r\nError: No block found for checkpoint 1056 : 0xc384ee5dda94f049e564dfcb7e120234e8575b51448f9e21f3343258f3644ce5\r\n    at BeaconChain.onForkChoiceFinalized (/usr/app/node_modules/@chainsafe/lodestar/src/chain/eventHandlers.ts:165:15)\r\n    at ChainEventEmitter.<anonymous> (/usr/app/node_modules/@chainsafe/lodestar/src/chain/eventHandlers.ts:30:7)\r\n```\r\n\r\n**Expected behavior**\r\nNo error",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/942068177",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3360#issuecomment-942068177",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3360",
    "id": 942068177,
    "node_id": "IC_kwDOCD5_Gc44JtHR",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T08:39:39Z",
    "updated_at": "2021-10-13T08:39:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "this is because we handle `forkchoiceFinalized` event at 2 different places and they are not synchronized\r\n\r\n```\r\nOct-13 07:47:45.759 [CHAIN]         ^[[36mverbose^[[39m: Checkpoint finalized epoch=5228, root=0x8fff13cdd4b73614c3527ff0bed31b3c41f308e5592d95d12abd37c5d9ffa305\r\nOct-13 07:47:45.759 [CHAIN]         ^[[36mverbose^[[39m: New chain head headSlot=41856, headRoot=0xdf7f6a33e4e7dd08f3f2710a54a08fae6b8ff87dd33f25c4bf594de457773c2c\r\nOct-13 07:47:45.792 [CHAIN]         ^[[36mverbose^[[39m: Archive Blocks: processed chunk lowerBound=0, upperBound=10, size=10\r\nOct-13 07:47:45.793 [CHAIN]         ^[[36mverbose^[[39m: Archiving of finalized blocks complete totalArchived=10, finalizedEpoch=5228\r\nOct-13 07:47:45.793 [CHAIN]           ^[[31merror^[[39m: Error lightclientUpdater.onFinalized epoch=5228 message=No block found for checkpoint 5228 : 0x8fff13cdd4b73614c3527ff0bed31b3c41f308e5592d95d12abd37c5d9ffa305\r\nError: No block found for checkpoint 5228 : 0x8fff13cdd4b73614c3527ff0bed31b3c41f308e5592d95d12abd37c5d9ffa305\r\n    at BeaconChain.onForkChoiceFinalized (/usr/app/node_modules/@chainsafe/lodestar/src/chain/eventHandlers.ts:165:15)\r\n    at ChainEventEmitter.<anonymous> (/usr/app/node_modules/@chainsafe/lodestar/src/chain/eventHandlers.ts:30:7)\r\nOct-13 07:47:45.812 [CHAIN]         ^[[36mverbose^[[39m: Finish processing finalized checkpoint epoch=5228\r\n```\r\n\r\nWhile we handle `forkChoiceFinalized` event in EventHandler, Archiver was working on moving blocks from `block` db to `archiveBlock` db",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/942068177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
