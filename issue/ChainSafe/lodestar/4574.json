{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4574",
  "id": 1379893123,
  "node_id": "I_kwDOCD5_Gc5SP3-D",
  "number": 4574,
  "title": "Broken API endpoint /eth/v1/beacon/light_client/updates",
  "user": {
    "login": "zsfelfoldi",
    "id": 9884311,
    "node_id": "MDQ6VXNlcjk4ODQzMTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zsfelfoldi",
    "html_url": "https://github.com/zsfelfoldi",
    "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
    "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
    "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
    "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
    "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
    "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4115551418,
      "node_id": "LA_kwDOCD5_Gc71TlS6",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-light-clients",
      "name": "scope-light-clients",
      "color": "980043",
      "default": false,
      "description": "All issues regarding light client development."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "dadepo",
    "id": 272535,
    "node_id": "MDQ6VXNlcjI3MjUzNQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/272535?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dadepo",
    "html_url": "https://github.com/dadepo",
    "followers_url": "https://api.github.com/users/dadepo/followers",
    "following_url": "https://api.github.com/users/dadepo/following{/other_user}",
    "gists_url": "https://api.github.com/users/dadepo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dadepo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dadepo/subscriptions",
    "organizations_url": "https://api.github.com/users/dadepo/orgs",
    "repos_url": "https://api.github.com/users/dadepo/repos",
    "events_url": "https://api.github.com/users/dadepo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dadepo/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "dadepo",
      "id": 272535,
      "node_id": "MDQ6VXNlcjI3MjUzNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/272535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dadepo",
      "html_url": "https://github.com/dadepo",
      "followers_url": "https://api.github.com/users/dadepo/followers",
      "following_url": "https://api.github.com/users/dadepo/following{/other_user}",
      "gists_url": "https://api.github.com/users/dadepo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dadepo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dadepo/subscriptions",
      "organizations_url": "https://api.github.com/users/dadepo/orgs",
      "repos_url": "https://api.github.com/users/dadepo/repos",
      "events_url": "https://api.github.com/users/dadepo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dadepo/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-09-20T19:28:51Z",
  "updated_at": "2022-11-17T19:00:08Z",
  "closed_at": "2022-11-17T19:00:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The `updates` endpoint seems to be broken:\r\nhttp://104.248.139.137:9596/eth/v1/beacon/light_client/updates?start_period=10&count=1 returns {\"statusCode\":500,\"error\":\"Internal Server Error\",\"message\":\"finalizedBlockRoot not available 0xc23381411ab2aee8a7aa9dc63ebe7faac3220fe53582c03051e5879fb90ecfec\"}\r\n(the node on the given address runs Sepolia but I have tried it with another node running Mainnet too and it returns the same error for any period between the Altair fork and the latest period)",
  "closed_by": {
    "login": "zsfelfoldi",
    "id": 9884311,
    "node_id": "MDQ6VXNlcjk4ODQzMTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zsfelfoldi",
    "html_url": "https://github.com/zsfelfoldi",
    "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
    "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
    "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
    "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
    "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
    "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1256298946",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4574#issuecomment-1256298946",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574",
    "id": 1256298946,
    "node_id": "IC_kwDOCD5_Gc5K4ZnC",
    "user": {
      "login": "dadepo",
      "id": 272535,
      "node_id": "MDQ6VXNlcjI3MjUzNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/272535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dadepo",
      "html_url": "https://github.com/dadepo",
      "followers_url": "https://api.github.com/users/dadepo/followers",
      "following_url": "https://api.github.com/users/dadepo/following{/other_user}",
      "gists_url": "https://api.github.com/users/dadepo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dadepo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dadepo/subscriptions",
      "organizations_url": "https://api.github.com/users/dadepo/orgs",
      "repos_url": "https://api.github.com/users/dadepo/repos",
      "events_url": "https://api.github.com/users/dadepo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dadepo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-23T14:36:40Z",
    "updated_at": "2022-09-23T14:36:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "The endpoint returns successful using a beacon node as shown below... using any period from 290 till 581 (the current period)\r\n\r\n```\r\n➜  ~ curl https://lodestar-mainnet.chainsafe.io/eth/v1/beacon/light_client/updates\\?start_period\\=295\\&count\\=1 | jq | head\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 53733  100 53733    0     0  69565      0 --:--:-- --:--:-- --:--:-- 70239\r\n{\r\n  \"data\": [\r\n    {\r\n      \"attested_header\": {\r\n        \"slot\": \"2423677\",\r\n        \"proposer_index\": \"59881\",\r\n        \"parent_root\": \"0x1ad8a96cd5070323f447e4f8f3b70175086eba48518064e46f5188a16f4d35c8\",\r\n        \"state_root\": \"0x7a788d08dd8bdc2319f4b751e97690818ed6fe4ea8696cfafca4c3b847d8b223\",\r\n        \"body_root\": \"0x62fa4b3dda98a7aa9ae1a9f1e80e7baa4da2e385b69286ef7a78c9f817a29553\"\r\n      },\r\n➜  ~ curl https://lodestar-mainnet.chainsafe.io/eth/v1/beacon/light_client/updates\\?start_period\\=581\\&count\\=1 | jq | head\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 53735  100 53735    0     0  72528      0 --:--:-- --:--:-- --:--:-- 72811\r\n{\r\n  \"data\": [\r\n    {\r\n      \"attested_header\": {\r\n        \"slot\": \"4759621\",\r\n        \"proposer_index\": \"284232\",\r\n        \"parent_root\": \"0x0f27f9142da98544be1bbebfea93b1c76300ecfc8df564b9b1ca374d23c9a8eb\",\r\n        \"state_root\": \"0xcacc8b81ba825aefb22bf32054e668ffa6a38865eab4edfa6a0488207e30c86d\",\r\n        \"body_root\": \"0x93ad52438f0e512c983546ad23554cb34e46f9973e0d54e10c70051c27b58595\"\r\n      },\r\n```\r\n\r\n@zsfelfoldi Can you confirm from your end? I also noticed the url you shared has the period has 10, which is wrong...can you confirm also with a correct period. Also if the issue persist, when you start the node before you make the request, do you observe any errors in the logs you can share that can help debug the issue?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1256298946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1257316969",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4574#issuecomment-1257316969",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574",
    "id": 1257316969,
    "node_id": "IC_kwDOCD5_Gc5K8SJp",
    "user": {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-26T00:07:25Z",
    "updated_at": "2022-09-26T00:14:57Z",
    "author_association": "NONE",
    "body": "@dadepo as I wrote my node is running Sepolia on which period 10 should be valid. It looks to me like the updates generated since the node was started are returned fine but if I stop and restart the node it returns the error for those periods too (in case of my Sepolia node periods 81 to 85 are working because it was last started before generating update 81). So there is something that works while in memory but the db store and/or retrieval is wrong.\r\n(I would prefer to not restart that node again because now at least I can use it for testing my syncing code but I also have a mainnet node on my local machine that I restarted multiple times and confirmed the phenomenon described above)",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1257316969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1259635466",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4574#issuecomment-1259635466",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574",
    "id": 1259635466,
    "node_id": "IC_kwDOCD5_Gc5LFIMK",
    "user": {
      "login": "dadepo",
      "id": 272535,
      "node_id": "MDQ6VXNlcjI3MjUzNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/272535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dadepo",
      "html_url": "https://github.com/dadepo",
      "followers_url": "https://api.github.com/users/dadepo/followers",
      "following_url": "https://api.github.com/users/dadepo/following{/other_user}",
      "gists_url": "https://api.github.com/users/dadepo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dadepo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dadepo/subscriptions",
      "organizations_url": "https://api.github.com/users/dadepo/orgs",
      "repos_url": "https://api.github.com/users/dadepo/repos",
      "events_url": "https://api.github.com/users/dadepo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dadepo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-27T14:59:18Z",
    "updated_at": "2022-09-29T12:19:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @zsfelfoldi \r\nThanks for the clarification. This looks like known issues regarding lodestar regen's capabilities and also this issue noted \r\n- https://github.com/ChainSafe/lodestar/issues/4183\r\n\r\nI'll update you once a fix is available.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1259635466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1262744809",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4574#issuecomment-1262744809",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574",
    "id": 1262744809,
    "node_id": "IC_kwDOCD5_Gc5LQ_Tp",
    "user": {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-29T19:54:47Z",
    "updated_at": "2022-09-29T19:54:47Z",
    "author_association": "NONE",
    "body": "@dadepo I think I'm one step closer to the issue now. When I tried to verify those updates that are returned (that were generated since the node startup) I realized that they are wrong too, at least when they have a finalized header. In this case the finalized header's block root should be proven by the finality branch starting from the main header's state root (this part is correct) and the next sync committee root should be proven by the next sync committee branch, starting from the finalized header's state root. This latter part is not correct, now this proof is also rooted in the main header's state root (making the finalized header pointless). This was also correct earlier so maybe this is where something got broken and the two issues might be related.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1262744809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1319071579",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4574#issuecomment-1319071579",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4574",
    "id": 1319071579,
    "node_id": "IC_kwDOCD5_Gc5On29b",
    "user": {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-17T19:00:08Z",
    "updated_at": "2022-11-17T19:00:08Z",
    "author_association": "NONE",
    "body": "Looks like this issue has been solved by https://github.com/ChainSafe/lodestar/pull/4702\r\nAlso the issue mentioned in the last comment about the update format is apparently not a bug but a feature: https://github.com/ethereum/consensus-specs/pull/2932",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1319071579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
