{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/1990",
  "id": 793640529,
  "node_id": "MDU6SXNzdWU3OTM2NDA1Mjk=",
  "number": 1990,
  "title": "Event loop blocked by >3s",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-01-25T18:55:12Z",
  "updated_at": "2021-03-09T09:39:43Z",
  "closed_at": "2021-03-09T09:39:43Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Two recent syncs revealed event loop lag over 3s multiple times. We should investigate what action is causing so much lag and control it.\r\n\r\nNote that event loop lag correlates with peer loss\r\n\r\n\r\n#### Sync 1\r\n\r\n![Screenshot from 2021-01-24 08-05-07](https://user-images.githubusercontent.com/35266934/105752056-1e43ab00-5f47-11eb-8940-6c432a6b6c31.png)\r\n\r\n\r\n#### Sync 2\r\n\r\n![Screenshot from 2021-01-23 10-58-17](https://user-images.githubusercontent.com/35266934/105752068-226fc880-5f47-11eb-896f-de27cc7c1371.png)\r\n",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/767446411",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-767446411",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 767446411,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NzQ0NjQxMQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-26T10:20:37Z",
    "updated_at": "2021-01-26T10:20:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "sometimes I see epoch processing increased significantly and then came back. This is from my current pyrmont sync\r\n```\r\n@@@ epochTransition CachedBeaconState slot 90240 time 1255 average 1247.4973646382361\r\n@@@ epochTransition CachedBeaconState slot 90272 time 2387 average 1248.0431034482754\r\n@@@ epochTransition CachedBeaconState slot 90304 time 6620 average 1250.6146481570124\r\n@@@ epochTransition CachedBeaconState slot 90336 time 6828 average 1253.2832535885163\r\n@@@ epochTransition CachedBeaconState slot 90368 time 7466 average 1256.2544237207073\r\n@@@ epochTransition CachedBeaconState slot 90464 time 5795 average 1258.4239961759079\r\n@@@ epochTransition CachedBeaconState slot 90496 time 6486 average 1260.921643573817\r\n@@@ epochTransition CachedBeaconState slot 90528 time 5762 average 1263.071155682903\r\n@@@ epochTransition CachedBeaconState slot 90560 time 6552 average 1265.5957040572787\r\n@@@ epochTransition CachedBeaconState slot 90592 time 5712 average 1267.7170801526713\r\n@@@ epochTransition CachedBeaconState slot 90624 time 6269 average 1270.102050548402\r\n@@@ epochTransition CachedBeaconState slot 90656 time 6701 average 1272.6906577693037\r\n@@@ epochTransition CachedBeaconState slot 90688 time 8099 average 1275.9428299190085\r\n@@@ epochTransition CachedBeaconState slot 90720 time 7594 average 1278.951428571428\r\n@@@ epochTransition CachedBeaconState slot 90752 time 6840 average 1281.5982865302233\r\n@@@ epochTransition CachedBeaconState slot 90784 time 7429 average 1284.5228353948617\r\n@@@ epochTransition CachedBeaconState slot 90816 time 6222 average 1286.8706609605322\r\n@@@ epochTransition CachedBeaconState slot 90848 time 6130 average 1289.1725285171099\r\n@@@ epochTransition CachedBeaconState slot 90880 time 5094 average 1290.9800475059378\r\n@@@ epochTransition CachedBeaconState slot 90912 time 7397 average 1293.8793922127252\r\n@@@ epochTransition CachedBeaconState slot 90944 time 5883 average 1296.0574276222112\r\n@@@ epochTransition CachedBeaconState slot 90976 time 10526 average 1300.435958254269\r\n@@@ epochTransition CachedBeaconState slot 91008 time 5963 average 1302.6467520151725\r\n@@@ epochTransition CachedBeaconState slot 91040 time 1430 average 1302.7071090047389\r\n```\r\n\r\naverage epoch transition is ~1.3s while sometimes it increased significantly to more than 10s!",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/767446411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/767580047",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-767580047",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 767580047,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NzU4MDA0Nw==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-26T14:32:16Z",
    "updated_at": "2021-01-26T14:32:16Z",
    "author_association": "MEMBER",
    "body": "Is there something we can split out the tasks so it doesn't take so long at once?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/767580047/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/767586747",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-767586747",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 767586747,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NzU4Njc0Nw==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-26T14:38:53Z",
    "updated_at": "2021-01-26T14:38:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'll try to regenerate respective BeaconStates to reproduce on local environment to see if we can improve it.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/767586747/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/768069488",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-768069488",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 768069488,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODA2OTQ4OA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T06:38:57Z",
    "updated_at": "2021-01-27T06:38:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't see a slow epoch transition after I regenerate state and run state transition through block 90976, it's only around 1.1s.\r\n\r\nSo I think it's just my laptop was too busy at that time since it happened at adjacent epochs. We need to make a new metric for epoch transition and follow it once we deploy to a server.\r\n\r\nI'm attaching the state and block for reference.\r\n[archivedstate_90975.zip](https://github.com/ChainSafe/lodestar/files/5878132/archivedstate_90975.zip)\r\n[archivedblock_90976.zip](https://github.com/ChainSafe/lodestar/files/5878138/archivedblock_90976.zip)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/768069488/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/768077001",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-768077001",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 768077001,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODA3NzAwMQ==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T06:56:45Z",
    "updated_at": "2021-01-27T06:56:45Z",
    "author_association": "MEMBER",
    "body": "Thanks for profiling it! Even tho it's 1.1s, could you investigate the percentage CPU spent in each major routine?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/768077001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/768087697",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-768087697",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 768087697,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODA4NzY5Nw==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-27T07:17:23Z",
    "updated_at": "2021-01-27T07:17:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "here's the statistic based on https://github.com/ChainSafe/lodestar/blob/master/packages/lodestar-beacon-state-transition/test/perf/epoch_processing.test.ts and the attached state 90975\r\n```\r\n2021-01-27 14:07:42 []                 info: prepareEpochProcessState  - duration=323ms\r\n    1) prepareEpochProcessState\r\n2021-01-27 14:07:42 []                 info: processJustificationAndFinalization  - duration=1ms\r\n    ✓ processJustificationAndFinalization\r\n2021-01-27 14:07:42 []                 info: processRewardsAndPenalties  - duration=498ms\r\n    ✓ processRewardsAndPenalties (498ms)\r\n2021-01-27 14:07:42 []                 info: processRegistryUpdates\r\n    ✓ processRegistryUpdates\r\n2021-01-27 14:07:42 []                 info: processSlashings  - duration=23ms\r\n    ✓ processSlashings\r\n2021-01-27 14:07:42 []                 info: processFinalUpdates  - duration=21ms\r\n    ✓ processFinalUpdates\r\n2021-01-27 14:07:42 []                 info: processForkChanged\r\n    ✓ processForkChanged\r\n2021-01-27 14:07:42 []                 info: rotateEpoch  - duration=165ms\r\n```\r\n\r\nand for block processing\r\n\r\n```\r\n2021-01-27 14:15:56 []                 info: Process block 90976  - duration=164ms\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/768087697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/771455099",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-771455099",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 771455099,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MTQ1NTA5OQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-02T08:18:17Z",
    "updated_at": "2021-02-02T08:18:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "it's worth to look into this https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide\r\n\r\ncurrently we use `async/await` across the code base, in a lot of scenarios it keeps adding items to `microtasks` queue in the same event loop iteration hence that iteration takes time.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/771455099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/774951930",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-774951930",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 774951930,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDk1MTkzMA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T08:01:45Z",
    "updated_at": "2021-02-08T08:01:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "sometimes it takes almost 1s just for the `readOnlyMap` inside `processRewardsAndPenalties`, I suspect it much slower in our server\r\n<img width=\"1144\" alt=\"Screen Shot 2021-02-08 at 14 52 36\" src=\"https://user-images.githubusercontent.com/10568965/107190536-7d142480-6a1d-11eb-87f7-a03c57bbb961.png\">\r\n\r\nMost of the time it took only 200ms-300ms for that, also I notice that there are a lot of `gc` calls there.\r\n\r\nOne more thing to take a look is the BigInt calculations\r\n<img width=\"887\" alt=\"Screen Shot 2021-02-08 at 15 00 35\" src=\"https://user-images.githubusercontent.com/10568965/107191251-7a65ff00-6a1e-11eb-8582-fdb3d0bc1a6a.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/774951930/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/775459573",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-775459573",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 775459573,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTQ1OTU3Mw==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T21:02:38Z",
    "updated_at": "2021-02-08T21:10:41Z",
    "author_association": "MEMBER",
    "body": "Damn.. Thanks @tuyennhv for the analysis! Where is the file `uint.ts` from? Our ssz library?\r\n\r\nEDIT: Yes it's ssz, src/types/basic/uint.ts\r\n\r\nEDIT2: @tuyennhv The code from your debugger is different than master https://github.com/ChainSafe/ssz/blob/7639b2806713f6f352b43424a5aadca0da1779e2/src/types/basic/uint.ts#L70 , is that expected?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/775459573/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/775608565",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-775608565",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 775608565,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTYwODU2NQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T02:26:32Z",
    "updated_at": "2021-02-09T02:26:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Damn.. Thanks @tuyennhv for the analysis! Where is the file `uint.ts` from? Our ssz library?\r\n> \r\n> EDIT: Yes it's ssz, src/types/basic/uint.ts\r\n> \r\n> EDIT2: @tuyennhv The code from your debugger is different than master https://github.com/ChainSafe/ssz/blob/7639b2806713f6f352b43424a5aadca0da1779e2/src/types/basic/uint.ts#L70 , is that expected?\r\n\r\nthere are NumberUintType and BigIntUintType in that same file, we need to improve both by limiting the use of BigInt if possible. Finally I was able to reproduce the issue in the performance test\r\n```ts\r\nit.only(\"reproduce readOnlyMap issue\", async function () {\r\n    this.timeout(0);\r\n    let minTime = Number.MAX_SAFE_INTEGER;\r\n    let maxTime = 0;\r\n    const originalState = state.getOriginalState();\r\n    for (let i = 0; i < 20000; i++) {\r\n      const start = Date.now();\r\n      readOnlyMap(originalState.balances, (balance) => balance);\r\n      const duration = Date.now() - start;\r\n      if (duration < minTime) minTime = duration;\r\n      if (duration > maxTime) maxTime = duration;\r\n    }\r\n    console.log(\"@@@ minTime\", minTime, \"maxTime\", maxTime);\r\n  });\r\n```\r\nthis prints out\r\n```\r\n2021-02-09 08:15:42 []                 info: Loaded state slot=756416, numValidators=114038\r\n@@@ minTime 140 maxTime 1109\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/775608565/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/793627827",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1990#issuecomment-793627827",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1990",
    "id": 793627827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MzYyNzgyNw==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-09T09:39:43Z",
    "updated_at": "2021-03-09T09:39:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "there are different improvements implemented, this should be tracked in #2046 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/793627827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
