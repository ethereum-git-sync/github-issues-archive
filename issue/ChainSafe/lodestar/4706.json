{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4706",
  "id": 1429639884,
  "node_id": "I_kwDOCD5_Gc5VNpLM",
  "number": 4706,
  "title": "Lodestar prover for execution api",
  "user": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4754137758,
      "node_id": "LA_kwDOCD5_Gc8AAAABG15ing",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-feature-request",
      "name": "meta-feature-request",
      "color": "B5CF5F",
      "default": false,
      "description": "Issues to track feature requests."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "nazarhussain",
    "id": 112468,
    "node_id": "MDQ6VXNlcjExMjQ2OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/112468?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nazarhussain",
    "html_url": "https://github.com/nazarhussain",
    "followers_url": "https://api.github.com/users/nazarhussain/followers",
    "following_url": "https://api.github.com/users/nazarhussain/following{/other_user}",
    "gists_url": "https://api.github.com/users/nazarhussain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nazarhussain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nazarhussain/subscriptions",
    "organizations_url": "https://api.github.com/users/nazarhussain/orgs",
    "repos_url": "https://api.github.com/users/nazarhussain/repos",
    "events_url": "https://api.github.com/users/nazarhussain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nazarhussain/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nazarhussain",
      "id": 112468,
      "node_id": "MDQ6VXNlcjExMjQ2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/112468?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nazarhussain",
      "html_url": "https://github.com/nazarhussain",
      "followers_url": "https://api.github.com/users/nazarhussain/followers",
      "following_url": "https://api.github.com/users/nazarhussain/following{/other_user}",
      "gists_url": "https://api.github.com/users/nazarhussain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nazarhussain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nazarhussain/subscriptions",
      "organizations_url": "https://api.github.com/users/nazarhussain/orgs",
      "repos_url": "https://api.github.com/users/nazarhussain/repos",
      "events_url": "https://api.github.com/users/nazarhussain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nazarhussain/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-10-31T10:48:35Z",
  "updated_at": "2023-05-15T13:03:03Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description \r\n\r\nExecution land apps so far has been using JSON-RPC api (locally hosted or hosted by an infra or app provider). This places requirement of trust in the api provider which has lead to centralization of these services.\r\n\r\nWith ethereum PoS light client protocol, its now possible to verify the data served by the JSON-RPC `client` side. This creates a space for a \"prover\" library with which user can further decentralize trust.\r\nCurrently, a few provers a.la. kevlar and nimbus lc proxy have come up which basically offers a proxy to the web3 calls. This requires running another server which does the job of intercepting the calls to the backend rpc service and marry/prove it with the light client data.\r\n\r\nHowever lodestar wants to approach it a bit differently. Lodestar wants to \"programmatically\" proxy so that the entire proving happens on the `client`. Obviously this can also be used to host a proxy rpc sever.\r\n\r\nThis  is the task for building such a module:\r\n\r\n**ProofedProvider**\r\nTakes a\r\n  - a web3 provider  or options\r\n  - a proofed root provider or options\r\n \r\nand  returns a `safeProvider` which responses to the request with the proved data \r\n\r\n**Expected Usecase**\r\n\r\n```typescript\r\nimport {ProofedWeb3Provider, ProofedRootProvider} from \"@lodestar/prover\"\r\n\r\nconst rpc:Web3Provider|URL = ....\r\nconst rootProvider: ProofedRootProvider|{mode: LightNode.Rest,apiUrl: string}|{mode: LightNode.P2P, bootnodes:string[]} = ....\r\nconst safeProvider = ProofedProvider(rpc ,rootProvider); \r\n\r\n// wait for safeProvider to sync \r\nawait safeProvider.sync({checkpoint:\"0x..\"})\r\n\r\n// you may stop query safe provider at any time synced or not\r\nconst {latest,finalized,status} = safeProvider.getStatus()\r\n\r\n// you may call any web3 api at any time synced or not, but will error if number, latest. finalized can't be resolved\r\n// calls by block root will not be proxided\r\nsafeProvider.eth_call(....)\r\nsafeProvider.eth_getBalance(...)\r\n```\r\n\r\n### Task List\r\n\r\n- [x] Create a package skeleton `@lodestar/prover` \r\n- [x] Create a factory method to create a proofed web3 provider \r\n- [x] Create a factory method to create a proxy server \r\n- [x] Create a small CLI app to start the proxy and expose it as binary \r\n- [x] Add Rest interface for the lightclient \r\n- [ ] Add P2P interface for the lightclient \r\n- [x] Optional logging support for the web3 provider \r\n- [x] Logging support for the proxy server to stream to std\r\n- [ ] Support to provide white list of fallback web3 methods for non-verified requests \r\n- [ ] Check the given execution URLs for compatibility before start \r\n- [ ] Run the e2e tests in the browser for the web3 provider \r\n- [ ] Run the e2e tests in the Node for the web3 proxy \r\n- [ ] Handle the re-org scenario for the proof provider\r\n- [ ] Support batch RPC requests\r\n- [ ] Setup local EL/CL nodes for the CI\r\n- [ ] Use batch request inside `getExecutionPayloads` to optimize the performance \r\n- [ ] Update all external requests to be restricted with timeout \r\n- [ ] Update the logic for pruning the unfinalized headers\r\n- [ ] Reduce dependency on etheruemjs packages \r\n\r\n### Web3 Methods to support \r\n\r\nThe method support list is now moved to the [README](https://github.com/ChainSafe/lodestar/blob/unstable/packages/prover/README.md)\r\n\r\n",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1495251680",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4706#issuecomment-1495251680",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706",
    "id": 1495251680,
    "node_id": "IC_kwDOCD5_Gc5ZH7rg",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T02:27:57Z",
    "updated_at": "2023-04-04T02:27:57Z",
    "author_association": "MEMBER",
    "body": "I think we should keep using this as a tracker for what has and hasn't been implemented yet for the entire scope of the prover @wemeetagain ?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1495251680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1521462883",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4706#issuecomment-1521462883",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4706",
    "id": 1521462883,
    "node_id": "IC_kwDOCD5_Gc5ar65j",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-25T09:23:46Z",
    "updated_at": "2023-04-25T09:24:50Z",
    "author_association": "MEMBER",
    "body": "| Group | Method | Status\r\n|-------|--------|----|\r\n| Block | eth_getBlockByHash | ✅ done v0\r\n|       | eth_getBlockByNumber | done v0\r\n|       | eth_getBlockTransactionCountByHash | ⌛ todo v2\r\n|       | eth_getBlockTransactionCountByNumber | todo v2\r\n|       | eth_getUncleCountByBlockHash | todo v2\r\n|       | eth_getUncleCountByBlockNumber | todo v2\r\n| Chain/Network | eth_chainId | forward\r\n|       | eth_syncing | todo v1\r\n|       | eth_coinbase | todo v2\r\n|       | eth_accounts | forward\r\n|       | eth_blockNumber | forward\r\n| Call and Estimate | eth_call | todo v0\r\n|       | eth_estimateGas | todo v0\r\n|       | eth_createAccessList | todo v2\r\n|       | eth_gasPrice | todo v1\r\n|       | eth_maxPriorityFeePerGas | todo v1\r\n|       | eth_feeHistory | todo v2\r\n| Filters | eth_newFilter | todo v2\r\n|       | eth_newBlockFilter | todo v2\r\n|       | eth_newPendingTransactionFilter | todo v2\r\n|       | eth_uninstallFilter | todo v2\r\n|       | eth_getFilterChanges | todo v2\r\n|       | eth_getFilterLogs | todo v2\r\n|       | eth_getLogs | todo v1\r\n| Mining | eth_mining | forward\r\n|       | eth_hashrate | forward\r\n|       | eth_getWork | forward\r\n|       | eth_submitWork | forward\r\n|       | eth_submitHashrate | forward\r\n| Signing | eth_sign | forward\r\n|       | eth_signTransaction | forward\r\n| State | eth_getBalance | done v0\r\n|       | eth_getStorageAt | todo v1\r\n|       | eth_getTransactionCount | todo v2\r\n|       | eth_getCode | done v0\r\n|       | eth_getProof | forward\r\n| Transactions | eth_sendTransaction | forward\r\n|       | eth_sendRawTransaction | forward\r\n|       | eth_getTransactionByHash | todo v2\r\n|       | eth_getTransactionByBlockHashAndIndex | todo v2\r\n|       | eth_getTransactionByBlockNumberAndIndex | todo v2\r\n|       | eth_getTransactionReceipt | todo v2",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1521462883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
