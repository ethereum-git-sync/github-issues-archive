{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3247",
  "id": 1006942712,
  "node_id": "I_kwDOCD5_Gc48BLn4",
  "number": 3247,
  "title": "Lodestar fell out of sync on MainNet",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-09-25T03:12:31Z",
  "updated_at": "2021-09-30T03:12:33Z",
  "closed_at": "2021-09-30T03:12:33Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nLodestar running in docker, initially sync'd correctly with checkpoint sync and then was correctly tracking head but after a while started listing all slots as empty then went back to sync mode and failed to recover.\r\n\r\n**Expected behavior**\r\n\r\nLodestar should remain in sync with chain.\r\n\r\n**Steps to Reproduce**\r\n\r\nRan Lodestar with the docker-compose config:\r\n```\r\nlodestar-mainnet:\r\n    image: chainsafe/lodestar\r\n    volumes:\r\n      - './lodestar/mainnet:/data'\r\n    command:\r\n      - 'beacon'\r\n      - '--rootDir'\r\n      - '/data/beacon'\r\n      - '--network'\r\n      - 'mainnet'\r\n      - '--weakSubjectivityServerUrl'\r\n      - 'https://<credentials>@eth2-beacon-mainnet.infura.io'\r\n      - '--weakSubjectivitySyncLatest'\r\n      - '--logFile'\r\n      - '/data/lodestar.log'\r\n      - '--api.rest.enabled'\r\n      - '--api.rest.host'\r\n      - '0.0.0.0'\r\n      - '--metrics.enabled'\r\n      - '--network.discv5.bindAddr'\r\n      - '/ip4/0.0.0.0/udp/9100'\r\n      - '--network.localMultiaddrs'\r\n      - '/ip4/0.0.0.0/tcp/9100'\r\n    ports:\r\n      - \"9100:9100/tcp\"\r\n      - \"9100:9100/udp\"\r\n      - \"9596:9596\"\r\n```\r\n\r\nI did wind up restarting it a couple of times after it was first in sync.  On the last run it caught up to head again but then failed to remain in sync.\r\n\r\n**Screenshots**\r\n\r\n<!--If applicable, add screenshots to help explain your problem.-->\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n- OS: Mac OS 11.6 (but using `chainsafe/lodestar` docker image\r\n- Version:  \r\n``` \r\nðŸŒŸ Lodestar: TypeScript Implementation of the Ethereum 2.0 Beacon Chain.\r\n  * Version: v0.30.0 (npm)\r\n  * by ChainSafe Systems, 2018-2021\r\n```\r\n- Branch: master\r\nDocker image ID: `805bbdf546b0`\r\n",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927001662",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3247#issuecomment-927001662",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247",
    "id": 927001662,
    "node_id": "IC_kwDOCD5_Gc43QOw-",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T03:13:15Z",
    "updated_at": "2021-09-25T03:13:15Z",
    "author_association": "NONE",
    "body": "Log file:\r\n[lodestar.log](https://github.com/ChainSafe/lodestar/files/7229081/lodestar.log)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927001662/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927004374",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3247#issuecomment-927004374",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247",
    "id": 927004374,
    "node_id": "IC_kwDOCD5_Gc43QPbW",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T03:42:14Z",
    "updated_at": "2021-09-25T03:42:14Z",
    "author_association": "NONE",
    "body": "I restarted it with debug level logging and left it run for a while - it doesn't appear to have caught back up to head still. \r\n[lodestar.log](https://github.com/ChainSafe/lodestar/files/7229105/lodestar.log)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927004374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927116151",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3247#issuecomment-927116151",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247",
    "id": 927116151,
    "node_id": "IC_kwDOCD5_Gc43Qqt3",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T12:44:29Z",
    "updated_at": "2021-09-25T16:03:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "@tuyennhv  @dapplion  from my investigation of the logs it seems that lodestar is not getting  the blocks in synced state  causing it to assume empty blocks without moving head, but when current slot - current head difference >32 slots (which is i guess our tolerance of 1 epoch), it syncs up to head, and then the whole cycle starts again.\r\n\r\nexamples from attached log: \r\n![image](https://user-images.githubusercontent.com/76567250/134772182-2d93d75d-bf6c-4d2d-bfdc-68a90b77f576.png)\r\n\r\n![image](https://user-images.githubusercontent.com/76567250/134772154-95c25b6d-2b58-42e0-9b0b-6cc5c0f1c28b.png)\r\n\r\n![image](https://user-images.githubusercontent.com/76567250/134772112-7073ec92-4da3-4936-919f-5f6b9e5cfd72.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927116151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927257172",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3247#issuecomment-927257172",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247",
    "id": 927257172,
    "node_id": "IC_kwDOCD5_Gc43RNJU",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-26T08:16:49Z",
    "updated_at": "2021-09-26T08:16:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks @ajsutton for the log, this should fix the issue https://github.com/ChainSafe/lodestar/pull/3245",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/927257172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/930732690",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3247#issuecomment-930732690",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3247",
    "id": 930732690,
    "node_id": "IC_kwDOCD5_Gc43edqS",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T03:12:33Z",
    "updated_at": "2021-09-30T03:12:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "sync is working fine, closing for now",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/930732690/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
