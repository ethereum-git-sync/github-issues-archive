{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3515",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3515/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3515/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3515/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3515",
  "id": 1078762949,
  "node_id": "I_kwDOCD5_Gc5ATJ3F",
  "number": 3515,
  "title": "Node in under-powered machine can't recover from high memory usage",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3172006584,
      "node_id": "MDU6TGFiZWwzMTcyMDA2NTg0",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-memory",
      "name": "scope-memory",
      "color": "980043",
      "default": false,
      "description": "Issues to reduce and improve memory usage."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-12-13T16:56:09Z",
  "updated_at": "2022-02-04T10:48:30Z",
  "closed_at": "2022-02-04T10:48:30Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "<!--NOTE: -->\r\n<!--- General questions should go to the discord chat instead of the issue tracker.-->\r\n\r\n**Describe the bug**\r\n\r\nRunning a node with 30 validators in multiple contabo VPS S machines, most can handle the load ok, but a node had it's memory rise due to improper handling of the state cache old states probably.\r\n\r\nThe node seems to have entered the death spiral where higher memory leads to extreme CPU usage so the node can't do anything at all. Then all gossip objects become old really fast and everything requires regen which collapses the node even more. Then all the main thread does it GC constantly.\r\n\r\n**Expected behavior**\r\n\r\nWhile the node shouldn't get to such a high memory usage in the first place it should be able to recover:\r\n- Why does the limit doesn't kick in and kill the node?\r\n- Why isn't the node able to empty the state cache and lower the memory?\r\n\r\n\r\n![Screenshot from 2021-12-13 17-54-47](https://user-images.githubusercontent.com/35266934/145854901-07e0c14f-4e1c-452f-8c32-3a5706eb1e49.png)\r\n\r\n![Screenshot from 2021-12-13 17-55-01](https://user-images.githubusercontent.com/35266934/145854893-65e9b572-b47c-438b-bdf3-7356bc836b61.png)\r\n\r\n",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3515/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3515/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
