{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5613",
  "id": 1743637119,
  "node_id": "I_kwDOCD5_Gc5n7cp_",
  "number": 5613,
  "title": "Goerli crash on 1.8.0",
  "user": {
    "login": "yrong",
    "id": 4383920,
    "node_id": "MDQ6VXNlcjQzODM5MjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4383920?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yrong",
    "html_url": "https://github.com/yrong",
    "followers_url": "https://api.github.com/users/yrong/followers",
    "following_url": "https://api.github.com/users/yrong/following{/other_user}",
    "gists_url": "https://api.github.com/users/yrong/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yrong/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yrong/subscriptions",
    "organizations_url": "https://api.github.com/users/yrong/orgs",
    "repos_url": "https://api.github.com/users/yrong/repos",
    "events_url": "https://api.github.com/users/yrong/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yrong/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-06-06T11:09:42Z",
  "updated_at": "2023-06-07T01:47:43Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nAfter running 8 hours, oom as following\r\n```\r\nJun-06 10:54:06.062[]                 \u001B[32minfo\u001B[39m: Synced - slot: 5795070 - head: 0x54df…9b98 - exec-block: syncing(9132193 0xce54…) - finalized: 0x05b2…159a:181093 - peers: 39\r\n\r\n<--- Last few GCs --->\r\n\r\n[2717078:0x62ed4e0] 28144237 ms: Scavenge 1964.8 (2038.4) -> 1956.7 (2039.1) MB, 4.5 / 0.0 ms  (average mu = 0.356, current mu = 0.463) allocation failure; \r\n[2717078:0x62ed4e0] 28144290 ms: Scavenge 1969.8 (2039.6) -> 1960.2 (2041.9) MB, 4.1 / 0.0 ms  (average mu = 0.356, current mu = 0.463) allocation failure; \r\n[2717078:0x62ed4e0] 28144346 ms: Scavenge 1972.3 (2042.4) -> 1963.9 (2045.4) MB, 4.5 / 0.0 ms  (average mu = 0.356, current mu = 0.463) allocation failure; \r\n\r\n\r\n<--- JS stacktrace --->\r\n\r\nFATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory\r\n 1: 0xb7a940 node::Abort() [node]\r\n 2: 0xa8e823  [node]\r\n 3: 0xd5c940 v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, bool) [node]\r\n 4: 0xd5cce7 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, bool) [node]\r\n 5: 0xf3a3e5  [node]\r\n 6: 0xf3b2e8 v8::internal::Heap::RecomputeLimits(v8::internal::GarbageCollector) [node]\r\n 7: 0xf4b7f3  [node]\r\n 8: 0xf4c668 v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags) [node]\r\n 9: 0xf4f835 v8::internal::Heap::HandleGCRequest() [node]\r\n10: 0xecd98f v8::internal::StackGuard::HandleInterrupts() [node]\r\n11: 0x12ce22f v8::internal::Runtime_StackGuardWithGap(int, unsigned long*, v8::internal::Isolate*) [node]\r\n12: 0x16fb6b9  [node]\r\nAborted (core dumped)\r\n```\r\n\r\n### Expected behavior\r\n\r\nrunning without oom\r\n\r\n### Steps to reproduce\r\n\r\n```\r\nnpx lodestar beacon --dataDir=\"$ethereum_data_dir\" --network=\"goerli\" --rest.namespace=\"*\" --jwt-secret=\"./config/jwtsecret\" --checkpointSyncUrl=\"https://sync-goerli.beaconcha.in\" > \"$output_dir/lodestar.log\" 2>&1 &\r\n```\r\n\r\n### Additional context\r\n\r\nSimilar issues could be referenced\r\n\r\nhttps://github.com/ChainSafe/lodestar/issues/5349\r\nhttps://github.com/ChainSafe/lodestar/issues/5549\r\n\r\n### Operating system\r\n\r\nLinux\r\n\r\n### Lodestar version or commit hash\r\n\r\nv1.8.0",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1579551555",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5613#issuecomment-1579551555",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613",
    "id": 1579551555,
    "node_id": "IC_kwDOCD5_Gc5eJgtD",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-06T22:36:08Z",
    "updated_at": "2023-06-06T22:36:08Z",
    "author_association": "MEMBER",
    "body": "Do you know how much memory you've allocated to nodeJS when running Lodestar? I think by default, it's set at 1400MB, which could potentially be why. Usually when running Lodestar, we set `--max-old-space-size=4096` to the nodeJS environment to give it more than the default. 1.4GB is definitely too low.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1579551555/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1579731570",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5613#issuecomment-1579731570",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5613",
    "id": 1579731570,
    "node_id": "IC_kwDOCD5_Gc5eKMpy",
    "user": {
      "login": "yrong",
      "id": 4383920,
      "node_id": "MDQ6VXNlcjQzODM5MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4383920?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yrong",
      "html_url": "https://github.com/yrong",
      "followers_url": "https://api.github.com/users/yrong/followers",
      "following_url": "https://api.github.com/users/yrong/following{/other_user}",
      "gists_url": "https://api.github.com/users/yrong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yrong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yrong/subscriptions",
      "organizations_url": "https://api.github.com/users/yrong/orgs",
      "repos_url": "https://api.github.com/users/yrong/repos",
      "events_url": "https://api.github.com/users/yrong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yrong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-07T01:47:12Z",
    "updated_at": "2023-06-07T01:47:43Z",
    "author_association": "NONE",
    "body": "Thanks a lot for the reply! Yes, did not explicitly configure before. \r\n\r\nI would assume this value will be dynamic determined based on physically available in RAM. So do we have recommendation about minim hardware spec for running a goerli/mainnet node?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1579731570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
