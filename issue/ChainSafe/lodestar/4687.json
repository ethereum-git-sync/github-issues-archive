{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4687",
  "id": 1422338982,
  "node_id": "I_kwDOCD5_Gc5Uxyum",
  "number": 4687,
  "title": "Sending 0 as committee_index in GET AttestationData endpoint",
  "user": {
    "login": "dB2510",
    "id": 37813203,
    "node_id": "MDQ6VXNlcjM3ODEzMjAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/37813203?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dB2510",
    "html_url": "https://github.com/dB2510",
    "followers_url": "https://api.github.com/users/dB2510/followers",
    "following_url": "https://api.github.com/users/dB2510/following{/other_user}",
    "gists_url": "https://api.github.com/users/dB2510/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dB2510/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dB2510/subscriptions",
    "organizations_url": "https://api.github.com/users/dB2510/orgs",
    "repos_url": "https://api.github.com/users/dB2510/repos",
    "events_url": "https://api.github.com/users/dB2510/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dB2510/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4116812272,
      "node_id": "LA_kwDOCD5_Gc71YZHw",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/scope-interop",
      "name": "scope-interop",
      "color": "980043",
      "default": false,
      "description": "Issues that fix interop issues between Lodestar and CL, EL or tooling."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-10-25T11:52:24Z",
  "updated_at": "2023-03-23T11:57:57Z",
  "closed_at": "2023-03-23T11:57:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--NOTE: -->\r\n<!--- General questions should go to the discord chat instead of the issue tracker.-->\r\n\r\n**Describe the bug**\r\n\r\nWhile integrating lodestar to our Obol distributed validator cluster we found out that when calling [GET attestation data endpoint](https://ethereum.github.io/beacon-APIs/#/Validator/produceAttestationData) from beacon node, lodestar sends committee index as 0.\r\nhttps://github.com/ChainSafe/lodestar/blob/bc20c21c6782e1917134576e577af3b292415c4d/packages/validator/src/services/attestation.ts#L91\r\nWhereas other clients for ex, lighthouse and teku send committee index obtained at the time of getting attester duties endpoint. This results in timeout since we store attestation data with (slot, committee_index) as key.\r\n\r\n**Expected behavior**\r\n\r\nLodestar should send actual `committee_index` as query parameter to GET attestation data endpoint rather than sending 0 obtained from [attester duties endpoint](https://ethereum.github.io/beacon-APIs/#/Validator/getAttesterDuties) so that it would be consistent with other clients and spec as well.\r\n\r\n**Steps to Reproduce**\r\n\r\n<!--Steps to reproduce the behavior:\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n-->\r\n\r\n**Screenshots**\r\n\r\n<!--If applicable, add screenshots to help explain your problem.-->\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n- OS: <!--[e.g. ubuntu, OSX High Siera]--> macOS Monterey\r\n- Version: <!--[e.g. 22]--> v1.1.1\r\n- Branch: <!--[unstable]--> v1.1.1\r\n- Commit hash: <!--[e8232]--> 90a92dd74f\r\n",
  "closed_by": {
    "login": "nflaig",
    "id": 38436224,
    "node_id": "MDQ6VXNlcjM4NDM2MjI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nflaig",
    "html_url": "https://github.com/nflaig",
    "followers_url": "https://api.github.com/users/nflaig/followers",
    "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
    "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
    "organizations_url": "https://api.github.com/users/nflaig/orgs",
    "repos_url": "https://api.github.com/users/nflaig/repos",
    "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nflaig/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1291021144",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4687#issuecomment-1291021144",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
    "id": 1291021144,
    "node_id": "IC_kwDOCD5_Gc5M82tY",
    "user": {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-25T19:12:44Z",
    "updated_at": "2022-10-25T19:12:44Z",
    "author_association": "MEMBER",
    "body": "We currently call the produceAttestationData once per slot for all connected validators with duties at that slot. We're calling with committee index 0 since the resulting attestation data isn't actually dependent on the committee index. We reuse the result for all connected validators with duties at that slot.\r\n\r\nWe probably wouldn't want to get rid of this optimization, but we could make the produceAttestationData call with a \"real\" committee index, eg: the committee index from the first duty in the list of duties for that slot.\r\n\r\nWould that resolve yall's issue?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1291021144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1291576989",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4687#issuecomment-1291576989",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
    "id": 1291576989,
    "node_id": "IC_kwDOCD5_Gc5M--ad",
    "user": {
      "login": "dB2510",
      "id": 37813203,
      "node_id": "MDQ6VXNlcjM3ODEzMjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/37813203?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dB2510",
      "html_url": "https://github.com/dB2510",
      "followers_url": "https://api.github.com/users/dB2510/followers",
      "following_url": "https://api.github.com/users/dB2510/following{/other_user}",
      "gists_url": "https://api.github.com/users/dB2510/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dB2510/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dB2510/subscriptions",
      "organizations_url": "https://api.github.com/users/dB2510/orgs",
      "repos_url": "https://api.github.com/users/dB2510/repos",
      "events_url": "https://api.github.com/users/dB2510/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dB2510/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-26T06:48:37Z",
    "updated_at": "2022-10-26T06:48:37Z",
    "author_association": "NONE",
    "body": "@wemeetagain yeah that would work for us üëç ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1291576989/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1294405774",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4687#issuecomment-1294405774",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
    "id": 1294405774,
    "node_id": "IC_kwDOCD5_Gc5NJxCO",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-28T03:32:07Z",
    "updated_at": "2022-10-28T03:32:07Z",
    "author_association": "MEMBER",
    "body": "Closing via #4695 ",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1294405774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403716069",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4687#issuecomment-1403716069",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
    "id": 1403716069,
    "node_id": "IC_kwDOCD5_Gc5TqwHl",
    "user": {
      "login": "dB2510",
      "id": 37813203,
      "node_id": "MDQ6VXNlcjM3ODEzMjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/37813203?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dB2510",
      "html_url": "https://github.com/dB2510",
      "followers_url": "https://api.github.com/users/dB2510/followers",
      "following_url": "https://api.github.com/users/dB2510/following{/other_user}",
      "gists_url": "https://api.github.com/users/dB2510/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dB2510/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dB2510/subscriptions",
      "organizations_url": "https://api.github.com/users/dB2510/orgs",
      "repos_url": "https://api.github.com/users/dB2510/repos",
      "events_url": "https://api.github.com/users/dB2510/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dB2510/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T14:33:54Z",
    "updated_at": "2023-01-27T04:34:36Z",
    "author_association": "NONE",
    "body": "Hey @wemeetagain üëã \r\nSorry for bumping up this issue. Actually the fix doesn't work for us. We call [GET attestation data endpoint](https://ethereum.github.io/beacon-APIs/#/Validator/produceAttestationData) endpoint for each validator public key like every other client and since AttestationData consists of beacon_block_root (LMD ghost vote) which is head block root, it can change between calls if we have multiple validators attesting in the same slot. This causes conflicts between lodestar and other VCs in the cluster as lodestar queries attestation_data once with 0 as committee_index.\r\n\r\nTherefore, lodestar is incompatible in distributed validator cluster with other validator clients like teku and lighthouse.\r\nWould you be open to some changes to this optimisation or something similar?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1403716069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1418240761",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4687#issuecomment-1418240761",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
    "id": 1418240761,
    "node_id": "IC_kwDOCD5_Gc5UiKL5",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-05T19:07:22Z",
    "updated_at": "2023-02-05T19:07:22Z",
    "author_association": "MEMBER",
    "body": "Proposed solution #5103 to resolve the Lodestar DVT compatibility issue",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1418240761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1481063238",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4687#issuecomment-1481063238",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4687",
    "id": 1481063238,
    "node_id": "IC_kwDOCD5_Gc5YRztG",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-23T11:57:56Z",
    "updated_at": "2023-03-23T11:57:56Z",
    "author_association": "MEMBER",
    "body": "Resolved by https://github.com/ChainSafe/lodestar/pull/5258",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1481063238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
