{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5409",
  "id": 1680948194,
  "node_id": "I_kwDOCD5_Gc5kMTvi",
  "number": 5409,
  "title": "Longer epoch transition time since capella",
  "user": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090446,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ2",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-medium",
      "name": "prio-medium",
      "color": "fdc09f",
      "default": false,
      "description": "Resolve this some time soon (tm)."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-04-24T10:32:22Z",
  "updated_at": "2023-05-05T03:08:50Z",
  "closed_at": "2023-05-05T03:08:50Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Epoch transition avg time on mainnet up from 700ms, 900ms\r\n\r\n![image](https://user-images.githubusercontent.com/35266934/233971261-921142f7-6a7d-4a6c-8601-be4999803710.png)\r\n\r\nAlso noting that there's significant variability on the times looking as histogram. The variability is previous to capella tho, would be cool to ensure it's a temporary issue (high GC) or that some states do indeed take more time to process\r\n\r\n![image](https://user-images.githubusercontent.com/35266934/233971612-8c017fa2-8a73-4c10-b318-5f047da20943.png)\r\n",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1529111648",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5409#issuecomment-1529111648",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409",
    "id": 1529111648,
    "node_id": "IC_kwDOCD5_Gc5bJGRg",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-30T18:39:30Z",
    "updated_at": "2023-04-30T18:39:30Z",
    "author_association": "MEMBER",
    "body": "Found bug attempting to resolve this.  Put up issue #5440 and am attempting to debug that to pull the historical data to run flamegraph and benchmarks for the pre-capella state on 4/1",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1529111648/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1535592640",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5409#issuecomment-1535592640",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409",
    "id": 1535592640,
    "node_id": "IC_kwDOCD5_Gc5bh0jA",
    "user": {
      "login": "matthewkeil",
      "id": 18608739,
      "node_id": "MDQ6VXNlcjE4NjA4NzM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/18608739?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthewkeil",
      "html_url": "https://github.com/matthewkeil",
      "followers_url": "https://api.github.com/users/matthewkeil/followers",
      "following_url": "https://api.github.com/users/matthewkeil/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthewkeil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthewkeil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthewkeil/subscriptions",
      "organizations_url": "https://api.github.com/users/matthewkeil/orgs",
      "repos_url": "https://api.github.com/users/matthewkeil/repos",
      "events_url": "https://api.github.com/users/matthewkeil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthewkeil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T01:37:46Z",
    "updated_at": "2023-05-05T01:40:18Z",
    "author_association": "MEMBER",
    "body": "@dapplion @tuyennhv On initial investigation it does not appear that the transitions should be taking significantly longer post capella.  The full transition is actually testing at 2% faster than pre-merge.  There are some inner functions that are running much hotter but the overall speed doesn't speak to the 700-900ms jump.\r\n\r\n\r\n## Before Capella (slot 6123583):\r\n\r\n| Test Name                                            | Ops/Second      | Time per Op  | Runs | Duration |\r\n|------------------------------------------------------|----------------:|-------------:|-----:|---------:|\r\n| altair processEpoch - mainnet_e191362               | 2.013578        | 496.6283 ms  | 12   | 6.49 s   |\r\n| mainnet_e191362 - altair beforeProcessEpoch         | 12.52470        | 79.84222 ms  | 33   | 3.27 s   |\r\n| mainnet_e191362 - altair processJustificationAndFinalization | 51203.28       | 19.53000 us  | 5183 | 7.32 s   |\r\n| mainnet_e191362 - altair processInactivityUpdates   | 93.13199        | 10.73745 ms  | 159  | 2.47 s   |\r\n| mainnet_e191362 - altair processRewardsAndPenalties | 15.85619        | 63.06684 ms  | 89   | 6.30 s   |\r\n| mainnet_e191362 - altair processRegistryUpdates     | 32946.76        | 30.35200 us  | 4820 | 7.00 s   |\r\n| mainnet_e191362 - altair processSlashings           | 464468.2        | 2.153000 us  | 3742 | 5.51 s   |\r\n| mainnet_e191362 - altair processEth1DataReset       | 1600000         | 625.0000 ns  | 445  | 1.68 s   |\r\n| mainnet_e191362 - altair processEffectiveBalanceUpdates | 460.9181        | 2.169583 ms  | 268  | 1.72 s   |\r\n| mainnet_e191362 - altair processSlashingsReset      | 112981.6        | 8.851000 us  | 3504 | 5.33 s   |\r\n| mainnet_e191362 - altair processRandaoMixesReset    | 102280.9        | 9.777000 us  | 6139 | 8.37 s   |\r\n| mainnet_e191362 - altair processHistoricalRootsUpdate | 484261.5        | 2.065000 us  | 4162 | 6.11 s   |\r\n| mainnet_e191362 - altair processParticipationFlagUpdates | 98765.43       | 10.12500 us  | 1357 | 2.80 s   |\r\n| mainnet_e191362 - altair processSyncCommitteeUpdates | 454338.9        | 2.201000 us  | 858  | 2.19 s   |\r\n| mainnet_e191362 - altair afterProcessEpoch          | 4.684762        | 213.4580 ms  | 12   | 3.58 s   |\r\n\r\n\r\n## After Capella (slot 6260415):\r\n\r\n| Test Name                                            | Ops/Second      | Time per Op  | Runs | Duration |\r\n|------------------------------------------------------|----------------:|-------------:|-----:|---------:|\r\n| altair processEpoch - mainnet_e195638               | 2.066960        | 483.8023 ms  | 17   | 8.81 s   |\r\n| mainnet_e195638 - altair beforeProcessEpoch         | 11.24121        | 88.95836 ms  | 42   | 4.39 s   |\r\n| mainnet_e195638 - altair processJustificationAndFinalization | 50443.91       | 19.82400 us  | 1630 | 3.15 s   |\r\n| mainnet_e195638 - altair processInactivityUpdates   | 100.6657        | 9.933875 ms  | 51   | 1.14 s   |\r\n| mainnet_e195638 - altair processRewardsAndPenalties | 16.76064        | 59.66359 ms  | 140  | 9.17 s   |\r\n| mainnet_e195638 - altair processRegistryUpdates     | 30983.73        | 32.27500 us  | 3022 | 4.82 s   |\r\n| mainnet_e195638 - altair processSlashings           | 598802.4        | 1.670000 us  | 1820 | 3.29 s   |\r\n| mainnet_e195638 - altair processEth1DataReset       | 669344.0        | 1.494000 us  | 1829 | 3.29 s   |\r\n| mainnet_e195638 - altair processEffectiveBalanceUpdates | 360.4157        | 2.774574 ms  | 79   | 1.00 s   |\r\n| mainnet_e195638 - altair processSlashingsReset      | 91684.24        | 10.90700 us  | 2374 | 4.14 s   |\r\n| mainnet_e195638 - altair processRandaoMixesReset    | 52273.92        | 19.13000 us  | 509  | 1.82 s   |\r\n| mainnet_e195638 - altair processHistoricalRootsUpdate | 461042.0        | 2.169000 us  | 4367 | 6.34 s   |\r\n| mainnet_e195638 - altair processParticipationFlagUpdates | 169520.3       | 5.899000 us  | 3086 | 4.84 s   |\r\n| mainnet_e195638 - altair processSyncCommitteeUpdates | 453103.8        | 2.207000 us  | 2250 | 3.79 s   |\r\n| mainnet_e195638 - altair afterProcessEpoch          | 4.751082        | 210.4784 ms  | 12   | 3.55 s   |\r\n\r\n\r\n## Diff Between Runs\r\n\r\n| Test Name                                            | % Δ Ops/Second | % Δ Time per Op | Δ Runs | Δ Duration |\r\n|------------------------------------------------------|---------------:|----------------:|-------:|-----------:|\r\n| altair processEpoch                                 | 2.586%         | -2.558%         | 5      | 2.32 s     |\r\n| beforeProcessEpoch                                  | -10.245%       | 11.431%         | 9      | 1.12 s     |\r\n| processJustificationAndFinalization                 | -1.504%        | 1.505%          | -3553  | -4.17 s    |\r\n| processInactivityUpdates                            | 8.107%         | -7.470%         | -108   | -1.33 s    |\r\n| processRewardsAndPenalties                          | 5.707%         | -5.413%         | 51     | 2.87 s     |\r\n| processRegistryUpdates                              | -5.964%        | 6.337%          | -1798  | -2.18 s    |\r\n| processSlashings                                    | 28.924%        | -22.289%        | -1922  | -2.22 s    |\r\n| processEth1DataReset                                | -58.274%       | 139.891%        | 1384   | 1.61 s     |\r\n| processEffectiveBalanceUpdates                      | -21.791%       | 27.916%         | -189   | -0.72 s    |\r\n| processSlashingsReset                               | -18.839%       | 30.323%         | -1130  | -1.19 s    |\r\n| processRandaoMixesReset                             | -48.854%       | 95.383%         | -5630  | -6.55 s    |\r\n| processHistoricalRootsUpdate                        | -4.804%        | 5.016%          | 205    | 0.23 s     |\r\n| processParticipationFlagUpdates                     | 72.031%        | -41.807%        | 1729   | 2.04 s     |\r\n| processSyncCommitteeUpdates                         | -0.273%        | 0.272%          | 1392   | 1.60 s     |\r\n| afterProcessEpoch                                   | 1.419%         | -1.389%         | 0      | -0.03 s    |\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1535592640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1535642574",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5409#issuecomment-1535642574",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5409",
    "id": 1535642574,
    "node_id": "IC_kwDOCD5_Gc5biAvO",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T03:08:50Z",
    "updated_at": "2023-05-05T03:08:50Z",
    "author_association": "MEMBER",
    "body": "@matthewkeil got it! Thanks for looking into this. Closing issue since them it's likely caused for other factors on hardware. We can revisit latter if we have more evidence",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1535642574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
