{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5349",
  "id": 1657747165,
  "node_id": "I_kwDOCD5_Gc5izzbd",
  "number": 5349,
  "title": "Mainnet crash on 1.7.2",
  "user": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-04-06T16:47:43Z",
  "updated_at": "2023-06-01T08:07:16Z",
  "closed_at": "2023-06-01T08:07:15Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Reported on discord: https://discord.com/channels/593655374469660673/593655641445367808/1093575346474979328\r\n\r\nmainnet crash on 1.7.2\r\n```\r\nApr-06 11:05:41.000[]                 info: Synced - slot: 6164126 - head: 6164126 0x6ed3…f6aa - execution: valid(0xdad7…264d) - finalized: 0xaba9…89b1:192626 - peers: 50\r\n\r\n<--- Last few GCs --->\r\n\r\n[5892:0x5ecba50] 438607189 ms: Scavenge (reduce) 3691.2 (3935.5) -> 3691.1 (3936.5) MB, 8.0 / 0.0 ms  (average mu = 0.981, current mu = 0.868) allocation failure;\r\n[5892:0x5ecba50] 438607818 ms: Mark-sweep (reduce) 4212.3 (4456.9) -> 3155.6 (4335.4) MB, 166.0 / 0.1 ms  (+ 17.5 ms in 341 steps since start of marking, biggest step 0.1 ms, walltime since start of marking 766 ms) (average mu = 0.975, current mu = 0.904)\r\n\r\n<--- JS stacktrace --->\r\n\r\nFATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\r\n 1: 0xb7b3e0 node::Abort() [node]\r\n 2: 0xa8c8aa  [node]\r\n 3: 0xd69100 v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, bool) [node]\r\n 4: 0xd694a7 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, bool) [node]\r\n 5: 0xf46ba5  [node]\r\n 6: 0xf5908d v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags) [node]\r\n 7: 0xf3378e v8::internal::HeapAllocator::AllocateRawWithLightRetrySlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [node]\r\n 8: 0xf34b57 v8::internal::HeapAllocator::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [node]\r\n 9: 0xf150a0 v8::internal::Factory::AllocateRaw(int, v8::internal::AllocationType, v8::internal::AllocationAlignment) [node]\r\n10: 0xf0cb14 v8::internal::FactoryBase<v8::internal::Factory>::AllocateRawWithImmortalMap(int, v8::internal::AllocationType, v8::internal::Map, v8::internal::AllocationAlignment) [node]\r\n11: 0xf0eea8 v8::internal::FactoryBase<v8::internal::Factory>::NewRawTwoByteString(int, v8::internal::AllocationType) [node]\r\n12: 0x11ec145 v8::internal::String::SlowFlatten(v8::internal::Isolate*, v8::internal::Handle<v8::internal::ConsString>, v8::internal::AllocationType) [node]\r\n13: 0xd74f0c v8::String::Utf8Length(v8::Isolate*) const [node]\r\n14: 0xc70c81 node::StringBytes::Size(v8::Isolate*, v8::Local<v8::Value>, node::encoding) [node]\r\n15: 0xc66cd7 node::StreamBase::Writev(v8::FunctionCallbackInfo<v8::Value> const&) [node]\r\n16: 0xc68d25 void node::StreamBase::JSMethod<&node::StreamBase::Writev>(v8::FunctionCallbackInfo<v8::Value> const&) [node]\r\n17: 0x168d3ef  [node]\r\n./lodestar: line 7:  5892 Aborted                 node --trace-deprecation --max-old-space-size=4096 ./packages/cli/bin/lodestar.js \"$@\"\r\n```\r\n",
  "closed_by": {
    "login": "dapplion",
    "id": 35266934,
    "node_id": "MDQ6VXNlcjM1MjY2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dapplion",
    "html_url": "https://github.com/dapplion",
    "followers_url": "https://api.github.com/users/dapplion/followers",
    "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
    "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
    "organizations_url": "https://api.github.com/users/dapplion/orgs",
    "repos_url": "https://api.github.com/users/dapplion/repos",
    "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dapplion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1500874013",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5349#issuecomment-1500874013",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349",
    "id": 1500874013,
    "node_id": "IC_kwDOCD5_Gc5ZdYUd",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-08T11:45:43Z",
    "updated_at": "2023-04-16T12:38:15Z",
    "author_association": "MEMBER",
    "body": "There seems to be a memory leak, heap bytes and rss are slowly increasing (2 days timeframe)\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/230719218-cedcfdc3-ff65-412b-93e6-22a3a41475e8.png)\r\n\r\n\r\nBeacon node heap profile after running for ~5 minutes ([1362403.clinic-heapprofiler.html.zip](https://github.com/ChainSafe/lodestar/files/11185338/1362403.clinic-heapprofiler.html.zip))\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/230770790-1d67f630-484e-4382-9c7b-637ca2b5e6f0.png)\r\n\r\n\r\nBeacon node heap profile after running for ~2 days ([252794.clinic-heapprofiler.html.zip](https://github.com/ChainSafe/lodestar/files/11183130/252794.clinic-heapprofiler.html.zip))\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/230719352-f24859bd-3b9f-4709-b048-73f0725e3c77.png)\r\n\r\n\r\nBeacon node heap profile after running for ~7 days ([1401875.clinic-heapprofiler.html.zip](https://github.com/ChainSafe/lodestar/files/11242278/1401875.clinic-heapprofiler.html.zip))\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/232311637-df87d14f-51fe-4477-a33c-6b2f4907bf23.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1500874013/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1509510245",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5349#issuecomment-1509510245",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349",
    "id": 1509510245,
    "node_id": "IC_kwDOCD5_Gc5Z-Uxl",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-15T04:59:05Z",
    "updated_at": "2023-04-15T04:59:05Z",
    "author_association": "MEMBER",
    "body": "I'm seeing something very similar on my node as well. But I can't tell if it had something to do with the Shapella fork as it has a noticeable increase around the same time... but it has been growing since.\r\n\r\n<img width=\"811\" alt=\"Screenshot 2023-04-15 at 12 57 25 AM\" src=\"https://user-images.githubusercontent.com/58080811/232183925-a42bdb45-34e0-46cf-8a33-f2c0ce538339.png\">\r\n\r\n<img width=\"808\" alt=\"Screenshot 2023-04-15 at 12 58 29 AM\" src=\"https://user-images.githubusercontent.com/58080811/232183952-f43ebc1f-b80b-45f7-8021-5914be6b3853.png\">\r\n\r\nTimes are in UTC.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1509510245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1536030354",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5349#issuecomment-1536030354",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349",
    "id": 1536030354,
    "node_id": "IC_kwDOCD5_Gc5bjfaS",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T10:07:43Z",
    "updated_at": "2023-05-05T10:07:43Z",
    "author_association": "MEMBER",
    "body": "Memory usage seems stable again (7 days timeframe), running from `unstable` branch, not really sure what fixed it but looks good, consistently below 4GB and I am running a VC with 2k keys (on goerli)\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/236430054-8296340b-0152-4c31-bfe4-d96c3ec90550.png)\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/38436224/236430143-269c36e8-0568-49a3-baf1-83b2aee06059.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1536030354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1539396252",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5349#issuecomment-1539396252",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349",
    "id": 1539396252,
    "node_id": "IC_kwDOCD5_Gc5bwVKc",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-09T04:40:58Z",
    "updated_at": "2023-05-09T04:40:58Z",
    "author_association": "MEMBER",
    "body": "Is this `unstable` on _mainnet_ for the last 7 days? Without much more information provided, it feels like this issue is a dead-end investigation of what potentially happened here...",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1539396252/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1571564698",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5349#issuecomment-1571564698",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5349",
    "id": 1571564698,
    "node_id": "IC_kwDOCD5_Gc5drCya",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-01T08:07:15Z",
    "updated_at": "2023-06-01T08:07:15Z",
    "author_association": "MEMBER",
    "body": "- Closing for https://github.com/ChainSafe/lodestar/issues/5549, and noted there as preceding incident",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1571564698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
