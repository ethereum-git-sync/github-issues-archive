{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2996",
  "id": 976896664,
  "node_id": "MDU6SXNzdWU5NzY4OTY2NjQ=",
  "number": 2996,
  "title": "uncaughtException: cb is not a function",
  "user": {
    "login": "q9f",
    "id": 58883403,
    "node_id": "MDQ6VXNlcjU4ODgzNDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/q9f",
    "html_url": "https://github.com/q9f",
    "followers_url": "https://api.github.com/users/q9f/followers",
    "following_url": "https://api.github.com/users/q9f/following{/other_user}",
    "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
    "organizations_url": "https://api.github.com/users/q9f/orgs",
    "repos_url": "https://api.github.com/users/q9f/repos",
    "events_url": "https://api.github.com/users/q9f/events{/privacy}",
    "received_events_url": "https://api.github.com/users/q9f/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090446,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ2",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-medium",
      "name": "prio-medium",
      "color": "fdc09f",
      "default": false,
      "description": "Resolve this some time soon (tm)."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-23T10:51:03Z",
  "updated_at": "2022-02-15T15:17:49Z",
  "closed_at": "2022-02-15T15:17:49Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nMainnet sync throws:\r\n\r\n```\r\nAug-23 12:48:21.949 []                error: uncaughtException: cb is not a function\r\nTypeError: cb is not a function\r\n```\r\n\r\nIt does continue to sync though.\r\n\r\n**Expected behavior**\r\n\r\nHandle that exception.\r\n\r\n**Screenshots**\r\n\r\n```\r\nAug-23 12:47:41.076 []                 info: Syncing - 15 hours left - 31.3 slots/s - head: 204255 0x5f5a…c92c - finalized: 204160 0x1356…5be6 (6380) - clockSlot: 1907636 - peers: 21\r\nAug-23 12:47:53.004 []                 info: Syncing - 15 hours left - 31.7 slots/s - head: 204680 0x277e…1cd0 - finalized: 204608 0x9706…d434 (6394) - clockSlot: 1907637 - peers: 21\r\nAug-23 12:48:05.000 []                 info: Syncing - 15 hours left - 30.6 slots/s - head: 205056 0x9599…f296 - finalized: 204992 0x799d…5871 (6406) - clockSlot: 1907638 - peers: 22\r\nAug-23 12:48:17.002 []                 info: Syncing - 17 hours left - 28.2 slots/s - head: 205056 0x9599…f296 - finalized: 204992 0x799d…5871 (6406) - clockSlot: 1907639 - peers: 21\r\nAug-23 12:48:21.949 []                error: uncaughtException: cb is not a function\r\nTypeError: cb is not a function\r\n    at /home/user/.opt/chainsafe/lodestar/node_modules/@motrix/nat-api/index.js:336:7\r\n    at /home/user/.opt/chainsafe/lodestar/node_modules/@motrix/nat-api/lib/upnp/device.js:61:11\r\n    at Parser.<anonymous> (/home/user/.opt/chainsafe/lodestar/node_modules/xml2js/lib/parser.js:304:18)\r\n    at Parser.emit (events.js:400:28)\r\n    at Parser.emit (domain.js:470:12)\r\n    at SAXParser.onclosetag (/home/user/.opt/chainsafe/lodestar/node_modules/xml2js/lib/parser.js:262:26)\r\n    at emit (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:624:35)\r\n    at emitNode (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:629:5)\r\n    at closeTag (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:889:7)\r\n    at SAXParser.write (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:1436:13) message=cb is not a function\r\nTypeError: cb is not a function\r\n    at /home/user/.opt/chainsafe/lodestar/node_modules/@motrix/nat-api/index.js:336:7\r\n    at /home/user/.opt/chainsafe/lodestar/node_modules/@motrix/nat-api/lib/upnp/device.js:61:11\r\n    at Parser.<anonymous> (/home/user/.opt/chainsafe/lodestar/node_modules/xml2js/lib/parser.js:304:18)\r\n    at Parser.emit (events.js:400:28)\r\n    at Parser.emit (domain.js:470:12)\r\n    at SAXParser.onclosetag (/home/user/.opt/chainsafe/lodestar/node_modules/xml2js/lib/parser.js:262:26)\r\n    at emit (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:624:35)\r\n    at emitNode (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:629:5)\r\n    at closeTag (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:889:7)\r\n    at SAXParser.write (/home/user/.opt/chainsafe/lodestar/node_modules/sax/lib/sax.js:1436:13)\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n- OS: Archlinux\r\n- Version: 0.29.0 (tag)\r\n",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/903958049",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2996#issuecomment-903958049",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996",
    "id": 903958049,
    "node_id": "IC_kwDOCD5_Gc414U4h",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-23T17:11:25Z",
    "updated_at": "2021-08-23T17:11:25Z",
    "author_association": "MEMBER",
    "body": "That's so strange, what code can be parsing xml with `xml2js`?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/903958049/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1038317847",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2996#issuecomment-1038317847",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996",
    "id": 1038317847,
    "node_id": "IC_kwDOCD5_Gc4943kX",
    "user": {
      "login": "twopercent",
      "id": 1375518,
      "node_id": "MDQ6VXNlcjEzNzU1MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1375518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/twopercent",
      "html_url": "https://github.com/twopercent",
      "followers_url": "https://api.github.com/users/twopercent/followers",
      "following_url": "https://api.github.com/users/twopercent/following{/other_user}",
      "gists_url": "https://api.github.com/users/twopercent/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/twopercent/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/twopercent/subscriptions",
      "organizations_url": "https://api.github.com/users/twopercent/orgs",
      "repos_url": "https://api.github.com/users/twopercent/repos",
      "events_url": "https://api.github.com/users/twopercent/events{/privacy}",
      "received_events_url": "https://api.github.com/users/twopercent/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-13T18:21:26Z",
    "updated_at": "2022-02-13T18:21:26Z",
    "author_association": "NONE",
    "body": "My node was syncing (```lodestar beacon --eth1.enabled false```) for a few days, but now I see this error ```error: uncaughtException: cb is not a function``` as far back as I can scroll. It ended with a core dump:\r\n```\r\nTypeError: cb is not a function\r\n    at /home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/@motrix/nat-api/index.js:324:16\r\n    at Request._callback (/home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/@motrix/nat-api/lib/upnp/device.js:46:25)\r\n    at self.callback (/home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/request/request.js:185:22)\r\n    at Request.emit (node:events:520:28)\r\n    at Request.emit (node:domain:475:12)\r\n    at Request.onRequestError (/home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/request/request.js:877:8)\r\n    at ClientRequest.emit (node:events:520:28)\r\n    at ClientRequest.emit (node:domain:475:12)\r\n    at Socket.socketErrorListener (node:_http_client:442:9)\r\n    at Socket.emit (node:events:520:28) message=cb is not a function\r\nTypeError: cb is not a function\r\n    at /home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/@motrix/nat-api/index.js:324:16\r\n    at Request._callback (/home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/@motrix/nat-api/lib/upnp/device.js:46:25)\r\n    at self.callback (/home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/request/request.js:185:22)\r\n    at Request.emit (node:events:520:28)\r\n    at Request.emit (node:domain:475:12)\r\n    at Request.onRequestError (/home/chris/.nvm/versions/node/v16.14.0/lib/node_modules/@chainsafe/lodestar-cli/node_modules/request/request.js:877:8)\r\n    at ClientRequest.emit (node:events:520:28)\r\n    at ClientRequest.emit (node:domain:475:12)\r\n    at Socket.socketErrorListener (node:_http_client:442:9)\r\n    at Socket.emit (node:events:520:28)\r\n\r\n<--- Last few GCs --->\r\n\r\n[12946:0x4e338e0] 125790461 ms: Mark-sweep 2022.8 (2090.5) -> 2009.8 (2093.5) MB, 2059.7 / 3.9 ms  (average mu = 0.830, current mu = 0.405) allocation failure scavenge might not succeed\r\n[12946:0x4e338e0] 125794865 ms: Mark-sweep 2026.0 (2093.8) -> 2013.0 (2096.3) MB, 3014.4 / 3.4 ms  (average mu = 0.674, current mu = 0.316) allocation failure scavenge might not succeed\r\n\r\n\r\n<--- JS stacktrace --->\r\n\r\nFATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\r\n 1: 0xb09980 node::Abort() [node]\r\n 2: 0xa1c235 node::FatalError(char const*, char const*) [node]\r\n 3: 0xcf77be v8::Utils::ReportOOMFailure(v8::internal::Isolate*, char const*, bool) [node]\r\n 4: 0xcf7b37 v8::internal::V8::FatalProcessOutOfMemory(v8::internal::Isolate*, char const*, bool) [node]\r\n 5: 0xeaf3d5  [node]\r\n 6: 0xebf09d v8::internal::Heap::CollectGarbage(v8::internal::AllocationSpace, v8::internal::GarbageCollectionReason, v8::GCCallbackFlags) [node]\r\n 7: 0xec1d9e v8::internal::Heap::AllocateRawWithRetryOrFailSlowPath(int, v8::internal::AllocationType, v8::internal::AllocationOrigin, v8::internal::AllocationAlignment) [node]\r\n 8: 0xe832da v8::internal::Factory::NewFillerObject(int, bool, v8::internal::AllocationType, v8::internal::AllocationOrigin) [node]\r\n 9: 0x11fc026 v8::internal::Runtime_AllocateInYoungGeneration(int, unsigned long*, v8::internal::Isolate*) [node]\r\n10: 0x15f0a99  [node]\r\nAborted (core dumped)\r\n```\r\n\r\n**OS:** Ubuntu 20.04.3 LTS\r\n**node:** v16.14.0",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1038317847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1040184174",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2996#issuecomment-1040184174",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2996",
    "id": 1040184174,
    "node_id": "IC_kwDOCD5_Gc49__Nu",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-15T11:53:36Z",
    "updated_at": "2022-02-15T11:53:36Z",
    "author_association": "MEMBER",
    "body": "Hi @twopercent thanks for reporting! Are you running your node in a cloud instance or local machine? Could you provide more details about your host machine and network it's connected to?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1040184174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
