{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/5846",
  "id": 1836035504,
  "node_id": "I_kwDOCD5_Gc5tb62w",
  "number": 5846,
  "title": "Not able to download finalized state",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5670219610,
      "node_id": "LA_kwDOCD5_Gc8AAAABUfivWg",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/meta-bug",
      "name": "meta-bug",
      "color": "E79553",
      "default": false,
      "description": "Issues that identify a bug and require a fix."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "wemeetagain",
      "id": 1348242,
      "node_id": "MDQ6VXNlcjEzNDgyNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wemeetagain",
      "html_url": "https://github.com/wemeetagain",
      "followers_url": "https://api.github.com/users/wemeetagain/followers",
      "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
      "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
      "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
      "repos_url": "https://api.github.com/users/wemeetagain/repos",
      "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-08-04T04:14:51Z",
  "updated_at": "2023-10-17T02:56:27Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nDownloading a finalized slot on mainnet: `curl -H \"Accept: application/octet-stream\" http://127.0.0.1:9596/eth/v2/debug/beacon/states/7024415 -o mainnet_state_7024415.ssz`\r\n\r\nand it returned\r\n\r\n```json\r\n{\"statusCode\":404,\"error\":\"Not Found\",\"message\":\"No state found for id '7024415'\"}\r\n```\r\n\r\nif I download by state root: `curl -H \"Accept: application/octet-stream\" http://127.0.0.1:9596/eth/v2/debug/beacon/states/0xd27419094c269f3f1069b0dbe754eccb9e073ab6023cf8cf910eb07e29866723 -o mainnet_state_7024415.ssz`\r\n\r\nI got\r\n\r\n```json\r\n{\"statusCode\":500,\"error\":\"Internal Server Error\",\"message\":\"REGEN_ERROR_NO_SEED_STATE\"}\r\n```\n\n### Expected behavior\n\nshould be able to download state\n\n### Steps to reproduce\n\n_No response_\n\n### Additional context\n\n_No response_\n\n### Operating system\n\nLinux\n\n### Lodestar version or commit hash\n\nv1.9.2",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1665102566",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5846#issuecomment-1665102566",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846",
    "id": 1665102566,
    "node_id": "IC_kwDOCD5_Gc5jP3Lm",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-04T06:53:50Z",
    "updated_at": "2023-08-04T06:53:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "a regular lodestar node just store some finalized epochs every 32 or 1024 epochs, also regen does not support for finalized slot",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1665102566/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1729051567",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5846#issuecomment-1729051567",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846",
    "id": 1729051567,
    "node_id": "IC_kwDOCD5_Gc5nDzuv",
    "user": {
      "login": "yrong",
      "id": 4383920,
      "node_id": "MDQ6VXNlcjQzODM5MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4383920?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yrong",
      "html_url": "https://github.com/yrong",
      "followers_url": "https://api.github.com/users/yrong/followers",
      "following_url": "https://api.github.com/users/yrong/following{/other_user}",
      "gists_url": "https://api.github.com/users/yrong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yrong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yrong/subscriptions",
      "organizations_url": "https://api.github.com/users/yrong/orgs",
      "repos_url": "https://api.github.com/users/yrong/repos",
      "events_url": "https://api.github.com/users/yrong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yrong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-21T07:58:41Z",
    "updated_at": "2023-09-21T07:58:41Z",
    "author_association": "NONE",
    "body": "Is there any way to increase the cached size for beacon states?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1729051567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1729847506",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5846#issuecomment-1729847506",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846",
    "id": 1729847506,
    "node_id": "IC_kwDOCD5_Gc5nG2DS",
    "user": {
      "login": "nflaig",
      "id": 38436224,
      "node_id": "MDQ6VXNlcjM4NDM2MjI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38436224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nflaig",
      "html_url": "https://github.com/nflaig",
      "followers_url": "https://api.github.com/users/nflaig/followers",
      "following_url": "https://api.github.com/users/nflaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/nflaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nflaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nflaig/subscriptions",
      "organizations_url": "https://api.github.com/users/nflaig/orgs",
      "repos_url": "https://api.github.com/users/nflaig/repos",
      "events_url": "https://api.github.com/users/nflaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nflaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-21T15:46:13Z",
    "updated_at": "2023-09-25T11:57:29Z",
    "author_association": "MEMBER",
    "body": "> Is there any way to increase the cached size for beacon states?\r\n\r\nWhat exactly do you mean by cached size?\r\n\r\nThe max number of states allowed in the cache is 96 right now, this is not configurable but this value should also not be relevant for end users.\r\nhttps://github.com/ChainSafe/lodestar/blob/d9889745f52c2e13b0d011bfd9ab98c59f41f06b/packages/beacon-node/src/chain/stateCache/stateContextCache.ts#L8\r\n\r\nFinalized states are pruned and can no longer be retrieved from the cache, irrespective of the max number of allowed states.\r\nhttps://github.com/ChainSafe/lodestar/blob/d9889745f52c2e13b0d011bfd9ab98c59f41f06b/packages/beacon-node/src/chain/archiver/index.ts#L106\r\n\r\nIf you want to be able to query finalized states from Lodestar you have to set `--chain.archiveStateEpochFrequency 1`. This would allow to query the state of the start slot in the epoch (`epoch * 32`) but your disk requirements will increase significantly. \r\n\r\nWhile looking at this I also noticed this only persists the state every second epoch, will be fixed by https://github.com/ChainSafe/lodestar/pull/5979.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1729847506/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1757110515",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/5846#issuecomment-1757110515",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/5846",
    "id": 1757110515,
    "node_id": "IC_kwDOCD5_Gc5ou2Dz",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T08:24:50Z",
    "updated_at": "2023-10-11T08:24:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "according to this, all other clients support regenerating a finalized state while lodestar is not https://discord.com/channels/593655374469660673/1062235362509996112/1161371178728968244\r\n\r\nat least I see lighthouse does this https://github.com/sigp/lighthouse/blob/v4.5.0/beacon_node/http_api/src/state_id.rs#L194\r\n\r\none important thing to note is other clients may handle http requests in a separate thread while lodestar is not and this request could blow up the node, we may need to consider offloading this work to a worker thread in order not to affect the node",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1757110515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
