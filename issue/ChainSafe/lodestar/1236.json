{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/1236",
  "id": 666192716,
  "node_id": "MDU6SXNzdWU2NjYxOTI3MTY=",
  "number": 1236,
  "title": "Restart chain: cannot read property blockRoot of null",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090453,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDUz",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-low",
      "name": "prio-low",
      "color": "fde2b4",
      "default": false,
      "description": "This is nice to have."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-07-27T10:47:45Z",
  "updated_at": "2020-09-02T02:23:27Z",
  "closed_at": "2020-09-02T02:23:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n```\r\n2020-07-27 17:42:36  [CHAIN]            info: Found 517 nonfinalized blocks in database from slot 199840 to 200591\r\n2020-07-27 17:42:36  [CHAIN]            info: Found finalized block at slot 199840,\r\n        root=0x515279f057f1bf9c2aa73a86382919b4625b978996896364a72cffe6b8ef67e9\r\n2020-07-27 17:42:36  [CHAIN]            info: Initialize forkchoice with pre-finalized blocks from 199808 to 199839\r\n        and finalized block 199840\r\n2020-07-27 17:42:37  [CHAIN]            info: Start processing from slot 199841 to 200591 to rebuild state cache and forkchoice\r\n2020-07-27 17:42:37  [CHAIN]            info: Processed new chain head newChainHeadRoot=0x7be93ca8a01776763d7dfaed24d50d8f88f0bdaf02ff38acc5be93ec9b6c5c5b, slot=199841, epoch=6245\r\n...\r\n2020-07-27 17:43:22  [CHAIN]            info: Processed new chain head newChainHeadRoot=0xaa93fb7109d17c3cc4cf9b05560bd351b25a119c80411ff362ad28a7d0c79b22, slot=200514, epoch=6266\r\n2020-07-27 17:43:22  [CHAIN]            info: Processed new chain head newChainHeadRoot=0x7c674be2b017066070005e0a8728be8aaacd2bb98918a4aa3b7c7582c05e58d0, slot=200515, epoch=6266\r\n2020-07-27 17:43:22  [CHAIN]            info: Processed new chain head newChainHeadRoot=0xed3b8669173b6002dce72dddfefc902e137f378f1c70b2e0b7666f6adb4292b3, slot=200516, epoch=6266\r\n2020-07-27 17:43:23  [CHAIN]            info: Processed new chain head newChainHeadRoot=0x13a73bcf04ad672abac20eb918daff1ded0bd0c63f8f6de11f7b5a608bf8019e, slot=200519, epoch=6266\r\n(node:24600) UnhandledPromiseRejectionWarning: TypeError: Cannot read property 'blockRoot' of null\r\n    at /Users/tuyennguyen/Projects/workshop/lodestar/packages/lodestar/lib/chain/blocks/post.js:46:71\r\n(node:24600) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)\r\n(node:24600) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\r\n```\r\nThis rarely happens.\r\n",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/664367574",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1236#issuecomment-664367574",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236",
    "id": 664367574,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NDM2NzU3NA==",
    "user": {
      "login": "dapplion",
      "id": 35266934,
      "node_id": "MDQ6VXNlcjM1MjY2OTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35266934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dapplion",
      "html_url": "https://github.com/dapplion",
      "followers_url": "https://api.github.com/users/dapplion/followers",
      "following_url": "https://api.github.com/users/dapplion/following{/other_user}",
      "gists_url": "https://api.github.com/users/dapplion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dapplion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dapplion/subscriptions",
      "organizations_url": "https://api.github.com/users/dapplion/orgs",
      "repos_url": "https://api.github.com/users/dapplion/repos",
      "events_url": "https://api.github.com/users/dapplion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dapplion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-27T12:31:44Z",
    "updated_at": "2020-07-27T12:31:44Z",
    "author_association": "MEMBER",
    "body": "`forkChoice.getCanonicalBlockSummaryAtSlot(preSlot)` can return `null`, but since we have `\"strictNullChecks\": false` Typescript doesn't raise a compilation error",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/664367574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/664399207",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1236#issuecomment-664399207",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236",
    "id": 664399207,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NDM5OTIwNw==",
    "user": {
      "login": "mpetrunic",
      "id": 8836210,
      "node_id": "MDQ6VXNlcjg4MzYyMTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8836210?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mpetrunic",
      "html_url": "https://github.com/mpetrunic",
      "followers_url": "https://api.github.com/users/mpetrunic/followers",
      "following_url": "https://api.github.com/users/mpetrunic/following{/other_user}",
      "gists_url": "https://api.github.com/users/mpetrunic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mpetrunic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mpetrunic/subscriptions",
      "organizations_url": "https://api.github.com/users/mpetrunic/orgs",
      "repos_url": "https://api.github.com/users/mpetrunic/repos",
      "events_url": "https://api.github.com/users/mpetrunic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mpetrunic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-27T13:33:18Z",
    "updated_at": "2020-07-27T13:33:18Z",
    "author_association": "MEMBER",
    "body": "But if it returned null, that means that preSlot block is not in forkchoice which should be impossible since earlier, we managed to get block for that slot by root.\r\n\r\nThis would indicate that there could be bug in forkchoice?",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/664399207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/666979899",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1236#issuecomment-666979899",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236",
    "id": 666979899,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Njk3OTg5OQ==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-31T07:33:16Z",
    "updated_at": "2020-07-31T07:33:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is the forkchoice tree (there are some missing blocks):\r\n\r\n```\r\n200510 - 200514 - 200515 - 200516 - 200520 (latest head)\r\n       \\\r\n      200518 - 200519 (orphan branch)\r\n```\r\n         \r\nThis happened when we already processed block 200519 (`Processed new chain head ... 200519`) and post process 200518 (`Cannot read property 'blockRoot' of null`): we found that 200518 is in a different epoch compared to its parent slot 200510 and we emit `processedCheckpoint`, then we call `forkchoice.getCanonicalBlockSummaryAtSlot(200510)` but forkchoice head may switched to 200520 branch and we're not able to get block root for 200510 using `getCanonicalBlockSummaryAtSlot`.\r\n\r\nIn this error we can get from `parentRoot` instead of forkchoice, the concern is the use of `getCanonicalBlockSummaryAtSlot` in other places which may return null while we can also use `getBlockSummariesAtSlot`.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/666979899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/685246054",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/1236#issuecomment-685246054",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/1236",
    "id": 685246054,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTI0NjA1NA==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-02T02:23:25Z",
    "updated_at": "2020-09-02T02:23:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "`packages/lodestar/src/chain/blocks/process.ts` was modified accordingly so this should not be an issue anymore",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/685246054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
