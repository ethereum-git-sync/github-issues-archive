{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/4669",
  "id": 1414716574,
  "node_id": "I_kwDOCD5_Gc5UUtye",
  "number": 4669,
  "title": "v1.2.0: High gc time compared to old libp2p",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1200090447,
      "node_id": "MDU6TGFiZWwxMjAwMDkwNDQ3",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/prio-high",
      "name": "prio-high",
      "color": "fd9579",
      "default": false,
      "description": "Resolve issues as soon as possible."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-10-19T10:30:14Z",
  "updated_at": "2022-11-04T05:10:19Z",
  "closed_at": "2022-10-31T01:57:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nAfter we migrate libp2p2 0.39.2, the `gc` percentage is higher\r\n\r\n- On beta v1.2.0 lg1k\r\n\r\n<img width=\"1238\" alt=\"Screen Shot 2022-10-19 at 17 27 17\" src=\"https://user-images.githubusercontent.com/10568965/196666434-00254162-0151-450f-8d6b-67350c681078.png\">\r\n\r\n- On stable v1.1.0 lg1k\r\n\r\n<img width=\"1245\" alt=\"Screen Shot 2022-10-19 at 17 24 57\" src=\"https://user-images.githubusercontent.com/10568965/196665927-3f95d978-e7c2-4b9a-abe5-11f9f2e52a95.png\">\r\n\r\n- On beta v1.2.0 novc\r\n\r\n<img width=\"1221\" alt=\"Screen Shot 2022-10-19 at 17 25 33\" src=\"https://user-images.githubusercontent.com/10568965/196666062-15924ecf-511d-4714-909c-3598707fde76.png\">\r\n\r\n- On stable v1.1.0 novc\r\n\r\n<img width=\"1238\" alt=\"Screen Shot 2022-10-19 at 17 26 24\" src=\"https://user-images.githubusercontent.com/10568965/196666256-5562796e-d325-4c33-b5e2-dae9b4320b49.png\">\r\n\r\nThis causes a lot of apis to run slower\r\n\r\n<img width=\"570\" alt=\"Screen Shot 2022-10-19 at 17 28 38\" src=\"https://user-images.githubusercontent.com/10568965/196666735-efb0ee46-5fbc-491e-b13a-9e9f62aed330.png\">\r\n\r\n\r\n[1019_feat2_lg1k_1.2.0_rc.0.cpuprofile.zip](https://github.com/ChainSafe/lodestar/files/9819579/1019_feat2_lg1k_1.2.0_rc.0.cpuprofile.zip)\r\n\r\nThis could affect https://github.com/ChainSafe/lodestar/issues/4660\r\n\r\n**Expected behavior**\r\n\r\nSame gc run time to stable\r\n",
  "closed_by": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1283785301",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4669#issuecomment-1283785301",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669",
    "id": 1283785301,
    "node_id": "IC_kwDOCD5_Gc5MhQJV",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-19T10:31:22Z",
    "updated_at": "2022-10-19T10:31:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "First effort https://github.com/libp2p/js-libp2p-multistream-select/pull/28",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1283785301/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1284876335",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4669#issuecomment-1284876335",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669",
    "id": 1284876335,
    "node_id": "IC_kwDOCD5_Gc5Mlagv",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-20T03:41:18Z",
    "updated_at": "2022-10-20T03:41:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "every time we call `chacha20poly1305` it runs gc because we create temporary Uint8Array instances there\r\n\r\n<img width=\"1420\" alt=\"Screen Shot 2022-10-20 at 10 40 32\" src=\"https://user-images.githubusercontent.com/10568965/196850987-06dfdf00-a92b-4ee1-8ef1-c3364429f773.png\">\r\n\r\nthis could be improved if we implement wasm version of this protocol in https://github.com/ChainSafe/lodestar/issues/4652\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1284876335/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 2
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1292852464",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4669#issuecomment-1292852464",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669",
    "id": 1292852464,
    "node_id": "IC_kwDOCD5_Gc5ND1zw",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-27T01:35:27Z",
    "updated_at": "2022-10-27T01:35:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "`as-chacha20poly1305` work does not help much, the issue also happens on a `novc` node (even with a workaround version to use `is-ip` 4.0.0 in #4689). We need to come up with tests of basic node setup to narrow down the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1292852464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1296440279",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4669#issuecomment-1296440279",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669",
    "id": 1296440279,
    "node_id": "IC_kwDOCD5_Gc5NRhvX",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-31T01:57:31Z",
    "updated_at": "2022-10-31T01:57:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "issue is resolved via https://github.com/ChainSafe/lodestar/pull/4699\r\n\r\nv1.2.0-rc.1 metrics\r\n\r\n- novc\r\n\r\n<img width=\"791\" alt=\"Screen Shot 2022-10-31 at 08 56 16\" src=\"https://user-images.githubusercontent.com/10568965/198915656-a7b35e05-e647-42c0-9cda-4ec1ad8cb068.png\">\r\n\r\n- lg1k\r\n\r\n<img width=\"807\" alt=\"Screen Shot 2022-10-31 at 08 56 40\" src=\"https://user-images.githubusercontent.com/10568965/198915716-8c87d2c3-9c17-42a8-9654-de18eb999de0.png\">\r\n\r\nthese metrics are the same to stable group (v1.1.1)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1296440279/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1302976245",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/4669#issuecomment-1302976245",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/4669",
    "id": 1302976245,
    "node_id": "IC_kwDOCD5_Gc5Nqdb1",
    "user": {
      "login": "philknows",
      "id": 58080811,
      "node_id": "MDQ6VXNlcjU4MDgwODEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/58080811?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/philknows",
      "html_url": "https://github.com/philknows",
      "followers_url": "https://api.github.com/users/philknows/followers",
      "following_url": "https://api.github.com/users/philknows/following{/other_user}",
      "gists_url": "https://api.github.com/users/philknows/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/philknows/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/philknows/subscriptions",
      "organizations_url": "https://api.github.com/users/philknows/orgs",
      "repos_url": "https://api.github.com/users/philknows/repos",
      "events_url": "https://api.github.com/users/philknows/events{/privacy}",
      "received_events_url": "https://api.github.com/users/philknows/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-04T05:06:52Z",
    "updated_at": "2022-11-04T05:10:19Z",
    "author_association": "MEMBER",
    "body": "Adding note for reference, libp2p metrics was causing this. Fixed by disabling here: https://github.com/ChainSafe/lodestar/pull/4699\r\n\r\nFollowed up for investigation under #4698.",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1302976245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
