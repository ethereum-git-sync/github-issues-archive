{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/3644",
  "id": 1109130136,
  "node_id": "I_kwDOCD5_Gc5CG_uY",
  "number": 3644,
  "title": "Kurtosis [Merge testnet] runs: lodestar nodes downscores and loose each other incase ELs don't sync up",
  "user": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3352623099,
      "node_id": "MDU6TGFiZWwzMzUyNjIzMDk5",
      "url": "https://api.github.com/repos/ChainSafe/lodestar/labels/spec-bellatrix%20%F0%9F%90%BC",
      "name": "spec-bellatrix üêº",
      "color": "6baed6",
      "default": false,
      "description": "Issues targeting the merge spec version."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-20T10:32:51Z",
  "updated_at": "2023-01-27T17:42:32Z",
  "closed_at": "2023-01-27T17:42:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Scenario\r\nSometimes in the mergenet runs, on the `bellatrix` epoch when the execution payload starts to come in, the respective EL are generally at diffierent TTD blocks, and hence respond with `SYNCING` status.\r\nBecause as per optimistic spec, we can't accept block with SYNCING staus at the merge transition, and the EL's are supposed to sync up, so that one of the EL stops giving syncing status.\r\n\r\nHowever, if the ELs don't sync up fast enought, the each other nodes start rejecting each other blocks, resulting into the each banning the other and loosing the peers.\r\n\r\nExpected:\r\nThe CLs should not loose each other and at some point resolve the chain in the favor of one or the other.\r\n \r\nExample log:\r\nNode 0:\r\nat bellatrix(merge epoch):\r\n```\r\nJan-20 09:18:38.501 []                 info: Synced - slot: 63 - head: 63 0x7ad7‚Ä¶35db - finalized: 0x0000‚Ä¶0000:0 - peers: 1\r\nJan-20 09:18:41.509 []                 info: Synced - slot: 64 - head: 64 0xc54e‚Ä¶2598 - execution: valid(0x3e0d‚Ä¶22c0) - finalized: 0x0000‚Ä¶0000:0 - peers: 1\r\nJan-20 09:18:43.432 [CHAIN]           error: Block error slot=65, errCode=BLOCK_ERROR_EXECUTION_ERROR code=BLOCK_ERROR_EXECUTION_ERROR, errorMessage=not safe to import SYNCING payload within 128 of currentSlot\r\nError: BLOCK_ERROR_EXECUTION_ERROR\r\n    at verifyBlockStateTransition (/usr/app/packages/lodestar/src/chain/blocks/verifyBlock.ts:231:17)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at verifyBlock (/usr/app/packages/lodestar/src/chain/blocks/verifyBlock.ts:46:40)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/index.ts:64:32)\r\n    at Timeout.JobItemQueue.runJob [as _onTimeout] (/usr/app/packages/lodestar/src/util/queue/itemQueue.ts:85:22)\r\nJan-20 09:18:43.433 [NETWORK] \r\n```\r\nafter couple of such errors:\r\n```\r\nJan-20 09:18:55.353 [CHAIN]           error: Block error slot=65, errCode=BLOCK_ERROR_EXECUTION_ERROR code=BLOCK_ERROR_EXECUTION_ERROR, errorMessage=not safe to import SYNCING payload within 128 of currentSlot\r\nError: BLOCK_ERROR_EXECUTION_ERROR\r\n    at verifyBlockStateTransition (/usr/app/packages/lodestar/src/chain/blocks/verifyBlock.ts:231:17)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at verifyBlock (/usr/app/packages/lodestar/src/chain/blocks/verifyBlock.ts:46:40)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/index.ts:64:32)\r\n    at Timeout.JobItemQueue.runJob [as _onTimeout] (/usr/app/packages/lodestar/src/util/queue/itemQueue.ts:85:22)\r\nJan-20 09:18:55.354 [SYNC]            error: Removing unknown parent block root=0xce1916f623fa7d1c2596dcbce5a2706517afaf0352d689b2123c6d4d13cde13b, slot=65\r\nJan-20 09:18:55.354 [SYNC]            error: Removing unknown parent block root=0x32824e30ec8dcd9c9c9098316e16eda429e9b34d0d23a3c4e898b45835a8e452, slot=68\r\nJan-20 09:18:55.354 [SYNC]            error: Removing unknown parent block root=0xe265516d08bdba89a9f63b14c8e1981e87cc5675987e01559125748ffd184681, slot=69\r\n```\r\nfinally loses the peer:\r\n```\r\n48183, slot=77\r\nJan-20 09:19:34.475 [SYNC]            error: Removing unknown parent block root=0x9032f60ca13587c81ad8c87ca42be5ccab0b25852a20ce7cee55c2e3c77db0f6, slot=82\r\nJan-20 09:19:35.505 []                 info: Synced - slot: 82 (skipped 1) - head: 81 0x5dc6‚Ä¶3b63 - execution: valid(0x66e8‚Ä¶b42a) - finalized: 0x0000‚Ä¶0000:0 - peers: 1\r\nJan-20 09:19:38.502 []                 info: Synced - slot: 83 - head: 83 0xb609‚Ä¶405a - execution: valid(0x2087‚Ä¶7b4d) - finalized: 0x0000‚Ä¶0000:0 - peers: 1\r\nJan-20 09:19:41.501 []                 info: Searching peers - peers: 0 - slot: 84 (skipped 1) - head: 83 0xb609‚Ä¶405a - execution: valid(0x2087‚Ä¶7b4d) - finalized: 0x0000‚Ä¶0000:0\r\nJan-20 09:19:44.501 []                 info: Searching peers - peers: 0 - slot: 85 (skipped 2) - head: 83 0xb609‚Ä¶405a - execution: valid(0x2087‚Ä¶7b4d) - finalized: 0x0000‚Ä¶0000:0\r\nJan-20 09:19:47.501 []                 info: Searching peers - peers: 0 - slot: 86 (skipped 3) - head: 83 0xb609‚Ä¶405a - execution: valid(0x2087‚Ä¶7b4d) - finalized: 0x0000‚Ä¶0000:0\r\nJan-20\r\n```",
  "closed_by": {
    "login": "g11tech",
    "id": 76567250,
    "node_id": "MDQ6VXNlcjc2NTY3MjUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/g11tech",
    "html_url": "https://github.com/g11tech",
    "followers_url": "https://api.github.com/users/g11tech/followers",
    "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
    "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
    "organizations_url": "https://api.github.com/users/g11tech/orgs",
    "repos_url": "https://api.github.com/users/g11tech/repos",
    "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
    "received_events_url": "https://api.github.com/users/g11tech/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1406853912",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/3644#issuecomment-1406853912",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/3644",
    "id": 1406853912,
    "node_id": "IC_kwDOCD5_Gc5T2uMY",
    "user": {
      "login": "g11tech",
      "id": 76567250,
      "node_id": "MDQ6VXNlcjc2NTY3MjUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76567250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g11tech",
      "html_url": "https://github.com/g11tech",
      "followers_url": "https://api.github.com/users/g11tech/followers",
      "following_url": "https://api.github.com/users/g11tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/g11tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g11tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g11tech/subscriptions",
      "organizations_url": "https://api.github.com/users/g11tech/orgs",
      "repos_url": "https://api.github.com/users/g11tech/repos",
      "events_url": "https://api.github.com/users/g11tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g11tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-27T17:42:31Z",
    "updated_at": "2023-01-27T17:42:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "stale",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/1406853912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
