{
  "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498",
  "repository_url": "https://api.github.com/repos/ChainSafe/lodestar",
  "labels_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498/labels{/name}",
  "comments_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498/comments",
  "events_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498/events",
  "html_url": "https://github.com/ChainSafe/lodestar/issues/2498",
  "id": 883195712,
  "node_id": "MDU6SXNzdWU4ODMxOTU3MTI=",
  "number": 2498,
  "title": "Node is out of sync",
  "user": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tuyennhv",
    "id": 10568965,
    "node_id": "MDQ6VXNlcjEwNTY4OTY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tuyennhv",
    "html_url": "https://github.com/tuyennhv",
    "followers_url": "https://api.github.com/users/tuyennhv/followers",
    "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
    "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
    "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
    "repos_url": "https://api.github.com/users/tuyennhv/repos",
    "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-10T02:25:39Z",
  "updated_at": "2021-05-11T07:19:04Z",
  "closed_at": "2021-05-11T07:19:04Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nOn server contabo 3:\r\n<img width=\"1644\" alt=\"Screen Shot 2021-05-10 at 09 24 18\" src=\"https://user-images.githubusercontent.com/10568965/117598210-86727180-b171-11eb-9e4c-9a62f56756a4.png\">\r\n\r\nCurrent prater slot: 342124\r\n\r\nLogs\r\n```\r\n wrapError (/usr/app/packages/lodestar/src/util/wrapError.ts:18:32)\r\n    at Timeout._onTimeout (/usr/app/packages/lodestar/src/util/queue/index.ts:93:17)\r\nMay-08 11:38:13.165 [CHAIN]           error: Block error slot=330491 code=BLOCK_ERROR_PARENT_UNKNOWN, parentRoot=0xf3eb2c4234770d5f0136a20a9b608b9fac8a94bcee65fb5dc77e4bbe9821bf9e\r\nError: BLOCK_ERROR_PARENT_UNKNOWN\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:31:11)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:80:11)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:59:48)\r\n    at JobQueue.runJob (/usr/app/packages/lodestar/src/util/queue/index.ts:93:46)\r\n    at Timeout._onTimeout (/usr/app/packages/lodestar/src/util/queue/index.ts:105:15)\r\nMay-08 11:38:18.024 []                 info: Synced - finalized: 10131 0x9f23…b859 - head: 324255 0xf4ba…5bbd - peers: 25\r\nMay-08 11:38:18.248 [CHAIN]           error: Block error slot=324256 code=BLOCK_ERROR_BEACON_CHAIN_ERROR, error={\"message\":\"Cannot read property 'currentShuffling' of null\"}\r\nTypeError: Cannot read property 'currentShuffling' of null\r\n    at getEffectiveBalances (/usr/app/packages/beacon-state-transition/src/util/balance.ts:55:41)\r\n    at runStateTransition (/usr/app/packages/lodestar/src/chain/blocks/stateTransition.ts:149:25)\r\n    at processBlock (/usr/app/packages/lodestar/src/chain/blocks/process.ts:60:11)\r\n    at processBlockJob (/usr/app/packages/lodestar/src/chain/blocks/processor.ts:80:5)\r\n    at Object.job (/usr/app/packages/lodestar/src/chain/blocks/\r\n```\r\n\r\n**Expected behavior**\r\n\r\nNode stays synced\r\n\r\n",
  "closed_by": {
    "login": "wemeetagain",
    "id": 1348242,
    "node_id": "MDQ6VXNlcjEzNDgyNDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1348242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wemeetagain",
    "html_url": "https://github.com/wemeetagain",
    "followers_url": "https://api.github.com/users/wemeetagain/followers",
    "following_url": "https://api.github.com/users/wemeetagain/following{/other_user}",
    "gists_url": "https://api.github.com/users/wemeetagain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wemeetagain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wemeetagain/subscriptions",
    "organizations_url": "https://api.github.com/users/wemeetagain/orgs",
    "repos_url": "https://api.github.com/users/wemeetagain/repos",
    "events_url": "https://api.github.com/users/wemeetagain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wemeetagain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/836105737",
    "html_url": "https://github.com/ChainSafe/lodestar/issues/2498#issuecomment-836105737",
    "issue_url": "https://api.github.com/repos/ChainSafe/lodestar/issues/2498",
    "id": 836105737,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNjEwNTczNw==",
    "user": {
      "login": "tuyennhv",
      "id": 10568965,
      "node_id": "MDQ6VXNlcjEwNTY4OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10568965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tuyennhv",
      "html_url": "https://github.com/tuyennhv",
      "followers_url": "https://api.github.com/users/tuyennhv/followers",
      "following_url": "https://api.github.com/users/tuyennhv/following{/other_user}",
      "gists_url": "https://api.github.com/users/tuyennhv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tuyennhv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tuyennhv/subscriptions",
      "organizations_url": "https://api.github.com/users/tuyennhv/orgs",
      "repos_url": "https://api.github.com/users/tuyennhv/repos",
      "events_url": "https://api.github.com/users/tuyennhv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tuyennhv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-10T03:10:49Z",
    "updated_at": "2021-05-10T03:10:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "so the issue is `currentJustifiedCheckpoint` not in checkpoint state cache, I think we always add all checkpoint states to the cache, but after that we delete them through `prune`.\r\n\r\nalthough there is no evidence in the log, I think when we regen a state, we don't want to emit any events (and then trigger the event handler which call `prune` per regen checkpoint), we just want to get a state to get back to the consumer.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ChainSafe/lodestar/issues/comments/836105737/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
