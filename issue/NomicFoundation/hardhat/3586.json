{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3586",
  "id": 1534368018,
  "node_id": "I_kwDOB7jojM5bdJkS",
  "number": 3586,
  "title": "`revertedWith` failed to catch error msg in error object",
  "user": {
    "login": "shunjizhan",
    "id": 16548786,
    "node_id": "MDQ6VXNlcjE2NTQ4Nzg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/16548786?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shunjizhan",
    "html_url": "https://github.com/shunjizhan",
    "followers_url": "https://api.github.com/users/shunjizhan/followers",
    "following_url": "https://api.github.com/users/shunjizhan/following{/other_user}",
    "gists_url": "https://api.github.com/users/shunjizhan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shunjizhan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shunjizhan/subscriptions",
    "organizations_url": "https://api.github.com/users/shunjizhan/orgs",
    "repos_url": "https://api.github.com/users/shunjizhan/repos",
    "events_url": "https://api.github.com/users/shunjizhan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shunjizhan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-01-16T06:19:53Z",
  "updated_at": "2023-04-20T00:12:48Z",
  "closed_at": "2023-01-19T11:09:14Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\r\n\r\n2.12.5\r\n\r\n### What happened?\r\n\r\nI migrated from `ethereum-waffle` to hardhat matchers, and previous passing tests are failing. \r\n\r\nThis is because the response's shape is\r\n```\r\n{\r\n    \"id\": 0,\r\n    \"jsonrpc\": \"2.0\",\r\n    \"error\": {\r\n        \"code\": -32603,\r\n        \"message\": \"some error\"\r\n    }\r\n}\r\n```\r\nwhich can be caught by `ethereum-waffle` (v3.3.4)\r\nhttps://github.com/TrueFiEng/Waffle/blob/91ac212757cd360b075b4ce12a11cabbf66b8a45/waffle-chai/src/matchers/revertedWith.ts#L28\r\n\r\nAnd hardhat matchers won't either check the `message` key in the error object, or stringily the whole object\r\nhttps://github.com/NomicFoundation/hardhat/blob/e92b6b7b90032e380d43919b11a0d7a61f093ff6/packages/hardhat-chai-matchers/src/internal/reverted/utils.ts#L29\r\n\r\n### Minimal reproduction steps\r\n\r\ntest `revertedWith` against the error shape mentioned above, it won't pass.\r\n```ts\r\nexpect().to.be.revertedWith(\"some error\")\r\n```\r\n\r\n### Search terms\r\n\r\nrevertedWith",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1396809009",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3586#issuecomment-1396809009",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3586",
    "id": 1396809009,
    "node_id": "IC_kwDOB7jojM5TQZ0x",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-19T11:09:14Z",
    "updated_at": "2023-01-19T11:09:14Z",
    "author_association": "MEMBER",
    "body": "The `revertedWith` implementation in waffle just checks that the error message contains the given string. That's why it was working for you.\r\n\r\nThe Hardhat chai matchers implementation, on the other hand, actually checks that the transaction reverted because of a revert (like, say, `require(false, \"error reason\")`) and checks that the given reason string matches exactly the revert reason.\r\n\r\nIn most scenarios, our implementation is what you really want, and produces way fewer false positives. I think in your case you were running into a \"useful\" buggy behavior. If you want a similar behavior, you could use [`chai-as-promised`](https://www.chaijs.com/plugins/chai-as-promised/)'s `rejectedWith` matcher, which uses the rejected promise error message.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1396809009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
