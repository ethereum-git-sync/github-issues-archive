{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3743",
  "id": 1611219375,
  "node_id": "I_kwDOB7jojM5gCUGv",
  "number": 3743,
  "title": "Hardhat misses reason of reverted transaction",
  "user": {
    "login": "migoldfinger",
    "id": 106750422,
    "node_id": "U_kgDOBlzh1g",
    "avatar_url": "https://avatars.githubusercontent.com/u/106750422?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/migoldfinger",
    "html_url": "https://github.com/migoldfinger",
    "followers_url": "https://api.github.com/users/migoldfinger/followers",
    "following_url": "https://api.github.com/users/migoldfinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/migoldfinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/migoldfinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/migoldfinger/subscriptions",
    "organizations_url": "https://api.github.com/users/migoldfinger/orgs",
    "repos_url": "https://api.github.com/users/migoldfinger/repos",
    "events_url": "https://api.github.com/users/migoldfinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/migoldfinger/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-03-06T11:37:19Z",
  "updated_at": "2023-07-04T00:16:31Z",
  "closed_at": "2023-04-04T10:19:14Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\n\n2.12.7\n\n### What happened?\n\nWhile writing unit tests for my contracts I did run in an unexpected behavior.\r\nA call to an non existing function did revert the transaction (as expected), but there was no reason so the caller is left in the dark about the reason of the revert. It did pop up on existing unit tests after upgrading the hardhat version older versions did revert with the reason \"Transaction reverted: function returned an unexpected amount of data\".\r\nI did also try different versions of the solidity compiler without any effect even the compiler used before gives the same result using the current hardhat version.\n\n### Minimal reproduction steps\n\nUse the openzeppelin contracts and run this test\r\n```\r\nit(\"SafeERC20.increaseAllowance: Should revert on increaseAllowance\", async () =>\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tconst signers = await ethers.getSigners();\r\n\t\t\tconst alice = signers[0];\r\n\t\t\tconst safeERC20WrapperFactory = await ethers.getContractFactory(\"SafeERC20Wrapper\");\r\n\t\t\tconst SafeERC20Wrapper = await safeERC20WrapperFactory.deploy(alice.address);\r\n\t\t\t// Act\r\n\t\t\tconst result = SafeERC20Wrapper.increaseAllowance(0);\r\n\t\t\t// Assert\r\n\t\t\tawait expect(result).revertedWith(\"Transaction reverted: function returned an unexpected amount of data\");\r\n\t\t});\r\n```\r\nThe error I am getting is: \"AssertionError: Expected transaction to be reverted with reason 'Transaction reverted: function returned an unexpected amount of data', but it reverted without a reason\".\r\nThe Message itself is not that important only the fact that there is now no reason anymore.\r\n\r\n\r\nSafeERC20Wrapper was a helper class for my tests\r\n```\r\ncontract SafeERC20Wrapper is ISafeERC20Wrapper, Context\r\n{\r\n\tusing SafeERC20 for IERC20;\r\n\tIERC20 private _token;\r\n\r\n\tconstructor(IERC20 token) {\r\n\t\t_token = token;\r\n\t}\r\n\r\n\tfunction increaseAllowance(uint256 amount) override public\r\n\t{\r\n\t\t_token.safeIncreaseAllowance(address(0), amount);\r\n\t}\r\n}\r\n```\r\nand initializes with an wallet address that does not hold a contract\r\n\n\n### Search terms\n\nrevert without reason",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1495712504",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3743#issuecomment-1495712504",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3743",
    "id": 1495712504,
    "node_id": "IC_kwDOB7jojM5ZJsL4",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T10:19:14Z",
    "updated_at": "2023-04-04T10:19:14Z",
    "author_association": "MEMBER",
    "body": "Hi @migoldfinger, sorry for not responding before.\r\n\r\nI'm assuming you are using our chai matchers? If that's the case, I'll try to explain what's going on here.\r\n\r\nWhen you use `revertedWith`, you are asserting that the transaction reverts with a given error message. This happens when, for example, you do `require(false, \"some msg\")`, which would be asserted with `revertedWith(\"some msg\")`. This string is part of the return data of the transaction, and it can be decoded to that string.\r\n\r\nBut sometimes transactions fail for other reasons. When, for example, you call a function in some address and expect it to return some value, but the contract doesn't return anything (or it returns an incompatible value), then the transaction will revert but there will be no return data (and therefore no reason string). This is what I think it's happening in your case.\r\n\r\nNow, the \"function returned an unexpected amount of data\" is a message returned by Hardhat (not by the EVM) because we have a set of heuristics to try to explain why a transaction reverted. But these messages are fundamentally different from the ones that you get when you hit a `require(false, \"...\")`. I know it's confusing though.\r\n\r\nIf you want to assert that a transaction triggers that message, you can use something like `assert.isRejected` from [`chai-as-promised`](https://www.npmjs.com/package/chai-as-promised). I wouldn't recomment this though, because Hardhat error messages are not necessarily stable: we try to avoid changing them, but we could do it and we wouldn't consider it a breaking change.\r\n\r\nHope that helps! Let me know if you have more questions.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1495712504/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
