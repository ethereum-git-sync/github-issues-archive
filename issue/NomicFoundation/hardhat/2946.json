{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946",
  "id": 1304713810,
  "node_id": "I_kwDOB7jojM5NxFpS",
  "number": 2946,
  "title": "Inconsistency between Hardhat EVM and Geth EVM.",
  "user": {
    "login": "hickscorp",
    "id": 822933,
    "node_id": "MDQ6VXNlcjgyMjkzMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hickscorp",
    "html_url": "https://github.com/hickscorp",
    "followers_url": "https://api.github.com/users/hickscorp/followers",
    "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
    "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
    "organizations_url": "https://api.github.com/users/hickscorp/orgs",
    "repos_url": "https://api.github.com/users/hickscorp/repos",
    "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hickscorp/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2022-07-14T12:25:46Z",
  "updated_at": "2022-11-17T21:40:18Z",
  "closed_at": "2022-07-15T08:15:23Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Consider the following code, as part of a smart contract method:\r\n\r\n```solidity\r\n...\r\nuint256 balance = address(this).balance;\r\n...\r\n```\r\n\r\nThe code compiles, and runs fine within Hardhat node environments.\r\nHowever it crashes in a Geth based chain with error such as:\r\n\r\n```\r\nError: missing revert data in call exception; Transaction reverted without a reason string [ See: https://links.ethers.org/v5-errors-CALL_EXCEPTION ] (data=\"0x\", transaction={\"from\":\"0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\",\"to\":\"0xE875158298ac8e112e7180707E3a9CF3F06f2F3f\",\"data\":\"0x565974d3\",\"accessList\":null}, error={\"name\":\"ProviderError\",\"code\":-32000,\"_isProviderError\":true}, code=CALL_EXCEPTION, version=providers/5.6.8)\r\n```\r\n\r\nThe problem here is that code runs locally, passes tests, and would get deployed without the developer knowing that it would in fact crash in production.\r\n\r\nWe fixed the problem using `payable(address(this)).balance`.\r\n\r\nI would suggest that Hardhat makes it so the crash also occurs locally on Hardhat-based EVMs.",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184386145",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1184386145",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1184386145,
    "node_id": "IC_kwDOB7jojM5GmExh",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-14T12:26:14Z",
    "updated_at": "2022-07-14T12:26:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-960/inconsistency-between-hardhat-evm-and-geth-evm).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 20abcc8b-915d-4cb5-9bf2-0a2978d478d0",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184386145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184430065",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1184430065",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1184430065,
    "node_id": "IC_kwDOB7jojM5GmPfx",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T13:10:33Z",
    "updated_at": "2022-07-14T13:10:33Z",
    "author_association": "MEMBER",
    "body": "Tagging some folks from the ethereumjs team, since this looks like it could be an issue in the VM: @holgerd77 @jochem-brouwer",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184430065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184448435",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1184448435",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1184448435,
    "node_id": "IC_kwDOB7jojM5GmT-z",
    "user": {
      "login": "jochem-brouwer",
      "id": 29359032,
      "node_id": "MDQ6VXNlcjI5MzU5MDMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/29359032?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jochem-brouwer",
      "html_url": "https://github.com/jochem-brouwer",
      "followers_url": "https://api.github.com/users/jochem-brouwer/followers",
      "following_url": "https://api.github.com/users/jochem-brouwer/following{/other_user}",
      "gists_url": "https://api.github.com/users/jochem-brouwer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jochem-brouwer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jochem-brouwer/subscriptions",
      "organizations_url": "https://api.github.com/users/jochem-brouwer/orgs",
      "repos_url": "https://api.github.com/users/jochem-brouwer/repos",
      "events_url": "https://api.github.com/users/jochem-brouwer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jochem-brouwer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T13:26:57Z",
    "updated_at": "2022-07-14T13:27:24Z",
    "author_association": "NONE",
    "body": "We would need the entire environment and the transaction data to reproduce this test. Could @hickscorp provide a minimal setup in hardhat and in Geth so that we can reproduce this divergence?\n\nWhy would this `payable` solve this problem? I am no solidity expert but AFAIK this solves static analysis compiler errors. It also makes no sense to me why you cannot load an account balance of a non-payable account.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184448435/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184506944",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1184506944",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1184506944,
    "node_id": "IC_kwDOB7jojM5GmiRA",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T14:19:28Z",
    "updated_at": "2022-07-14T14:19:28Z",
    "author_association": "MEMBER",
    "body": "Hey there ðŸ‘‹\r\n\r\n\r\nMy suspicion is that this is not a bug in Hardhat nor in ethereumjs, but rather a really hard-to-spot misconfiguration.\r\n\r\nI believe you are using another chain that's running a pretty old hardfork, older than Istanbul. The reason I suspect this is that Istanbul introduced the `SELFBALANCE` opcode, and solidity >= 0.5.13 compiles `address(this).balance` to that opcode. \r\n\r\nBy default, Hardhat Network runs using the same hardfork as mainnet, so `SELFBALANCE` exists and works correctly. But the same code on your chain, which doesn't have that opcode, reverts.\r\n\r\nThe `payable` keyword must be forcing it to use `BALANCE` instead.\r\n\r\nCan you please tell us which chain are you using and your versions of Hardhat and Solidity? That'd be enough to confirm this theory.\r\n\r\nIf I'm correct, these are the things you need to do to fix this issue:\r\n\r\n1. Set Hardhat network's hardfork to the one your chain is running.\r\n2. Set the [evmVersion of solidity](https://docs.soliditylang.org/en/v0.8.15/using-the-compiler.html#setting-the-evm-version-to-target) to the same one.\r\n\r\nIf I'm not correct you'd be better following those steps anyway. @fvictorio should we create an \"Using Hardhat with other chains\" advanced guide explaining these things?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184506944/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185296461",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1185296461",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1185296461,
    "node_id": "IC_kwDOB7jojM5GpjBN",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T08:15:22Z",
    "updated_at": "2022-07-15T08:15:22Z",
    "author_association": "MEMBER",
    "body": "> @fvictorio should we create an \"Using Hardhat with other chains\" advanced guide explaining these things?\r\n\r\nAgree. I created a Linear issue for that.\r\n\r\nI'm going to tentatively close this issue, but @hickscorp please let us know if you still think there's a problem in Hardhat.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185296461/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185362717",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1185362717",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1185362717,
    "node_id": "IC_kwDOB7jojM5GpzMd",
    "user": {
      "login": "hickscorp",
      "id": 822933,
      "node_id": "MDQ6VXNlcjgyMjkzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hickscorp",
      "html_url": "https://github.com/hickscorp",
      "followers_url": "https://api.github.com/users/hickscorp/followers",
      "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
      "organizations_url": "https://api.github.com/users/hickscorp/orgs",
      "repos_url": "https://api.github.com/users/hickscorp/repos",
      "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hickscorp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T09:33:20Z",
    "updated_at": "2022-07-15T09:35:28Z",
    "author_association": "NONE",
    "body": "Good morning and thanks a lot for your help @fvictorio @jochem-brouwer @alcuadrado .\r\n\r\nIt's going to be difficult for me to provide a reproducible example this week, but I could try next week.\r\n\r\nFWIW, we operate on two private chains, but we are able to replicate locally using a POA Geth chain.\r\nThe settings for it are:\r\n\r\n```> geth version\r\nGeth\r\nVersion: 1.10.19-stable\r\nGit Commit: 23bee16208718975f9b9e012949b8d4ee1223108\r\nArchitecture: amd64\r\nGo Version: go1.18.1\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=go\r\n```\r\n\r\nOur genesis for the \"dev\" local chain looks like:\r\n\r\n```json\r\n{\r\n  \"config\": {\r\n    \"chainId\": 18021980,\r\n    \"homesteadBlock\": 0,\r\n    \"eip150Block\": 0,\r\n    \"eip150Hash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n    \"eip155Block\": 0,\r\n    \"eip158Block\": 0,\r\n    \"byzantiumBlock\": 0,\r\n    \"constantinopleBlock\": 0,\r\n    \"petersburgBlock\": 0,\r\n    \"clique\": {\r\n      \"period\": 1,\r\n      \"epoch\": 30000\r\n    }\r\n  },\r\n  \"nonce\": \"0x0\",\r\n  \"timestamp\": \"0x5d1e25b1\",\r\n  \"extraData\": \"...\",\r\n  \"gasLimit\": \"0x59a5380\",\r\n  \"difficulty\": \"0x1\",\r\n  \"mixHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n  \"coinbase\": \"0x0000000000000000000000000000000000000000\",\r\n  \"alloc\": {...},\r\n  \"number\": \"0x0\",\r\n  \"gasUsed\": \"0x0\",\r\n  \"parentHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\"\r\n}\r\n```\r\n\r\nIn terms of Solidity compiler versions, most (if not all) of our contracts fence with `pragma solidity ^0.8.4;`\r\n\r\nIt would be very appreciated if you knew of a \"boilerplate\" project from which I could try and prepare a reproducible example.\r\n\r\nThanks again.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185362717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185413877",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1185413877",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1185413877,
    "node_id": "IC_kwDOB7jojM5Gp_r1",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T10:34:06Z",
    "updated_at": "2022-07-15T10:34:06Z",
    "author_association": "MEMBER",
    "body": "You could try running a contract that executes selfbalance in assembly ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185413877/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185514407",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1185514407",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1185514407,
    "node_id": "IC_kwDOB7jojM5GqYOn",
    "user": {
      "login": "hickscorp",
      "id": 822933,
      "node_id": "MDQ6VXNlcjgyMjkzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hickscorp",
      "html_url": "https://github.com/hickscorp",
      "followers_url": "https://api.github.com/users/hickscorp/followers",
      "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
      "organizations_url": "https://api.github.com/users/hickscorp/orgs",
      "repos_url": "https://api.github.com/users/hickscorp/repos",
      "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hickscorp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T12:50:27Z",
    "updated_at": "2022-07-15T12:53:35Z",
    "author_association": "NONE",
    "body": "@alcuadrado Same problem. Assuming that this was your recommendation:\r\n\r\n```solidity\r\n  function selfbalance()\r\n      internal view returns(uint256) {\r\n    uint256 amount;\r\n    assembly {\r\n      amount := selfbalance()\r\n    }\r\n    return amount;\r\n  }\r\n```\r\n\r\nEDIT: I also tried:\r\n```solidity\r\n  function selfbalance()\r\n      internal view returns(uint256) {\r\n    assembly {\r\n      let amount := selfbalance()\r\n      mstore(0x0, amount)\r\n      return(0x0, 32)\r\n    }\r\n  }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185514407/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185518304",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1185518304",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1185518304,
    "node_id": "IC_kwDOB7jojM5GqZLg",
    "user": {
      "login": "hickscorp",
      "id": 822933,
      "node_id": "MDQ6VXNlcjgyMjkzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hickscorp",
      "html_url": "https://github.com/hickscorp",
      "followers_url": "https://api.github.com/users/hickscorp/followers",
      "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
      "organizations_url": "https://api.github.com/users/hickscorp/orgs",
      "repos_url": "https://api.github.com/users/hickscorp/repos",
      "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hickscorp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T12:55:28Z",
    "updated_at": "2022-07-15T12:55:28Z",
    "author_association": "NONE",
    "body": "In case you want to try - this is how I start the local geth chain to try and replicate what happens on our private chains:\r\n\r\n```bash\r\n#!/bin/bash -e\r\ntrap cleanup EXIT\r\nDATADIR=\"./geth-local-poa-chain\"\r\n\r\nfunction cleanup {\r\n  # Delete any previous data dir.\r\n  echo \"Cleaning up...\"\r\n  rm -rf \"$DATADIR/geth/\"\r\n}\r\n\r\n# Clean up, in case something wasn't deleted from last run.\r\ncleanup\r\n\r\n# Initialize data dir from Genesis.\r\ngeth init \\\r\n  --datadir \"$DATADIR\" \\\r\n  \"${DATADIR}/genesis.json\"\r\n\r\n# Run geth in dev mode (poa, sealing enabled).\r\ngeth --dev \\\r\n  --ipcdisable \\\r\n  --datadir \"$DATADIR\" \\\r\n  --miner.etherbase \"...........\" \\\r\n  --http \\\r\n  --http.addr \"0.0.0.0\" \\\r\n  --http.port 8546 \\\r\n  --http.api \"eth,web3,net\" \\\r\n  --http.corsdomain \"*\"\r\n```\r\n\r\nNote that the `etherbase` is set to an address that is in the `keystore/` folder, so that the extradata specifying which sealer can append on the canonical chain is unlocked and runs.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185518304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185776540",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1185776540",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1185776540,
    "node_id": "IC_kwDOB7jojM5GrYOc",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T18:02:10Z",
    "updated_at": "2022-07-15T18:03:50Z",
    "author_association": "MEMBER",
    "body": "> @alcuadrado Same problem. Assuming that this was your recommendation:\r\n> \r\n> ```solidity\r\n>   function selfbalance()\r\n>       internal view returns(uint256) {\r\n>     uint256 amount;\r\n>     assembly {\r\n>       amount := selfbalance()\r\n>     }\r\n>     return amount;\r\n>   }\r\n> ```\r\n> \r\n> EDIT: I also tried:\r\n> \r\n> ```solidity\r\n>   function selfbalance()\r\n>       internal view returns(uint256) {\r\n>     assembly {\r\n>       let amount := selfbalance()\r\n>       mstore(0x0, amount)\r\n>       return(0x0, 32)\r\n>     }\r\n>   }\r\n> ```\r\n\r\nSorry, I think I wasn't clear before. I believe this confirms my theory.\r\n\r\nTry adding this to your genesis' config:\r\n\r\n```\r\n\"homesteadBlock\": 0,\r\n\"eip150Block\": 0,\r\n\"eip155Block\": 0,\r\n\"eip158Block\": 0,\r\n\"byzantiumBlock\": 0,\r\n\"constantinopleBlock\": 0,\r\n\"petersburgBlock\": 0,\r\n\"istanbulBlock\": 0,\r\n\"muirGlacierBlock\": 0,\r\n\"berlinBlock: 0,\r\n\"londonBlock\": 0,\r\n\"arrowGlacierBlock\": 0,\r\n\"grayGlacierBlock\": 0,\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185776540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1188857490",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1188857490",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1188857490,
    "node_id": "IC_kwDOB7jojM5G3IaS",
    "user": {
      "login": "hickscorp",
      "id": 822933,
      "node_id": "MDQ6VXNlcjgyMjkzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hickscorp",
      "html_url": "https://github.com/hickscorp",
      "followers_url": "https://api.github.com/users/hickscorp/followers",
      "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
      "organizations_url": "https://api.github.com/users/hickscorp/orgs",
      "repos_url": "https://api.github.com/users/hickscorp/repos",
      "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hickscorp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-19T10:04:18Z",
    "updated_at": "2022-07-19T10:13:55Z",
    "author_association": "NONE",
    "body": "@alcuadrado I'm not sure I understand. We run a private chain - it means that we'd need to schedule a fork - correct?\r\nYour suggestion works locally on a brand new chain though.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1188857490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1190049640",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2946#issuecomment-1190049640",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2946",
    "id": 1190049640,
    "node_id": "IC_kwDOB7jojM5G7rdo",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-20T09:33:02Z",
    "updated_at": "2022-07-20T09:33:02Z",
    "author_association": "MEMBER",
    "body": "Either that or configure Hardhat to match the hardfork that is being used by your chain. That might not be possible in some scenarios if, for example, you are doing something like \"using hardfork X but without the EIP Y that is included in that fork\".",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1190049640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
