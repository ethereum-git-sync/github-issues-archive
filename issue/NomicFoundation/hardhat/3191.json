{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191",
  "id": 1376584646,
  "node_id": "I_kwDOB7jojM5SDQPG",
  "number": 3191,
  "title": "Mempool Automatically Drops The Second Transaction On Manual Mine Mode.",
  "user": {
    "login": "tarik0",
    "id": 22205836,
    "node_id": "MDQ6VXNlcjIyMjA1ODM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/22205836?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tarik0",
    "html_url": "https://github.com/tarik0",
    "followers_url": "https://api.github.com/users/tarik0/followers",
    "following_url": "https://api.github.com/users/tarik0/following{/other_user}",
    "gists_url": "https://api.github.com/users/tarik0/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tarik0/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tarik0/subscriptions",
    "organizations_url": "https://api.github.com/users/tarik0/orgs",
    "repos_url": "https://api.github.com/users/tarik0/repos",
    "events_url": "https://api.github.com/users/tarik0/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tarik0/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2022-09-16T23:26:37Z",
  "updated_at": "2023-03-10T00:14:55Z",
  "closed_at": "2022-10-18T19:12:55Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hey, I was trying to simulate an `openTrading` and `transfer` transaction series that happens in the same block but when I try to send two transactions in the same block the second one (`transfer`) never gets mined after `hardhat_mine` (I've also tried `eth_mine`) even though I can see the second transaction with `eth_pendingTransactions` in the mempool.\r\n\r\nHere is the config with my `npx hardhat node ...` logs.\r\n\r\n```\r\nb'eth_sendTransaction\\n'   <---- first tx.\r\nb'eth_getBlockByNumber\\n'   \r\nb'eth_chainId\\n'\r\nb'eth_sendTransaction\\n'   <---- second and dropped \r\nb'evm_mine\\n'\r\nb'  Mined block #13780187\\n'\r\nb'    Block: 0xdd24ae5d527f5a0053c6be11b40871519da182d104f9c39cd729ff2b6069f413\\n'\r\nb'      Base fee: 0\\n'\r\nb'      Transaction:     0x7600a4343cacb026d69c760cbd9d1cb99c463488538f7f183960713d9c1b8dcd\\n'\r\nb'        Contract call: <UnrecognizedContract>\\n'\r\nb'        From:          0x24520cd0ecd3c796ae018fda37af69fd806364be\\n'\r\nb'        To:            0xbda5bce124ac26ecc9a75069a7c7e6acf025df51\\n'\r\nb'        Value:         0 ETH\\n'\r\nb'        Gas used:      2922159 of 1000000000000\\n'\r\nb'\\n'\r\nb'eth_getTransactionReceipt\\n'\r\nb'eth_getTransactionReceipt (2)\\n'\r\n```\r\n\r\n```js\r\nmodule.exports = {\r\n  solidity: \"0.8.9\",\r\n  networks: {\r\n  hardhat: {\r\n    blockGasLimit: 1000000000000,\r\n    loggingEnabled: true,\r\n    gasPrice: 0,\r\n    initialBaseFeePerGas: 0,\r\n    mining: {\r\n      mempool: {\r\n        order: \"fifo\"\r\n      }\r\n    },\r\n    forking: {\r\n      url: \"https://eth-mainnet.g.alchemy.com/v2/...\",\r\n      blockNumber: 13780182,\r\n    }\r\n   }\r\n }\r\n};\r\n```\r\nSometimes the second transaction also gets included in the block when the first transaction fails. I've tried to change gas values etc. but It never worked. I think you can reproduce this using the same config and switching to manual mining.\r\n\r\nThe system info.\r\n```\r\n\"hardhat\": \"^2.10.2\"\r\nNode V18.3.0\r\nManjaro Linux 5.15.49-1-MANJARO\r\n```",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1249933850",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1249933850",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1249933850,
    "node_id": "IC_kwDOB7jojM5KgHoa",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-09-16T23:27:02Z",
    "updated_at": "2022-09-16T23:27:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1184/mempool-automatically-drops-the-second-transaction-on-manual-mine-mode).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 69ab734a-046e-495c-acab-bba1d7991428",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1249933850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1253416986",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1253416986",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1253416986,
    "node_id": "IC_kwDOB7jojM5KtaAa",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-21T09:05:19Z",
    "updated_at": "2022-09-21T09:05:19Z",
    "author_association": "MEMBER",
    "body": "Hey @tarik0, can you create a [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example) for this? I would love to investigate this but without an easy way to reproduce it it would take me a lot of time.\r\n\r\nA repo that I can clone, `npm install` and `hardhat test` to reproduce the problem would be ideal. If that's too much to ask, at least something that I can clone and then follow some instructions.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1253416986/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1282884884",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1282884884",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1282884884,
    "node_id": "IC_kwDOB7jojM5Md0UU",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T19:12:55Z",
    "updated_at": "2022-10-18T19:12:55Z",
    "author_association": "MEMBER",
    "body": "I'm closing this for bookkeeping reasons, but I'll re-open it if someone can provide an MRE.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1282884884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1341450875",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1341450875",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1341450875,
    "node_id": "IC_kwDOB7jojM5P9Op7",
    "user": {
      "login": "michprev",
      "id": 7281754,
      "node_id": "MDQ6VXNlcjcyODE3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michprev",
      "html_url": "https://github.com/michprev",
      "followers_url": "https://api.github.com/users/michprev/followers",
      "following_url": "https://api.github.com/users/michprev/following{/other_user}",
      "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
      "organizations_url": "https://api.github.com/users/michprev/orgs",
      "repos_url": "https://api.github.com/users/michprev/repos",
      "events_url": "https://api.github.com/users/michprev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michprev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T19:06:35Z",
    "updated_at": "2022-12-07T19:06:35Z",
    "author_association": "NONE",
    "body": "I am experiencing the same issue. Unfortunately, I don't have much experience with Javascript-based testing frameworks, so I don't have an executable example. However,  from the logs attached, I hope the issue should be clear.\r\n\r\nThe code of the contract is available here: https://github.com/michprev/hh-tx-drop-issue/blob/main/contracts/Counter.sol\r\n\r\nThe test written is Python (Woke testing framework, still in development, no easy way to execute the test): https://github.com/michprev/hh-tx-drop-issue/blob/main/tests/test_counter.py\r\n\r\nPosting here the output from `npx hardhat node`:\r\n```\r\nweb3_clientVersion\r\neth_accounts\r\neth_getBlockByNumber\r\neth_chainId\r\neth_gasPrice\r\nevm_snapshot\r\neth_getTransactionCount\r\neth_sendTransaction\r\n  Contract deployment: Counter\r\n  Contract address:    0x5fbdb2315678afecb367f032d93f642f64180aa3\r\n  Transaction:         0xd7efc2348b18e68071949393477bb583f31783d4fd856dad4ad50517f5399a16\r\n  From:                0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266\r\n  Value:               0 ETH\r\n  Gas used:            125605 of 30000000\r\n  Block #1:            0xdd29af706b5d4a86e0dd6411db0c4ada42a2a7e4b526eb11a71635aaa3616bb2\r\n\r\neth_getTransactionReceipt\r\neth_call\r\n  Contract call:       Counter#count\r\n  From:                0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266\r\n  To:                  0x5fbdb2315678afecb367f032d93f642f64180aa3\r\n\r\nhardhat_getAutomine\r\nevm_setAutomine\r\neth_sendTransaction (2)\r\nevm_mine\r\n  Mined block #2\r\n    Block: 0xded556668b1fb9a05bdcc10d7a62600a58e0349af54c4a2509e2cab94d78802e\r\n      Base fee: 0\r\n      Transaction:     0x06bfa076aff97254dbe774418cfdd801953e184c86a79f8438162bd8eb25e318\r\n        Contract call: Counter#increment\r\n        From:          0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266\r\n        To:            0x5fbdb2315678afecb367f032d93f642f64180aa3\r\n        Value:         0 ETH\r\n        Gas used:      43523 of 30000000\r\n\r\nevm_setAutomine\r\neth_call\r\n  Contract call:       Counter#count\r\n  From:                0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266\r\n  To:                  0x5fbdb2315678afecb367f032d93f642f64180aa3\r\n\r\nevm_revert\r\n```\r\n\r\nThe interesting part starts after `evm_snapshot`:\r\n- `eth_getTransactionCount` to find out nonce for the `default_account`\r\n- `eth_sendTransaction` to deploy `Counter` instance\r\n- `eth_getTransactionReceipt` check deploy tx status\r\n- `eth_call` invoke the `counter` state variable getter to make assertion\r\n- `hardhat_getAutomine` to get the current status of automine\r\n- `evm_setAutomine` to temporarily stop automine to have 2 transactions mined in the same block\r\n- `eth_sendTransaction` twice - to execute the `increment` function twice\r\n- `evm_mine` to force mine a block\r\n- `evm_setAutomine` to re-enable automine\r\n- `eth_call` to invoke the `counter` state variable getter to make assertion\r\n\r\nThe last assertion fails with 1 as the actual value and 2 as the expected value.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1341450875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1341530052",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1341530052",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1341530052,
    "node_id": "IC_kwDOB7jojM5P9h_E",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T20:09:24Z",
    "updated_at": "2022-12-07T20:09:24Z",
    "author_association": "MEMBER",
    "body": "@michprev one possibility here is that the test is sending the transaction with the same nonce, and so the second one is dropped.\r\n\r\nCan you print the nonce of each of those transactions in the test to see if that's the case?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1341530052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1341543339",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1341543339",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1341543339,
    "node_id": "IC_kwDOB7jojM5P9lOr",
    "user": {
      "login": "michprev",
      "id": 7281754,
      "node_id": "MDQ6VXNlcjcyODE3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michprev",
      "html_url": "https://github.com/michprev",
      "followers_url": "https://api.github.com/users/michprev/followers",
      "following_url": "https://api.github.com/users/michprev/following{/other_user}",
      "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
      "organizations_url": "https://api.github.com/users/michprev/orgs",
      "repos_url": "https://api.github.com/users/michprev/repos",
      "events_url": "https://api.github.com/users/michprev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michprev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T20:22:01Z",
    "updated_at": "2022-12-07T20:22:01Z",
    "author_association": "NONE",
    "body": "I have pushed logs with all the JSON-RPC communication - https://github.com/michprev/hh-tx-drop-issue/blob/main/logs.txt\r\n\r\nThe important part is:\r\n```\r\nINFO     woke.testing.json_rpc.communicator:communicator.py:89 Sending request:\r\n{'jsonrpc': '2.0', 'method': 'eth_sendTransaction', 'params': [{'type': '0x2', 'nonce': '0x1', 'to': '0x5FbDB2315678afecb367f032d93F642f64180aa3', 'from': '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266', 'gas': '0x1c9c380', 'value': '0x0', 'data': '0xd09de08a', 'gasPrice': '0x0'}], 'id': 13}\r\nINFO     woke.testing.json_rpc.communicator:communicator.py:93 Received response:\r\n{\"jsonrpc\":\"2.0\",\"id\":13,\"result\":\"0x06bfa076aff97254dbe774418cfdd801953e184c86a79f8438162bd8eb25e318\"}\r\nINFO     woke.testing.json_rpc.communicator:communicator.py:89 Sending request:\r\n{'jsonrpc': '2.0', 'method': 'eth_sendTransaction', 'params': [{'type': '0x2', 'nonce': '0x2', 'to': '0x5FbDB2315678afecb367f032d93F642f64180aa3', 'from': '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266', 'gas': '0x1c9c380', 'value': '0x0', 'data': '0xd09de08a', 'gasPrice': '0x0'}], 'id': 14}\r\nINFO     woke.testing.json_rpc.communicator:communicator.py:93 Received response:\r\n{\"jsonrpc\":\"2.0\",\"id\":14,\"result\":\"0x13e2c64339a3521e989bd75e8ca65573e766f28ade968d0f7ea082072d079e9b\"}\r\n```\r\n\r\nSo nonces are different. Also forgot to mention - `npx hardhat node --version` prints `2.12.3`.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1341543339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1342767936",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1342767936",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1342767936,
    "node_id": "IC_kwDOB7jojM5QCQNA",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T13:50:28Z",
    "updated_at": "2022-12-08T13:50:28Z",
    "author_association": "MEMBER",
    "body": "Ok, here's another guess:\r\n\r\n- Both transactions have a gas limit of 30000000, which is probably the block gas limit. This means that only one of them will be mined in the block (IIRC that's how the mempool selection works, even if the tx ends up using way less gas).\r\n- But then, when the new block is mined, the base gas price is no longer 0 and since the second tx has a gas price of 0, it won't be mined.\r\n\r\nSadly, we don't have any way to inspect transactions in the mempool that are not minable. But you could try doing this in the test:\r\n\r\n```\r\nprovider.send(\"hardhat_setNextBlockBaseFeePerGas\", [\"0x0\"])\r\ndefault_chain.mine()\r\n```\r\n\r\n(I don't know what the right syntax would be for the first method, but you get the idea)\r\n\r\nAlternatively, you can fetch the pending block with `provider.send(\"eth_getBlockByNumber\", [\"pending\", false])` and check if indeed the `baseFeePerGas` is non-zero.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1342767936/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1343982543",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1343982543",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1343982543,
    "node_id": "IC_kwDOB7jojM5QG4vP",
    "user": {
      "login": "michprev",
      "id": 7281754,
      "node_id": "MDQ6VXNlcjcyODE3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michprev",
      "html_url": "https://github.com/michprev",
      "followers_url": "https://api.github.com/users/michprev/followers",
      "following_url": "https://api.github.com/users/michprev/following{/other_user}",
      "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
      "organizations_url": "https://api.github.com/users/michprev/orgs",
      "repos_url": "https://api.github.com/users/michprev/repos",
      "events_url": "https://api.github.com/users/michprev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michprev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-09T08:08:53Z",
    "updated_at": "2022-12-09T08:08:53Z",
    "author_association": "NONE",
    "body": "Appreciate your cooperation :raised_hands: \r\n\r\nTurned out that a second call to `default_chain.mine()` is needed. As you have described, the first transaction has its `gas_limit` set to the block gas limit so that the second transaction is included in another block. The second block has to be mined manually, it is not automined once `automine` is set back to true.\r\n\r\nThis is against what I was expecting - on Anvil, both transactions are included in the same block (event with `gas_limit` set to the block gas limit). Also a block is automatically mined after `automine` set back to true.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1343982543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1343989473",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3191#issuecomment-1343989473",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3191",
    "id": 1343989473,
    "node_id": "IC_kwDOB7jojM5QG6bh",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-09T08:15:47Z",
    "updated_at": "2022-12-09T08:15:47Z",
    "author_association": "MEMBER",
    "body": "> This is against what I was expecting - on Anvil, both transactions are included in the same block (event with gas_limit set to the block gas limit).\r\n\r\nIf I remember correctly, we explicitly followed geth behavior here. We try to be as close as to how the mainnet behaves in these kinds of things.\r\n\r\n> Also a block is automatically mined after automine set back to true.\r\n\r\nThat behavior makes sense. Feel free to open an issue suggesting it, I think you could argue that setting automine to true should flush the mempool (although we need to analyze if that should be considered a breaking change). Right now, I believe we do that when you set automine to true _and_ send a tx. ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1343989473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
