{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3640",
  "id": 1571153614,
  "node_id": "I_kwDOB7jojM5dpebO",
  "number": 3640,
  "title": "HH does not fork mainnet correctly based on specified chainId",
  "user": {
    "login": "Samboy76",
    "id": 74149745,
    "node_id": "MDQ6VXNlcjc0MTQ5NzQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/74149745?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Samboy76",
    "html_url": "https://github.com/Samboy76",
    "followers_url": "https://api.github.com/users/Samboy76/followers",
    "following_url": "https://api.github.com/users/Samboy76/following{/other_user}",
    "gists_url": "https://api.github.com/users/Samboy76/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Samboy76/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Samboy76/subscriptions",
    "organizations_url": "https://api.github.com/users/Samboy76/orgs",
    "repos_url": "https://api.github.com/users/Samboy76/repos",
    "events_url": "https://api.github.com/users/Samboy76/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Samboy76/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-02-04T22:38:10Z",
  "updated_at": "2023-05-24T00:13:14Z",
  "closed_at": "2023-02-22T09:16:16Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\n\n2.12.2\n\n### What happened?\n\nI am trying to fork 5 environments and config 5 mainnet networks within the same hardhat.config.js.\r\n\r\nI have a monitoring bot setup that listens to each one of the above five forks and mainnets depending on the flag that I set in runtime.\r\n\r\nMy question is this:\r\n\r\nFor each one of the forks, I would like to test separate contract addresses (tokens and smart contracts) under my backend solidity smart contract but seem to run into problems such as this one: **Error HH101: Hardhat was set to use chain id 1, but connected to a chain with id 31337.**\r\nAnd when I seem to progress I run into this other error but this time in Solidity back-end \"**Error: Transaction reverted: function call to a non-contract account**\" which indicate perhaps I am running under different network or chainId in Hardhat localhost. This is the confusion that I have and would like to toggle between each of the fork networks/chainId for my bot through this toggle.\r\n\r\nUpon deploy function call in deploy JS script, in the backend solidity constructor function for the flashloan smart contract, I print out the current `chainId` of the network I am using and it keeps returning the same chainId value each time **31337**. See below print out code snippet:\r\n\r\n    console.log(\"block.chainid \", block.chainid);\r\n\r\nI would like to have forks and mainnets for each of Ethereum, Polygon, Avalanche, Arbitrum and BSC networks. Not sure if it´s a question of correctly configuring the corresponding chainIds which I have attempted directly in hardhat.config.as as shown above.\r\n\r\nThis is where I need some help and guidance from your shared wisdom.\r\n\n\n### Minimal reproduction steps\n\nAttempted to fork 5 mainnet networks including specification of their corresponding config of 5 mainnet networks within the same hardhat.config.js shown below:\r\n\r\n    require('dotenv').config();\r\n    require(\"@nomicfoundation/hardhat-toolbox\");\r\n    \r\n    const FORK_MAINNET = true;\r\n    const FORK_POLYGON = false;\r\n    const FORK_AVALANCHE = false;\r\n    const FORK_ARBITRUM = false;\r\n    const FORK_BSC = false;\r\n    \r\n    const MAINNET = false;\r\n    const POLYGON = false;\r\n    const AVALANCHE = false;\r\n    const ARBITRUM = false;\r\n    const BSC = false;\r\n    \r\n    const forkingData = FORK_MAINNET\r\n        ? {\r\n            url: process.env.INFURA_URL_API_KEY,\r\n            enabled: true\r\n          }\r\n        : FORK_POLYGON\r\n        ? {\r\n            url: process.env.ALCHEMY_URL_API_KEY,\r\n            enabled: true\r\n          }\r\n        : FORK_AVALANCHE\r\n        ? {\r\n            url: process.env.GETBLOCK_URL_API_KEY,\r\n            enabled: true\r\n          }\r\n        : FORK_ARBITRUM\r\n        ? {\r\n            url: process.env.CHAINSTACK_URL_API_KEY,\r\n            enabled: true\r\n          }\r\n        : FORK_BSC\r\n        ? {\r\n            url: process.env.QUICKNODE_URL,\r\n            enabled: true\r\n          }\r\n        : undefined;\r\n    \r\n    const urlData = MAINNET\r\n        ? process.env.INFURA_URL_API_KEY\r\n        : POLYGON\r\n        ? process.env.ALCHEMY_URL_API_KEY\r\n        : AVALANCHE\r\n        ? process.env.GETBLOCK_URL_API_KEY\r\n        : ARBITRUM\r\n        ? process.env.CHAINSTACK_URL_API_KEY\r\n        : BSC\r\n        ? process.env.QUICKNODE_URL\r\n        : \"http://127.0.0.1:8545\";\r\n    const chainData = MAINNET\r\n        ? 1\r\n        : POLYGON\r\n        ? 137\r\n        : AVALANCHE\r\n        ? 43114\r\n        : ARBITRUM\r\n        ? 42161\r\n        : BSC\r\n        ? 56\r\n        : FORK_MAINNET\r\n        ? 1 // TODO change value\r\n        : FORK_POLYGON\r\n        ? 137 // TODO change value\r\n        : FORK_AVALANCHE\r\n        ? 43114 // TODO change value\r\n        : FORK_ARBITRUM\r\n        ? 42161 // TODO change value\r\n        : FORK_BSC\r\n        ? 56 // TODO change value\r\n        : 31337; // default to Mainnet chainId\r\n    \r\n    /** @type import('hardhat/config').HardhatUserConfig */\r\n    module.exports = {\r\n      defaultNetwork: \"localhost\",\r\n      networks: {\r\n        localhost: {\r\n          url: urlData,\r\n          chainId: chainData,\r\n          throwOnTransactionFailures: true,\r\n          throwOnCallFailures: true,\r\n          forking: forkingData,\r\n          accounts: {\r\n            mnemonic: process.env.MNEMONIC,\r\n            path: \"m/44'/60'/0'/0\", // HD parent of all the derived keys. Default value: \"m/44'/60'/0'/0\"\r\n            initialIndex: 0, // The initial index to derive. Default value: 0.\r\n            count: 20, // The number of accounts to derive. Default value: 20.\r\n            passphrase: \"\" // The passphrase for the wallet. Default value: empty string.\r\n          }\r\n        },\r\n        mainnet: {\r\n          url: urlData,\r\n          chainId: chainData,\r\n          accounts: {\r\n            mnemonic: process.env.MNEMONIC,\r\n            path: \"m/44'/60'/0'/0\", // HD parent of all the derived keys. Default value: \"m/44'/60'/0'/0\"\r\n            initialIndex: 0, // The initial index to derive. Default value: 0.\r\n            count: 20, // The number of accounts to derive. Default value: 20.\r\n            passphrase: \"\" // The passphrase for the wallet. Default value: empty string.\r\n          }\r\n        }\r\n      },\r\n      solidity: {\r\n        compilers: [\r\n          {\r\n            version: \"0.8.10\"\r\n          }\r\n        ],\r\n        settings: {\r\n          optimizer: {\r\n            enabled: false\r\n          }\r\n        }\r\n      },\r\n      paths: {\r\n        sources: \"./contracts\",\r\n        tests: \"./test\",\r\n        cache: \"./cache\",\r\n        artifacts: \"./artifacts\"\r\n      },\r\n      mocha: {\r\n        timeout: 100000000\r\n      }\r\n    };\r\n\r\nI have deployed JS script that deploys my smart contract through usage of these code lines:\r\n\r\n    const Flashloan = await hre.ethers.getContractFactory(\"Flashloan\");\r\n    const flashLoan = await Flashloan.deploy(<input arg>);\r\n    await flashLoan.deployed();\r\n\r\nThen I launch my JS monitoring bot that listens to each one of the above five forks and mainnets depending on the flag that I set in runtime.\r\n\r\nThe issue I face is this:\r\n\r\nFor each one of the forks, I would like to test separate contract addresses (tokens and smart contracts) under my backend solidity smart contract but seem to run into problems such as this one: **Error HH101: Hardhat was set to use chain id 1, but connected to a chain with id 31337.**\r\n\r\nAnd when I seem to progress I run into this other error but this time in Solidity back-end \"**Error: Transaction reverted: function call to a non-contract account**\" which indicate perhaps I am running under different network or chainId in Hardhat localhost. This is the confusion that I have and would like to toggle between each of the fork networks/chainId for my bot through this toggle.\r\n\r\nUpon deploy function call in deploy JS script, in the backend solidity constructor function for the flashloan smart contract, I print out the current `chainId` of the network I am using and it keeps returning the same chainId value each time **31337**. See below print out code snippet:\r\n\r\n    console.log(\"block.chainid \", block.chainid);\r\n\r\nWhat am I missing here or what seems to be the problem.\r\n\r\nFYI, I would like to have forks and mainnets for each of Ethereum, Polygon, Avalanche, Arbitrum and BSC networks. Not sure if it´s a question of correctly configuring the corresponding chainIds which I have attempted directly in hardhat.config.as as shown above.\r\n\r\nThis is where I need some help and guidance from your shared wisdom.\r\n\r\nThank you very much for your assistance on this topic.\r\n\r\nBest\n\n### Search terms\n\nfork mainnets, hardhat",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1439674967",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3640#issuecomment-1439674967",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3640",
    "id": 1439674967,
    "node_id": "IC_kwDOB7jojM5Vz7JX",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T09:16:16Z",
    "updated_at": "2023-02-22T09:16:16Z",
    "author_association": "MEMBER",
    "body": "I responded to the same thing [here](https://github.com/NomicFoundation/hardhat/issues/2305#issuecomment-1439673195).\r\n\r\nNotice that the issue tracker is for bug reports and feature requests, not for questions. Please open a discussion for that.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1439674967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
