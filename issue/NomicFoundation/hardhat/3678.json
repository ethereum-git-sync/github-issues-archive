{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3678",
  "id": 1586917783,
  "node_id": "I_kwDOB7jojM5elnGX",
  "number": 3678,
  "title": "Ethers is configured for the wrong network when running a task",
  "user": {
    "login": "SleepingShell",
    "id": 9204264,
    "node_id": "MDQ6VXNlcjkyMDQyNjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9204264?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SleepingShell",
    "html_url": "https://github.com/SleepingShell",
    "followers_url": "https://api.github.com/users/SleepingShell/followers",
    "following_url": "https://api.github.com/users/SleepingShell/following{/other_user}",
    "gists_url": "https://api.github.com/users/SleepingShell/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SleepingShell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SleepingShell/subscriptions",
    "organizations_url": "https://api.github.com/users/SleepingShell/orgs",
    "repos_url": "https://api.github.com/users/SleepingShell/repos",
    "events_url": "https://api.github.com/users/SleepingShell/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SleepingShell/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-02-16T02:59:34Z",
  "updated_at": "2023-05-23T00:14:02Z",
  "closed_at": "2023-02-21T10:50:43Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\r\n\r\n2.12.5\r\n\r\n### What happened?\r\n\r\nI am attempting to use hardhat tasks to perform various functions on deployed contracts on the Sepolia network. However, the HRE ethers instance does not seem to be configured with the correct network info, or perhaps I am misreading the hre object and getting a different kind of bug.\r\n\r\nI have this configured network in my ``hardhat.config.ts``\r\n```\r\nnetworks: {\r\n    sepolia: {\r\n      url: \"https://rpc.sepolia.org/\",\r\n      chainId: 11155111,\r\n      accounts: {\r\n        mnemonic: MNEMONIC,\r\n        path: MNEMONIC_PATH,\r\n        initialIndex: 1,\r\n      },\r\n    },\r\n  },\r\n``` \r\n\r\nThis is an example task I have in my project as a file in ``scripts/deployMockToken.ts`` (these are the complete contents of the file):\r\n\r\n```\r\nimport { task } from \"hardhat/config\";\r\n\r\ntask(\"deployMock\", \"Deploy a mock token that anyone can mint\").setAction(async (args, hre) => {\r\n  const mock = await (await ethers.getContractFactory(\"MockERC20\")).deploy(\"Mock\", \"MCK\");\r\n  console.log(hre.network);\r\n  console.log(\"-------\");\r\n  console.log(hre.ethers.provider);\r\n  console.log(`Token deployed to: ${mock.address}`);\r\n});\r\n```\r\nRun with ``npx hardhat --network sepolia deployMock``\r\n\r\nThe print statement from ``hre.network`` shows Sepolia correctly. However, printing out ``hre.ethers.provider`` shows the following properties\r\n```\r\n...\r\n  anyNetwork: false,\r\n  _networkPromise: Promise {\r\n    {\r\n      name: 'sepolia',\r\n      chainId: 11155111,\r\n      ensAddress: null,\r\n      _defaultProvider: [Function]\r\n    }\r\n  },\r\n  _maxInternalBlockNumber: 2909837,\r\n  _lastBlockNumber: -2,\r\n  _maxFilterBlockRange: 10,\r\n  _pollingInterval: 4000,\r\n  _fastQueryDate: 1676515914423,\r\n  connection: { url: 'http://localhost:8545' },\r\n...\r\n```\r\nAs such, the token is being deployed not to the real Sepolia network and does not show up in etherscan.\r\n\r\n\r\n### Minimal reproduction steps\r\n\r\n1. Write a hardhat task\r\n2. Attempt to run it with the ``--network`` flag\r\n\r\n### Search terms\r\n\r\nethers network configuration hre wrong",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1435432732",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3678#issuecomment-1435432732",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678",
    "id": 1435432732,
    "node_id": "IC_kwDOB7jojM5Vjvcc",
    "user": {
      "login": "SleepingShell",
      "id": 9204264,
      "node_id": "MDQ6VXNlcjkyMDQyNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9204264?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SleepingShell",
      "html_url": "https://github.com/SleepingShell",
      "followers_url": "https://api.github.com/users/SleepingShell/followers",
      "following_url": "https://api.github.com/users/SleepingShell/following{/other_user}",
      "gists_url": "https://api.github.com/users/SleepingShell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SleepingShell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SleepingShell/subscriptions",
      "organizations_url": "https://api.github.com/users/SleepingShell/orgs",
      "repos_url": "https://api.github.com/users/SleepingShell/repos",
      "events_url": "https://api.github.com/users/SleepingShell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SleepingShell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-18T00:59:44Z",
    "updated_at": "2023-02-18T00:59:44Z",
    "author_association": "NONE",
    "body": "Okay, perhaps the RPC endpoint I was using just happened to not be working correctly, as now all the transactions I created in the past 2 days executed. So am I right that the connection of the ethers object *is* supposed to be localhost, and not the actual endpoint?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1435432732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1438264443",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3678#issuecomment-1438264443",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3678",
    "id": 1438264443,
    "node_id": "IC_kwDOB7jojM5Vuix7",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-21T10:50:43Z",
    "updated_at": "2023-02-21T10:50:43Z",
    "author_association": "MEMBER",
    "body": "The provider was probably correct. If you are talking about the `url: 'http://localhost:8545'` part, that is just a misleading output (see https://github.com/NomicFoundation/hardhat/issues/1138)",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1438264443/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
