{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1804",
  "id": 972828096,
  "node_id": "MDU6SXNzdWU5NzI4MjgwOTY=",
  "number": 1804,
  "title": "feature request: support for read-only fs like AWS Lambda",
  "user": {
    "login": "campionfellin",
    "id": 11984923,
    "node_id": "MDQ6VXNlcjExOTg0OTIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11984923?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/campionfellin",
    "html_url": "https://github.com/campionfellin",
    "followers_url": "https://api.github.com/users/campionfellin/followers",
    "following_url": "https://api.github.com/users/campionfellin/following{/other_user}",
    "gists_url": "https://api.github.com/users/campionfellin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/campionfellin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/campionfellin/subscriptions",
    "organizations_url": "https://api.github.com/users/campionfellin/orgs",
    "repos_url": "https://api.github.com/users/campionfellin/repos",
    "events_url": "https://api.github.com/users/campionfellin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/campionfellin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-08-17T15:44:29Z",
  "updated_at": "2022-11-17T21:12:43Z",
  "closed_at": "2022-08-06T20:33:34Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Proposed feature: Support for AWS Lambda as an environment for using hardhat\r\n\r\n#### Reasoning\r\n\r\nI see you support a number of other CI systems (code [here](https://github.com/nomiclabs/hardhat/blob/master/packages/hardhat-core/src/internal/util/ci-detection.ts#L4-L18)).\r\n\r\nI know that Lambda is not really a CI tool, so-to-speak, but we have a use case for generating and compiling contracts on-the-fly in response to client requests. This is essentially the flow:\r\n\r\n* Client enters in contract name, symbol, etc\r\n* Backend fills out template file with that info, the runs `npx hardhat compile` and returns the ABI and Bytecode.\r\n\r\nThere's a number of issues I ran into while implementing this, and I think the `hardhat` library could probably fix fairly easily on your side of things.\r\n\r\n1. The Lambda container is a read-only file system (but does give you access to write under the `/tmp/` directory. That being said, the code for the app gets mounted at `/var/task/`.\r\n\r\nSince we need to write the `.sol` files as clients make requests, we write them to the `/tmp` directory. However, hardhat won't let us compile if that is different than the directory the node modules was installed in. For example:\r\n\r\n```js\r\n// inside of /tmp directory\r\nexecSync(`cd /tmp/ && node /var/task/node_modules/hardhat/internal/cli/cli.js compile --verbose --config ./hardhat.config.js`, {stdio: 'inherit'})\r\n```\r\n\r\nThis fails with [HH12](https://hardhat.org/errors/#HH12) that hardhat is not installed locally.\r\n\r\nTo get around this, we must copy the `node_modules` into `/tmp` for each request.\r\n\r\n```js\r\nexecSync(`cp -r /var/task/node_modules /tmp/`)\r\n```\r\n\r\nThis is manageable, but does add more latency to the request.\r\n\r\nThe next error is a bit trickier, and let me to one of your dependencies. When you are ensuring the directory (I think for telemetry?) [here](https://github.com/nomiclabs/hardhat/blob/master/packages/hardhat-core/src/internal/util/global-dir.ts#L21) it tries to write to something like `/home/user_123`.\r\n\r\nTo get around this, I found in that `env-paths` dependency [here](https://github.com/sindresorhus/env-paths/blob/main/index.js#L40-L44), you can set environmental variables to specify which path, so I put that to `/tmp` and it worked.\r\n\r\n---\r\n\r\nI guess as far as concrete proposals go - here is what I think would be nice\r\n\r\n1. CLI flag to ignore the \"local installation\" error, especially if I am running it with the full path.\r\n2. For the issue with the dependency and the `ensureDir()` call I am thinking perhaps there can be a way to turn off telemetry so it doesn't even attempt to do this? I am not sure though, that one is a bit tougher.\r\n\r\n---\r\n\r\nPlease let me know if you need any more info or if you want to chat! Thanks :)\r\n\r\n\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/904829202",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1804#issuecomment-904829202",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804",
    "id": 904829202,
    "node_id": "IC_kwDOB7jojM417pkS",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-24T17:17:04Z",
    "updated_at": "2021-08-24T17:17:04Z",
    "author_association": "MEMBER",
    "body": "> CLI flag to ignore the \"local installation\" error, especially if I am running it with the full path.\r\n\r\nI don't think this is something we want to do, since the assumption of a local installation is important. I think that you can accomplish what you want (compiling contracts that are outside the project) by overriding some compilation subtasks. This isn't easy, but it's not that hard either. But I don't know if this would make sense for your particular use case. The main question is if you can modify the hardhat config to make this change.\r\n\r\n> For the issue with the dependency and the `ensureDir()` call I am thinking perhaps there can be a way to turn off telemetry so it doesn't even attempt to do this? I am not sure though, that one is a bit tougher.\r\n\r\nThis isn't the first time someone reports that this part of the telemetry check is causing issues. I think we just need to make that part more robust.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/904829202/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/907838089",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1804#issuecomment-907838089",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804",
    "id": 907838089,
    "node_id": "IC_kwDOB7jojM42HIKJ",
    "user": {
      "login": "campionfellin",
      "id": 11984923,
      "node_id": "MDQ6VXNlcjExOTg0OTIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11984923?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/campionfellin",
      "html_url": "https://github.com/campionfellin",
      "followers_url": "https://api.github.com/users/campionfellin/followers",
      "following_url": "https://api.github.com/users/campionfellin/following{/other_user}",
      "gists_url": "https://api.github.com/users/campionfellin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/campionfellin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/campionfellin/subscriptions",
      "organizations_url": "https://api.github.com/users/campionfellin/orgs",
      "repos_url": "https://api.github.com/users/campionfellin/repos",
      "events_url": "https://api.github.com/users/campionfellin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/campionfellin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-29T17:52:08Z",
    "updated_at": "2021-08-29T17:52:08Z",
    "author_association": "NONE",
    "body": "What is the definition of local for hardhat? I would have thought specifying a full path on the machine is local enough. I ended up getting it working, but we decided to go another route besides Lambda for other reasons.\r\n\r\nLet me know if you end up making fixes for the telemetry! Feel free to close this for now as it's not a super pressing issue. Thanks for all the help and building such a great tool :)",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/907838089/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/908441399",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1804#issuecomment-908441399",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804",
    "id": 908441399,
    "node_id": "IC_kwDOB7jojM42Jbc3",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T15:30:40Z",
    "updated_at": "2021-08-30T15:30:40Z",
    "author_association": "MEMBER",
    "body": "> What is the definition of local for hardhat?\r\n\r\nInstalled with, for example, `npm i hardhat` instead of using a Hardhat version installed with `npm i -g hardhat`.\r\n\r\n> Feel free to close this for now as it's not a super pressing issue.\r\n\r\nI think we should keep this open, because our fs code should be more robust in scenarios like this",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/908441399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1200289565",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1804#issuecomment-1200289565",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804",
    "id": 1200289565,
    "node_id": "IC_kwDOB7jojM5Hivcd",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-30T20:33:32Z",
    "updated_at": "2022-07-30T20:33:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1200289565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1207278956",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1804#issuecomment-1207278956",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1804",
    "id": 1207278956,
    "node_id": "IC_kwDOB7jojM5H9Z1s",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-08-06T20:33:34Z",
    "updated_at": "2022-08-06T20:33:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1207278956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
