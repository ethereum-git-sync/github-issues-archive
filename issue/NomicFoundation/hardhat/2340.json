{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2340",
  "id": 1125237917,
  "node_id": "I_kwDOB7jojM5DEcSd",
  "number": 2340,
  "title": "Testing of basic contract fails",
  "user": {
    "login": "inflation-man",
    "id": 83922229,
    "node_id": "MDQ6VXNlcjgzOTIyMjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/83922229?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/inflation-man",
    "html_url": "https://github.com/inflation-man",
    "followers_url": "https://api.github.com/users/inflation-man/followers",
    "following_url": "https://api.github.com/users/inflation-man/following{/other_user}",
    "gists_url": "https://api.github.com/users/inflation-man/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/inflation-man/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/inflation-man/subscriptions",
    "organizations_url": "https://api.github.com/users/inflation-man/orgs",
    "repos_url": "https://api.github.com/users/inflation-man/repos",
    "events_url": "https://api.github.com/users/inflation-man/events{/privacy}",
    "received_events_url": "https://api.github.com/users/inflation-man/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "zoeyTM",
    "id": 14796043,
    "node_id": "MDQ6VXNlcjE0Nzk2MDQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/14796043?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zoeyTM",
    "html_url": "https://github.com/zoeyTM",
    "followers_url": "https://api.github.com/users/zoeyTM/followers",
    "following_url": "https://api.github.com/users/zoeyTM/following{/other_user}",
    "gists_url": "https://api.github.com/users/zoeyTM/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zoeyTM/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zoeyTM/subscriptions",
    "organizations_url": "https://api.github.com/users/zoeyTM/orgs",
    "repos_url": "https://api.github.com/users/zoeyTM/repos",
    "events_url": "https://api.github.com/users/zoeyTM/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zoeyTM/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "zoeyTM",
      "id": 14796043,
      "node_id": "MDQ6VXNlcjE0Nzk2MDQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/14796043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zoeyTM",
      "html_url": "https://github.com/zoeyTM",
      "followers_url": "https://api.github.com/users/zoeyTM/followers",
      "following_url": "https://api.github.com/users/zoeyTM/following{/other_user}",
      "gists_url": "https://api.github.com/users/zoeyTM/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zoeyTM/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zoeyTM/subscriptions",
      "organizations_url": "https://api.github.com/users/zoeyTM/orgs",
      "repos_url": "https://api.github.com/users/zoeyTM/repos",
      "events_url": "https://api.github.com/users/zoeyTM/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zoeyTM/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-02-06T15:44:42Z",
  "updated_at": "2022-11-18T10:05:26Z",
  "closed_at": "2022-02-06T17:46:51Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I had a few issues when testing my smart contracts. First it would estimate that basic smart contract function calls would run out of gas, when I overrode the gas limit, it would either loop infinitely when deployed to a hardhat node or throw the following error when tested.\r\n```\r\nError: Timeout of 2000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (./test/testMapping.spec.ts)\r\n      at listOnTimeout (internal/timers.js:554:17)\r\n      at processTimers (internal/timers.js:497:7)\r\n```\r\nI have reduced my repository further and further until I was left with this. The code runs fine with remix, but fails when tested with hardhat.\r\nMappingContract.sol\r\n```\r\npragma solidity = 0.8.11;\r\n\r\ncontract MappingContract{\r\n    mapping(uint256 => uint256) internal identity;\r\n\r\n    function addNumber(uint256 number) external{\r\n        identity[number] = number;\r\n    }\r\n\r\n    function getIdentity(uint256 number) external returns (uint256 numberOut){\r\n        numberOut = identity[number];\r\n    }\r\n\r\n    constructor() {\r\n        identity[0] = 0;\r\n    }\r\n}\r\n```\r\ntestMapping.spec.ts\r\n```\r\nconst { waffle } = require('hardhat');\r\nconst { ethers } = require('hardhat');\r\nconst { expect } = require('chai');\r\n\r\nconst { Contract, Wallet, BigNumber } = ethers;\r\nconst { MockProvider, deployContract } = waffle;\r\n\r\nconst overrides = {\r\n    gasLimit: 13000000\r\n};\r\n\r\ndescribe('Mapping Test', () => {\r\n\r\n    it('test', async () => {\r\n        const signers = await ethers.getSigners();\r\n        let owner = signers[0];\r\n\r\n        let mAddress= await ethers.getContractFactory(\"MappingContract\");\r\n\r\n        let m = await mAddress.deploy();\r\n\r\n        let result = await m.getIdentity(0);\r\n        \r\n    });\r\n});\r\n```\r\npackage.json\r\n```\r\n{\r\n  \"name\": \"MappingTest\",\r\n  \"version\": \"1.1.0-beta.0\",\r\n  \"description\": \"Mapping Tests\",\r\n  \"engines\": {\r\n    \"node\": \">=10\"\r\n  },\r\n  \"files\": [\r\n    \"build\",\r\n    \"contracts\"\r\n  ],\r\n  \"dependencies\": {},\r\n  \"devDependencies\": {\r\n    \"@nomiclabs/hardhat-ethers\": \"^2.0.4\",\r\n    \"@nomiclabs/hardhat-waffle\": \"^2.0.2\",\r\n    \"chai\": \"^4.2.0\",\r\n    \"ethereum-waffle\": \"^3.4.0\",\r\n    \"ethers\": \"^5.5.4\",\r\n    \"hardhat\": \"2.8.3\",\r\n    \"mocha\": \"^6.2.2\",\r\n    \"typescript\": \"^3.7.3\"\r\n  },\r\n  \"scripts\": {\r\n    \"compile\": \"yarn hardhat compile\",\r\n    \"test\": \"yarn mocha test/testMapping.spec.ts\"\r\n  },\r\n  \"license\": \"GPL-3.0-or-later\"\r\n}\r\n```\r\nhardhat.config.js\r\n```\r\nrequire('@nomiclabs/hardhat-ethers');\r\nrequire('@nomiclabs/hardhat-waffle');\r\n\r\nmodule.exports = {\r\n  networks: {\r\n      hardhat: {\r\n          mining: {\r\n              auto: false,\r\n              interval: 5000,\r\n          },\r\n          blockGasLimit: 13000000,\r\n          gasPrice: 20\r\n      },\r\n  },\r\n  \r\n  solidity: {\r\n      compilers:[\r\n          {\r\n              version: \"0.8.11\"\r\n          }\r\n      ]\r\n  }\r\n};\r\n```",
  "closed_by": {
    "login": "inflation-man",
    "id": 83922229,
    "node_id": "MDQ6VXNlcjgzOTIyMjI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/83922229?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/inflation-man",
    "html_url": "https://github.com/inflation-man",
    "followers_url": "https://api.github.com/users/inflation-man/followers",
    "following_url": "https://api.github.com/users/inflation-man/following{/other_user}",
    "gists_url": "https://api.github.com/users/inflation-man/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/inflation-man/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/inflation-man/subscriptions",
    "organizations_url": "https://api.github.com/users/inflation-man/orgs",
    "repos_url": "https://api.github.com/users/inflation-man/repos",
    "events_url": "https://api.github.com/users/inflation-man/events{/privacy}",
    "received_events_url": "https://api.github.com/users/inflation-man/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1030880473",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2340#issuecomment-1030880473",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2340",
    "id": 1030880473,
    "node_id": "IC_kwDOB7jojM49cfzZ",
    "user": {
      "login": "inflation-man",
      "id": 83922229,
      "node_id": "MDQ6VXNlcjgzOTIyMjI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/83922229?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/inflation-man",
      "html_url": "https://github.com/inflation-man",
      "followers_url": "https://api.github.com/users/inflation-man/followers",
      "following_url": "https://api.github.com/users/inflation-man/following{/other_user}",
      "gists_url": "https://api.github.com/users/inflation-man/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/inflation-man/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/inflation-man/subscriptions",
      "organizations_url": "https://api.github.com/users/inflation-man/orgs",
      "repos_url": "https://api.github.com/users/inflation-man/repos",
      "events_url": "https://api.github.com/users/inflation-man/events{/privacy}",
      "received_events_url": "https://api.github.com/users/inflation-man/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-06T17:46:51Z",
    "updated_at": "2022-02-06T17:46:51Z",
    "author_association": "NONE",
    "body": "My bad\r\nhttps://ethereum.stackexchange.com/questions/120957/hardhat-basic-test-fails",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1030880473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
