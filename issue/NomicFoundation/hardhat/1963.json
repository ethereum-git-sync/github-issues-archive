{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963",
  "id": 1030927215,
  "node_id": "I_kwDOB7jojM49crNv",
  "number": 1963,
  "title": "impersonating two different accounts got exactly the same tx hash",
  "user": {
    "login": "Detoo",
    "id": 1946265,
    "node_id": "MDQ6VXNlcjE5NDYyNjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1946265?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Detoo",
    "html_url": "https://github.com/Detoo",
    "followers_url": "https://api.github.com/users/Detoo/followers",
    "following_url": "https://api.github.com/users/Detoo/following{/other_user}",
    "gists_url": "https://api.github.com/users/Detoo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Detoo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Detoo/subscriptions",
    "organizations_url": "https://api.github.com/users/Detoo/orgs",
    "repos_url": "https://api.github.com/users/Detoo/repos",
    "events_url": "https://api.github.com/users/Detoo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Detoo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2021-10-20T03:09:04Z",
  "updated_at": "2023-04-05T00:12:15Z",
  "closed_at": "2023-01-04T17:24:34Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "## How to reproduce\r\n- download files from this [gist](https://gist.github.com/Detoo/94faefe5c41324b8365582952f50193d)\r\n- start hardhat fork node on `rinkeby` block number `9369746`\r\n- execute run.ts\r\n\r\n## Expected results\r\nsaw 24 different txs with unique hashes\r\n\r\n## Actual results\r\ntwo of the hashes collides:\r\n```typescript\r\n// from: 0xC18F4EfD791e2fa6D34aF94a1B0a6bca65402E58, tx hash: 0x1bc754ec661fd6b64cbbf4b12375f9e3579bfcb30dd6232b1aa75113bd159d8d, blockNumber: 9369757\r\n// from: 0x9D1Cc5b07121EEe7fa1427BDdD6871d2B93536df, tx hash: 0x1bc754ec661fd6b64cbbf4b12375f9e3579bfcb30dd6232b1aa75113bd159d8d, blockNumber: 9369758\r\n```",
  "closed_by": {
    "login": "alcuadrado",
    "id": 176499,
    "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alcuadrado",
    "html_url": "https://github.com/alcuadrado",
    "followers_url": "https://api.github.com/users/alcuadrado/followers",
    "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
    "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
    "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
    "repos_url": "https://api.github.com/users/alcuadrado/repos",
    "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947598251",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-947598251",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 947598251,
    "node_id": "IC_kwDOB7jojM44ezOr",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T12:04:10Z",
    "updated_at": "2021-10-20T12:04:10Z",
    "author_association": "MEMBER",
    "body": "I can confirm this. Really strange.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947598251/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947645119",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-947645119",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 947645119,
    "node_id": "IC_kwDOB7jojM44e-q_",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T13:03:38Z",
    "updated_at": "2021-10-20T13:03:49Z",
    "author_association": "MEMBER",
    "body": "The reason this must be happening is that we use a fake, hardcoded, signature for those. \r\n\r\nThese txs have the exact same params except for the sender, which would lead to a different signature. As we hardcode it, they don't differ, and hence have the same hash.\r\n\r\nWe should either:\r\n\r\n1) Randomize the signature\r\n2) Make it somehow dependent on the sender and the rest of the params of the tx.\r\n\r\nI think I prefer 2",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947645119/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947705494",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-947705494",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 947705494,
    "node_id": "IC_kwDOB7jojM44fNaW",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T14:09:58Z",
    "updated_at": "2021-10-20T14:09:58Z",
    "author_association": "MEMBER",
    "body": "There are other transactions with the same params that don't produce the same transaction hash, so maybe there's something else that affects the resulting hash (the nonce?). But yeah, the fake signature is probably the root of the problem.\r\n\r\nI also prefer the second option.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947705494/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948620125",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-948620125",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 948620125,
    "node_id": "IC_kwDOB7jojM44istd",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T13:30:32Z",
    "updated_at": "2021-10-21T13:30:32Z",
    "author_association": "MEMBER",
    "body": "> There are other transactions with the same params that don't produce the same transaction hash, so maybe there's something else that affects the resulting hash (the nonce?).\r\n\r\nNote that to have the same params you need to use the same nonce. The only way of doing this is sending from multiple accounts. I guess @Detoo is sending the exact same tx from multiple accounts that haven't sent any tx yet.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948620125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948851388",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-948851388",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 948851388,
    "node_id": "IC_kwDOB7jojM44jlK8",
    "user": {
      "login": "Detoo",
      "id": 1946265,
      "node_id": "MDQ6VXNlcjE5NDYyNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1946265?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Detoo",
      "html_url": "https://github.com/Detoo",
      "followers_url": "https://api.github.com/users/Detoo/followers",
      "following_url": "https://api.github.com/users/Detoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Detoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Detoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Detoo/subscriptions",
      "organizations_url": "https://api.github.com/users/Detoo/orgs",
      "repos_url": "https://api.github.com/users/Detoo/repos",
      "events_url": "https://api.github.com/users/Detoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Detoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T17:32:43Z",
    "updated_at": "2021-10-21T17:32:43Z",
    "author_association": "NONE",
    "body": "> Note that to have the same params you need to use the same nonce. The only way of doing this is sending from multiple accounts. I guess @Detoo is sending the exact same tx from multiple accounts that haven't sent any tx yet.\r\n\r\nthey have exactly the same number of prior txs indeed. Both have six before block `9369746`:\r\nhttps://rinkeby.etherscan.io/txs?a=0xC18F4EfD791e2fa6D34aF94a1B0a6bca65402E58&p=3\r\nhttps://rinkeby.etherscan.io/txs?a=0x9D1Cc5b07121EEe7fa1427BDdD6871d2B93536df&p=1",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948851388/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/951246637",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-951246637",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 951246637,
    "node_id": "IC_kwDOB7jojM44st8t",
    "user": {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T19:38:45Z",
    "updated_at": "2021-10-25T19:38:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "FakeSenderTransaction.ts\r\nFakeSender*.ts\r\nall 3 of those will need to be updated.\r\n\r\nFor signatures in these transactions, we should make them dependent on the input (both the `data` parameter _and_ the `sender` parameter), so there aren't collisions with other fake transactions with the same nonce. Find some way to \"encode\"/\"hash\" the input data into the r,s,v parameters of the transaction.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/951246637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/976183071",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-976183071",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 976183071,
    "node_id": "IC_kwDOB7jojM46L18f",
    "user": {
      "login": "Detoo",
      "id": 1946265,
      "node_id": "MDQ6VXNlcjE5NDYyNjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1946265?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Detoo",
      "html_url": "https://github.com/Detoo",
      "followers_url": "https://api.github.com/users/Detoo/followers",
      "following_url": "https://api.github.com/users/Detoo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Detoo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Detoo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Detoo/subscriptions",
      "organizations_url": "https://api.github.com/users/Detoo/orgs",
      "repos_url": "https://api.github.com/users/Detoo/repos",
      "events_url": "https://api.github.com/users/Detoo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Detoo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-23T05:45:13Z",
    "updated_at": "2021-11-23T05:45:13Z",
    "author_association": "NONE",
    "body": "hi all, this might be obvious but just'd like to add another observation: \r\nThe duplicate txs also seems to cause duplicate event logs. It can be reproduced by running `ethers.provider.getLogs()` over the above block range",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/976183071/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185715687",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1963#issuecomment-1185715687",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1963",
    "id": 1185715687,
    "node_id": "IC_kwDOB7jojM5GrJXn",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-15T16:41:32Z",
    "updated_at": "2022-07-15T16:41:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1185715687/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
