{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4119",
  "id": 1793657728,
  "node_id": "I_kwDOB7jojM5q6QuA",
  "number": 4119,
  "title": "Occasional Error with NPM install in Github Actions",
  "user": {
    "login": "ulmentflam",
    "id": 6037314,
    "node_id": "MDQ6VXNlcjYwMzczMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6037314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ulmentflam",
    "html_url": "https://github.com/ulmentflam",
    "followers_url": "https://api.github.com/users/ulmentflam/followers",
    "following_url": "https://api.github.com/users/ulmentflam/following{/other_user}",
    "gists_url": "https://api.github.com/users/ulmentflam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ulmentflam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ulmentflam/subscriptions",
    "organizations_url": "https://api.github.com/users/ulmentflam/orgs",
    "repos_url": "https://api.github.com/users/ulmentflam/repos",
    "events_url": "https://api.github.com/users/ulmentflam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ulmentflam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2474207618,
      "node_id": "MDU6TGFiZWwyNDc0MjA3NjE4",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:needs-more-info",
      "name": "status:needs-more-info",
      "color": "0E8A16",
      "default": false,
      "description": "There's not enough information to start working on this issue"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-07-07T14:35:07Z",
  "updated_at": "2023-07-12T15:24:43Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.16.1\r\n\r\n### What happened?\r\n\r\nWhen running in the github actions docker container `ubuntu-latest`, hardhat will occasionally fail to compile solidity v0.8.9 during `npm install` with the following error: \r\n\r\n```\r\nnpm ERR! code 1\r\nnpm ERR! git dep preparation failed\r\nnpm ERR! command /opt/hostedtoolcache/node/1[8](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:9).16.1/x64/bin/node /opt/hostedtoolcache/node/18.16.1/x64/lib/node_modules/npm/bin/npm-cli.js install --force --cache=/home/runner/.npm --prefer-offline=false --prefer-online=false --offline=false --no-progress --no-save --no-audit --include=dev --include=peer --include=optional --no-package-lock-only --no-dry-run\r\nnpm ERR! npm ERR! code 1\r\nnpm ERR! npm ERR! git dep preparation failed\r\nnpm ERR! npm ERR! command /opt/hostedtoolcache/node/18.16.1/x64/bin/node /opt/hostedtoolcache/node/18.16.1/x64/lib/node_modules/npm/bin/npm-cli.js install --force --cache=/home/runner/.npm --prefer-offline=false --prefer-online=false --offline=false --no-progress --no-save --no-audit --include=dev --include=peer --include=optional --no-package-lock-only --no-dry-run\r\nnpm ERR! npm ERR! > @0xsequence/create3@3.0.0 prepare\r\nnpm ERR! npm ERR! > yarn build\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! yarn run v1.22.1[9](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:10)\r\nnpm ERR! npm ERR! $ hardhat compile\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nnpm ERR! npm ERR! Solidity 0.8.9 is not fully supported yet. You can still use Hardhat, but some features, like stack traces, might not work correctly.\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! Learn more at https://hardhat.org/reference/solidity-support\"\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! An unexpected error occurred:\r\nnpm ERR! npm ERR! SyntaxError: /home/runner/.cache/hardhat-nodejs/compilers/linux-amd64/list.json: Unexpected end of JSON input\r\nnpm ERR! npm ERR!     at JSON.parse (<anonymous>)\r\nnpm ERR! npm ERR!     at /home/runner/.npm/_cacache/tmp/git-clone4VrSzb/node_modules/jsonfile/index.js:33:18\r\nnpm ERR! npm ERR!     at /home/runner/.npm/_cacache/tmp/git-clone4VrSzb/node_modules/graceful-fs/graceful-fs.js:123:16\r\nnpm ERR! npm ERR!     at FSReqCallback.readFileAfterClose [as oncomplete] (node:internal/fs/read_file_context:68:3)\r\nnpm ERR! npm ERR! error Command failed with exit code 1.\r\nnpm ERR! npm ERR! npm ERR! code 1\r\nnpm ERR! npm ERR! npm ERR! path /home/runner/.npm/_cacache/tmp/git-clone4VrSzb\r\nnpm ERR! npm ERR! npm ERR! command failed\r\nnpm ERR! npm ERR! npm ERR! command sh -c yarn build\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! npm ERR! A complete log of this run can be found in:\r\nnpm ERR! npm ERR! npm ERR!     /home/runner/.npm/_logs/2023-07-07T[13](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:14)_46_42_922Z-debug-0.log\r\nnpm ERR! \r\nnpm ERR! npm ERR! A complete log of this run can be found in:\r\nnpm ERR! npm ERR!     /home/runner/.npm/_logs/[20](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:21)[23](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:24)-07-07T13_46_40_892Z-debug-0.log\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /home/runner/.npm/_logs/2023-07-07T13_46_[25](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:26)_908Z-debug-0.log\r\nmake: *** [Makefile:[38](https://github.com/<repo_name>/actions/runs/id/jobs/id#step:5:39): setup] Error 1\r\nError: Process completed with exit code 2.\r\n```\r\n\r\nIf the action is run a second time, this error resolves. It is very strange that this issue is resolved with it is run again. It's hit or miss when this error appears. It could also be related to dependencies, `@0xsequence` and `@openzepplin` are both installed with npm, but npm installs dependencies without issues elsewhere. I have also experienced the same issue with running `py-solc-x` with the mythx-cli. This same error occurs occasionally at the same compile step for different dependencies. \r\n\r\n### Minimal reproduction steps\r\n\r\nThe GitHub actions yaml to reproduce this is as follows:\r\n\r\n```yaml\r\nname: CI\r\n\r\non:\r\n  push:\r\n    branches: '*'\r\n\r\njobs:\r\n  build:\r\n    defaults:\r\n      run:\r\n        working-directory: .\r\n\r\n    name: Build\r\n    runs-on: ubuntu-latest\r\n\r\n    steps:\r\n      - uses: actions/checkout@v3\r\n      - uses: actions/setup-node@v3\r\n        with:\r\n          node-version: 18.16.1\r\n          cache: npm\r\n      - name: Install Dependencies\r\n        run: npm install\r\n```\r\n\r\nA sample package.json is as follows:\r\n```json\r\n{\r\n  \"name\": \"sample\",\r\n  \"version\": \"1.0.0\",\r\n  \"description\": \"sample package.json\",\r\n  \"main\": \"index.js\",\r\n  \"scripts\": {\r\n    \"compile\": \"hardhat compile\",\r\n    \"test\": \"hardhat test\",\r\n    \"format\": \"prettier --write 'contracts/**/*.sol'\",\r\n    \"lint\": \"solhint 'contracts/**/*.sol' && prettier --list-different 'contracts/**/*.sol'\"\r\n  },\r\n  \"author\": \"\",\r\n  \"license\": \"\",\r\n  \"devDependencies\": {\r\n    \"@0xsequence/sstore2\": \"https://github.com/0xsequence/sstore2\",\r\n    \"@nomicfoundation/hardhat-chai-matchers\": \"^1.0.6\",\r\n    \"@nomicfoundation/hardhat-network-helpers\": \"^1.0.8\",\r\n    \"@nomicfoundation/hardhat-toolbox\": \"^2.0.2\",\r\n    \"@nomiclabs/hardhat-ethers\": \"^2.2.2\",\r\n    \"@nomiclabs/hardhat-etherscan\": \"^3.1.7\",\r\n    \"@openzeppelin/contracts\": \"^4.8.3\",\r\n    \"@openzeppelin/contracts-upgradeable\": \"^4.8.3\",\r\n    \"@openzeppelin/hardhat-upgrades\": \"^1.22.1\",\r\n    \"@openzeppelin/merkle-tree\": \"^1.0.4\",\r\n    \"@solidstate/hardhat-bytecode-exporter\": \"^1.1.1\",\r\n    \"@typechain/ethers-v5\": \"^10.2.1\",\r\n    \"@typechain/hardhat\": \"^6.1.6\",\r\n    \"@types/chai\": \"^4.3.5\",\r\n    \"@types/mocha\": \"^10.0.1\",\r\n    \"alchemy-sdk\": \"^2.6.1\",\r\n    \"ethers\": \"^5.7.2\",\r\n    \"hardhat\": \"^2.16.1\",\r\n    \"hardhat-docgen\": \"^1.3.0\",\r\n    \"hardhat-gas-reporter\": \"^1.0.9\",\r\n    \"lowdb\": \"^5.1.0\",\r\n    \"prettier\": \"^2.8.6\",\r\n    \"prettier-plugin-solidity\": \"^1.1.3\",\r\n    \"solhint\": \"^3.4.1\",\r\n    \"solhint-plugin-prettier\": \"^0.0.5\",\r\n    \"solidity-coverage\": \"^0.8.4\",\r\n    \"solidity-docgen\": \"^0.6.0-beta.35\",\r\n    \"ts-node\": \"^10.9.1\",\r\n    \"typechain\": \"^8.2.0\",\r\n    \"typescript\": \"^5.1.6\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@0xsequence/create3\": \"https://github.com/0xsequence/create3\",\r\n    \"chai\": \"^4.3.7\",\r\n    \"dotenv\": \"^16.0.3\",\r\n    \"uuid\": \"^9.0.0\"\r\n  }\r\n}\r\n```\r\n\r\n### Search terms\r\n\r\nhardhat compile fails occasionally github actions npm install",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1625550629",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4119#issuecomment-1625550629",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119",
    "id": 1625550629,
    "node_id": "IC_kwDOB7jojM5g4-8l",
    "user": {
      "login": "ulmentflam",
      "id": 6037314,
      "node_id": "MDQ6VXNlcjYwMzczMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6037314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ulmentflam",
      "html_url": "https://github.com/ulmentflam",
      "followers_url": "https://api.github.com/users/ulmentflam/followers",
      "following_url": "https://api.github.com/users/ulmentflam/following{/other_user}",
      "gists_url": "https://api.github.com/users/ulmentflam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ulmentflam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ulmentflam/subscriptions",
      "organizations_url": "https://api.github.com/users/ulmentflam/orgs",
      "repos_url": "https://api.github.com/users/ulmentflam/repos",
      "events_url": "https://api.github.com/users/ulmentflam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ulmentflam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-07T15:05:08Z",
    "updated_at": "2023-07-07T15:10:09Z",
    "author_association": "NONE",
    "body": "This is an additional sample of a similar error that has been occurring in the action when installing mythx-cli leveraging `py-solc-x` to install hardhat through Python, a similar re-run of the workflow was also able to fix this run.\r\n```\r\nnpm ERR! npm ERR! Solidity 0.8.9 is not fully supported yet. You can still use Hardhat, but some features, like stack traces, might not work correctly.\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! Learn more at https://hardhat.org/reference/solidity-support\"\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! Error HH503: Couldn't download compiler version 0.8.9. Checksum verification failed. Please check your connection.\r\nnpm ERR! npm ERR! For more info go to https://hardhat.org/HH503 or run Hardhat with --show-stack-traces\r\nnpm ERR! npm ERR! error Command failed with exit code 1.\r\nnpm ERR! npm ERR! npm ERR! code 1\r\nnpm ERR! npm ERR! npm ERR! path /home/runner/.npm/_cacache/tmp/git-cloneMPSkdY\r\nnpm ERR! npm ERR! npm ERR! command failed\r\nnpm ERR! npm ERR! npm ERR! command sh /tmp/prepare-26a68cad.sh\r\nnpm ERR! npm ERR! \r\nnpm ERR! npm ERR! npm ERR! A complete log of this run can be found in:\r\nnpm ERR! npm ERR! npm ERR!     /home/runner/.npm/_logs/2023-06-26T20_48_21_178Z-debug-0.log\r\nnpm ERR! \r\nnpm ERR! npm ERR! A complete log of this run can be found in:\r\nnpm ERR! npm ERR!     /home/runner/.npm/_logs/2023-06-26T20_48_18_353Z-debug-0.log\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /home/runner/.npm/_logs/2023-06-26T20_47_47_423Z-debug-0.log\r\nmake: *** [Makefile:32: setup] Error 1\r\n```\r\n\r\nThis github action runner can replicate the above behavior:\r\n\r\n```\r\nname: CI\r\n\r\non:\r\n  push:\r\n    branches: '*'\r\n\r\njobs:\r\n  analyzer:\r\n    defaults:\r\n      run:\r\n        working-directory: .\r\n    name: Mythx Analyzer\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - uses: actions/checkout@v3\r\n      - uses: actions/setup-python@v4\r\n        with:\r\n          python-version: 3.11.4\r\n      - name: Install Mythx\r\n        run: pip3 install mythx-cli\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1625550629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1632748182",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4119#issuecomment-1632748182",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4119",
    "id": 1632748182,
    "node_id": "IC_kwDOB7jojM5hUcKW",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-12T15:24:34Z",
    "updated_at": "2023-07-12T15:24:34Z",
    "author_association": "MEMBER",
    "body": "This:\r\n\r\n> Solidity 0.8.9 is not fully supported yet. You can still use Hardhat, but some features, like stack traces, might not work correctly.\r\n\r\nMakes me think that you are using a quite old version of Hardhat. Can you upgrade to the latest version and see if that fixes your problem?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1632748182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
