{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3879",
  "id": 1683033816,
  "node_id": "I_kwDOB7jojM5kUQ7Y",
  "number": 3879,
  "title": "Chaining event matchers with balance changing matchers ",
  "user": {
    "login": "Hicham010",
    "id": 47334105,
    "node_id": "MDQ6VXNlcjQ3MzM0MTA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/47334105?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Hicham010",
    "html_url": "https://github.com/Hicham010",
    "followers_url": "https://api.github.com/users/Hicham010/followers",
    "following_url": "https://api.github.com/users/Hicham010/following{/other_user}",
    "gists_url": "https://api.github.com/users/Hicham010/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Hicham010/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Hicham010/subscriptions",
    "organizations_url": "https://api.github.com/users/Hicham010/orgs",
    "repos_url": "https://api.github.com/users/Hicham010/repos",
    "events_url": "https://api.github.com/users/Hicham010/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Hicham010/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-04-25T12:01:06Z",
  "updated_at": "2023-07-25T00:15:19Z",
  "closed_at": "2023-04-25T17:12:55Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\r\n\r\n2.12.6\r\n\r\n### What happened?\r\n\r\nCombing event matchers with balance-changing matchers will ignore the event matchers. \r\n\r\nThe example below should throw an error because `WithdrawPaymentt` is misspelt and the second event argument should be 500 instead of 5000. But when this test is run it will pass.\r\n\r\n### Minimal reproduction steps\r\n\r\n```\r\n    it(\"Should withdraw the payment for the tokenizer\", async function () {\r\n      const { farmer, tradeCoinProduct } = await loadFixture(\r\n        deployTradeCoinWith5Products\r\n      );\r\n\r\n      expect(\r\n        await tradeCoinProduct.pendingWeiForWithdrawal(farmer.address)\r\n      ).to.eq(ethers.BigNumber.from(500));\r\n\r\n      await expect(tradeCoinProduct.connect(farmer).withdrawPayment())\r\n        .to.emit(tradeCoinProduct, \"WithdrawPaymentt\")\r\n        .withArgs(farmer.address, 5000)\r\n        .to.changeEtherBalances(\r\n          [tradeCoinProduct.address, farmer.address],\r\n          [-500, 500]\r\n        );\r\n\r\n      expect(\r\n        await tradeCoinProduct.pendingWeiForWithdrawal(farmer.address)\r\n      ).to.eq(ethers.BigNumber.from(0));\r\n\r\n      await expect(tradeCoinProduct.connect(farmer).withdrawPayment())\r\n        .to.emit(tradeCoinProduct, \"WithdrawPayment\")\r\n        .withArgs(farmer.address, 0)\r\n        .to.changeEtherBalances(\r\n          [tradeCoinProduct.address, farmer.address],\r\n          [0, 0]\r\n        );\r\n    });\r\n```\r\n\r\n### Search terms\r\n\r\nChai Matchers",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1522141052",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3879#issuecomment-1522141052",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3879",
    "id": 1522141052,
    "node_id": "IC_kwDOB7jojM5augd8",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-25T17:12:55Z",
    "updated_at": "2023-04-25T17:12:55Z",
    "author_association": "MEMBER",
    "body": "Thanks for reporting this @Hicham010. The underlying issue here is the same as in https://github.com/NomicFoundation/hardhat/issues/3667; we should throw an error when different matchers are chained (for now, maybe later we'll allow that, but chaining async stuff in chai is surprisingly hard). I'm going to close this issue on favor of that one.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1522141052/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
