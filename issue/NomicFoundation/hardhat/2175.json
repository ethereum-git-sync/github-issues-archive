{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175",
  "id": 1084209603,
  "node_id": "I_kwDOB7jojM5An7nD",
  "number": 2175,
  "title": "Typescript type error standalone script.",
  "user": {
    "login": "StefanoGagliardi",
    "id": 45005269,
    "node_id": "MDQ6VXNlcjQ1MDA1MjY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/45005269?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/StefanoGagliardi",
    "html_url": "https://github.com/StefanoGagliardi",
    "followers_url": "https://api.github.com/users/StefanoGagliardi/followers",
    "following_url": "https://api.github.com/users/StefanoGagliardi/following{/other_user}",
    "gists_url": "https://api.github.com/users/StefanoGagliardi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/StefanoGagliardi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/StefanoGagliardi/subscriptions",
    "organizations_url": "https://api.github.com/users/StefanoGagliardi/orgs",
    "repos_url": "https://api.github.com/users/StefanoGagliardi/repos",
    "events_url": "https://api.github.com/users/StefanoGagliardi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/StefanoGagliardi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "kanej",
    "id": 24030,
    "node_id": "MDQ6VXNlcjI0MDMw",
    "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kanej",
    "html_url": "https://github.com/kanej",
    "followers_url": "https://api.github.com/users/kanej/followers",
    "following_url": "https://api.github.com/users/kanej/following{/other_user}",
    "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
    "organizations_url": "https://api.github.com/users/kanej/orgs",
    "repos_url": "https://api.github.com/users/kanej/repos",
    "events_url": "https://api.github.com/users/kanej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kanej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "kanej",
      "id": 24030,
      "node_id": "MDQ6VXNlcjI0MDMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kanej",
      "html_url": "https://github.com/kanej",
      "followers_url": "https://api.github.com/users/kanej/followers",
      "following_url": "https://api.github.com/users/kanej/following{/other_user}",
      "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
      "organizations_url": "https://api.github.com/users/kanej/orgs",
      "repos_url": "https://api.github.com/users/kanej/repos",
      "events_url": "https://api.github.com/users/kanej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kanej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-12-19T22:43:13Z",
  "updated_at": "2022-11-16T10:23:03Z",
  "closed_at": "2022-01-05T09:56:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I decided to run standalone Typescript script via ts-node, problem is simple:\r\n\r\nI use property \"ethers\" from \"hre\" and it exists and works, but not exists in type: \"HardhatRuntimeEnvironment\".\r\n\r\n```typescript\r\n\r\nimport hre from \"hardhat\";\r\n\r\n// Interface from runtime.ts\r\nexport interface HardhatRuntimeEnvironment {\r\n  readonly config: HardhatConfig;\r\n  readonly hardhatArguments: HardhatArguments;\r\n  readonly tasks: TasksMap;\r\n  readonly run: RunTaskFunction;\r\n  readonly network: Network;\r\n  readonly artifacts: Artifacts;\r\n}\r\n\r\nasync function main() {\r\n  await hre.run('compile');\r\n  const NFTMarket = await (hre as any).ethers.getContractFactory(\"NFTMarket\");\r\n  const nftMarket = await NFTMarket.deploy();\r\n  ...\r\n}\r\n\r\n```\r\n\r\nI saw there other library that re-declare library and merge HardhatRuntimeEnvironment  with eheters:\r\nhttps://github.com/wighawag/hardhat-deploy-ethers/blob/main/src/internal/type-extensions.ts\r\n\r\n```typescript\r\ndeclare module \"hardhat/types/runtime\" {\r\n  interface HardhatRuntimeEnvironment {\r\n    // We omit the ethers field because it is redundant.\r\n    ethers: typeof ethers & HardhatEthersHelpers;\r\n  }\r\n\r\n  // Beware, adding new types to any hardhat type submodule is not a good practice in a Hardhat plugin.\r\n  // Doing so increases the risk of a type clash with another plugin.\r\n  // Removing any of these three types is a breaking change.\r\n  type Libraries = LibrariesT;\r\n  type FactoryOptions = FactoryOptionsT;\r\n  // tslint:disable-next-line: naming-convention\r\n  type getContractFactory = typeof getContractFactoryT;\r\n}\r\n\r\n```\r\n\r\nThis is doesn't work beacuse there are import and module resolution problem.\r\nSo... Why \"ethers\" there isn't in type \"HardhatRuntimeEnvironment\" when proprerty de-facto exits?\r\n\r\nA fast workaround for preserve type during typescript transpile is follow:\r\n```typescript\r\n\r\nimport { HardhatEthersHelpers } from \"@nomiclabs/hardhat-ethers/dist/src/types\";\r\nimport { HardhatRuntimeEnvironment } from \"hardhat/types\";\r\nimport hre from \"hardhat\";\r\n\r\nconst wrapHre = hre as HardhatRuntimeEnvironment & { ethers: any } & {\r\n  ethers: typeof ethers & HardhatEthersHelpers;\r\n};\r\n\r\nconst NFTMarket = await wrapHre.ethers.getContractFactory(\"NFTMarket\");\r\n\r\n```\r\n\r\nCan this anomaly be fixed or is it known and is there a reason?\r\nThanks in advice",
  "closed_by": {
    "login": "kanej",
    "id": 24030,
    "node_id": "MDQ6VXNlcjI0MDMw",
    "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kanej",
    "html_url": "https://github.com/kanej",
    "followers_url": "https://api.github.com/users/kanej/followers",
    "following_url": "https://api.github.com/users/kanej/following{/other_user}",
    "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
    "organizations_url": "https://api.github.com/users/kanej/orgs",
    "repos_url": "https://api.github.com/users/kanej/repos",
    "events_url": "https://api.github.com/users/kanej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kanej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1003963892",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175#issuecomment-1003963892",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
    "id": 1003963892,
    "node_id": "IC_kwDOB7jojM4710X0",
    "user": {
      "login": "kanej",
      "id": 24030,
      "node_id": "MDQ6VXNlcjI0MDMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kanej",
      "html_url": "https://github.com/kanej",
      "followers_url": "https://api.github.com/users/kanej/followers",
      "following_url": "https://api.github.com/users/kanej/following{/other_user}",
      "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
      "organizations_url": "https://api.github.com/users/kanej/orgs",
      "repos_url": "https://api.github.com/users/kanej/repos",
      "events_url": "https://api.github.com/users/kanej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kanej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-03T09:25:16Z",
    "updated_at": "2022-01-03T09:25:16Z",
    "author_association": "MEMBER",
    "body": "I believe the problem here is that the `hardhat cli` is doing extra work over and above `ts-node` to present the correct type for `hre` based on the combined plugins in the `hardhat.config.ts` file.\r\n\r\nSo on a new typescript sample project an example script `./scripts/example.ts`:\r\n\r\n```typescript\r\nimport hre from \"hardhat\";\r\n\r\nasync function main() {\r\n  await hre.run(\"compile\");\r\n\r\n  console.log(hre.ethers);\r\n}\r\n\r\nmain();\r\n```\r\n\r\nWould correctly log if run with `npx hardhat run ./scripts/example.ts`, but would throw an error complaining of \"Property 'ethers' does not exist on type 'HardhatRuntimeEnvironment'\" if you ran it with `npx ts-node scripts/example.ts`.\r\n\r\nMy understanding is hardhat expects scripts to be run with `hardhat run` to get full type support.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1003963892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1004172451",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175#issuecomment-1004172451",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
    "id": 1004172451,
    "node_id": "IC_kwDOB7jojM472nSj",
    "user": {
      "login": "kanej",
      "id": 24030,
      "node_id": "MDQ6VXNlcjI0MDMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kanej",
      "html_url": "https://github.com/kanej",
      "followers_url": "https://api.github.com/users/kanej/followers",
      "following_url": "https://api.github.com/users/kanej/following{/other_user}",
      "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
      "organizations_url": "https://api.github.com/users/kanej/orgs",
      "repos_url": "https://api.github.com/users/kanej/repos",
      "events_url": "https://api.github.com/users/kanej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kanej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-03T15:33:17Z",
    "updated_at": "2022-01-03T15:33:17Z",
    "author_association": "MEMBER",
    "body": "@StefanoGagliardi running the script directly with `ts-node` can be done, see the hardhat docs here:\r\n\r\nhttps://hardhat.org/guides/typescript.html#running-your-tests-and-scripts-directly-with-ts-node\r\n\r\nBasically `ts-node` does not scan all the files in a project by default and requires the `--files` flag to get the type information in  those file, so something like the following should work:\r\n\r\n```shell\r\nnpx ts-node --files scripts/example.ts\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1004172451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1007359587",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175#issuecomment-1007359587",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
    "id": 1007359587,
    "node_id": "IC_kwDOB7jojM48CxZj",
    "user": {
      "login": "jarrodwatts",
      "id": 35651410,
      "node_id": "MDQ6VXNlcjM1NjUxNDEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/35651410?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jarrodwatts",
      "html_url": "https://github.com/jarrodwatts",
      "followers_url": "https://api.github.com/users/jarrodwatts/followers",
      "following_url": "https://api.github.com/users/jarrodwatts/following{/other_user}",
      "gists_url": "https://api.github.com/users/jarrodwatts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jarrodwatts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jarrodwatts/subscriptions",
      "organizations_url": "https://api.github.com/users/jarrodwatts/orgs",
      "repos_url": "https://api.github.com/users/jarrodwatts/repos",
      "events_url": "https://api.github.com/users/jarrodwatts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jarrodwatts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-07T12:12:02Z",
    "updated_at": "2022-01-07T12:12:02Z",
    "author_association": "NONE",
    "body": "Using ```npx hardhat run .\\scripts\\sample-script.ts``` instead of `ts-node` worked for me.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1007359587/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1091417979",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175#issuecomment-1091417979",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
    "id": 1091417979,
    "node_id": "IC_kwDOB7jojM5BDbd7",
    "user": {
      "login": "crisanlucid",
      "id": 340843,
      "node_id": "MDQ6VXNlcjM0MDg0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/340843?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/crisanlucid",
      "html_url": "https://github.com/crisanlucid",
      "followers_url": "https://api.github.com/users/crisanlucid/followers",
      "following_url": "https://api.github.com/users/crisanlucid/following{/other_user}",
      "gists_url": "https://api.github.com/users/crisanlucid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/crisanlucid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/crisanlucid/subscriptions",
      "organizations_url": "https://api.github.com/users/crisanlucid/orgs",
      "repos_url": "https://api.github.com/users/crisanlucid/repos",
      "events_url": "https://api.github.com/users/crisanlucid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/crisanlucid/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-07T09:25:35Z",
    "updated_at": "2022-04-07T09:25:35Z",
    "author_association": "NONE",
    "body": "how this solution will solve this problem?\r\n\r\n![image](https://user-images.githubusercontent.com/340843/162167317-ce25c2d7-a006-4ed9-af51-3996b24be4f2.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1091417979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1315156423",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175#issuecomment-1315156423",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
    "id": 1315156423,
    "node_id": "IC_kwDOB7jojM5OY7HH",
    "user": {
      "login": "CypElf",
      "id": 31732086,
      "node_id": "MDQ6VXNlcjMxNzMyMDg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31732086?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CypElf",
      "html_url": "https://github.com/CypElf",
      "followers_url": "https://api.github.com/users/CypElf/followers",
      "following_url": "https://api.github.com/users/CypElf/following{/other_user}",
      "gists_url": "https://api.github.com/users/CypElf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CypElf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CypElf/subscriptions",
      "organizations_url": "https://api.github.com/users/CypElf/orgs",
      "repos_url": "https://api.github.com/users/CypElf/repos",
      "events_url": "https://api.github.com/users/CypElf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CypElf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-15T11:09:40Z",
    "updated_at": "2022-11-15T11:10:22Z",
    "author_association": "NONE",
    "body": "Any news about this? This issue doesn't seem solved at all at the moment. The only workaround I found is to use `// @ts-ignore`, but it's dirty. The `--files` flag is not changing anything on ts-node.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1315156423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1316753841",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2175#issuecomment-1316753841",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2175",
    "id": 1316753841,
    "node_id": "IC_kwDOB7jojM5OfBGx",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-16T10:22:57Z",
    "updated_at": "2022-11-16T10:22:57Z",
    "author_association": "MEMBER",
    "body": "@CypElf as mentioned in the previous comments, your options are:\r\n\r\n1) Use `npx hardhat run` to run your script.\r\n2) Use `tx-node` directly with the `--files` flag.\r\n\r\nBoth of these things should work, assuming your config and script are correct (for example, that you didn't forget to import the `hardhat-ethers` plugin). If you think you've run into a bug, please open a new issue with a [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example).",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1316753841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
