{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1772",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1772/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1772/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1772/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1772",
  "id": 963268952,
  "node_id": "MDU6SXNzdWU5NjMyNjg5NTI=",
  "number": 1772,
  "title": "How to trace a DELEGATECALL target address?",
  "user": {
    "login": "antoinedc",
    "id": 1327779,
    "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/antoinedc",
    "html_url": "https://github.com/antoinedc",
    "followers_url": "https://api.github.com/users/antoinedc/followers",
    "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
    "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
    "organizations_url": "https://api.github.com/users/antoinedc/orgs",
    "repos_url": "https://api.github.com/users/antoinedc/repos",
    "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/antoinedc/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 947232611,
      "node_id": "MDU6TGFiZWw5NDcyMzI2MTE=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:feature",
      "name": "type:feature",
      "color": "FBCA04",
      "default": false,
      "description": "Feature request"
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "alcuadrado",
    "id": 176499,
    "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alcuadrado",
    "html_url": "https://github.com/alcuadrado",
    "followers_url": "https://api.github.com/users/alcuadrado/followers",
    "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
    "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
    "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
    "repos_url": "https://api.github.com/users/alcuadrado/repos",
    "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-08-07T17:14:58Z",
  "updated_at": "2022-11-18T16:00:53Z",
  "closed_at": "2021-08-26T19:37:44Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": "resolved",
  "body": "Hi,\r\n\r\nI'm using `experimentalAddHardhatNetworkMessageTraceHook` in a plugin to get all the CALLx executed in a transaction and convert them into a human-readable trace.\r\n\r\nI'm working with a [proxy contract](https://etherscan.io/address/0x9e905f5b2b07b5e1dc71a86901de0e717eebb12d#code), and I'm having an issue with DELEGATECALL (line 144).\r\n\r\nFor every kind of CALL, the step returned by the hook contains these two fields among others:\r\n```json\r\n{\r\n  \"code\": \"0xabcd\",\r\n  \"address\": \"0x1234\",\r\n}\r\n```\r\nFor CALL codes, `code` matches the code at address `address`, but for DELEGATECALL (and CALLCODE I assume), it doesn't. In this case, `address` contains the address of the current contract, and `code` contains the executed \"remote\" code.\r\n\r\nAs @fvictorio told me, it makes sense because this way the trace shows which code is executed in which context (ie remote code executed in the local context).\r\nHowever, In my case, I'm trying to figure out what is the address of the executed code (so I can get the ABI from there).\r\n\r\nAny suggestion on how I could get that? Would an extra `codeAddress` field in the step object make sense here? That would only be useful for DELEGATECALL & CALLCODE steps but I think it is valuable to be able to trace back the executed code when debugging a transaction.\r\n\r\nI took a quick look into Hardhat's code and Ethereumjs code, and it seems like the `message` parameter [here](https://github.com/nomiclabs/hardhat/blob/master/packages/hardhat-core/src/internal/hardhat-network/stack-traces/vm-tracer.ts#L82) contains this `codeAddress` field, and that it could be added to the `messageTrace` created in this function that ends up returned in the hook.\r\nI think it comes from here in the ethereumjs repo: https://github.com/ethereumjs/ethereumjs-monorepo/blob/ae96604a7e384f3d7fc4005f6489aaca1717cc2e/packages/vm/src/evm/eei.ts#L507",
  "closed_by": {
    "login": "alcuadrado",
    "id": 176499,
    "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alcuadrado",
    "html_url": "https://github.com/alcuadrado",
    "followers_url": "https://api.github.com/users/alcuadrado/followers",
    "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
    "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
    "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
    "repos_url": "https://api.github.com/users/alcuadrado/repos",
    "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1772/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1772/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
