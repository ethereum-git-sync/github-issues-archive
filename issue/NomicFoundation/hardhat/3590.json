{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3590",
  "id": 1537143365,
  "node_id": "I_kwDOB7jojM5bnvJF",
  "number": 3590,
  "title": "Forking goerli-optimism after Bedrock fails",
  "user": {
    "login": "leomassazza",
    "id": 20520621,
    "node_id": "MDQ6VXNlcjIwNTIwNjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20520621?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leomassazza",
    "html_url": "https://github.com/leomassazza",
    "followers_url": "https://api.github.com/users/leomassazza/followers",
    "following_url": "https://api.github.com/users/leomassazza/following{/other_user}",
    "gists_url": "https://api.github.com/users/leomassazza/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leomassazza/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leomassazza/subscriptions",
    "organizations_url": "https://api.github.com/users/leomassazza/orgs",
    "repos_url": "https://api.github.com/users/leomassazza/repos",
    "events_url": "https://api.github.com/users/leomassazza/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leomassazza/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-01-17T23:02:08Z",
  "updated_at": "2023-03-07T14:23:56Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\n\n2.12.6\n\n### What happened?\n\nWhen attempting to fork goerli optimism after Optimism bedrock upgrade fails. \n\n### Minimal reproduction steps\n\n- Create a new hardhat project\r\n- Attempt to fork optimism-hardhat \r\n`npx hardhat node --fork https://opt-goerli.g.alchemy.com/v2/<ALCHEMY KEY>`\r\n  or \r\n`npx hardhat node --fork https://optimism-goerli.infura.io/v3/<INFURA KEY>`\r\nIt will fail with `Invalid value null supplied to : RpcBlockWithTransactions | null/transactions: RpcTransaction Array/0: RpcTransaction/gasPrice: QUANTITY`\r\n\r\nNote: I used the same providers with `ganache-cli` and the fork works\n\n### Search terms\n\nbedrock fork",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1396666515",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3590#issuecomment-1396666515",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590",
    "id": 1396666515,
    "node_id": "IC_kwDOB7jojM5TP3CT",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-19T09:20:34Z",
    "updated_at": "2023-01-19T09:20:34Z",
    "author_association": "MEMBER",
    "body": "Thank you @leomassazza, I can confirm this is happening.\r\n\r\nThe underlying reason seems to be that the transaction objects returned by the node don't include some fields (`gasPrice`, `r`, `s`, `v`). I think this has to do with optimism's [deposited transaction types](https://github.com/ethereum-optimism/optimism/blob/develop/specs/deposits.md#the-deposited-transaction-type).\r\n\r\nPossible fixes here:\r\n- Just accept transactions without those values\r\n- Fetch the forking block _without_ expanding the transactions. This is something we should do anyway, because expanding them is unnecessarily wasteful.\r\n\r\nThe second option is less risky and maybe easier, but there will still be issues if you fetch a deposit transaction, or if you fetch a block with expanded transactions.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1396666515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1405189819",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3590#issuecomment-1405189819",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590",
    "id": 1405189819,
    "node_id": "IC_kwDOB7jojM5TwX67",
    "user": {
      "login": "sashaaldrick",
      "id": 33594434,
      "node_id": "MDQ6VXNlcjMzNTk0NDM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/33594434?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sashaaldrick",
      "html_url": "https://github.com/sashaaldrick",
      "followers_url": "https://api.github.com/users/sashaaldrick/followers",
      "following_url": "https://api.github.com/users/sashaaldrick/following{/other_user}",
      "gists_url": "https://api.github.com/users/sashaaldrick/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sashaaldrick/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sashaaldrick/subscriptions",
      "organizations_url": "https://api.github.com/users/sashaaldrick/orgs",
      "repos_url": "https://api.github.com/users/sashaaldrick/repos",
      "events_url": "https://api.github.com/users/sashaaldrick/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sashaaldrick/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T15:33:43Z",
    "updated_at": "2023-01-26T15:33:43Z",
    "author_association": "NONE",
    "body": "I can confirm this is happening as well for me, when it worked fine in December before bedrock upgrade. ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1405189819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1436011982",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3590#issuecomment-1436011982",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590",
    "id": 1436011982,
    "node_id": "IC_kwDOB7jojM5Vl83O",
    "user": {
      "login": "panukettu",
      "id": 18403470,
      "node_id": "MDQ6VXNlcjE4NDAzNDcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/18403470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/panukettu",
      "html_url": "https://github.com/panukettu",
      "followers_url": "https://api.github.com/users/panukettu/followers",
      "following_url": "https://api.github.com/users/panukettu/following{/other_user}",
      "gists_url": "https://api.github.com/users/panukettu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/panukettu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/panukettu/subscriptions",
      "organizations_url": "https://api.github.com/users/panukettu/orgs",
      "repos_url": "https://api.github.com/users/panukettu/repos",
      "events_url": "https://api.github.com/users/panukettu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/panukettu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-19T15:03:11Z",
    "updated_at": "2023-02-19T15:03:11Z",
    "author_association": "NONE",
    "body": "looking forward to get this fixed. ganache works btw",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1436011982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1458263022",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3590#issuecomment-1458263022",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3590",
    "id": 1458263022,
    "node_id": "IC_kwDOB7jojM5W61Pu",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-07T14:23:56Z",
    "updated_at": "2023-03-07T14:23:56Z",
    "author_association": "NONE",
    "body": "This got fixed in `op-geth` two weeks ago with https://github.com/ethereum-optimism/op-geth/pull/48 so recent Optimism geth nodes will provide `0` values for the sig fields and gas price.\r\n\r\nBut correct, for Deposited transactions (`\"type\": \"0x7e\"`) you can also just ignore these fields.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1458263022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
