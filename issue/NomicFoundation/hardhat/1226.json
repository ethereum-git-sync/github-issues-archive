{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226",
  "id": 801858527,
  "node_id": "MDU6SXNzdWU4MDE4NTg1Mjc=",
  "number": 1226,
  "title": "`hardhat_impersonateAccount` doesn't work when localhost accounts are not set to \"remote\" ",
  "user": {
    "login": "chpiatt",
    "id": 1332623,
    "node_id": "MDQ6VXNlcjEzMzI2MjM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chpiatt",
    "html_url": "https://github.com/chpiatt",
    "followers_url": "https://api.github.com/users/chpiatt/followers",
    "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
    "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
    "organizations_url": "https://api.github.com/users/chpiatt/orgs",
    "repos_url": "https://api.github.com/users/chpiatt/repos",
    "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chpiatt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 24,
  "created_at": "2021-02-05T05:29:04Z",
  "updated_at": "2023-04-23T15:25:49Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Edit by @fvictorio: see [this comment](https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-1181706467) for a summary of this issue.\r\n\r\n---\r\n\r\nOriginal issue:\r\n\r\nI'm running into an issue when I try impersonating an account on a forked mainnet running in separate terminal window (i.e. localhost network).  I'm able to successfully impersonate this account when I just fork mainnet on the \"hardhat\" network to run tests, but on the \"localhost\" network I keep running into this issue:\r\n```\r\nHardhatError: HH103: Account 0x2d4bb9a783583875f8b0b86cbcad09ce87523497 is not managed by the node you are connected to.\r\n```\r\n\r\nExample code:\r\n```\r\nawait ethers.provider.send('hardhat_impersonateAccount', ['0x2d4bb9a783583875f8b0b86cbcad09ce87523497']);\r\nconst admin = await ethers.provider.getSigner('0x2d4bb9a783583875f8b0b86cbcad09ce87523497')\r\nconst VotingPowerPrismDeployment = await deployments.get(\"VotingPowerPrism\")\r\nconst VotingPowerPrism = new ethers.Contract(VotingPowerPrismDeployment.address, VotingPowerPrismDeployment.abi, admin)\r\nconst VotingPowerImpDeployment = await deployments.get(\"VotingPower\")\r\nawait VotingPowerPrism.setPendingProxyImplementation(VotingPowerImpDeployment.address); // error happens here\r\n```\r\n\r\nConfigs:\r\n```\r\nhardhatConfig = {\r\n  live: false,\r\n  saveDeployments: true,\r\n  tags: [\"test\"],\r\n  forking = {\r\n      url: process.env.FORK_URL,\r\n      blockNumber = parseInt(process.env.FORK_BLOCK_NUMBER)\r\n  }\r\n}\r\n\r\nlocalhostConfig = {\r\n  url: 'http://localhost:8545',\r\n  live: false,\r\n  saveDeployments: true,\r\n  tags: [\"local\"],\r\n  chainId = 1,\r\n  forking = {\r\n      url: process.env.FORK_URL,\r\n      blockNumber = parseInt(process.env.FORK_BLOCK_NUMBER)\r\n  }\r\n}\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226/reactions",
    "total_count": 5,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 5
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/773860366",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-773860366",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 773860366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3Mzg2MDM2Ng==",
    "user": {
      "login": "gitcoinbot",
      "id": 27903976,
      "node_id": "MDQ6VXNlcjI3OTAzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27903976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitcoinbot",
      "html_url": "https://github.com/gitcoinbot",
      "followers_url": "https://api.github.com/users/gitcoinbot/followers",
      "following_url": "https://api.github.com/users/gitcoinbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitcoinbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitcoinbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitcoinbot/subscriptions",
      "organizations_url": "https://api.github.com/users/gitcoinbot/orgs",
      "repos_url": "https://api.github.com/users/gitcoinbot/repos",
      "events_url": "https://api.github.com/users/gitcoinbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitcoinbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-05T07:49:33Z",
    "updated_at": "2021-02-05T07:49:33Z",
    "author_association": "NONE",
    "body": "Issue Status: 1. **Open** 2. Started 3. Submitted 4. Done \n\n<hr>\n\n__This issue now has a funding of 0.2 ETH (329.46 USD @ $1647.32/ETH)  attached to it as part of the archerdao fund.__\n\n * If you would like to work on this issue you can 'start work' [on the Gitcoin Issue Details page](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700).\n* Want to chip in? Add your own contribution [here](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700).\n* Questions? Checkout <a href='https://gitcoin.co/help'>Gitcoin Help</a> or the <a href='https://discord.com/invite/83BK5z55yB/'>Gitcoin's Discord</a>\n* $1,058,306.36 more funded OSS Work available on the [Gitcoin Issue Explorer](https://gitcoin.co/explorer)\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/773860366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/773944321",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-773944321",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 773944321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3Mzk0NDMyMQ==",
    "user": {
      "login": "chpiatt",
      "id": 1332623,
      "node_id": "MDQ6VXNlcjEzMzI2MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chpiatt",
      "html_url": "https://github.com/chpiatt",
      "followers_url": "https://api.github.com/users/chpiatt/followers",
      "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
      "organizations_url": "https://api.github.com/users/chpiatt/orgs",
      "repos_url": "https://api.github.com/users/chpiatt/repos",
      "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chpiatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-05T10:27:14Z",
    "updated_at": "2021-02-05T10:27:36Z",
    "author_association": "NONE",
    "body": "Stack trace for the error:\r\n```\r\n(node:72111) UnhandledPromiseRejectionWarning: HardhatError: HH103: Account 0x2d4bb9a783583875f8b0b86cbcad09ce87523497 is not managed by the node you are connected to.\r\n    at LocalAccountsProvider._getPrivateKeyForAddress (./node_modules/hardhat/internal/core/providers/accounts.js:104:19)\r\n    at LocalAccountsProvider.request (./node_modules/hardhat/internal/core/providers/accounts.js:83:37)\r\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n    at async EthersProviderWrapper.send (./node_modules/hardhat-deploy-ethers/dist/src/ethers-provider-wrapper.js:10:24)\r\n ```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/773944321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774081344",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774081344",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774081344,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDA4MTM0NA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-05T14:53:50Z",
    "updated_at": "2021-02-05T14:53:50Z",
    "author_association": "MEMBER",
    "body": "Hi @chpiatt. I created a simple example where I fork the mainnet and start a node in one terminal, and then call the impersonate account method and send a transaction from another (connecting via the `localhost` network) and it works fine. So your problem must be elsewhere.\r\n\r\nIf you create a minimal repo that reproduces the problem, I can take a deeper look.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774081344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774180042",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774180042",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774180042,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDE4MDA0Mg==",
    "user": {
      "login": "chpiatt",
      "id": 1332623,
      "node_id": "MDQ6VXNlcjEzMzI2MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chpiatt",
      "html_url": "https://github.com/chpiatt",
      "followers_url": "https://api.github.com/users/chpiatt/followers",
      "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
      "organizations_url": "https://api.github.com/users/chpiatt/orgs",
      "repos_url": "https://api.github.com/users/chpiatt/repos",
      "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chpiatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-05T17:39:06Z",
    "updated_at": "2021-02-05T17:39:06Z",
    "author_association": "NONE",
    "body": "I'm using hardhat-deploy and hardhat-deploy-ethers. My suspicion is something is going wrong there, but I will try to throw together a demo repo tomorrow",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774180042/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774386291",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774386291",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774386291,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDM4NjI5MQ==",
    "user": {
      "login": "andreiashu",
      "id": 342638,
      "node_id": "MDQ6VXNlcjM0MjYzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andreiashu",
      "html_url": "https://github.com/andreiashu",
      "followers_url": "https://api.github.com/users/andreiashu/followers",
      "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
      "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
      "organizations_url": "https://api.github.com/users/andreiashu/orgs",
      "repos_url": "https://api.github.com/users/andreiashu/repos",
      "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andreiashu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T02:57:46Z",
    "updated_at": "2021-02-06T02:57:46Z",
    "author_association": "NONE",
    "body": "hi @chpiatt this worked for me https://github.com/andreiashu/archer-dao-hardhat/blob/main/test/archer-dao.test.js\r\n\r\nThere were some things I had to change. The original account provided (`0x2d4bb9a783583875f8b0b86cbcad09ce87523497`) is not the admin one and `setPendingProxyImplementation` was reverting with `Prism::setPendingProxyImp: caller must be admin`. So I just used `getStorageAt` to find the actual admin address.\r\n\r\nThen I had to fund that admin account with some eth since it didn't have enough for gas costs. After that everything worked. See whether you spot any differences between our hardhat.config.js or the code I wrote.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774386291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774403194",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774403194",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774403194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQwMzE5NA==",
    "user": {
      "login": "gitcoinbot",
      "id": 27903976,
      "node_id": "MDQ6VXNlcjI3OTAzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27903976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitcoinbot",
      "html_url": "https://github.com/gitcoinbot",
      "followers_url": "https://api.github.com/users/gitcoinbot/followers",
      "following_url": "https://api.github.com/users/gitcoinbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitcoinbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitcoinbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitcoinbot/subscriptions",
      "organizations_url": "https://api.github.com/users/gitcoinbot/orgs",
      "repos_url": "https://api.github.com/users/gitcoinbot/repos",
      "events_url": "https://api.github.com/users/gitcoinbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitcoinbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T05:27:18Z",
    "updated_at": "2021-03-16T10:00:05Z",
    "author_association": "NONE",
    "body": "Issue Status: 1. **Open** 2. Started 3. Submitted 4. Done \n\n<hr>\n\n__Work has been started__.\n\n\nThese users each claimed they can complete the work by 4 weeks, 1 day ago.\nPlease review their action plans below:\n\n\n**1) [andreiashu](https://gitcoin.co/andreiashu) has been approved to start work.**\n\nfirst time using gitcoin. seems I should have started here rather than posting straight on github. oh well :)\n\nLearn more [on the Gitcoin Issue Details page](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700).\n\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774403194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774418655",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774418655",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774418655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQxODY1NQ==",
    "user": {
      "login": "chpiatt",
      "id": 1332623,
      "node_id": "MDQ6VXNlcjEzMzI2MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chpiatt",
      "html_url": "https://github.com/chpiatt",
      "followers_url": "https://api.github.com/users/chpiatt/followers",
      "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
      "organizations_url": "https://api.github.com/users/chpiatt/orgs",
      "repos_url": "https://api.github.com/users/chpiatt/repos",
      "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chpiatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T07:38:24Z",
    "updated_at": "2021-02-06T07:42:30Z",
    "author_association": "NONE",
    "body": "> hi @chpiatt this worked for me https://github.com/andreiashu/archer-dao-hardhat/blob/main/test/archer-dao.test.js\r\n> \r\n> There were some things I had to change. The original account provided (`0x2d4bb9a783583875f8b0b86cbcad09ce87523497`) is not the admin one and `setPendingProxyImplementation` was reverting with `Prism::setPendingProxyImp: caller must be admin`. So I just used `getStorageAt` to find the actual admin address.\r\n> \r\n> Then I had to fund that admin account with some eth since it didn't have enough for gas costs. After that everything worked. See whether you spot any differences between our hardhat.config.js or the code I wrote.\r\n\r\nThanks for putting this together.  It was really helpful for isolating the issue.  I forked your demo repo and added the code that is giving the issue here: https://github.com/chpiatt/archer-dao-hardhat\r\n\r\nI figured out the issue happens only when I also pass in an array of accounts to the network config, see: https://github.com/chpiatt/archer-dao-hardhat/blob/1cce6268cf1ff8cf9de64296f8d56731b9476ab4/hardhat.config.js#L40\r\n\r\nFor now, I can get around this issue by just impersonating every account that I might want to pass as an account to this array, but leaving the bounty open in case someone can address the underlying issue of being able to both pass in accounts to this array and impersonate other accounts.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774418655/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774447677",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774447677",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774447677,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQ0NzY3Nw==",
    "user": {
      "login": "andreiashu",
      "id": 342638,
      "node_id": "MDQ6VXNlcjM0MjYzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andreiashu",
      "html_url": "https://github.com/andreiashu",
      "followers_url": "https://api.github.com/users/andreiashu/followers",
      "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
      "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
      "organizations_url": "https://api.github.com/users/andreiashu/orgs",
      "repos_url": "https://api.github.com/users/andreiashu/repos",
      "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andreiashu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T10:55:19Z",
    "updated_at": "2021-02-06T10:55:19Z",
    "author_association": "NONE",
    "body": ">underlying issue of being able to both pass in accounts to this array and impersonate other accounts\r\n@chpiatt I believe It's not the accounts that's creating your issue.\r\n\r\n in your config file for `localhost` you have both `url: 'http://localhost:8545',` and `forking.url` specified.\r\nplease remove `url` and leave the `forking.url` and that should fix the issue. I've started getting strange errors when I specified both of them.\r\n\r\nI've pushed and update that demos this working here https://github.com/andreiashu/archer-dao-hardhat/commit/d81f8cda8f266cb7f804b50f00124764d39b2b87\r\nlet me know what you think and if that solves the issue\r\n\r\nps: `live` & `saveDeployments` are not in the config docs?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774447677/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774477301",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774477301",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774477301,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQ3NzMwMQ==",
    "user": {
      "login": "chpiatt",
      "id": 1332623,
      "node_id": "MDQ6VXNlcjEzMzI2MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chpiatt",
      "html_url": "https://github.com/chpiatt",
      "followers_url": "https://api.github.com/users/chpiatt/followers",
      "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
      "organizations_url": "https://api.github.com/users/chpiatt/orgs",
      "repos_url": "https://api.github.com/users/chpiatt/repos",
      "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chpiatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T13:25:50Z",
    "updated_at": "2021-02-06T13:25:50Z",
    "author_association": "NONE",
    "body": "Unfortunately, I don't think this solves the issue.  In your update you moved the \"accounts\" array inside of the \"forking\" object, which I think is why the tests now pass: https://github.com/andreiashu/archer-dao-hardhat/blob/d81f8cda8f266cb7f804b50f00124764d39b2b87/hardhat.config.js#L27\r\n\r\nAt first, I thought maybe this actually _was_ the solution, but then when I tried to sign a transaction with that account (without first impersonating it), I get a different error:\r\n```\r\nError: no signer for 0x4F8f512Dab59F227EA70B1D8A0044aFa95CC80C3\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774477301/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774478086",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774478086",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774478086,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQ3ODA4Ng==",
    "user": {
      "login": "andreiashu",
      "id": 342638,
      "node_id": "MDQ6VXNlcjM0MjYzOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/342638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andreiashu",
      "html_url": "https://github.com/andreiashu",
      "followers_url": "https://api.github.com/users/andreiashu/followers",
      "following_url": "https://api.github.com/users/andreiashu/following{/other_user}",
      "gists_url": "https://api.github.com/users/andreiashu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andreiashu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andreiashu/subscriptions",
      "organizations_url": "https://api.github.com/users/andreiashu/orgs",
      "repos_url": "https://api.github.com/users/andreiashu/repos",
      "events_url": "https://api.github.com/users/andreiashu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andreiashu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T13:32:04Z",
    "updated_at": "2021-02-06T13:32:04Z",
    "author_association": "NONE",
    "body": "Oh haha, oops. This is what happens if I try to rush it\n\nOn Sat, Feb 6, 2021, 20:26 Chris Piatt <notifications@github.com> wrote:\n\n> Unfortunately, I don't think this solves the issue. In your update you\n> moved the \"accounts\" array inside of the \"forking\" object, which I think is\n> why the tests now pass:\n> https://github.com/andreiashu/archer-dao-hardhat/blob/d81f8cda8f266cb7f804b50f00124764d39b2b87/hardhat.config.js#L27\n>\n> At first, I thought maybe this actually *was* the solution, but then when\n> I tried to sign a transaction with that account (without first\n> impersonating it), I get a different error:\n>\n> Error: no signer for 0x4F8f512Dab59F227EA70B1D8A0044aFa95CC80C3\n>\n> —\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/nomiclabs/hardhat/issues/1226#issuecomment-774477301>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AACTU3QGKKOWO2ORU53UDCLS5U7O3ANCNFSM4XEEFLLQ>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774478086/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774492503",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774492503",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774492503,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDQ5MjUwMw==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T15:17:09Z",
    "updated_at": "2021-02-06T15:17:09Z",
    "author_association": "MEMBER",
    "body": "Hi @chpiatt, thanks for reporting this. And thanks @andreiashu for your effort investigating it, it helped me realize what's going on.\r\n\r\nWhen you define a set of local accounts using an array of private keys or HD config, those accounts are used instead of the ones you are connecting to. This is conflating with the `hardhat_impersonateAccount`, cause that affects the remote accounts, not the local ones.\r\n\r\nI guess you could run a `hardhat_imporsonateAccount` with the `DEPLOYER_PRIVATE_KEY`'s address as a workaround.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774492503/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774505508",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774505508",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 774505508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDUwNTUwOA==",
    "user": {
      "login": "chpiatt",
      "id": 1332623,
      "node_id": "MDQ6VXNlcjEzMzI2MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chpiatt",
      "html_url": "https://github.com/chpiatt",
      "followers_url": "https://api.github.com/users/chpiatt/followers",
      "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
      "organizations_url": "https://api.github.com/users/chpiatt/orgs",
      "repos_url": "https://api.github.com/users/chpiatt/repos",
      "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chpiatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T16:47:31Z",
    "updated_at": "2021-02-06T16:47:31Z",
    "author_association": "NONE",
    "body": "> Hi @chpiatt, thanks for reporting this. And thanks @andreiashu for your effort investigating it, it helped me realize what's going on.\r\n> \r\n> When you define a set of local accounts using an array of private keys or HD config, those accounts are used instead of the ones you are connecting to. This is conflating with the `hardhat_impersonateAccount`, cause that affects the remote accounts, not the local ones.\r\n> \r\n> I guess you could run a `hardhat_imporsonateAccount` with the `DEPLOYER_PRIVATE_KEY`'s address as a workaround.\r\n\r\nI see the issue.  Maybe there could be a method that you add to the client that when you call it:\r\n1) keeps track of these accounts locally (i.e. in a map called impersonated_accounts)\r\n2) forwards hardhat_impersonateAccount to the node?\r\n\r\nAnd then when a signer tries to sign something you:\r\n1) check if the private key is in your local accounts - if so, sign locally\r\n2) if not, check if address is in impersonated_accounts - if so, forward to node to sign\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/774505508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/776097714",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-776097714",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 776097714,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjA5NzcxNA==",
    "user": {
      "login": "gitcoinbot",
      "id": 27903976,
      "node_id": "MDQ6VXNlcjI3OTAzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27903976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitcoinbot",
      "html_url": "https://github.com/gitcoinbot",
      "followers_url": "https://api.github.com/users/gitcoinbot/followers",
      "following_url": "https://api.github.com/users/gitcoinbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitcoinbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitcoinbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitcoinbot/subscriptions",
      "organizations_url": "https://api.github.com/users/gitcoinbot/orgs",
      "repos_url": "https://api.github.com/users/gitcoinbot/repos",
      "events_url": "https://api.github.com/users/gitcoinbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitcoinbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T17:15:10Z",
    "updated_at": "2021-02-09T17:15:10Z",
    "author_association": "NONE",
    "body": "@andreiashu Hello from Gitcoin Core - are you still working on this issue? Please submit a WIP PR or comment back within the next 3 days or you will be removed from this ticket and it will be returned to an ‘Open’ status. Please let us know if you have questions!\n* [x] reminder (3 days)\n* [ ] escalation to mods (6 days)\n\nFunders only: Snooze warnings for [1 day](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700?snooze=1) | [3 days](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700?snooze=3) | [5 days](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700?snooze=5) | [10 days](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700?snooze=10) | [100 days](https://gitcoin.co/issue/nomiclabs/hardhat/1226/100024700?snooze=100)",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/776097714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/776107194",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-776107194",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 776107194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjEwNzE5NA==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T17:29:12Z",
    "updated_at": "2021-02-09T17:29:12Z",
    "author_association": "MEMBER",
    "body": "Makes sense, @chpiatt. WDYT @fvictorio ?\r\n\r\n@chpiatt, are you willing to fund this through gitcoin? We don't have a lot of bandwidth right now to prioritize implementing it internally.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/776107194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/776110731",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-776110731",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 776110731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjExMDczMQ==",
    "user": {
      "login": "chpiatt",
      "id": 1332623,
      "node_id": "MDQ6VXNlcjEzMzI2MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1332623?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chpiatt",
      "html_url": "https://github.com/chpiatt",
      "followers_url": "https://api.github.com/users/chpiatt/followers",
      "following_url": "https://api.github.com/users/chpiatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/chpiatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chpiatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chpiatt/subscriptions",
      "organizations_url": "https://api.github.com/users/chpiatt/orgs",
      "repos_url": "https://api.github.com/users/chpiatt/repos",
      "events_url": "https://api.github.com/users/chpiatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chpiatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T17:34:27Z",
    "updated_at": "2021-02-09T17:34:27Z",
    "author_association": "NONE",
    "body": "@alcuadrado yes, happy to fund",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/776110731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/811539476",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-811539476",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 811539476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMTUzOTQ3Ng==",
    "user": {
      "login": "pcfreak30",
      "id": 10647,
      "node_id": "MDQ6VXNlcjEwNjQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcfreak30",
      "html_url": "https://github.com/pcfreak30",
      "followers_url": "https://api.github.com/users/pcfreak30/followers",
      "following_url": "https://api.github.com/users/pcfreak30/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcfreak30/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcfreak30/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcfreak30/subscriptions",
      "organizations_url": "https://api.github.com/users/pcfreak30/orgs",
      "repos_url": "https://api.github.com/users/pcfreak30/repos",
      "events_url": "https://api.github.com/users/pcfreak30/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcfreak30/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-31T23:56:39Z",
    "updated_at": "2021-03-31T23:56:39Z",
    "author_association": "NONE",
    "body": "Hello, I just hit this issue. I am using a mnemonic seed in my config. It all works correctly on the hardhat network. However I am running hardhat node externally so that I can work inside eth remix and use a local blockchain explorer.\r\n\r\nI have the node on the hardhat network, and a copy as `hardhat_external` which is used by `hardhat test` (I use env vars to flag what to use).\r\n\r\nDoing this causes the error reported above. I can confirm using `ganache-cli` works expected so this seems to be an due to a possible assumption with the tight integration between the node, client, and test runner.\r\n\r\nUntil this is fixed, I would recommend to other developers to use hardhat node for debugging, and then use ganache once tests pass if you need to use a separate node process.\r\n\r\nHope this information helps :).",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/811539476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/924352129",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-924352129",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 924352129,
    "node_id": "IC_kwDOB7jojM43GH6B",
    "user": {
      "login": "Zequez",
      "id": 126037,
      "node_id": "MDQ6VXNlcjEyNjAzNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126037?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Zequez",
      "html_url": "https://github.com/Zequez",
      "followers_url": "https://api.github.com/users/Zequez/followers",
      "following_url": "https://api.github.com/users/Zequez/following{/other_user}",
      "gists_url": "https://api.github.com/users/Zequez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Zequez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Zequez/subscriptions",
      "organizations_url": "https://api.github.com/users/Zequez/orgs",
      "repos_url": "https://api.github.com/users/Zequez/repos",
      "events_url": "https://api.github.com/users/Zequez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Zequez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-21T20:18:18Z",
    "updated_at": "2021-09-21T20:18:18Z",
    "author_association": "NONE",
    "body": "I was having the same issue on our project (which is why I found this issue). We were running from inside a Hardhat task and using the existing provider from Ethers as you are. We also tried running a Ganache (with the `evm_unlockUnknownAccount` method instead) node instead, but we received the same error; the error was coming from the Hardhat task, not the node.\r\n\r\nHowever, when we tried running it from a separate script using the following to instantiate a new provider, it worked.\r\n\r\n```ts\r\nconst provider = new ethers.providers.JsonRpcProvider(\r\n        \"http://localhost:8545\"\r\n      );\r\nawait provider.send(\"hardhat_impersonateAccount\", [ADDRESS]);\r\nconst account = provider.getSigner(ADDRESS);\r\n```\r\n\r\nSo my guess is that the issue is with the `EthersProviderWrapper` (which is the class name of `ethers.provider` given by Hardhat)\r\n\r\nNot sure if anyone is still having this issue; but you could try if using `JsonRpcProvider` directly solves it.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/924352129/reactions",
      "total_count": 17,
      "+1": 10,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 7,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/950328794",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-950328794",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 950328794,
    "node_id": "IC_kwDOB7jojM44pN3a",
    "user": {
      "login": "Philogy",
      "id": 21957732,
      "node_id": "MDQ6VXNlcjIxOTU3NzMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/21957732?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Philogy",
      "html_url": "https://github.com/Philogy",
      "followers_url": "https://api.github.com/users/Philogy/followers",
      "following_url": "https://api.github.com/users/Philogy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Philogy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Philogy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Philogy/subscriptions",
      "organizations_url": "https://api.github.com/users/Philogy/orgs",
      "repos_url": "https://api.github.com/users/Philogy/repos",
      "events_url": "https://api.github.com/users/Philogy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Philogy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-24T13:50:06Z",
    "updated_at": "2021-10-24T13:50:06Z",
    "author_association": "NONE",
    "body": "> I was having the same issue on our project (which is why I found this issue). We were running from inside a Hardhat task and using the existing provider from Ethers as you are. We also tried running a Ganache (with the `evm_unlockUnknownAccount` method instead) node instead, but we received the same error; the error was coming from the Hardhat task, not the node.\r\n> \r\n> However, when we tried running it from a separate script using the following to instantiate a new provider, it worked.\r\n> \r\n> ```ts\r\n> const provider = new ethers.providers.JsonRpcProvider(\r\n>         \"http://localhost:8545\"\r\n>       );\r\n> await provider.send(\"hardhat_impersonateAccount\", [ADDRESS]);\r\n> const account = provider.getSigner(ADDRESS);\r\n> ```\r\n> \r\n> So my guess is that the issue is with the `EthersProviderWrapper` (which is the class name of `ethers.provider` given by Hardhat)\r\n> \r\n> Not sure if anyone is still having this issue; but you could try if using `JsonRpcProvider` directly solves it.\r\n\r\nThis actually works, even within a hardhat task. To generalize and make it backwards compatible I added this as the first line in my task function:\r\n\r\n```javascript\r\nhre.ethers.provider = new ethers.providers.JsonRpcProvider(hre.ethers.provider.connection.url)\r\n```\r\n\r\nAfter that I stopped receiving the `Error HH103: Account 0x29b7efda7c08773f9eadbc7443a23758e35eac2d is not managed by the node you are connected to.` error when trying to send a transaction from an impersonated account. I think the impersonation is succeeding but the `EthersProviderWrapper` provided by the HRE somehow does an additional check it shouldn't do when sending transactions. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/950328794/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/950784765",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-950784765",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 950784765,
    "node_id": "IC_kwDOB7jojM44q9L9",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T10:42:23Z",
    "updated_at": "2021-10-25T10:42:23Z",
    "author_association": "MEMBER",
    "body": "> ```js\r\n> hre.ethers.provider = new ethers.providers.JsonRpcProvider(hre.ethers.provider.connection.url)\r\n> ```\r\n\r\nThis won't work for other networks right now because [that value is always (incorrectly) set to `http://localhost:8545`](https://github.com/nomiclabs/hardhat/issues/1138).",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/950784765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1053943725",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-1053943725",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 1053943725,
    "node_id": "IC_kwDOB7jojM4-0eet",
    "user": {
      "login": "rhlsthrm",
      "id": 11512787,
      "node_id": "MDQ6VXNlcjExNTEyNzg3",
      "avatar_url": "https://avatars.githubusercontent.com/u/11512787?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rhlsthrm",
      "html_url": "https://github.com/rhlsthrm",
      "followers_url": "https://api.github.com/users/rhlsthrm/followers",
      "following_url": "https://api.github.com/users/rhlsthrm/following{/other_user}",
      "gists_url": "https://api.github.com/users/rhlsthrm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rhlsthrm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rhlsthrm/subscriptions",
      "organizations_url": "https://api.github.com/users/rhlsthrm/orgs",
      "repos_url": "https://api.github.com/users/rhlsthrm/repos",
      "events_url": "https://api.github.com/users/rhlsthrm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rhlsthrm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-28T06:51:31Z",
    "updated_at": "2022-02-28T06:51:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am still having an issue, getting an error:\r\n```\r\nHardhatError: HH103: Account 0x8894e0a0c962cb723c1976a4421c95949be2d4e3 is not managed by the node you are connected to.\r\n```\r\nWhen running `hardhat node` externally. In `hardhat.config.ts` I have:\r\n```ts\r\nconst config: HardhatUserConfig = {\r\n  networks: {\r\n    hardhat: {\r\n      saveDeployments: true,\r\n      chainId: 56,\r\n      gasPrice: 20e9,\r\n      gas: 25e6,\r\n      allowUnlimitedContractSize: true,\r\n      accounts: { mnemonic },\r\n      forking: {\r\n        url: \"https://speedy-nodes-nyc.moralis.io/2d2926c3e761369208fba31f/bsc/mainnet/archive\",\r\n        blockNumber: 15641803\r\n      },\r\n    },\r\n    bscfork: {\r\n      accounts: { mnemonic },\r\n      chainId: 56,\r\n      gasPrice: 20e9,\r\n      gas: 7_000_000,\r\n      allowUnlimitedContractSize: true,\r\n      url: \"http://localhost:8545\",\r\n    },\r\n...\r\n```\r\n\r\nI am running the impersonate script like:\r\n\r\n```ts\r\nimport { providers } from \"ethers\";\r\nimport { ethers } from \"hardhat\";\r\n\r\nconst WHALE_ACCOUNTS = {\r\n  56: \"0x8894E0a0c962CB723c1976a4421c95949bE2D4E3\", // binance hot wallet 6\r\n};\r\n\r\nexport const whaleSigner = async (): Promise<providers.JsonRpcSigner | undefined> => {\r\n  const { chainId } = await ethers.provider.getNetwork();\r\n  const account = WHALE_ACCOUNTS[chainId];\r\n  if (account) {\r\n    const provider = new providers.JsonRpcProvider(\"http://localhost:8545\");\r\n    try {\r\n      await provider.send(\"hardhat_impersonateAccount\", [account]);\r\n    } catch (e) {\r\n      console.log(\"Error in hardhat_impersonateAccount\", e);\r\n    }\r\n    return provider.getSigner(account);\r\n  }\r\n};\r\n```\r\n\r\nMy tests run fine with `npx hardhat test`. However when I run `npx hardhat node` then I run `npx hardhat test --network bscfork` I get the above error. Am I doing something wrong? It seems from above that this should work.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1053943725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1169465256",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-1169465256",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 1169465256,
    "node_id": "IC_kwDOB7jojM5FtJ-o",
    "user": {
      "login": "mistersingh179",
      "id": 48457746,
      "node_id": "MDQ6VXNlcjQ4NDU3NzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/48457746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mistersingh179",
      "html_url": "https://github.com/mistersingh179",
      "followers_url": "https://api.github.com/users/mistersingh179/followers",
      "following_url": "https://api.github.com/users/mistersingh179/following{/other_user}",
      "gists_url": "https://api.github.com/users/mistersingh179/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mistersingh179/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mistersingh179/subscriptions",
      "organizations_url": "https://api.github.com/users/mistersingh179/orgs",
      "repos_url": "https://api.github.com/users/mistersingh179/repos",
      "events_url": "https://api.github.com/users/mistersingh179/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mistersingh179/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-29T02:28:24Z",
    "updated_at": "2022-06-29T02:28:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "another way to make this work is to use `getDefaultProvider`.\r\n\r\nStep 1. Impersonate a whale's account on localhost\r\n```\r\nawait hre.network.provider.request({\r\n    method: \"hardhat_impersonateAccount\",\r\n    params: [\"0x8894E0a0c962CB723c1976a4421c95949bE2D4E3\"],\r\n  });\r\n```\r\n\r\nStep2. Get a provider to localhost where the whale has been impersonated\r\n```\r\nconst provider = ethers.getDefaultProvider(\"http://localhost:8545\");\r\n```\r\n\r\nStep3.  Get whale's wallet & make transactions\r\n```\r\nconst signer = await provider.getSigner(\r\n    \"0x8894E0a0c962CB723c1976a4421c95949bE2D4E3\"\r\n  );\r\nawait signer.sendTransaction({\r\n    to: \"0x0000000000000000000000000000000000000000\",\r\n    value: ethers.utils.parseEther(\"0.01\"),\r\n  });\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1169465256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1181706467",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-1181706467",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 1181706467,
    "node_id": "IC_kwDOB7jojM5Gb2jj",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-12T12:35:18Z",
    "updated_at": "2022-07-12T12:36:19Z",
    "author_association": "MEMBER",
    "body": "Summary of this thread so far.\r\n\r\n### The problem\r\n\r\nThis code works in the hardhat network (that is, running just `hh run script.js`):\r\n\r\n```js\r\nconst helpers = require(\"@nomicfoundation/hardhat-network-helpers\");\r\n\r\nasync function main() {\r\n  const randomAddress = \"0x9998b9fa6836d840c901860512c2082f8d6eb536\"\r\n  \r\n  await helpers.setBalance(randomAddress, 10n**18n);\r\n  await helpers.impersonateAccount(randomAddress);\r\n  const s = await ethers.getSigner(randomAddress);\r\n\r\n  await s.sendTransaction({\r\n    to: s.address\r\n  });\r\n}\r\n\r\nmain();\r\n```\r\n\r\nIf you start an `hh node` in another terminal and run `hh run script.js --network localhost`, it will also work fine.\r\n\r\n**But** if you configure the accounts array of the `localhost` network:\r\n\r\n```\r\nnetworks: {\r\n  localhost: {\r\n    url: \"http://localhost:8545\",\r\n    accounts: []\r\n  }\r\n},\r\n```\r\n\r\nand you run the script in the localhost network again, you'll get this error:\r\n\r\n```\r\nHardhatError: HH103: Account 0x9998b9fa6836d840c901860512c2082f8d6eb536 is not managed by the node you are connected to.\r\n```\r\n\r\nThe error is thrown here if `accounts` is not undefined:\r\n\r\nhttps://github.com/NomicFoundation/hardhat/blob/5f87473283fb2c2fcccffb00b398bb59b5788eb1/packages/hardhat-core/src/internal/core/providers/accounts.ts#L210-L215\r\n\r\n### Possible solutions\r\n\r\nThe easiest solution is to just remove that check. I don't think this is a terrible idea if it fixes this problem. If the check is not there, and you send a transaction from a non-impersonated account that is not part of your local accounts, you get this error:\r\n\r\n```\r\nProviderError: unknown account 0x9998b9fa6836d840c901860512c2082f8d6eb536\r\n```\r\n\r\nWhich is not that bad, although it could be better.\r\n\r\nThe alternative solution is to modify the `LocalAccountsProvider` middleware to intercept all `hardhat_impersonateAccount`s calls, keep a list of all the impersonated accounts (removing them if someone uses `hardhat_stopImpersonatingAccount`), and only forward the transactions from accounts that are not local but that are impersonated. This is what @chpiatt suggested [here](https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-774505508). Taking the complexity into account, I'm not sure if this is better than just removing the check.\r\n\r\n### Workarounds\r\n\r\nSince this is caused by our provider, one workaround is to manually create a provider, as suggested by @Zequez [here](https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-924352129):\r\n\r\n```js\r\nconst provider = new ethers.providers.JsonRpcProvider(\r\n        \"http://localhost:8545\"\r\n      );\r\nawait provider.send(\"hardhat_impersonateAccount\", [ADDRESS]);\r\nconst account = provider.getSigner(ADDRESS);\r\n```\r\n\r\nThis assumes you are connecting to localhost. A slightly better option is:\r\n\r\n```js\r\nlet provider;\r\nif (network.config.url !== undefined) {\r\n  provider = new ethers.providers.JsonRpcProvider(\r\n    network.config.url\r\n  );\r\n} else {\r\n  // if network.config.url is undefined, then this is the hardhat network\r\n  provider = hre.ethers.provider;\r\n}\r\n\r\nawait provider.send(\"hardhat_impersonateAccount\", [ADDRESS]);\r\nconst account = provider.getSigner(ADDRESS);\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1181706467/reactions",
      "total_count": 4,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 4,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1256915050",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-1256915050",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 1256915050,
    "node_id": "IC_kwDOB7jojM5K6wBq",
    "user": {
      "login": "HashHaran",
      "id": 106789241,
      "node_id": "U_kgDOBl15eQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/106789241?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/HashHaran",
      "html_url": "https://github.com/HashHaran",
      "followers_url": "https://api.github.com/users/HashHaran/followers",
      "following_url": "https://api.github.com/users/HashHaran/following{/other_user}",
      "gists_url": "https://api.github.com/users/HashHaran/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/HashHaran/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/HashHaran/subscriptions",
      "organizations_url": "https://api.github.com/users/HashHaran/orgs",
      "repos_url": "https://api.github.com/users/HashHaran/repos",
      "events_url": "https://api.github.com/users/HashHaran/events{/privacy}",
      "received_events_url": "https://api.github.com/users/HashHaran/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-24T08:55:54Z",
    "updated_at": "2022-09-24T08:58:13Z",
    "author_association": "NONE",
    "body": "I faced the same issue when forking and trying to take funds form a holder of USDC. Earlier in the thread I saw then this error occurs when specifying the list of accounts in the network. I have to specify a list of accounts in the network config because public accounts from hardhat may have some activities on the main net which could interrupt my testing. I got around this issue by specifying my accounts in the hardhat config in the network section and not in the network config. Impersonation seems to work correctly this way and I can also specify a list of accounts for my local network. Here's my hardhat.config.ts file:\r\n\r\n```typescript\r\ndefaultNetwork: \"fork\",\r\n\r\n  networks: {\r\n    hardhat: {\r\n      accounts: [\r\n        {\r\n          privateKey: `0x${PRIVATE_KEY1}`,\r\n          balance: \"10000000000000000000000\"\r\n        },\r\n        {\r\n          privateKey: `0x${PRIVATE_KEY2}`,\r\n          balance: \"10000000000000000000000\"\r\n        },\r\n        {\r\n          privateKey: `0x${PRIVATE_KEY3}`,\r\n          balance: \"10000000000000000000000\"\r\n        },\r\n        {\r\n          privateKey: `0x${PRIVATE_KEY4}`,\r\n          balance: \"10000000000000000000000\"\r\n        }\r\n      ]\r\n    },\r\n    fork: {\r\n      url: \"http://127.0.0.1:8545/\",\r\n      // accounts: [`0x${PRIVATE_KEY1}`, `0x${PRIVATE_KEY2}`, `0x${PRIVATE_KEY3}`, `0x${PRIVATE_KEY4}`]\r\n    },\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1256915050/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1519092725",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1226#issuecomment-1519092725",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1226",
    "id": 1519092725,
    "node_id": "IC_kwDOB7jojM5ai4P1",
    "user": {
      "login": "Planxnx",
      "id": 37617738,
      "node_id": "MDQ6VXNlcjM3NjE3NzM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37617738?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Planxnx",
      "html_url": "https://github.com/Planxnx",
      "followers_url": "https://api.github.com/users/Planxnx/followers",
      "following_url": "https://api.github.com/users/Planxnx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Planxnx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Planxnx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Planxnx/subscriptions",
      "organizations_url": "https://api.github.com/users/Planxnx/orgs",
      "repos_url": "https://api.github.com/users/Planxnx/repos",
      "events_url": "https://api.github.com/users/Planxnx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Planxnx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-23T15:25:48Z",
    "updated_at": "2023-04-23T15:25:48Z",
    "author_association": "NONE",
    "body": "Hi, @chpiatt @rhlsthrm @Philogy \r\n\r\nYou can try this workaround. \r\n``` ts\r\n// hardhat.config.ts\r\n\r\nimport { extendEnvironment } from \"hardhat/config\";\r\nimport { HardhatRuntimeEnvironment, HttpNetworkUserConfig } from \"hardhat/types\";\r\n\r\nextendEnvironment((hre: HardhatRuntimeEnvironment) => {\r\n  const config = hre.network.config as HttpNetworkUserConfig;\r\n  if (config?.url) {\r\n    hre.ethers.provider = new hre.ethers.providers.JsonRpcProvider(config.url);\r\n  }\r\n});\r\n```\r\n\r\nNow you can use `ethers` everywhere in your project to impersonate an account.\r\n``` ts\r\nimport { ethers } from \"hardhat\";\r\n\r\n// for easily way\r\nconst impersonatedSigner = await ethers.getImpersonatedSigner(address);\r\n\r\n// and for a advance way\r\nawait ethers.provider.send(\"hardhat_impersonateAccount\", [address]);\r\nconst impersonatedSigner = ethers.provider.getSigner(address);\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1519092725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
