{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/829",
  "id": 710923956,
  "node_id": "MDU6SXNzdWU3MTA5MjM5NTY=",
  "number": 829,
  "title": "Deploying from flattened contracts",
  "user": {
    "login": "thekevinbrown",
    "id": 1531750,
    "node_id": "MDQ6VXNlcjE1MzE3NTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1531750?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thekevinbrown",
    "html_url": "https://github.com/thekevinbrown",
    "followers_url": "https://api.github.com/users/thekevinbrown/followers",
    "following_url": "https://api.github.com/users/thekevinbrown/following{/other_user}",
    "gists_url": "https://api.github.com/users/thekevinbrown/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thekevinbrown/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thekevinbrown/subscriptions",
    "organizations_url": "https://api.github.com/users/thekevinbrown/orgs",
    "repos_url": "https://api.github.com/users/thekevinbrown/repos",
    "events_url": "https://api.github.com/users/thekevinbrown/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thekevinbrown/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-09-29T09:19:09Z",
  "updated_at": "2022-11-19T00:15:40Z",
  "closed_at": "2020-10-08T05:20:16Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hi there,\r\n\r\n- We're using [Blockscout](https://blockscout.com)\r\n- Its verification API only supports a single string for the contract source code\r\n- We have the buidler flattener working on our contracts, and it prints out source when we run `buidler flatten`\r\n\r\nCurrently we're doing:\r\n```typescript\r\nimport { ethers } from '@nomiclabs/buidler';\r\n\r\nconst deploy = async () => {\r\n\t// ...\r\n\tconst Token = await ethers.getContractFactory('Token');\r\n\tconst token = await Token.deploy();\r\n\tawait token.deployed();\r\n\tconsole.log(`Token: ${token.address}`);\r\n```\r\n\r\nHow do we change this script to use the flattened source to build the contract so verification works after deploying the contract?",
  "closed_by": {
    "login": "thekevinbrown",
    "id": 1531750,
    "node_id": "MDQ6VXNlcjE1MzE3NTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1531750?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thekevinbrown",
    "html_url": "https://github.com/thekevinbrown",
    "followers_url": "https://api.github.com/users/thekevinbrown/followers",
    "following_url": "https://api.github.com/users/thekevinbrown/following{/other_user}",
    "gists_url": "https://api.github.com/users/thekevinbrown/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thekevinbrown/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thekevinbrown/subscriptions",
    "organizations_url": "https://api.github.com/users/thekevinbrown/orgs",
    "repos_url": "https://api.github.com/users/thekevinbrown/repos",
    "events_url": "https://api.github.com/users/thekevinbrown/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thekevinbrown/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/700708253",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/829#issuecomment-700708253",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829",
    "id": 700708253,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDcwODI1Mw==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T13:36:15Z",
    "updated_at": "2020-09-29T13:36:15Z",
    "author_association": "MEMBER",
    "body": "I'm not sure what is the best way of doing this. Here's a (not so good) idea:\r\n\r\n- Run the flatten task and pipe the result to a new directory, something like `npx buidler flatten > flattened/Flattened.sol`\r\n- Run your deploy script as always, but modify the config at the beggining it so that it uses the `flattened` directory: `config.paths.sources = path.join(config.paths.root, \"flattened\")`. I think you also need to call the `compile` task after doing this: `await run(\"compile\")`\r\n\r\nNot very nice, but it might work.\r\n\r\n@alcuadrado might have a better approach.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/700708253/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/702739285",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/829#issuecomment-702739285",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829",
    "id": 702739285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjczOTI4NQ==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-02T13:38:26Z",
    "updated_at": "2020-10-02T13:38:26Z",
    "author_association": "MEMBER",
    "body": "Hey @thekevinbrown,\r\n\r\nI don't think you'd need to do that. If blockscout verification only supports that, I bet they ignore the `metadata` of the contracts when verifying.\r\n\r\nHave you tried verifying after deploying a normal build?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/702739285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/705335919",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/829#issuecomment-705335919",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829",
    "id": 705335919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTMzNTkxOQ==",
    "user": {
      "login": "thekevinbrown",
      "id": 1531750,
      "node_id": "MDQ6VXNlcjE1MzE3NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1531750?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thekevinbrown",
      "html_url": "https://github.com/thekevinbrown",
      "followers_url": "https://api.github.com/users/thekevinbrown/followers",
      "following_url": "https://api.github.com/users/thekevinbrown/following{/other_user}",
      "gists_url": "https://api.github.com/users/thekevinbrown/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thekevinbrown/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thekevinbrown/subscriptions",
      "organizations_url": "https://api.github.com/users/thekevinbrown/orgs",
      "repos_url": "https://api.github.com/users/thekevinbrown/repos",
      "events_url": "https://api.github.com/users/thekevinbrown/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thekevinbrown/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T05:20:16Z",
    "updated_at": "2020-10-08T05:20:16Z",
    "author_association": "NONE",
    "body": "@alcuadrado Yes, we have, and it appears solc outputs the hash of the source file as part of the bytecode, even if the contents are functionally the same which then fails verification because it doesn't match. (e.g. adding a comment or blank line changes the bytecode produced.)\r\n\r\nSo we went with @fvictorio's approach. BlockScout is working on updating their verification api so that you can pass multiple files, so that'll help, but in the meantime we're flattening first before we do the build.\r\n\r\nGiven the move in the community in general away from flattening, I don't know that there's anything to do on Buidler's side at this point, so thanks for the help!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/705335919/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/705900854",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/829#issuecomment-705900854",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/829",
    "id": 705900854,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTkwMDg1NA==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T00:42:02Z",
    "updated_at": "2020-10-09T00:42:02Z",
    "author_association": "MEMBER",
    "body": "Thanks for the detailed answer, @thekevinbrown. I'm glad BlockScout is moving in that direction also.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/705900854/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
