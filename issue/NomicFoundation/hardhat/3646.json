{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3646",
  "id": 1572806070,
  "node_id": "I_kwDOB7jojM5dvx22",
  "number": 3646,
  "title": "Wrong error message for unrecognized custom error",
  "user": {
    "login": "k06a",
    "id": 702124,
    "node_id": "MDQ6VXNlcjcwMjEyNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/k06a",
    "html_url": "https://github.com/k06a",
    "followers_url": "https://api.github.com/users/k06a/followers",
    "following_url": "https://api.github.com/users/k06a/following{/other_user}",
    "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
    "organizations_url": "https://api.github.com/users/k06a/orgs",
    "repos_url": "https://api.github.com/users/k06a/repos",
    "events_url": "https://api.github.com/users/k06a/events{/privacy}",
    "received_events_url": "https://api.github.com/users/k06a/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    },
    {
      "id": 4951951046,
      "node_id": "LA_kwDOB7jojM8AAAABJyjGxg",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/area:error-inferrer",
      "name": "area:error-inferrer",
      "color": "5319E7",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-02-06T15:39:24Z",
  "updated_at": "2023-06-26T13:49:22Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\n\n2.12.6\n\n### What happened?\n\nI see error on test transaction, where should happen revert `0x863265dc`. I see this selector inside the error.\r\n```\r\n  1) RangeAmountCalculator\r\n       Fill by maker asset\r\n         Revert with incorrect prices:\r\n     Error: missing revert data in call exception; Transaction reverted without a reason string [ See: https://links.ethers.org/v5-errors-CALL_EXCEPTION ] (data=\"0x\", transaction={\"from\":\"0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\",\"gasLimit\":{\"type\":\"BigNumber\",\"hex\":\"0x01baded8\"},\"to\":\"0x5FbDB2315678afecb367f032d93F642f64180aa3\",\"data\":\"0xacaf53160000000000000000000000000000000000000000000000d8d726b7177a8000000000000000000000000000000000000000000000000000a2a15d09519be000000000000000000000000000000000000000000000000000008ac7230489e800000000000000000000000000000000000000000000000000008ac7230489e800000000000000000000000000000000000000000000000000008ac7230489e80000\",\"accessList\":null}, error={\"name\":\"TransactionExecutionError\",\"_stack\":\"TransactionExecutionError: VM Exception while processing transaction: revert with unrecognized return data or custom error\\n    at HardhatNode._manageErrors (/Users/k06a/Projects/limit-order-protocol/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1998:14)\\n    at HardhatNode._gatherTraces (/Users/k06a/Projects/limit-order-protocol/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1690:30)\\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\\n    at runNextTicks (node:internal/process/task_queues:64:3)\\n    at listOnTimeout (node:internal/timers:538:9)\\n    at processTimers (node:internal/timers:512:7)\\n    at HardhatNode.runCall (/Users/k06a/Projects/limit-order-protocol/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:652:20)\\n    at EthModule._callAction (/Users/k06a/Projects/limit-order-protocol/node_modules/hardhat/src/internal/hardhat-network/provider/modules/eth.ts:354:9)\\n    at HardhatNetworkProvider.request (/Users/k06a/Projects/limit-order-protocol/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:118:18)\\n    at TracerWrapper.request (/Users/k06a/Projects/limit-order-protocol/node_modules/hardhat-tracer/src/wrapper.ts:36:16)\",\"code\":-32003,\"_isProviderError\":true,\"data\":\"0x863265dc\"}, code=CALL_EXCEPTION, version=providers/5.7.2)\r\n      at Logger.makeError (node_modules/@ethersproject/logger/src.ts/index.ts:269:28)\r\n      at Logger.throwError (node_modules/@ethersproject/logger/src.ts/index.ts:281:20)\r\n      at checkError (node_modules/@ethersproject/providers/src.ts/json-rpc-provider.ts:66:16)\r\n      at EthersProviderWrapper.<anonymous> (node_modules/@ethersproject/providers/src.ts/json-rpc-provider.ts:642:20)\r\n      at step (node_modules/@ethersproject/providers/lib/json-rpc-provider.js:48:23)\r\n      at Object.throw (node_modules/@ethersproject/providers/lib/json-rpc-provider.js:29:53)\r\n      at rejected (node_modules/@ethersproject/providers/lib/json-rpc-provider.js:21:65)\r\n      at processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n      at runNextTicks (node:internal/process/task_queues:64:3)\r\n      at listOnTimeout (node:internal/timers:538:9)\r\n```\r\n\r\nSource: https://github.com/1inch/limit-order-protocol/actions/runs/4105167851/jobs/7081649960\n\n### Minimal reproduction steps\n\nYou can try to run test of the commit mentioned above:\r\n```\r\nyarn && yarn test:ci\r\n```\n\n### Search terms\n\ncustom errors",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1439694790",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3646#issuecomment-1439694790",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3646",
    "id": 1439694790,
    "node_id": "IC_kwDOB7jojM5Vz__G",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T09:30:33Z",
    "updated_at": "2023-02-22T09:30:33Z",
    "author_association": "MEMBER",
    "body": "I think there are two things going on here.\r\n\r\nIf you look at the nested error, it says \"TransactionExecutionError: VM Exception while processing transaction: revert with unrecognized return data or custom error\". This is part of a stack trace that ethers stringifies and puts in a single line, so it's not super helpful, but it's there. That error message should include the selector. The relevant line is here:\r\n\r\nhttps://github.com/NomicFoundation/hardhat/blob/07e4693021aed05baa34a18f76475a7103a9ee04/packages/hardhat-core/src/internal/hardhat-network/provider/node.ts#L1992\r\n\r\nThe second problem is that ethers is showing a wrong error message, because there definitely is return data in the revert. Maybe we are not adding it properly in this scenario. My guess is that the easiest way to reproduce this is to call a transaction that reverts with some random 4 bytes (so it won't match any error) and see what Hardhat+Ethers do.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1439694790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
