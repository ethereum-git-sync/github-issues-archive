{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2671",
  "id": 1226826361,
  "node_id": "I_kwDOB7jojM5JH-J5",
  "number": 2671,
  "title": "Could not generate stack trace. Please report this to help us improve Hardhat",
  "user": {
    "login": "dadaphl",
    "id": 415536,
    "node_id": "MDQ6VXNlcjQxNTUzNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/415536?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dadaphl",
    "html_url": "https://github.com/dadaphl",
    "followers_url": "https://api.github.com/users/dadaphl/followers",
    "following_url": "https://api.github.com/users/dadaphl/following{/other_user}",
    "gists_url": "https://api.github.com/users/dadaphl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dadaphl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dadaphl/subscriptions",
    "organizations_url": "https://api.github.com/users/dadaphl/orgs",
    "repos_url": "https://api.github.com/users/dadaphl/repos",
    "events_url": "https://api.github.com/users/dadaphl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dadaphl/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-05-05T15:25:26Z",
  "updated_at": "2022-11-18T00:17:22Z",
  "closed_at": "2022-06-15T00:47:03Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I got a `Failed to generate 1 stack trace. Run Hardhat with --verbose to learn more.` during testing\r\nUnfortunately I am not able to provide much context.\r\n\r\nI started noticing some weird behavior when I tested some deposit / withdraw logic. The contract is complex but the logic in question is banal so it's omitted.\r\n\r\nThe following test works. But if i remove the line `const contractBalance = await ethers.provider.getBalance(someContract.address);` it fails with oldBalance and newBalance both being 1000.\r\n\r\n```javascript\r\ndescribe(\"Withdraw\", async function () {\r\n  let allSigners;\r\n  let manager, addr1, addr2, addr3;\r\n\r\n  before(async () => {\r\n    allSigners = await ethers.getSigners();\r\n    [manager, addr1, addr2, addr3] = allSigners;\r\n  })\r\n\r\n  it(\"can be withdrawn by manager\", async function () {\r\n    const depositValue = ethers.utils.parseEther(\"0.06\");\r\n    allSigners.forEach(async account => {\r\n      const call = someContract.connect(account).deposit({value:depositValue});\r\n      await expect(call).to.not.be.reverted;\r\n    });\r\n    const contractBalance = await ethers.provider.getBalance(someContract.address);\r\n    console.log(contractBalance) // is 0 for some reason?\r\n\r\n    const oldBalance = await addr3.getBalance();\r\n    await expect(\r\n      someContract.connect(manager).withdraw(addr3.address)\r\n    ).not.to.be.reverted;\r\n    const newBalance = await addr3.getBalance()\r\n\r\n    expect(\r\n      newBalance\r\n    ).to.be.equal(\r\n      depositValue.mul(notAllowList.length).add(oldBalance)\r\n    );\r\n  })\r\n})\r\n\r\n```\r\n\r\nHere is the output of --verbose. \r\n```\r\nhardhat:core:hardhat-network:node Could not generate stack trace. Please report this to help us improve Hardhat.\r\nhardhat:core:hardhat-network:node  Error: There's no instruction at pc 20411\r\n  at Bytecode.getInstruction (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/model.ts:329:13)\r\n  at SolidityTracer._rawTraceEvmExecution (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:174:37)\r\n  at SolidityTracer._traceEvmExecution (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:149:29)\r\n  at SolidityTracer._getCallMessageStackTrace (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:72:17)\r\n  at SolidityTracer.getStackTrace (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:56:19)\r\n  at SolidityTracer._getUnrecognizedMessageStackTrace (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:100:44)\r\n  at SolidityTracer.getStackTrace (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:59:17)\r\n  at HardhatNode._manageErrors (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1895:41)\r\n  at HardhatNode._gatherTraces (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1652:30)\r\n  at HardhatNode._mineBlockWithPendingTxs (/PROJECTROOT/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1772:23) +0ms\r\n```\r\n\r\n```\r\nHardhat version 2.9.3\r\nM1 Mac\r\nSolidity 0.8.4\r\n```\r\n\r\n```\r\n  \"devDependencies\": {\r\n    \"@nomiclabs/hardhat-ethers\": \"^2.0.5\",\r\n    \"@nomiclabs/hardhat-solhint\": \"^2.0.0\",\r\n    \"@nomiclabs/hardhat-waffle\": \"^2.0.3\",\r\n    \"chai\": \"^4.3.6\",\r\n    \"dotenv\": \"^16.0.0\",\r\n    \"ethereum-waffle\": \"^3.4.0\",\r\n    \"ethers\": \"^5.5.4\",\r\n    \"hardhat\": \"^2.9.1\",\r\n    \"hardhat-deploy\": \"^0.11.2\",\r\n    \"hardhat-deploy-ethers\": \"^0.3.0-beta.13\",\r\n    \"mocha\": \"^9.2.2\",\r\n    \"solidity-coverage\": \"^0.7.20\"\r\n  },\r\n...\r\n```",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1118695603",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2671#issuecomment-1118695603",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671",
    "id": 1118695603,
    "node_id": "IC_kwDOB7jojM5CrfCz",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-05-05T15:25:52Z",
    "updated_at": "2022-05-05T15:25:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-601/could-not-generate-stack-trace-please-report-this-to-help-us-improve).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: e06b87fd-9e9c-4837-83aa-79e7e049ede8",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1118695603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1120500219",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2671#issuecomment-1120500219",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671",
    "id": 1120500219,
    "node_id": "IC_kwDOB7jojM5CyXn7",
    "user": {
      "login": "mikedizon",
      "id": 26526,
      "node_id": "MDQ6VXNlcjI2NTI2",
      "avatar_url": "https://avatars.githubusercontent.com/u/26526?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikedizon",
      "html_url": "https://github.com/mikedizon",
      "followers_url": "https://api.github.com/users/mikedizon/followers",
      "following_url": "https://api.github.com/users/mikedizon/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikedizon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikedizon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikedizon/subscriptions",
      "organizations_url": "https://api.github.com/users/mikedizon/orgs",
      "repos_url": "https://api.github.com/users/mikedizon/repos",
      "events_url": "https://api.github.com/users/mikedizon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikedizon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-08T22:46:26Z",
    "updated_at": "2022-05-08T22:46:26Z",
    "author_association": "NONE",
    "body": "I'm seeing a similar issue with an arithmetic issue. adding the verbose flag returns the error above. my test fails as I am checking for invalid opcode. tests now return `Transaction reverted without a reason`",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1120500219/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1149273867",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2671#issuecomment-1149273867",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671",
    "id": 1149273867,
    "node_id": "IC_kwDOB7jojM5EgIcL",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-06-07T23:33:07Z",
    "updated_at": "2022-06-07T23:33:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1149273867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1155855705",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2671#issuecomment-1155855705",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2671",
    "id": 1155855705,
    "node_id": "IC_kwDOB7jojM5E5PVZ",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-06-15T00:47:03Z",
    "updated_at": "2022-06-15T00:47:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1155855705/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
