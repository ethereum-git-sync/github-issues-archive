{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1168",
  "id": 782847454,
  "node_id": "MDU6SXNzdWU3ODI4NDc0NTQ=",
  "number": 1168,
  "title": "Functions named `build` and `execute` don't appear as expected in ethers js-object.",
  "user": {
    "login": "LHerskind",
    "id": 16536249,
    "node_id": "MDQ6VXNlcjE2NTM2MjQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/16536249?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LHerskind",
    "html_url": "https://github.com/LHerskind",
    "followers_url": "https://api.github.com/users/LHerskind/followers",
    "following_url": "https://api.github.com/users/LHerskind/following{/other_user}",
    "gists_url": "https://api.github.com/users/LHerskind/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LHerskind/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LHerskind/subscriptions",
    "organizations_url": "https://api.github.com/users/LHerskind/orgs",
    "repos_url": "https://api.github.com/users/LHerskind/repos",
    "events_url": "https://api.github.com/users/LHerskind/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LHerskind/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-01-10T15:57:24Z",
  "updated_at": "2022-11-18T19:00:55Z",
  "closed_at": "2021-01-26T19:30:36Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "# Unexpected issues \r\n\r\nWhen working with [DSProxy](https://github.com/makerdao/developerguides/blob/master/devtools/working-with-dsproxy/working-with-dsproxy.md#setup-wipeproxysol) and hardhat, I run in to some quite strange errors. A repo that reproduces the issue is available at: https://github.com/LHerskind/dsproxy-hardhat-issue\r\n\r\n\r\n\r\n\r\n## `Build`\r\n\r\n**Expected behavior**:\r\n- Running `build()` at the `DSProxyFactory` is expected to create a new proxy for `msg.sender`\r\n\r\n**Actual behavior**:\r\n- `dsproxyFactory.connect(...).build is not a function`\r\n\r\nThe issue seem to be that the js-object create from `ethers` don't create the methods `build()` and `build(address)` as we would expect them to. If we print the functions of the `DSProxyFactory` we have the following output:\r\n```\r\n{\r\n  'isProxy(address)': [Function (anonymous)],\r\n  'cache()': [Function (anonymous)],\r\n  'build()': [Function (anonymous)],\r\n  'build(address)': [Function (anonymous)],\r\n  isProxy: [Function (anonymous)],\r\n  cache: [Function (anonymous)]\r\n}\r\n```\r\nSeems like we are hitting some keyword with build and it do not behave as expected. \r\n\r\n**Workaround**:   \r\nInstead of accessing the functions directly, we can generate the `calldata` and execute the transaction ourselves as:\r\n```\r\nlet fragmentCreate = DSProxyFactory.interface.fragments[2];\r\nlet calldataCreate = DSProxyFactory.interface.encodeFunctionData(fragmentCreate);\r\nawait addr1.sendTransaction({ to: dsproxyFactory.address, data: calldataCreate});\r\n//await dsproxyFactory.connect(addr1).build(); // This will crash the program. \r\n```\r\n\r\nOtherwise, we can rename the functions, but this would require additional contract to be uploaded as we could not just use the existing DSProxy. However, an showcase that this works is seen below: \r\n![ErRzdZeXYAADmdV](https://user-images.githubusercontent.com/16536249/104127754-3078f300-5364-11eb-8935-cf91eb97d6e8.png)\r\n\r\n## `Execute`\r\nWe have the same issue with `execute` of the proxy itself. Again, we can work around it by creating the `calldata` ourselves. ",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/767775704",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1168#issuecomment-767775704",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1168",
    "id": 767775704,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2Nzc3NTcwNA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-26T19:30:35Z",
    "updated_at": "2021-01-26T19:30:35Z",
    "author_association": "MEMBER",
    "body": "The problem is that those functions are overloaded. So you have to use them like this:\r\n\r\n```\r\ndsproxyFactory.connect(addr1)['build()']\r\n// or\r\ndsproxyFactory.connect(addr1)['build(address)']\r\n```\r\n\r\nThat is, you have to specify which function you are calling by giving the full signature. Since you can't access those properties using the dot, you need to use the brackets syntax.\r\n\r\nThis is an ethers decision. You can see an explanation for this behavior here: https://github.com/ethers-io/ethers.js/issues/407#issuecomment-458360013",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/767775704/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
