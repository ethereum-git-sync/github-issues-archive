{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3181",
  "id": 1373835503,
  "node_id": "I_kwDOB7jojM5R4xDv",
  "number": 3181,
  "title": "Should fix the example code of `.changeEtherBalance`",
  "user": {
    "login": "innocentguy",
    "id": 5958410,
    "node_id": "MDQ6VXNlcjU5NTg0MTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5958410?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/innocentguy",
    "html_url": "https://github.com/innocentguy",
    "followers_url": "https://api.github.com/users/innocentguy/followers",
    "following_url": "https://api.github.com/users/innocentguy/following{/other_user}",
    "gists_url": "https://api.github.com/users/innocentguy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/innocentguy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/innocentguy/subscriptions",
    "organizations_url": "https://api.github.com/users/innocentguy/orgs",
    "repos_url": "https://api.github.com/users/innocentguy/repos",
    "events_url": "https://api.github.com/users/innocentguy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/innocentguy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "feuGeneA",
    "id": 7883777,
    "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/feuGeneA",
    "html_url": "https://github.com/feuGeneA",
    "followers_url": "https://api.github.com/users/feuGeneA/followers",
    "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
    "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
    "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
    "repos_url": "https://api.github.com/users/feuGeneA/repos",
    "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-09-15T02:55:29Z",
  "updated_at": "2022-12-15T00:14:46Z",
  "closed_at": "2022-09-15T05:22:21Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "<!--\r\n\r\nThank you for using Hardhat and taking the time to open an issue!\r\n\r\n**Note that this issue tracker is not a support channel.**\r\n\r\n- For help with Hardhat and Hardhat network, please use our [Discord server](https://hardhat.org/discord).\r\n- For help with ethers.js, please go to [its Github Discussions](https://github.com/ethers-io/ethers.js/discussions).\r\n\r\nIf you are reporting a bug, please include reproduction steps. The best way to do this is to include a [Minimal Reproducible Example](https://stackoverflow.com/help/minimal-reproducible-example). If you can't do that, then include a link to your repo, and the steps to reproduce the problem. The easiest it is to reproduce your problem, the faster we are going to be able to fix it.\r\n\r\nIf you are submitting a feature request, please take the time to clearly describe your use case, and not only your proposed solution.\r\n\r\nThis issue will be automatically assigned to a Hardhat team member. This person will act as the point of contact between you and the team, but won't necessarily fix it nor address it in any way. An issue being assigned does not mean that it's being worked on.\r\n\r\n-->\r\n\r\nAs the [example](https://hardhat.org/hardhat-chai-matchers/docs/reference#.changeetherbalance) shows, we use this format to check if the balance changed as expected.\r\n```javascript\r\nawait expect(\r\n  sender.sendTransaction({ to: receiver, value: 1000 })\r\n).to.changeEtherBalance(sender, -1000);\r\n```\r\nHowever, it'll get an error message `TypeError: txResponse.wait is not a function`\r\n\r\nAfter I traced the code, I found the root cause in the waffle matchers ():\r\n```javascript\r\n// node_modules/@ethereum-waffle/chai/dist/esm/matchers/changeEtherBalances.js\r\nexport async function getBalanceChanges(transaction, accounts, options) {\r\n    let txResponse;\r\n    if (typeof transaction === 'function') {\r\n        txResponse = await transaction();\r\n    }\r\n    else {\r\n        txResponse = transaction;\r\n    }\r\n\r\n    // this line\r\n    const txReceipt = await txResponse.wait();\r\n\r\n    const txBlockNumber = txReceipt.blockNumber;\r\n    const balancesAfter = await getBalances(accounts, txBlockNumber);\r\n    const balancesBefore = await getBalances(accounts, txBlockNumber - 1);\r\n    const txFees = await getTxFees(accounts, txResponse, options);\r\n    return balancesAfter.map((balance, ind) => balance.add(txFees[ind]).sub(balancesBefore[ind]));\r\n}\r\n```\r\nIt seems that the input in `expect()` should be a function or a resolved transaction, \r\nso I modify the code as below and it works:\r\n\r\n```javascript\r\n// input a function\r\nawait expect(\r\n  () => sender.sendTransaction({ to: receiver, value: 1000 })\r\n).to.changeEtherBalance(sender, -1000);\r\n\r\n// or resolve it instead\r\nawait expect(\r\n  await sender.sendTransaction({ to: receiver, value: 1000 })\r\n).to.changeEtherBalance(sender, -1000);\r\n```",
  "closed_by": {
    "login": "innocentguy",
    "id": 5958410,
    "node_id": "MDQ6VXNlcjU5NTg0MTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5958410?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/innocentguy",
    "html_url": "https://github.com/innocentguy",
    "followers_url": "https://api.github.com/users/innocentguy/followers",
    "following_url": "https://api.github.com/users/innocentguy/following{/other_user}",
    "gists_url": "https://api.github.com/users/innocentguy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/innocentguy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/innocentguy/subscriptions",
    "organizations_url": "https://api.github.com/users/innocentguy/orgs",
    "repos_url": "https://api.github.com/users/innocentguy/repos",
    "events_url": "https://api.github.com/users/innocentguy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/innocentguy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1247517973",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3181#issuecomment-1247517973",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181",
    "id": 1247517973,
    "node_id": "IC_kwDOB7jojM5KW50V",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-09-15T02:55:49Z",
    "updated_at": "2022-09-15T02:55:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1177/should-fix-the-example-code-of-changeetherbalance).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 071fe770-459e-4d0f-8d61-5efbc0c9616e",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1247517973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1247561318",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3181#issuecomment-1247561318",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181",
    "id": 1247561318,
    "node_id": "IC_kwDOB7jojM5KXEZm",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-15T04:17:00Z",
    "updated_at": "2022-09-15T04:17:00Z",
    "author_association": "MEMBER",
    "body": "I think you are conflicting two projects: `hardhat-chai-matchers` and `hardhat-waffle`. The example you linked is from `hardhat-chai-matcher`. Maker sure you don't have `hardhat-waffle` installed.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1247561318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1247596719",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3181#issuecomment-1247596719",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3181",
    "id": 1247596719,
    "node_id": "IC_kwDOB7jojM5KXNCv",
    "user": {
      "login": "innocentguy",
      "id": 5958410,
      "node_id": "MDQ6VXNlcjU5NTg0MTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5958410?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/innocentguy",
      "html_url": "https://github.com/innocentguy",
      "followers_url": "https://api.github.com/users/innocentguy/followers",
      "following_url": "https://api.github.com/users/innocentguy/following{/other_user}",
      "gists_url": "https://api.github.com/users/innocentguy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/innocentguy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/innocentguy/subscriptions",
      "organizations_url": "https://api.github.com/users/innocentguy/orgs",
      "repos_url": "https://api.github.com/users/innocentguy/repos",
      "events_url": "https://api.github.com/users/innocentguy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/innocentguy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-15T05:22:21Z",
    "updated_at": "2022-09-15T05:22:51Z",
    "author_association": "NONE",
    "body": "Got it. I think you're right, the hardhat version I'm using is not the newest one. \r\nOnce I use the newest version, `.changeEtherBalance` actually link to the new implementation under `hardhat-chai-matchers`.\r\n\r\nThanks a lot!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1247596719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
