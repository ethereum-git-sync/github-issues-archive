{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3075",
  "id": 1349916486,
  "node_id": "I_kwDOB7jojM5QdhdG",
  "number": 3075,
  "title": "Hardhat refuse to include two transactions in one block even when possible",
  "user": {
    "login": "wuya666",
    "id": 30381159,
    "node_id": "MDQ6VXNlcjMwMzgxMTU5",
    "avatar_url": "https://avatars.githubusercontent.com/u/30381159?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wuya666",
    "html_url": "https://github.com/wuya666",
    "followers_url": "https://api.github.com/users/wuya666/followers",
    "following_url": "https://api.github.com/users/wuya666/following{/other_user}",
    "gists_url": "https://api.github.com/users/wuya666/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wuya666/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wuya666/subscriptions",
    "organizations_url": "https://api.github.com/users/wuya666/orgs",
    "repos_url": "https://api.github.com/users/wuya666/repos",
    "events_url": "https://api.github.com/users/wuya666/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wuya666/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "feuGeneA",
    "id": 7883777,
    "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/feuGeneA",
    "html_url": "https://github.com/feuGeneA",
    "followers_url": "https://api.github.com/users/feuGeneA/followers",
    "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
    "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
    "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
    "repos_url": "https://api.github.com/users/feuGeneA/repos",
    "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-08-24T19:21:33Z",
  "updated_at": "2022-12-05T00:14:36Z",
  "closed_at": "2022-09-05T17:38:20Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Currently I need to test a use case where two transactions are mined in the same block, while I can make that happen with \"real\" networks like Ethereum testnets and such, the hardhat network somehow refuses to mine them in the same block which makes the test extremely tedious and harder to debug.\r\n\r\nI use something like the following code\r\n\r\n```\r\n      let beforeBlock, afterBlock;\r\n      let tasks;\r\n\r\n      console.log(\"Block gas limit:\", config.networks.hardhat.blockGasLimit);\r\n\r\n      if (network.name === \"hardhat\") {\r\n        await network.provider.send(\"evm_setAutomine\", [false]);\r\n        await network.provider.send(\"evm_setIntervalMining\", [5000]);\r\n      }\r\n\r\n      beforeBlock = (await ethers.provider.getBlock(\"latest\")).number;\r\n\r\n      console.log(\"Before sending txs block:\", beforeBlock);\r\n\r\n      tasks = [];\r\n      tasks.push(\r\n        (await testContract.connect(user1).testMethod(1)).wait()\r\n      );\r\n      tasks.push(\r\n        (await testContract.connect(user2).testMethod(2)).wait()\r\n      );\r\n      afterBlock = (await ethers.provider.getBlock(\"latest\")).number;\r\n\r\n      console.log(\"After sending txs block:\", afterBlock);\r\n\r\n      expect(beforeBlock).to.equal(\r\n        afterBlock,\r\n        \"Block number should not change at this time\"\r\n      );\r\n\r\n      const results = await Promise.allSettled(tasks);\r\n\r\n      console.log(\"After mining txs block:\", (await ethers.provider.getBlock(\"latest\")).number);\r\n\r\n      if (network.name === \"hardhat\") {\r\n        await network.provider.send(\"evm_setAutomine\", [\r\n          config.networks.hardhat.mining.auto,\r\n        ]);\r\n        await network.provider.send(\"evm_setIntervalMining\", [\r\n          config.networks.hardhat.mining.interval,\r\n        ]);\r\n      }\r\n\r\n      console.log( \"Results:\",\r\n        results.map(\r\n          ({\r\n            value: {\r\n              transactionHash,\r\n              blockNumber,\r\n              gasUsed,\r\n              transactionIndex,\r\n              status,\r\n            },\r\n          }) => ({\r\n            transactionHash,\r\n            blockNumber,\r\n            gasUsed,\r\n            transactionIndex,\r\n            status,\r\n          })\r\n        )\r\n      );\r\n```\r\n\r\nAnd the output is like this:\r\n\r\n```\r\nBlock gas limit: 30000000\r\nBefore sending txs block: 205\r\nAfter sending txs block: 205\r\nAfter mining txs block: 207\r\nResults: [\r\n  {\r\n    transactionHash: '0xf890d736fec520f902b8603f06613666158bf8f75bac6c7e0f72e46375ba7b26',\r\n    blockNumber: 206,\r\n    gasUsed: BigNumber { value: \"1335713\" },\r\n    transactionIndex: 0,\r\n    status: 1\r\n  },\r\n  {\r\n    transactionHash: '0x2c77e963ef123ed1a1c829d65aff6af052b9cdf5d11e7dcbec6c1c1eeab2daa1',\r\n    blockNumber: 207,\r\n    gasUsed: BigNumber { value: \"1239907\" },\r\n    transactionIndex: 0,\r\n    status: 1\r\n  }\r\n]\r\n```\r\n\r\nAs you can see, the configured block gas limit is shown to be 30M, while each transaction uses less than 1.5M gas, so the two transactions should be able to get mined within the same block, however hardhat network somehow cannot do that.\r\n\r\nI also tried some cheaper transactions, something that uses less than 100K gas, and it seems that multiple transactions can be included in one block by hardhat alright. But at some point around 1M gas usage, the transactions will not be mined within the same block despite how high the block gas limit is configured.\r\n\r\nSo I wonder if this is a bug in the hardhat network, or there's some hidden configuration somewhere that sets some gas limit at around 1M that when gas usage in one block is over this limit, hardhat will always wait for a new block to include the next transaction (even when the current block gas limit is not reached yet)?",
  "closed_by": {
    "login": "feuGeneA",
    "id": 7883777,
    "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/feuGeneA",
    "html_url": "https://github.com/feuGeneA",
    "followers_url": "https://api.github.com/users/feuGeneA/followers",
    "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
    "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
    "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
    "repos_url": "https://api.github.com/users/feuGeneA/repos",
    "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1226144299",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3075#issuecomment-1226144299",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075",
    "id": 1226144299,
    "node_id": "IC_kwDOB7jojM5JFXor",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-08-24T19:21:57Z",
    "updated_at": "2022-08-24T19:21:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1089/hardhat-refuse-to-include-two-transactions-in-one-block-even-when).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 34a4d731-ce07-4a9c-9aa5-95541d7beda5",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1226144299/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1227097547",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3075#issuecomment-1227097547",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075",
    "id": 1227097547,
    "node_id": "IC_kwDOB7jojM5JJAXL",
    "user": {
      "login": "vladyan18",
      "id": 13525908,
      "node_id": "MDQ6VXNlcjEzNTI1OTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/13525908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vladyan18",
      "html_url": "https://github.com/vladyan18",
      "followers_url": "https://api.github.com/users/vladyan18/followers",
      "following_url": "https://api.github.com/users/vladyan18/following{/other_user}",
      "gists_url": "https://api.github.com/users/vladyan18/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vladyan18/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vladyan18/subscriptions",
      "organizations_url": "https://api.github.com/users/vladyan18/orgs",
      "repos_url": "https://api.github.com/users/vladyan18/repos",
      "events_url": "https://api.github.com/users/vladyan18/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vladyan18/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-25T10:51:01Z",
    "updated_at": "2022-08-25T10:51:01Z",
    "author_association": "NONE",
    "body": "I ran into a similar issue. Transactions were not included in the block until I explicitly set a gasLimit for them",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1227097547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1237337174",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3075#issuecomment-1237337174",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3075",
    "id": 1237337174,
    "node_id": "IC_kwDOB7jojM5JwERW",
    "user": {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-05T17:38:20Z",
    "updated_at": "2022-09-05T17:38:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is expected behavior, because by default the gas limit for a transaction is very high. You can either specify a lower gas limit for the transaction, or you can configure the network to have `gas: auto`.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1237337174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
