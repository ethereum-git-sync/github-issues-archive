{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2739",
  "id": 1242271278,
  "node_id": "I_kwDOB7jojM5KC44u",
  "number": 2739,
  "title": "Defining tasks that depend on compiled artifacts like typechain output does not work.",
  "user": {
    "login": "KholdStare",
    "id": 836110,
    "node_id": "MDQ6VXNlcjgzNjExMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/836110?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KholdStare",
    "html_url": "https://github.com/KholdStare",
    "followers_url": "https://api.github.com/users/KholdStare/followers",
    "following_url": "https://api.github.com/users/KholdStare/following{/other_user}",
    "gists_url": "https://api.github.com/users/KholdStare/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KholdStare/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KholdStare/subscriptions",
    "organizations_url": "https://api.github.com/users/KholdStare/orgs",
    "repos_url": "https://api.github.com/users/KholdStare/repos",
    "events_url": "https://api.github.com/users/KholdStare/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KholdStare/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-05-19T20:08:38Z",
  "updated_at": "2023-02-09T00:14:46Z",
  "closed_at": "2022-09-02T23:05:33Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "There is a chicken and egg problem in defining/using tasks in hardhat:\r\n\r\n- When `hardhat` is run (e.g. `hardhat compile`), it loads  `hardhat.config.ts`.\r\n- Tasks need to be defined in `hardhat.config.ts` (or imported there).\r\n- A deploy task ideally [uses the typechain types to be typesafe](https://github.com/paulrberg/solidity-template/blob/main/tasks/deploy/greeter.ts#L5-L6)\r\n- In order for those imports to work, we need to run `hardhat compile` first. Oops! So we need to run `hardhat compile` before we can run `hardhat compile`\r\n\r\nAs an example if you look at https://github.com/paulrberg/solidity-template , the results of the typechain plugin are already checked into git: https://github.com/paulrberg/solidity-template/tree/main/src/types . They are then used in a deploy task here: https://github.com/paulrberg/solidity-template/blob/main/tasks/deploy/greeter.ts\r\n\r\nIt seems the author of above template got around that by first running compile, checking in the artifacts, and then defining the deploy task. I don't think that's a very elegant solution.\r\n\r\nCan tasks be lazy loaded, so they are not required to be imported in `hardhat.config.ts`? I want to define tasks that use files generated by hardhat.",
  "closed_by": {
    "login": "alcuadrado",
    "id": 176499,
    "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alcuadrado",
    "html_url": "https://github.com/alcuadrado",
    "followers_url": "https://api.github.com/users/alcuadrado/followers",
    "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
    "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
    "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
    "repos_url": "https://api.github.com/users/alcuadrado/repos",
    "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1132158072",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2739#issuecomment-1132158072",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739",
    "id": 1132158072,
    "node_id": "IC_kwDOB7jojM5De1x4",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-05-19T20:09:05Z",
    "updated_at": "2022-05-19T20:09:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-680/defining-tasks-that-depend-on-compiled-artifacts-like-typechain-output).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 4a29e82d-9fa6-413a-b32d-9f831ff1c1c7",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1132158072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1159556962",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2739#issuecomment-1159556962",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739",
    "id": 1159556962,
    "node_id": "IC_kwDOB7jojM5FHW9i",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-06-18T20:33:08Z",
    "updated_at": "2022-06-18T20:33:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1159556962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1161931171",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2739#issuecomment-1161931171",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739",
    "id": 1161931171,
    "node_id": "IC_kwDOB7jojM5FQamj",
    "user": {
      "login": "KholdStare",
      "id": 836110,
      "node_id": "MDQ6VXNlcjgzNjExMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/836110?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/KholdStare",
      "html_url": "https://github.com/KholdStare",
      "followers_url": "https://api.github.com/users/KholdStare/followers",
      "following_url": "https://api.github.com/users/KholdStare/following{/other_user}",
      "gists_url": "https://api.github.com/users/KholdStare/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/KholdStare/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/KholdStare/subscriptions",
      "organizations_url": "https://api.github.com/users/KholdStare/orgs",
      "repos_url": "https://api.github.com/users/KholdStare/repos",
      "events_url": "https://api.github.com/users/KholdStare/events{/privacy}",
      "received_events_url": "https://api.github.com/users/KholdStare/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-21T15:41:22Z",
    "updated_at": "2022-06-21T15:43:23Z",
    "author_association": "NONE",
    "body": "This issue is still relevant. The only way I was able to get around this is with dynamic import (https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-4.html)\r\n\r\nIn the code it looks like:\r\n\r\n```typescript\r\ntask(\"deploy:MyContract\")\r\n  .setAction(async function (taskArguments: TaskArguments, hre: HardhatRuntimeEnvironment) {\r\n    const { deployMyContract } = await import(\"../../src/deployments/mycontract\");\r\n\r\n    // ...\r\n  });\r\n```\r\n\r\nThat way the deployment code that references the generated typescript files is not pulled in during the configuration stage. I think the configuration portion of hardhat should be broken up into \"bare necessities\" that are loaded just to get the CLI running, and the full blown config that's needed to actually run a deployment or compile, etc. Otherwise you can run into a chicken and egg situation when first launching.\r\n\r\nYou will see this manifest with a lot of projects checking in their generated source files into git, which should be a no-no. I suspect one of the reasons is this chicken and egg problem.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1161931171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184176531",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2739#issuecomment-1184176531",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739",
    "id": 1184176531,
    "node_id": "IC_kwDOB7jojM5GlRmT",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T08:50:35Z",
    "updated_at": "2022-07-14T08:50:35Z",
    "author_association": "MEMBER",
    "body": "Hi @KholdStare, sorry for not responding before.\r\n\r\nWe are aware of this issue and agree that it's super annoying. The long-term solution is for us to just stop typechecking the project by default. This is something we've had in mind, but we didn't have an explicit issue here about it. I created [this one](https://github.com/NomicFoundation/hardhat/issues/2945) to track that.\r\n\r\nIn the meantime, I think setting `TS_NODE_TRANSPILE_ONLY=1` should help. Maybe you can add a `compile` npm script that just does `TS_NODE_TRANSPILE_ONLY=1 hardhat compile` (or use something like [`cross-env`](https://www.npmjs.com/package/cross-env), if someone in your team is on windows). Please let me know if this does (or doesn't) work for you.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1184176531/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1235964966",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2739#issuecomment-1235964966",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2739",
    "id": 1235964966,
    "node_id": "IC_kwDOB7jojM5Jq1Qm",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-02T23:05:00Z",
    "updated_at": "2022-09-02T23:05:32Z",
    "author_association": "MEMBER",
    "body": "This should be fixed by v2.11.0, which implements the changes @fvictorio mentioned.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1235964966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
