{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4391",
  "id": 1900213857,
  "node_id": "I_kwDOB7jojM5xQvZh",
  "number": 4391,
  "title": "Automatic downgrade of default EVM version may not be welcome",
  "user": {
    "login": "SKYBITDev3",
    "id": 141273631,
    "node_id": "U_kgDOCGuqHw",
    "avatar_url": "https://avatars.githubusercontent.com/u/141273631?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SKYBITDev3",
    "html_url": "https://github.com/SKYBITDev3",
    "followers_url": "https://api.github.com/users/SKYBITDev3/followers",
    "following_url": "https://api.github.com/users/SKYBITDev3/following{/other_user}",
    "gists_url": "https://api.github.com/users/SKYBITDev3/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SKYBITDev3/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SKYBITDev3/subscriptions",
    "organizations_url": "https://api.github.com/users/SKYBITDev3/orgs",
    "repos_url": "https://api.github.com/users/SKYBITDev3/repos",
    "events_url": "https://api.github.com/users/SKYBITDev3/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SKYBITDev3/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    },
    {
      "id": 5666138810,
      "node_id": "LA_kwDOB7jojM8AAAABUbpqug",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/area:compilation",
      "name": "area:compilation",
      "color": "5319E7",
      "default": false,
      "description": "Related to the built-in compile task"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "schaable",
    "id": 1165424,
    "node_id": "MDQ6VXNlcjExNjU0MjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1165424?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/schaable",
    "html_url": "https://github.com/schaable",
    "followers_url": "https://api.github.com/users/schaable/followers",
    "following_url": "https://api.github.com/users/schaable/following{/other_user}",
    "gists_url": "https://api.github.com/users/schaable/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/schaable/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/schaable/subscriptions",
    "organizations_url": "https://api.github.com/users/schaable/orgs",
    "repos_url": "https://api.github.com/users/schaable/repos",
    "events_url": "https://api.github.com/users/schaable/events{/privacy}",
    "received_events_url": "https://api.github.com/users/schaable/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "schaable",
      "id": 1165424,
      "node_id": "MDQ6VXNlcjExNjU0MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1165424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/schaable",
      "html_url": "https://github.com/schaable",
      "followers_url": "https://api.github.com/users/schaable/followers",
      "following_url": "https://api.github.com/users/schaable/following{/other_user}",
      "gists_url": "https://api.github.com/users/schaable/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/schaable/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/schaable/subscriptions",
      "organizations_url": "https://api.github.com/users/schaable/orgs",
      "repos_url": "https://api.github.com/users/schaable/repos",
      "events_url": "https://api.github.com/users/schaable/events{/privacy}",
      "received_events_url": "https://api.github.com/users/schaable/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-18T05:46:35Z",
  "updated_at": "2023-09-20T17:32:10Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I think the reversion of default EVM version of the Solidity compiler back to `paris` (from `shanghai`, currently the latest) warranted a minor (instead of patch) version number increment (e.g. 2.18.x), as the behavior and outputs have been changed.\r\n\r\nPeople who have been developing without issue based on what was default may only *find out by surprise* after updating and noticing that all of their contracts got recompiled. Others may not even notice it and proceed with deployments. Such an automatic downgrade of EVM version and recompilation may not be welcome.\r\n\r\nA version update from 2.17.2 to 2.17.3 appears on the surface to be a bug fix, so most people may not check the change log whenever there are such small patch version number increments.\r\n\r\nAlso, people who newly install hardhat may want and expect to only use the latest versions of everything and would only accept a downgrade if they must. So such a downgrade would not be welcome for those who use Ethereum or Polygon zkEVM, as the `PUSH0` EVM opcode works fine on those.\r\n\r\nMaybe there should be a new message about this when users actually do a compile so that they can take action beforehand instead of letting hardhat do an automatic downgrade almost invisibly.\r\n\r\nOne idea may be to no longer have `evmVersion` optional, so that an error appears, forcing the user to choose which one they really want to use and to add it explicity into hardhat.config.js.\r\n\r\nAlso, it may be good to print the actual solc version and EVM version that is being used when compiling. I show the hardhat solidity settings in my own hardhat-yul repository, e.g.: https://github.com/SKYBITDev3/hardhat-yul/blob/9f842908faef020ed37e36b27edb30a3a5c52e44/src/compilation.ts#L113\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1727357208",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4391#issuecomment-1727357208",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391",
    "id": 1727357208,
    "node_id": "IC_kwDOB7jojM5m9WEY",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-20T09:40:46Z",
    "updated_at": "2023-09-20T09:40:46Z",
    "author_association": "MEMBER",
    "body": "Hi @SKYBITDev3. I think I agree with you. I considered doing a minor and for some reason then I didn't. In retrospect that was a mistake. But I think undoing that change in a new patch an releasing a new minor with the proper change is going to be too noisy now.\r\n\r\nI think the best we can do now is this:\r\n\r\n> Also, it may be good to print the actual solc version and EVM version that is being used when compiling.\r\n\r\nI really like this idea.\r\n\r\nWith respect to making the `evmVersion` mandatory... I think that might be too much.\r\n\r\n> Also, people who newly install hardhat may want and expect to only use the latest versions of everything and would only accept a downgrade if they must. So such a downgrade would not be welcome for those who use Ethereum or Polygon zkEVM, as the PUSH0 EVM opcode works fine on those.\r\n\r\nThis makes sense, but we do need to make a decision one way or another: we either unnecessarily downgrade the EVM version for some users, or we default to compiling broken bytecode for others. All things considered, I think defaulting to the safer version makes more sense. The cost is that some users will have contracts that could be more optimized but aren't, which seems like a sensible trade-off to me. Wdyt?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1727357208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1727946271",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4391#issuecomment-1727946271",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391",
    "id": 1727946271,
    "node_id": "IC_kwDOB7jojM5m_l4f",
    "user": {
      "login": "SKYBITDev3",
      "id": 141273631,
      "node_id": "U_kgDOCGuqHw",
      "avatar_url": "https://avatars.githubusercontent.com/u/141273631?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SKYBITDev3",
      "html_url": "https://github.com/SKYBITDev3",
      "followers_url": "https://api.github.com/users/SKYBITDev3/followers",
      "following_url": "https://api.github.com/users/SKYBITDev3/following{/other_user}",
      "gists_url": "https://api.github.com/users/SKYBITDev3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SKYBITDev3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SKYBITDev3/subscriptions",
      "organizations_url": "https://api.github.com/users/SKYBITDev3/orgs",
      "repos_url": "https://api.github.com/users/SKYBITDev3/repos",
      "events_url": "https://api.github.com/users/SKYBITDev3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SKYBITDev3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-20T15:23:14Z",
    "updated_at": "2023-09-20T17:32:10Z",
    "author_association": "NONE",
    "body": "Best practice generally in technology is to use the latest versions. We resort to a downgrade only if necessary, e.g. if something that we need  doesn't work.\r\n\r\nUs developers aren't mindless non-technical end users - when something doesn't work, we ourselves find a way to make it work using our problem-solving skills. In the case of EVM version, if we came across `invalid opcode` error, we would do some searching and find that the solution is simply to downgrade by adding `evmVersion: 'paris'` in hardhat.config.js. There are around 5 different invalid opcode questions on Stack Overflow with that solution. But if things were fine for us with the latest versions, nothing needs to be done, so you shouldn't be changing our environment without our consent.\r\n\r\nA smarter solution, if possible, would've been to print a message about suggesting to try `evmVersion: 'paris'` if the user gets `invalid opcode` error.\r\n\r\n> making the `evmVersion` mandatory... I think that might be too much.\r\n\r\nIt would give certainty, especially amid this flip-flopping of default EVM version. Otherwise a newcomer would naturally think they're using latest versions if they only set `version: '0.8.21'` in hardhat.config.js. Just as Solidity version is required, so too `evmVersion` could be required.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1727946271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1728047288",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4391#issuecomment-1728047288",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4391",
    "id": 1728047288,
    "node_id": "IC_kwDOB7jojM5m_-i4",
    "user": {
      "login": "SKYBITDev3",
      "id": 141273631,
      "node_id": "U_kgDOCGuqHw",
      "avatar_url": "https://avatars.githubusercontent.com/u/141273631?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SKYBITDev3",
      "html_url": "https://github.com/SKYBITDev3",
      "followers_url": "https://api.github.com/users/SKYBITDev3/followers",
      "following_url": "https://api.github.com/users/SKYBITDev3/following{/other_user}",
      "gists_url": "https://api.github.com/users/SKYBITDev3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SKYBITDev3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SKYBITDev3/subscriptions",
      "organizations_url": "https://api.github.com/users/SKYBITDev3/orgs",
      "repos_url": "https://api.github.com/users/SKYBITDev3/repos",
      "events_url": "https://api.github.com/users/SKYBITDev3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SKYBITDev3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-20T16:10:54Z",
    "updated_at": "2023-09-20T16:18:39Z",
    "author_association": "NONE",
    "body": "You could add `evmVersion` explicitly into hardhat.config.js when a user creates a new hardhat project, e.g.:\r\n\r\n```js\r\n  solidity: {\r\n    compilers: [\r\n      {\r\n        version: `0.8.21`,\r\n        settings: {\r\n          optimizer: {\r\n            enabled: true,\r\n            runs: 1000\r\n          },\r\n          evmVersion: `shanghai`, // downgrade to `paris` if you encounter 'invalid opcode' error\r\n        }\r\n      },\r\n    ],\r\n  },\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1728047288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
