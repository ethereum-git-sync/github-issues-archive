{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1257",
  "id": 810774782,
  "node_id": "MDU6SXNzdWU4MTA3NzQ3ODI=",
  "number": 1257,
  "title": "mainnet forking with OpenEthereum fails with `blockTag` errors",
  "user": {
    "login": "dbeal-eth",
    "id": 2107457,
    "node_id": "MDQ6VXNlcjIxMDc0NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2107457?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dbeal-eth",
    "html_url": "https://github.com/dbeal-eth",
    "followers_url": "https://api.github.com/users/dbeal-eth/followers",
    "following_url": "https://api.github.com/users/dbeal-eth/following{/other_user}",
    "gists_url": "https://api.github.com/users/dbeal-eth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dbeal-eth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dbeal-eth/subscriptions",
    "organizations_url": "https://api.github.com/users/dbeal-eth/orgs",
    "repos_url": "https://api.github.com/users/dbeal-eth/repos",
    "events_url": "https://api.github.com/users/dbeal-eth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dbeal-eth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-02-18T05:33:15Z",
  "updated_at": "2022-11-18T16:00:49Z",
  "closed_at": "2021-02-20T07:10:52Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": "resolved",
  "body": "I am attempting to use a synced local node of OpenEthereum as a JSONRPC target for mainnet forking. However, I am getting a variety of errors having to do with `invalid blockTag`.\r\n\r\nFor example, if I attempt to use `signer.getBalance()` from ethers while using mainnet forking, it returns this error:\r\n\r\n```\r\nInvalidInputError: Received invalid block tag 717651011697952300806243805620595611188106730737. Latest block number is 11878892\r\n      at EthModule._blockTagToBlockNumber (node_modules/hardhat/src/internal/hardhat-network/provider/modules/eth.ts:1072:13)\r\n      at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\n      at runNextTicks (internal/process/task_queues.js:66:3)\r\n      at listOnTimeout (internal/timers.js:523:9)\r\n      at processTimers (internal/timers.js:497:7)\r\n      at EthModule._getBalanceAction (node_modules/hardhat/src/internal/hardhat-network/provider/modules/eth.ts:434:25)\r\n      at HardhatNetworkProvider.request (node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:102:18)\r\n      at EthersProviderWrapper.send (node_modules/hardhat-deploy-ethers/src/ethers-provider-wrapper.ts:13:20)\r\n```\r\n\r\nWhen making a ethers contract call (read only), there is another error:\r\n\r\n```\r\nError: invalid blockTag\r\n      at Formatter.blockTag (node_modules/@ethersproject/providers/src.ts/formatter.ts:236:15)\r\n      at EthersProviderWrapper.<anonymous> (node_modules/@ethersproject/providers/src.ts/base-provider.ts:1381:31)\r\n      at step (node_modules/@ethersproject/providers/lib/base-provider.js:46:23)\r\n      at Object.next (node_modules/@ethersproject/providers/lib/base-provider.js:27:53)\r\n      at fulfilled (node_modules/@ethersproject/providers/lib/base-provider.js:18:58)\r\n      at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\n```\r\n\r\nHere is the configuration in use for hardhat network:\r\n\r\n```\r\n{\r\n  networks: {\r\n    hardhat: {\r\n      chainId: 1337,\r\n      accounts: {\r\n        mnemonic: '...'\r\n      },\r\n      forking: {\r\n        url: 'http://my.eth.node:8545',\r\n      }\r\n    },\r\n  },\r\n```\r\n\r\nOpenEthereum is not in \"archival\" mode, but I am not trying to pin to a historical block.\r\n\r\nExpected behavior is not to be getting these errors... I really wish I knew what was going on.",
  "closed_by": {
    "login": "dbeal-eth",
    "id": 2107457,
    "node_id": "MDQ6VXNlcjIxMDc0NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2107457?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dbeal-eth",
    "html_url": "https://github.com/dbeal-eth",
    "followers_url": "https://api.github.com/users/dbeal-eth/followers",
    "following_url": "https://api.github.com/users/dbeal-eth/following{/other_user}",
    "gists_url": "https://api.github.com/users/dbeal-eth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dbeal-eth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dbeal-eth/subscriptions",
    "organizations_url": "https://api.github.com/users/dbeal-eth/orgs",
    "repos_url": "https://api.github.com/users/dbeal-eth/repos",
    "events_url": "https://api.github.com/users/dbeal-eth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dbeal-eth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/781068104",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1257#issuecomment-781068104",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257",
    "id": 781068104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MTA2ODEwNA==",
    "user": {
      "login": "dbeal-eth",
      "id": 2107457,
      "node_id": "MDQ6VXNlcjIxMDc0NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2107457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dbeal-eth",
      "html_url": "https://github.com/dbeal-eth",
      "followers_url": "https://api.github.com/users/dbeal-eth/followers",
      "following_url": "https://api.github.com/users/dbeal-eth/following{/other_user}",
      "gists_url": "https://api.github.com/users/dbeal-eth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dbeal-eth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dbeal-eth/subscriptions",
      "organizations_url": "https://api.github.com/users/dbeal-eth/orgs",
      "repos_url": "https://api.github.com/users/dbeal-eth/repos",
      "events_url": "https://api.github.com/users/dbeal-eth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dbeal-eth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-18T05:34:41Z",
    "updated_at": "2021-02-18T05:34:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "OpenEthereum is \"full\" node, not light\r\nOpenEthereum v3.0.1",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/781068104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/782576609",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1257#issuecomment-782576609",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257",
    "id": 782576609,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjU3NjYwOQ==",
    "user": {
      "login": "dbeal-eth",
      "id": 2107457,
      "node_id": "MDQ6VXNlcjIxMDc0NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2107457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dbeal-eth",
      "html_url": "https://github.com/dbeal-eth",
      "followers_url": "https://api.github.com/users/dbeal-eth/followers",
      "following_url": "https://api.github.com/users/dbeal-eth/following{/other_user}",
      "gists_url": "https://api.github.com/users/dbeal-eth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dbeal-eth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dbeal-eth/subscriptions",
      "organizations_url": "https://api.github.com/users/dbeal-eth/orgs",
      "repos_url": "https://api.github.com/users/dbeal-eth/repos",
      "events_url": "https://api.github.com/users/dbeal-eth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dbeal-eth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T07:10:52Z",
    "updated_at": "2021-02-20T07:10:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "turns out the error was in my code. the call to signer get balance I had confusingly added an extra argument, like:\r\n\r\n```\r\nsigner.getBalance(addressOfSigner)\r\n```\r\n\r\nthis caused hardhat to interpret the argument as a `blockTag`. It parsed the address hex into a big number, and then tried to load with blocktag. This error somehow propagated to other functions as well, which is why I got so confused.\r\n\r\nIdeally, hardhat would have not just converted the address into a number and rolled into an error like this, but that can be a separate issue if the team wants it.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/782576609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/783465225",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1257#issuecomment-783465225",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257",
    "id": 783465225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzQ2NTIyNQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-22T15:42:06Z",
    "updated_at": "2021-02-22T15:42:06Z",
    "author_association": "MEMBER",
    "body": "> Ideally, hardhat would have not just converted the address into a number and rolled into an error like this, but that can be a separate issue if the team wants it.\r\n\r\nThat would be great, but:\r\n\r\n1) I'm not sure if this should be hardhat's responsibility, sounds like an ethers thing.\r\n2) Even then, I'm not sure if there's a way to tell apart between a genuine use of a hex and an address.\r\n\r\nAnyway, you could try opening an issue on ethers, maybe there is a proper way to avoid this problem. And of course, if you think there's something we can do, please open an issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/783465225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/913898677",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1257#issuecomment-913898677",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1257",
    "id": 913898677,
    "node_id": "IC_kwDOB7jojM42ePy1",
    "user": {
      "login": "fulldecent",
      "id": 382183,
      "node_id": "MDQ6VXNlcjM4MjE4Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/382183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fulldecent",
      "html_url": "https://github.com/fulldecent",
      "followers_url": "https://api.github.com/users/fulldecent/followers",
      "following_url": "https://api.github.com/users/fulldecent/following{/other_user}",
      "gists_url": "https://api.github.com/users/fulldecent/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fulldecent/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fulldecent/subscriptions",
      "organizations_url": "https://api.github.com/users/fulldecent/orgs",
      "repos_url": "https://api.github.com/users/fulldecent/repos",
      "events_url": "https://api.github.com/users/fulldecent/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fulldecent/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T23:36:42Z",
    "updated_at": "2021-09-06T23:36:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here are solutions to the specific problem above\r\n\r\nGeneric:\r\n\r\n```javascript\r\nasync function getBalance (account) {\r\n  return new BN(await network.provider.send('eth_getBalance', [account]));\r\n}\r\n\r\n```\r\n\r\nweb3.js (e.g. you copy/pasted from OpenZeppelin Contracts)\r\n\r\n```javascript\r\nasync function getBalance (account) {\r\n  return new BN(await hardhat.web3.eth.getBalance(account));\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/913898677/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
