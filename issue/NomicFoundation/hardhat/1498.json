{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1498",
  "id": 907604944,
  "node_id": "MDU6SXNzdWU5MDc2MDQ5NDQ=",
  "number": 1498,
  "title": "ErrorInferrer: misleading \"unexpected amount of data\" message when a function has a fallback",
  "user": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937718880,
      "node_id": "LA_kwDOB7jojM8AAAABJk-cYA",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:improvement",
      "name": "type:improvement",
      "color": "FBCA04",
      "default": false,
      "description": ""
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    },
    {
      "id": 4951951046,
      "node_id": "LA_kwDOB7jojM8AAAABJyjGxg",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/area:error-inferrer",
      "name": "area:error-inferrer",
      "color": "5319E7",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-05-31T16:40:58Z",
  "updated_at": "2023-02-14T09:03:46Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Given this contracts:\r\n\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\nimport \"hardhat/console.sol\";\r\n\r\ncontract Foo {\r\n  uint public x;\r\n}\r\n\r\ncontract Bar {\r\n  uint public y;\r\n\r\n  fallback() external {}\r\n}\r\n\r\ncontract CallFoo {\r\n  function test(Foo foo) public {\r\n    uint value = foo.x();\r\n    console.logUint(value);\r\n  }\r\n}\r\n```\r\n\r\nand this script:\r\n\r\n```js\r\nasync function main() {\r\n  const Foo = await hre.ethers.getContractFactory(\"Foo\");\r\n  const foo = await Foo.deploy();\r\n  const Bar = await hre.ethers.getContractFactory(\"Bar\");\r\n  const bar = await Bar.deploy();\r\n\r\n  const CallFoo = await hre.ethers.getContractFactory(\"CallFoo\");\r\n  const callFoo = await CallFoo.deploy();\r\n\r\n  await callFoo.deployed();\r\n\r\n  await callFoo.test(bar.address);\r\n}\r\n\r\nmain()\r\n  .then(() => process.exit(0))\r\n  .catch(error => {\r\n    console.error(error);\r\n    process.exit(1);\r\n  });\r\n```\r\n\r\nThe error returned by hardhat is:\r\n\r\n```\r\nError: Transaction reverted: function returned an unexpected amount of data\r\n```\r\n\r\nThe error here is that `CallFoo` received the address of a `Bar` contract, not a `Foo` contract. But since it has a fallback function, the error isn't `function selector was not recognized and there's no fallback function` as it would be otherwise. This seems like something we could detect and give a better error message.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/920009124",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1498#issuecomment-920009124",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498",
    "id": 920009124,
    "node_id": "IC_kwDOB7jojM421jmk",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-15T13:16:11Z",
    "updated_at": "2021-09-15T13:16:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "The exact same error happens when I interact with a contract \"deployed\" via the [hardat_setCode](https://hardhat.org/hardhat-network/reference/#hardhat-setcode) JSON-RPC method.\r\n\r\nI am deploying a mock USDC contract like this:\r\n\r\n```ts\r\n\r\nexport async function deployUsdc(deployer: Signer): Promise<GodModeErc20> {\r\n  const godModeErc20Artifact: Artifact = await artifacts.readArtifact(\"GodModeErc20\");\r\n\r\n  // Deploy via CREATE first, to get a runtime bytecode with the constructor arguments.\r\n  const godModeErc20: GodModeErc20 = <GodModeErc20>(\r\n    await waffle.deployContract(deployer, godModeErc20Artifact, [USDC_NAME, USDC_SYMBOL, USDC_DECIMALS])\r\n  );\r\n\r\n  // Get the runtime bytecode.\r\n  const runtimeBytecode: string = await ethers.provider.getCode(godModeErc20.address);\r\n\r\n  // Deploy the USDC contract at address(1).\r\n  await ethers.provider.send(\"hardhat_setCode\", [USDC_ADDRESS, runtimeBytecode]);\r\n\r\n  // Load the USDC contract at address(1);\r\n  const usdc: GodModeErc20 = GodModeErc20__factory.connect(USDC_ADDRESS, deployer);\r\n\r\n  return usdc;\r\n}\r\n```\r\n\r\nThen, I am passing `USDC_ADDRESS` as a function argument (see `asset` below) to a contract compiled and deployed normally (with the `CREATE` opcode). \r\n\r\n```sol\r\nfunction setFeed(IErc20 asset, IAggregatorV3 feed) external override onlyOwner {\r\n    string memory symbol = asset.symbol();\r\n    // ...\r\n}\r\n```\r\n\r\nWhen I call `setFeed`, the tests fail with this error:\r\n\r\n```\r\nError: Transaction reverted: function returned an unexpected amount of data\r\nat ChainlinkOperator.setFeed (contracts/ChainlinkOperator.sol:99)\r\nat processTicksAndRejections (node:internal/process/task_queues:96:5)\r\nat runNextTicks (node:internal/process/task_queues:65:3)\r\nat listOnTimeout (node:internal/timers:526:9)\r\nat processTimers (node:internal/timers:500:7)\r\nat async EthModule._estimateGasAction (/Users/paulrberg/workspace/hifi/monorepo/node_modules/hardhat/src/internal/hardhat-network/provider/modules/eth.ts:425:7)\r\nat async HardhatNetworkProvider.request (/Users/paulrberg/workspace/hifi/monorepo/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:108:18)\r\nat async EthersProviderWrapper.send (/Users/paulrberg/workspace/hifi/monorepo/node_modules/@nomiclabs/hardhat-ethers/src/internal/ethers-provider-wrapper.ts:13:20)\r\n```\r\n\r\nThis doesn't happen when I deploy USDC the normal way.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/920009124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/920021606",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1498#issuecomment-920021606",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498",
    "id": 920021606,
    "node_id": "IC_kwDOB7jojM421mpm",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-15T13:31:34Z",
    "updated_at": "2021-09-15T13:31:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Whoops .. the issue was that `USDC_ADDRESS` was set to `address(1)`.  That is [where the `ecrecover` precompiled contract is located at](https://docs.klaytn.com/smart-contract/precompiled-contracts).\r\n\r\nPlease nevermind my report above.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/920021606/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1053334052",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1498#issuecomment-1053334052",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498",
    "id": 1053334052,
    "node_id": "IC_kwDOB7jojM4-yJok",
    "user": {
      "login": "amirgamil",
      "id": 7995105,
      "node_id": "MDQ6VXNlcjc5OTUxMDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7995105?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amirgamil",
      "html_url": "https://github.com/amirgamil",
      "followers_url": "https://api.github.com/users/amirgamil/followers",
      "following_url": "https://api.github.com/users/amirgamil/following{/other_user}",
      "gists_url": "https://api.github.com/users/amirgamil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amirgamil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amirgamil/subscriptions",
      "organizations_url": "https://api.github.com/users/amirgamil/orgs",
      "repos_url": "https://api.github.com/users/amirgamil/repos",
      "events_url": "https://api.github.com/users/amirgamil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amirgamil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-27T08:07:39Z",
    "updated_at": "2022-02-27T08:22:46Z",
    "author_association": "NONE",
    "body": "Can confirm I see this error trying to pass an `address` in the constructor\r\n\r\nEDIT: Nvm, just needed to use `ethers` to pass a correctly formatted address!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1053334052/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1429363675",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1498#issuecomment-1429363675",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1498",
    "id": 1429363675,
    "node_id": "IC_kwDOB7jojM5VMlvb",
    "user": {
      "login": "donghwan2019",
      "id": 94504974,
      "node_id": "U_kgDOBaIIDg",
      "avatar_url": "https://avatars.githubusercontent.com/u/94504974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/donghwan2019",
      "html_url": "https://github.com/donghwan2019",
      "followers_url": "https://api.github.com/users/donghwan2019/followers",
      "following_url": "https://api.github.com/users/donghwan2019/following{/other_user}",
      "gists_url": "https://api.github.com/users/donghwan2019/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/donghwan2019/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/donghwan2019/subscriptions",
      "organizations_url": "https://api.github.com/users/donghwan2019/orgs",
      "repos_url": "https://api.github.com/users/donghwan2019/repos",
      "events_url": "https://api.github.com/users/donghwan2019/events{/privacy}",
      "received_events_url": "https://api.github.com/users/donghwan2019/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T09:03:45Z",
    "updated_at": "2023-02-14T09:03:45Z",
    "author_association": "NONE",
    "body": "@amirgamil hi\r\nPlease tell me what to do to resolve this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1429363675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
