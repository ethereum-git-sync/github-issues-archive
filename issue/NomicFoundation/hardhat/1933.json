{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933",
  "id": 1018118462,
  "node_id": "I_kwDOB7jojM48r0E-",
  "number": 1933,
  "title": "InvalidInputError: sender doesnt have enough funds to send tx",
  "user": {
    "login": "beskay",
    "id": 89798300,
    "node_id": "MDQ6VXNlcjg5Nzk4MzAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/89798300?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/beskay",
    "html_url": "https://github.com/beskay",
    "followers_url": "https://api.github.com/users/beskay/followers",
    "following_url": "https://api.github.com/users/beskay/following{/other_user}",
    "gists_url": "https://api.github.com/users/beskay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/beskay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/beskay/subscriptions",
    "organizations_url": "https://api.github.com/users/beskay/orgs",
    "repos_url": "https://api.github.com/users/beskay/repos",
    "events_url": "https://api.github.com/users/beskay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/beskay/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-10-06T11:36:34Z",
  "updated_at": "2023-01-09T00:14:50Z",
  "closed_at": "2021-10-06T13:00:14Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "If you run tests on an instance of Hardhat Network that forks mainnet, and connect to a wallet address that has less than ~4ETH via method: \"hardhat_impersonateAccount\", you cant send transactions, or interact with smart contracts, due to an InvalidInputError.\r\n\r\nI uploaded a minimal github repo to reproduce this error. See the Readme for more details.\r\nhttps://github.com/beskay/Hardhat_InvalidInputError\r\n\r\nNetwork config in hardhat.config.js: \r\n`  networks: {\r\n    hardhat: {\r\n      chainId: 1337,\r\n      forking: {\r\n        url: API_MAINNET,\r\n        blockNumber: 13365034,\r\n      },\r\n    },\r\n  },`\r\n\r\nError i am getting:\r\n\r\n` InvalidInputError: sender doesn't have enough funds to send tx. The max upfront cost is: 4347376125669711168 and the sender's account only has: 421233560000000000`\r\n\r\nIf you clone my repo you will be able to reproduce the exact same error.\r\n\r\nIf i connect to a different wallet with enough ETH in it, everything works. The weird thing is, after the transaction went through, the amount of gas i paid is normal, like a few bucks, but somehow hardhat still shows that i need more than 4ETH to even be able to send that transaction.\r\n",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/936192592",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-936192592",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 936192592,
    "node_id": "IC_kwDOB7jojM43zSpQ",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-06T13:00:14Z",
    "updated_at": "2021-10-06T13:00:14Z",
    "author_association": "MEMBER",
    "body": "> The weird thing is, after the transaction went through, the amount of gas i paid is normal, like a few bucks, but somehow hardhat still shows that i need more than 4ETH to even be able to send that transaction.\r\n\r\nWhen you send a transaction, you have to have enough eth to pay for the max possible gas cost of a tx. That is, the `gasLimit * gasPrice` value. So if the gas limit is huge, you'll need much more ETH, even if then the actual gas used is very small compared to the set gas limit.\r\n\r\nSo my guess is that your tx is setting a large gas limit, for some reason. If that's the case, you should figure out why that's happening.\r\n\r\nI'm tentatively closing this, but please re-open if you still think the problem is on Hardhat's side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/936192592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/936269892",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-936269892",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 936269892,
    "node_id": "IC_kwDOB7jojM43zlhE",
    "user": {
      "login": "beskay",
      "id": 89798300,
      "node_id": "MDQ6VXNlcjg5Nzk4MzAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/89798300?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/beskay",
      "html_url": "https://github.com/beskay",
      "followers_url": "https://api.github.com/users/beskay/followers",
      "following_url": "https://api.github.com/users/beskay/following{/other_user}",
      "gists_url": "https://api.github.com/users/beskay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/beskay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/beskay/subscriptions",
      "organizations_url": "https://api.github.com/users/beskay/orgs",
      "repos_url": "https://api.github.com/users/beskay/repos",
      "events_url": "https://api.github.com/users/beskay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/beskay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-06T13:48:25Z",
    "updated_at": "2021-10-06T13:48:25Z",
    "author_association": "NONE",
    "body": "You are right, Hardhat is setting the gasLimit to 29022552 gas, almost the block limit of 30 million gas. After setting the gasLimit in the config manually to to a lower value, for example 2100000 gas, it works.  I dont know why hardhat is setting the gasLimit so high though. \r\nThanks for your answer.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/936269892/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1094570848",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-1094570848",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 1094570848,
    "node_id": "IC_kwDOB7jojM5BPdNg",
    "user": {
      "login": "viraj124",
      "id": 26670962,
      "node_id": "MDQ6VXNlcjI2NjcwOTYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26670962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/viraj124",
      "html_url": "https://github.com/viraj124",
      "followers_url": "https://api.github.com/users/viraj124/followers",
      "following_url": "https://api.github.com/users/viraj124/following{/other_user}",
      "gists_url": "https://api.github.com/users/viraj124/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/viraj124/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/viraj124/subscriptions",
      "organizations_url": "https://api.github.com/users/viraj124/orgs",
      "repos_url": "https://api.github.com/users/viraj124/repos",
      "events_url": "https://api.github.com/users/viraj124/events{/privacy}",
      "received_events_url": "https://api.github.com/users/viraj124/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-11T05:33:23Z",
    "updated_at": "2022-04-11T05:33:37Z",
    "author_association": "NONE",
    "body": "@fvictorio  I am on Mac with node version `v12.6.0` & hardhat version `2.9.1` my hardhat config looks like this, I added a very low gas limit like @beskay mentioned  but I still get this issue in my before each block\r\n```\r\n    hardhat: {\r\n      accounts: {\r\n        mnemonic,\r\n      },\r\n      chainId: chainIds.hardhat,\r\n      gas: 1800000,\r\n    },\r\n```\r\nAny other workaround I can do?\r\nI already tried with hardhat version `2.9.3` but that did not make a difference",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1094570848/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1096999590",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-1096999590",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 1096999590,
    "node_id": "IC_kwDOB7jojM5BYuKm",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-12T17:30:07Z",
    "updated_at": "2022-04-12T17:30:07Z",
    "author_association": "MEMBER",
    "body": "@viraj124 sadly that setting doesn't work if you are using ethers. You'll need to manually set the `gasLimit` override in the relevant transactions.\r\n\r\nAlternatively, setting a low base fee per gas with `initialBaseFeePerGas` could help too. Try setting that value to `7` and see if that makes things work better.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1096999590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1097013132",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-1097013132",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 1097013132,
    "node_id": "IC_kwDOB7jojM5BYxeM",
    "user": {
      "login": "viraj124",
      "id": 26670962,
      "node_id": "MDQ6VXNlcjI2NjcwOTYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26670962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/viraj124",
      "html_url": "https://github.com/viraj124",
      "followers_url": "https://api.github.com/users/viraj124/followers",
      "following_url": "https://api.github.com/users/viraj124/following{/other_user}",
      "gists_url": "https://api.github.com/users/viraj124/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/viraj124/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/viraj124/subscriptions",
      "organizations_url": "https://api.github.com/users/viraj124/orgs",
      "repos_url": "https://api.github.com/users/viraj124/repos",
      "events_url": "https://api.github.com/users/viraj124/events{/privacy}",
      "received_events_url": "https://api.github.com/users/viraj124/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-12T17:44:23Z",
    "updated_at": "2022-04-12T17:44:23Z",
    "author_association": "NONE",
    "body": "@fvictorio so the only option is override either of the values manually? ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1097013132/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1097033106",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-1097033106",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 1097033106,
    "node_id": "IC_kwDOB7jojM5BY2WS",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-12T18:06:14Z",
    "updated_at": "2022-04-12T18:06:14Z",
    "author_association": "MEMBER",
    "body": "I mentioned another option in my answer. If the base fee per gas is low enough, then transactions won't cost that much and the default gas limit could be fine. I'm not 100% sure about this, but it's worth trying I guess.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1097033106/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1272747820",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1933#issuecomment-1272747820",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1933",
    "id": 1272747820,
    "node_id": "IC_kwDOB7jojM5L3Jcs",
    "user": {
      "login": "akkien",
      "id": 16336645,
      "node_id": "MDQ6VXNlcjE2MzM2NjQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/16336645?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/akkien",
      "html_url": "https://github.com/akkien",
      "followers_url": "https://api.github.com/users/akkien/followers",
      "following_url": "https://api.github.com/users/akkien/following{/other_user}",
      "gists_url": "https://api.github.com/users/akkien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/akkien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/akkien/subscriptions",
      "organizations_url": "https://api.github.com/users/akkien/orgs",
      "repos_url": "https://api.github.com/users/akkien/repos",
      "events_url": "https://api.github.com/users/akkien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/akkien/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-10T03:40:07Z",
    "updated_at": "2022-10-10T03:40:07Z",
    "author_association": "NONE",
    "body": "Just for anyone's needs, in my case, the hardhat's default account balance (10000 ETH) is not enough. \r\n\r\nSo I solved the issue by setting the default account balance to a higher value (1000000 ETH in my case). See: https://hardhat.org/hardhat-network/docs/reference#accounts",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1272747820/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
