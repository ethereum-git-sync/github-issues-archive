{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4779",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4779/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4779/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4779/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4779",
  "id": 2093679264,
  "node_id": "I_kwDOB7jojM58ywKg",
  "number": 4779,
  "title": "Why is contract deployment taking high gas costs when deploying contracts with the help of NodeJS child process ?",
  "user": {
    "login": "iamgauravpant",
    "id": 64788558,
    "node_id": "MDQ6VXNlcjY0Nzg4NTU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64788558?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iamgauravpant",
    "html_url": "https://github.com/iamgauravpant",
    "followers_url": "https://api.github.com/users/iamgauravpant/followers",
    "following_url": "https://api.github.com/users/iamgauravpant/following{/other_user}",
    "gists_url": "https://api.github.com/users/iamgauravpant/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iamgauravpant/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iamgauravpant/subscriptions",
    "organizations_url": "https://api.github.com/users/iamgauravpant/orgs",
    "repos_url": "https://api.github.com/users/iamgauravpant/repos",
    "events_url": "https://api.github.com/users/iamgauravpant/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iamgauravpant/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2024-01-22T11:16:33Z",
  "updated_at": "2024-01-22T11:21:18Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.19.1\r\n\r\n### What happened?\r\n\r\nI tried to deploy ERC721 NFT contracts using NodeJS child process and hardhat ( I am creating a NodeJS API to deploy nft contracts for my application ) . For this , I rewrite hardhat.config.js file ( network name , network url , account_private_key ) and deploy.js file ( name and symbol of the token contracts ) . When I deploy contracts using this way , I am getting very high transaction costs ( ~0.3-0.5 ETH per deployment ) . Why is this happening ?\r\nTake these 2 transactions for example : https://sepolia.etherscan.io/tx/0x755dba9b4ba905622c756dd30deb4c994cd5be18a92342189d5c797152801c15\r\nhttps://sepolia.etherscan.io/tx/0xea5dfe3efe86a41b64a05a4481d63b3f07ee998f7d4441ae53512178a957decb\r\n```\r\n// deploy contract on polygon mumbai\r\n\r\nconst { spawn } = require(\"child_process\"); // inbuilt\r\n\r\nconst executeChildProcess = (command, args, options) => {\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        const child = spawn(command, args, options);\r\n  \r\n        let dataBuffer = '';\r\n        let errorBuffer = '';\r\n  \r\n        child.stdout.on('data', (data) => {\r\n          dataBuffer += data.toString();\r\n        });\r\n  \r\n        child.stderr.on('data', (data) => {\r\n          errorBuffer += data.toString();\r\n        });\r\n  \r\n        child.on('close', (code) => {\r\n          if (code === 0) {\r\n            resolve(dataBuffer);\r\n          } else {\r\n            reject(new Error(errorBuffer));\r\n          }\r\n        });\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    });\r\n};\r\n  \r\n// this config object gets added to hardhat.config.js file each time I call the api with parameters like network name , network url and account private key \r\nconst hardhatConfig = `\r\n  networks: {\r\n    PolygonMumbai: {\r\n      url: \"https://polygon-mumbai.infura.io/v3/infurakey\",\r\n      accounts:[\"account_private_key\"]\r\n    }\r\n  }`;\r\n\r\n// this is the deploy.js file that is used to deploy contract , it takes file_name , contract_name , contract_symbol as parameters\r\nconst scripts = `\r\n  const hre = require(\"hardhat\");\r\n  async function main(file_name, smart_contract_name, smart_contract_symbol) {\r\n  const contract = await hre.ethers.deployContract(file_name, [smart_contract_name,smart_contract_symbol]);\r\n  await contract.waitForDeployment();\r\n  console.log(contract.target);\r\n  return contract.target;\r\n  }\r\n          \r\n  main(\"CoolNFT\",\"CNFT\",\"CNFT721\")\r\n  .then(() => process.exit(0))\r\n  .catch(error => {\r\n  console.error(error);\r\n  process.exit(1);\r\n  });\r\n  `;\r\nconst cwd_path = \"/home/gauravpant31/721\";\r\n\r\nconst childResponsePromise = executeChildProcess(\r\n    'sh',\r\n    ['./deploy.sh', `'${scripts}'`, `'PolygonMumbai'`,`'${hardhatConfig}'`],\r\n    {\r\n      shell: true,\r\n      cwd: cwd_path,\r\n    }\r\n);\r\n\r\nchildResponsePromise\r\n.then((childResponse) => {\r\n  console.log(\"child process :\",childResponse);\r\n}).catch(err =>{\r\n  console.log(\"err :\",err);\r\n})\r\n```\r\n\r\nBelow is the deploy.sh file code that is present besides the hardhat code , this contains instructions to write to deploy.js file and hardhat.config.js file and to deploy the desired contract using npx hardhat run command \r\n\r\n```\r\necho \"require(\\\"@nomicfoundation/hardhat-toolbox\\\");\" > ./hardhat.config.js\r\necho \"/** @type import('hardhat/config').HardhatUserConfig */\" >> ./hardhat.config.js\r\necho \"module.exports = {\" >> ./hardhat.config.js\r\necho \"  solidity: {\" >> ./hardhat.config.js\r\necho \"    version: \\\"0.8.11\\\"\" >> ./hardhat.config.js\r\necho \"  },\" >> ./hardhat.config.js\r\necho \"$3\" >> ./hardhat.config.js  # Append the content from echo \"$3\"\r\necho \"};\" >> ./hardhat.config.js\r\n\r\n# Continue with the rest of your script\r\necho \"$1\" > ./scripts/deploy.js\r\nnpx hardhat run ./scripts/deploy.js --network \"$2\"\r\n```\r\n\r\n\r\n\r\n### Minimal reproduction steps\r\n\r\nCreate a hardhat boilerplate code .\r\nCreate a ERC-721 NFT contract that takes name and symbol in constructor parameters .\r\ncopy paste the deploy.sh file code and paste it at the root level in hardhat boilerplate code . \r\ncreate a new js file ( main.js ) , copy paste the child process code and run it .\r\n\r\n### Search terms\r\n\r\nhardhat , child process ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4779/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4779/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
