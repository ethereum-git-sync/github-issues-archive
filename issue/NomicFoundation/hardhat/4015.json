{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015",
  "id": 1752141493,
  "node_id": "I_kwDOB7jojM5ob461",
  "number": 4015,
  "title": "--typecheck flag should be configurable in hardhat.config.ts",
  "user": {
    "login": "startswithaj",
    "id": 3658522,
    "node_id": "MDQ6VXNlcjM2NTg1MjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3658522?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/startswithaj",
    "html_url": "https://github.com/startswithaj",
    "followers_url": "https://api.github.com/users/startswithaj/followers",
    "following_url": "https://api.github.com/users/startswithaj/following{/other_user}",
    "gists_url": "https://api.github.com/users/startswithaj/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/startswithaj/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/startswithaj/subscriptions",
    "organizations_url": "https://api.github.com/users/startswithaj/orgs",
    "repos_url": "https://api.github.com/users/startswithaj/repos",
    "events_url": "https://api.github.com/users/startswithaj/events{/privacy}",
    "received_events_url": "https://api.github.com/users/startswithaj/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 947232611,
      "node_id": "MDU6TGFiZWw5NDcyMzI2MTE=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:feature",
      "name": "type:feature",
      "color": "FBCA04",
      "default": false,
      "description": "Feature request"
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-06-12T07:58:19Z",
  "updated_at": "2023-06-15T07:34:46Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Describe the feature\r\n\r\nRecently `typecheck` was added to make typechecking opt in rather than opts out:\r\n\r\nhttps://github.com/NomicFoundation/hardhat/issues/2945\r\n\r\nhttps://github.com/NomicFoundation/hardhat/pull/3100\r\n\r\nIs it possible to make this flag configurable in hardhat.config.ts?\r\n\r\n### Search terms\r\n\r\ntypecheck, ts-node, typescript",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1587962077",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015#issuecomment-1587962077",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
    "id": 1587962077,
    "node_id": "IC_kwDOB7jojM5epmDd",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T19:38:41Z",
    "updated_at": "2023-06-12T19:38:41Z",
    "author_association": "MEMBER",
    "body": "> Is it possible to make this flag configurable in hardhat.config.ts?\r\n\r\nSadly, that's not possible right now. I'll try to explain why.\r\n\r\nWhen you run Hardhat with a typescript configuration, `ts-node` is loaded to run that config. It's at that stage that we have to decide if the code is typechecked or not. So, having a `typecheck` option in the config would mean that we'd need to read the config to decide if we are going to typecheck, but we need to decide if we are going to typecheck before loading the config...\r\n\r\nThat being said, I think we technically could do something like this:\r\n\r\n- If no `--typecheck` flag is passed, load the config without typechecking.\r\n- Before running whatever we are going to run, we check the config and see if the `typecheck` option is set to true.\r\n- If it is, we start over, but with typechecking enabled this time. (Or, alternatively, we just typecheck as a separate step before running the task.)\r\n\r\nBut that's way easier said than done, and I'm not sure it's worth the effort.\r\n\r\nI'm going to keep this issue open to see how much interest there is on this, but to be honest it's unlikely this will be a top priority soon :slightly_frowning_face:",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1587962077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1587963171",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015#issuecomment-1587963171",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
    "id": 1587963171,
    "node_id": "IC_kwDOB7jojM5epmUj",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T19:39:37Z",
    "updated_at": "2023-06-12T19:39:37Z",
    "author_association": "MEMBER",
    "body": "I'm marking this as `status:ready` but, to be clear, if we decide to do this at some point, the first step would be to evaluate if it's indeed technically possible.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1587963171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1588555726",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015#issuecomment-1588555726",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
    "id": 1588555726,
    "node_id": "IC_kwDOB7jojM5er2_O",
    "user": {
      "login": "startswithaj",
      "id": 3658522,
      "node_id": "MDQ6VXNlcjM2NTg1MjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3658522?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/startswithaj",
      "html_url": "https://github.com/startswithaj",
      "followers_url": "https://api.github.com/users/startswithaj/followers",
      "following_url": "https://api.github.com/users/startswithaj/following{/other_user}",
      "gists_url": "https://api.github.com/users/startswithaj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/startswithaj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/startswithaj/subscriptions",
      "organizations_url": "https://api.github.com/users/startswithaj/orgs",
      "repos_url": "https://api.github.com/users/startswithaj/repos",
      "events_url": "https://api.github.com/users/startswithaj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/startswithaj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-13T05:09:58Z",
    "updated_at": "2023-06-13T05:09:58Z",
    "author_association": "NONE",
    "body": "hey @fvictorio that makes complete sense.\r\n\r\nSlightly off topic, but I have this issue where I use the typechain factories for deployments. The bytecode is included in the types/output generated by typechain. This means that if you make a solidity change and don't execute a compile and then rerun hardhat it uses the old bytecode. \r\n\r\nDo you know if there is a way to detect if during a hardhat execution if any files are recompiled? This way I could do what you suggested above exit early and restart hardhat...",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1588555726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1590685974",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015#issuecomment-1590685974",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
    "id": 1590685974,
    "node_id": "IC_kwDOB7jojM5ez_EW",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-14T08:05:55Z",
    "updated_at": "2023-06-14T08:05:55Z",
    "author_association": "MEMBER",
    "body": "Sorry, I'm not sure I understand. When you run a script or your tests, Hardhat re-compiles the project (unless you explicitly ask it not to). If you are writing a custom task that needs to have the artifacts/typechain types up to date, you can add `await hre.run(\"compile\")` at the beginning.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1590685974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1592352717",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015#issuecomment-1592352717",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
    "id": 1592352717,
    "node_id": "IC_kwDOB7jojM5e6V_N",
    "user": {
      "login": "startswithaj",
      "id": 3658522,
      "node_id": "MDQ6VXNlcjM2NTg1MjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3658522?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/startswithaj",
      "html_url": "https://github.com/startswithaj",
      "followers_url": "https://api.github.com/users/startswithaj/followers",
      "following_url": "https://api.github.com/users/startswithaj/following{/other_user}",
      "gists_url": "https://api.github.com/users/startswithaj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/startswithaj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/startswithaj/subscriptions",
      "organizations_url": "https://api.github.com/users/startswithaj/orgs",
      "repos_url": "https://api.github.com/users/startswithaj/repos",
      "events_url": "https://api.github.com/users/startswithaj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/startswithaj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-15T04:50:10Z",
    "updated_at": "2023-06-15T04:55:29Z",
    "author_association": "NONE",
    "body": "> Sorry, I'm not sure I understand. When you run a script or your tests, Hardhat re-compiles the project (unless you explicitly ask it not to). If you are writing a custom task that needs to have the artifacts/typechain types up to date, you can add `await hre.run(\"compile\")` at the beginning.\r\n\r\n> When you run a script or your tests, Hardhat re-compiles the project (unless you explicitly ask it not to).\r\n\r\nYep, when you run the tests hardhat recompiles, but the typechain types and factories from the previous compile have already been loaded into memory by ts-node. Because the typechain generated code includes the bytecode for the contracts, when the tests run, it's using the old contract code and deploys old contracts. The next time you run hardhat the new typechain types/factories are loaded into memory and the correct contract bytecode is deployed. \r\n\r\nWhat I want to be able to do is detect when a recompile has happened when hardhat runs, so I can force and exit and hardhat to be restarted with the newer types/factories.\r\n\r\n```\r\ncontracts/typechain-types/factories/contracts/registry/Registry__factory.ts\r\n```\r\n<img width=\"1731\" alt=\"Screenshot 2023-06-15 at 2 49 19 pm\" src=\"https://github.com/NomicFoundation/hardhat/assets/3658522/1742d8e5-8690-46be-90eb-21f18af77e1d\">\r\n\r\n\r\nThe main issue is that the typechain factories do not use the artifacts in hre.artifacts (which get updated). They embedded the artifact bytecode in the typechain generated code.\r\n\r\n```\r\nconst x = await hre.run(\"compile\")\r\n```\r\n\r\nIn the above case x is undefined, and there isn't a way to determine if any changes were detected and files were recompiled.\r\n\r\nI'm wondering if there is any other way to detect if any files were recompiled. One method I've considered is checking the last modified time on all the artifact files in `/artifacts`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1592352717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1592517934",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4015#issuecomment-1592517934",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4015",
    "id": 1592517934,
    "node_id": "IC_kwDOB7jojM5e6-Uu",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-15T07:34:46Z",
    "updated_at": "2023-06-15T07:34:46Z",
    "author_association": "MEMBER",
    "body": "> Because the typechain generated code includes the bytecode for the contracts, when the tests run, it's using the old contract code and deploys old contracts.\r\n\r\nI see your point now. To be honest, I think the best answer is to use `hre.artifacts` instead of the bytecode generated by typechain, but I understand that that might mean a lot of changes for you.\r\n\r\nWe don't have an easy way to detect if the compile task did compile (or to check if it will). The only thing that comes to mind is (ab)using the `TASK_COMPILE_SOLIDITY_LOG_NOTHING_TO_COMPILE` subtask, doing something like this:\r\n\r\n```js\r\nlet nothingToCompile = false;\r\nsubtask(TASK_COMPILE_SOLIDITY_LOG_NOTHING_TO_COMPILE)\r\n  .setAction(async (args, hre, runSuper) => {\r\n    nothingToCompile = true;\r\n\r\n    return runSuper();\r\n  });\r\n```\r\n\r\nAnd then use the `nothingToCompile` flag in your other tasks. It's not a great solution, but it might work for you as a temporary workaround.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1592517934/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
