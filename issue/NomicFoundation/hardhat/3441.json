{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3441",
  "id": 1504403150,
  "node_id": "I_kwDOB7jojM5Zq17O",
  "number": 3441,
  "title": "Revert reason is not supported with ganache",
  "user": {
    "login": "joelamouche",
    "id": 16758383,
    "node_id": "MDQ6VXNlcjE2NzU4Mzgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/16758383?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/joelamouche",
    "html_url": "https://github.com/joelamouche",
    "followers_url": "https://api.github.com/users/joelamouche/followers",
    "following_url": "https://api.github.com/users/joelamouche/following{/other_user}",
    "gists_url": "https://api.github.com/users/joelamouche/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/joelamouche/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joelamouche/subscriptions",
    "organizations_url": "https://api.github.com/users/joelamouche/orgs",
    "repos_url": "https://api.github.com/users/joelamouche/repos",
    "events_url": "https://api.github.com/users/joelamouche/events{/privacy}",
    "received_events_url": "https://api.github.com/users/joelamouche/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-12-20T11:24:35Z",
  "updated_at": "2023-03-22T00:12:13Z",
  "closed_at": "2022-12-21T19:06:29Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "<!--\r\n\r\nThank you for using Hardhat and taking the time to open an issue!\r\n\r\n**Note that this issue tracker is not a support channel.**\r\n\r\n- For help with Hardhat and Hardhat network, please use our [Discord server](https://hardhat.org/discord).\r\n- For help with ethers.js, please go to [its Github Discussions](https://github.com/ethers-io/ethers.js/discussions).\r\n\r\nIf you are reporting a bug, please include reproduction steps. The best way to do this is to include a [Minimal Reproducible Example](https://stackoverflow.com/help/minimal-reproducible-example). If you can't do that, then include a link to your repo, and the steps to reproduce the problem. The easiest it is to reproduce your problem, the faster we are going to be able to fix it.\r\n\r\nIf you are submitting a feature request, please take the time to clearly describe your use case, and not only your proposed solution.\r\n\r\nThis issue will be automatically assigned to a Hardhat team member. This person will act as the point of contact between you and the team, but won't necessarily fix it nor address it in any way. An issue being assigned does not mean that it's being worked on.\r\n\r\n-->\r\nI am using hardhat 2.12.0 and \"ganache\": \"^7.7.2\" (and I also tried using \"@nomiclabs/hardhat-ganache\") and when I run my test with a function call that should revert with \"rollcall: proposal vote doesnt exist\", I get this error:\r\n\r\n```\r\nError: missing revert data in call exception; Transaction reverted without a reason string [ See: https://links.ethers.org/v5-errors-CALL_EXCEPTION ] (data=\"0x\", transaction={\"from\":\"0xF781758bd10510d809eF2bEb11cbd2DE06d0C2e9\",\"to\":\"0x1f047465513B6d7928cAF253B933E448a09C8700\",\"data\":\"0x3e4f49e60000000000000000000000000000000000000000000000000000000000003039\",\"accessList\":null}, error={\"name\":\"ProviderError\",\"_stack\":\"ProviderError: HttpProviderError\\n    at HttpProvider.request (/Users/antoineestienne/Github_Files/contracts/node_modules/hardhat/src/internal/core/providers/http.ts:78:19)\\n    at AutomaticSenderProvider.request (/Users/antoineestienne/Github_Files/contracts/node_modules/hardhat/src/internal/core/providers/accounts.ts:341:34)\\n    at AutomaticGasProvider.request (/Users/antoineestienne/Github_Files/contracts/node_modules/hardhat/src/internal/core/providers/gas-providers.ts:135:34)\\n    at FixedGasPriceProvider.request (/Users/antoineestienne/Github_Files/contracts/node_modules/hardhat/src/internal/core/providers/gas-providers.ts:54:34)\\n    at BackwardsCompatibilityProviderAdapter.send (/Users/antoineestienne/Github_Files/contracts/node_modules/hardhat/src/internal/core/providers/backwards-compatibility.ts:36:27)\\n    at EthersProviderWrapper.send (/Users/antoineestienne/Github_Files/contracts/node_modules/@nomiclabs/hardhat-ethers/src/internal/ethers-provider-wrapper.ts:13:48)\\n    at EthersProviderWrapper.<anonymous> (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/src.ts/json-rpc-provider.ts:640:31)\\n    at step (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:48:23)\\n    at Object.next (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:29:53)\\n    at /Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:23:71\\n    at new Promise (<anonymous>)\\n    at __awaiter (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:19:12)\\n    at EthersProviderWrapper.JsonRpcProvider.perform (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:720:16)\\n    at EthersProviderWrapper.<anonymous> (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/src.ts/base-provider.ts:1640:35)\\n    at step (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/base-provider.js:48:23)\\n    at Object.next (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/base-provider.js:29:53)\",\"code\":-32000,\"_isProviderError\":true,\"data\":{\"0xb52e1c32d4786e8973d4368243cbf5a8ea6ffd7dd181361da476550c1ce08473\":{\"error\":\"revert\",\"program_counter\":1577,\"return\":\"0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000024726f6c6c63616c6c3a2070726f706f73616c20766f746520646f65736e7420657869737400000000000000000000000000000000000000000000000000000000\",\"reason\":\"rollcall: proposal vote doesnt exist\"},\"stack\":\"RuntimeError: VM Exception while processing transaction: revert rollcall: proposal vote doesnt exist\\n    at Function.RuntimeError.fromResults (/Users/antoineestienne/Github_Files/contracts/node_modules/ganache-core/lib/utils/runtimeerror.js:94:13)\\n    at /Users/antoineestienne/Github_Files/contracts/node_modules/ganache-core/lib/blockchain_double.js:568:26\",\"name\":\"RuntimeError\"}}, code=CALL_EXCEPTION, version=providers/5.7.2)\r\n    at Logger.makeError (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/logger/src.ts/index.ts:269:28)\r\n    at Logger.throwError (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/logger/src.ts/index.ts:281:20)\r\n    at checkError (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/src.ts/json-rpc-provider.ts:66:16)\r\n    at EthersProviderWrapper.<anonymous> (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/src.ts/json-rpc-provider.ts:642:20)\r\n    at step (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:48:23)\r\n    at Object.throw (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:29:53)\r\n    at rejected (/Users/antoineestienne/Github_Files/contracts/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:21:65)\r\n    at runMicrotasks (<anonymous>)\r\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n```\r\n\r\nAs explained in https://github.com/trufflesuite/ganache/issues/2935#issuecomment-1102899802 , the error message does contain the right encoded revert reason: `0x08c379a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000024726f6c6c63616c6c3a2070726f706f73616c20766f746520646f65736e7420657869737400000000000000000000000000000000000000000000000000000000` but it is not handled correctly by hardhat",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1359211515",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3441#issuecomment-1359211515",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441",
    "id": 1359211515,
    "node_id": "IC_kwDOB7jojM5RA-v7",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-12-20T11:24:54Z",
    "updated_at": "2022-12-20T11:24:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1396/revert-reason-is-not-supported-with-ganache).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: c52b2e77-7341-41d7-97fe-a84ee6eef397",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1359211515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1361926935",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3441#issuecomment-1361926935",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3441",
    "id": 1361926935,
    "node_id": "IC_kwDOB7jojM5RLVsX",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-21T19:06:29Z",
    "updated_at": "2022-12-21T19:06:29Z",
    "author_association": "MEMBER",
    "body": "Hi @joelamouche, I get the same error if I use plain ethers, so this is not a Hardhat issue.\r\n\r\nReproduction: deploy this contract in ganache\r\n\r\n```solidity\r\ncontract Foo {\r\n  function f() public pure {\r\n    require(false, \"some reason\");\r\n  }\r\n}\r\n```\r\n\r\nand run this script:\r\n\r\n```js\r\nconst ethers = require(\"ethers\");\r\n\r\nasync function main() {\r\n  const provider = new ethers.providers.JsonRpcProvider(\r\n    \"http://localhost:8545\"\r\n  );\r\n\r\n  const foo = new ethers.Contract(\r\n    addressOfContract,\r\n    [\"function f() public pure\"],\r\n    provider\r\n  );\r\n\r\n  await foo.f();\r\n}\r\n\r\nmain()\r\n  .then(() => process.exit(0))\r\n  .catch(error => {\r\n    console.error(error);\r\n    process.exit(1);\r\n  });\r\n```\r\n\r\nWe had a similar problem in Hardhat in the past, and we fixed it by adding some extra data in the JSON-RPC error response. I don't remember the details, but if the ganache team needs help I can try to find the PR.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1361926935/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
