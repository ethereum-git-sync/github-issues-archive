{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4103",
  "id": 1787193863,
  "node_id": "I_kwDOB7jojM5qhmoH",
  "number": 4103,
  "title": "Tests work with 2.10.2 but exactly one test fails with 2.11.0 (\"SafeERC20: low-level call failed\")",
  "user": {
    "login": "andersaamodt",
    "id": 8476996,
    "node_id": "MDQ6VXNlcjg0NzY5OTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8476996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/andersaamodt",
    "html_url": "https://github.com/andersaamodt",
    "followers_url": "https://api.github.com/users/andersaamodt/followers",
    "following_url": "https://api.github.com/users/andersaamodt/following{/other_user}",
    "gists_url": "https://api.github.com/users/andersaamodt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/andersaamodt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andersaamodt/subscriptions",
    "organizations_url": "https://api.github.com/users/andersaamodt/orgs",
    "repos_url": "https://api.github.com/users/andersaamodt/repos",
    "events_url": "https://api.github.com/users/andersaamodt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/andersaamodt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2474207618,
      "node_id": "MDU6TGFiZWwyNDc0MjA3NjE4",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:needs-more-info",
      "name": "status:needs-more-info",
      "color": "0E8A16",
      "default": false,
      "description": "There's not enough information to start working on this issue"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-07-04T05:48:44Z",
  "updated_at": "2023-07-05T06:54:05Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.11.0\r\n\r\n### What happened?\r\n\r\nWith Hardhat 2.10.2, all 70 of my tests succeed. But when I upgrade Hardhat one version to 2.11.0, exactly one test fails. The line that is reverting is a call to safeTransferFrom OpenZeppelin's SafeERC20 in my contract. It throws a \"SafeERC20: low-level call failed\" error which is vague but usually indicates a gas problem. I already checked every possible assumption and the contract has sufficient gas.\r\n\r\nIs there anything that could have changed from version 2.10.2 to version 2.11.0 that could have introduced this bug, or revealed a bug already existing in my contract? I need to run this bug down because it could be a problem in the contract that is being revealed by some change in that hardhat version. (Versions after 2.11.0 also have the same error).\r\n\r\n### Minimal reproduction steps\r\n\r\n1. Install Hardhat v2.11.0.\r\n2. With solidity version 0.8.2, in a contract, run SafeERC20.safeTransferFrom(IERC20(tokenContract), _msgSender(), address(this), amountOfTokens) (with appropriate allowance set beforehand and gas and tokens in wallets as appropriate for transfering).\r\n3. Call fails with \"SafeERC20: low-level call failed\".\r\n4. Repeating steps with v2.10.2, the same line succeeds.\r\n\r\n### Search terms\r\n\r\nHardhat SafeERC20 OpenZeppelin",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1619575963",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4103#issuecomment-1619575963",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103",
    "id": 1619575963,
    "node_id": "IC_kwDOB7jojM5giMSb",
    "user": {
      "login": "andersaamodt",
      "id": 8476996,
      "node_id": "MDQ6VXNlcjg0NzY5OTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8476996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andersaamodt",
      "html_url": "https://github.com/andersaamodt",
      "followers_url": "https://api.github.com/users/andersaamodt/followers",
      "following_url": "https://api.github.com/users/andersaamodt/following{/other_user}",
      "gists_url": "https://api.github.com/users/andersaamodt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andersaamodt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andersaamodt/subscriptions",
      "organizations_url": "https://api.github.com/users/andersaamodt/orgs",
      "repos_url": "https://api.github.com/users/andersaamodt/repos",
      "events_url": "https://api.github.com/users/andersaamodt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andersaamodt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-04T06:24:54Z",
    "updated_at": "2023-07-04T06:24:54Z",
    "author_association": "NONE",
    "body": "Maybe it could be something in Solidity or a standard that Hardhat implements that changed between those versions?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1619575963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1620731501",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4103#issuecomment-1620731501",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103",
    "id": 1620731501,
    "node_id": "IC_kwDOB7jojM5gmmZt",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-04T20:51:29Z",
    "updated_at": "2023-07-04T20:51:29Z",
    "author_association": "MEMBER",
    "body": "The first thing that comes to mind is that the latest versions of Hardhat change the default hardfork that is used, although I don't know in this particular case why a tx would start succeeding.\r\n\r\n@andersaamodt any chance you can create a complete (but minimal) reproduction repo? I'm really curious about this but I'm not sure I'll be able to reproduce it with your instructions.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1620731501/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1621136271",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4103#issuecomment-1621136271",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4103",
    "id": 1621136271,
    "node_id": "IC_kwDOB7jojM5goJOP",
    "user": {
      "login": "andersaamodt",
      "id": 8476996,
      "node_id": "MDQ6VXNlcjg0NzY5OTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8476996?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andersaamodt",
      "html_url": "https://github.com/andersaamodt",
      "followers_url": "https://api.github.com/users/andersaamodt/followers",
      "following_url": "https://api.github.com/users/andersaamodt/following{/other_user}",
      "gists_url": "https://api.github.com/users/andersaamodt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andersaamodt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andersaamodt/subscriptions",
      "organizations_url": "https://api.github.com/users/andersaamodt/orgs",
      "repos_url": "https://api.github.com/users/andersaamodt/repos",
      "events_url": "https://api.github.com/users/andersaamodt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andersaamodt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-05T06:54:05Z",
    "updated_at": "2023-07-05T06:54:05Z",
    "author_association": "NONE",
    "body": "The forking is specified in hardhat.config.js in networks.hardhat.forking.url, so the default fork should affect it, right? I will see about getting a minimal reproduction repo (or if very short will just post the snippet here). Is there any way to see the log output of the simulated network that is set up when the tests are run? I am not manually launching the hardhat node, so I don't know where the output is. If I could see the log output on the hardhat node side when it crashes, that might help debug.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1621136271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
