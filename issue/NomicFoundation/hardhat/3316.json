{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316",
  "id": 1430305232,
  "node_id": "I_kwDOB7jojM5VQLnQ",
  "number": 3316,
  "title": "Hardhat is very slow when a large array of structs is created",
  "user": {
    "login": "czelios",
    "id": 64157503,
    "node_id": "MDQ6VXNlcjY0MTU3NTAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/64157503?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/czelios",
    "html_url": "https://github.com/czelios",
    "followers_url": "https://api.github.com/users/czelios/followers",
    "following_url": "https://api.github.com/users/czelios/following{/other_user}",
    "gists_url": "https://api.github.com/users/czelios/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/czelios/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/czelios/subscriptions",
    "organizations_url": "https://api.github.com/users/czelios/orgs",
    "repos_url": "https://api.github.com/users/czelios/repos",
    "events_url": "https://api.github.com/users/czelios/events{/privacy}",
    "received_events_url": "https://api.github.com/users/czelios/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 947230177,
      "node_id": "MDU6TGFiZWw5NDcyMzAxNzc=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:blocked",
      "name": "status:blocked",
      "color": "0E8A16",
      "default": false,
      "description": "Blocked by other issues or external reasons"
    },
    {
      "id": 4745762096,
      "node_id": "LA_kwDOB7jojM8AAAABGt6VMA",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/blocked-reason:needs-rethnet",
      "name": "blocked-reason:needs-rethnet",
      "color": "B60205",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2022-10-31T18:34:14Z",
  "updated_at": "2022-12-30T14:34:07Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi!\r\n\r\nThere is a problem while creating an array of structs, it takes way too much time.\r\nLook at the screenshots:\r\n\r\n![image](https://user-images.githubusercontent.com/64157503/199083238-d6b71306-423f-4f17-b896-5a8ab397f2df.png)\r\n\r\n![image](https://user-images.githubusercontent.com/64157503/199083403-481e7446-09b4-497c-8653-7a96fe2bf5fc.png)\r\n\r\n![image](https://user-images.githubusercontent.com/64157503/199083268-3204b9ec-6952-46ad-8178-44bd439e481a.png)\r\n\r\nIts worth noticing that on testnets ist working fast, problem is occuring only on hardhat tests.\r\n\r\nMoreover i ve checked that creating the array of uint256 (simple type instead of struct) is fast as should be:\r\n\r\n![image](https://user-images.githubusercontent.com/64157503/199082511-cd50dfb6-a2e6-4594-bedb-4133e30637d4.png)\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1297506215",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1297506215",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1297506215,
    "node_id": "IC_kwDOB7jojM5NVl-n",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-10-31T18:34:35Z",
    "updated_at": "2022-10-31T18:34:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1307/testing-for-array-of-structs-[nomicfoundationhardhat3316]).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: e936412d-ed7c-4610-8714-a60538ff2e6b",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1297506215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1298435577",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1298435577",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1298435577,
    "node_id": "IC_kwDOB7jojM5NZI35",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-01T12:24:08Z",
    "updated_at": "2022-11-01T12:24:08Z",
    "author_association": "MEMBER",
    "body": "@czelios can you share a [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example)? Trying to reproduce this from screenshots will be too time-consuming otherwise.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1298435577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299369068",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1299369068",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1299369068,
    "node_id": "IC_kwDOB7jojM5Ncsxs",
    "user": {
      "login": "czelios",
      "id": 64157503,
      "node_id": "MDQ6VXNlcjY0MTU3NTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/64157503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/czelios",
      "html_url": "https://github.com/czelios",
      "followers_url": "https://api.github.com/users/czelios/followers",
      "following_url": "https://api.github.com/users/czelios/following{/other_user}",
      "gists_url": "https://api.github.com/users/czelios/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/czelios/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/czelios/subscriptions",
      "organizations_url": "https://api.github.com/users/czelios/orgs",
      "repos_url": "https://api.github.com/users/czelios/repos",
      "events_url": "https://api.github.com/users/czelios/events{/privacy}",
      "received_events_url": "https://api.github.com/users/czelios/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-01T23:53:29Z",
    "updated_at": "2022-11-02T09:53:21Z",
    "author_association": "NONE",
    "body": "Sure:\r\nTest.sol\r\n```solidity\r\n// SPDX-License-Identifier: UNLICENSED\r\npragma solidity ^0.8.9;\r\n\r\ncontract Test {\r\n  struct NftInfo {\r\n    uint256 a;\r\n    uint256 b;\r\n    uint256 c;\r\n    uint256 d;\r\n    uint256 e;\r\n    uint256 f;\r\n  }\r\n\r\n  constructor() {}\r\n\r\n  function getNftsRank(uint256 collectionSize) public pure returns (uint256) {\r\n    NftInfo[] memory allNfts = new NftInfo[](collectionSize);\r\n    return allNfts.length;\r\n  }\r\n}\r\n```\r\n\r\nTest.js\r\n```js\r\nconst { expect } = require(\"chai\");\r\n\r\ndescribe.only(\"Test contract\", function () {\r\n  let test;\r\n\r\n  beforeEach(async function () {\r\n    const testFactory = await ethers.getContractFactory(\"Test\");\r\n    test = await testFactory.deploy();\r\n  });\r\n\r\n  describe(\"Test\", function () {\r\n    it(\"Should be fast\", async function () {\r\n      const airdropOwner = await test.getNftsRank(6000);\r\n      expect(airdropOwner).to.equal(6000);\r\n    });\r\n  });\r\n});\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299369068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299961232",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1299961232",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1299961232,
    "node_id": "IC_kwDOB7jojM5Ne9WQ",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T09:52:58Z",
    "updated_at": "2022-11-02T09:52:58Z",
    "author_association": "MEMBER",
    "body": "Oh wow, interesting. Thanks for reporting.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299961232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299962370",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1299962370",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1299962370,
    "node_id": "IC_kwDOB7jojM5Ne9oC",
    "user": {
      "login": "czelios",
      "id": 64157503,
      "node_id": "MDQ6VXNlcjY0MTU3NTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/64157503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/czelios",
      "html_url": "https://github.com/czelios",
      "followers_url": "https://api.github.com/users/czelios/followers",
      "following_url": "https://api.github.com/users/czelios/following{/other_user}",
      "gists_url": "https://api.github.com/users/czelios/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/czelios/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/czelios/subscriptions",
      "organizations_url": "https://api.github.com/users/czelios/orgs",
      "repos_url": "https://api.github.com/users/czelios/repos",
      "events_url": "https://api.github.com/users/czelios/events{/privacy}",
      "received_events_url": "https://api.github.com/users/czelios/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T09:53:53Z",
    "updated_at": "2022-11-02T09:53:53Z",
    "author_association": "NONE",
    "body": "No problem, let me know if you ll find a solution :)",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299962370/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1301026649",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1301026649",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1301026649,
    "node_id": "IC_kwDOB7jojM5NjBdZ",
    "user": {
      "login": "jochem-brouwer",
      "id": 29359032,
      "node_id": "MDQ6VXNlcjI5MzU5MDMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/29359032?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jochem-brouwer",
      "html_url": "https://github.com/jochem-brouwer",
      "followers_url": "https://api.github.com/users/jochem-brouwer/followers",
      "following_url": "https://api.github.com/users/jochem-brouwer/following{/other_user}",
      "gists_url": "https://api.github.com/users/jochem-brouwer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jochem-brouwer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jochem-brouwer/subscriptions",
      "organizations_url": "https://api.github.com/users/jochem-brouwer/orgs",
      "repos_url": "https://api.github.com/users/jochem-brouwer/repos",
      "events_url": "https://api.github.com/users/jochem-brouwer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jochem-brouwer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T18:04:26Z",
    "updated_at": "2022-11-02T18:04:26Z",
    "author_association": "NONE",
    "body": "How much gas are those tests using?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1301026649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1301095059",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1301095059",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1301095059,
    "node_id": "IC_kwDOB7jojM5NjSKT",
    "user": {
      "login": "czelios",
      "id": 64157503,
      "node_id": "MDQ6VXNlcjY0MTU3NTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/64157503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/czelios",
      "html_url": "https://github.com/czelios",
      "followers_url": "https://api.github.com/users/czelios/followers",
      "following_url": "https://api.github.com/users/czelios/following{/other_user}",
      "gists_url": "https://api.github.com/users/czelios/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/czelios/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/czelios/subscriptions",
      "organizations_url": "https://api.github.com/users/czelios/orgs",
      "repos_url": "https://api.github.com/users/czelios/repos",
      "events_url": "https://api.github.com/users/czelios/events{/privacy}",
      "received_events_url": "https://api.github.com/users/czelios/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T19:09:31Z",
    "updated_at": "2022-11-02T19:09:31Z",
    "author_association": "NONE",
    "body": "I havent checked. It should pass if you will set 600 instead of 6000",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1301095059/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1304064298",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3316#issuecomment-1304064298",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3316",
    "id": 1304064298,
    "node_id": "IC_kwDOB7jojM5NunEq",
    "user": {
      "login": "jochem-brouwer",
      "id": 29359032,
      "node_id": "MDQ6VXNlcjI5MzU5MDMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/29359032?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jochem-brouwer",
      "html_url": "https://github.com/jochem-brouwer",
      "followers_url": "https://api.github.com/users/jochem-brouwer/followers",
      "following_url": "https://api.github.com/users/jochem-brouwer/following{/other_user}",
      "gists_url": "https://api.github.com/users/jochem-brouwer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jochem-brouwer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jochem-brouwer/subscriptions",
      "organizations_url": "https://api.github.com/users/jochem-brouwer/orgs",
      "repos_url": "https://api.github.com/users/jochem-brouwer/repos",
      "events_url": "https://api.github.com/users/jochem-brouwer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jochem-brouwer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-04T19:28:38Z",
    "updated_at": "2022-11-04T20:06:03Z",
    "author_association": "NONE",
    "body": "I have tested this case with `3333` as argument, the test took `13347` ms when using hardhat (per the OP of this issue, have not tested this locally)\r\n\r\nHere is the script;\r\n\r\n```typescript\r\n  const common = new Common({chain: Chain.Mainnet, hardfork: Hardfork.Merge})\r\n  const vm = await VM.create({ common })\r\n\r\n  // Runtime bytecode\r\n  const code = Buffer.from(\"608060405234801561001057600080fd5b506004361061002b5760003560e01c80638acc538e14610030575b600080fd5b61004a60048036038101906100459190610134565b610060565b6040516100579190610170565b60405180910390f35b6000808267ffffffffffffffff81111561007d5761007c61018b565b5b6040519080825280602002602001820160405280156100b657816020015b6100a36100c3565b81526020019060019003908161009b5790505b5090508051915050919050565b6040518060c001604052806000815260200160008152602001600081526020016000815260200160008152602001600081525090565b600080fd5b6000819050919050565b610111816100fe565b811461011c57600080fd5b50565b60008135905061012e81610108565b92915050565b60006020828403121561014a576101496100f9565b5b60006101588482850161011f565b91505092915050565b61016a816100fe565b82525050565b60006020820190506101856000830184610161565b92915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fdfea26469706673582212203db290c1401aded71126025073dbf6e96da5594af56ce4578db8ac17b429c5ed64736f6c63430008090033\", 'hex')\r\n  const amount = setLengthLeft(bigIntToBuffer(BigInt(3333)), 32)\r\n\r\n  // The calldata to call into the contract\r\n  const calldata = Buffer.concat([Buffer.from(\"8acc538e\", 'hex'), amount])\r\n  const addr = Address.fromString('0x' + \"20\".repeat(20)) \r\n\r\n  await vm.stateManager.putContractCode(addr, code)\r\n\r\n  const pkey = Buffer.from(\"42\".repeat(32), 'hex')\r\n  const tx = new Transaction({\r\n    to: addr,\r\n    data: calldata,\r\n    gasLimit: BigInt(10000000000000),\r\n    gasPrice: BigInt(10)\r\n  }).sign(pkey)\r\n\r\n  const callerAddr = Address.fromPrivateKey(pkey)\r\n  const fwdAmount = tx.gasLimit * tx.gasPrice + tx.value\r\n\r\n  const acc = await vm.stateManager.getAccount(callerAddr)\r\n  acc.balance = fwdAmount\r\n\r\n  await vm.stateManager.putAccount(callerAddr, acc)\r\n\r\n  const d = Date.now()\r\n\r\n  await vm.runTx({tx})\r\n\r\n  console.log((Date.now() - d)/1000)\r\n  ```\r\n  \r\n  If I run this, it takes `1358` ms (thus in `@ethereumjs/vm`). It spends `1758892` (about 1.8M) gas. This is still slow, but with hardhat it seems 10 times slower. (My guess is that memory is copied internally since this view operation does a lot of changes to memory).\r\n  \r\n  Please note, the VM is still too slow: currently on mainnet we have a max gas limit of 30M, so about 30M/1.8 = 16.66.. = 16 txs of these should be executed. But if each of these takes 1.3 seconds then we take 20.8 seconds to execute the block, which is wayy too slow, it should do this in at most 12 seconds, but the practical limit is actually 6 seconds. \r\n  \r\n  I will forward this to the rest of our monorepo team.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1304064298/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
