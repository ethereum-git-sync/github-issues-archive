{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3084",
  "id": 1352805741,
  "node_id": "I_kwDOB7jojM5Qoi1t",
  "number": 3084,
  "title": "abi.decode results in an error that HardHat cannot decode the reason for",
  "user": {
    "login": "aaronbuchwald",
    "id": 24684335,
    "node_id": "MDQ6VXNlcjI0Njg0MzM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/24684335?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aaronbuchwald",
    "html_url": "https://github.com/aaronbuchwald",
    "followers_url": "https://api.github.com/users/aaronbuchwald/followers",
    "following_url": "https://api.github.com/users/aaronbuchwald/following{/other_user}",
    "gists_url": "https://api.github.com/users/aaronbuchwald/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aaronbuchwald/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aaronbuchwald/subscriptions",
    "organizations_url": "https://api.github.com/users/aaronbuchwald/orgs",
    "repos_url": "https://api.github.com/users/aaronbuchwald/repos",
    "events_url": "https://api.github.com/users/aaronbuchwald/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aaronbuchwald/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-26T23:05:46Z",
  "updated_at": "2023-03-29T00:15:45Z",
  "closed_at": "2022-12-28T08:21:20Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "<img width=\"957\" alt=\"Screen Shot 2022-08-26 at 18 59 42\" src=\"https://user-images.githubusercontent.com/24684335/187000977-fb877c92-20f2-421d-8720-f28ce1740f0b.png\">\r\n\r\nHey guys, I'm testing some error handling within HardHat and have found that the function `abi.decode(...)` has an unexpected behavior that results in an error message saying that I should report it to HardHat.\r\n\r\nThe code that's causing this is here:\r\n\r\n\r\n```\r\n(bool success, bytes memory data) = callee.call(abi.encodeWithSignature(\"performRevert(bool)\", true));\r\n.\r\n.\r\n.\r\n// an error has occurred, so unpacking the error from the return data (still working on the correct way to do this)\r\n(bytes4 functionSelector, string memory revertReason) = abi.decode(data, (bytes4, string));\r\n```\r\n\r\nMaking this issue because the error reported said it was behavior worth mentioning. If you happen to know how to properly decode the revert error from a reverted call operation, I've been trying to figure this out for a little while and am not sure why this is incorrect, so would appreciate any advice there if you have an idea of how to properly extract the complete string from the return data.\r\n\r\nMy understanding is that the return data from a contract call in Solidity will be: `abi.encodePacked(functionSelector, errMsg)`, but am still struggling to decode this correctly.",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1229029615",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3084#issuecomment-1229029615",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084",
    "id": 1229029615,
    "node_id": "IC_kwDOB7jojM5JQYDv",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-08-26T23:06:10Z",
    "updated_at": "2022-08-26T23:06:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1097/abidecode-results-in-an-error-that-hardhat-cannot-decode-the-reason).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 1331d4e7-e8f3-4a0d-b11f-6e7ad6991125",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1229029615/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1230047351",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3084#issuecomment-1230047351",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084",
    "id": 1230047351,
    "node_id": "IC_kwDOB7jojM5JUQh3",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T09:53:16Z",
    "updated_at": "2022-08-29T09:53:16Z",
    "author_association": "MEMBER",
    "body": "Hi @aaronbuchwald, thanks for reporting this. We should be showing a better error in this case (assuming you have the optimizer disabled, can you confirm that's the case?)\r\n\r\nWith respect to your question:\r\n\r\n> (bytes4 functionSelector, string memory revertReason) = abi.decode(data, (bytes4, string));\r\n\r\nThat won't work. Check [this comment](https://github.com/ethereum/solidity/issues/9439#issuecomment-660039240) for an explanation.\r\n\r\nIf `data` is `bytes calldata`, you can do this instead:\r\n\r\n```solidity\r\nstring memory revertReason = abi.decode(data[:4], (string));\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1230047351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1230428162",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3084#issuecomment-1230428162",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084",
    "id": 1230428162,
    "node_id": "IC_kwDOB7jojM5JVtgC",
    "user": {
      "login": "aaronbuchwald",
      "id": 24684335,
      "node_id": "MDQ6VXNlcjI0Njg0MzM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/24684335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aaronbuchwald",
      "html_url": "https://github.com/aaronbuchwald",
      "followers_url": "https://api.github.com/users/aaronbuchwald/followers",
      "following_url": "https://api.github.com/users/aaronbuchwald/following{/other_user}",
      "gists_url": "https://api.github.com/users/aaronbuchwald/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aaronbuchwald/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aaronbuchwald/subscriptions",
      "organizations_url": "https://api.github.com/users/aaronbuchwald/orgs",
      "repos_url": "https://api.github.com/users/aaronbuchwald/repos",
      "events_url": "https://api.github.com/users/aaronbuchwald/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aaronbuchwald/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T14:57:06Z",
    "updated_at": "2022-08-29T14:57:06Z",
    "author_association": "NONE",
    "body": "Unfortunately the type is `bytes memory` and not `calldata` which has annoying casting errors. I found a workaround to verify that the error is as expected by encoding the expecting error and verifying that the hash of the expected and actual returned data match.\r\n\r\nThanks for the update on this. I am running with the defaults, so don't think the optimizer is enabled. Can you link instructions to confirm this? Happy to double check for you.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1230428162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1230610987",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3084#issuecomment-1230610987",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084",
    "id": 1230610987,
    "node_id": "IC_kwDOB7jojM5JWaIr",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T17:21:54Z",
    "updated_at": "2022-08-29T17:21:54Z",
    "author_association": "MEMBER",
    "body": "Yes, the defaults have the optimizer disabled. Thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1230610987/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1366459467",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3084#issuecomment-1366459467",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3084",
    "id": 1366459467,
    "node_id": "IC_kwDOB7jojM5RcoRL",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-28T08:21:20Z",
    "updated_at": "2022-12-28T08:21:20Z",
    "author_association": "MEMBER",
    "body": "Closing in favor of https://github.com/NomicFoundation/hardhat/issues/3475.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1366459467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
