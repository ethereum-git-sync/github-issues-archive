{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2014",
  "id": 1041578836,
  "node_id": "I_kwDOB7jojM4-FTtU",
  "number": 2014,
  "title": "eth_feeHistory gives error when calling it from web3 (with hardhat local fork)",
  "user": {
    "login": "gndelia",
    "id": 352474,
    "node_id": "MDQ6VXNlcjM1MjQ3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/352474?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gndelia",
    "html_url": "https://github.com/gndelia",
    "followers_url": "https://api.github.com/users/gndelia/followers",
    "following_url": "https://api.github.com/users/gndelia/following{/other_user}",
    "gists_url": "https://api.github.com/users/gndelia/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gndelia/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gndelia/subscriptions",
    "organizations_url": "https://api.github.com/users/gndelia/orgs",
    "repos_url": "https://api.github.com/users/gndelia/repos",
    "events_url": "https://api.github.com/users/gndelia/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gndelia/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-11-01T20:20:20Z",
  "updated_at": "2022-11-18T13:10:46Z",
  "closed_at": "2021-11-05T18:47:05Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "When calling getFeeHistory in my app, using a local fork with hardhat, I get the following error\r\n\r\n```\r\nError: Internal JSON-RPC error.\r\n{\r\n  \"code\": -32602,\r\n  \"message\": \"Errors encountered in param 0: Invalid value 1 supplied to : QUANTITY\"\r\n}\r\n```\r\n\r\n### Expected Behavior\r\n\r\nI expect the proper response of eth_feeHistory, something like\r\n\r\n\r\n```json\r\n{\r\n        \"oldestBlock\": \"0xce1806\",\r\n        \"baseFeePerGas\": [\r\n            \"0x26a51093d0\",\r\n            \"0x2532e26b6d\"\r\n        ],\r\n        \"gasUsedRatio\": [\r\n            0.35032733868710536\r\n        ]\r\n}\r\n```\r\n\r\n### Steps to Reproduce\r\n\r\nfork a hardhat node with \r\n```sh\r\nnpx hardhat node \\\r\n  --fork \"$BASE_NODE_URL\" \\\r\n  --verbose\r\n```\r\n\r\nThis is the very basic config I've used\r\n\r\n```js\r\n'use strict'\r\nrequire('dotenv').config()\r\n\r\nmodule.exports = {\r\n  defaultNetwork: 'hardhat',\r\n  networks: {\r\n    hardhat: {\r\n      accounts: {\r\n        accountsBalance: process.env.WEI_BALANCE || '10000000000000000000000',\r\n        mnemonic: process.env.MNEMONIC\r\n      },\r\n      forking: {\r\n        url: process.env.BASE_NODE_URL,\r\n        blockNumber: process.env.BLOCK_NUMBER\r\n          ? parseInt(process.env.BLOCK_NUMBER)\r\n          : undefined\r\n      }\r\n    },\r\n    mainnet: {\r\n      url: process.env.BASE_NODE_URL,\r\n      chainId: 1\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\n`BASE_NODE_URL` contains an HTTPS URL of a node that supports `eth_feeHistory`.\r\n\r\nThen, from JS, I just do\r\n\r\n```js\r\nconst web3 = new Web3(new Web3.providers.HttpProvider('local-fork-url'))\r\nweb3.eth.getFeeHistory(1, 'latest', []).then(console.log).catch(console.error)\r\n// same problem with\r\n// web3.eth.getFeeHistory('0x1', 'latest', []).then(console.log).catch(console.error)\r\n```\r\n\r\nand I get the above-mentioned error. If instead of pointing out to a local fork I point out to the HTTPS URL directly (without any local fork), it works.\r\n\r\n### Environment\r\n\r\n- Web3.js Version: 1.5.3 (which supports EIP-1559)\r\n- Operating System: Mac OS 11.6\r\n- Browser: Brave\r\n- Node.js Version: 14.16.1\r\n- NPM Version: 6.14.32\r\n\r\n\r\nThere's a counterpart of this issue in web3js repo https://github.com/ChainSafe/web3.js/issues/4510 but it seems they believe the problem is within hardhat",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/962133445",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2014#issuecomment-962133445",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014",
    "id": 962133445,
    "node_id": "IC_kwDOB7jojM45WP3F",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-05T18:47:05Z",
    "updated_at": "2021-11-05T18:47:05Z",
    "author_association": "MEMBER",
    "body": "Hey @gndelia, thanks for reporting this! I'm pretty sure this is a problem in web3; see my comment in the issue you opened there. I'm going to tentatively close this, but I'll re-open it if I was wrong and this is actually a problem on our side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/962133445/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/962137154",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2014#issuecomment-962137154",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014",
    "id": 962137154,
    "node_id": "IC_kwDOB7jojM45WQxC",
    "user": {
      "login": "gndelia",
      "id": 352474,
      "node_id": "MDQ6VXNlcjM1MjQ3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/352474?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gndelia",
      "html_url": "https://github.com/gndelia",
      "followers_url": "https://api.github.com/users/gndelia/followers",
      "following_url": "https://api.github.com/users/gndelia/following{/other_user}",
      "gists_url": "https://api.github.com/users/gndelia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gndelia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gndelia/subscriptions",
      "organizations_url": "https://api.github.com/users/gndelia/orgs",
      "repos_url": "https://api.github.com/users/gndelia/repos",
      "events_url": "https://api.github.com/users/gndelia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gndelia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-05T18:53:20Z",
    "updated_at": "2021-11-05T18:53:20Z",
    "author_association": "NONE",
    "body": "Thanks for your response @fvictorio  ! I tried to find the spec before opening the tickets in both repos but I failed to find them. Thanks for the help! ðŸš€ ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/962137154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/962138193",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2014#issuecomment-962138193",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2014",
    "id": 962138193,
    "node_id": "IC_kwDOB7jojM45WRBR",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-05T18:55:02Z",
    "updated_at": "2021-11-05T18:55:02Z",
    "author_association": "MEMBER",
    "body": "Yes, those specs are fairly new and not that well-known (yet!), but it's what we are following (and hopefully the rest of the ecosystem too :sweat_smile:)",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/962138193/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
