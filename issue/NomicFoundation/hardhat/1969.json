{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969",
  "id": 1031343382,
  "node_id": "I_kwDOB7jojM49eQ0W",
  "number": 1969,
  "title": "`HARDHAT_TESTS_SOLC_PATH` does not work with absolute paths",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-10-20T12:20:24Z",
  "updated_at": "2022-11-18T13:10:53Z",
  "closed_at": "2021-10-21T18:09:04Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I'm working on https://github.com/ethereum/solidity/issues/10854 to run Hardhat's test suite as a part of Solidity CI. The problem I encountered is that when I specify an absolute path to the compiler binary in `HARDHAT_TESTS_SOLC_PATH`, Hardhat still uses it as if it was relative to the directory where it keeps downloaded compiler binaries. The resulting path does not exist and hardhat tries to download the binary from solc-bin, which fails too because that path's not on the server either.\r\n\r\nThis looks like a bug to me because the original instructions in the issue included an absolute path as an example. Also, I would like to stop Hardhat from trying to download the compiler automatically because I want to be sure that the binary I give it is the only one it could be using. Automatic download could easily hide potential problems by testing the wrong binary.\r\n\r\n### Details\r\n```bash\r\ncurl https://binaries.soliditylang.org/bin/soljson-v0.8.4+commit.c7e474f2.js -L -o /tmp/soljson.js\r\ngit clone --depth 1 https://github.com/nomiclabs/hardhat.git\r\ncd hardhat\r\nyarn\r\nyarn build\r\n\r\ncd packages/hardhat-core/\r\nHARDHAT_TESTS_SOLC_VERSION=\"0.8.4\" \\\r\nHARDHAT_TESTS_SOLC_PATH=\"/tmp/soljson.js\" \\\r\nyarn test\r\n```\r\nRelevant parts of the output:\r\n```\r\n  Stack traces\r\n    Use compiler at /tmp/soljson.js with version 0.8.4\r\n```\r\n```\r\n  0 passing (23s)\r\n  5 pending\r\n  253 failing\r\n\r\n  1) Stack traces\r\n       Use compiler at /tmp/soljson.js with version 0.8.4\r\n         0_8\r\n           abi-v2\r\n             call-failing-function\r\n               Without optimizations\r\n                 test-files/0_8/abi-v2/call-failing-function:\r\n     Error: Failed to download https://solc-bin.ethereum.org/bin//tmp/soljson.js - Not Found received\r\n      at Object.download (src/internal/util/download.ts:55:9)\r\n      at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n      at downloadSolc (test/internal/hardhat-network/stack-traces/compilation.ts:110:3)\r\n      at getSolc (test/internal/hardhat-network/stack-traces/compilation.ts:114:3)\r\n      at compile (test/internal/hardhat-network/stack-traces/compilation.ts:127:16)\r\n      at compileIfNecessary (test/internal/hardhat-network/stack-traces/test.ts:237:43)\r\n      at runTest (test/internal/hardhat-network/stack-traces/test.ts:408:43)\r\n      at Context.func (test/internal/hardhat-network/stack-traces/test.ts:136:5)\r\n```\r\n\r\n### Workaround\r\nMy current workaround is to create a symlink to the binary in `packages/hardhat-core/test/internal/hardhat-network/stack-traces/compilers` and put only the file name in the variable.",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947642365",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969#issuecomment-947642365",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
    "id": 947642365,
    "node_id": "IC_kwDOB7jojM44e9_9",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T13:00:48Z",
    "updated_at": "2021-10-20T13:00:48Z",
    "author_association": "MEMBER",
    "body": "Thanks for working on this, @cameel!\r\n\r\nWe made a few changes to our tests, and didn't realize that we broke that. We'll fix it soon.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947642365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947648670",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969#issuecomment-947648670",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
    "id": 947648670,
    "node_id": "IC_kwDOB7jojM44e_ie",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T13:07:35Z",
    "updated_at": "2021-10-20T13:07:35Z",
    "author_association": "NONE",
    "body": "Great! Fortunately the workaround does help so we can run with that until a fix is released.\r\n\r\nI already managed to run tests in CI and I see [two failing](https://app.circleci.com/pipelines/github/ethereum/solidity/19877/workflows/a8840c31-1a7a-4047-9914-2221c1191c10/jobs/879015) on the latest binary but looks like you already have a PR fixing that (#1962) so hopefully we'll have that running on our side pretty soon. On 0.8.4 all tests pass.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/947648670/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948511332",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969#issuecomment-948511332",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
    "id": 948511332,
    "node_id": "IC_kwDOB7jojM44iSJk",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T11:19:37Z",
    "updated_at": "2021-10-21T11:19:37Z",
    "author_association": "NONE",
    "body": "One more thing (slightly related): the [`run-tests-with-custom-solc.sh`](https://github.com/nomiclabs/hardhat/blob/master/scripts/run-tests-with-custom-solc.sh) script seems to be missing a `yarn build` invocation. Without it I get an exception due to a problem with a relative import somewhere deep in the package.\r\n\r\nI'm not reporting it as a separate issue because I'm not sure if it makes sense to fix it. The script is pretty simple and in our CI I just repeated the relevant commands - this way I can have dependency installation and actual tests as separate steps. So it was useful as way to tell us what specifically to run but I don't think we'll be using it after that.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948511332/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948621980",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969#issuecomment-948621980",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
    "id": 948621980,
    "node_id": "IC_kwDOB7jojM44itKc",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T13:32:37Z",
    "updated_at": "2021-10-21T13:32:37Z",
    "author_association": "MEMBER",
    "body": "That import is wrong. I'll fix it.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948621980/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948633227",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969#issuecomment-948633227",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
    "id": 948633227,
    "node_id": "IC_kwDOB7jojM44iv6L",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T13:45:20Z",
    "updated_at": "2021-10-21T13:45:20Z",
    "author_association": "MEMBER",
    "body": "Update: fixed in #1974",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948633227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948862727",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1969#issuecomment-948862727",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1969",
    "id": 948862727,
    "node_id": "IC_kwDOB7jojM44jn8H",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T17:49:04Z",
    "updated_at": "2021-10-21T17:49:04Z",
    "author_association": "NONE",
    "body": "Nice. I'll get rid of the `yarn build` step then.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/948862727/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
