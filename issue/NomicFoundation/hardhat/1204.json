{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1204",
  "id": 794191620,
  "node_id": "MDU6SXNzdWU3OTQxOTE2MjA=",
  "number": 1204,
  "title": "Weird behavior for default hardhat account on mainnet fork",
  "user": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/milestones/3",
    "html_url": "https://github.com/NomicFoundation/hardhat/milestone/3",
    "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/milestones/3/labels",
    "id": 6412213,
    "node_id": "MDk6TWlsZXN0b25lNjQxMjIxMw==",
    "number": 3,
    "title": "hardhat-core@2.0.10",
    "description": null,
    "creator": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 9,
    "state": "closed",
    "created_at": "2021-02-09T15:14:05Z",
    "updated_at": "2021-02-12T13:13:26Z",
    "due_on": null,
    "closed_at": "2021-02-12T13:13:26Z"
  },
  "comments": 3,
  "created_at": "2021-01-26T12:26:18Z",
  "updated_at": "2022-11-18T19:00:46Z",
  "closed_at": "2021-02-12T12:52:55Z",
  "author_association": "MEMBER",
  "active_lock_reason": "resolved",
  "body": "Brace yourselves, this is a weird bug.\r\n\r\n---\r\n\r\nReproduction steps:\r\n\r\n1. Clone `https://github.com/NexusMutual/smart-contracts`\r\n2. `git checkout e2326ecb9f448a42eef7ed31be016315c807b445`\r\n3. `cp .env.sample .env` and fill `.env` with some valid private key and address (they aren't used for this, but are needed for validation)\r\n4. `npm install`\r\n5. Modify the forking config to use block `11727485`\r\n6. Run `TEST_ENV_FORK=<some-archive-node> hh test test/fork/price-function --show-stack-traces`\r\n\r\nA test will fail when trying to deploy a contract (`TwapOracle`).\r\n\r\nThere are three ways to make this test pass:\r\n\r\n- Run the same command but add `HH_BUG_WORKAROUND=1`. This will make the test send two no-op transactions before deploying that contract, and then it will work.\r\n- Change the fork block number to an older one. I used 11500685.\r\n- Use a different mnemonic for the generated accounts.\r\n\r\nThis points towards a problem on how we handle the generated accounts. Since the first account has some mainnet activity, there might be something wrong on how we get our information about that account during a fork (it might be the nonce, the balance, or something else). Ideally we would completely ignore *everything* about the generated accounts on mainnet, so double checking that assumption seems like a good place to start.\r\n\r\ncc @shark0der",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/768815311",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1204#issuecomment-768815311",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204",
    "id": 768815311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2ODgxNTMxMQ==",
    "user": {
      "login": "scnale",
      "id": 12967987,
      "node_id": "MDQ6VXNlcjEyOTY3OTg3",
      "avatar_url": "https://avatars.githubusercontent.com/u/12967987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/scnale",
      "html_url": "https://github.com/scnale",
      "followers_url": "https://api.github.com/users/scnale/followers",
      "following_url": "https://api.github.com/users/scnale/following{/other_user}",
      "gists_url": "https://api.github.com/users/scnale/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/scnale/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/scnale/subscriptions",
      "organizations_url": "https://api.github.com/users/scnale/orgs",
      "repos_url": "https://api.github.com/users/scnale/repos",
      "events_url": "https://api.github.com/users/scnale/events{/privacy}",
      "received_events_url": "https://api.github.com/users/scnale/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T05:45:49Z",
    "updated_at": "2021-01-28T05:45:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "I found this issue as well while testing out the fork mechanism on the Kovan testnet. Using the first account reverted the deploy transaction, so I tried with the third account and that did work.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/768815311/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/770021064",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1204#issuecomment-770021064",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204",
    "id": 770021064,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3MDAyMTA2NA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-29T20:04:43Z",
    "updated_at": "2021-01-29T20:04:43Z",
    "author_association": "MEMBER",
    "body": "Easier way to reproduce this:\r\n\r\n1. Create the sample project\r\n2. Fork kovan (when #1207 is ready, or in that branch). Block `23215000` reproduces the problem.\r\n3. Run the sample script on that fork",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/770021064/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/778177991",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1204#issuecomment-778177991",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1204",
    "id": 778177991,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODE3Nzk5MQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-12T12:52:55Z",
    "updated_at": "2021-02-12T12:53:01Z",
    "author_association": "MEMBER",
    "body": "Fixed in 2.0.10.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/778177991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
