{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202",
  "id": 1380968350,
  "node_id": "I_kwDOB7jojM5ST-ee",
  "number": 3202,
  "title": "bug: cannot run hardhat coverage after upgrade to Hardhat 2.11.2",
  "user": {
    "login": "gabririgo",
    "id": 12066256,
    "node_id": "MDQ6VXNlcjEyMDY2MjU2",
    "avatar_url": "https://avatars.githubusercontent.com/u/12066256?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gabririgo",
    "html_url": "https://github.com/gabririgo",
    "followers_url": "https://api.github.com/users/gabririgo/followers",
    "following_url": "https://api.github.com/users/gabririgo/following{/other_user}",
    "gists_url": "https://api.github.com/users/gabririgo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gabririgo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gabririgo/subscriptions",
    "organizations_url": "https://api.github.com/users/gabririgo/orgs",
    "repos_url": "https://api.github.com/users/gabririgo/repos",
    "events_url": "https://api.github.com/users/gabririgo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gabririgo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-09-21T13:49:19Z",
  "updated_at": "2022-12-27T00:14:03Z",
  "closed_at": "2022-09-27T08:57:55Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "<!--\r\n\r\nThank you for using Hardhat and taking the time to open an issue!\r\n\r\n**Note that this issue tracker is not a support channel.**\r\n\r\n- For help with Hardhat and Hardhat network, please use our [Discord server](https://hardhat.org/discord).\r\n- For help with ethers.js, please go to [its Github Discussions](https://github.com/ethers-io/ethers.js/discussions).\r\n\r\nIf you are reporting a bug, please include reproduction steps. The best way to do this is to include a [Minimal Reproducible Example](https://stackoverflow.com/help/minimal-reproducible-example). If you can't do that, then include a link to your repo, and the steps to reproduce the problem. The easiest it is to reproduce your problem, the faster we are going to be able to fix it.\r\n\r\nIf you are submitting a feature request, please take the time to clearly describe your use case, and not only your proposed solution.\r\n\r\nThis issue will be automatically assigned to a Hardhat team member. This person will act as the point of contact between you and the team, but won't necessarily fix it nor address it in any way. An issue being assigned does not mean that it's being worked on.\r\n\r\n-->\r\nAfter upgrading project from hardhat v2.2.1 to v 2.11.2 and solidity-coverage from v.0.7.17 to 0.8.2 I receive the following error when running hardhat coverage:\r\n\r\n`Unknown key \"inliner\"`\r\n\r\noption `inliner` is not recognized as a valid `solcOptimizerDetails` param.\r\nThe project needs code optimization otherwise won't compile with hardhat.\r\nin fact, while contracts compile with hardhat compile (uses optimizer in solidity settings), when running hardhat coverage the contract does not compile:\r\n`CompilerError: Stack too deep when compiling inline assembly: Variable headStart is 1 slot(s) too deep inside the stack.\r\n`\r\n`\r\n[Sample for replication](https://github.com/RigoBlock/v3-contracts/tree/build/upgrade-hardhat)\r\n",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1253740967",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1253740967",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
    "id": 1253740967,
    "node_id": "IC_kwDOB7jojM5KupGn",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-09-21T13:49:38Z",
    "updated_at": "2022-09-21T13:49:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1198/bug-regport-cannot-compile-project-after-upgrade-to-hardhat-2112).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 4faf121f-08a1-4637-b242-95d20691d750",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1253740967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1253772194",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1253772194",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
    "id": 1253772194,
    "node_id": "IC_kwDOB7jojM5Kuwui",
    "user": {
      "login": "gabririgo",
      "id": 12066256,
      "node_id": "MDQ6VXNlcjEyMDY2MjU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/12066256?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gabririgo",
      "html_url": "https://github.com/gabririgo",
      "followers_url": "https://api.github.com/users/gabririgo/followers",
      "following_url": "https://api.github.com/users/gabririgo/following{/other_user}",
      "gists_url": "https://api.github.com/users/gabririgo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gabririgo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gabririgo/subscriptions",
      "organizations_url": "https://api.github.com/users/gabririgo/orgs",
      "repos_url": "https://api.github.com/users/gabririgo/repos",
      "events_url": "https://api.github.com/users/gabririgo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gabririgo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-21T14:12:32Z",
    "updated_at": "2022-09-21T14:12:32Z",
    "author_association": "NONE",
    "body": "running command `hardhat test --verbose` returns an error:\r\n`hardhat:core:hardhat-network:node Could not generate stack trace. Please report this to help us improve Hardhat.\r\n  hardhat:core:hardhat-network:node  TypeError: Cannot use 'in' operator to search for 'pc' in undefined\r\n    at isEvmStep (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/message-trace.ts:88:14)\r\n    at ErrorInferrer._isConstructorInvalidArgumentsError (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:978:19)\r\n    at ErrorInferrer.inferBeforeTracingCreateMessage (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:139:14)\r\n    at SolidityTracer._getCreateMessageStackTrace (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:136:27)\r\n    at SolidityTracer.getStackTrace (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:50:19)\r\n    at SolidityTracer._rawTraceEvmExecution (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:211:38)\r\n    at SolidityTracer._traceEvmExecution (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:159:29)\r\n    at SolidityTracer._getCallMessageStackTrace (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:70:17)\r\n    at SolidityTracer.getStackTrace (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:54:19)\r\n    at HardhatNode._manageErrors (/home/gabriele/v3-contracts/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1925:41)`\r\n\r\nand process ends with \r\n`Failed to generate 1 stack trace. Run Hardhat with --verbose to learn more.`\r\n` hardhat:core:cli Killing Hardhat after successfully running task test +0ms`",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1253772194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1254989467",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1254989467",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
    "id": 1254989467,
    "node_id": "IC_kwDOB7jojM5KzZ6b",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-22T13:00:03Z",
    "updated_at": "2022-09-22T13:00:03Z",
    "author_association": "MEMBER",
    "body": "@gabririgo can you give me precise reproduction steps? I tried the repo you shared, but the config file seems to assume there are some environment variables set.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1254989467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1254996423",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1254996423",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
    "id": 1254996423,
    "node_id": "IC_kwDOB7jojM5KzbnH",
    "user": {
      "login": "gabririgo",
      "id": 12066256,
      "node_id": "MDQ6VXNlcjEyMDY2MjU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/12066256?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gabririgo",
      "html_url": "https://github.com/gabririgo",
      "followers_url": "https://api.github.com/users/gabririgo/followers",
      "following_url": "https://api.github.com/users/gabririgo/following{/other_user}",
      "gists_url": "https://api.github.com/users/gabririgo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gabririgo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gabririgo/subscriptions",
      "organizations_url": "https://api.github.com/users/gabririgo/orgs",
      "repos_url": "https://api.github.com/users/gabririgo/repos",
      "events_url": "https://api.github.com/users/gabririgo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gabririgo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-22T13:05:49Z",
    "updated_at": "2022-09-22T13:06:04Z",
    "author_association": "NONE",
    "body": "@fvictorio to run the repo, a file .env must be created and contain\r\n`SOLIDITY_VERSION=\"\"`\r\n`SOLIDITY_SETTINGS=\"{\"optimizer\":{\"enabled\":true,\"runs\":1000}}\"`\r\nsecond line is requred, first line not required if solidity version specified in hardhat config file.\r\n\r\nI will look into providing a working example, however, the way I see you can reproduce is by adding a config spec in any project that uses hardhat, i.e. in the .solcover.js file add following config:\r\n`\r\nconfigureYulOptimizer: true,\r\n    solcOptimizerDetails: {\r\n      peephole: false,\r\n      inliner: false,\r\n      jumpdestRemover: false,\r\n      orderLiterals: true,\r\n      deduplicate: false,\r\n      cse: false,\r\n      constantOptimizer: false,\r\n      yul: false\r\n    }\r\n`\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1254996423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1259198634",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1259198634",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
    "id": 1259198634,
    "node_id": "IC_kwDOB7jojM5LDdiq",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-27T08:57:55Z",
    "updated_at": "2022-09-27T08:57:55Z",
    "author_association": "MEMBER",
    "body": "Thanks @gabririgo, I was able to reproduce it now. I believe this is something that belongs to the solidity-coverage repo, and I see that you've already opened [an issue](https://github.com/sc-forks/solidity-coverage/issues/752) there. I'm going to close this for the time being, but please let me know if there's something we can do on our side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1259198634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1259276200",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1259276200",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3202",
    "id": 1259276200,
    "node_id": "IC_kwDOB7jojM5LDweo",
    "user": {
      "login": "gabririgo",
      "id": 12066256,
      "node_id": "MDQ6VXNlcjEyMDY2MjU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/12066256?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gabririgo",
      "html_url": "https://github.com/gabririgo",
      "followers_url": "https://api.github.com/users/gabririgo/followers",
      "following_url": "https://api.github.com/users/gabririgo/following{/other_user}",
      "gists_url": "https://api.github.com/users/gabririgo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gabririgo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gabririgo/subscriptions",
      "organizations_url": "https://api.github.com/users/gabririgo/orgs",
      "repos_url": "https://api.github.com/users/gabririgo/repos",
      "events_url": "https://api.github.com/users/gabririgo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gabririgo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-27T10:03:40Z",
    "updated_at": "2022-09-27T10:36:17Z",
    "author_association": "NONE",
    "body": "sure, I reverted to hardhat upgrade package (which requres solidity-coverage upgrade), and get[ previously mentioned](https://github.com/NomicFoundation/hardhat/issues/3202#issuecomment-1253772194) error. I guess the new version of solidity-coverage is producing the issue. Please note also hardhat-deploy suffers from same bug, as in [this PR](https://github.com/RigoBlock/v3-contracts/pull/112) generated by dependabot version upgrades.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1259276200/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
