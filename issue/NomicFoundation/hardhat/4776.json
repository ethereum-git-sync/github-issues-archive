{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4776",
  "id": 2091558330,
  "node_id": "I_kwDOB7jojM58qqW6",
  "number": 4776,
  "title": "Unrelated Etherscan verification message appears when verifying with a custom Sourcify instance",
  "user": {
    "login": "acuarica",
    "id": 4592980,
    "node_id": "MDQ6VXNlcjQ1OTI5ODA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4592980?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/acuarica",
    "html_url": "https://github.com/acuarica",
    "followers_url": "https://api.github.com/users/acuarica/followers",
    "following_url": "https://api.github.com/users/acuarica/following{/other_user}",
    "gists_url": "https://api.github.com/users/acuarica/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/acuarica/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/acuarica/subscriptions",
    "organizations_url": "https://api.github.com/users/acuarica/orgs",
    "repos_url": "https://api.github.com/users/acuarica/repos",
    "events_url": "https://api.github.com/users/acuarica/events{/privacy}",
    "received_events_url": "https://api.github.com/users/acuarica/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2024-01-19T22:38:29Z",
  "updated_at": "2024-01-30T03:43:28Z",
  "closed_at": "2024-01-29T14:54:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.19.4\r\n\r\n### What happened?\r\n\r\n> It's not a bug in the sense that's something is not working properly. It is an unrelated error message which might be misleading to the user.\r\n\r\nI'm working on the verification service for the Hedera network, which uses a custom instance of Sourcify. I wanted to validate that the `hardhat-verify` plugin works with our instance. It works well, but the `verify` task shows an unrelated _Etherscan_ error message. \r\n\r\nI created a new project, configure it with Hedera testnet, and deploy the sample contract. When I want to verify it with the `hardhat-verify` plugin, I got the following output\r\n```console\r\n$ npx hardhat verify --network testnet <CONTRACT_ADDR>\r\nSuccessfully verified contract Lock on Sourcify.\r\nhttps://repository-verify.hashscan.io/contracts/full_match/296/<CONTRACT_ADDR>/\r\nhardhat-verify found one or more errors during the verification process:\r\n\r\nEtherscan:\r\nTrying to verify a contract in a network with chain id 296, but the plugin doesn't recognize it as a supported chain.\r\n\r\nYou can manually add support for it by following these instructions: https://hardhat.org/verify-custom-networks\r\n\r\nTo see the list of supported networks, run this command:\r\n\r\n  npx hardhat verify --list-networks\r\n```\r\n\r\nI expected the first part of the output, but the Etherscan message seems unrelated.\r\n\r\n### Minimal reproduction steps\r\n\r\nCreate a new Hardhat project, install its dependencies and use the following `hardhat.config.js`\r\n\r\n```js\r\nrequire(\"@nomicfoundation/hardhat-toolbox\");\r\n\r\n/** @type import('hardhat/config').HardhatUserConfig */\r\nmodule.exports = {\r\n  solidity: \"0.8.19\",\r\n  networks: {\r\n    testnet: {\r\n      url: 'https://testnet.hashio.io/api',\r\n      accounts: [\"<your private key, go to https://portal.hedera.com/ to setup one>\"],\r\n      chainId: 296,\r\n    },\r\n  },\r\n  sourcify: {\r\n    enabled: true,\r\n    apiUrl: \"https://server-verify.hashscan.io\",\r\n    browserUrl: \"https://repository-verify.hashscan.io\",\r\n  }\r\n};\r\n```\r\n\r\nThen run\r\n\r\n```console\r\nnpx hardhat run --network testnet scripts/deploy.js\r\nnpx hardhat verify --network testnet <CONTRACT_ADDR>\r\n```\r\n\r\nVerification in the custom Sourcify instance works well, but an unrelated Etherscan error message is displayed.\r\n\r\n### Search terms\r\n\r\nverify hardhat-verify hedera sourcify etherscan",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1914860689",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4776#issuecomment-1914860689",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776",
    "id": 1914860689,
    "node_id": "IC_kwDOB7jojM5yInSR",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-29T14:54:45Z",
    "updated_at": "2024-01-29T14:54:45Z",
    "author_association": "MEMBER",
    "body": "Hey @acuarica, what's going on here is that Etherscan is enabled by default (and Sourcify is disabled by default). If you want to only use Sourcify, then you need to explicitly disable Etherscan:\r\n\r\n```js\r\netherscan: {\r\n  enabled: false,\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1914860689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1915996510",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4776#issuecomment-1915996510",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776",
    "id": 1915996510,
    "node_id": "IC_kwDOB7jojM5yM8le",
    "user": {
      "login": "bguiz",
      "id": 1773785,
      "node_id": "MDQ6VXNlcjE3NzM3ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1773785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bguiz",
      "html_url": "https://github.com/bguiz",
      "followers_url": "https://api.github.com/users/bguiz/followers",
      "following_url": "https://api.github.com/users/bguiz/following{/other_user}",
      "gists_url": "https://api.github.com/users/bguiz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bguiz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bguiz/subscriptions",
      "organizations_url": "https://api.github.com/users/bguiz/orgs",
      "repos_url": "https://api.github.com/users/bguiz/repos",
      "events_url": "https://api.github.com/users/bguiz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bguiz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-30T03:12:36Z",
    "updated_at": "2024-01-30T03:29:16Z",
    "author_association": "NONE",
    "body": "@fvictorio this appears to work when I run from CLI (thanks!) but not when I run programmatically\r\n> If you want to only use Sourcify, then you need to explicitly disable Etherscan\r\n\r\n❓ is there a way to disable `etherscan` when invoking `hre.run('verify:verify', ...);` as well?\r\n\r\n\r\n```text\r\n\r\n/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/@nomicfoundation/hardhat-verify/src/internal/etherscan.ts:67\r\n      throw new ChainConfigNotFoundError(currentChainId);\r\n            ^\r\nChainConfigNotFoundError: Trying to verify a contract in a network with chain id 296, but the plugin doesn't recognize it as a supported chain.\r\n\r\nYou can manually add support for it by following these instructions: https://hardhat.org/verify-custom-networks\r\n\r\nTo see the list of supported networks, run this command, here is the stack trace:\r\n\r\n  npx hardhat verify --list-networks\r\n    at Function.getCurrentChainConfig (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/@nomicfoundation/hardhat-verify/src/internal/etherscan.ts:67:13)\r\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at SimpleTaskDefinition.action (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/@nomicfoundation/hardhat-verify/src/internal/tasks/etherscan.ts:91:25)\r\n    at Environment._runTaskDefinition (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/hardhat/src/internal/core/runtime-environment.ts:358:14)\r\n    at Environment.run (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/hardhat/src/internal/core/runtime-environment.ts:191:14)\r\n    at SimpleTaskDefinition.action (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/@nomicfoundation/hardhat-verify/src/index.ts:285:7)\r\n    at Environment._runTaskDefinition (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/hardhat/src/internal/core/runtime-environment.ts:358:14)\r\n    at Environment.run (/Users/user/code/hedera/hedera-tokens/erc20-hardhat/node_modules/hardhat/src/internal/core/runtime-environment.ts:191:14)\r\n    at file:///Users/user/code/hedera/hedera-tokens/erc20-hardhat/scripts/verify.js:17:13\r\n```\r\n\r\nand for reference, here's the hardhat config used:\r\n\r\n```js\r\n\r\nconst hardhatConfig = {\r\n  solidity: {\r\n    version: '0.8.20',\r\n    settings: {\r\n      optimizer: {\r\n        enabled: true,\r\n        runs: 200,\r\n      },\r\n    },\r\n  },\r\n  networks: {\r\n    hardhat: {\r\n      accounts,\r\n    },\r\n    hederatestnet: {\r\n      chainId: 296,\r\n      url: rpcUrlHederatestnet,\r\n      gasMultiplier: 1.1,\r\n      accounts,\r\n    },\r\n  },\r\n  sourcify: {\r\n    enabled: true,\r\n    apiUrl: 'https://server-verify.hashscan.io',\r\n    browserUrl: 'https://repository-verify.hashscan.io',\r\n  },\r\n  etherscan: {\r\n    enabled: false,\r\n  },\r\n  mocha: {\r\n    timeout: 6_000_000,\r\n  },\r\n};\r\n```\r\n\r\nand the code used within `scripts/verify.js` to programmatically invoke verification:\r\n\r\n```js\r\n            await hre.run('verify:verify', {\r\n                address: deployedAddress,\r\n            });\r\n```\r\n\r\nNote that if I replace the above `hre.run` invocation with the lines of code below, it succeeds.\r\n(I'm ruling out possible unrelated errors introduced by my own verify script.)\r\nSo it seems that `hre.run` is ignoring the `hardhatConfig.etherscan.enabled` config value,\r\nbut the CLI invocation (via `npx hardhat` actually reads and uses that same config value.\r\n\r\n```js\r\n            const shellExecStr = `npx hardhat verify --network \"${hre.network.name}\" \"${deployedAddress}\"`;\r\n            const { stdout, stderr } = await childProcessExecAsPromise(shellExecStr);\r\n            console.log(stdout);\r\n            console.error(stderr);\r\n```\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1915996510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1916015162",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4776#issuecomment-1916015162",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776",
    "id": 1916015162,
    "node_id": "IC_kwDOB7jojM5yNBI6",
    "user": {
      "login": "bguiz",
      "id": 1773785,
      "node_id": "MDQ6VXNlcjE3NzM3ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1773785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bguiz",
      "html_url": "https://github.com/bguiz",
      "followers_url": "https://api.github.com/users/bguiz/followers",
      "following_url": "https://api.github.com/users/bguiz/following{/other_user}",
      "gists_url": "https://api.github.com/users/bguiz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bguiz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bguiz/subscriptions",
      "organizations_url": "https://api.github.com/users/bguiz/orgs",
      "repos_url": "https://api.github.com/users/bguiz/repos",
      "events_url": "https://api.github.com/users/bguiz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bguiz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-30T03:37:09Z",
    "updated_at": "2024-01-30T03:43:28Z",
    "author_association": "NONE",
    "body": "Self answering my previous question:\r\n> ❓ is there a way to disable etherscan when invoking hre.run('verify:verify', ...); as well?\r\n\r\nOn a lark, I tried `verify:sourcify` as the task name instead of `verify:verify`... and it worked!\r\n\r\n```js\r\n            await hre.run('verify:sourcify', {\r\n                address: deployedAddress,\r\n            });\r\n```\r\n\r\nSo it looks like the remedy will likely need to be some combination of the following:\r\n\r\n- Update the docs at https://hardhat.org/hardhat-runner/plugins/nomicfoundation-hardhat-verify to spell out the difference between the main task and the subtasks provided by the verify plugin (`verify:verify`, `verify:sourcify`, etc)\r\n- Update the implementation of the `verify:verify` task such that it checks `hardhatConfig.VERIFY_TARGET.enabled` before invoking each `verify:VERIFY_TARGET` subtask.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1916015162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1916016246",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4776#issuecomment-1916016246",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4776",
    "id": 1916016246,
    "node_id": "IC_kwDOB7jojM5yNBZ2",
    "user": {
      "login": "bguiz",
      "id": 1773785,
      "node_id": "MDQ6VXNlcjE3NzM3ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1773785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bguiz",
      "html_url": "https://github.com/bguiz",
      "followers_url": "https://api.github.com/users/bguiz/followers",
      "following_url": "https://api.github.com/users/bguiz/following{/other_user}",
      "gists_url": "https://api.github.com/users/bguiz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bguiz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bguiz/subscriptions",
      "organizations_url": "https://api.github.com/users/bguiz/orgs",
      "repos_url": "https://api.github.com/users/bguiz/repos",
      "events_url": "https://api.github.com/users/bguiz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bguiz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-30T03:38:38Z",
    "updated_at": "2024-01-30T03:38:38Z",
    "author_association": "NONE",
    "body": "\r\n@fvictorio do you want me to open a new/separate github issue for the programmatic thing described above?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1916016246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
