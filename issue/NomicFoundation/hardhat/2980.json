{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980",
  "id": 1313791073,
  "node_id": "I_kwDOB7jojM5OTtxh",
  "number": 2980,
  "title": "Nested calls to loadFixture() do not always work",
  "user": {
    "login": "m1cm1c",
    "id": 11382432,
    "node_id": "MDQ6VXNlcjExMzgyNDMy",
    "avatar_url": "https://avatars.githubusercontent.com/u/11382432?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/m1cm1c",
    "html_url": "https://github.com/m1cm1c",
    "followers_url": "https://api.github.com/users/m1cm1c/followers",
    "following_url": "https://api.github.com/users/m1cm1c/following{/other_user}",
    "gists_url": "https://api.github.com/users/m1cm1c/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/m1cm1c/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/m1cm1c/subscriptions",
    "organizations_url": "https://api.github.com/users/m1cm1c/orgs",
    "repos_url": "https://api.github.com/users/m1cm1c/repos",
    "events_url": "https://api.github.com/users/m1cm1c/events{/privacy}",
    "received_events_url": "https://api.github.com/users/m1cm1c/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2022-07-21T20:55:08Z",
  "updated_at": "2022-12-09T00:14:38Z",
  "closed_at": "2022-08-11T08:39:55Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "When passing a function to `loadFixture()` that itself calls `loadFixture()`, this sometimes fails with an error message saying that loaded fixtures are not supported. This happens especially often if nesting more than once.\r\n\r\n```\r\n     FixtureSnapshotError: There was an error reverting the snapshot of the fixture.\r\n\r\nThis might be caused by using nested loadFixture calls in a test, for example by using multiple beforeEach calls. This is not supported yet.\r\n      at loadFixture (node_modules/@nomicfoundation/hardhat-network-helpers/src/loadFixture.ts:47:15)\r\n      at runMicrotasks (<anonymous>)\r\n      at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n      at async recoverViaDistributor (test/Wallet2.ts:111:9)\r\n```",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980/reactions",
    "total_count": 3,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 3,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1191925996",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1191925996",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1191925996,
    "node_id": "IC_kwDOB7jojM5HC1js",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-21T20:55:38Z",
    "updated_at": "2022-07-21T20:55:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-986/nested-calls-to-loadfixture-do-not-always-work).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 8b4add10-05ff-4ebc-bb1a-abba664fa085",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1191925996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1191926374",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1191926374",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1191926374,
    "node_id": "IC_kwDOB7jojM5HC1pm",
    "user": {
      "login": "m1cm1c",
      "id": 11382432,
      "node_id": "MDQ6VXNlcjExMzgyNDMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11382432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/m1cm1c",
      "html_url": "https://github.com/m1cm1c",
      "followers_url": "https://api.github.com/users/m1cm1c/followers",
      "following_url": "https://api.github.com/users/m1cm1c/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1cm1c/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/m1cm1c/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1cm1c/subscriptions",
      "organizations_url": "https://api.github.com/users/m1cm1c/orgs",
      "repos_url": "https://api.github.com/users/m1cm1c/repos",
      "events_url": "https://api.github.com/users/m1cm1c/events{/privacy}",
      "received_events_url": "https://api.github.com/users/m1cm1c/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-21T20:56:05Z",
    "updated_at": "2022-07-21T20:56:05Z",
    "author_association": "NONE",
    "body": "I propose a simple way of circumventing this issue in #2981.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1191926374/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1207329786",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1207329786",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1207329786,
    "node_id": "IC_kwDOB7jojM5H9mP6",
    "user": {
      "login": "faces-of-eth",
      "id": 108703161,
      "node_id": "U_kgDOBnqtuQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/108703161?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/faces-of-eth",
      "html_url": "https://github.com/faces-of-eth",
      "followers_url": "https://api.github.com/users/faces-of-eth/followers",
      "following_url": "https://api.github.com/users/faces-of-eth/following{/other_user}",
      "gists_url": "https://api.github.com/users/faces-of-eth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/faces-of-eth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/faces-of-eth/subscriptions",
      "organizations_url": "https://api.github.com/users/faces-of-eth/orgs",
      "repos_url": "https://api.github.com/users/faces-of-eth/repos",
      "events_url": "https://api.github.com/users/faces-of-eth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/faces-of-eth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-07T04:37:43Z",
    "updated_at": "2022-08-07T04:37:43Z",
    "author_association": "NONE",
    "body": "Running into this as well. Even if all \"describe\" blocks are removed the error still happens; so the error message isn't the clearest.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1207329786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1208451537",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1208451537",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1208451537,
    "node_id": "IC_kwDOB7jojM5IB4HR",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-08T18:15:07Z",
    "updated_at": "2022-08-08T18:15:07Z",
    "author_association": "MEMBER",
    "body": "Hey @m1cm1c, thanks for opening this. I'm a bit confused though. The way I would think about composing fixtures is that you would have something like:\r\n\r\n```js\r\nfunction deployTokenFixture() {\r\n  // deploy a token\r\n}\r\n\r\nfunction deployWrappedTokenFixture() {\r\n  const { token } = await deployTokenFixture();\r\n\r\n  const wrappedToken = ...;\r\n\r\n  return { token, wrappedToken }\r\n}\r\n```\r\n\r\nAnd then in some tests you do `loadFixture(deployTokenFixture)` and in others you do `loadFixture(deployWrappedTokenFixture)`, but you don't use `loadFixture` inside a fixture function. Does that make sense? And if this doesn't work for your use case, can you explain why?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1208451537/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1209032653",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1209032653",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1209032653,
    "node_id": "IC_kwDOB7jojM5IEF_N",
    "user": {
      "login": "m1cm1c",
      "id": 11382432,
      "node_id": "MDQ6VXNlcjExMzgyNDMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11382432?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/m1cm1c",
      "html_url": "https://github.com/m1cm1c",
      "followers_url": "https://api.github.com/users/m1cm1c/followers",
      "following_url": "https://api.github.com/users/m1cm1c/following{/other_user}",
      "gists_url": "https://api.github.com/users/m1cm1c/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/m1cm1c/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/m1cm1c/subscriptions",
      "organizations_url": "https://api.github.com/users/m1cm1c/orgs",
      "repos_url": "https://api.github.com/users/m1cm1c/repos",
      "events_url": "https://api.github.com/users/m1cm1c/events{/privacy}",
      "received_events_url": "https://api.github.com/users/m1cm1c/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T07:46:56Z",
    "updated_at": "2022-08-09T07:46:56Z",
    "author_association": "NONE",
    "body": "@fvictorio This is exactly what my proposed fix boils down to, except it has the advantage that if true nested fixture support were to ever be implemented (i.e. not executing `deployTokenFixture()` again when `deployWrappedTokenFixture()` gets executed), tests would already be implemented in the way that can take advantage of that future performance improvement.\r\n\r\nHowever, documenting how to do it would be almost equivalent to the fix. When first encountered fixtures, I thought you could use them in any way to skip duplicate chain mutations, including of course inside another sequence of chain mutations. If the way to avoid the problem were documented, there'd be no need for the fix.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1209032653/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1210695543",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1210695543",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1210695543,
    "node_id": "IC_kwDOB7jojM5IKb93",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-10T13:44:01Z",
    "updated_at": "2022-08-10T13:44:01Z",
    "author_association": "MEMBER",
    "body": "> When first encountered fixtures, I thought you could use them in any way to skip duplicate chain mutations, including of course inside another sequence of chain mutations. If the way to avoid the problem were documented, there'd be no need for the fix.\r\n\r\nThis is very useful feedback, thank you",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1210695543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1211702736",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1211702736",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1211702736,
    "node_id": "IC_kwDOB7jojM5IOR3Q",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-11T08:39:55Z",
    "updated_at": "2022-08-11T08:39:55Z",
    "author_association": "MEMBER",
    "body": "I've already captured this in our documentation backlog, so I'm going to close this issue now. Thanks again.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1211702736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1221328702",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1221328702",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1221328702,
    "node_id": "IC_kwDOB7jojM5Iy_8-",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-20T14:51:16Z",
    "updated_at": "2022-08-20T14:51:16Z",
    "author_association": "NONE",
    "body": "I am a bit confused @fvictorio - is calling `loadFixture` inside another fixture function to apply chain mutations on top of the first fixture's snapshot now supported or ever will be? This could definitely lead to some potentially large performance improvements.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1221328702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1221421848",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1221421848",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1221421848,
    "node_id": "IC_kwDOB7jojM5IzWsY",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-20T22:54:46Z",
    "updated_at": "2022-08-20T22:54:46Z",
    "author_association": "MEMBER",
    "body": "It's not supported yet. Maybe it could be supported in the future, but it feels like an anti-pattern to me. IMO each fixture should be about deploying contracts and sending transactions. Executing a fixture with `loadFixture` should be orthogonal to that (in my mind at least, I'm open to being wrong here).\r\n\r\nI'm not sure if supporting this would lead to *large* performance improvements. Take my example from before:\r\n\r\n```js\r\nfunction deployTokenFixture() {\r\n  // deploy a token\r\n}\r\n\r\nfunction deployWrappedTokenFixture() {\r\n  const { token } = await deployTokenFixture();\r\n\r\n  const wrappedToken = ...;\r\n\r\n  return { token, wrappedToken }\r\n}\r\n```\r\n\r\nIf you use the first fixture in 10 tests and the second fixture in other 10 tests, the first fixture would be executed twice (when it's called with `loadFixture` for the first time, and when it's called through the other fixture also for the first time) and the second fixture once.\r\n\r\nIf it was possible to call `loadFixture` inside the second fixture, then both fixtures would be executed only once. While this is (kind of) a 33% improvement, it's a small change compared to the speedup you get when you go from deploying in each test (where the fixtures are executed 20 and 10 times, respectively) to deploying only once via the `loadFixture` helper.\r\n\r\nDoes that make sense?\r\n\r\nThat being said, we do want to support nested calls to `loadFixture` for other reasons (nested `describe`s with `beforeEach`s that deploy things) and when that is done, then I think what you are asking for will also be possible.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1221421848/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1222075861",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2980#issuecomment-1222075861",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2980",
    "id": 1222075861,
    "node_id": "IC_kwDOB7jojM5I12XV",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-22T09:12:20Z",
    "updated_at": "2022-08-22T09:12:20Z",
    "author_association": "NONE",
    "body": "Yes that makes sense and in the scenario you described (10 tests for each fixture) the performance improvements are indeed marginal.\r\n\r\nI just encountered a different scenario where the first fixture is large and the additional steps in the second fixture are small but still worthwhile putting into a fixture. Also, the second fixture would only be called 2-3 times. In this scenario, the cost of running the first=main fixture is not so easily amortized.\r\n\r\nBut happy to hear that it will soon be properly supported!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1222075861/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
