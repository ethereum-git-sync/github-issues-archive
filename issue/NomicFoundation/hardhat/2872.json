{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2872",
  "id": 1279261115,
  "node_id": "I_kwDOB7jojM5MP_m7",
  "number": 2872,
  "title": "Calculated gas fees differ if signer is Wallet or SignerWithAddress",
  "user": {
    "login": "aaonduollar",
    "id": 102689089,
    "node_id": "U_kgDOBh7pQQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/102689089?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aaonduollar",
    "html_url": "https://github.com/aaonduollar",
    "followers_url": "https://api.github.com/users/aaonduollar/followers",
    "following_url": "https://api.github.com/users/aaonduollar/following{/other_user}",
    "gists_url": "https://api.github.com/users/aaonduollar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aaonduollar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aaonduollar/subscriptions",
    "organizations_url": "https://api.github.com/users/aaonduollar/orgs",
    "repos_url": "https://api.github.com/users/aaonduollar/repos",
    "events_url": "https://api.github.com/users/aaonduollar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aaonduollar/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "feuGeneA",
    "id": 7883777,
    "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/feuGeneA",
    "html_url": "https://github.com/feuGeneA",
    "followers_url": "https://api.github.com/users/feuGeneA/followers",
    "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
    "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
    "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
    "repos_url": "https://api.github.com/users/feuGeneA/repos",
    "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-06-22T00:06:18Z",
  "updated_at": "2022-11-17T21:40:11Z",
  "closed_at": "2022-07-29T13:43:42Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I'm having an issue where if I instantiate a `Wallet` object and add it the hardhat provider, gas fees are not getting calculated property whenever I make a transaction. But if I use one of the `SignerWithAddress` from `hre.ethers.getSigners()` it works correctly. I have tried both with Alchemy and Moralis.\r\n\r\nIn this snippet I only show `sendTransaction` getting used, but the same behaviour is being seen in contract function calls.\r\n\r\nThis is my configuration and task:\r\n```typescript\r\n// transfer.ts\r\n\r\nimport { task } from 'hardhat/config';\r\nimport config from '../../config';\r\n\r\ntask('action-transfer', 'Transfer coins from owner to other')\r\n  .addParam('to', 'Account address to transfer to')\r\n  .addParam('value', 'Value to transfer')\r\n  .setAction(async ({ to, value }: { to: string; value: number }, hre) => {\r\n    const owner1 = (await hre.ethers.getSigners())[0];\r\n    const owner2 = new hre.ethers.Wallet(\r\n      config.crypto.ownerPrivateKey,\r\n      hre.ethers.provider\r\n    );\r\n\r\n    const tx1 = await owner1.sendTransaction({ to, value });\r\n    const tx2 = await owner2.sendTransaction({ to, value });\r\n\r\n    console.log(tx1);\r\n    console.log(tx2);\r\n  });\r\n```\r\n\r\n```bash\r\n$ npx hardhat action-transfer --to 0x7caee40B0F4F5872a3cB5e03d9AeAe2e3210bfbe --value 1 --network mumbai\r\n                                                                                                                              \r\ntx1 {\r\n  hash: '0x36f2746a1c4f59eba9d2438821d69e5d62e687e505e6db26b235b642697ab2c2',\r\n  type: 2,\r\n  accessList: [],\r\n  blockHash: null,\r\n  blockNumber: null,\r\n  transactionIndex: null,\r\n  confirmations: 0,\r\n  from: '0xAf036C8Dac12FCfAD6dEeBb12640d19BA9EF6B26',\r\n  gasPrice: BigNumber { value: \"94837263915\" },\r\n  maxPriorityFeePerGas: BigNumber { value: \"94837263903\" },\r\n  maxFeePerGas: BigNumber { value: \"94837263915\" },\r\n  gasLimit: BigNumber { value: \"21000\" },\r\n  to: '0x7caee40B0F4F5872a3cB5e03d9AeAe2e3210bfbe',\r\n  value: BigNumber { value: \"1\" },\r\n  nonce: 166,\r\n  data: '0x',\r\n  r: '0xa0b4580497a53661b47da0a7ed268b84f6e6d472339e7ea098948d12c0de1892',\r\n  s: '0x3cc84c030b7b657e1e0e2cdc47c11e8be551f7bffa445a794a4e1ef8c4633013',\r\n  v: 1,\r\n  creates: null,\r\n  chainId: 80001,\r\n  wait: [Function (anonymous)]\r\n}\r\ntx2 {\r\n  type: 2,\r\n  chainId: 80001,\r\n  nonce: 167,\r\n  maxPriorityFeePerGas: BigNumber { value: \"1500000000\" },\r\n  maxFeePerGas: BigNumber { value: \"1500000020\" },\r\n  gasPrice: null,\r\n  gasLimit: BigNumber { value: \"21000\" },\r\n  to: '0x7caee40B0F4F5872a3cB5e03d9AeAe2e3210bfbe',\r\n  value: BigNumber { value: \"1\" },\r\n  data: '0x',\r\n  accessList: [],\r\n  hash: '0x04bf854a65a21b6e781c2e22404fb5bac59c64dfa725fe5adcd670dab2db9a5a',\r\n  v: 0,\r\n  r: '0xb703adc9023e5aaf2568a0695f018c329a50bd44cbe256625d876899f4770a81',\r\n  s: '0x2d7bbaf1b537cc5ccf6b6d36fceaf80b4cc922425e843b8d94ab9aa5e6736194',\r\n  from: '0xAf036C8Dac12FCfAD6dEeBb12640d19BA9EF6B26',\r\n  confirmations: 0,\r\n  wait: [Function (anonymous)]\r\n}\r\n```\r\n\r\n```typescript\r\n// hardhat.config.ts\r\n\r\nimport cfg from './src/config';\r\n\r\nimport { HardhatUserConfig } from 'hardhat/config';\r\nimport '@nomiclabs/hardhat-etherscan';\r\nimport '@nomiclabs/hardhat-waffle';\r\nimport '@typechain/hardhat';\r\nimport 'hardhat-gas-reporter';\r\nimport 'solidity-coverage';\r\n\r\nimport './src/tasks/actions/transfer';\r\n\r\n// Configuration\r\nconst config: HardhatUserConfig = {\r\n  solidity: '0.8.4',\r\n  networks: {\r\n    mumbai: {\r\n      url: cfg.crypto.host,\r\n      accounts: [crypto.ownerPrivateKey],\r\n    },\r\n    polygon: {\r\n      url: cfg.crypto.host,\r\n      accounts: [cfg.crypto.ownerPrivateKey],\r\n    },\r\n  },\r\n  paths: {\r\n    sources: './src/contracts',\r\n    tests: './src/tests/contracts',\r\n    cache: './cache',\r\n    artifacts: './artifacts',\r\n  },\r\n  mocha: {\r\n    timeout: 40000,\r\n  },\r\n};\r\n\r\nexport default config;\r\n```\r\n\r\n`./src/config` is just a config object used for using different environments.\r\n\r\nThanks.",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1162478514",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2872#issuecomment-1162478514",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872",
    "id": 1162478514,
    "node_id": "IC_kwDOB7jojM5FSgOy",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-06-22T00:06:40Z",
    "updated_at": "2022-06-22T00:06:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-876/calculated-gas-fees-differ-if-signer-is-wallet-or-signerwithaddress).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 307a5bad-5cd0-4174-ac6e-243dbdd23ae6",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1162478514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1163083005",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2872#issuecomment-1163083005",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872",
    "id": 1163083005,
    "node_id": "IC_kwDOB7jojM5FUzz9",
    "user": {
      "login": "aaonduollar",
      "id": 102689089,
      "node_id": "U_kgDOBh7pQQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/102689089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aaonduollar",
      "html_url": "https://github.com/aaonduollar",
      "followers_url": "https://api.github.com/users/aaonduollar/followers",
      "following_url": "https://api.github.com/users/aaonduollar/following{/other_user}",
      "gists_url": "https://api.github.com/users/aaonduollar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aaonduollar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aaonduollar/subscriptions",
      "organizations_url": "https://api.github.com/users/aaonduollar/orgs",
      "repos_url": "https://api.github.com/users/aaonduollar/repos",
      "events_url": "https://api.github.com/users/aaonduollar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aaonduollar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-22T13:14:49Z",
    "updated_at": "2022-06-22T13:14:49Z",
    "author_association": "NONE",
    "body": "I think it might have something to do with https://github.com/ethers-io/ethers.js/issues/2828 although it's not clear to me why they provide different gas data.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1163083005/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1192589730",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2872#issuecomment-1192589730",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872",
    "id": 1192589730,
    "node_id": "IC_kwDOB7jojM5HFXmi",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-22T13:42:58Z",
    "updated_at": "2022-07-22T13:42:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1192589730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1199303223",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2872#issuecomment-1199303223",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2872",
    "id": 1199303223,
    "node_id": "IC_kwDOB7jojM5He-o3",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-29T13:43:42Z",
    "updated_at": "2022-07-29T13:43:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1199303223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
