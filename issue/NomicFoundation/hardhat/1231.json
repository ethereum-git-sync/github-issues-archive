{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1231",
  "id": 802804626,
  "node_id": "MDU6SXNzdWU4MDI4MDQ2MjY=",
  "number": 1231,
  "title": "Forked mode sets unlocked account nonce to 0",
  "user": {
    "login": "chanhosuh",
    "id": 4645177,
    "node_id": "MDQ6VXNlcjQ2NDUxNzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4645177?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chanhosuh",
    "html_url": "https://github.com/chanhosuh",
    "followers_url": "https://api.github.com/users/chanhosuh/followers",
    "following_url": "https://api.github.com/users/chanhosuh/following{/other_user}",
    "gists_url": "https://api.github.com/users/chanhosuh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chanhosuh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chanhosuh/subscriptions",
    "organizations_url": "https://api.github.com/users/chanhosuh/orgs",
    "repos_url": "https://api.github.com/users/chanhosuh/repos",
    "events_url": "https://api.github.com/users/chanhosuh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chanhosuh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/milestones/3",
    "html_url": "https://github.com/NomicFoundation/hardhat/milestone/3",
    "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/milestones/3/labels",
    "id": 6412213,
    "node_id": "MDk6TWlsZXN0b25lNjQxMjIxMw==",
    "number": 3,
    "title": "hardhat-core@2.0.10",
    "description": null,
    "creator": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 9,
    "state": "closed",
    "created_at": "2021-02-09T15:14:05Z",
    "updated_at": "2021-02-12T13:13:26Z",
    "due_on": null,
    "closed_at": "2021-02-12T13:13:26Z"
  },
  "comments": 3,
  "created_at": "2021-02-06T22:23:37Z",
  "updated_at": "2022-11-18T19:00:47Z",
  "closed_at": "2021-02-12T12:52:26Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hardhat's forked mode sets unlocked accounts' nonces to 0, contrary to what they may be on the network being forked.\r\n\r\nTo replicate, use the test mnemonic `test test test test test test test test test test test junk` (the default for hardhat network in the config), which has [19 outgoing transactions according to Etherscan](https://etherscan.io/txs?a=0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266&f=2) for its account 0.\r\n\r\nTo check this, run the following script with hardhat network as forked mainnet.\r\n\r\n```node\r\nconst { ethers} = require(\"hardhat\");\r\n\r\nasync function main() {\r\n  const signers = await ethers.getSigners();\r\n  const deployer = signers[0];\r\n  console.log(\"Deployer address:\", deployer.address);\r\n  const nonce = await ethers.provider.getTransactionCount(deployer.address);\r\n  console.log(\"Deployer nonce:\", nonce);  // 0, but expect 19\r\n  console.log(\"\");\r\n}\r\n\r\nmain()\r\n  .then(() => process.exit(0))\r\n  .catch((error) => {\r\n    console.error(error);\r\n    process.exit(1);\r\n  });\r\n```\r\n\r\nThis can be considered a bug as it causes issues with contract deployment since a contract's address is fully determined by the sender's address and nonce.  Deploying a contract from an account with nonce 0 when it has already been used on the network being forked to deploy a contract at nonce 0 will cause a revert.\r\n\r\nI believe a couple of the issues already reported here may be due to this:\r\n- https://github.com/nomiclabs/hardhat/issues/1155\r\n- https://github.com/nomiclabs/hardhat/issues/1204\r\n- https://github.com/nomiclabs/hardhat/issues/1212\r\n- https://github.com/nomiclabs/hardhat/issues/1233",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/777654885",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1231#issuecomment-777654885",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231",
    "id": 777654885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzY1NDg4NQ==",
    "user": {
      "login": "akhanubis",
      "id": 2922430,
      "node_id": "MDQ6VXNlcjI5MjI0MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2922430?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/akhanubis",
      "html_url": "https://github.com/akhanubis",
      "followers_url": "https://api.github.com/users/akhanubis/followers",
      "following_url": "https://api.github.com/users/akhanubis/following{/other_user}",
      "gists_url": "https://api.github.com/users/akhanubis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/akhanubis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/akhanubis/subscriptions",
      "organizations_url": "https://api.github.com/users/akhanubis/orgs",
      "repos_url": "https://api.github.com/users/akhanubis/repos",
      "events_url": "https://api.github.com/users/akhanubis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/akhanubis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T17:19:10Z",
    "updated_at": "2021-02-11T17:19:10Z",
    "author_association": "NONE",
    "body": "I have been scratching my head for a few hours regarding reverted deploys. Have you found a workaround that doesnt involve using another address for the time being?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/777654885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/777658353",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1231#issuecomment-777658353",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231",
    "id": 777658353,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzY1ODM1Mw==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T17:24:18Z",
    "updated_at": "2021-02-11T17:24:18Z",
    "author_association": "MEMBER",
    "body": "@akhanubis I haven't tested this, but an uglier workaround would be to send a lot of empty transactions from the first account and then start using it. That way there won't be collisions with the already deployed contracts from that address.\r\n\r\nRight now the first account has a nonce of 19, so sending, say, 30 no-op txs should be more than enough.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/777658353/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/778177784",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1231#issuecomment-778177784",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1231",
    "id": 778177784,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODE3Nzc4NA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-12T12:52:26Z",
    "updated_at": "2021-02-12T12:52:26Z",
    "author_association": "MEMBER",
    "body": "Should be fixed in 2.0.10. Please re-open if it's not!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/778177784/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
