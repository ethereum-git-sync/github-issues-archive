{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2681",
  "id": 1228941272,
  "node_id": "I_kwDOB7jojM5JQCfY",
  "number": 2681,
  "title": "Circular problem when using Typechain types.",
  "user": {
    "login": "hickscorp",
    "id": 822933,
    "node_id": "MDQ6VXNlcjgyMjkzMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hickscorp",
    "html_url": "https://github.com/hickscorp",
    "followers_url": "https://api.github.com/users/hickscorp/followers",
    "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
    "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
    "organizations_url": "https://api.github.com/users/hickscorp/orgs",
    "repos_url": "https://api.github.com/users/hickscorp/repos",
    "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hickscorp/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-05-08T17:20:48Z",
  "updated_at": "2022-11-16T11:35:10Z",
  "closed_at": "2022-06-07T19:15:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Disclaimer notice - I'm fairly new to Hardhat - I've previously used other frameworks.\r\n\r\nThere's something that I'm either confused about, or that could be an issue with the current architecture of Hardhat.\r\n\r\nI have this task defined:\r\n\r\n```ts\r\nimport { task, types } from \"hardhat/config\";\r\nimport \"@openzeppelin/hardhat-upgrades\";\r\nimport { checkNetwork } from \"../utils\";\r\nimport { StateManager } from '../StateManager';\r\nimport { HardhatRuntimeEnvironment } from \"hardhat/types\";\r\n// import { Spc } from \"../../typechain-types\";\r\n\r\ninterface SpcDeployParams {\r\n  readonly governor: string;\r\n};\r\n\r\ntask(\"spc-deploy\", \"Deploys the main SPC contract\")\r\n  .addParam('governor', 'The SPC governor address', undefined, types.string)\r\n  .setAction(async (params: SpcDeployParams, hre) => {\r\n    checkNetwork(hre);\r\n\r\n    const stateManager = new StateManager(31337);\r\n    // Check for libraries...\r\n    if (!stateManager.state.AddressSetLib) { throw 'Missing AddressSetLib library' }\r\n    // Already deployed?\r\n    else if (stateManager.state.Spc) { throw `Already deployed at ${stateManager.state.Spc}` }\r\n\r\n    const addressSetLibAddr: string = stateManager.state.AddressSetLib;\r\n    const spc = await deploySpc(hre, addressSetLibAddr, params.governor);\r\n    // We keep track of its address in our state file.\r\n    stateManager.state = { ...stateManager.state, Spc: spc.address };\r\n    console.log('Deployed Spc', spc.address);\r\n  });\r\n\r\nasync function deploySpc(\r\n  { ethers, upgrades }: HardhatRuntimeEnvironment,\r\n  addressSetLibAddr: string,\r\n  governor: string): Promise<Spc> {\r\n  // We deploy our SPC contract.\r\n  const libraries = { AddressSetLib: addressSetLibAddr }\r\n  const Spc = await ethers.getContractFactory(\"Spc\", { libraries });\r\n  return await upgrades.deployProxy(Spc, [governor]) as Spc;\r\n}\r\n\r\nexport { deploySpc };\r\n```\r\n\r\nIt became a thing organically - and it uses typings generated via `hardhat typechain`.\r\nEverything is great until I run `hardhat clean` - now, the typechain types are gone, and I cannot run any `hardhat` command anymore - because even the `hard typechain` task requires that my typescript files are correct - and since the types are gone, it cannot generate them.\r\n\r\nI'm not sure whether this is a configuration problem on my end, or something that needs fixing with Hardhat.\r\n\r\nAnother thing - that might be related - I cannot find much documentation how how one would use the Typechain types in a Hardhat project. I followed the instructions from `@typechain/hardhat` (I'll include my `hardhat.config.ts` and `tsconfig.json` at the end of this issue), but somehow I still have to manually type things (For example, `return await upgrades.deployProxy(Spc, [governor]) as Spc;`) where I thought that the goal of Typechain with Hardhat was exactly to prevent this kind of possible mistake. Is there something I'm doing wrong here, or is it the architecture that is purposefully designed in such way? For example, I noticed that a `Spc__factory` type was being  generated - but it seems that I cannot use it while also using `openzeppelin`'s `upgrades.deployProxy(...)` method?\r\n\r\n`hardhat.config.ts`:\r\n```ts\r\nimport * as dotenv from 'dotenv';\r\nimport { HardhatUserConfig } from 'hardhat/config';\r\nimport '@openzeppelin/hardhat-upgrades';\r\nimport '@typechain/hardhat';\r\nimport '@nomiclabs/hardhat-ethers';\r\nimport '@nomiclabs/hardhat-waffle';\r\nimport 'hardhat-gas-reporter';\r\nimport 'solidity-coverage';\r\n\r\n// Loads `.env` file into `process.env`.\r\ndotenv.config();\r\n\r\n// Import all of our tasks here!\r\nimport './src/tasks/accounts';\r\nimport './src/tasks/libraries';\r\nimport './src/tasks/spc';\r\nimport './src/tasks/fast';\r\nimport './src/tasks/bootstrap';\r\n\r\nconst config: HardhatUserConfig = {\r\n  solidity: '0.8.4',\r\n  networks: {\r\n    ropsten: {\r\n      url: process.env.ROPSTEN_URL || '',\r\n      accounts: process.env.PRIVATE_KEY !== undefined ? [process.env.PRIVATE_KEY] : [],\r\n    },\r\n  },\r\n  gasReporter: {\r\n    enabled: process.env.REPORT_GAS !== undefined,\r\n    currency: 'EUR',\r\n  }\r\n};\r\nexport default config;\r\n```\r\n\r\n`tsconfig.json` (Note that my stuff is in `src`, not top-level):\r\n```json\r\n{\r\n  \"compilerOptions\": {\r\n    \"target\": \"es2018\",\r\n    \"module\": \"commonjs\",\r\n    \"strict\": true,\r\n    \"resolveJsonModule\": true,\r\n    \"esModuleInterop\": true,\r\n    \"outDir\": \"dist\",\r\n    \"declaration\": true\r\n  },\r\n  \"include\": [\r\n    \"./src\",\r\n    \"./src/tasks\",\r\n    \"./src/scripts\",\r\n    \"./test\",\r\n    \"./typechain-types\"\r\n  ],\r\n  \"files\": [\r\n    \"./hardhat.config.ts\",\r\n    \"./typings.d.ts\"\r\n  ]\r\n}\r\n```\r\n",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1120456122",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2681#issuecomment-1120456122",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681",
    "id": 1120456122,
    "node_id": "IC_kwDOB7jojM5CyM26",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-05-08T17:21:12Z",
    "updated_at": "2022-05-08T17:21:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-619/circular-problem-when-using-typechain-types).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: d4908f22-2a91-4f52-b98a-5f046cf51542",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1120456122/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1125985375",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2681#issuecomment-1125985375",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681",
    "id": 1125985375,
    "node_id": "IC_kwDOB7jojM5DHSxf",
    "user": {
      "login": "hickscorp",
      "id": 822933,
      "node_id": "MDQ6VXNlcjgyMjkzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/822933?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hickscorp",
      "html_url": "https://github.com/hickscorp",
      "followers_url": "https://api.github.com/users/hickscorp/followers",
      "following_url": "https://api.github.com/users/hickscorp/following{/other_user}",
      "gists_url": "https://api.github.com/users/hickscorp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hickscorp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hickscorp/subscriptions",
      "organizations_url": "https://api.github.com/users/hickscorp/orgs",
      "repos_url": "https://api.github.com/users/hickscorp/repos",
      "events_url": "https://api.github.com/users/hickscorp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hickscorp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-13T12:04:09Z",
    "updated_at": "2022-05-13T12:15:40Z",
    "author_association": "NONE",
    "body": "Bump? How can you run `hardhat compile` if tasks use Typescript, but the `typechain-types` isn't populated yet?\r\nThe only way I found so far is to comment any line from `hardhat.config.ts` which `import`s any custom typescript files.\r\n\r\n[EDIT]: I found the solution to this problem... At the very bottom of the `@typechain/hardhat` package documentation. My bad and sorry for the noise.\r\n\r\nFor those of you looking, the solution is really simple. Run:\r\n```bash\r\nTS_NODE_TRANSPILE_ONLY=1  yarn hardhat compile && TS_NODE_TRANSPILE_ONLY=1  yarn hardhat typechain\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1125985375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1149066666",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2681#issuecomment-1149066666",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2681",
    "id": 1149066666,
    "node_id": "IC_kwDOB7jojM5EfV2q",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T19:15:38Z",
    "updated_at": "2022-06-07T19:15:38Z",
    "author_association": "MEMBER",
    "body": "Hi @hickscorp, thanks for sharing the solution. We'll be working soon in some improvements that will make even that unnecessary, but for the time being that's probably the correct approach.\r\n\r\nI'm going to close this issue now, but let me know if you have more concerns.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1149066666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
