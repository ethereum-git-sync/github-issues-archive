{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1464",
  "id": 894641414,
  "node_id": "MDU6SXNzdWU4OTQ2NDE0MTQ=",
  "number": 1464,
  "title": "hardhat(forking mainnet) revert without anything explicit error",
  "user": {
    "login": "Hasiwansui",
    "id": 6364823,
    "node_id": "MDQ6VXNlcjYzNjQ4MjM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6364823?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Hasiwansui",
    "html_url": "https://github.com/Hasiwansui",
    "followers_url": "https://api.github.com/users/Hasiwansui/followers",
    "following_url": "https://api.github.com/users/Hasiwansui/following{/other_user}",
    "gists_url": "https://api.github.com/users/Hasiwansui/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Hasiwansui/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Hasiwansui/subscriptions",
    "organizations_url": "https://api.github.com/users/Hasiwansui/orgs",
    "repos_url": "https://api.github.com/users/Hasiwansui/repos",
    "events_url": "https://api.github.com/users/Hasiwansui/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Hasiwansui/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-05-18T18:04:50Z",
  "updated_at": "2022-11-18T18:48:30Z",
  "closed_at": "2021-05-18T18:56:29Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hi guys.\r\nWhen my solidity code run to this place\r\n\r\n```solidity\r\n        (address token0, address token1) = sortTokens(tokenA, tokenB);\r\n        address pair1 = address(uint(keccak256(abi.encodePacked(hex'ff',UNIFAC,keccak256(abi.encodePacked(token0, token1)),hex'96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f')))); // init code hash\r\n        console.log(\"pair1:\",pair1);\r\n\r\n        address pair2 = address(uint(keccak256(abi.encodePacked(hex'ff',SUSHIFAC,keccak256(abi.encodePacked(token0, token1)),hex'e18a34eb0e04b04f7a0ac29a6e80748dca96319b42c54d679cb821dca90c6303'))));\r\n        console.log(\"pair2:\",pair2);\r\n        if(pair == pair1){\r\n            return true;\r\n        } \r\n        console.log(\"not 1\");\r\n        if(pair == pair2){\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n```\r\n\r\nIt reverts after logging “not 1”，and here is the log of the output and debugger\r\n>Mined block #12455661\r\n>  Block: 0x0580d0fa1f3781703bfbc4001590f34ad493d56d874ba646559ae4f47d54e3ae\r\n>    Transaction:             0x5ddf1f1f3a37fb9bbbff543e31bf73035f32d90014f1253ca3c5cafc9949ed64\r\n>      Contract call:         UniFlashSwap#callWithGastoken\r\n>      From:                  0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266\r\n>      To:                    0xe6e340d132b5f46d1e472debcd681b2abc16e57e\r\n>      Value:                 0 ETH\r\n>      Gas used:              110677 of 9032984\r\n\r\n###      console.log:\r\n>        sender:  0xe6e340d132b5f46d1e472debcd681b2abc16e57e\r\n>        amount0:  0\r\n>        amount1:  300000000000000000000\r\n>        bribe: 100\r\n>        address:  0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2 0xfca59cd816ab1ead66534d82bc21e7515ce441cf >0x53aabccae8c1713a6a150d9981d2ee867d0720e8\r\n>        pair1: 0x86fef14c27c78deaeb4349fd959caa11fc5b5d75\r\n>        pair2: 0x53aabccae8c1713a6a150d9981d2ee867d0720e8\r\n>        not 1\r\n\r\n###      Error: VM Exception while processing transaction: revert call unsuccess\r\n>          at UniFlashSwap.uniswapV2Call (contracts/flash.sol:130)\r\n>          at HardhatNode._mineBlockWithPendingTxs (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1154:23)\r\n>          at HardhatNode.mineBlock (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:377:16)\r\n>          at HardhatModule._intervalMineAction (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/modules/hardhat.ts:129:20)\r\n>          at HardhatNetworkProvider._sendWithLogging (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:119:22)\r\n>          at HardhatNetworkProvider.request (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:99:18)\r\n>          at MiningTimer._mineFunction (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:304:9)\r\n>          at MiningTimer._loop (/home/piepile/arbapp/hardhat/node_modules/hardhat/src/internal/hardhat-network/provider/MiningTimer.ts:98:5)\r\n\r\nand here is the network settings of my config\r\n\r\n```typescript\r\nnetworks:{\r\n    hardhat:{\r\n      forking:{\r\n        url:\"API-KEY\"\r\n      },\r\n      mining:{\r\n        auto:false,\r\n        interval:2000\r\n      },\r\n      gas:10000000,\r\n      gasPrice:0,\r\n      throwOnTransactionFailures:true,\r\n      throwOnCallFailures:true,\r\n      loggingEnabled:true\r\n    },\r\n  }\r\n```\r\n",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/843451275",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1464#issuecomment-843451275",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464",
    "id": 843451275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzQ1MTI3NQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T18:56:29Z",
    "updated_at": "2021-05-18T18:56:29Z",
    "author_association": "MEMBER",
    "body": "This line in the stack trace:\r\n\r\n```\r\n     at UniFlashSwap.uniswapV2Call (contracts/flash.sol:130)\r\n```\r\n\r\nmakes me think that the error is caused by a post-condition in a flash loan not being satisfied. If that's the case, the problem isn't in hardhat, but in your contract's code.\r\n\r\nI'm going to assume that's the case and close this issue. Please re-open if you think that this is a problem with Hardhat (and keep in mind that \"the error could've been more helpful\" is something we consider a problem, so feel free to re-open in that case too). If you have further questions, you can also use [our discord server](https://hardhat.org/discord)",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/843451275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/843512048",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1464#issuecomment-843512048",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464",
    "id": 843512048,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzUxMjA0OA==",
    "user": {
      "login": "Hasiwansui",
      "id": 6364823,
      "node_id": "MDQ6VXNlcjYzNjQ4MjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6364823?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Hasiwansui",
      "html_url": "https://github.com/Hasiwansui",
      "followers_url": "https://api.github.com/users/Hasiwansui/followers",
      "following_url": "https://api.github.com/users/Hasiwansui/following{/other_user}",
      "gists_url": "https://api.github.com/users/Hasiwansui/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Hasiwansui/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Hasiwansui/subscriptions",
      "organizations_url": "https://api.github.com/users/Hasiwansui/orgs",
      "repos_url": "https://api.github.com/users/Hasiwansui/repos",
      "events_url": "https://api.github.com/users/Hasiwansui/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Hasiwansui/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T19:55:47Z",
    "updated_at": "2021-05-18T19:55:47Z",
    "author_association": "NONE",
    "body": "> This line in the stack trace:\r\n> \r\n> ```\r\n>      at UniFlashSwap.uniswapV2Call (contracts/flash.sol:130)\r\n> ```\r\n> \r\n> makes me think that the error is caused by a post-condition in a flash loan not being satisfied. If that's the case, the problem isn't in hardhat, but in your contract's code.\r\n> \r\n> I'm going to assume that's the case and close this issue. Please re-open if you think that this is a problem with Hardhat (and keep in mind that \"the error could've been more helpful\" is something we consider a problem, so feel free to re-open in that case too). If you have further questions, you can also use [our discord server](https://hardhat.org/discord)\r\n\r\nI had simulated with same parameters on the   \r\nsame block using tenderly and the transaction succeed. This function's return value is wrapped by a require and the debugger didn't throw that require's error message.So the function could just reverted after \"not 1\" log inside this function til it throwing return value.But there just an if condition clause and I can't figure out what happened.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/843512048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/844159136",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1464#issuecomment-844159136",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1464",
    "id": 844159136,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDE1OTEzNg==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-19T14:27:35Z",
    "updated_at": "2021-05-19T14:27:35Z",
    "author_association": "MEMBER",
    "body": "In that case there is a chance this is a bug in hardhat. If you can make a [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example), please share it here and I'll reopen the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/844159136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
