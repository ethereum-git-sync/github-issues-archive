{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1060",
  "id": 751755540,
  "node_id": "MDU6SXNzdWU3NTE3NTU1NDA=",
  "number": 1060,
  "title": "View function is returning the entire tx hash instead of just the return",
  "user": {
    "login": "wschwab",
    "id": 31592931,
    "node_id": "MDQ6VXNlcjMxNTkyOTMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/31592931?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wschwab",
    "html_url": "https://github.com/wschwab",
    "followers_url": "https://api.github.com/users/wschwab/followers",
    "following_url": "https://api.github.com/users/wschwab/following{/other_user}",
    "gists_url": "https://api.github.com/users/wschwab/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wschwab/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wschwab/subscriptions",
    "organizations_url": "https://api.github.com/users/wschwab/orgs",
    "repos_url": "https://api.github.com/users/wschwab/repos",
    "events_url": "https://api.github.com/users/wschwab/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wschwab/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-11-26T17:46:36Z",
  "updated_at": "2022-11-18T21:09:18Z",
  "closed_at": "2020-11-27T13:11:14Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hi! I'm testing a contract using Hardhat's Waffle implementation, and I'm running into something weird. The contract is an ERC20 contract, and inherits from the [OpenZeppelin Snapshot contract](https://docs.openzeppelin.com/contracts/3.x/api/token/erc20#ERC20Snapshot), among others. Here's part of a test I wrote to check the [`snapshot()`](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20Snapshot.sol#L81 function:\r\n```javascript\r\nit(\"Admin can snapshot\", async () => {\r\n          const id = await Contract.connect(admin).callStatic.snapshot();\r\n          expect(await Contract.totalSupplyAt(id))\r\n            .to.equal(0);\r\n        });\r\n```\r\nExpected behavior would be that `id` would be the `uint256` returned by the [`snapshot`](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20Snapshot.sol#L81) function, and then the `expect` would work by passing in the id of the snapshot.\r\n\r\nHere's the error I get:\r\n```\r\nERC20:ERC20Snapshot\r\n         functions\r\n           snapshot()\r\n             Admin can snapshot:\r\n     Error: invalid BigNumber value (argument=\"value\", value={\"hash\":\"0xbead2cc40d8a9501bdc37ad07f9deb14bfdb0a6fcbaa54aa3406d926fe601a91\",\"blockHash\":\"0xc53ebe68f8f6bc848dd999339a5c00093357cb5cda6129fb87be01d83734df41\",\"blockNumber\":172,\"transactionIndex\":0,\"confirmations\":1,\"from\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"gasPrice\":{\"type\":\"BigNumber\",\"hex\":\"0x01dcd65000\"},\"gasLimit\":{\"type\":\"BigNumber\",\"hex\":\"0x820638\"},\"to\":\"0xBa3e08b4753E68952031102518379ED2fDADcA30\",\"value\":{\"type\":\"BigNumber\",\"hex\":\"0x00\"},\"nonce\":49,\"data\":\"0x9711715a\",\"r\":\"0x11c5ec48b7adcc75b19b9404558585114242e468a9a668f9ef06c568b7584f45\",\"s\":\"0xca9a526bab51dfda47ad1cce6123008f6b2f4aefceff26d4187a278a3deb5c58\",\"v\":62709,\"creates\":null,\"chainId\":31337}, code=INVALID_ARGUMENT, version=bignumber/5.0.8)\r\n      at Logger.makeError (node_modules/@ethersproject/logger/src.ts/index.ts:205:28)\r\n      at Logger.throwError (node_modules/@ethersproject/logger/src.ts/index.ts:217:20)\r\n      at Logger.throwArgumentError (node_modules/@ethersproject/logger/src.ts/index.ts:221:21)\r\n      at Function.BigNumber.from (node_modules/@ethersproject/bignumber/src.ts/bignumber.ts:268:23)\r\n      at NumberCoder.encode (node_modules/@ethersproject/abi/src.ts/coders/number.ts:21:27)\r\n      at node_modules/@ethersproject/abi/src.ts/coders/array.ts:71:19\r\n      at Array.forEach (<anonymous>)\r\n      at Object.pack (node_modules/@ethersproject/abi/src.ts/coders/array.ts:54:12)\r\n      at TupleCoder.encode (node_modules/@ethersproject/abi/src.ts/coders/tuple.ts:23:16)\r\n      at AbiCoder.encode (node_modules/@ethersproject/abi/src.ts/abi-coder.ts:106:15)\r\n```\r\nIt would seem to me from this that `id` is in fact storing the entire tx object from calling `snapshot`, while `totalSupplyAt` is expecting a BigNumber. I don't know why this would be, though. \r\n\r\nAny ideas?\r\n\r\nThanks!",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/734436185",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1060#issuecomment-734436185",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060",
    "id": 734436185,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDQzNjE4NQ==",
    "user": {
      "login": "wschwab",
      "id": 31592931,
      "node_id": "MDQ6VXNlcjMxNTkyOTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/31592931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wschwab",
      "html_url": "https://github.com/wschwab",
      "followers_url": "https://api.github.com/users/wschwab/followers",
      "following_url": "https://api.github.com/users/wschwab/following{/other_user}",
      "gists_url": "https://api.github.com/users/wschwab/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wschwab/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wschwab/subscriptions",
      "organizations_url": "https://api.github.com/users/wschwab/orgs",
      "repos_url": "https://api.github.com/users/wschwab/repos",
      "events_url": "https://api.github.com/users/wschwab/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wschwab/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-26T18:28:38Z",
    "updated_at": "2020-11-26T18:28:38Z",
    "author_association": "NONE",
    "body": "So I've figured out a couple of issues with my code above: it shouldn't be making a `staticCall` to `snapshot`, as `snapshot` isn't a `view` or `pure` function, which apparently is also why it's returning the tx log instead of just the `uint`. If there was some way to decode the event out of the log, the `snapshot` function does emit an event.\r\n\r\nUnfortunately, in Ethers an Interface is used to decode logs, and takes the ABI as an argument. I'm having trouble figuring out how to access the Interface from inside Hardhat, and having an equally hard time importing an ABI. In any event, I suppose a different way of trying to solve the above problem is how to decode a tx log the Hardhat way.\r\n\r\nThanks again!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/734436185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/734828402",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1060#issuecomment-734828402",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060",
    "id": 734828402,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDgyODQwMg==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-27T13:11:14Z",
    "updated_at": "2020-11-27T13:11:14Z",
    "author_association": "MEMBER",
    "body": "Closing this since these are mostly ethers questions. I will try to answer what I can though.\r\n\r\n> it shouldn't be making a `staticCall` to `snapshot`, as `snapshot` isn't a `view` or `pure` function\r\n\r\n`staticCall` is precisely used when a function is not `view` or `pure` but you want to call it like it is. This is useful for example to obtain the value it returns, which you can't do if you call a non-view function without static (this calls the method and returns a tx object, which is what I suspect happened to you in the first error).\r\n\r\n> I'm having trouble figuring out how to access the Interface from inside Hardhat\r\n\r\nYou can do this:\r\n\r\n```\r\nconst { abi } = await artifacts.readArtifact(\"YourContractName\")\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/734828402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/734828883",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1060#issuecomment-734828883",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1060",
    "id": 734828883,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDgyODg4Mw==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-27T13:12:38Z",
    "updated_at": "2020-11-27T13:12:38Z",
    "author_association": "MEMBER",
    "body": "You can join our [discord server](https://hardhat.org/discord) if you have more questions related to Hardhat. If you have questions related to ethers, I suggest you open an issue on their issue tracker (they don't have an official forum/chat, as far as I know).",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/734828883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
