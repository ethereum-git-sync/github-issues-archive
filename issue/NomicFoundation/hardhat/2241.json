{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2241",
  "id": 1098277484,
  "node_id": "I_kwDOB7jojM5BdmJs",
  "number": 2241,
  "title": "Mainnet fork not behaving as expected",
  "user": {
    "login": "naps62",
    "id": 283819,
    "node_id": "MDQ6VXNlcjI4MzgxOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/283819?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/naps62",
    "html_url": "https://github.com/naps62",
    "followers_url": "https://api.github.com/users/naps62/followers",
    "following_url": "https://api.github.com/users/naps62/following{/other_user}",
    "gists_url": "https://api.github.com/users/naps62/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/naps62/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/naps62/subscriptions",
    "organizations_url": "https://api.github.com/users/naps62/orgs",
    "repos_url": "https://api.github.com/users/naps62/repos",
    "events_url": "https://api.github.com/users/naps62/events{/privacy}",
    "received_events_url": "https://api.github.com/users/naps62/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "kanej",
    "id": 24030,
    "node_id": "MDQ6VXNlcjI0MDMw",
    "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kanej",
    "html_url": "https://github.com/kanej",
    "followers_url": "https://api.github.com/users/kanej/followers",
    "following_url": "https://api.github.com/users/kanej/following{/other_user}",
    "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
    "organizations_url": "https://api.github.com/users/kanej/orgs",
    "repos_url": "https://api.github.com/users/kanej/repos",
    "events_url": "https://api.github.com/users/kanej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kanej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "kanej",
      "id": 24030,
      "node_id": "MDQ6VXNlcjI0MDMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/24030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kanej",
      "html_url": "https://github.com/kanej",
      "followers_url": "https://api.github.com/users/kanej/followers",
      "following_url": "https://api.github.com/users/kanej/following{/other_user}",
      "gists_url": "https://api.github.com/users/kanej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kanej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kanej/subscriptions",
      "organizations_url": "https://api.github.com/users/kanej/orgs",
      "repos_url": "https://api.github.com/users/kanej/repos",
      "events_url": "https://api.github.com/users/kanej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kanej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-10T19:17:09Z",
  "updated_at": "2022-11-18T10:08:10Z",
  "closed_at": "2022-01-10T20:53:59Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I was trying to leverage hardhat mainnet forks to test some calls to https://abracadabra.money\r\n\r\nThe particular function I'm trying to call relies a lot on encoded sub-transactions, and is thus hard to reverse engineer:\r\nhttps://github.com/Abracadabra-money/magic-internet-money/blob/455f0f6831cbcb659bbe46b6d8f39d0aafd4e5c3/contracts/CauldronV2.sol#L389\r\n\r\n\r\nIn theory, I could just fork mainnet at the block immediatelly before the transaction, impersonate the account, send over the exact same payload, and end up with the exact same state changes (assuming nothing else in the block interferes with this).\r\nIn this case, that would mean a few ERC20 transfers and some event logs would happen along the way\r\n\r\nInstead, the transaction just seemingly executes with no errors, but also no state changes or events. I checked the tx receipt, as well as querying `balanceOf` for the relevant contracts before and after the call\r\n\r\nIf, instead of this complex `cook` function, I call a simple `ERC20.transfer`, everything seems to work as expected\r\n\r\nIs there some limitation in the way mainnet forks work that prevents this from working?",
  "closed_by": {
    "login": "naps62",
    "id": 283819,
    "node_id": "MDQ6VXNlcjI4MzgxOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/283819?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/naps62",
    "html_url": "https://github.com/naps62",
    "followers_url": "https://api.github.com/users/naps62/followers",
    "following_url": "https://api.github.com/users/naps62/following{/other_user}",
    "gists_url": "https://api.github.com/users/naps62/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/naps62/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/naps62/subscriptions",
    "organizations_url": "https://api.github.com/users/naps62/orgs",
    "repos_url": "https://api.github.com/users/naps62/repos",
    "events_url": "https://api.github.com/users/naps62/events{/privacy}",
    "received_events_url": "https://api.github.com/users/naps62/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1009333229",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2241#issuecomment-1009333229",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2241",
    "id": 1009333229,
    "node_id": "IC_kwDOB7jojM48KTPt",
    "user": {
      "login": "naps62",
      "id": 283819,
      "node_id": "MDQ6VXNlcjI4MzgxOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/283819?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naps62",
      "html_url": "https://github.com/naps62",
      "followers_url": "https://api.github.com/users/naps62/followers",
      "following_url": "https://api.github.com/users/naps62/following{/other_user}",
      "gists_url": "https://api.github.com/users/naps62/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naps62/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naps62/subscriptions",
      "organizations_url": "https://api.github.com/users/naps62/orgs",
      "repos_url": "https://api.github.com/users/naps62/repos",
      "events_url": "https://api.github.com/users/naps62/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naps62/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-10T20:53:59Z",
    "updated_at": "2022-01-10T20:53:59Z",
    "author_association": "NONE",
    "body": "Apparently I'm dealing with an EIP1167 proxy, apparently. which makes me realise maybe the block I'm forking into still had the fork pointing to an earlier version. That would explain most of the issues I'm seeing, so I'll close this until further notice",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1009333229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
