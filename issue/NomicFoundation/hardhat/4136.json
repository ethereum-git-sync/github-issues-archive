{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4136",
  "id": 1800629424,
  "node_id": "I_kwDOB7jojM5rU2yw",
  "number": 4136,
  "title": "Estimated feePerGas can be zero",
  "user": {
    "login": "aathan",
    "id": 24279435,
    "node_id": "MDQ6VXNlcjI0Mjc5NDM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/24279435?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aathan",
    "html_url": "https://github.com/aathan",
    "followers_url": "https://api.github.com/users/aathan/followers",
    "following_url": "https://api.github.com/users/aathan/following{/other_user}",
    "gists_url": "https://api.github.com/users/aathan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aathan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aathan/subscriptions",
    "organizations_url": "https://api.github.com/users/aathan/orgs",
    "repos_url": "https://api.github.com/users/aathan/repos",
    "events_url": "https://api.github.com/users/aathan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aathan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2474207618,
      "node_id": "MDU6TGFiZWwyNDc0MjA3NjE4",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:needs-more-info",
      "name": "status:needs-more-info",
      "color": "0E8A16",
      "default": false,
      "description": "There's not enough information to start working on this issue"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-07-12T10:05:27Z",
  "updated_at": "2023-08-09T07:10:53Z",
  "closed_at": "2023-08-09T07:10:53Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.16.1\r\n\r\n### What happened?\r\n\r\nhardhat makes calls like: `{\"jsonrpc\":\"2.0\",\"method\":\"eth_feeHistory\",\"params\":[\"0x1\",\"latest\",[50]],\"id\":9}`\r\nIf the fork environment called has a base fee set to `1` , or for any other reason, the response may be:\r\n`{\"jsonrpc\":\"2.0\",\"id\":9,\"result\":{\"baseFeePerGas\":[\"0x1\",\"0x0\"],\"gasUsedRatio\":[0.0],\"oldestBlock\":\"0x1efea03\",\"reward\":[[\"0x0\"]]}}`\r\n\r\nThe next eth_sendTransaction by hardhat contained: `\"maxFeePerGas\":\"0x0\",\"maxPriorityFeePerGas\":\"0x0\"}]`\r\n\r\nHardhat should probably not ever send transactions with 0 for these fields. The word \"probably\" may be debatable, but do we really expect any chain that is allowing free transactions?\r\n\r\n### Minimal reproduction steps\r\n\r\nSend multiple transactions of any kind to an `anvil --base-fee 1` node.\r\n\r\n### Search terms\r\n\r\n_No response_",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1632746099",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4136#issuecomment-1632746099",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136",
    "id": 1632746099,
    "node_id": "IC_kwDOB7jojM5hUbpz",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-12T15:23:20Z",
    "updated_at": "2023-07-12T15:23:20Z",
    "author_association": "MEMBER",
    "body": "I'm not sure I understand. The way I see it, Hardhat lets you set the base fee to 0 (this is useful in many testing scenarios), and if the base fee is 0 then that's what `eth_feeHistory` will return.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1632746099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1632799703",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4136#issuecomment-1632799703",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136",
    "id": 1632799703,
    "node_id": "IC_kwDOB7jojM5hUovX",
    "user": {
      "login": "aathan",
      "id": 24279435,
      "node_id": "MDQ6VXNlcjI0Mjc5NDM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/24279435?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aathan",
      "html_url": "https://github.com/aathan",
      "followers_url": "https://api.github.com/users/aathan/followers",
      "following_url": "https://api.github.com/users/aathan/following{/other_user}",
      "gists_url": "https://api.github.com/users/aathan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aathan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aathan/subscriptions",
      "organizations_url": "https://api.github.com/users/aathan/orgs",
      "repos_url": "https://api.github.com/users/aathan/repos",
      "events_url": "https://api.github.com/users/aathan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aathan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-12T15:55:54Z",
    "updated_at": "2023-07-12T16:06:22Z",
    "author_association": "NONE",
    "body": "Certainly understand your point.\r\n\r\nJust for my edification and so that we are on the same page, can you describe how this is useful in many testing scenarios -- assuming you mean in some way beyond the trivial \"I don't want to spend down my fee currency during tests\"?\r\n\r\nRealizing that, then this is not necessarily a bug when hardhat is pointed at certain providers (e.g., in testing nodes), but it seems that zero is a value that should not be emitted for transactions heading to a \"real\" chain i.e. in production.\r\n\r\nI don't want to bike shed this issue. I guess I'm just making the simple point that this is a bit of a weird value, and since hardhat is *calculating the fee* by delegating that calculation to the chain provider via a percentile, if a production dapp gets back zero, that's very likely a misconfiguration (maybe DNS is not pointed correctly and ended up giving you the test chain, whatever).\r\n\r\nSure I realize this is a pretty innocuous misconfiguration scenario, as the transaction is then likely to simply fail, but IF there is a design principle of not letting through out-of-bounds autogenerated values onto production chains, this seems like such a value.\r\n\r\nEDIT: ... and an alternate behavior would be to throw an exception so the admin can be alerted, and fix the problem.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1632799703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1637745991",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4136#issuecomment-1637745991",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136",
    "id": 1637745991,
    "node_id": "IC_kwDOB7jojM5hngVH",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-17T09:56:24Z",
    "updated_at": "2023-07-17T09:56:54Z",
    "author_association": "MEMBER",
    "body": "> Just for my edification and so that we are on the same page, can you describe how this is useful in many testing scenarios -- assuming you mean in some way beyond the trivial \"I don't want to spend down my fee currency during tests\"?\r\n\r\nSending transactions from impersonated accounts without having to add funds to them is one. Some people also use this to assert how the balance of an account changed during a tx, although that's better done with the [balance change matchers](https://hardhat.org/hardhat-chai-matchers/docs/reference#balance-change).\r\n\r\n> I guess I'm just making the simple point that this is a bit of a weird value, and since hardhat is _calculating the fee_ by delegating that calculation to the chain provider via a percentile, if a production dapp gets back zero, that's very likely a misconfiguration (maybe DNS is not pointed correctly and ended up giving you the test chain, whatever).\r\n\r\nI agree in principle, but this is a design question: if I can possibly detect that there's a problem, even if it's in an external component, should I do it an report a proper message? In some cases the answer is undoubtedly yes (for example, I think we do this when people fork non-archive nodes). In other cases, the answer is no or not yet, mainly because any change like this takes time and adds complexity.\r\n\r\nIn this particular case I'm inclined to say no. If the remote node returns a wrong value, then the user should have enough information to figure out what's the problem. Hardhat would only be the middle man in this case.\r\n\r\nIf it was the case that providers often return a wrong value for some preventable reason, and a lot of users run into that problem, I would probably change my mind.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1637745991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1670792038",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4136#issuecomment-1670792038",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4136",
    "id": 1670792038,
    "node_id": "IC_kwDOB7jojM5jlkNm",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-09T07:10:53Z",
    "updated_at": "2023-08-09T07:10:53Z",
    "author_association": "MEMBER",
    "body": "Tentatively closing this.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1670792038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
