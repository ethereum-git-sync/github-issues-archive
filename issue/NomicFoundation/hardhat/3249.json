{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249",
  "id": 1398213805,
  "node_id": "I_kwDOB7jojM5TVwyt",
  "number": 3249,
  "title": "Load fixture issues",
  "user": {
    "login": "skosito",
    "id": 13931437,
    "node_id": "MDQ6VXNlcjEzOTMxNDM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/13931437?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/skosito",
    "html_url": "https://github.com/skosito",
    "followers_url": "https://api.github.com/users/skosito/followers",
    "following_url": "https://api.github.com/users/skosito/following{/other_user}",
    "gists_url": "https://api.github.com/users/skosito/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/skosito/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/skosito/subscriptions",
    "organizations_url": "https://api.github.com/users/skosito/orgs",
    "repos_url": "https://api.github.com/users/skosito/repos",
    "events_url": "https://api.github.com/users/skosito/events{/privacy}",
    "received_events_url": "https://api.github.com/users/skosito/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2022-10-05T18:43:38Z",
  "updated_at": "2023-02-23T00:15:24Z",
  "closed_at": "2022-11-24T17:23:23Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": "resolved",
  "body": "Sometimes using same fixture in lot of tests throws this error:\r\n\r\n```\r\n FixtureSnapshotError: There was an error reverting the snapshot of the fixture.\r\n\r\nThis might be caused by using nested loadFixture calls in a test, for example by using multiple beforeEach calls. This is not supported yet.\r\n      at loadFixture (node_modules/@nomicfoundation/hardhat-network-helpers/src/loadFixture.ts:47:15)\r\n      at runMicrotasks (<anonymous>)\r\n      at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n      at async recoverViaDistributor (test/Wallet2.ts:111:9)\r\n```\r\n\r\nThere is no nested loadFixture, tests are working properly until some amount of loadFixture calls for same fixture across multiple files (therefore multiple describe blocks), but after, for example 10-15 usages it starts failing. If I take same fixture and just rename it and start using it, it works. Is there some limit or best practices on how to handle using same fixture across a lot of files and tests?",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1268812509",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1268812509",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1268812509,
    "node_id": "IC_kwDOB7jojM5LoIrd",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-10-05T18:44:02Z",
    "updated_at": "2022-10-05T18:44:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-1243/load-fixture-issues-[nomicfoundationhardhat3249]).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 315d53ae-c1e8-4b3e-aa3b-8e0b90cd45b4",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1268812509/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1272424533",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1272424533",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1272424533,
    "node_id": "IC_kwDOB7jojM5L16hV",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-09T00:59:57Z",
    "updated_at": "2022-10-09T00:59:57Z",
    "author_association": "MEMBER",
    "body": "@skosito any chance of creating an [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example) for this problem? I know that these kinds of issues are hard to reduce to its minimal expression, so the second best thing would be to have access to the repo and to have clear reproduction steps.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1272424533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1273414886",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1273414886",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1273414886,
    "node_id": "IC_kwDOB7jojM5L5sTm",
    "user": {
      "login": "skosito",
      "id": 13931437,
      "node_id": "MDQ6VXNlcjEzOTMxNDM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/13931437?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skosito",
      "html_url": "https://github.com/skosito",
      "followers_url": "https://api.github.com/users/skosito/followers",
      "following_url": "https://api.github.com/users/skosito/following{/other_user}",
      "gists_url": "https://api.github.com/users/skosito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skosito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skosito/subscriptions",
      "organizations_url": "https://api.github.com/users/skosito/orgs",
      "repos_url": "https://api.github.com/users/skosito/repos",
      "events_url": "https://api.github.com/users/skosito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skosito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-10T14:36:29Z",
    "updated_at": "2022-10-10T14:36:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @skosito any chance of creating an [minimal reproducible example](https://stackoverflow.com/help/minimal-reproducible-example) for this problem? I know that these kinds of issues are hard to reduce to its minimal expression, so the second best thing would be to have access to the repo and to have clear reproduction steps.\r\n\r\nthanks for reply, access to repo is not possible unfortunately, i will try to create reproducible example",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1273414886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1292677387",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1292677387",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1292677387,
    "node_id": "IC_kwDOB7jojM5NDLEL",
    "user": {
      "login": "skosito",
      "id": 13931437,
      "node_id": "MDQ6VXNlcjEzOTMxNDM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/13931437?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skosito",
      "html_url": "https://github.com/skosito",
      "followers_url": "https://api.github.com/users/skosito/followers",
      "following_url": "https://api.github.com/users/skosito/following{/other_user}",
      "gists_url": "https://api.github.com/users/skosito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skosito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skosito/subscriptions",
      "organizations_url": "https://api.github.com/users/skosito/orgs",
      "repos_url": "https://api.github.com/users/skosito/repos",
      "events_url": "https://api.github.com/users/skosito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skosito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-26T21:34:02Z",
    "updated_at": "2022-10-26T21:49:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fvictorio i am sorry for delay, but here is repo  i put up with min reproduction https://github.com/skosito/hardhat-load-fixture-min-repro, to reproduce just run \r\n```\r\nnpm install\r\nnpx hardhat test\r\n```\r\n\r\nIssue seems to be there when loading different fixtures in same describe or something like that EDIT: actually this is not the case, please check commits as i gradually reduced to really minimum repro example with loading 2 different fixtures in 4 tests without any nesting or anything like that",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1292677387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1294963422",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1294963422",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1294963422,
    "node_id": "IC_kwDOB7jojM5NL5Le",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-28T12:51:38Z",
    "updated_at": "2022-10-28T12:51:38Z",
    "author_association": "MEMBER",
    "body": "Thank your for creating the repro @skosito, I'll take a look as soon as I have some time.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1294963422/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1298391722",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1298391722",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1298391722,
    "node_id": "IC_kwDOB7jojM5NY-Kq",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-01T11:37:55Z",
    "updated_at": "2022-11-01T11:37:55Z",
    "author_association": "MEMBER",
    "body": "Ugh, I see what's going on now. This seems to be a bug of our current implementation.\r\n\r\nThanks a lot for the reproduction example, it was super useful.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1298391722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1298850678",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1298850678",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1298850678,
    "node_id": "IC_kwDOB7jojM5NauN2",
    "user": {
      "login": "skosito",
      "id": 13931437,
      "node_id": "MDQ6VXNlcjEzOTMxNDM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/13931437?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skosito",
      "html_url": "https://github.com/skosito",
      "followers_url": "https://api.github.com/users/skosito/followers",
      "following_url": "https://api.github.com/users/skosito/following{/other_user}",
      "gists_url": "https://api.github.com/users/skosito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skosito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skosito/subscriptions",
      "organizations_url": "https://api.github.com/users/skosito/orgs",
      "repos_url": "https://api.github.com/users/skosito/repos",
      "events_url": "https://api.github.com/users/skosito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skosito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-01T17:12:06Z",
    "updated_at": "2022-11-01T17:12:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Ugh, I see what's going on now. This seems to be a bug of our current implementation.\r\n> \r\n> Thanks a lot for the reproduction example, it was super useful.\r\n\r\n@fvictorio thank you for checking it out, let me know if there is a way to help more, happy to contribute if possible",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1298850678/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299319624",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1299319624",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1299319624,
    "node_id": "IC_kwDOB7jojM5NcgtI",
    "user": {
      "login": "skosito",
      "id": 13931437,
      "node_id": "MDQ6VXNlcjEzOTMxNDM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/13931437?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skosito",
      "html_url": "https://github.com/skosito",
      "followers_url": "https://api.github.com/users/skosito/followers",
      "following_url": "https://api.github.com/users/skosito/following{/other_user}",
      "gists_url": "https://api.github.com/users/skosito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skosito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skosito/subscriptions",
      "organizations_url": "https://api.github.com/users/skosito/orgs",
      "repos_url": "https://api.github.com/users/skosito/repos",
      "events_url": "https://api.github.com/users/skosito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skosito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-01T22:43:23Z",
    "updated_at": "2022-11-01T22:43:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fvictorio sorry for another ping, but i just looked at the code and it seems the issue is that i revert from snapshot 2 to previous snapshot 1 (which is fine), but then try to revert to snapshot 2 which is future state, but blockchain is back to previous state - is that the issue or something else?\r\n\r\nis solution to this problem to have better documentation and let developers take care of this when writing tests, or to maybe every time revert to snapshot happens, all other snapshots with higher snapshotid are removed from snapshot array, and have to be re-added again? because it doesnt make sense to revert to future state, so next time snapshot is moved from 1 to 2, 2 has to execute takeSnapshot again?\r\n\r\npseudo code:\r\n\r\n```\r\nconst restoredSnapshotId = await snapshot.restorer.restore();\r\n\r\nfor (let snapshot of snapshots) {\r\nremove all snapshots with snapshotId > restoredSnapshotId\r\n\r\n}\r\n\r\n```\r\n\r\nor maybe something more clever with evm_increaseTime if possible?\r\n\r\njust trying to understand and learn about this a bit - feel free to ignore, and i can check the fix at the end, just curious ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299319624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299953864",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1299953864",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1299953864,
    "node_id": "IC_kwDOB7jojM5Ne7jI",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T09:46:36Z",
    "updated_at": "2022-11-02T09:46:36Z",
    "author_association": "MEMBER",
    "body": "> or to maybe every time revert to snapshot happens, all other snapshots with higher snapshotid are removed from snapshot array, and have to be re-added again?\r\n\r\nI agree, I think something like this is the solution. It seems like a lot of people are running into this, which sucks, so we'll try to prioritize it.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1299953864/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1300196094",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1300196094",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1300196094,
    "node_id": "IC_kwDOB7jojM5Nf2r-",
    "user": {
      "login": "skosito",
      "id": 13931437,
      "node_id": "MDQ6VXNlcjEzOTMxNDM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/13931437?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skosito",
      "html_url": "https://github.com/skosito",
      "followers_url": "https://api.github.com/users/skosito/followers",
      "following_url": "https://api.github.com/users/skosito/following{/other_user}",
      "gists_url": "https://api.github.com/users/skosito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skosito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skosito/subscriptions",
      "organizations_url": "https://api.github.com/users/skosito/orgs",
      "repos_url": "https://api.github.com/users/skosito/repos",
      "events_url": "https://api.github.com/users/skosito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skosito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T11:49:24Z",
    "updated_at": "2022-11-02T11:50:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fvictorio i tried this fix in project i am working on and it fixed the issues (project has 130 tests and execution time is the same, previously it was failing for some tests because of issue we are discussing here): https://github.com/skosito/hardhat/commit/82a8f327ff0d333cbd99a7a7680db6bd50af5b40\r\n\r\nThe only hardhat test failing after the change is this one:\r\n\r\n```\r\n it(\"should throw the right error when an invalid snapshot is reverted\", async function () {\r\n    async function mineBlockFixture() {\r\n      await mineBlock();\r\n    }\r\n    async function mineTwoBlocksFixture() {\r\n      await mineBlock();\r\n      await mineBlock();\r\n    }\r\n\r\n    await loadFixture(mineBlockFixture);\r\n    await loadFixture(mineTwoBlocksFixture);\r\n    await loadFixture(mineBlockFixture);\r\n    await assert.isRejected(\r\n      loadFixture(mineTwoBlocksFixture),\r\n      FixtureSnapshotError\r\n    );\r\n  });\r\n```\r\n\r\nBut to me it looks like that is exactly situation from my repro example:\r\n1. load fixture 1 (snapshot created)\r\n2. load fixture 2 (snapshot created)\r\n3. load fixture 1 (snapshot exists, revert)\r\n4. load fixture 2 (invalid because it was reverted to previous one already in step 3)\r\n\r\nwith fix above, this test passes now because in step 4 when load fixture 2 happens, that snapshot is removed already in step 3, and it will just takeSnapshot again\r\n\r\nhope this helps, or maybe even i can open PR if you don't see problems with this solution?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1300196094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1326708365",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3249#issuecomment-1326708365",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3249",
    "id": 1326708365,
    "node_id": "IC_kwDOB7jojM5PE_aN",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-24T17:23:23Z",
    "updated_at": "2022-11-24T17:23:23Z",
    "author_association": "MEMBER",
    "body": "Closed by #3327, this will be included in the next release.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1326708365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
