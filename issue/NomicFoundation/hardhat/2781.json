{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2781",
  "id": 1252949957,
  "node_id": "I_kwDOB7jojM5Krn_F",
  "number": 2781,
  "title": "Hardhat Node Stops Emitting Events to Web3js",
  "user": {
    "login": "NatPDeveloper",
    "id": 34429364,
    "node_id": "MDQ6VXNlcjM0NDI5MzY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/34429364?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/NatPDeveloper",
    "html_url": "https://github.com/NatPDeveloper",
    "followers_url": "https://api.github.com/users/NatPDeveloper/followers",
    "following_url": "https://api.github.com/users/NatPDeveloper/following{/other_user}",
    "gists_url": "https://api.github.com/users/NatPDeveloper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/NatPDeveloper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/NatPDeveloper/subscriptions",
    "organizations_url": "https://api.github.com/users/NatPDeveloper/orgs",
    "repos_url": "https://api.github.com/users/NatPDeveloper/repos",
    "events_url": "https://api.github.com/users/NatPDeveloper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/NatPDeveloper/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "feuGeneA",
    "id": 7883777,
    "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/feuGeneA",
    "html_url": "https://github.com/feuGeneA",
    "followers_url": "https://api.github.com/users/feuGeneA/followers",
    "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
    "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
    "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
    "repos_url": "https://api.github.com/users/feuGeneA/repos",
    "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-05-30T16:37:17Z",
  "updated_at": "2022-11-18T00:17:37Z",
  "closed_at": "2022-06-22T16:41:55Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I'm running a hardhat node and a nodejs backend using web3js to capture events ([code][1]) and for some reason the events stop getting caught by web3js.\r\n\r\nThe transactions seem to be firing just fine as I can see them in the logs, but the backend isn't picking them up.\r\n\r\nThis is all being run in separate docker containers on a c5.xlarge ec2 instance on aws.\r\n\r\nI tried increasing the instance class for more memory even though there was memory to spare, so not sure how to troubleshoot from here.\r\n\r\nAnd the contact does emit events successfully at the beginning just not after a period of time. And also if I comment out some of the initial tests, the tests that time out due to the event not being captured succeed.\r\n\r\nYou can recreate the issue by running the unit tests for this repo (https://github.com/DAPPNetworkLabs/dapp-workers/) with:\r\n\r\n```\r\n./scripts/all-test.sh\r\n```\r\n\r\nYou will also need to export an IPFS and ALECHEMY_ADDRESS environment variables\r\n\r\n```\r\nexport IPFS_HOST=HOST_IP\r\nALCHEMY_ADDRESS=https://eth-mainnet.alchemyapi.io/v2/API_KEY_HERE\r\n```\r\n\r\nIf you need an IPFS host IP / Alchemy key to test you can hit me up on Telegram @natpd.\r\n\r\nThis will build the docker images and run the:\r\n- IPFS instance\r\n- Hardhat node forking mainnet with alchemy key\r\n- Orchestrator backend API (dispatches docker container creation)\r\n- Nexus hardhat unit tests with forked mainnet node\r\n\r\nBe sure to add a `.config.json` to `./eth/.config.json` and `./nexus/.config.json` so hardhat has the proper alchemy (https://www.alchemy.com/) keys for forking the ETH mainnet\r\n\r\n    {\r\n        \"alchemyKey\": \"\"\r\n    }\r\n\r\n\r\n  [1]: https://github.com/DAPPNetworkLabs/dapp-workers/blob/main/services/orchestrator/src/index.ts#L308",
  "closed_by": {
    "login": "NatPDeveloper",
    "id": 34429364,
    "node_id": "MDQ6VXNlcjM0NDI5MzY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/34429364?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/NatPDeveloper",
    "html_url": "https://github.com/NatPDeveloper",
    "followers_url": "https://api.github.com/users/NatPDeveloper/followers",
    "following_url": "https://api.github.com/users/NatPDeveloper/following{/other_user}",
    "gists_url": "https://api.github.com/users/NatPDeveloper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/NatPDeveloper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/NatPDeveloper/subscriptions",
    "organizations_url": "https://api.github.com/users/NatPDeveloper/orgs",
    "repos_url": "https://api.github.com/users/NatPDeveloper/repos",
    "events_url": "https://api.github.com/users/NatPDeveloper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/NatPDeveloper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1141336761",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2781#issuecomment-1141336761",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781",
    "id": 1141336761,
    "node_id": "IC_kwDOB7jojM5EB2q5",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-05-30T16:37:44Z",
    "updated_at": "2022-05-30T16:37:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-744/hardhat-node-stops-emitting-events-to-web3js).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: a9841fc3-6c82-4be2-9d35-dc39fe821e06",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1141336761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1163359783",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2781#issuecomment-1163359783",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2781",
    "id": 1163359783,
    "node_id": "IC_kwDOB7jojM5FV3Yn",
    "user": {
      "login": "NatPDeveloper",
      "id": 34429364,
      "node_id": "MDQ6VXNlcjM0NDI5MzY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/34429364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NatPDeveloper",
      "html_url": "https://github.com/NatPDeveloper",
      "followers_url": "https://api.github.com/users/NatPDeveloper/followers",
      "following_url": "https://api.github.com/users/NatPDeveloper/following{/other_user}",
      "gists_url": "https://api.github.com/users/NatPDeveloper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NatPDeveloper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NatPDeveloper/subscriptions",
      "organizations_url": "https://api.github.com/users/NatPDeveloper/orgs",
      "repos_url": "https://api.github.com/users/NatPDeveloper/repos",
      "events_url": "https://api.github.com/users/NatPDeveloper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NatPDeveloper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-22T16:41:55Z",
    "updated_at": "2022-06-22T16:41:55Z",
    "author_association": "NONE",
    "body": "It seems the issue is having more than 10 concurrent event channels opened at a time.\r\n\r\nAfter receiving the desired event or hitting a timeout you can use the following if using [ethers js](https://docs.ethers.io/v4/api-contract.html?highlight=removealllisteners#event-emitter).\r\n\r\n```\r\nawait contract.removeAllListeners(event);\r\n```\r\n\r\nI'll reopen if that's not the case, thanks.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1163359783/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
