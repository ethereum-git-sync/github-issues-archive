{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2869",
  "id": 1277326138,
  "node_id": "I_kwDOB7jojM5MInM6",
  "number": 2869,
  "title": "FATAL ERROR: Reached heap limit Allocation failed - HH Network Reset",
  "user": {
    "login": "julianmrodri",
    "id": 56316686,
    "node_id": "MDQ6VXNlcjU2MzE2Njg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/56316686?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/julianmrodri",
    "html_url": "https://github.com/julianmrodri",
    "followers_url": "https://api.github.com/users/julianmrodri/followers",
    "following_url": "https://api.github.com/users/julianmrodri/following{/other_user}",
    "gists_url": "https://api.github.com/users/julianmrodri/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/julianmrodri/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/julianmrodri/subscriptions",
    "organizations_url": "https://api.github.com/users/julianmrodri/orgs",
    "repos_url": "https://api.github.com/users/julianmrodri/repos",
    "events_url": "https://api.github.com/users/julianmrodri/events{/privacy}",
    "received_events_url": "https://api.github.com/users/julianmrodri/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-06-20T19:48:19Z",
  "updated_at": "2023-03-28T00:15:45Z",
  "closed_at": "2022-12-27T13:51:35Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "We are facing a `FATAL ERROR: Reached heap limit Allocation failed` crash in all our Tests that perform a `hardhat_reset` action. This does not happen locally and only occurs when running in Github Actions (CI). The error thrown in CI (Github action) is the following:\r\n\r\n```\r\n<--- Last few GCs --->\r\n[2095:0x62c1840]    23100 ms: Scavenge (reduce) 2046.7 (2082.8) -> 2046.7 (2083.8) MB, 8.1 / 0.0 ms  (average mu = 0.298, current mu = 0.159) allocation failure \r\n[2095:0x62c1840]    23947 ms: Mark-sweep (reduce) 2047.6 (2083.8) -> 2047.5 (2084.5) MB, 786.2 / 0.0 ms  (+ 309.4 ms in 98 steps since start of marking, biggest step 14.6 ms, walltime since start of marking 1154 ms) (average mu = 0.221, current mu = 0.085\r\n<--- JS stacktrace --->\r\nFATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory\r\n....\r\n```\r\n\r\nHere I provide a simplified repo that can be used to reproduce the issue: https://github.com/julianmrodri/hhreset-ci-issue \r\nInstructions have been provided in the repo to reproduce and understand what could be causing this failure.\r\n\r\n**HINT:** An interesting thing we noticed is that this error can be fixed by simply removing one of the contracts in our repo, although this contract is NOT USED in any test or deployment script. Which indicates there might be some types of contracts that break the HH Network during CI execution, even if they are not used in the actual test. A PR has been created in the provided repo so you can take a look how this fixes the issue.\r\n\r\nAny additional information you need please let me know.",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1160793916",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2869#issuecomment-1160793916",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869",
    "id": 1160793916,
    "node_id": "IC_kwDOB7jojM5FME88",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-06-20T19:48:42Z",
    "updated_at": "2022-06-20T19:48:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-873/fatal-error-reached-heap-limit-allocation-failed-hh-network-reset).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 54fc18a3-628d-494f-83a9-ae42c61487a7",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1160793916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1180809623",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2869#issuecomment-1180809623",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869",
    "id": 1180809623,
    "node_id": "IC_kwDOB7jojM5GYbmX",
    "user": {
      "login": "julianmrodri",
      "id": 56316686,
      "node_id": "MDQ6VXNlcjU2MzE2Njg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/56316686?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/julianmrodri",
      "html_url": "https://github.com/julianmrodri",
      "followers_url": "https://api.github.com/users/julianmrodri/followers",
      "following_url": "https://api.github.com/users/julianmrodri/following{/other_user}",
      "gists_url": "https://api.github.com/users/julianmrodri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/julianmrodri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/julianmrodri/subscriptions",
      "organizations_url": "https://api.github.com/users/julianmrodri/orgs",
      "repos_url": "https://api.github.com/users/julianmrodri/repos",
      "events_url": "https://api.github.com/users/julianmrodri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/julianmrodri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T19:59:06Z",
    "updated_at": "2022-07-11T19:59:06Z",
    "author_association": "NONE",
    "body": "Hi.. as additional detail, this issue can be also replicated locally running `npx hardhat coverage`.\r\n\r\nTo replicate do this: \r\n\r\n1- Clone provided repo on Issue description \r\n2- install dependencies and compile contracts  \r\n3 - On `master` run `npx hardhat coverage`. This would throw the FATAL ERROR. If you simply delete `contracts/fuzz/RTokenDiff.sol` and run again `npx hardhat coverage` works fine! Even though the contract is not used anywhere it breaks the coverage execution.\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1180809623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1224202910",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2869#issuecomment-1224202910",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869",
    "id": 1224202910,
    "node_id": "IC_kwDOB7jojM5I99qe",
    "user": {
      "login": "julianmrodri",
      "id": 56316686,
      "node_id": "MDQ6VXNlcjU2MzE2Njg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/56316686?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/julianmrodri",
      "html_url": "https://github.com/julianmrodri",
      "followers_url": "https://api.github.com/users/julianmrodri/followers",
      "following_url": "https://api.github.com/users/julianmrodri/following{/other_user}",
      "gists_url": "https://api.github.com/users/julianmrodri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/julianmrodri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/julianmrodri/subscriptions",
      "organizations_url": "https://api.github.com/users/julianmrodri/orgs",
      "repos_url": "https://api.github.com/users/julianmrodri/repos",
      "events_url": "https://api.github.com/users/julianmrodri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/julianmrodri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-23T15:03:31Z",
    "updated_at": "2022-08-23T15:03:31Z",
    "author_association": "NONE",
    "body": "Hi, any updates about this? Was anyone able to replicate? Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1224202910/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1226077230",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2869#issuecomment-1226077230",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869",
    "id": 1226077230,
    "node_id": "IC_kwDOB7jojM5JFHQu",
    "user": {
      "login": "feuGeneA",
      "id": 7883777,
      "node_id": "MDQ6VXNlcjc4ODM3Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7883777?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feuGeneA",
      "html_url": "https://github.com/feuGeneA",
      "followers_url": "https://api.github.com/users/feuGeneA/followers",
      "following_url": "https://api.github.com/users/feuGeneA/following{/other_user}",
      "gists_url": "https://api.github.com/users/feuGeneA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feuGeneA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feuGeneA/subscriptions",
      "organizations_url": "https://api.github.com/users/feuGeneA/orgs",
      "repos_url": "https://api.github.com/users/feuGeneA/repos",
      "events_url": "https://api.github.com/users/feuGeneA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feuGeneA/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T18:21:35Z",
    "updated_at": "2022-08-24T18:21:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for your patience. This is high on our team's list of items to triage.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1226077230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1365916578",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2869#issuecomment-1365916578",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2869",
    "id": 1365916578,
    "node_id": "IC_kwDOB7jojM5Rajui",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-27T13:51:35Z",
    "updated_at": "2022-12-27T13:51:35Z",
    "author_association": "MEMBER",
    "body": "Hey @julianmrodri, thanks for the great reproduction repo and sorry for not responding sooner.\r\n\r\nI could indeed reproduce the problem, but I also noticed that upgrading both Hardhat and solidity-coverage to their latest versions seems to fix it. My guess is that this was fixed by an improvement we implemented in our compilation pipeline, which made many OOM errors like this go away.\r\n\r\nI'm going to tentatively close this now, but please let me know if you are still running into this after upgrading.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1365916578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
