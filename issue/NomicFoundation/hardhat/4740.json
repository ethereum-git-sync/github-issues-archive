{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4740",
  "id": 2068790375,
  "node_id": "I_kwDOB7jojM57Tzxn",
  "number": 4740,
  "title": "eth_getBlockByHash Returns Nulls After About 1 Hour",
  "user": {
    "login": "timolson",
    "id": 1697115,
    "node_id": "MDQ6VXNlcjE2OTcxMTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1697115?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timolson",
    "html_url": "https://github.com/timolson",
    "followers_url": "https://api.github.com/users/timolson/followers",
    "following_url": "https://api.github.com/users/timolson/following{/other_user}",
    "gists_url": "https://api.github.com/users/timolson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timolson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timolson/subscriptions",
    "organizations_url": "https://api.github.com/users/timolson/orgs",
    "repos_url": "https://api.github.com/users/timolson/repos",
    "events_url": "https://api.github.com/users/timolson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timolson/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2474207618,
      "node_id": "MDU6TGFiZWwyNDc0MjA3NjE4",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:needs-more-info",
      "name": "status:needs-more-info",
      "color": "0E8A16",
      "default": false,
      "description": "There's not enough information to start working on this issue"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "schaable",
    "id": 1165424,
    "node_id": "MDQ6VXNlcjExNjU0MjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1165424?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/schaable",
    "html_url": "https://github.com/schaable",
    "followers_url": "https://api.github.com/users/schaable/followers",
    "following_url": "https://api.github.com/users/schaable/following{/other_user}",
    "gists_url": "https://api.github.com/users/schaable/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/schaable/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/schaable/subscriptions",
    "organizations_url": "https://api.github.com/users/schaable/orgs",
    "repos_url": "https://api.github.com/users/schaable/repos",
    "events_url": "https://api.github.com/users/schaable/events{/privacy}",
    "received_events_url": "https://api.github.com/users/schaable/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "schaable",
      "id": 1165424,
      "node_id": "MDQ6VXNlcjExNjU0MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1165424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/schaable",
      "html_url": "https://github.com/schaable",
      "followers_url": "https://api.github.com/users/schaable/followers",
      "following_url": "https://api.github.com/users/schaable/following{/other_user}",
      "gists_url": "https://api.github.com/users/schaable/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/schaable/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/schaable/subscriptions",
      "organizations_url": "https://api.github.com/users/schaable/orgs",
      "repos_url": "https://api.github.com/users/schaable/repos",
      "events_url": "https://api.github.com/users/schaable/events{/privacy}",
      "received_events_url": "https://api.github.com/users/schaable/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2024-01-06T19:21:22Z",
  "updated_at": "2024-01-29T21:07:31Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.19.1\r\n\r\n### What happened?\r\n\r\neth_getBlockByHash returns block data for about an hour, then Hardhat starts always returning a null response.\r\n\r\n### Minimal reproduction steps\r\n\r\n1. start hardhat in fork mode.  we are forking from arbitrum.  use interval mining instead of automine.  we use 2 seconds.\r\n2. detect blocks using polling.  Note that Hardhat websockets subscription to `newHeads` breaks after 5 minutes (issue #2053) I mention this in case a similar timeout related to the upstream fork is relevant to this issue.\r\n3. Call eth_getBlockByHash for each block detected (second argument is false; no need for full tx data)\r\n4. Wait about an hour\r\n5. eth_getBlockByHash stops returning data.  our python client reports \"None\" as if the blockhash were unknown to hardhat.\r\n\r\n\r\n### Search terms\r\n\r\n_No response_",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1882549521",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4740#issuecomment-1882549521",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740",
    "id": 1882549521,
    "node_id": "IC_kwDOB7jojM5wNW0R",
    "user": {
      "login": "karladointheemost",
      "id": 133444290,
      "node_id": "U_kgDOB_Qywg",
      "avatar_url": "https://avatars.githubusercontent.com/u/133444290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karladointheemost",
      "html_url": "https://github.com/karladointheemost",
      "followers_url": "https://api.github.com/users/karladointheemost/followers",
      "following_url": "https://api.github.com/users/karladointheemost/following{/other_user}",
      "gists_url": "https://api.github.com/users/karladointheemost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karladointheemost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karladointheemost/subscriptions",
      "organizations_url": "https://api.github.com/users/karladointheemost/orgs",
      "repos_url": "https://api.github.com/users/karladointheemost/repos",
      "events_url": "https://api.github.com/users/karladointheemost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karladointheemost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-09T07:39:59Z",
    "updated_at": "2024-01-09T07:39:59Z",
    "author_association": "NONE",
    "body": "How can I fix",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1882549521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1914848190",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4740#issuecomment-1914848190",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740",
    "id": 1914848190,
    "node_id": "IC_kwDOB7jojM5yIkO-",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-29T14:49:02Z",
    "updated_at": "2024-01-29T14:49:02Z",
    "author_association": "MEMBER",
    "body": "Hey @timolson, sorry for not responding before.\r\n\r\nIf I remember correctly, `newHeads` will give you the number of the block, not the hash. But you mentioned that you are using `eth_getBlockByHash` with the payload of the event. Did you mean to say `byNumber` or is there a step missing in your reproduction steps?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1914848190/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1915553027",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4740#issuecomment-1915553027",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4740",
    "id": 1915553027,
    "node_id": "IC_kwDOB7jojM5yLQUD",
    "user": {
      "login": "timolson",
      "id": 1697115,
      "node_id": "MDQ6VXNlcjE2OTcxMTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1697115?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/timolson",
      "html_url": "https://github.com/timolson",
      "followers_url": "https://api.github.com/users/timolson/followers",
      "following_url": "https://api.github.com/users/timolson/following{/other_user}",
      "gists_url": "https://api.github.com/users/timolson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/timolson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timolson/subscriptions",
      "organizations_url": "https://api.github.com/users/timolson/orgs",
      "repos_url": "https://api.github.com/users/timolson/repos",
      "events_url": "https://api.github.com/users/timolson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/timolson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-29T20:56:51Z",
    "updated_at": "2024-01-29T21:07:31Z",
    "author_association": "NONE",
    "body": "`newHeads` publishes the regular block metadata (without tx's.)  This sample is from Hardhat running interval mining:\r\n\r\n```json\r\n{'number': 175496110, 'hash': '0xbd28f56ca31dae961a4f84511e6d10868af89934bb3f475bfe1f0352cbfa3e01', 'parentHash': '0x590f55260c9312a2e11ea93ab53f6423c6bc273cff74b49bbc1f0ec1c5264146', 'nonce': '0x0000000000000000', 'mixHash': '0x0e14a79a0239e05e71b66e458f2728889de94dfacfbec0c3f330728db80506dc', 'sha3Uncles': '0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347', 'logsBloom': '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000', 'transactionsRoot': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421', 'stateRoot': '0x66a80b61b29ec044d14c4c8c613e762ba1fb8eeb0c454d1ee00ed6dedaa5b5c5', 'receiptsRoot': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421', 'miner': '0xC014BA5EC014ba5ec014Ba5EC014ba5Ec014bA5E', 'difficulty': 0, 'totalDifficulty': 153287932, 'extraData': '0x', 'size': 548, 'gasLimit': 30000000, 'gasUsed': 0, 'timestamp': 1706561001, 'transactions': [], 'uncles': [], 'baseFeePerGas': 7, 'withdrawals': [], 'withdrawalsRoot': '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421'}\r\n```\r\n\r\nWe use block hashes in all our queries to prevent race conditions during reorgs and alleviate any reliance on nodes to report event undos.  TBH, I don't see how a reliable system could be built on block numbers instead of hashes, unless you wait for blocks to age into finalization first.  Otherwise, what happens when the rpc node goes down in the middle of a reorg and doesn't report an event undo? Well that's a different discussion; I'm just motivating our usage of the API.\r\n\r\nThis issue with getBlockByHash does affect _recent_ blocks.  We are querying the block tx's and some events immediately after detecting the new head.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1915553027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
