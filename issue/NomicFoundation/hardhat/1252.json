{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252",
  "id": 808598140,
  "node_id": "MDU6SXNzdWU4MDg1OTgxNDA=",
  "number": 1252,
  "title": "Transaction reverted and Hardhat couldn't infer the reason: static call to non-static function",
  "user": {
    "login": "josojo",
    "id": 7348154,
    "node_id": "MDQ6VXNlcjczNDgxNTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7348154?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/josojo",
    "html_url": "https://github.com/josojo",
    "followers_url": "https://api.github.com/users/josojo/followers",
    "following_url": "https://api.github.com/users/josojo/following{/other_user}",
    "gists_url": "https://api.github.com/users/josojo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/josojo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/josojo/subscriptions",
    "organizations_url": "https://api.github.com/users/josojo/orgs",
    "repos_url": "https://api.github.com/users/josojo/repos",
    "events_url": "https://api.github.com/users/josojo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/josojo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-02-15T14:47:23Z",
  "updated_at": "2022-11-18T10:03:23Z",
  "closed_at": "2021-06-17T12:22:19Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hi,\r\n\r\nI got the following error:\r\n\r\n```\r\nAssertionError: Expected transaction to be reverted with function call to a non-contract account, but other exception was thrown: Error: Transaction reverted and Hardhat couldn't infer the reason. Please report this to help us improve Hardhat.\r\n```\r\nI am reporting it, as you guys might want to improve it. No worries, I will not bother you with fixing it quickly, as it is a minor issue...\r\n\r\nThis happens, if I am using a static contract call from one contract into another contract, but the other contract is actually trying to modify code:\r\n\r\nI used the following interface with the VIEW function:\r\n```\r\n///\r\n/// @dev Standardized interface for an allowList manager for easyAuction\r\n/// The interface was inspired by EIP-1271\r\ninterface AllowListVerifier {\r\n    /// @dev Should return whether the a specific user has access to an auction\r\n    /// by returning the magic value from AllowListVerifierHelper\r\n    function isAllowed(\r\n        address user,\r\n        uint256 auctionId,\r\n        bytes calldata callData\r\n    ) external view returns (bytes4);\r\n}\r\n```\r\n\r\nBut called the following contract that does not follow the interface:\r\n```\r\ncontract StateChangingAllowListVerifier {\r\n    bytes32 public test = bytes32(0);\r\n\r\n    function isAllowed(\r\n        address user,\r\n        uint256 auctionId,\r\n        bytes calldata callData\r\n    ) external returns (bytes4) {\r\n        test = keccak256(abi.encode(user, auctionId, callData));\r\n       return bytes4(0);\r\n    }\r\n}\r\n```\r\n\r\nI was only doing that for test purposes, in order to make sure that the tx failed. ",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/779346872",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-779346872",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 779346872,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTM0Njg3Mg==",
    "user": {
      "login": "fedgiac",
      "id": 58218759,
      "node_id": "MDQ6VXNlcjU4MjE4NzU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/58218759?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fedgiac",
      "html_url": "https://github.com/fedgiac",
      "followers_url": "https://api.github.com/users/fedgiac/followers",
      "following_url": "https://api.github.com/users/fedgiac/following{/other_user}",
      "gists_url": "https://api.github.com/users/fedgiac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fedgiac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fedgiac/subscriptions",
      "organizations_url": "https://api.github.com/users/fedgiac/orgs",
      "repos_url": "https://api.github.com/users/fedgiac/repos",
      "events_url": "https://api.github.com/users/fedgiac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fedgiac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-15T16:57:16Z",
    "updated_at": "2021-02-15T16:57:16Z",
    "author_association": "NONE",
    "body": "In case it helps, here is a minimal working example.\r\n\r\nSolidity:\r\n```\r\ninterface UnchangedState {\r\n    function test() external view;\r\n}\r\n\r\ncontract ChangingState {\r\n    uint256 state = 0;\r\n\r\n    function test() external /* not view */\r\n    {\r\n        state += 1;\r\n    }\r\n}\r\n\r\ncontract ExpectUnchangedState {\r\n    function callTest(UnchangedState c) public {\r\n        c.test();\r\n    }\r\n}\r\n```\r\n\r\nTest:\r\n```\r\nit(\"reverts\", async () => {\r\n  const ChangingState = await ethers.getContractFactory(\"ChangingState\");\r\n  const changingState = await ChangingState.deploy();\r\n  const ExpectUnchangedState = await ethers.getContractFactory(\"ExpectUnchangedState\");\r\n  const expectUnchangedState = await ExpectUnchangedState.deploy();\r\n\r\n  await expectUnchangedState.callTest(changingState.address);\r\n});\r\n```\r\n\r\nOutput of `hardhat test`:\r\n```\r\n1) reverts\r\n\r\n  0 passing (1s)\r\n  1 failing\r\n\r\n  1) reverts:\r\n     Error: Transaction reverted and Hardhat couldn't infer the reason. Please report this to help us improve Hardhat.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/779346872/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/779766717",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-779766717",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 779766717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTc2NjcxNw==",
    "user": {
      "login": "CodeSandwich",
      "id": 26183680,
      "node_id": "MDQ6VXNlcjI2MTgzNjgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/26183680?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CodeSandwich",
      "html_url": "https://github.com/CodeSandwich",
      "followers_url": "https://api.github.com/users/CodeSandwich/followers",
      "following_url": "https://api.github.com/users/CodeSandwich/following{/other_user}",
      "gists_url": "https://api.github.com/users/CodeSandwich/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CodeSandwich/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CodeSandwich/subscriptions",
      "organizations_url": "https://api.github.com/users/CodeSandwich/orgs",
      "repos_url": "https://api.github.com/users/CodeSandwich/repos",
      "events_url": "https://api.github.com/users/CodeSandwich/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CodeSandwich/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T11:10:43Z",
    "updated_at": "2021-02-16T11:10:43Z",
    "author_association": "NONE",
    "body": "Looks very similar to https://github.com/nomiclabs/hardhat/issues/1227",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/779766717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/782036280",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-782036280",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 782036280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjAzNjI4MA==",
    "user": {
      "login": "jamesmorgan",
      "id": 110869,
      "node_id": "MDQ6VXNlcjExMDg2OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/110869?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesmorgan",
      "html_url": "https://github.com/jamesmorgan",
      "followers_url": "https://api.github.com/users/jamesmorgan/followers",
      "following_url": "https://api.github.com/users/jamesmorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesmorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesmorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesmorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesmorgan/orgs",
      "repos_url": "https://api.github.com/users/jamesmorgan/repos",
      "events_url": "https://api.github.com/users/jamesmorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesmorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-19T12:10:03Z",
    "updated_at": "2021-02-19T12:10:03Z",
    "author_association": "NONE",
    "body": "Yep also seeing this alot - hoping for a fix 🙏🏻 ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/782036280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/863192950",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-863192950",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 863192950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzE5Mjk1MA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T12:22:19Z",
    "updated_at": "2021-06-17T12:22:19Z",
    "author_association": "MEMBER",
    "body": "Hi everyone. Hardhat [2.4.0](https://github.com/nomiclabs/hardhat/releases/tag/hardhat-core-v2.4.0) comes with an improved error detection mechanism that should fix problems like these. I'm going to tentatively close this issue, but please re-open if you are still getting the same results.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/863192950/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/863205533",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-863205533",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 863205533,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzIwNTUzMw==",
    "user": {
      "login": "fedgiac",
      "id": 58218759,
      "node_id": "MDQ6VXNlcjU4MjE4NzU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/58218759?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fedgiac",
      "html_url": "https://github.com/fedgiac",
      "followers_url": "https://api.github.com/users/fedgiac/followers",
      "following_url": "https://api.github.com/users/fedgiac/following{/other_user}",
      "gists_url": "https://api.github.com/users/fedgiac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fedgiac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fedgiac/subscriptions",
      "organizations_url": "https://api.github.com/users/fedgiac/orgs",
      "repos_url": "https://api.github.com/users/fedgiac/repos",
      "events_url": "https://api.github.com/users/fedgiac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fedgiac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T12:41:29Z",
    "updated_at": "2021-06-17T12:41:29Z",
    "author_association": "NONE",
    "body": "Thanks for keeping us up to date! Unfortunately it doesn't look like this specific issue has been solver:\r\n\r\n```\r\n$ npx hardhat --version\r\n2.4.0\r\n$ npx hardhat test\r\n\r\n\r\n  Test\r\n    1) reverts\r\n\r\n\r\n  0 passing (841ms)\r\n  1 failing\r\n\r\n  1) Test\r\n       reverts:\r\n     Error: Transaction reverted and Hardhat couldn't infer the reason. Please report this to help us improve Hardhat.\r\n      at ChangingState.test (contracts/Test.sol:10)\r\n      at ExpectUnchangedState.callTest (contracts/Test.sol:16)\r\n      at processTicksAndRejections (internal/process/task_queues.js:95:5)\r\n      at runNextTicks (internal/process/task_queues.js:64:3)\r\n      at listOnTimeout (internal/timers.js:524:9)\r\n      at processTimers (internal/timers.js:498:7)\r\n      at HardhatNode._mineBlockWithPendingTxs (node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1261:23)\r\n      at HardhatNode.mineBlock (node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:384:16)\r\n      at EthModule._sendTransactionAndReturnHash (node_modules/hardhat/src/internal/hardhat-network/provider/modules/eth.ts:1379:18)\r\n```\r\n\r\nI used the same configuration as the sample project from `hardhat init` and the code from my previous message.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/863205533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/863329400",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-863329400",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 863329400,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzMyOTQwMA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T15:18:12Z",
    "updated_at": "2021-06-17T15:18:12Z",
    "author_association": "MEMBER",
    "body": "@fedgiac I think that's kind of the same issue as [this one](https://github.com/nomiclabs/hardhat/issues/1320). You are not using a proxy, but the idea is the same: we should detect somehow that a write was done during a static call.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/863329400/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1076379394",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1252#issuecomment-1076379394",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1252",
    "id": 1076379394,
    "node_id": "IC_kwDOB7jojM5AKD8C",
    "user": {
      "login": "jamiehewitt15",
      "id": 20739535,
      "node_id": "MDQ6VXNlcjIwNzM5NTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/20739535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamiehewitt15",
      "html_url": "https://github.com/jamiehewitt15",
      "followers_url": "https://api.github.com/users/jamiehewitt15/followers",
      "following_url": "https://api.github.com/users/jamiehewitt15/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamiehewitt15/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamiehewitt15/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamiehewitt15/subscriptions",
      "organizations_url": "https://api.github.com/users/jamiehewitt15/orgs",
      "repos_url": "https://api.github.com/users/jamiehewitt15/repos",
      "events_url": "https://api.github.com/users/jamiehewitt15/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamiehewitt15/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-23T13:31:39Z",
    "updated_at": "2022-03-23T13:31:39Z",
    "author_association": "NONE",
    "body": "Getting the same error `Error: Transaction reverted and Hardhat couldn't infer the reason. Please report this to help us improve Hardhat.` while using hardhat `2.7.0` would be great to get a more specific error message ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1076379394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
