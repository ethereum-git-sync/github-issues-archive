{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1343",
  "id": 836882266,
  "node_id": "MDU6SXNzdWU4MzY4ODIyNjY=",
  "number": 1343,
  "title": "Artifact deployment and contract function calls doesn't mine when auto mining is off and interval is 0",
  "user": {
    "login": "notsegfault",
    "id": 72655700,
    "node_id": "MDQ6VXNlcjcyNjU1NzAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/72655700?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/notsegfault",
    "html_url": "https://github.com/notsegfault",
    "followers_url": "https://api.github.com/users/notsegfault/followers",
    "following_url": "https://api.github.com/users/notsegfault/following{/other_user}",
    "gists_url": "https://api.github.com/users/notsegfault/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/notsegfault/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/notsegfault/subscriptions",
    "organizations_url": "https://api.github.com/users/notsegfault/orgs",
    "repos_url": "https://api.github.com/users/notsegfault/repos",
    "events_url": "https://api.github.com/users/notsegfault/events{/privacy}",
    "received_events_url": "https://api.github.com/users/notsegfault/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-03-20T18:35:35Z",
  "updated_at": "2022-11-18T18:48:24Z",
  "closed_at": "2021-05-28T22:26:15Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I am trying to use the latest Mining modes and I have an issue when using auto to false and interval to 0.\r\n\r\n```javascript\r\n[...]\r\nmining: {\r\n  auto: false,\r\n  interval: 0\r\n},\r\n[...]\r\n```\r\n\r\nFor example, creating a new contract like this:\r\n```javascript\r\nMyArtifact.new(...parameters);\r\n```\r\nstalls forever.\r\n\r\nAs a workaround I have been calling `hardhat_intervalMine` after some milliseconds, to manually mine a block before waiting for the contract deployment promise.\r\n\r\nIt's working but then all the functions of the contracts, when called are having the same issue and stall forever as well.\r\n\r\nI tried to wrap all the contracts' function inside a wrapper that calls  `hardhat_intervalMine`  but it's not working very well and I feel that at this point it should be reported as an issue hence the current github issue.\r\n\r\n```javascript\r\nconst promise = artifact.new(...parameters);\r\nawait new Promise(r => setTimeout(r, 500));\r\nawait triggerIntervalMine();\r\nconst contract = await promise;\r\n\r\nObject.keys(contract).filter(key => {\r\n  return typeof contract[key] === 'function' &&\r\n  key !== \"constructor\"\r\n}).forEach(fn => {\r\n  const originalFn = contract[fn];\r\n  contract[fn] = async (...parameters) => {\r\n    console.log(`${fn.toString()} called... `);\r\n    const promise = originalFn(...parameters);\r\n\r\n    await new Promise(r => setTimeout(r, 500));\r\n    await triggerIntervalMine();\r\n\r\n    return promise;\r\n  }\r\n});\r\n\r\nconsole.log('Deploying...');\r\nreturn contract;\r\n```\r\n\r\nAm I missing something, I didn't see any mention of this in the documentation.\r\n\r\nThanks!",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803442149",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1343#issuecomment-803442149",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343",
    "id": 803442149,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzQ0MjE0OQ==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-20T18:40:50Z",
    "updated_at": "2021-03-20T18:40:50Z",
    "author_association": "MEMBER",
    "body": "That seems like the expected behavior to me. What were you expecting instead?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803442149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803453433",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1343#issuecomment-803453433",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343",
    "id": 803453433,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzQ1MzQzMw==",
    "user": {
      "login": "x3devships",
      "id": 70992370,
      "node_id": "MDQ6VXNlcjcwOTkyMzcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/70992370?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/x3devships",
      "html_url": "https://github.com/x3devships",
      "followers_url": "https://api.github.com/users/x3devships/followers",
      "following_url": "https://api.github.com/users/x3devships/following{/other_user}",
      "gists_url": "https://api.github.com/users/x3devships/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/x3devships/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/x3devships/subscriptions",
      "organizations_url": "https://api.github.com/users/x3devships/orgs",
      "repos_url": "https://api.github.com/users/x3devships/repos",
      "events_url": "https://api.github.com/users/x3devships/events{/privacy}",
      "received_events_url": "https://api.github.com/users/x3devships/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-20T19:44:17Z",
    "updated_at": "2021-03-20T19:47:22Z",
    "author_association": "NONE",
    "body": "> That seems like the expected behavior to me. What were you expecting instead?\r\n\r\nWe expect that if I create a new contract using the .new keyword, the test code continues running. If I await Contract.new(), it will hang the script forever. If i don't await Contract.new(), and then manually mine a block, the return value of Contract.new() is still an unfulfilled promise. \r\n\r\n```\r\nawait SomeContract.new(); // This hangs forever\r\n```\r\n\r\n```\r\nfunction advanceBlock () {\r\n  return promisify(web3.currentProvider.send.bind(web3.currentProvider))({\r\n    jsonrpc: '2.0',\r\n    method: 'evm_mine',\r\n    id: new Date().getTime(),\r\n  });\r\n}\r\nconst instance = SomeContract.new();\r\nawait advanceBlock();\r\n// instance is a pending Promise object\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803453433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803454231",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1343#issuecomment-803454231",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343",
    "id": 803454231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzQ1NDIzMQ==",
    "user": {
      "login": "x3devships",
      "id": 70992370,
      "node_id": "MDQ6VXNlcjcwOTkyMzcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/70992370?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/x3devships",
      "html_url": "https://github.com/x3devships",
      "followers_url": "https://api.github.com/users/x3devships/followers",
      "following_url": "https://api.github.com/users/x3devships/following{/other_user}",
      "gists_url": "https://api.github.com/users/x3devships/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/x3devships/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/x3devships/subscriptions",
      "organizations_url": "https://api.github.com/users/x3devships/orgs",
      "repos_url": "https://api.github.com/users/x3devships/repos",
      "events_url": "https://api.github.com/users/x3devships/events{/privacy}",
      "received_events_url": "https://api.github.com/users/x3devships/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-20T19:50:40Z",
    "updated_at": "2021-03-20T19:51:05Z",
    "author_association": "NONE",
    "body": "Correction: it's not hanging forever, its just timing out after a very long time, like 700 seconds or something I think. The point remains that Contract.new() produces a promise that is forever unfulfilled though.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803454231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803496382",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1343#issuecomment-803496382",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343",
    "id": 803496382,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzQ5NjM4Mg==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-21T01:28:32Z",
    "updated_at": "2021-03-21T01:28:32Z",
    "author_association": "MEMBER",
    "body": "Thanks for the explanation. I would also expect that promise to resolve onces the block is mined. I think this should be reported to truffle, as that's part of @truffle/contract.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/803496382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/850703526",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1343#issuecomment-850703526",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1343",
    "id": 850703526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MDcwMzUyNg==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-28T22:26:15Z",
    "updated_at": "2021-05-28T22:26:15Z",
    "author_association": "MEMBER",
    "body": "Closing this. Please re-open if you think there's something we can do on our side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/850703526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
