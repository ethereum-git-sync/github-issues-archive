{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/990",
  "id": 736459686,
  "node_id": "MDU6SXNzdWU3MzY0NTk2ODY=",
  "number": 990,
  "title": "Gas usage does not match that of mainnet",
  "user": {
    "login": "ItsNickBarry",
    "id": 1500628,
    "node_id": "MDQ6VXNlcjE1MDA2Mjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1500628?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ItsNickBarry",
    "html_url": "https://github.com/ItsNickBarry",
    "followers_url": "https://api.github.com/users/ItsNickBarry/followers",
    "following_url": "https://api.github.com/users/ItsNickBarry/following{/other_user}",
    "gists_url": "https://api.github.com/users/ItsNickBarry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ItsNickBarry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ItsNickBarry/subscriptions",
    "organizations_url": "https://api.github.com/users/ItsNickBarry/orgs",
    "repos_url": "https://api.github.com/users/ItsNickBarry/repos",
    "events_url": "https://api.github.com/users/ItsNickBarry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ItsNickBarry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 16,
  "created_at": "2020-11-04T22:16:55Z",
  "updated_at": "2022-11-18T18:42:30Z",
  "closed_at": "2021-06-10T22:38:00Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": "resolved",
  "body": "See the linked repository for reproduction steps.\r\n\r\nThe test here indicates that the gas usage for the `AirdropToken#airdrop` function uses about 5 million gas for the given inputs:\r\nhttps://github.com/jusdefi/jusdefi/blob/2c32d238559773e9b5007da3981502812189909d/test/airdrop_token.js#L106\r\n\r\nThe same estimate is returned on both Hardhat Network and Ganache.\r\n\r\nThe script here would not run because the estimated gas requirement, for the same inputs:\r\nhttps://github.com/jusdefi/jusdefi/blob/master/scripts/airdrop.js\r\n\r\nReducing the size of the inputs (`require('airdrop-ledger/airdrops.json').slice(0, 130)`) yields a gas estimate of about 1.5 million.  However, the mainnet transaction cost about 3.3 million: https://etherscan.io/tx/0x11f1950bf18553a7d39e13cd117b3958946507f3d622e7b0981e6ac36ca70a65\r\n\r\nThe same transaction on RInkeby also used about 3.3 million gas: https://rinkeby.etherscan.io/tx/0x6759621ab32fd7e0925f5e654a8b54e2c53022a9d4a8574a7227c8e5a3218da5",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/730855664",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-730855664",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 730855664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDg1NTY2NA==",
    "user": {
      "login": "gitpusha",
      "id": 36712489,
      "node_id": "MDQ6VXNlcjM2NzEyNDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/36712489?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitpusha",
      "html_url": "https://github.com/gitpusha",
      "followers_url": "https://api.github.com/users/gitpusha/followers",
      "following_url": "https://api.github.com/users/gitpusha/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitpusha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitpusha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitpusha/subscriptions",
      "organizations_url": "https://api.github.com/users/gitpusha/orgs",
      "repos_url": "https://api.github.com/users/gitpusha/repos",
      "events_url": "https://api.github.com/users/gitpusha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitpusha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-20T05:14:51Z",
    "updated_at": "2020-11-20T05:15:00Z",
    "author_association": "NONE",
    "body": "Hi, \r\n\r\nI observed similar discrepancies and I reported them here in `hardhat-gas-reporter` \r\n\r\nhttps://github.com/cgewecke/hardhat-gas-reporter/issues/46#issuecomment-730435895",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/730855664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/730957120",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-730957120",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 730957120,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDk1NzEyMA==",
    "user": {
      "login": "ItsNickBarry",
      "id": 1500628,
      "node_id": "MDQ6VXNlcjE1MDA2Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1500628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ItsNickBarry",
      "html_url": "https://github.com/ItsNickBarry",
      "followers_url": "https://api.github.com/users/ItsNickBarry/followers",
      "following_url": "https://api.github.com/users/ItsNickBarry/following{/other_user}",
      "gists_url": "https://api.github.com/users/ItsNickBarry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ItsNickBarry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ItsNickBarry/subscriptions",
      "organizations_url": "https://api.github.com/users/ItsNickBarry/orgs",
      "repos_url": "https://api.github.com/users/ItsNickBarry/repos",
      "events_url": "https://api.github.com/users/ItsNickBarry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ItsNickBarry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-20T07:19:46Z",
    "updated_at": "2020-11-20T07:19:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gitpusha I don't think it's a gas reporter issue because the `gasUsed` in the transaction receipt matches the gas report.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/730957120/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/731364229",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-731364229",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 731364229,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTM2NDIyOQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-20T19:26:55Z",
    "updated_at": "2020-11-20T19:26:55Z",
    "author_association": "MEMBER",
    "body": "Thanks for this @ItsNickBarry. I opened #1043, which is like a simplified version of this. I'll keep this one open though, in case fixing that one doesn't fix it for you.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/731364229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/731962366",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-731962366",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 731962366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTk2MjM2Ng==",
    "user": {
      "login": "gitpusha",
      "id": 36712489,
      "node_id": "MDQ6VXNlcjM2NzEyNDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/36712489?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitpusha",
      "html_url": "https://github.com/gitpusha",
      "followers_url": "https://api.github.com/users/gitpusha/followers",
      "following_url": "https://api.github.com/users/gitpusha/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitpusha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitpusha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitpusha/subscriptions",
      "organizations_url": "https://api.github.com/users/gitpusha/orgs",
      "repos_url": "https://api.github.com/users/gitpusha/repos",
      "events_url": "https://api.github.com/users/gitpusha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitpusha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-23T06:47:38Z",
    "updated_at": "2020-11-23T06:47:38Z",
    "author_association": "NONE",
    "body": "> @gitpusha I don't think it's a gas reporter issue because the `gasUsed` in the transaction receipt matches the gas report.\r\n\r\nYes, indeed. It seems to be a hardhat network issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/731962366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735409692",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-735409692",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 735409692,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTQwOTY5Mg==",
    "user": {
      "login": "gitpusha",
      "id": 36712489,
      "node_id": "MDQ6VXNlcjM2NzEyNDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/36712489?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitpusha",
      "html_url": "https://github.com/gitpusha",
      "followers_url": "https://api.github.com/users/gitpusha/followers",
      "following_url": "https://api.github.com/users/gitpusha/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitpusha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitpusha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitpusha/subscriptions",
      "organizations_url": "https://api.github.com/users/gitpusha/orgs",
      "repos_url": "https://api.github.com/users/gitpusha/repos",
      "events_url": "https://api.github.com/users/gitpusha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitpusha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-29T15:15:59Z",
    "updated_at": "2020-11-29T15:15:59Z",
    "author_association": "NONE",
    "body": "I am still observing about 10% and more higher gasUsed values on mainnet when comparing it to what I observe on hardhat network in forking mode. ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735409692/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735447958",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-735447958",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 735447958,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTQ0Nzk1OA==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-29T20:19:22Z",
    "updated_at": "2020-11-29T20:19:22Z",
    "author_association": "MEMBER",
    "body": "Can you tell us how to reproduce it,  @gitpusha ?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735447958/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735675132",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-735675132",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 735675132,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTY3NTEzMg==",
    "user": {
      "login": "gitpusha",
      "id": 36712489,
      "node_id": "MDQ6VXNlcjM2NzEyNDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/36712489?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitpusha",
      "html_url": "https://github.com/gitpusha",
      "followers_url": "https://api.github.com/users/gitpusha/followers",
      "following_url": "https://api.github.com/users/gitpusha/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitpusha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitpusha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitpusha/subscriptions",
      "organizations_url": "https://api.github.com/users/gitpusha/orgs",
      "repos_url": "https://api.github.com/users/gitpusha/repos",
      "events_url": "https://api.github.com/users/gitpusha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitpusha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-30T09:45:02Z",
    "updated_at": "2020-11-30T09:45:02Z",
    "author_association": "NONE",
    "body": "Unfortunately, it's very hard to reproduce. You would have to run our integration tests and then execute the transaction on mainnet for comparison. And to be able to execute that transaction you would have to jump through some hoops too. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735675132/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735852524",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-735852524",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 735852524,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTg1MjUyNA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-30T15:23:09Z",
    "updated_at": "2020-11-30T15:23:09Z",
    "author_association": "MEMBER",
    "body": "@gitpusha can you tell us which repository has these tests?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/735852524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/737356497",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-737356497",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 737356497,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNzM1NjQ5Nw==",
    "user": {
      "login": "gitpusha",
      "id": 36712489,
      "node_id": "MDQ6VXNlcjM2NzEyNDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/36712489?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitpusha",
      "html_url": "https://github.com/gitpusha",
      "followers_url": "https://api.github.com/users/gitpusha/followers",
      "following_url": "https://api.github.com/users/gitpusha/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitpusha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitpusha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitpusha/subscriptions",
      "organizations_url": "https://api.github.com/users/gitpusha/orgs",
      "repos_url": "https://api.github.com/users/gitpusha/repos",
      "events_url": "https://api.github.com/users/gitpusha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitpusha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-02T16:49:49Z",
    "updated_at": "2020-12-02T16:49:49Z",
    "author_association": "NONE",
    "body": "> @gitpusha can you tell us which repository has these tests?\r\n\r\nYep, sorry. Wanted to do that anyway but forget. \r\n\r\n[Here](https://github.com/gelatodigital/gelato-instadapp/tree/master/test/gas/debt_bridge/full/from_maker) are some tests that we run with gas-reporter in order to hardcode gas values. \r\n\r\nWe know that for the [execViaRoute0](https://github.com/gelatodigital/gelato-instadapp/blob/039d4b7b3450df5cadf85963f458c992d172573a/test/gas/debt_bridge/full/from_maker/0_ETHA-ETHB.mock.test.js#L129) test \r\n\r\nand for the [execViaRoute0AndOpenVault](https://github.com/gelatodigital/gelato-instadapp/blob/039d4b7b3450df5cadf85963f458c992d172573a/test/gas/debt_bridge/full/from_maker/1_ETHA-newETHB.mock.test.js#L128) test \r\n\r\nthe observed gas values on mainnet are like 200k gas higher than the `gasUsed` reported when running them on hardhat network forking mainnet. \r\n\r\nFor example this is a [mainnet tx](https://etherscan.io/tx/0x156d258d4fa70f466c781b3ea4021e169372c48a7a4478852646c3de3d32f284) almost identical to the one we gas test in `execViaRoute0` test. \r\n\r\nAnd it has this gasUsed on mainnet: `2,242,206`\r\n\r\n![image](https://user-images.githubusercontent.com/36712489/100903194-e596d080-34c5-11eb-82df-b6a79fbd73ef.png)\r\n\r\nwhile locally the gas reporter tells us the gasUsed is around: `1,969,593`\r\n\r\n![image](https://user-images.githubusercontent.com/36712489/100903927-bcc30b00-34c6-11eb-9f81-599442cc7030.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/737356497/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/738027355",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-738027355",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 738027355,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODAyNzM1NQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T14:26:45Z",
    "updated_at": "2020-12-03T14:26:45Z",
    "author_association": "MEMBER",
    "body": "Thanks @gitpusha, we'll look into this as soon as possible.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/738027355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/738063175",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-738063175",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 738063175,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODA2MzE3NQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T15:08:43Z",
    "updated_at": "2020-12-03T15:08:43Z",
    "author_association": "MEMBER",
    "body": "So, I did a first dive into this, and I noticed that the gas cost of that function changes between different executions, _even if the forked block number is the same_. I have no idea how this setup works, but there seems to be some prices that are fetched and/or mocked, and those can change between executions, right?\r\n\r\nMy point is that if there's already a difference between executions, then it's not entirely off to think that that mainnet tx had a different gas usage because of that. That being said, 200K is not a tiny difference, so I don't dismiss the possibility of a bug on our side. But I don't think we can do much without a more scoped example.\r\n\r\nI think the bare mininum we'd need to debug this is to be able to run the same test in the forked mainnet and in non-forked hardhat (or at least on a testnet), and for those two tests to consistently give the same gas usage in each network, but a different value between them.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/738063175/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/738100755",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-738100755",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 738100755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODEwMDc1NQ==",
    "user": {
      "login": "gitpusha",
      "id": 36712489,
      "node_id": "MDQ6VXNlcjM2NzEyNDg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/36712489?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitpusha",
      "html_url": "https://github.com/gitpusha",
      "followers_url": "https://api.github.com/users/gitpusha/followers",
      "following_url": "https://api.github.com/users/gitpusha/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitpusha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitpusha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitpusha/subscriptions",
      "organizations_url": "https://api.github.com/users/gitpusha/orgs",
      "repos_url": "https://api.github.com/users/gitpusha/repos",
      "events_url": "https://api.github.com/users/gitpusha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitpusha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T15:57:57Z",
    "updated_at": "2020-12-03T15:57:57Z",
    "author_association": "NONE",
    "body": "> I think the bare mininum we'd need to debug this is to be able to run the same test in the forked mainnet and in non-forked hardhat (or at least on a testnet), and for those two tests to consistently give the same gas usage in each network, but a different value between them.\r\n\r\nYes, I agree. Problem is this test uses a lot of dependencies not available on any testnet. \r\n\r\n> I have no idea how this setup works, but there seems to be some prices that are fetched and/or mocked, and those can change between executions, right?\r\n\r\nIt's a bit hard to go into the details of this test. But the mocked parts are very little and insignificant. We are pretty certain that the gas counting must be off somewhere on hardhat network. \r\n\r\nBut without being able to give you a nice example to reproduce it, I don't think it's worth bothering you with it. Unfortunately I cannot distill this down. The integration here is very complex using forked state from many different mainnet protocols (InstaDapp, Maker, DyDx... )",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/738100755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/805465020",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-805465020",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 805465020,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwNTQ2NTAyMA==",
    "user": {
      "login": "jflatow",
      "id": 3380,
      "node_id": "MDQ6VXNlcjMzODA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3380?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflatow",
      "html_url": "https://github.com/jflatow",
      "followers_url": "https://api.github.com/users/jflatow/followers",
      "following_url": "https://api.github.com/users/jflatow/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflatow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflatow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflatow/subscriptions",
      "organizations_url": "https://api.github.com/users/jflatow/orgs",
      "repos_url": "https://api.github.com/users/jflatow/repos",
      "events_url": "https://api.github.com/users/jflatow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflatow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-24T03:47:38Z",
    "updated_at": "2021-03-24T03:47:38Z",
    "author_association": "NONE",
    "body": "I am still seeing an issue that looks a lot like what's described above. These 2 transactions ran out of gas (others went through successfully, but I can't tell when it's going to happen, and I don't want to try again until I know what's wrong) and this is costing me thousands of dollars already :( . I simulated the changes on a mainnet fork before submitting, so this is very upsetting.\r\n\r\nhttps://etherscan.io/tx/0xcf375f7961ea945e0da0fd0703e716e9e13ae54a3f4273dbac0bbba673dd2750\r\nhttps://etherscan.io/tx/0xa5428ee30e33632db1019bfcc162d99e849c618bb8f60fe2813e37852c786b24",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/805465020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/810285120",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-810285120",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 810285120,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMDI4NTEyMA==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-30T14:06:02Z",
    "updated_at": "2021-03-30T14:06:02Z",
    "author_association": "MEMBER",
    "body": "@jflatow simulating a transaction in the mainnet fork is not guaranteed to give you the same gas that will be used when you send the transaction, because some state could've changed in the meantime.\r\n\r\nYou can use it to get an approximate idea, but then you should probably add a buffer to be sure it will work. Since the unused gas is returned, you don't really lose anything by doing this and you err on the safe side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/810285120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/810414895",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-810414895",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 810414895,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMDQxNDg5NQ==",
    "user": {
      "login": "jflatow",
      "id": 3380,
      "node_id": "MDQ6VXNlcjMzODA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3380?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflatow",
      "html_url": "https://github.com/jflatow",
      "followers_url": "https://api.github.com/users/jflatow/followers",
      "following_url": "https://api.github.com/users/jflatow/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflatow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflatow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflatow/subscriptions",
      "organizations_url": "https://api.github.com/users/jflatow/orgs",
      "repos_url": "https://api.github.com/users/jflatow/repos",
      "events_url": "https://api.github.com/users/jflatow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflatow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-30T16:45:54Z",
    "updated_at": "2021-03-30T16:45:54Z",
    "author_association": "NONE",
    "body": "Yes its my fault, I didn't expect to be doing anything non-deterministic and eyeballing the gas used seemed to confirm that, but it looks like the results did vary in a few hundred gas for some reason. I still think its way too easy to screw up like this with the current estimate gas, it would be nice to have more docs / maybe even a helper in setting a real gas limit for actually interacting with mainnet",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/810414895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/859128691",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/990#issuecomment-859128691",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/990",
    "id": 859128691,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1OTEyODY5MQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-10T22:38:00Z",
    "updated_at": "2021-06-10T22:38:00Z",
    "author_association": "MEMBER",
    "body": "Closing this since we don't have an easy way to reproduce the problem. Please re-open if anyone has!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/859128691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
