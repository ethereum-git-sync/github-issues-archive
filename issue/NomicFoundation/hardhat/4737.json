{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4737",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4737/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4737/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4737/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4737",
  "id": 2068406832,
  "node_id": "I_kwDOB7jojM57SWIw",
  "number": 4737,
  "title": "Mainnet Fork not working before block 18856000",
  "user": {
    "login": "snowkidind",
    "id": 8151653,
    "node_id": "MDQ6VXNlcjgxNTE2NTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8151653?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/snowkidind",
    "html_url": "https://github.com/snowkidind",
    "followers_url": "https://api.github.com/users/snowkidind/followers",
    "following_url": "https://api.github.com/users/snowkidind/following{/other_user}",
    "gists_url": "https://api.github.com/users/snowkidind/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/snowkidind/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/snowkidind/subscriptions",
    "organizations_url": "https://api.github.com/users/snowkidind/orgs",
    "repos_url": "https://api.github.com/users/snowkidind/repos",
    "events_url": "https://api.github.com/users/snowkidind/events{/privacy}",
    "received_events_url": "https://api.github.com/users/snowkidind/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "ChristopherDedominici",
    "id": 18092467,
    "node_id": "MDQ6VXNlcjE4MDkyNDY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/18092467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ChristopherDedominici",
    "html_url": "https://github.com/ChristopherDedominici",
    "followers_url": "https://api.github.com/users/ChristopherDedominici/followers",
    "following_url": "https://api.github.com/users/ChristopherDedominici/following{/other_user}",
    "gists_url": "https://api.github.com/users/ChristopherDedominici/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ChristopherDedominici/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ChristopherDedominici/subscriptions",
    "organizations_url": "https://api.github.com/users/ChristopherDedominici/orgs",
    "repos_url": "https://api.github.com/users/ChristopherDedominici/repos",
    "events_url": "https://api.github.com/users/ChristopherDedominici/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ChristopherDedominici/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ChristopherDedominici",
      "id": 18092467,
      "node_id": "MDQ6VXNlcjE4MDkyNDY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/18092467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChristopherDedominici",
      "html_url": "https://github.com/ChristopherDedominici",
      "followers_url": "https://api.github.com/users/ChristopherDedominici/followers",
      "following_url": "https://api.github.com/users/ChristopherDedominici/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChristopherDedominici/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChristopherDedominici/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChristopherDedominici/subscriptions",
      "organizations_url": "https://api.github.com/users/ChristopherDedominici/orgs",
      "repos_url": "https://api.github.com/users/ChristopherDedominici/repos",
      "events_url": "https://api.github.com/users/ChristopherDedominici/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChristopherDedominici/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2024-01-06T05:44:27Z",
  "updated_at": "2024-01-06T05:51:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version of Hardhat\r\n\r\n2.19.4\r\n\r\n### What happened?\r\n\r\n`% npx hardhat run --network hardhat scripts/deploy.js`\r\n\r\nError: A withdrawalsRoot for a header can only be provided with EIP4895 being activated\r\n    at new BlockHeader ...\r\n\r\nThis strange behavior occurs when I try to access a block before 18856000\r\nThe node I am connecting to is an erigon archival node\r\nIn the script i initialize hardhat ethers as so\r\n\r\n```\r\nconst hre = require(\"hardhat\");\r\nconst ethers = hre.ethers\r\nconst provider = ethers.provider\r\n```\r\nand in my async function I call getBlock:\r\n`const block = await provider.getBlock(18856000) // does not crash`\r\n`const block = await provider.getBlock(18855999) // crashes with above error`\r\n\r\nIn my config file:\r\n\r\n```\r\n// 18689178 - cannot use block:  \"A withdrawalsRoot for a header can only be provided with EIP4895 being activated\"\r\n// this was activated more than a year ago\r\n// bug is at 18855999 (no work) 18856000 (work)\r\n\r\nconst lastBlock = 18856000\r\n\r\nmodule.exports = {\r\n  networks: {\r\n    hardhat: {\r\n      accounts: { mnemonic: process.env.MNEMONIC },\r\n      forking: {\r\n        url: 'http://192.168.1.104:8545',\r\n        blockNumber: lastBlock\r\n      }\r\n    }, \r\n\r\netc...\r\n\r\n```\r\n\r\nExpected behavior:\r\n\r\nHardhat mainnet forking should work at any block height\r\n\r\n### Minimal reproduction steps\r\n\r\n// hardhat.config.js\r\n```\r\nrequire(\"@nomicfoundation/hardhat-toolbox\");\r\n\r\n// note incrementing this to 18856000 resolves the error, yet any earlier block being accessed is then null\r\nconst lastBlock = 18855999 \r\n\r\nmodule.exports = {\r\n  solidity: {\r\n    compilers: [\r\n      {\r\n        version: \"0.8.20\",\r\n        settings: {\r\n          optimizer: {\r\n            enabled: true,\r\n            runs: 200,\r\n          },\r\n        },\r\n      }\r\n    ]\r\n  },\r\n  networks: {\r\n    hardhat: {\r\n      forking: {\r\n        url: 'http://192.168.1.104:8545',\r\n        blockNumber: lastBlock\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n```\r\n\r\nscript.js\r\n\r\n```\r\nconst hre = require(\"hardhat\");\r\nconst ethers = hre.ethers\r\nconst provider = ethers.provider\r\n\r\nconst run = async () => {\r\n  const block = await provider.getBlock(18855999)\r\n  console.log(block)\r\n}\r\n\r\n  ; (async () => {\r\n    try {\r\n      await run()\r\n    } catch (error) {\r\n      console.log(error)\r\n      process.exit(1)\r\n    }\r\n    process.exit(0)\r\n  })()\r\n```\r\n\r\n// terminal\r\nnpm init -y\r\nnpm install  @nomicfoundation/hardhat-toolbox\r\nnpx hardhat run --network hardhat script.js\r\n\r\n\r\n// other info\r\nMac os Ventura 13.3.1\r\nNode v20.10.0\r\n\r\n\r\n \r\n\r\n### Search terms\r\n\r\nMainnet fork ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4737/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4737/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
