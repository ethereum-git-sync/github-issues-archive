{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2151",
  "id": 1078075267,
  "node_id": "I_kwDOB7jojM5AQh-D",
  "number": 2151,
  "title": "Meet the `Failed to generate 1 stack trace`",
  "user": {
    "login": "Nipol",
    "id": 693461,
    "node_id": "MDQ6VXNlcjY5MzQ2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/693461?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Nipol",
    "html_url": "https://github.com/Nipol",
    "followers_url": "https://api.github.com/users/Nipol/followers",
    "following_url": "https://api.github.com/users/Nipol/following{/other_user}",
    "gists_url": "https://api.github.com/users/Nipol/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Nipol/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Nipol/subscriptions",
    "organizations_url": "https://api.github.com/users/Nipol/orgs",
    "repos_url": "https://api.github.com/users/Nipol/repos",
    "events_url": "https://api.github.com/users/Nipol/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Nipol/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-12-13T04:30:10Z",
  "updated_at": "2023-03-29T00:15:31Z",
  "closed_at": "2022-12-28T16:37:46Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I tested the case of reverted when I tried to using \"create2\" with the same salt. and in hardhat, stack trace generation failed.\r\nThat's why I'm reporting it.\r\n\r\n```sh\r\n  hardhat:core:hardhat-network:node Could not generate stack trace. Please report this to help us improve Hardhat.\r\n  hardhat:core:hardhat-network:node  TypeError: Cannot use 'in' operator to search for 'pc' in undefined\r\n    at isEvmStep (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/message-trace.ts:89:14)\r\n    at ErrorInferrer._isConstructorInvalidArgumentsError (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:972:19)\r\n    at ErrorInferrer.inferBeforeTracingCreateMessage (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:142:14)\r\n    at SolidityTracer._getCreateMessageStackTrace (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:126:27)\r\n    at SolidityTracer.getStackTrace (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:52:19)\r\n    at SolidityTracer._rawTraceEvmExecution (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:201:38)\r\n    at SolidityTracer._traceEvmExecution (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:149:29)\r\n    at SolidityTracer._getCallMessageStackTrace (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:72:17)\r\n    at SolidityTracer.getStackTrace (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:56:19)\r\n    at SolidityTracer._rawTraceEvmExecution (/workspaces/library/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:201:38) +0ms\r\n      âœ“ should be revert deploy contract using create2 with delegatecall\r\n```\r\n\r\nThe following code was called twice from one tx.\r\n\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\ncontract DeploySpell {\r\n    function cast(\r\n        uint256 value,\r\n        bytes memory byteCode,\r\n        bytes32 salt\r\n    ) external returns (address deployed) {\r\n        // solhint-disable-next-line no-inline-assembly\r\n        assembly {\r\n            deployed := create2(value, add(byteCode, 0x20), mload(byteCode), salt)\r\n            if iszero(extcodesize(deployed)) {\r\n                returndatacopy(0, 0, returndatasize())\r\n                revert(0, returndatasize())\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nIf guys need more explanation of the situation, I will respond.",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1150317009",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2151#issuecomment-1150317009",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151",
    "id": 1150317009,
    "node_id": "IC_kwDOB7jojM5EkHHR",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-06-08T19:31:41Z",
    "updated_at": "2022-06-08T19:31:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1150317009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1150461074",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2151#issuecomment-1150461074",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151",
    "id": 1150461074,
    "node_id": "IC_kwDOB7jojM5EkqSS",
    "user": {
      "login": "2dpetkov",
      "id": 796902,
      "node_id": "MDQ6VXNlcjc5NjkwMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/796902?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/2dpetkov",
      "html_url": "https://github.com/2dpetkov",
      "followers_url": "https://api.github.com/users/2dpetkov/followers",
      "following_url": "https://api.github.com/users/2dpetkov/following{/other_user}",
      "gists_url": "https://api.github.com/users/2dpetkov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/2dpetkov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/2dpetkov/subscriptions",
      "organizations_url": "https://api.github.com/users/2dpetkov/orgs",
      "repos_url": "https://api.github.com/users/2dpetkov/repos",
      "events_url": "https://api.github.com/users/2dpetkov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/2dpetkov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-08T22:03:41Z",
    "updated_at": "2022-06-08T23:15:47Z",
    "author_association": "NONE",
    "body": "Greetings, Team.\r\n\r\nI am afraid the issue is still relevant.\r\n\r\nThe contract code is \r\n\r\n```\r\n    function deploy(bytes memory initCode_, bytes32 salt_, bytes calldata initializer_)\r\n        external onlyOwner payable\r\n        returns (address payable deployedContractAddress)\r\n    {\r\n        uint256 msgValue = msg.value;\r\n        assembly {\r\n            deployedContractAddress := create2(msgValue, add(initCode_, 0x20), mload(initCode_), salt_)\r\n        }\r\n        require(deployedContractAddress != address(0), \"target address occupied\");\r\n        if (initializer_.length != 0) {\r\n            (bool success, ) = deployedContractAddress.call(initializer_);\r\n            require(success, \"initialization failed\");\r\n        }\r\n    }\r\n```\r\n\r\n\r\nand the test that produces the warning:\r\n```\r\n    it(\"Should not deploy on the same address twice\", async () => {\r\n        const expectedRevertMessage = \"target address occupied\";\r\n\r\n        let tx = await factory.deploy(deployTx.data, SALT, []);\r\n        tx = await tx.wait();\r\n\r\n        await expect(factory.deploy(deployTx.data, SALT, [])).to.be.revertedWith(expectedRevertMessage);\r\n    });\r\n```\r\n\r\nthe warning:\r\n```\r\n  hardhat:core:hardhat-network:node Could not generate stack trace. Please report this to help us improve Hardhat.\r\n  hardhat:core:hardhat-network:node  TypeError: Cannot use 'in' operator to search for 'pc' in undefined\r\n    at isEvmStep (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/message-trace.ts:89:14)\r\n    at ErrorInferrer._isConstructorInvalidArgumentsError (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:976:19)\r\n    at ErrorInferrer.inferBeforeTracingCreateMessage (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:142:14)\r\n    at SolidityTracer._getCreateMessageStackTrace (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:126:27)\r\n    at SolidityTracer.getStackTrace (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:52:19)\r\n    at SolidityTracer._rawTraceEvmExecution (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:201:38)\r\n    at SolidityTracer._traceEvmExecution (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:149:29)\r\n    at SolidityTracer._getCallMessageStackTrace (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:72:17)\r\n    at SolidityTracer.getStackTrace (<...>/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:56:19)\r\n    at HardhatNode._manageErrors (<...>/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1896:41) +0ms\r\n    âœ” Should not deploy on the same address twice (45ms)\r\n```\r\n\r\n\r\nedit: tested with `\"hardhat\": \"^2.9.8\",`\r\nedit 2: the issue appears both with solc `0.8.9` and `0.8.14`",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1150461074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1179785105",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2151#issuecomment-1179785105",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151",
    "id": 1179785105,
    "node_id": "IC_kwDOB7jojM5GUheR",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-10T19:31:40Z",
    "updated_at": "2022-07-10T19:31:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue was marked as stale because it didn't have any activity in the last 30 days. If you think it's still relevant, please leave a comment indicating so. Otherwise, it will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1179785105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1366779893",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2151#issuecomment-1366779893",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2151",
    "id": 1366779893,
    "node_id": "IC_kwDOB7jojM5Rd2f1",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-28T16:37:46Z",
    "updated_at": "2022-12-28T16:37:46Z",
    "author_association": "MEMBER",
    "body": "Closing in favor of https://github.com/NomicFoundation/hardhat/issues/3482",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1366779893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
