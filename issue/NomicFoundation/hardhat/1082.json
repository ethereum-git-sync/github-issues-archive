{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1082",
  "id": 757370024,
  "node_id": "MDU6SXNzdWU3NTczNzAwMjQ=",
  "number": 1082,
  "title": "Revert when accessing uninitialized Mapping => Struct values",
  "user": {
    "login": "justinkaseman",
    "id": 28818476,
    "node_id": "MDQ6VXNlcjI4ODE4NDc2",
    "avatar_url": "https://avatars.githubusercontent.com/u/28818476?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/justinkaseman",
    "html_url": "https://github.com/justinkaseman",
    "followers_url": "https://api.github.com/users/justinkaseman/followers",
    "following_url": "https://api.github.com/users/justinkaseman/following{/other_user}",
    "gists_url": "https://api.github.com/users/justinkaseman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/justinkaseman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/justinkaseman/subscriptions",
    "organizations_url": "https://api.github.com/users/justinkaseman/orgs",
    "repos_url": "https://api.github.com/users/justinkaseman/repos",
    "events_url": "https://api.github.com/users/justinkaseman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/justinkaseman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-12-04T20:05:08Z",
  "updated_at": "2022-11-18T21:09:10Z",
  "closed_at": "2020-12-17T21:07:22Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "While testing a local network ENS implementation I ran into an issue similar to #733.\r\n\r\nThe smart contract that I am interacting with can be seen [here](https://github.com/ensdomains/ens/blob/feature/migration/contracts/ENSRegistry.sol#L10). It has a mapping of structs:\r\n```\r\n    struct Record {\r\n        address owner;\r\n        address resolver;\r\n        uint64 ttl;\r\n    }\r\n    mapping (bytes32 => Record) records;\r\n```\r\nThere are a few [methods](https://github.com/ensdomains/ens/blob/feature/migration/contracts/ENSRegistry.sol#L149) that interact with this mapping:\r\n```\r\n   /**\r\n     * @dev Returns whether a record has been imported to the registry.\r\n     * @param node The specified node.\r\n     * @return Bool if record exists\r\n     */\r\n    function recordExists(bytes32 node) public view returns (bool) {\r\n        return records[node].owner != address(0x0);\r\n    }\r\n```\r\n\r\nWhen calling this method on a value that has been set it works as expected, but reverts when called on one that has not been.\r\nIt seems that the default value for the Record struct in the records mapping is broken, reverting on `records[node].<field>`.\r\n\r\nChanging the struct to `public` visibility and logging `records(node)` with Hardhat/Ethers.. \r\n\r\nAn initialized Record:\r\n```\r\n[ '0x58ecD8B14bB4232D4583Cdfd083a84ca84950716',\r\n      '0xe94a03D05fA87d1373492efeB273393a8059976F',\r\n      BigNumber { _hex: '0x00', _isBigNumber: true },\r\n      owner: '0x58ecD8B14bB4232D4583Cdfd083a84ca84950716',\r\n      resolver: '0xe94a03D05fA87d1373492efeB273393a8059976F',\r\n      ttl: BigNumber { _hex: '0x00', _isBigNumber: true } ]\r\n```\r\n\r\nDefault Record:\r\n```\r\n    [ '0x0000000000000000000000000000000000000000',\r\n      '0x0000000000000000000000000000000000000000',\r\n      BigNumber { _hex: '0x00', _isBigNumber: true },\r\n      owner: '0x0000000000000000000000000000000000000000',\r\n      resolver: '0x0000000000000000000000000000000000000000',\r\n      ttl: BigNumber { _hex: '0x00', _isBigNumber: true } ]\r\n```\r\n\r\nWhen running through Truffle/Web3 all cases work as expected, returning for the default Record:\r\n```\r\nResult {\r\n  '0': '0x0000000000000000000000000000000000000000',\r\n  '1': '0x0000000000000000000000000000000000000000',\r\n  '2': <BN: 0>,\r\n  owner: '0x0000000000000000000000000000000000000000',\r\n  resolver: '0x0000000000000000000000000000000000000000',\r\n  ttl: <BN: 0> }\r\n```\r\n\r\nSo it seems to be an issue with how the mapping => Record accessing these default zero addressed values.",
  "closed_by": {
    "login": "justinkaseman",
    "id": 28818476,
    "node_id": "MDQ6VXNlcjI4ODE4NDc2",
    "avatar_url": "https://avatars.githubusercontent.com/u/28818476?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/justinkaseman",
    "html_url": "https://github.com/justinkaseman",
    "followers_url": "https://api.github.com/users/justinkaseman/followers",
    "following_url": "https://api.github.com/users/justinkaseman/following{/other_user}",
    "gists_url": "https://api.github.com/users/justinkaseman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/justinkaseman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/justinkaseman/subscriptions",
    "organizations_url": "https://api.github.com/users/justinkaseman/orgs",
    "repos_url": "https://api.github.com/users/justinkaseman/repos",
    "events_url": "https://api.github.com/users/justinkaseman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/justinkaseman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/747609371",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1082#issuecomment-747609371",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082",
    "id": 747609371,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NzYwOTM3MQ==",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-17T18:14:01Z",
    "updated_at": "2020-12-17T18:14:01Z",
    "author_association": "MEMBER",
    "body": "@justinkaseman I cannot reproduce this. Can you check this repo and see if I'm reproducing it correctly?\r\n\r\n```\r\ngit clone https://github.com/fvictorio/hardhat-issue-1082\r\ncd hardhat-issue-1082\r\nnpx hardhat run script.js\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/747609371/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/747702411",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1082#issuecomment-747702411",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1082",
    "id": 747702411,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NzcwMjQxMQ==",
    "user": {
      "login": "justinkaseman",
      "id": 28818476,
      "node_id": "MDQ6VXNlcjI4ODE4NDc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/28818476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/justinkaseman",
      "html_url": "https://github.com/justinkaseman",
      "followers_url": "https://api.github.com/users/justinkaseman/followers",
      "following_url": "https://api.github.com/users/justinkaseman/following{/other_user}",
      "gists_url": "https://api.github.com/users/justinkaseman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/justinkaseman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justinkaseman/subscriptions",
      "organizations_url": "https://api.github.com/users/justinkaseman/orgs",
      "repos_url": "https://api.github.com/users/justinkaseman/repos",
      "events_url": "https://api.github.com/users/justinkaseman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/justinkaseman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-17T21:07:22Z",
    "updated_at": "2020-12-17T21:07:34Z",
    "author_association": "NONE",
    "body": "@fvictorio Thanks for trying to reproduce. Your repo is fine.\r\n\r\nI dug into this again and it was user error setting up our test environment. We were looking at the wrong ABI, the method I linked here is incorrect. The actual contract we were using had a fallback implemented that was initialized incorrectly.\r\n\r\nClosing this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/747702411/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
