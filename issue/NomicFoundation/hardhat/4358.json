{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358",
  "id": 1877876625,
  "node_id": "I_kwDOB7jojM5v7h-R",
  "number": 4358,
  "title": "Hardhat is replaying all blocks when forking mainnet",
  "user": {
    "login": "antoinedc",
    "id": 1327779,
    "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/antoinedc",
    "html_url": "https://github.com/antoinedc",
    "followers_url": "https://api.github.com/users/antoinedc/followers",
    "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
    "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
    "organizations_url": "https://api.github.com/users/antoinedc/orgs",
    "repos_url": "https://api.github.com/users/antoinedc/repos",
    "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/antoinedc/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4937119027,
      "node_id": "LA_kwDOB7jojM8AAAABJkZ1Mw",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:triaging",
      "name": "status:triaging",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-09-01T18:34:52Z",
  "updated_at": "2023-12-11T00:14:28Z",
  "closed_at": "2023-09-11T14:30:07Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\r\n\r\n2.17.2\r\n\r\n### What happened?\r\n\r\nWhen starting/stopping a node setup with a mainnet fork multiple times, instead of emitting the `block` event only for the latest, Hardhat is going to emit it for all past events since the last emitted one.\r\nFor example:\r\n- I start the node with a fork that is at block 1000\r\n- I stop it\r\n- 5 blocks go by\r\n- I start it again\r\n- Blocks 1001 to 1005 are going to be emitted\r\n\r\nI don't know if this is expected, but this is annoying as the main purpose of mainnet forks is to get the state, not to synchronize blocks & transactions. For my specific use case ([Ethernal](https://www.tryethernal.com)), this causes issues for users, as when they reset their node, they end up with tons of mainnet blocks/transactions in their backend, instead of just theirs.\r\n\r\nInterestingly, this doesn't happen when a block number is specified for the fork.\r\n\r\n### Minimal reproduction steps\r\n\r\nHere is a repo that reproduces the issue, instructions are in the README: https://github.com/tryethernal/repro-hardhat-bug\r\n\r\n### Search terms\r\n\r\nreplay, blocks, fork, mainnet",
  "closed_by": {
    "login": "antoinedc",
    "id": 1327779,
    "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/antoinedc",
    "html_url": "https://github.com/antoinedc",
    "followers_url": "https://api.github.com/users/antoinedc/followers",
    "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
    "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
    "organizations_url": "https://api.github.com/users/antoinedc/orgs",
    "repos_url": "https://api.github.com/users/antoinedc/repos",
    "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/antoinedc/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1703837271",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1703837271",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1703837271,
    "node_id": "IC_kwDOB7jojM5ljn5X",
    "user": {
      "login": "antoinedc",
      "id": 1327779,
      "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinedc",
      "html_url": "https://github.com/antoinedc",
      "followers_url": "https://api.github.com/users/antoinedc/followers",
      "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinedc/orgs",
      "repos_url": "https://api.github.com/users/antoinedc/repos",
      "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinedc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-02T13:45:31Z",
    "updated_at": "2023-09-02T13:45:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, it seems like those events are only emitted outside of the Hardhat environment.\r\nA plugin using `hre.provider` is not going to catch them, only something listening from the outside.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1703837271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713603620",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1713603620",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1713603620,
    "node_id": "IC_kwDOB7jojM5mI4Qk",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T10:24:45Z",
    "updated_at": "2023-09-11T10:24:45Z",
    "author_association": "MEMBER",
    "body": "Thanks @antoinedc! I honestly have no idea how this is even possible. The second execution shouldn't \"know\" that there was a previous execution with a lower block number :/ I'll try to look into this as soon as I have some time.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713603620/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713936354",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1713936354",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1713936354,
    "node_id": "IC_kwDOB7jojM5mKJfi",
    "user": {
      "login": "antoinedc",
      "id": 1327779,
      "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinedc",
      "html_url": "https://github.com/antoinedc",
      "followers_url": "https://api.github.com/users/antoinedc/followers",
      "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinedc/orgs",
      "repos_url": "https://api.github.com/users/antoinedc/repos",
      "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinedc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T13:53:13Z",
    "updated_at": "2023-09-11T13:53:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks! Good to know at least that this is actually a bug and not a hidden feature ahah",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713936354/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713971831",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1713971831",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1713971831,
    "node_id": "IC_kwDOB7jojM5mKSJ3",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:11:37Z",
    "updated_at": "2023-09-11T14:11:37Z",
    "author_association": "MEMBER",
    "body": "Actually, I believe this might be a feature of ethers :grimacing: \r\n\r\nhttps://github.com/ethers-io/ethers.js/blob/32915634bef5b81c6d9998f4e9ad812ffe721954/src.ts/providers/subscriber-polling.ts#L71-L80",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713971831/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713977316",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1713977316",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1713977316,
    "node_id": "IC_kwDOB7jojM5mKTfk",
    "user": {
      "login": "antoinedc",
      "id": 1327779,
      "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinedc",
      "html_url": "https://github.com/antoinedc",
      "followers_url": "https://api.github.com/users/antoinedc/followers",
      "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinedc/orgs",
      "repos_url": "https://api.github.com/users/antoinedc/repos",
      "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinedc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:14:29Z",
    "updated_at": "2023-09-11T14:14:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh wow, great find! And here is the reason: https://github.com/ethers-io/ethers.js/issues/3924#issuecomment-1481906862",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1713977316/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1714005010",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1714005010",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1714005010,
    "node_id": "IC_kwDOB7jojM5mKaQS",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:28:46Z",
    "updated_at": "2023-09-11T14:28:46Z",
    "author_association": "MEMBER",
    "body": "Makes sense. I don't think there's much we can do on our side though, right? Do you mind if we close this?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1714005010/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1714007556",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/4358#issuecomment-1714007556",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/4358",
    "id": 1714007556,
    "node_id": "IC_kwDOB7jojM5mKa4E",
    "user": {
      "login": "antoinedc",
      "id": 1327779,
      "node_id": "MDQ6VXNlcjEzMjc3Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1327779?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antoinedc",
      "html_url": "https://github.com/antoinedc",
      "followers_url": "https://api.github.com/users/antoinedc/followers",
      "following_url": "https://api.github.com/users/antoinedc/following{/other_user}",
      "gists_url": "https://api.github.com/users/antoinedc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antoinedc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antoinedc/subscriptions",
      "organizations_url": "https://api.github.com/users/antoinedc/orgs",
      "repos_url": "https://api.github.com/users/antoinedc/repos",
      "events_url": "https://api.github.com/users/antoinedc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antoinedc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:30:07Z",
    "updated_at": "2023-09-11T14:30:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, we can definitely close this. I'm opening an issue on their end. Thanks a lot for tracking this down though, it was super helpful!",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1714007556/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
