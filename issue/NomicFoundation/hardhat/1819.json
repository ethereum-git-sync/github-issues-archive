{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/1819",
  "id": 977679658,
  "node_id": "MDU6SXNzdWU5Nzc2Nzk2NTg=",
  "number": 1819,
  "title": "Hardhat reset not fetching relevant data",
  "user": {
    "login": "martincode515",
    "id": 23031201,
    "node_id": "MDQ6VXNlcjIzMDMxMjAx",
    "avatar_url": "https://avatars.githubusercontent.com/u/23031201?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/martincode515",
    "html_url": "https://github.com/martincode515",
    "followers_url": "https://api.github.com/users/martincode515/followers",
    "following_url": "https://api.github.com/users/martincode515/following{/other_user}",
    "gists_url": "https://api.github.com/users/martincode515/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/martincode515/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/martincode515/subscriptions",
    "organizations_url": "https://api.github.com/users/martincode515/orgs",
    "repos_url": "https://api.github.com/users/martincode515/repos",
    "events_url": "https://api.github.com/users/martincode515/events{/privacy}",
    "received_events_url": "https://api.github.com/users/martincode515/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-08-24T04:04:52Z",
  "updated_at": "2022-11-18T16:00:51Z",
  "closed_at": "2021-08-30T19:20:59Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "Hi, I was under the impression that calling Hardhat's reset method with a new fork number will allow me to interact with contracts deployed at or after that block number, unfortunately, this is not the case. I tested this a couple of times and below is the steps if ya'll would like to take a look.\r\n\r\nAttached below are the only two files required to reproduce this issue. \r\n\r\nTo reproduce:\r\nThe test involves interacting with Uniswap's V2 router which was deployed at [block 10207858](https://etherscan.io/tx/0x4fc1580e7f66c58b7c26881cce0aab9c3509afe6e507527f30566fbf8039bcd0).\r\n\r\n- Insert your API key in the forking URL for both files. \r\n- Install dependencies.\r\n- Run npx hardhat node in a terminal window in project directory.\r\n- npm run start\r\n\r\nA `CALL_EXCEPTION`  should be seen, Hardhat will also note `WARNING: Calling an account which is not a contract`.\r\n\r\nSetting the blockNumber in hardhat.config.js to `10207858` directly then stopping and starting `npx hardhat node` fixes this.\r\n\r\nWhen initially building around Hardhat I was under the impression that calling Hardhat to reset with the url and blockNumber would 'fetch' the relevant information at that block.\r\n\r\nI've had to manually use NodeJS child processes with the fork and blocknumber flags from the command line, and remove the forking object from hardhats config. It's a workaround but complicates things quite a bit.\r\n\r\nI wonder if this behaviour is normal and expected and that Hardhat does reset the chain but does not fetch externally again, only fetching relevant data on startup, this makes sense but adding a flag that can be passed in, to 'force' fetching when calling reset and forking again as it does on start would be very useful, cheers!\r\n\r\nhardhat.config.js\r\n```\r\nmodule.exports = {\r\n    networks: {\r\n        hardhat: {\r\n            accounts: {\r\n                count: 2,\r\n            },\r\n            forking: {\r\n                url: 'https://eth-mainnet.alchemyapi.io/v2/<API-KEY>',\r\n                blockNumber: 10207600\r\n            },\r\n            chainId: 1,\r\n            loggingEnabled: false,\r\n            throwOnCallFailures: false,\r\n            throwOnTransactionFailures: false,\r\n        },\r\n    }\r\n}\r\n```\r\n\r\nindex.js\r\n```\r\nconst hardhat = require(\"hardhat\");\r\nconst ethers = require(\"ethers\");\r\n\r\nasync function resetHardHat(blockNumber) {\r\n    return hardhat.network.provider.request({\r\n        method: \"hardhat_reset\",\r\n        params: [\r\n            {\r\n                forking: {\r\n                    jsonRpcUrl: 'https://eth-mainnet.alchemyapi.io/v2/<API-KEY>',\r\n                    blockNumber,\r\n                },\r\n            },\r\n        ],\r\n    });\r\n}\r\n\r\nasync function callUniswapV2Router() {\r\n    const factoryABI = ['function factory() external pure returns (address)'];\r\n\r\n    const hardHatSigner = new ethers.Wallet('0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d', new ethers.providers.JsonRpcProvider(`http://127.0.0.1:8545/`));\r\n\r\n    const uniswap = new ethers.Contract('0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D', factoryABI, hardHatSigner);\r\n\r\n    console.log(await uniswap.factory());\r\n}\r\n\r\n\r\n// Reset Hardhat from the block it started with --> V2 router deploy block\r\nresetHardHat(10207858).then(() => {\r\n    return callUniswapV2Router();\r\n})\r\n```\r\n\r\npackage.json\r\n```\r\n{\r\n  \"scripts\": {\r\n    \"start\": \"node index.js\"\r\n  },\r\n  \"dependencies\": {\r\n    \"ethers\": \"^5.4.5\",\r\n    \"hardhat\": \"^2.6.1\"\r\n  }\r\n}\r\n```\r\n\r\n",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/908620988",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/1819#issuecomment-908620988",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/1819",
    "id": 908620988,
    "node_id": "IC_kwDOB7jojM42KHS8",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T19:20:59Z",
    "updated_at": "2021-08-30T19:20:59Z",
    "author_association": "MEMBER",
    "body": "@projectacode you are mixing providers. This line:\r\n\r\n```\r\n    return hardhat.network.provider.request({\r\n```\r\n\r\nis using the provider of the current network which, since you are running the script just as `node index.js`, is the in-process hardhat network. But in this line:\r\n\r\n```\r\n    const hardHatSigner = new ethers.Wallet('0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d', new ethers.providers.JsonRpcProvider(`http://127.0.0.1:8545/`));\r\n```\r\n\r\nYou are connecting to a local network. These are different networks, therefore the problem you see. I have a somewhat in-depth explainer about this [here](https://hackmd.io/@fvictorio/hardhat-networks-and-providers) if you are interested.\r\n\r\nPlease use [our Discord server](https://hardhat.org/discord) if you have more questions.\r\n\r\n---\r\n\r\nUnrelated, but the private key you are using seems to correspond to [an account](https://etherscan.io/address/0x70997970C51812dc3A010C7d01b50e0d17dc79C8) that is compromised (and if it wasn't before, it surely is now that you posted it here). Don't send funds to it.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/908620988/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
