{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/2958",
  "id": 1307110656,
  "node_id": "I_kwDOB7jojM5N6O0A",
  "number": 2958,
  "title": "Not working `hardhat` command as expected when using yarn workspace.",
  "user": {
    "login": "wbydo",
    "id": 25639944,
    "node_id": "MDQ6VXNlcjI1NjM5OTQ0",
    "avatar_url": "https://avatars.githubusercontent.com/u/25639944?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wbydo",
    "html_url": "https://github.com/wbydo",
    "followers_url": "https://api.github.com/users/wbydo/followers",
    "following_url": "https://api.github.com/users/wbydo/following{/other_user}",
    "gists_url": "https://api.github.com/users/wbydo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wbydo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wbydo/subscriptions",
    "organizations_url": "https://api.github.com/users/wbydo/orgs",
    "repos_url": "https://api.github.com/users/wbydo/repos",
    "events_url": "https://api.github.com/users/wbydo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wbydo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-07-17T14:19:24Z",
  "updated_at": "2022-11-17T21:40:19Z",
  "closed_at": "2022-07-18T08:37:49Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "I have found that `hardhat` command is not working with yarn workspace.\r\n(But no problem when using npm workspace.)\r\n\r\nI don't think it's a serious problem because hardhat mainly depends npm.\r\nBut I'm reporting it just in caseðŸ‘\r\n\r\nThe reproduction procedure is as follows. Base hardhat project is created by `npx hardhat` wizard.\r\n\r\nSorry my English is not good enoughðŸ™\r\n\r\n### `yarn` case \r\n\r\n```sh\r\n% git clone https://github.com/wbydo/hardhat-issune-report.git\r\n% cd hardhat-issune-report\r\n% git checkout yarn\r\n% yarn install --immutable\r\n% yarn test\r\n```\r\n\r\nresults\r\n\r\n```\r\n% yarn test\r\nyarn run v1.22.15\r\n$ yarn workspace sample-hardhat-project test\r\nwarning package.json: No license field\r\n$ hardhat test\r\nError HH14: Your Hardhat project uses typescript, but it's not installed.\r\n      \r\nPlease run: npm install --save-dev typescript\r\n\r\nFor more info go to https://hardhat.org/HH14 or run Hardhat with --show-stack-traces\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nerror Command failed.\r\nExit code: 1\r\nCommand: /Users/wd/.asdf/installs/nodejs/16.13.0/bin/node\r\nArguments: /Users/wd/.node/corepack/yarn/1.22.15/lib/cli.js test\r\nDirectory: /Users/wd/src/github.com/wbydo/hardhat-issune-report/packages/sample-hardhat-project\r\nOutput:\r\n\r\ninfo Visit https://yarnpkg.com/en/docs/cli/workspace for documentation about this command.\r\nerror Command failed with exit code 1.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n```\r\n\r\nother information\r\n\r\n```sh\r\n% yarn -v\r\n1.22.15\r\n\r\n% node -v\r\nv16.13.0\r\n```\r\n\r\n### `npm` case (expected)\r\n\r\nprocedure\r\n\r\n```sh\r\n% git clone https://github.com/wbydo/hardhat-issune-report.git\r\n% cd hardhat-issune-report\r\n% git checkout npm\r\n% npm ci\r\n% npm test\r\n```\r\n\r\nresults\r\n\r\n``` sh\r\n% npm test\r\n\r\n> hardhat-issune-report@0.0.1 test\r\n> npm run -w sample-hardhat-project test\r\n\r\n\r\n> sample-hardhat-project@0.0.1 test\r\n> hardhat test\r\n\r\n\r\n\r\n  Lock\r\n    Deployment\r\n      âœ” Should set the right unlockTime (598ms)\r\n      âœ” Should set the right owner\r\n      âœ” Should receive and store the funds to lock\r\n      âœ” Should fail if the unlockTime is not in the future\r\n    Withdrawals\r\n      Validations\r\n        âœ” Should revert with the right error if called too soon\r\n        âœ” Should revert with the right error if called from another account\r\n        âœ” Shouldn't fail if the unlockTime has arrived and the owner calls it\r\n      Events\r\n        âœ” Should emit an event on withdrawals\r\n      Transfers\r\n        âœ” Should transfer the funds to the owner\r\n\r\n\r\n  9 passing (759ms)\r\n```\r\n\r\nother information\r\n\r\n```sh\r\n% npm -v\r\n7.20.1\r\n\r\n% node -v\r\nv16.13.0\r\n```\r\n\r\nsample repo link: https://github.com/wbydo/hardhat-issune-report",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1186532406",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2958#issuecomment-1186532406",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958",
    "id": 1186532406,
    "node_id": "IC_kwDOB7jojM5GuQw2",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-07-17T14:19:49Z",
    "updated_at": "2022-07-17T14:19:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue is also being [tracked on Linear](https://linear.app/nomic-foundation/issue/HH-970/not-working-hardhat-command-as-expected-when-using-yarn-workspace).\n\nWe use Linear to manage our development process, but we keep the conversations on Github.\n\nLINEAR-ID: 20ceed43-f785-498f-a450-01fe829de1b8",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1186532406/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1186923526",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/2958#issuecomment-1186923526",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/2958",
    "id": 1186923526,
    "node_id": "IC_kwDOB7jojM5GvwQG",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-18T08:37:49Z",
    "updated_at": "2022-07-18T08:37:49Z",
    "author_association": "MEMBER",
    "body": "@wbydo I think the problem is that you are missing all the toolbox's peer dependencies. These are installed automatically when you use npm 7 or later, but they aren't if you are using yarn or an older version of npm.\r\n\r\nWhen you initialize a hardhat project, you should get a prompt asking you if you want to install these, and it shows you the command to do it manually if you answer negatively. (Except on Windows, I think in that case you always get just the command to run) Maybe you forgot to run it? In any case, here it is:\r\n\r\n```\r\n  yarn add --dev @nomicfoundation/hardhat-network-helpers @nomicfoundation/hardhat-chai-matchers @nomiclabs/hardhat-ethers @nomiclabs/hardhat-etherscan chai ethers hardhat-gas-reporter solidity-coverage @typechain/hardhat typechain @typechain/ethers-v5 @ethersproject/abi @ethersproject/providers @types/chai @types/mocha @types/node ts-node typescript\r\n```\r\n\r\nI did that in the repo you shared and then everything worked fine.\r\n\r\nTentatively closing this, but let me know if you still think there's a problem on our side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1186923526/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
