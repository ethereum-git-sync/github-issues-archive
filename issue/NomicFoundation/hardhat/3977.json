{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977",
  "id": 1738254697,
  "node_id": "I_kwDOB7jojM5nm6lp",
  "number": 3977,
  "title": "ContractFactory deploy fails to estimate gas on solidity version: \"0.8.20\" with Shanghai as default",
  "user": {
    "login": "SvenMeyer",
    "id": 25609,
    "node_id": "MDQ6VXNlcjI1NjA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/25609?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SvenMeyer",
    "html_url": "https://github.com/SvenMeyer",
    "followers_url": "https://api.github.com/users/SvenMeyer/followers",
    "following_url": "https://api.github.com/users/SvenMeyer/following{/other_user}",
    "gists_url": "https://api.github.com/users/SvenMeyer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SvenMeyer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SvenMeyer/subscriptions",
    "organizations_url": "https://api.github.com/users/SvenMeyer/orgs",
    "repos_url": "https://api.github.com/users/SvenMeyer/repos",
    "events_url": "https://api.github.com/users/SvenMeyer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SvenMeyer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 901960538,
      "node_id": "MDU6TGFiZWw5MDE5NjA1Mzg=",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/type:bug",
      "name": "type:bug",
      "color": "FBCA04",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 4937720577,
      "node_id": "LA_kwDOB7jojM8AAAABJk-jAQ",
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/labels/status:ready",
      "name": "status:ready",
      "color": "0E8A16",
      "default": false,
      "description": "This issue is ready to be worked on"
    }
  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2023-06-02T13:56:53Z",
  "updated_at": "2023-09-07T00:12:34Z",
  "closed_at": "2023-06-05T08:31:20Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "### Version of Hardhat\n\n2.12.2\n\n### What happened?\n\nContractFactory deploy fails to estimate gas on solidity version: \"0.8.20\" with Shanghai as default\n\n### Minimal reproduction steps\n\n- create new project from @PaulRBerg template https://github.com/PaulRBerg/hardhat-template\r\n- `pnpm install`\r\n- `pnpm compile && pnpm clean && pnpm test` => OK\r\n- in `hardhat.config.ts` change solidity compiler to   `solidity: {version: \"0.8.20\",`\r\n- run again `pnpm compile && pnpm clean && pnpm test` => ERROR\r\n\r\n```\r\n  1) Unit tests\r\n       Greeter\r\n         \"before each\" hook for \"should return the new greeting once it's changed\":\r\n     Error: cannot estimate gas; transaction may fail or may require manual gas limit [ See: https://links.ethers.org/v5-errors-UNPREDICTABLE_GAS_LIMIT ] (reason=\"Transaction reverted and Hardhat couldn't infer the reason.\", method=\"estimateGas\", transaction={\"from\":\"0xE12b5ca5Cf657184064dc2917933D008B6E6a168\",\"data\":\"0x608060405234801562000010575f80fd5b506040516200097738038062000977833981016040819052620000339162000116565b620000586040518060600160405280602281526020016200095560229139826200006d565b5f62000065828262000255565b50506200037b565b620000ba82826040516024016200\r\n```\n\n### Search terms\n\ndeploy, ethers, Solidity, Shanghai, v0.8.20",
  "closed_by": {
    "login": "fvictorio",
    "id": 417134,
    "node_id": "MDQ6VXNlcjQxNzEzNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvictorio",
    "html_url": "https://github.com/fvictorio",
    "followers_url": "https://api.github.com/users/fvictorio/followers",
    "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
    "organizations_url": "https://api.github.com/users/fvictorio/orgs",
    "repos_url": "https://api.github.com/users/fvictorio/repos",
    "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvictorio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 1,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576321785",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1576321785",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1576321785,
    "node_id": "IC_kwDOB7jojM5d9ML5",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T08:17:10Z",
    "updated_at": "2023-06-05T08:17:10Z",
    "author_association": "MEMBER",
    "body": "Thank you for the detailed instructions @SvenMeyer, I can confirm this.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576321785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576353394",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1576353394",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1576353394,
    "node_id": "IC_kwDOB7jojM5d9T5y",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T08:31:20Z",
    "updated_at": "2023-06-05T08:31:20Z",
    "author_association": "MEMBER",
    "body": "Ah, I see. The problem is that the template is using an older version of Hardhat, that doesn't have support for Shanghai (or at least doesn't have it enabled by default, I'm not sure).\r\n\r\nYou have two options here: either upgrade hardhat (`pnpm i --save-dev hardhat@latest`) or configure solidity to not emit bytecode for the shanghai hardfork. But I think the first option is what you want.\r\n\r\nClosing this because I don't thinks there's much we can do on our side.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576353394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576356146",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1576356146",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1576356146,
    "node_id": "IC_kwDOB7jojM5d9Uky",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T08:32:22Z",
    "updated_at": "2023-06-05T08:32:22Z",
    "author_association": "MEMBER",
    "body": "Btw, I feel like the proper solution here is to _not_ include the `pnpm-lock.yaml` in the template. @PaulRBerg would you be ok with doing that?",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576356146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576516862",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1576516862",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1576516862,
    "node_id": "IC_kwDOB7jojM5d97z-",
    "user": {
      "login": "SvenMeyer",
      "id": 25609,
      "node_id": "MDQ6VXNlcjI1NjA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/25609?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SvenMeyer",
      "html_url": "https://github.com/SvenMeyer",
      "followers_url": "https://api.github.com/users/SvenMeyer/followers",
      "following_url": "https://api.github.com/users/SvenMeyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/SvenMeyer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SvenMeyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SvenMeyer/subscriptions",
      "organizations_url": "https://api.github.com/users/SvenMeyer/orgs",
      "repos_url": "https://api.github.com/users/SvenMeyer/repos",
      "events_url": "https://api.github.com/users/SvenMeyer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SvenMeyer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T10:13:32Z",
    "updated_at": "2023-06-05T10:13:32Z",
    "author_association": "NONE",
    "body": "@fvictorio Thanks, upgrading hardhat to @latest \"^2.14.1\" solved the problem ! :+1: ",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1576516862/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582319357",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1582319357",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1582319357,
    "node_id": "IC_kwDOB7jojM5eUEb9",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-08T10:22:54Z",
    "updated_at": "2023-06-08T10:22:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I feel like the proper solution here is to not include the pnpm-lock.yaml in the template. @PaulRBerg would you be ok with doing that?\r\n\r\nNo, I don't think so. I do want dependencies to be deterministic upon installing the template.\r\n\r\nWhy can't we simply bump `hardhat` to `latest` in the template? That would update `pnpm-lock.yaml`.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582319357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582353686",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1582353686",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1582353686,
    "node_id": "IC_kwDOB7jojM5eUM0W",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-08T10:43:48Z",
    "updated_at": "2023-06-08T10:43:48Z",
    "author_association": "MEMBER",
    "body": "That's fair! I just personally think that not including the lock file makes more sense for a template (we take that approach in hardhat sample projects, for example). It means less maintenance and that users always get the latest versions of the dependencies.\n\nThe only downside I see is that a dependency that doesn't follow semver can cause problems, but if that happens you can pin it in the package.json.\n\nOf course, it's your template, you can do whatever you think is better 🙂",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582353686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582378325",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1582378325",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1582378325,
    "node_id": "IC_kwDOB7jojM5eUS1V",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-08T11:03:32Z",
    "updated_at": "2023-06-08T11:03:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "> It means less maintenance and that users always get the latest versions of the dependencies.\r\n\r\nDoesn't this go the other way, too? Users get the latest versions, which may contain (accidental) breaking changes.\r\n\r\nMaintenance is inevitable, I guess.\r\n\r\n> you can do whatever you think is better \r\n\r\nI'm thinking of simply bumping `hardhat`, and calling it a day.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582378325/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582391912",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/3977#issuecomment-1582391912",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/3977",
    "id": 1582391912,
    "node_id": "IC_kwDOB7jojM5eUWJo",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-08T11:13:46Z",
    "updated_at": "2023-06-08T11:13:46Z",
    "author_association": "MEMBER",
    "body": "I was gonna suggest that you use dependabot in that case, but it seems like it's already enabled? I wonder why it doesn't open PRs for new versions of Hardhat.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/1582391912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
