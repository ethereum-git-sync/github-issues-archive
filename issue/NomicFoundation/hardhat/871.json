{
  "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
  "repository_url": "https://api.github.com/repos/NomicFoundation/hardhat",
  "labels_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871/labels{/name}",
  "comments_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871/comments",
  "events_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871/events",
  "html_url": "https://github.com/NomicFoundation/hardhat/issues/871",
  "id": 719575038,
  "node_id": "MDU6SXNzdWU3MTk1NzUwMzg=",
  "number": 871,
  "title": "Buidler fails to recognize TypeScript setup in yarn (v1) workspace",
  "user": {
    "login": "Ungolim",
    "id": 45174270,
    "node_id": "MDQ6VXNlcjQ1MTc0Mjcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/45174270?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Ungolim",
    "html_url": "https://github.com/Ungolim",
    "followers_url": "https://api.github.com/users/Ungolim/followers",
    "following_url": "https://api.github.com/users/Ungolim/following{/other_user}",
    "gists_url": "https://api.github.com/users/Ungolim/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Ungolim/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Ungolim/subscriptions",
    "organizations_url": "https://api.github.com/users/Ungolim/orgs",
    "repos_url": "https://api.github.com/users/Ungolim/repos",
    "events_url": "https://api.github.com/users/Ungolim/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Ungolim/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": true,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2020-10-12T18:26:38Z",
  "updated_at": "2022-11-19T00:15:36Z",
  "closed_at": "2020-10-28T11:19:28Z",
  "author_association": "NONE",
  "active_lock_reason": "resolved",
  "body": "While we are aware of incompatibilities between Buidler and Yarn v2 (Berry) and the workarounds currently available, as documented here #586; I would also like to report the issues I have been experiencing with the Buidler TypeScript sample project setup in a monorepo environment with Yarn v1 as package manager.\r\n\r\nEssentially, it boils down to the following: if the ts-node and typescript packages are installed at the workspace node_modules level, then the Buidler project (in the same workspace) will fail to detect the TypeScript setup and instead launch the wizard again. When ts-node and typescript are installed at the root level, then Buidler works fine.\r\n\r\nI would like to take the chance to exort Nomic Labs to improve support for Yarn and extend it to Berry as well\r\n\r\n![zzzzzzx](https://user-images.githubusercontent.com/45174270/95778826-314cab00-0cc9-11eb-8efd-bf1e9f881222.JPG)\r\n\r\n",
  "closed_by": {
    "login": "Ungolim",
    "id": 45174270,
    "node_id": "MDQ6VXNlcjQ1MTc0Mjcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/45174270?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Ungolim",
    "html_url": "https://github.com/Ungolim",
    "followers_url": "https://api.github.com/users/Ungolim/followers",
    "following_url": "https://api.github.com/users/Ungolim/following{/other_user}",
    "gists_url": "https://api.github.com/users/Ungolim/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Ungolim/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Ungolim/subscriptions",
    "organizations_url": "https://api.github.com/users/Ungolim/orgs",
    "repos_url": "https://api.github.com/users/Ungolim/repos",
    "events_url": "https://api.github.com/users/Ungolim/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Ungolim/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707687546",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-707687546",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 707687546,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzY4NzU0Ng==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T11:52:44Z",
    "updated_at": "2020-10-13T11:52:44Z",
    "author_association": "MEMBER",
    "body": "Hey @lepidotteri!\r\n\r\nThanks for opening this issue. We fixed the typescript support a few versions ago, and now works in yarn workspaces. I just tried it with this project structure and worked.\r\n\r\n```\r\n.\r\n├── node_modules\r\n│   ├── @nomiclabs\r\n│   │   ├── buidler\r\n│   │   └── ...\r\n│   ├── ...\r\n│   ├── ts-node\r\n│   │   ├── L...\r\n│   ├── ...\r\n│   ├── typescript\r\n│   │   ├── ...\r\n│   ├── ...\r\n├── package.json\r\n├── packages\r\n│   ├── contracts // Running yarn buidler from this folder\r\n│   │   ├── buidler.config.ts\r\n│   │   ├── node_modules // THIS IS EMPTY\r\n│   │   └── package.json\r\n│   └── something\r\n│       ├── node_modules // THIS IS EMPTY\r\n│       └── package.json\r\n└── yarn.lock\r\n```\r\n\r\nAm I missing something?\r\n\r\nRegarding Berry, we'll be in a much better position to properly support it in our next major version. It's coming out really soon.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707687546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707692355",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-707692355",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 707692355,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzY5MjM1NQ==",
    "user": {
      "login": "Ungolim",
      "id": 45174270,
      "node_id": "MDQ6VXNlcjQ1MTc0Mjcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/45174270?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ungolim",
      "html_url": "https://github.com/Ungolim",
      "followers_url": "https://api.github.com/users/Ungolim/followers",
      "following_url": "https://api.github.com/users/Ungolim/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ungolim/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ungolim/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ungolim/subscriptions",
      "organizations_url": "https://api.github.com/users/Ungolim/orgs",
      "repos_url": "https://api.github.com/users/Ungolim/repos",
      "events_url": "https://api.github.com/users/Ungolim/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ungolim/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T12:03:03Z",
    "updated_at": "2020-10-13T12:03:03Z",
    "author_association": "NONE",
    "body": "Hi @alcuadrado ,\r\n\r\nThank you for the prompt reply, I welcome that you officially fixed incompatibilities among typescript, yarn and Buidler and can confirm that your project structure works just fine, as I had pointed out myself here: \r\n> When ts-node and typescript are installed at the root level, then Buidler works fine.\r\n\r\nAside from that,\r\n> Am I missing something?\r\n\r\nIn a way yes, I originally opened this issue to report the fact that we are currently unable to get a working yarn + typescript setup for Buidler if the TS libs are installed at the package level; shouldn't we have that option and flexibility as well?\r\n\r\n> Regarding Berry, we'll be in a much better position to properly support it in our next major version. It's coming out really soon.\r\n\r\nWell this is very encouraging news then, thank you",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707692355/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707711265",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-707711265",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 707711265,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzcxMTI2NQ==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T12:40:36Z",
    "updated_at": "2020-10-13T12:40:36Z",
    "author_association": "MEMBER",
    "body": "> if the TS libs are installed at the package level; shouldn't we have that option and flexibility as well?\r\n\r\nCan you show me an example of how this would look? I'm not following.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707711265/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707769537",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-707769537",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 707769537,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzc2OTUzNw==",
    "user": {
      "login": "Ungolim",
      "id": 45174270,
      "node_id": "MDQ6VXNlcjQ1MTc0Mjcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/45174270?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ungolim",
      "html_url": "https://github.com/Ungolim",
      "followers_url": "https://api.github.com/users/Ungolim/followers",
      "following_url": "https://api.github.com/users/Ungolim/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ungolim/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ungolim/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ungolim/subscriptions",
      "organizations_url": "https://api.github.com/users/Ungolim/orgs",
      "repos_url": "https://api.github.com/users/Ungolim/repos",
      "events_url": "https://api.github.com/users/Ungolim/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ungolim/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T14:16:33Z",
    "updated_at": "2020-10-13T14:16:33Z",
    "author_association": "NONE",
    "body": "> Can you show me an example of how this would look? I'm not following.\r\n\r\nSimply, when ts-node and typescript libs are installed in any of the node_modules folders at the workspace/package level (same level where buidler.config.ts is located as well), then Buidler will fail to detect the TS setup.\r\n\r\nLet me know if you need screenshots, I have two projects structures I had readied to reproduce the \"issue\", and btw, this is also how I came to spot it the first time; these projects were pretty much forks, with the exception that in one of the other packages were installed typescript and ts-node as well (due to the workspace being a Svelte + TS sample app); so Yarn identified the presence of typescript and ts-node in two workspaces and correctly moved it at the root node_modules to avoid deps duplicates within the packages; hence Buidler recognized the TS setup for that project and worked just fine",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707769537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707963513",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-707963513",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 707963513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzk2MzUxMw==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T19:36:23Z",
    "updated_at": "2020-10-13T19:36:23Z",
    "author_association": "MEMBER",
    "body": "> Simply, when ts-node and typescript libs are installed in any of the node_modules folders at the workspace/package level (same level where buidler.config.ts is located as well), then Buidler will fail to detect the TS setup.\r\n\r\nDo you mean in packages that are not your buidler project? Why would it detect that? I think there's something missing in your explanation, so an output of `tree` or a screanshot would be useful.",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/707963513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/717867659",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-717867659",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 717867659,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzg2NzY1OQ==",
    "user": {
      "login": "Ungolim",
      "id": 45174270,
      "node_id": "MDQ6VXNlcjQ1MTc0Mjcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/45174270?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ungolim",
      "html_url": "https://github.com/Ungolim",
      "followers_url": "https://api.github.com/users/Ungolim/followers",
      "following_url": "https://api.github.com/users/Ungolim/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ungolim/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ungolim/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ungolim/subscriptions",
      "organizations_url": "https://api.github.com/users/Ungolim/orgs",
      "repos_url": "https://api.github.com/users/Ungolim/repos",
      "events_url": "https://api.github.com/users/Ungolim/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ungolim/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-28T11:19:28Z",
    "updated_at": "2020-10-28T11:19:28Z",
    "author_association": "NONE",
    "body": "I will close this for now @alcuadrado, sorry for not finding time to provide you with all relevant screenshots; the problem doesn't seem to be there with Hardhat and Yarn v1.\r\n\r\nIf you can update us on support for Berry meanwhile.\r\n\r\nThank you very much for your support",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/717867659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/717918680",
    "html_url": "https://github.com/NomicFoundation/hardhat/issues/871#issuecomment-717918680",
    "issue_url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/871",
    "id": 717918680,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzkxODY4MA==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-28T13:04:38Z",
    "updated_at": "2020-10-28T13:04:38Z",
    "author_association": "MEMBER",
    "body": "I'm glad it's fixed.\r\n\r\nI tried running Hardhat with Berry, but there are multiple dependencies that fail. Hardhat now doesn't rely on a node_modules, but a few dependencies have their dependencies incorrectly declared :(",
    "reactions": {
      "url": "https://api.github.com/repos/NomicFoundation/hardhat/issues/comments/717918680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
