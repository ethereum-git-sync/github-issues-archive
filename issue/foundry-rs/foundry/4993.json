{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4993",
  "id": 1718256196,
  "node_id": "I_kwDOGBlvNc5maoJE",
  "number": 4993,
  "title": "Compiler run failed error[7576]: DeclarationError: Undeclared identifier. Did you mean \"Vm\"?",
  "user": {
    "login": "deep0072",
    "id": 46425800,
    "node_id": "MDQ6VXNlcjQ2NDI1ODAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/46425800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deep0072",
    "html_url": "https://github.com/deep0072",
    "followers_url": "https://api.github.com/users/deep0072/followers",
    "following_url": "https://api.github.com/users/deep0072/following{/other_user}",
    "gists_url": "https://api.github.com/users/deep0072/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deep0072/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deep0072/subscriptions",
    "organizations_url": "https://api.github.com/users/deep0072/orgs",
    "repos_url": "https://api.github.com/users/deep0072/repos",
    "events_url": "https://api.github.com/users/deep0072/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deep0072/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-05-20T18:55:22Z",
  "updated_at": "2023-05-20T19:00:02Z",
  "closed_at": "2023-05-20T19:00:01Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [x] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (8d0099b 2023-04-19T00:08:21.764755505Z)\n\n### What command(s) is the bug in?\n\nforge build\n\n### Operating System\n\nWindows\n\n### Describe the bug\n\n```// SPDX-License-Identifier: UNLICENSED\r\npragma solidity ^0.8.0;\r\n\r\nimport \"forge-std/Test.sol\";\r\nimport \"forge-std/console.sol\";\r\nimport \"../src/ERC20PERMIT.sol\";\r\nimport \"../src/GasLessTokenTransfer.sol\";\r\n\r\ncontract GasLessTokenTransferTest {\r\n    ERC20Permit private token;\r\n    GasLessTokenTransfer private gasLess;\r\n\r\n    address sender;\r\n    address receiver;\r\n    uint constant AMOUNT = 1000; // 10K DAI TOKEN WE WILL TRANSFER\r\n    uint constant FEE = 10; // 10 DAI TOKEN WILL BE PAID AS FEE\r\n\r\n    uint256 constant SENDER_PRIVATE_KEY = 123;\r\n\r\n    function setUp() public {\r\n        sender = vm.addr(SENDER_PRIVATE_KEY);\r\n        receiver = address(2); // this is local address of foundry that will be act as receiver address\r\n        token = new ERC20Permit(\"test\", \"test\", 18);\r\n\r\n        //\r\n        token.mint(sender, AMOUNT + FEE); // here we are givng amount to sender.\r\n        gasLess = new GasLessTokenTransfer();\r\n    }\r\n\r\n    // this test gonna let sender sign up the permit message and this contract will call GasLessTokenTransfer contract\r\n    // and token will be transfer from sender to reciever address  amd this contract will recieve some of fee\r\n    function testValidSig() public {\r\n        uint deadline = block.timestamp + 60;\r\n        // prepare the permit hash\r\n        bytes32 permitHash = _getPermitHash(\r\n            sender,\r\n            address(gasLess),\r\n            AMOUNT + FEE,\r\n            token.nonces(sender),\r\n            deadline\r\n        );\r\n\r\n        // after getting the hash, sign the hash with the help of sender\r\n        (uint v, bytes32 r, bytes32 s) = Vm.sign(\r\n            SENDER_PRIVATE_KEY,\r\n            permitHash\r\n        ); // v ,r ,s part of signed message\r\n\r\n        // Execute send\r\n        gasLess.send(\r\n            address(token),\r\n            sender,\r\n            receiver,\r\n            AMOUNT,\r\n            FEE,\r\n            deadline,\r\n            v,\r\n            r,\r\n            s\r\n        );\r\n\r\n        // check token balance\r\n        token.balanceOf(sender);\r\n    }\r\n\r\n    // this will return permit hash of signed message\r\n    function _getPermitHash(\r\n        address owner,\r\n        address spender,\r\n        uint value,\r\n        uint nonces,\r\n        uint deadline\r\n    ) private view returns (bytes32) {\r\n        return\r\n            keccak256(\r\n                abi.encodePacked(\r\n                    \"\\x19\\x01\",\r\n                    token.DOMAIN_SEPARATOR(),\r\n                    keccak256(\r\n                        abi.encode(\r\n                            keccak256(\r\n                                \"Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)\"\r\n                            ),\r\n                            owner,\r\n                            spender,\r\n                            value,\r\n                            nonces,\r\n                            deadline\r\n                        )\r\n                    )\r\n                )\r\n            );\r\n    }\r\n}\r\n```\r\n\r\nwhen i run forge build it shows error \r\n\r\n```[⠔] Compiling...\r\n[⠃] Compiling 23 files with 0.8.19\r\n[⠊] Solc 0.8.19 finished in 1.35s\r\nError: \r\nCompiler run failed\r\nerror[7576]: DeclarationError: Undeclared identifier. Did you mean \"Vm\"?\r\n  --> test/GasLessTokenContract.t.sol:21:18:\r\n   |\r\n21 |         sender = vm.addr(SENDER_PRIVATE_KEY);\r\n   |                  ^^```",
  "closed_by": {
    "login": "deep0072",
    "id": 46425800,
    "node_id": "MDQ6VXNlcjQ2NDI1ODAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/46425800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deep0072",
    "html_url": "https://github.com/deep0072",
    "followers_url": "https://api.github.com/users/deep0072/followers",
    "following_url": "https://api.github.com/users/deep0072/following{/other_user}",
    "gists_url": "https://api.github.com/users/deep0072/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deep0072/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deep0072/subscriptions",
    "organizations_url": "https://api.github.com/users/deep0072/orgs",
    "repos_url": "https://api.github.com/users/deep0072/repos",
    "events_url": "https://api.github.com/users/deep0072/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deep0072/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1555972045",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4993#issuecomment-1555972045",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993",
    "id": 1555972045,
    "node_id": "IC_kwDOGBlvNc5cvj_N",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-20T18:56:34Z",
    "updated_at": "2023-05-20T18:56:34Z",
    "author_association": "COLLABORATOR",
    "body": "You need to inherit the `Test` contract from forge-std: `contract GasLessTokenTransferTest is Test {}`\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1555972045/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1555972684",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4993#issuecomment-1555972684",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4993",
    "id": 1555972684,
    "node_id": "IC_kwDOGBlvNc5cvkJM",
    "user": {
      "login": "deep0072",
      "id": 46425800,
      "node_id": "MDQ6VXNlcjQ2NDI1ODAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/46425800?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deep0072",
      "html_url": "https://github.com/deep0072",
      "followers_url": "https://api.github.com/users/deep0072/followers",
      "following_url": "https://api.github.com/users/deep0072/following{/other_user}",
      "gists_url": "https://api.github.com/users/deep0072/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/deep0072/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/deep0072/subscriptions",
      "organizations_url": "https://api.github.com/users/deep0072/orgs",
      "repos_url": "https://api.github.com/users/deep0072/repos",
      "events_url": "https://api.github.com/users/deep0072/events{/privacy}",
      "received_events_url": "https://api.github.com/users/deep0072/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-20T19:00:01Z",
    "updated_at": "2023-05-20T19:00:01Z",
    "author_association": "NONE",
    "body": "oops sorry i did not check that silly mistake. my bad",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1555972684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
