{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5559",
  "id": 1841031806,
  "node_id": "I_kwDOGBlvNc5tu-p-",
  "number": 5559,
  "title": "Hardhat and foundry, contract compile bytecode different",
  "user": {
    "login": "dangcongtanpnt94",
    "id": 27964406,
    "node_id": "MDQ6VXNlcjI3OTY0NDA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/27964406?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dangcongtanpnt94",
    "html_url": "https://github.com/dangcongtanpnt94",
    "followers_url": "https://api.github.com/users/dangcongtanpnt94/followers",
    "following_url": "https://api.github.com/users/dangcongtanpnt94/following{/other_user}",
    "gists_url": "https://api.github.com/users/dangcongtanpnt94/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dangcongtanpnt94/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dangcongtanpnt94/subscriptions",
    "organizations_url": "https://api.github.com/users/dangcongtanpnt94/orgs",
    "repos_url": "https://api.github.com/users/dangcongtanpnt94/repos",
    "events_url": "https://api.github.com/users/dangcongtanpnt94/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dangcongtanpnt94/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-08T10:27:48Z",
  "updated_at": "2023-08-09T13:19:11Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [ ] Foundry\n- [ ] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (394f217 2023-03-21T00:11:00.708322Z)\n\n### What command(s) is the bug in?\n\nforge test\n\n### Operating System\n\nNone\n\n### Describe the bug\n\nI'm developing contracts on a hardhat project, and I want to write test for it by foundry. The problem I'm facing is: In my contract, I will create a new child contract with the same salt + constructor params, but when running it on foundry and hardhat, it provides different addresses. After looking for the issue, I found that bytecode of child contract from foundry and hardhat is not the same, it means the bytecode which is compiled by foundry (in `out`) and hardhat (in `artifacts`) are different. My test in hardhat worked well, I can predict the child contract address by `ethers.utils.getCreate2Address` in js.\r\n\r\nI wonder if there is any difference between the hardhat config and foundry toml, but after many try with many kinds of config, the problem is still there. \r\nIs there any way to ensure that the config of hardhat and foundry execute the same.\r\n\r\nThis is my smart contract code:\r\n```\r\ncontract Parent {\r\n\r\n  function born(bytes32 id, string memory name, uint256 weight) external  returns(address) {\r\n      Child child = new Child{salt: id}(name, weight);\r\n      return address(child);\r\n  }\r\n}\r\n```\r\n\r\nhardhat config:\r\n```\r\nconfig = {\r\n  solidity: {\r\n    version: \"0.8.18\",\r\n    evmVersion: \"london\",\r\n    settings: {\r\n      optimizer: {\r\n        enabled: true,\r\n        runs: 200,\r\n      },\r\n    },\r\n  }\r\n...\r\n}\r\n```\r\n\r\nfoundry config\r\n```\r\n[profile.default]\r\nsrc = 'contracts'\r\nout = 'out'\r\nlibs = ['node_modules', 'lib']\r\ntest = 'test/foundry'\r\ncache_path  = 'forge-cache'\r\ngas_reports = [\"*\"]\r\noptimizer = true\r\noptimizer_runs = 200\r\nsolc = \"0.8.18\"\r\nevm_version = \"london\"\r\nauto_detect_solc = false\r\n```\r\n\r\nForge version: `0.2.0`\r\nHardhat version: `2.14.0`",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1671313693",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5559#issuecomment-1671313693",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5559",
    "id": 1671313693,
    "node_id": "IC_kwDOGBlvNc5jnjkd",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-09T13:19:11Z",
    "updated_at": "2023-08-09T13:19:11Z",
    "author_association": "MEMBER",
    "body": "> which is compiled by foundry (in out) and hardhat (in artifacts) are different.\r\n\r\ndifferent how? metadata hash?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1671313693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
