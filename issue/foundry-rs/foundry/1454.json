{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1454",
  "id": 1220287949,
  "node_id": "I_kwDOGBlvNc5IvB3N",
  "number": 1454,
  "title": "`vm.prank` design comment",
  "user": {
    "login": "0xdavinchee",
    "id": 20151633,
    "node_id": "MDQ6VXNlcjIwMTUxNjMz",
    "avatar_url": "https://avatars.githubusercontent.com/u/20151633?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xdavinchee",
    "html_url": "https://github.com/0xdavinchee",
    "followers_url": "https://api.github.com/users/0xdavinchee/followers",
    "following_url": "https://api.github.com/users/0xdavinchee/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xdavinchee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xdavinchee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xdavinchee/subscriptions",
    "organizations_url": "https://api.github.com/users/0xdavinchee/orgs",
    "repos_url": "https://api.github.com/users/0xdavinchee/repos",
    "events_url": "https://api.github.com/users/0xdavinchee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xdavinchee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    },
    {
      "id": 3593644915,
      "node_id": "LA_kwDOGBlvNc7WMqtz",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-test",
      "name": "Cmd-forge-test",
      "color": "006B75",
      "default": false,
      "description": "Command: forge test"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3703752960,
      "node_id": "LA_kwDOGBlvNc7cwskA",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-cheatcodes",
      "name": "A-cheatcodes",
      "color": "FBCA04",
      "default": false,
      "description": "Area: cheatcodes"
    },
    {
      "id": 3776975605,
      "node_id": "LA_kwDOGBlvNc7hIBL1",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-debug",
      "name": "Cmd-forge-debug",
      "color": "006B75",
      "default": false,
      "description": "Command: forge run"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 125,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-05-12T14:44:03Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 4,
  "created_at": "2022-04-29T09:00:48Z",
  "updated_at": "2023-03-09T22:51:47Z",
  "closed_at": "2023-03-09T22:51:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Describe the feature you would like\n\nWhen I use `vm.prank(msgSender);` and execute an external/public call, the behavior works as expected:\r\n\r\n```\r\nvm.prank(msgSender);\r\nsomePublicOrExternal.function();\r\n```\r\nHowever, when I do the same with an internal call/calling a library function I have to use this syntax:\r\n```\r\nvm.startPrank(msgSender);\r\nsomeLibOrInternal.function();\r\nvm.stopPrank();\r\n```\r\notherwise, it fails because any calls inside `function` no longer have `msg.sender` set as the pranked `msgSender`.\r\n\r\nIt would be nice if we could just do:\r\n\r\n```\r\nvm.prank(msgSender);\r\nsomeLibOrInternal.function();\r\n```\n\n### Additional context\n\n_No response_",
  "closed_by": {
    "login": "mds1",
    "id": 17163988,
    "node_id": "MDQ6VXNlcjE3MTYzOTg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mds1",
    "html_url": "https://github.com/mds1",
    "followers_url": "https://api.github.com/users/mds1/followers",
    "following_url": "https://api.github.com/users/mds1/following{/other_user}",
    "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
    "organizations_url": "https://api.github.com/users/mds1/orgs",
    "repos_url": "https://api.github.com/users/mds1/repos",
    "events_url": "https://api.github.com/users/mds1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mds1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1114011149",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1454#issuecomment-1114011149",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454",
    "id": 1114011149,
    "node_id": "IC_kwDOGBlvNc5CZnYN",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-30T16:00:15Z",
    "updated_at": "2022-04-30T16:00:15Z",
    "author_association": "MEMBER",
    "body": "Related to #432. We only mock *calls*, not jumps - internal functions are not calls, they are jumps. Not sure what the best path forward here is",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1114011149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1114623922",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1454#issuecomment-1114623922",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454",
    "id": 1114623922,
    "node_id": "IC_kwDOGBlvNc5Cb8-y",
    "user": {
      "login": "hellwolf",
      "id": 186660,
      "node_id": "MDQ6VXNlcjE4NjY2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/186660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hellwolf",
      "html_url": "https://github.com/hellwolf",
      "followers_url": "https://api.github.com/users/hellwolf/followers",
      "following_url": "https://api.github.com/users/hellwolf/following{/other_user}",
      "gists_url": "https://api.github.com/users/hellwolf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hellwolf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hellwolf/subscriptions",
      "organizations_url": "https://api.github.com/users/hellwolf/orgs",
      "repos_url": "https://api.github.com/users/hellwolf/repos",
      "events_url": "https://api.github.com/users/hellwolf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hellwolf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-02T08:37:28Z",
    "updated_at": "2022-05-02T08:37:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I understood the technical difference, but I guess it's more of a design issue, that \"surprises\" are baked in depending on what type of call the next line is which is not obvious just by looking at it locally.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1114623922/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1114628759",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1454#issuecomment-1114628759",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454",
    "id": 1114628759,
    "node_id": "IC_kwDOGBlvNc5Cb-KX",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-02T08:44:28Z",
    "updated_at": "2022-05-02T08:45:11Z",
    "author_association": "MEMBER",
    "body": "Sure, but what I am trying to convey is that it's not as much of a design decision as it is a technical limitation, or at least requires a lot of careful thought.\r\n\r\nIn order to support calls to internal functions, we'd have to first figure out where in the bytecode that function is, and then pass that info along to the cheatcode handler. However, the issue with doing this is that functions may be inlined, and they may even in some cases be merged, so it would only work with the optimizer off.\r\n\r\nOn top of this, we'd have to identify contracts on the fly as well (this is done later), leading to slowdowns overall.\r\n\r\nFor prank it might be simpler since we could \"just\" prank everything instead of only calls above a certain depth. This would imply that the prank is always in effect though, since we wouldn't know when to stop it, so `prank` and `startPrank` essentially become the same thing. This is also a breaking change, so it's not easy to do without people definitely having to rewrite their tests",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1114628759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1462934765",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1454#issuecomment-1462934765",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1454",
    "id": 1462934765,
    "node_id": "IC_kwDOGBlvNc5XMpzt",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-09T22:51:47Z",
    "updated_at": "2023-03-09T22:51:47Z",
    "author_association": "COLLABORATOR",
    "body": "Not sure if there are plans to support JUMPs, and if we do there's a lot of cheats this would cover (not just prank), so going to close this in favor of a broader solution that I'll mention in #4439 ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1462934765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
