{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5741",
  "id": 1871577951,
  "node_id": "I_kwDOGBlvNc5vjgNf",
  "number": 5741,
  "title": "Can't Verify Contracts in Either Sepolia or Moonbase Alpha/Moonbeam because of `Failed to deserialize response`",
  "user": {
    "login": "albertov19",
    "id": 64150856,
    "node_id": "MDQ6VXNlcjY0MTUwODU2",
    "avatar_url": "https://avatars.githubusercontent.com/u/64150856?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/albertov19",
    "html_url": "https://github.com/albertov19",
    "followers_url": "https://api.github.com/users/albertov19/followers",
    "following_url": "https://api.github.com/users/albertov19/following{/other_user}",
    "gists_url": "https://api.github.com/users/albertov19/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/albertov19/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/albertov19/subscriptions",
    "organizations_url": "https://api.github.com/users/albertov19/orgs",
    "repos_url": "https://api.github.com/users/albertov19/repos",
    "events_url": "https://api.github.com/users/albertov19/events{/privacy}",
    "received_events_url": "https://api.github.com/users/albertov19/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-08-29T12:34:36Z",
  "updated_at": "2023-08-29T17:28:29Z",
  "closed_at": "2023-08-29T16:26:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (bff4ed9 2023-08-29T00:16:15.395348141Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge verify-contract\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\nI have a very simple contract that I was able to verify with the Hardhat Etherscan plugin. Consequently I was going to try verifying it with Foundry in Moonbase Alpha and I ran into the following error:\r\n\r\n```\r\nforge verify-contract --chain-id 1287 \\\r\n--verifier etherscan \\\r\n--verifier-url https://api-moonbase.moonscan.io/api \\\r\n0x06F789662F6a776BF1C551409985311b52C41a32 \\\r\n--constructor-args 0x0000000000000000000000000000000000000000000000000000000000000014 \\\r\nsrc/Number.sol:Number \\\r\n--etherscan-api-key MY_API_KEY\r\n\r\nStart verifying contract `0x06f789662f6a776bf1c551409985311b52c41a32` deployed on moonbase\r\n2023-08-29T12:31:35.427671Z ERROR etherscan: Failed to deserialize response: expected value at line 1 column 1 res=\"<!DOCTYPE html><html lang=\\\"en-US\\\"><head><title>Just a moment...</title><meta http-equiv=\\\"Content-Type\\\" content=\\\"t\r\n..... A LOT OF THINGS .......\r\nXzgw7a3gr5MEPQlJTp3M0-1693312295-0-gaNycGzNCrs\\\" + window._cf_chl_opt.cOgUHash);cpo.onload = function() {history.replaceState(null, null, ogU);};}document.getElementsByTagName('head')[0].appendChild(cpo);}());</script></body></html>\"\r\nError: \r\nexpected value at line 1 column 1\r\n```\r\n\r\nThen I was thinking this could be an issue with Etherscan's Moonbase Alpha API. Soooo, I went to test the same thing against Sepolia (changing API Key, endpoint, chain id, etc) and the same error message there as well. I know some of my inputs are not mandatory but I was just trying different things.\r\n\r\nThe basic contract I was trying to verify is this one:\r\n\r\n```\r\n// SPDX-License-Identifier: MIT\r\npragma solidity =0.8.0;\r\n\r\ncontract Number {\r\n    uint public number;\r\n\r\n    constructor (uint _input) {\r\n        number = _input;\r\n    }\r\n\r\n    function setNumberTest(uint _input) public {\r\n        number = _input;\r\n    }\r\n}\r\n```\r\n\r\nThanks for looking into it\r\n",
  "closed_by": {
    "login": "Evalir",
    "id": 26014927,
    "node_id": "MDQ6VXNlcjI2MDE0OTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Evalir",
    "html_url": "https://github.com/Evalir",
    "followers_url": "https://api.github.com/users/Evalir/followers",
    "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
    "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
    "organizations_url": "https://api.github.com/users/Evalir/orgs",
    "repos_url": "https://api.github.com/users/Evalir/repos",
    "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Evalir/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697778349",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5741#issuecomment-1697778349",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741",
    "id": 1697778349,
    "node_id": "IC_kwDOGBlvNc5lMgqt",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-29T16:26:46Z",
    "updated_at": "2023-08-29T16:26:46Z",
    "author_association": "MEMBER",
    "body": "gotcha—from the output i believe this might be a divergence in the moonbase and sepolia API—could you please repost this on https://github.com/foundry-rs/foundry/issues/5251 ? we're trying to consolidate verification failures to a few issues. Thanks for reporting and the repro!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697778349/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697790722",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5741#issuecomment-1697790722",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741",
    "id": 1697790722,
    "node_id": "IC_kwDOGBlvNc5lMjsC",
    "user": {
      "login": "Enigmatic331",
      "id": 28551011,
      "node_id": "MDQ6VXNlcjI4NTUxMDEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/28551011?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Enigmatic331",
      "html_url": "https://github.com/Enigmatic331",
      "followers_url": "https://api.github.com/users/Enigmatic331/followers",
      "following_url": "https://api.github.com/users/Enigmatic331/following{/other_user}",
      "gists_url": "https://api.github.com/users/Enigmatic331/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Enigmatic331/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Enigmatic331/subscriptions",
      "organizations_url": "https://api.github.com/users/Enigmatic331/orgs",
      "repos_url": "https://api.github.com/users/Enigmatic331/repos",
      "events_url": "https://api.github.com/users/Enigmatic331/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Enigmatic331/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-29T16:35:12Z",
    "updated_at": "2023-08-29T16:42:31Z",
    "author_association": "NONE",
    "body": "PS: Team Etherscan here. When we profiled the API call from Foundry, it was something akin to `https://api-moonbase.moonscan.io/api/?apikey=teehee&module=contract&action=getabi&address=0x75417d9ad3b1c1fb1ac409f5817dcc9e3df6a90e` - (note the additional / behind ?) - This would trip some of our CF rule checks.\r\n\r\nIf we can get the calls to be `https://api-moonbase.moonscan.io/api?apikey=teehee&module=contract&action=getabi&address=0x75417d9ad3b1c1fb1ac409f5817dcc9e3df6a90e` instead it should work.\r\n\r\nI \"think\" if we try `--verifier-url https://api-moonbase.moonscan.io/api?` it'd work.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697790722/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697796275",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5741#issuecomment-1697796275",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741",
    "id": 1697796275,
    "node_id": "IC_kwDOGBlvNc5lMlCz",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-29T16:39:19Z",
    "updated_at": "2023-08-29T16:39:19Z",
    "author_association": "MEMBER",
    "body": "thank you for chiming in @Enigmatic331 ! yep this will prob cause problems, will investigate.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697796275/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697860951",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5741#issuecomment-1697860951",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5741",
    "id": 1697860951,
    "node_id": "IC_kwDOGBlvNc5lM01X",
    "user": {
      "login": "albertov19",
      "id": 64150856,
      "node_id": "MDQ6VXNlcjY0MTUwODU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/64150856?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/albertov19",
      "html_url": "https://github.com/albertov19",
      "followers_url": "https://api.github.com/users/albertov19/followers",
      "following_url": "https://api.github.com/users/albertov19/following{/other_user}",
      "gists_url": "https://api.github.com/users/albertov19/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/albertov19/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/albertov19/subscriptions",
      "organizations_url": "https://api.github.com/users/albertov19/orgs",
      "repos_url": "https://api.github.com/users/albertov19/repos",
      "events_url": "https://api.github.com/users/albertov19/events{/privacy}",
      "received_events_url": "https://api.github.com/users/albertov19/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-29T17:28:29Z",
    "updated_at": "2023-08-29T17:28:29Z",
    "author_association": "NONE",
    "body": "Hey to echo what @Enigmatic331 stated. I tried the same as before with the extra `?`:\r\n\r\n```\r\nforge verify-contract --chain-id 1287 \\\r\n--verifier etherscan \\\r\n--verifier-url https://api-moonbase.moonscan.io/api? \\\r\n0x06F789662F6a776BF1C551409985311b52C41a32 \\\r\n--constructor-args 0x0000000000000000000000000000000000000000000000000000000000000014 \\\r\nsrc/Number.sol:Number \\\r\n--etherscan-api-key MY_API_KEY\r\n```\r\n\r\nAnd got the right message:\r\n\r\n```\r\nStart verifying contract `0x31e7facdcf9308bdf3d8bf83b1c63ddb72727012` deployed on moonbeam\r\n\r\nSubmitting verification for [src/UniversalRouter.sol:UniversalRouter] \"0x31e7faCDCf9308BDf3d8Bf83b1C63Ddb72727012\".\r\nSubmitted contract for verification:\r\n        Response: `OK`\r\n        GUID: `idnrnjgxycrccfxiyfclixxkwm2wbrrxwk76iipjavg41s6zuq`\r\n        URL:\r\n        https://moonbeam.moonscan.io/address/0x31e7facdcf9308bdf3d8bf83b1c63ddb72727012\\\r\n```\r\n\r\nUnfortunately it failed with just `Fail - Unable to verify` but that is a separate story.\r\n\r\n@Evalir I'll move the post to the Issue you suggested. Thanks for looking into it",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1697860951/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
