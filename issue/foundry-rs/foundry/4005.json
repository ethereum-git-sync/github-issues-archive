{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4005",
  "id": 1515983140,
  "node_id": "I_kwDOGBlvNc5aXBEk",
  "number": 4005,
  "title": "Feat: Reduce Build Time by 2/3 for Darwin aarch64/x86",
  "user": {
    "login": "sambacha",
    "id": 32783916,
    "node_id": "MDQ6VXNlcjMyNzgzOTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sambacha",
    "html_url": "https://github.com/sambacha",
    "followers_url": "https://api.github.com/users/sambacha/followers",
    "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
    "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
    "organizations_url": "https://api.github.com/users/sambacha/orgs",
    "repos_url": "https://api.github.com/users/sambacha/repos",
    "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sambacha/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3746533612,
      "node_id": "LA_kwDOGBlvNc7fT5Ds",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-meta",
      "name": "T-meta",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: meta"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-01-02T03:09:11Z",
  "updated_at": "2023-01-06T15:46:00Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nOther (please describe)\r\n\r\n### Describe the feature you would like\r\n\r\n# Upgrade XCode SDK and use latest linker for perf. \r\n\r\n> compile take long. foundry too many thingys. make go faster. use latest lld linker, much improve\r\n\r\n## Background\r\n\r\nCurrently foundry is building against XCode 12.3 SDK (released on 26 Jan 2021) for providing macOS binaries for both x86 and aarch64. This is the last version of XCode that provides support for macOS 10.15.4+. \r\n\r\nWith Xcode 14.2 released a few weeks ago aarch64 (m1/m2) users can enjoy stupid fast builds thanks to the massive upgrades Apple has done to the long neglected ld64.lld linker \r\n\r\n> [See Apples wwdc2022 presentation on the changes made for the linker](https://developer.apple.com/videos/play/wwdc2022/110362) and an additional [presentation specific to runtime info on ld64 linker updates with XCode 14](https://developer.apple.com/videos/play/wwdc2022/110362/?time=1695)\r\n\r\n## Proposed Solution \r\n\r\n*Add an ADDITIONAL build for aarch64 users or provide a link for those users to grab it* I am building them for my own usage as the benefit is worth it. \r\n\r\n- additional binary using an upgrade XCode 14 SDK and l64.lld linker \r\n- consider deprecating support for anything below macOS 11 \r\n- construct benchmarks for both CI build time and user usage \r\n\r\nFor XCode >14 use [ld64.lld with fixes](https://github.com/keith/ld64.lld/releases)\r\n\r\n\r\n### Building with ld64.lld\r\n\r\n```bash\r\ngh repo clone foundry-rs/foundry && cd foundry\r\nwget https://github.com/keith/ld64.lld/releases/download/12-22-22/ld64.tar.gz \r\ntar -xf ld64.tar.gz \r\nRUSTFLAGS=\"-Clink-arg=-fuse-ld=$PWD/ld64.lld\" cargo build --release --bins --target aarch64-apple-darwin\r\n```\r\n\r\n### Speed Improvements\r\n\r\nWe can see the [build time for the entire repo is 13m 21s](https://github.com/foundry-rs/foundry/actions/runs/3819280516/jobs/6496702643#step:7:30)\r\n\r\nBuild times using default configuration was just under 12m 58s on my local machine\r\n\r\nBuild times using the additional linker and XCode 14 resulted in a build time of 4m 51s. \r\n\r\n```console\r\nusr@foundry:~$  Finished release [optimized] target(s) in 4m 51s\r\n```\r\n\r\n### References \r\n\r\n- [https://discourse.llvm.org/t/marketing-and-release-of-mach-o-lld/63143](https://discourse.llvm.org/t/marketing-and-release-of-mach-o-lld/63143)\r\n- https://lld.llvm.org/MachO/index.html\r\n- https://lld.llvm.org/MachO/ld64-vs-lld.html\r\n- https://github.com/bluewhalesystems/sold *NOTE* This is a **commercial** linker that claims to have the fastest linker, https://bluewhale.systems/\r\n\r\n\r\n### Additional context\r\n\r\n_I can literally recompile foundry 3 times over while u still be compiling, we are not the same (arch)_ ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1373819897",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4005#issuecomment-1373819897",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4005",
    "id": 1373819897,
    "node_id": "IC_kwDOGBlvNc5R4tP5",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-06T15:46:00Z",
    "updated_at": "2023-01-06T15:46:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Are the benchmarking suite still relevant @gakonst / @mattsse  as I have ran tests and trying to validate that this is unambiguously more peformant for runtime and compile time ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1373819897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
