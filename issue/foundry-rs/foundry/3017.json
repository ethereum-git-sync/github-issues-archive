{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/3017",
  "id": 1355618158,
  "node_id": "I_kwDOGBlvNc5QzRdu",
  "number": 3017,
  "title": "Anvil unexopecrtedly reverts where hardhat fork & real mainnet not",
  "user": {
    "login": "0xmikko",
    "id": 26343374,
    "node_id": "MDQ6VXNlcjI2MzQzMzc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/26343374?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xmikko",
    "html_url": "https://github.com/0xmikko",
    "followers_url": "https://api.github.com/users/0xmikko/followers",
    "following_url": "https://api.github.com/users/0xmikko/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xmikko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xmikko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xmikko/subscriptions",
    "organizations_url": "https://api.github.com/users/0xmikko/orgs",
    "repos_url": "https://api.github.com/users/0xmikko/repos",
    "events_url": "https://api.github.com/users/0xmikko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xmikko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 4077188949,
      "node_id": "LA_kwDOGBlvNc7zBPdV",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-anvil",
      "name": "C-anvil",
      "color": "5319E7",
      "default": false,
      "description": "Command: anvil"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2022-08-30T11:31:29Z",
  "updated_at": "2022-08-31T13:15:50Z",
  "closed_at": "2022-08-31T13:15:50Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [ ] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (307576d 2022-08-29T00:05:05.72678Z)\n\n### What command(s) is the bug in?\n\nanvil\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\nWe're testing Convex integration and found totally unexpected revert in the place, where mainnet and hardhat fork works without any reverts (and it's expected).\r\n\r\nHow to reproduce:\r\n```typescript=\r\nimport { ethers } from \"hardhat\";\r\nimport { waitForTransaction } from \"@gearbox-protocol/devops\";\r\nimport { SignerWithAddress } from \"@nomiclabs/hardhat-ethers/signers\";\r\nimport { BigNumber } from \"ethers\";\r\n\r\nimport {\r\n  contractsByNetwork,\r\n  IBaseRewardPool__factory,\r\n  IBooster__factory,\r\n  IERC20Metadata__factory,\r\n  IERC20__factory,\r\n  IUniswapV2Adapter__factory,\r\n  MAX_INT,\r\n  SupportedToken,\r\n  tokenDataByNetwork,\r\n  WAD,\r\n  ICurvePool3Assets__factory,\r\n} from \"@gearbox-protocol/sdk\";\r\n\r\ndescribe(\"Convex pool adapter test\", async function () {\r\n  this.timeout(0);\r\n\r\n  let deployer: SignerWithAddress;\r\n  let user: SignerWithAddress;\r\n\r\n  before(async () => {\r\n    const accounts = (await ethers.getSigners()) as Array<SignerWithAddress>;\r\n    deployer = accounts[0];\r\n    user = accounts[1];\r\n  });\r\n\r\n  it(`Anvil doesn't work properly`, async function () {\r\n    let booster = IBooster__factory.connect(\r\n      contractsByNetwork.Mainnet.CONVEX_BOOSTER,\r\n      user\r\n    );\r\n    let basePool = IBaseRewardPool__factory.connect(\r\n      contractsByNetwork.Mainnet.CONVEX_3CRV_POOL,\r\n      user\r\n    );\r\n\r\n    const curveLPToken = IERC20__factory.connect(\r\n      tokenDataByNetwork.Mainnet[\"3Crv\"],\r\n      deployer\r\n    );\r\n\r\n    const pid = await basePool.pid();\r\n\r\n    const depositToken = IERC20Metadata__factory.connect(\r\n      tokenDataByNetwork.Mainnet.DAI,\r\n      deployer\r\n    );\r\n\r\n    const addressPath = [\"WETH\", \"DAI\"].map(\r\n      (symbol) => tokenDataByNetwork.Mainnet[symbol as SupportedToken]\r\n    );\r\n\r\n    const uniswapV2 = IUniswapV2Adapter__factory.connect(\r\n      contractsByNetwork.Mainnet.UNISWAP_V2_ROUTER,\r\n      deployer\r\n    );\r\n\r\n    console.log(\"Converting ETH into DAI\");\r\n\r\n    await waitForTransaction(\r\n      uniswapV2.swapExactETHForTokens(\r\n        0,\r\n        addressPath,\r\n        deployer.address,\r\n        Math.floor(Date.now() / 1000) + 365 * 24 * 3600,\r\n        { value: WAD.mul(10) }\r\n      )\r\n    );\r\n\r\n    const amountToDeposit = await depositToken.balanceOf(deployer.address);\r\n\r\n    const curvePoolAddress = contractsByNetwork.Mainnet.CURVE_3CRV_POOL;\r\n\r\n    console.log(\"Approving curvePool for DAI\");\r\n\r\n    await waitForTransaction(depositToken.approve(curvePoolAddress, 0));\r\n    await waitForTransaction(\r\n      depositToken.approve(curvePoolAddress, amountToDeposit)\r\n    );\r\n\r\n    const curvePool = ICurvePool3Assets__factory.connect(\r\n      curvePoolAddress,\r\n      deployer\r\n    );\r\n\r\n    const amounts = [amountToDeposit, BigNumber.from(0), BigNumber.from(0)] as [\r\n      BigNumber,\r\n      BigNumber,\r\n      BigNumber\r\n    ];\r\n\r\n    console.log(\"Adding liquidity to curvePool\");\r\n\r\n    await waitForTransaction(curvePool.add_liquidity(amounts, 0));\r\n\r\n    const lpTokenBalance = await curveLPToken.balanceOf(deployer.address);\r\n\r\n    await waitForTransaction(\r\n      curveLPToken.transfer(user.address, lpTokenBalance)\r\n    );\r\n\r\n    console.log(\"Approving Convex  Booster for 3CRV\");\r\n\r\n    await waitForTransaction(\r\n      curveLPToken.connect(user).approve(booster.address, 0)\r\n    );\r\n\r\n    await waitForTransaction(\r\n      curveLPToken.connect(user).approve(booster.address, MAX_INT)\r\n    );\r\n\r\n    let curveLPBalance = await curveLPToken.balanceOf(user.address);\r\n\r\n    console.log(`1st call deposit: ${curveLPBalance.toString()}`);\r\n    await waitForTransaction(\r\n      booster.deposit(pid, curveLPBalance.div(2), false)\r\n    );\r\n\r\n    const delay = (ms: number) => new Promise((res) => setTimeout(res, ms));\r\n\r\n    curveLPBalance = await curveLPToken.balanceOf(user.address);\r\n    console.log(`2nd call deposit: ${curveLPBalance.toString()}`);\r\n    await waitForTransaction(\r\n      booster.deposit(pid, curveLPBalance.div(2), false)\r\n    );\r\n  });\r\n});\r\n\r\n```\r\n\r\nTo get all constants, please run `yarn add @gearbox-protocol/sdk` before running.\r\n\r\nHardhat fork (expected result:\r\n```\r\n  Convex pool adapter test\r\nConverting ETH into DAI\r\nApproving curvePool for DAI\r\nAdding liquidity to curvePool\r\nApproving Convex  Booster for 3CRV\r\n1st call deposit: 91498637493314219025402\r\n2nd call deposit: 45749318746657109512701\r\n    âœ” Anvil doesn't work properly (15165ms)\r\n\r\n\r\n  1 passing (15s)\r\n  ```\r\n  \r\n  Anvil result:\r\n  ```\r\n  Convex pool adapter test\r\nConverting ETH into DAI\r\nApproving curvePool for DAI\r\nAdding liquidity to curvePool\r\nApproving Convex  Booster for 3CRV\r\n1st call deposit: 15410112781933710237259\r\n2nd call deposit: 7705056390966855118630\r\n    1) Anvil doesn't work properly\r\n\r\n\r\n  0 passing (18s)\r\n  1 failing\r\n\r\n  1) Convex pool adapter test\r\n       Anvil doesn't work properly:\r\n     Error: transaction failed (transactionHash=\"0x7fcfbd0954941f8f6301371df68d73711dd7e11a2adef57613a994a901e7c4a7\", transaction={\"hash\":\"0x7fcfbd0954941f8f6301371df68d73711dd7e11a2adef57613a994a901e7c4a7\",\"type\":2,\"accessList\":[],\"blockHash\":\"0x09efce536ab5c676356161a49a7b4ff0e90e8ee8d4d47d0c9f5fd484ceb904cb\",\"blockNumber\":15440130,\"transactionIndex\":0,\"confirmations\":1,\"from\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"gasPrice\":{\"type\":\"BigNumber\",\"hex\":\"0x015cfbafcd\"},\"maxPriorityFeePerGas\":{\"type\":\"BigNumber\",\"hex\":\"0x59682f00\"},\"maxFeePerGas\":{\"type\":\"BigNumber\",\"hex\":\"0x014886af03\"},\"gasLimit\":{\"type\":\"BigNumber\",\"hex\":\"0x075833\"},\"to\":\"0xF403C135812408BFbE8713b5A23a04b3D48AAE31\",\"value\":{\"type\":\"BigNumber\",\"hex\":\"0x00\"},\"nonce\":39,\"data\":\"0x43a0d06600000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000d0d8919e39165a57930000000000000000000000000000000000000000000000000000000000000000\",\"r\":\"0x3649bcac42aa0cf0853de56fb73929b9d63d722ae0fbe80304f5cc547d77f954\",\"s\":\"0x415ea037ae548655620cb738696375f6d4a19d8770585575ddd429a1b843d3cc\",\"v\":1,\"creates\":null,\"chainId\":1337}, receipt={\"to\":\"0xF403C135812408BFbE8713b5A23a04b3D48AAE31\",\"from\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"contractAddress\":null,\"transactionIndex\":0,\"gasUsed\":{\"type\":\"BigNumber\",\"hex\":\"0x0729ef\"},\"logsBloom\":\"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\"blockHash\":\"0x09efce536ab5c676356161a49a7b4ff0e90e8ee8d4d47d0c9f5fd484ceb904cb\",\"transactionHash\":\"0x7fcfbd0954941f8f6301371df68d73711dd7e11a2adef57613a994a901e7c4a7\",\"logs\":[],\"blockNumber\":15440130,\"confirmations\":1,\"cumulativeGasUsed\":{\"type\":\"BigNumber\",\"hex\":\"0x0729ef\"},\"effectiveGasPrice\":{\"type\":\"BigNumber\",\"hex\":\"0x013d8d7cbd\"},\"status\":0,\"type\":0,\"byzantium\":true}, code=CALL_EXCEPTION, version=providers/5.4.3)\r\n      at Logger.makeError (node_modules/@ethersproject/providers/node_modules/@ethersproject/logger/src.ts/index.ts:213:28)\r\n      at Logger.throwError (node_modules/@ethersproject/providers/node_modules/@ethersproject/logger/src.ts/index.ts:225:20)\r\n      at EthersProviderWrapper.<anonymous> (node_modules/@ethersproject/providers/src.ts/base-provider.ts:1198:24)\r\n      at step (node_modules/@ethersproject/providers/lib/base-provider.js:48:23)\r\n      at Object.next (node_modules/@ethersproject/providers/lib/base-provider.js:29:53)\r\n      at fulfilled (node_modules/@ethersproject/providers/lib/base-provider.js:20:58)\r\n      at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n      ```\r\n  ",
  "closed_by": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231545368",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231545368",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231545368,
    "node_id": "IC_kwDOGBlvNc5JZ-QY",
    "user": {
      "login": "0xmikko",
      "id": 26343374,
      "node_id": "MDQ6VXNlcjI2MzQzMzc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26343374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xmikko",
      "html_url": "https://github.com/0xmikko",
      "followers_url": "https://api.github.com/users/0xmikko/followers",
      "following_url": "https://api.github.com/users/0xmikko/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xmikko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xmikko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xmikko/subscriptions",
      "organizations_url": "https://api.github.com/users/0xmikko/orgs",
      "repos_url": "https://api.github.com/users/0xmikko/repos",
      "events_url": "https://api.github.com/users/0xmikko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xmikko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T11:37:57Z",
    "updated_at": "2022-08-30T11:37:57Z",
    "author_association": "NONE",
    "body": "Anvil version if needed: anvil 0.1.0 (307576d 2022-08-29T00:05:05.645876Z)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231545368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231654069",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231654069",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231654069,
    "node_id": "IC_kwDOGBlvNc5JaYy1",
    "user": {
      "login": "DaniPopes",
      "id": 57450786,
      "node_id": "MDQ6VXNlcjU3NDUwNzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/57450786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DaniPopes",
      "html_url": "https://github.com/DaniPopes",
      "followers_url": "https://api.github.com/users/DaniPopes/followers",
      "following_url": "https://api.github.com/users/DaniPopes/following{/other_user}",
      "gists_url": "https://api.github.com/users/DaniPopes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DaniPopes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DaniPopes/subscriptions",
      "organizations_url": "https://api.github.com/users/DaniPopes/orgs",
      "repos_url": "https://api.github.com/users/DaniPopes/repos",
      "events_url": "https://api.github.com/users/DaniPopes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DaniPopes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T13:15:55Z",
    "updated_at": "2022-08-30T13:53:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Could reproduce this only after ecbd575 (#2920):\r\n![Untitled](https://user-images.githubusercontent.com/57450786/187453737-6d78a347-dcf2-44f1-942d-cdaf534fafcc.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231654069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231706893",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231706893",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231706893,
    "node_id": "IC_kwDOGBlvNc5JalsN",
    "user": {
      "login": "0xmikko",
      "id": 26343374,
      "node_id": "MDQ6VXNlcjI2MzQzMzc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26343374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xmikko",
      "html_url": "https://github.com/0xmikko",
      "followers_url": "https://api.github.com/users/0xmikko/followers",
      "following_url": "https://api.github.com/users/0xmikko/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xmikko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xmikko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xmikko/subscriptions",
      "organizations_url": "https://api.github.com/users/0xmikko/orgs",
      "repos_url": "https://api.github.com/users/0xmikko/repos",
      "events_url": "https://api.github.com/users/0xmikko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xmikko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T13:57:01Z",
    "updated_at": "2022-08-30T13:57:01Z",
    "author_association": "NONE",
    "body": "It seems, that our mainnet tests work correctly before, we detected the problem yesterday",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231706893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231717392",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231717392",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231717392,
    "node_id": "IC_kwDOGBlvNc5JaoQQ",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T14:05:13Z",
    "updated_at": "2022-08-30T14:05:13Z",
    "author_association": "MEMBER",
    "body": "I fail to debug this locally, because I struggle to make this work.\r\n\r\nhow do I run this?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231717392/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231731040",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231731040",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231731040,
    "node_id": "IC_kwDOGBlvNc5Jarlg",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T14:15:56Z",
    "updated_at": "2022-08-30T14:15:56Z",
    "author_association": "MEMBER",
    "body": "maybe related https://github.com/foundry-rs/foundry/pull/3018",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231731040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231744401",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231744401",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231744401,
    "node_id": "IC_kwDOGBlvNc5Jau2R",
    "user": {
      "login": "DaniPopes",
      "id": 57450786,
      "node_id": "MDQ6VXNlcjU3NDUwNzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/57450786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DaniPopes",
      "html_url": "https://github.com/DaniPopes",
      "followers_url": "https://api.github.com/users/DaniPopes/followers",
      "following_url": "https://api.github.com/users/DaniPopes/following{/other_user}",
      "gists_url": "https://api.github.com/users/DaniPopes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DaniPopes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DaniPopes/subscriptions",
      "organizations_url": "https://api.github.com/users/DaniPopes/orgs",
      "repos_url": "https://api.github.com/users/DaniPopes/repos",
      "events_url": "https://api.github.com/users/DaniPopes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DaniPopes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T14:25:43Z",
    "updated_at": "2022-08-30T14:25:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I fail to debug this locally, because I struggle to make this work.\r\n> \r\n> how do I run this?\r\n\r\nCreated a repo for this: https://github.com/DaniPopes/foundry-3017.git",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231744401/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231787142",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231787142",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231787142,
    "node_id": "IC_kwDOGBlvNc5Ja5SG",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T14:58:04Z",
    "updated_at": "2022-08-30T14:58:04Z",
    "author_association": "MEMBER",
    "body": "okay, can reproduce now\r\n\r\ntracked it down to ecbd575c2116d8a3aef679d964c3998a838961f7\r\n\r\nchecking changes now",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231787142/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231844386",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231844386",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231844386,
    "node_id": "IC_kwDOGBlvNc5JbHQi",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T15:43:28Z",
    "updated_at": "2022-08-30T15:43:28Z",
    "author_association": "MEMBER",
    "body": "this looks `timestamp` related,\r\n\r\n#2920 made sure the timestamp is always increasing. If I revert this, then it succeeds.\r\n\r\nunsure how the timestamp plays a role here with convex, crv\r\n\r\n@ngotchac mentioned that hardhat does not always increase, so perhaps we should revert this:\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/a265daa77de0e032e8c66506d0a71026078f83f1/anvil/src/eth/backend/time.rs#L119-L122 \r\n\r\n@ngotchac wdyt?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231844386/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231899899",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231899899",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231899899,
    "node_id": "IC_kwDOGBlvNc5JbUz7",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T16:31:03Z",
    "updated_at": "2022-08-30T16:32:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Okay so I looked a bit, and I think it's more of a gas estimate issue. If you set the gas limit manually to something like 1M it works.\r\n\r\nWhat I think happens is that actually Hardhat estimates gas by default (without block provided) on the pending block; whereas Foundry does so at the latest block. Spec-wise, the latest block is what all other implementations does. But I do see why it could be better to do it on pending block for tests. In any case, as we estimate on Foundry on latest, it uses the last block timestamp, whereas it executes at latest timestamp + 1. So the gas usage might differ when transacting with contracts that uses the block timestamp.\r\n\r\nOne solution on Foundry's side would be to estimate gas on Pending block if no argument is passed. Otherwise the users will have to use a safer margin when setting gas limit when sending txs. In this case, I think it's not that easy since it's all done under the hood by an SDK and not configurable :/",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231899899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231910716",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231910716",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231910716,
    "node_id": "IC_kwDOGBlvNc5JbXc8",
    "user": {
      "login": "0xmikko",
      "id": 26343374,
      "node_id": "MDQ6VXNlcjI2MzQzMzc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26343374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xmikko",
      "html_url": "https://github.com/0xmikko",
      "followers_url": "https://api.github.com/users/0xmikko/followers",
      "following_url": "https://api.github.com/users/0xmikko/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xmikko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xmikko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xmikko/subscriptions",
      "organizations_url": "https://api.github.com/users/0xmikko/orgs",
      "repos_url": "https://api.github.com/users/0xmikko/repos",
      "events_url": "https://api.github.com/users/0xmikko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xmikko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T16:41:40Z",
    "updated_at": "2022-08-30T16:41:40Z",
    "author_association": "NONE",
    "body": "It seems more business-logic related, sometimes I got `logs is null` error, and some transactions were mined",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231910716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231917573",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231917573",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231917573,
    "node_id": "IC_kwDOGBlvNc5JbZIF",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T16:48:36Z",
    "updated_at": "2022-08-30T16:48:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "> It seems more business-logic related, sometimes I got `logs is null` error, and some transactions were mined\r\n\r\nWhere is this check for logs done? Also, have you tried with manually setting the GasLimit field?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231917573/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231919166",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1231919166",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1231919166,
    "node_id": "IC_kwDOGBlvNc5JbZg-",
    "user": {
      "login": "0xmikko",
      "id": 26343374,
      "node_id": "MDQ6VXNlcjI2MzQzMzc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26343374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xmikko",
      "html_url": "https://github.com/0xmikko",
      "followers_url": "https://api.github.com/users/0xmikko/followers",
      "following_url": "https://api.github.com/users/0xmikko/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xmikko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xmikko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xmikko/subscriptions",
      "organizations_url": "https://api.github.com/users/0xmikko/orgs",
      "repos_url": "https://api.github.com/users/0xmikko/repos",
      "events_url": "https://api.github.com/users/0xmikko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xmikko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T16:50:14Z",
    "updated_at": "2022-08-30T16:50:14Z",
    "author_association": "NONE",
    "body": "logs message came from try-catch block in main screen, where at the same time I got `reverted without string` in anvil terminal window",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1231919166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1232354162",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3017#issuecomment-1232354162",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3017",
    "id": 1232354162,
    "node_id": "IC_kwDOGBlvNc5JdDty",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-31T01:47:46Z",
    "updated_at": "2022-08-31T01:47:46Z",
    "author_association": "MEMBER",
    "body": "> One solution on Foundry's side would be to estimate gas on Pending block if no argument is passed. \r\n\r\nPersonally OK with this as a bandaid solution",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1232354162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
