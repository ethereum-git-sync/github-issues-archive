{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6129",
  "id": 1964199197,
  "node_id": "I_kwDOGBlvNc51E00d",
  "number": 6129,
  "title": "forge test --gas-report not reporting certain contracts",
  "user": {
    "login": "0xth0mas",
    "id": 35287002,
    "node_id": "MDQ6VXNlcjM1Mjg3MDAy",
    "avatar_url": "https://avatars.githubusercontent.com/u/35287002?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xth0mas",
    "html_url": "https://github.com/0xth0mas",
    "followers_url": "https://api.github.com/users/0xth0mas/followers",
    "following_url": "https://api.github.com/users/0xth0mas/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xth0mas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xth0mas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xth0mas/subscriptions",
    "organizations_url": "https://api.github.com/users/0xth0mas/orgs",
    "repos_url": "https://api.github.com/users/0xth0mas/repos",
    "events_url": "https://api.github.com/users/0xth0mas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xth0mas/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-10-26T19:03:14Z",
  "updated_at": "2023-10-27T14:40:53Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (a839414 2023-10-26T09:23:09.940495000Z)\n\n### What command(s) is the bug in?\n\nforge test --gas-report\n\n### Operating System\n\nWindows\n\n### Describe the bug\n\nI am working on proof of concept custom bytecode contracts where all of the functions are stubbed out so that the contract can be compiled/verified on block explorers with a generated ABI but the runtime bytecode is assembled in the constructor based on constructor arguments.\r\n\r\nTests run successfully and report gas total gas consumption for the tests but when attempting to run the gas report there is no report generated for the contract.\r\n\r\nI created an example project using the default Counters contract that follows the same design pattern being applied to the proof of concept contracts that I am working on. In the example the default Counters contract runs tests and generates a gas report as expected however the BytecodeCounters contract will run tests and not generate a gas report.\r\n\r\nhttps://github.com/0xth0mas/foundry-bytecode-gas-report-example",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1781741869",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6129#issuecomment-1781741869",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129",
    "id": 1781741869,
    "node_id": "IC_kwDOGBlvNc5qMzkt",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-26T19:05:29Z",
    "updated_at": "2023-10-26T19:05:29Z",
    "author_association": "MEMBER",
    "body": "thanks for the repro will investigate",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1781741869/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1781932227",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6129#issuecomment-1781932227",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129",
    "id": 1781932227,
    "node_id": "IC_kwDOGBlvNc5qNiDD",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-26T21:40:28Z",
    "updated_at": "2023-10-26T21:40:28Z",
    "author_association": "COLLABORATOR",
    "body": "@mattsse fyi some related issues:\r\n- https://github.com/foundry-rs/foundry/issues/6019\r\n- https://github.com/foundry-rs/foundry/issues/2287",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1781932227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1782873024",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6129#issuecomment-1782873024",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129",
    "id": 1782873024,
    "node_id": "IC_kwDOGBlvNc5qRHvA",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T12:57:13Z",
    "updated_at": "2023-10-27T12:57:13Z",
    "author_association": "MEMBER",
    "body": "> I am working on proof of concept custom bytecode contracts where all of the functions are stubbed out so that the contract can be compiled/verified on block explorers with a generated ABI but the runtime bytecode is assembled in the constructor based on constructor arguments.\r\n\r\ncan you please explain what impact this has on the defined functions when used\r\n\r\nbecause I think if you do this then everything is inlined, right? so there's no actual call happening that we can track and decode",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1782873024/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1783006983",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6129#issuecomment-1783006983",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129",
    "id": 1783006983,
    "node_id": "IC_kwDOGBlvNc5qRocH",
    "user": {
      "login": "0xth0mas",
      "id": 35287002,
      "node_id": "MDQ6VXNlcjM1Mjg3MDAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35287002?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xth0mas",
      "html_url": "https://github.com/0xth0mas",
      "followers_url": "https://api.github.com/users/0xth0mas/followers",
      "following_url": "https://api.github.com/users/0xth0mas/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xth0mas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xth0mas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xth0mas/subscriptions",
      "organizations_url": "https://api.github.com/users/0xth0mas/orgs",
      "repos_url": "https://api.github.com/users/0xth0mas/repos",
      "events_url": "https://api.github.com/users/0xth0mas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xth0mas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T14:23:58Z",
    "updated_at": "2023-10-27T14:29:07Z",
    "author_association": "NONE",
    "body": "Using the counter example as a reference...\r\n![image](https://github.com/foundry-rs/foundry/assets/35287002/a5865c3e-8a75-4c61-a9bc-48587ca2a872)\r\n\r\nLines 8-10 store the bytecode that I wrote that implements number, setNumber and increment to memory.\r\nLine 11 returns the memory area that the bytecode is stored in, telling the EVM that that bytecode is going to be the runtime bytecode for the contract that it needs to save and execute on each call.\r\nLines 15-17 exist for the compiler to generate the same ABI as the regular counters example.\r\n\r\nThat makes the deployed bytecode this:\r\n59351559341117600D57601A565B5959FD5B6000526004601CFD5B593560E01C8063D09DE08A1460415780633FB5C1CB14604C5780638381F58A146055575959FD5B595460010159555959F35B60043559555959F35B59595459525990F3\r\n\r\nThe first portion 59351559341117600D57601A565B5959FD checks calldata and msg.value to ensure they are non-zero and zero respectively and reverts if either is not the case.\r\n\r\nNext 5B6000526004601CFD is a little revert snippet for custom reverts.\r\n\r\nThen the function selector...\r\n5B593560E01C -- get the selector\r\n8063D09DE08A14604157 -- jump if it's increment\r\n80633FB5C1CB14604C57 -- jump if it's setNumber\r\n80638381F58A14605557 -- jump if it's number\r\n5959FD -- revert if we didn't match selector\r\n\r\n5B595460010159555959F3 -- increment - load from storage, add one, store to storage, return nothing\r\n5B60043559555959F3 -- setNumber - load from calldata, store to storage, return nothing\r\n5B59595459525990F3 -- number - load from storage, store to memory, return 0x00,0x20\r\n\r\n\r\nAll calls should execute the deployed runtime bytecode in the VM the same as a call to a contract whose runtime bytecode was created by solc. This is like using a different compiler that wraps in Solidity to create the ABI, simplify integration with other contracts that are not hyper aggresively optimized, and make them verifiable on block explorers. The Solidity compiler will generate some deployment bytecode assuming that those functions are basically just empty returns but its intention of what the runtime bytecode will be in the deployment bytecode is overridden by the runtime bytecode returned from the constructor.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1783006983/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1783033719",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6129#issuecomment-1783033719",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6129",
    "id": 1783033719,
    "node_id": "IC_kwDOGBlvNc5qRu93",
    "user": {
      "login": "0xth0mas",
      "id": 35287002,
      "node_id": "MDQ6VXNlcjM1Mjg3MDAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35287002?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xth0mas",
      "html_url": "https://github.com/0xth0mas",
      "followers_url": "https://api.github.com/users/0xth0mas/followers",
      "following_url": "https://api.github.com/users/0xth0mas/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xth0mas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xth0mas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xth0mas/subscriptions",
      "organizations_url": "https://api.github.com/users/0xth0mas/orgs",
      "repos_url": "https://api.github.com/users/0xth0mas/repos",
      "events_url": "https://api.github.com/users/0xth0mas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xth0mas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T14:40:53Z",
    "updated_at": "2023-10-27T14:40:53Z",
    "author_association": "NONE",
    "body": "Here's a deployed example with the functions called -\r\nhttps://goerli.etherscan.io/address/0x69db6d03923b11d9c4391653b51526acb24c3ef4",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1783033719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
