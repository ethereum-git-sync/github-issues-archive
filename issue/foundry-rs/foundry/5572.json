{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5572",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5572/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5572/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5572/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5572",
  "id": 1843184092,
  "node_id": "I_kwDOGBlvNc5t3MHc",
  "number": 5572,
  "title": "Keystores exported from brownie could not be used",
  "user": {
    "login": "ChiTimesChi",
    "id": 88190723,
    "node_id": "MDQ6VXNlcjg4MTkwNzIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/88190723?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ChiTimesChi",
    "html_url": "https://github.com/ChiTimesChi",
    "followers_url": "https://api.github.com/users/ChiTimesChi/followers",
    "following_url": "https://api.github.com/users/ChiTimesChi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ChiTimesChi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ChiTimesChi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ChiTimesChi/subscriptions",
    "organizations_url": "https://api.github.com/users/ChiTimesChi/orgs",
    "repos_url": "https://api.github.com/users/ChiTimesChi/repos",
    "events_url": "https://api.github.com/users/ChiTimesChi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ChiTimesChi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-08-09T12:57:17Z",
  "updated_at": "2023-08-09T12:57:17Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (d4f626b 2023-08-09T00:21:28.739489228Z)\n\n### What command(s) is the bug in?\n\nforge create; forge script\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\n`forge script` as well as `forge create` doesn't seem to work with keystores exported/generated by brownie.\r\nThis is quite unfortunate, as there's no option to export a keystore using `cast wallet` and a custom private key, at least until https://github.com/foundry-rs/foundry/pull/5551 is implemented.\r\n\r\n## Generating a Brownie keystore\r\n\r\nFirst, import any private key into Brownie and export a keystore. We'll be using a known private key for this.\r\n1. `$ brownie accounts new ones`\r\n2. Type this not very secure private key: `1111111111111111111111111111111111111111111111111111111111111111`\r\n3. Type this not very secure password for encryption `ones`.\r\n4. You should see `SUCCESS: A new account '0x19E7E376E7C213B7E7e7e46cc70A5dD086DAff2A' has been generated with the id 'ones'`\r\n5. `$ brownie accounts export ones ./ones.json`\r\nThis should get you the keystore with the \"encrypted\" \"private\" key.\r\n\r\n_Pasting the resulting `ones.json` as is_\r\n```json\r\n{\"address\": \"19e7e376e7c213b7e7e7e46cc70a5dd086daff2a\", \"crypto\": {\"cipher\": \"aes-128-ctr\", \"cipherparams\": {\"iv\": \"e5b40cf278493c6f30bdf6f09c479665\"}, \"ciphertext\": \"1681df71af78f6b2a4b1f586af06572e7a45a8409284f1af225d53ccd0f9275c\", \"kdf\": \"scrypt\", \"kdfparams\": {\"dklen\": 32, \"n\": 262144, \"r\": 1, \"p\": 8, \"salt\": \"9f49ee3d090dd70f01de9562278b0971\"}, \"mac\": \"9e8eb87ebb16491a04f9aef9912c6145a024a22ea68ff7abdd92180a3e937ed2\"}, \"id\": \"3373aad8-f07c-48b5-b617-52d82f3154f5\", \"version\": 3}\r\n```\r\n\r\n## Deploying using brownie keystore\r\n\r\nNow, try using this keystore. Obviously, don't send any funds to this address, we're only interested in whether the keystore could be decrypted.\r\n\r\nClone any Foundry-based repo. I usually use minimalistic Multicall3 repo: https://github.com/mds1/multicall/\r\n\r\nTry deploying anything using this keystore:\r\n```console\r\nforge create -r https://eth.llamarpc.com --keystore ones.json --password ones Multicall3\r\n```\r\n```\r\nError: \r\nFailed to decrypt keystore \"ones.json\"\r\n\r\nContext:\r\n- scrypt InvalidParams\r\n```\r\n\r\n## Deploying using cast wallet keystore\r\n\r\nCompare this to using the keystore for a random address, generated by `cast wallet new .` This one is protected by not a secure password by any means `ripped`.\r\n\r\n_Pasting the resulting `ripped.json` as is_\r\n```json\r\n{\"crypto\":{\"cipher\":\"aes-128-ctr\",\"cipherparams\":{\"iv\":\"163575c56116453d4a297d3c1565ff66\"},\"ciphertext\":\"f6fce3db1fdb3b7a5dfebb83f768b4feba31b1cbf2f1540109dc379493c6309b\",\"kdf\":\"scrypt\",\"kdfparams\":{\"dklen\":32,\"n\":8192,\"p\":1,\"r\":8,\"salt\":\"c6b1b9504ec0b070ac97d56802de529de028b7f6dea67bfcb99c6c237c821584\"},\"mac\":\"a2121b79cb5dc1df9b72da32df97f6f488a780850fe45ea2c51bddd2ab4f0cc9\"},\"id\":\"f63c2ab2-0a5c-4daa-806b-9ec2a2388420\",\"version\":3}\r\n```\r\n\r\n```console\r\nforge create -r https://eth.llamarpc.com --keystore ripped.json --password ripped Multicall3\r\n```\r\nIn this case keystore is successfully decrypted:\r\n```\r\nError: \r\n(code: -32000, message: insufficient funds for gas * price + value: address 0xE65Bc689E5ef8205d710f7B5E2477Daa6F23c5E8 have 0 want 29039692383000000000, data: None)\r\n```\r\n\r\n## Deploying using brownie keystore with address field removed\r\n\r\nYou may have noticed that brownie keystore json file has as extra address field, but the error remains even if you rip it out.\r\n```console\r\njq 'del(.address)' ones.json > onesCleared.json\r\n```\r\n_Pasting the resulting `onesCleared.json` as is_\r\n```json\r\n{\r\n  \"crypto\": {\r\n    \"cipher\": \"aes-128-ctr\",\r\n    \"cipherparams\": {\r\n      \"iv\": \"e5b40cf278493c6f30bdf6f09c479665\"\r\n    },\r\n    \"ciphertext\": \"1681df71af78f6b2a4b1f586af06572e7a45a8409284f1af225d53ccd0f9275c\",\r\n    \"kdf\": \"scrypt\",\r\n    \"kdfparams\": {\r\n      \"dklen\": 32,\r\n      \"n\": 262144,\r\n      \"r\": 1,\r\n      \"p\": 8,\r\n      \"salt\": \"9f49ee3d090dd70f01de9562278b0971\"\r\n    },\r\n    \"mac\": \"9e8eb87ebb16491a04f9aef9912c6145a024a22ea68ff7abdd92180a3e937ed2\"\r\n  },\r\n  \"id\": \"3373aad8-f07c-48b5-b617-52d82f3154f5\",\r\n  \"version\": 3\r\n}\r\n```\r\n\r\n```console\r\nforge create -r https://eth.llamarpc.com --keystore onesCleared.json --password ones Multicall3\r\n```\r\nThe very same error happens\r\n```\r\nError: \r\nFailed to decrypt keystore \"onesCleared.json\"\r\n\r\nContext:\r\n- scrypt InvalidParams\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5572/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5572/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
