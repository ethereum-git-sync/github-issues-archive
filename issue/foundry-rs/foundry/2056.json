{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2056",
  "id": 1278689557,
  "node_id": "I_kwDOGBlvNc5MN0EV",
  "number": 2056,
  "title": "feat: expand snapshot functionality",
  "user": {
    "login": "mds1",
    "id": 17163988,
    "node_id": "MDQ6VXNlcjE3MTYzOTg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mds1",
    "html_url": "https://github.com/mds1",
    "followers_url": "https://api.github.com/users/mds1/followers",
    "following_url": "https://api.github.com/users/mds1/following{/other_user}",
    "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
    "organizations_url": "https://api.github.com/users/mds1/orgs",
    "repos_url": "https://api.github.com/users/mds1/repos",
    "events_url": "https://api.github.com/users/mds1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mds1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3759773804,
      "node_id": "LA_kwDOGBlvNc7gGZhs",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-gas-snapshots",
      "name": "A-gas-snapshots",
      "color": "FBCA04",
      "default": false,
      "description": "Area: gas snapshotting/reporting"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-06-21T16:23:41Z",
  "updated_at": "2023-05-18T16:16:48Z",
  "closed_at": null,
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Describe the feature you would like\r\n\r\n_Inspired by [this](https://twitter.com/msolomon44/status/1539266598594174978) twitter convo_ \r\n\r\n### Feature Spec\r\n\r\nRight now `forge snapshot` saves the gas usage of each test to a file called `.gas-snapshot`. This is useful for things like gas golfing, or ensuring that a changeset does not increase gas costs. Similar functionality can be applied to other properties of a codebase.\r\n\r\nI propose modifying `forge snapshot` as follows:\r\n\r\nInstead of being a single command, it now has subcommands to snapshot various things:\r\n- `forge snapshot gas` behaves like `forge snapshot` currently does.\r\n- `forge snapshot size` is equivalent to running `forge build --sizes` and saving the output table.\r\n- `forge snapshot <fieldName>` would let you snapshot any solc field name supported by `forge inspect`. By default this would snapshot the field for all contracts in the `src` directory\r\n\r\nInstead of saving to the project root, these commands save a file called `<property>.snapshot` to a folder named something like `snapshot`, `snap`, or `ss`. Examples:\r\n- `forge snapshot gas` results in `snapshot/gas.snapshot`\r\n- `forge snapshot storage-layout` results in `snapshot/storage-layout.snapshot`\r\n\r\nThe `--check`, `--diff`, and `--snap` options should be supported for each subcommand and behave the same as they do now. Some subcommands may have additional options, such as:\r\n- `--include-fuzz-tests` for gas snapshots, or always including fuzz tests and just specifying the seed here\r\n- `--asc` and `--desc` should be supported for ones where sorting makes sense, such as gas and size snapshots.\r\n\r\n### Open questions\r\n1.  Are we ok with implementing this breaking change to snapshot behavior without waiting for a specific breaking change foundry release? Let's get thoughts from snapshot users, but IMO this is useful enough and a small enough breaking change that we should be ok with it.\r\n2. `forge inspect` supports multiple variants for a given property. For example, you can [see](https://book.getfoundry.sh/reference/forge/forge-inspect.html#forge-inspect) that `forge inspect MyContract storage`, `forge inspect MyContract storageLayout`, `forge inspect MyContract storage-layout`, and `forge inspect MyContract storage_layout` all print the storage layout. We'd want to standardize on which name we use for the output files. My suggestion is using the JSON field name output by solc, which for this example I believe is `storage`.\r\n\r\n### Additional context\r\n\r\n_No response_",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1161999563",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2056#issuecomment-1161999563",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056",
    "id": 1161999563,
    "node_id": "IC_kwDOGBlvNc5FQrTL",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-21T16:41:47Z",
    "updated_at": "2022-06-21T16:46:32Z",
    "author_association": "MEMBER",
    "body": "Ref #137 #1795 \r\n\r\nAlso might complicate https://github.com/foundry-rs/foundry/issues/1980 because of command arg flattening, see https://github.com/foundry-rs/foundry/issues/1980#issuecomment-1160987510\r\n\r\nEdit: Another consideration is that snapshot files are nameable right now, so it's possible to have e.g. a `.fuzz-snapshot` and a `.unit-snapshot` that you diff/check separately and we should probably preserve that behavior\r\n\r\nOne final consideration is that there's been some talk of merging snapshot/gas report but I can't find the convo\r\n\r\nEdit 2: Given all above points an alternative suggestion (no strong preference, just wanted to add context to the issue):\r\n\r\n- `forge snapshot`/gas report merge. Gas reports already support writing to files, so tweaking the layout and adding diff/check should be sufficient to become up to date. For a while `forge snapshot` could be an alias of gas reporting so we don't have breaking changes\r\n- Introduce diff/check/save to file behavior for `forge inspect` to fill 2nd use case",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1161999563/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1162153943",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2056#issuecomment-1162153943",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056",
    "id": 1162153943,
    "node_id": "IC_kwDOGBlvNc5FRQ_X",
    "user": {
      "login": "maurelian",
      "id": 23033765,
      "node_id": "MDQ6VXNlcjIzMDMzNzY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maurelian",
      "html_url": "https://github.com/maurelian",
      "followers_url": "https://api.github.com/users/maurelian/followers",
      "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
      "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
      "organizations_url": "https://api.github.com/users/maurelian/orgs",
      "repos_url": "https://api.github.com/users/maurelian/repos",
      "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maurelian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-21T18:23:40Z",
    "updated_at": "2022-06-21T18:23:40Z",
    "author_association": "NONE",
    "body": "Only comment is that we'd definitely love to see this given I was [speccing](https://github.com/ethereum-optimism/optimism/pull/2810#issuecomment-1162018672) out a similar script for ourselves around the time this issue was created. For now I will likely follow the [approach](https://github.com/nomad-xyz/monorepo/pull/344/files#diff-720f0d51666dbb1ee24061d5b74c8f5177105d4291135151b73f9c429c69c28e) used by nomad.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1162153943/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1553295302",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2056#issuecomment-1553295302",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2056",
    "id": 1553295302,
    "node_id": "IC_kwDOGBlvNc5clWfG",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-18T16:16:48Z",
    "updated_at": "2023-05-18T16:16:48Z",
    "author_association": "COLLABORATOR",
    "body": "Some other ideas for gas snapshots specifically can be found in https://github.com/foundry-rs/foundry/issues/137",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1553295302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
