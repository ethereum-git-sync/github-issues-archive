{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/3797",
  "id": 1470000266,
  "node_id": "I_kwDOGBlvNc5XnmyK",
  "number": 3797,
  "title": "vm.recordLogs does not work with vm.transact",
  "user": {
    "login": "jameswenzel",
    "id": 6371847,
    "node_id": "MDQ6VXNlcjYzNzE4NDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6371847?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jameswenzel",
    "html_url": "https://github.com/jameswenzel",
    "followers_url": "https://api.github.com/users/jameswenzel/followers",
    "following_url": "https://api.github.com/users/jameswenzel/following{/other_user}",
    "gists_url": "https://api.github.com/users/jameswenzel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jameswenzel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jameswenzel/subscriptions",
    "organizations_url": "https://api.github.com/users/jameswenzel/orgs",
    "repos_url": "https://api.github.com/users/jameswenzel/repos",
    "events_url": "https://api.github.com/users/jameswenzel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jameswenzel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3703752960,
      "node_id": "LA_kwDOGBlvNc7cwskA",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-cheatcodes",
      "name": "A-cheatcodes",
      "color": "FBCA04",
      "default": false,
      "description": "Area: cheatcodes"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-30T17:38:16Z",
  "updated_at": "2022-12-28T11:02:57Z",
  "closed_at": "2022-12-28T11:02:57Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [x] Foundry\n- [x] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (6174975 2022-11-30T00:15:57.020771Z)\n\n### What command(s) is the bug in?\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### Describe the bug\n\nThis might be more of a feature request than a bug, since I'm not sure how `vm.transact` is implemented under-the-hood. \r\n\r\nSince the premise of `vm.transact` is to replay a transaction onto the fork, I'd expect it to have the same effects as a normal Foundry call - but it seems that ultimately only chain state is updated, without any logs (perhaps even external calls?) being registered by the VM. \r\n\r\nHere is a failing example test, which forks block `16071016`, and replays a transaction from the following block, `16071017`, and [produced 4 logs](https://etherscan.io/tx/0x431173a87438556bfdc0aa3441cdeb006bc238a3cbed351afd75aab9a4962435#eventlog)\r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\nimport {Test, Vm} from \"forge-std/Test.sol\";\r\n\r\ncontract TransactionTest is Test {\r\n    function testTransactionLogs() public {\r\n        vm.createSelectFork(stdChains[\"mainnet\"].rpcUrl, 16071016);\r\n        vm.recordLogs();\r\n        vm.transact(0x431173a87438556bfdc0aa3441cdeb006bc238a3cbed351afd75aab9a4962435);\r\n        Vm.Log[] memory logs = vm.getRecordedLogs();\r\n        assertEq(logs.length, 4, \"Did not record the correct number of logs\");\r\n    }\r\n}\r\n```\r\n\r\nI suspect this may be because it's easier to just update only the state from a transaction's side-effects than it is to replay the entire transaction, which might be dependent on previous transactions.\r\n\r\nRegardless, it would be very useful if Forge scripts could capture and export the logs of a specific transaction.  I know similar functionality was being explored for cast in #2542 - it would be great to have them accessible in a configurable Forge script that can then export them. \r\n",
  "closed_by": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1332603022",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3797#issuecomment-1332603022",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797",
    "id": 1332603022,
    "node_id": "IC_kwDOGBlvNc5PbeiO",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-30T19:00:39Z",
    "updated_at": "2022-11-30T19:00:39Z",
    "author_association": "MEMBER",
    "body": "ah I think I know what's happening here.\r\n\r\nthe logs emitted during `vm.transact` are probably not added to the test's log storage.\r\n\r\nshould be an easy fix.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1332603022/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364722042",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3797#issuecomment-1364722042",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3797",
    "id": 1364722042,
    "node_id": "IC_kwDOGBlvNc5RWAF6",
    "user": {
      "login": "AdithyaNarayan",
      "id": 20930155,
      "node_id": "MDQ6VXNlcjIwOTMwMTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/20930155?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AdithyaNarayan",
      "html_url": "https://github.com/AdithyaNarayan",
      "followers_url": "https://api.github.com/users/AdithyaNarayan/followers",
      "following_url": "https://api.github.com/users/AdithyaNarayan/following{/other_user}",
      "gists_url": "https://api.github.com/users/AdithyaNarayan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AdithyaNarayan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AdithyaNarayan/subscriptions",
      "organizations_url": "https://api.github.com/users/AdithyaNarayan/orgs",
      "repos_url": "https://api.github.com/users/AdithyaNarayan/repos",
      "events_url": "https://api.github.com/users/AdithyaNarayan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AdithyaNarayan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-25T18:27:45Z",
    "updated_at": "2022-12-25T18:27:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "this one up for grabs? i'd like to shoot my shot",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364722042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
