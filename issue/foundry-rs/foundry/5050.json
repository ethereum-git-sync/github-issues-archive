{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5050",
  "id": 1726993552,
  "node_id": "I_kwDOGBlvNc5m79SQ",
  "number": 5050,
  "title": "Non-deterministic behavior with `auto_detect_solc`",
  "user": {
    "login": "fubhy",
    "id": 1172528,
    "node_id": "MDQ6VXNlcjExNzI1Mjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1172528?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fubhy",
    "html_url": "https://github.com/fubhy",
    "followers_url": "https://api.github.com/users/fubhy/followers",
    "following_url": "https://api.github.com/users/fubhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/fubhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fubhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fubhy/subscriptions",
    "organizations_url": "https://api.github.com/users/fubhy/orgs",
    "repos_url": "https://api.github.com/users/fubhy/repos",
    "events_url": "https://api.github.com/users/fubhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fubhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-05-26T06:36:57Z",
  "updated_at": "2023-05-26T12:22:44Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (33f3fee 2023-05-26T00:03:48.457406188Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge build\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\nNOTE: I also opened a feature request related to this: https://github.com/foundry-rs/foundry/issues/5049\r\n\r\nI'm currently debugging an issue where auto_detect_solc behaves somewhat non-deterministically and chooses different solc versions between CI and local runs. Locally, it uses 0.8.17 and in CI it uses 0.8.20 for some files.\r\n\r\nThe underlying issue seems to be that if it finds a file that has a version range that is supported by any installed solc version it will use that pre-installed solc version instead of downloading the highest available version. So depending on the environment it is run in, if there's already solc 0.8.17 available (which is the case locally), it will use that. But if that's not available (e.g. in CI where it installs those on every run), it will download the highest match (0.8.20) and then use that.\r\n\r\nEDIT: This also seems to be affected by caches.\r\n\r\nGiven the non-deterministic / environment-dependent behavior of this I'd categorize that as a bug.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564025568",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564025568",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564025568,
    "node_id": "IC_kwDOGBlvNc5dOSLg",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T08:43:07Z",
    "updated_at": "2023-05-26T08:43:07Z",
    "author_association": "MEMBER",
    "body": "> somewhat non-deterministically and chooses different solc versions between CI and local runs.\r\n\r\nsince this happens in CI I assume you have already compatible versions installed locally\r\n\r\nref: https://github.com/gakonst/ethers-rs/blob/master/ethers-solc/src/resolver/mod.rs#L17",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564025568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564035597",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564035597",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564035597,
    "node_id": "IC_kwDOGBlvNc5dOUoN",
    "user": {
      "login": "fubhy",
      "id": 1172528,
      "node_id": "MDQ6VXNlcjExNzI1Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1172528?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubhy",
      "html_url": "https://github.com/fubhy",
      "followers_url": "https://api.github.com/users/fubhy/followers",
      "following_url": "https://api.github.com/users/fubhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubhy/subscriptions",
      "organizations_url": "https://api.github.com/users/fubhy/orgs",
      "repos_url": "https://api.github.com/users/fubhy/repos",
      "events_url": "https://api.github.com/users/fubhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T08:49:28Z",
    "updated_at": "2023-05-26T08:49:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > somewhat non-deterministically and chooses different solc versions between CI and local runs.\r\n> \r\n> since this happens in CI I assume you have already compatible versions installed locally\r\n> \r\n> ref: https://github.com/gakonst/ethers-rs/blob/master/ethers-solc/src/resolver/mod.rs#L17\r\n\r\nAh, yes. That's where this feature requests would then come in imho: https://github.com/foundry-rs/foundry/issues/5049\r\n\r\nThat wouldn't solve all edge cases but probably most of them (e.g. if there are still multiple possible versions within the configured range it wouldn't solve it but that's probably less likely).",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564035597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564042481",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564042481",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564042481,
    "node_id": "IC_kwDOGBlvNc5dOWTx",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T08:52:24Z",
    "updated_at": "2023-05-26T08:52:24Z",
    "author_association": "MEMBER",
    "body": "I guess this is a reasonable request and could be solved by changed it to a set of solc versions.\r\n\r\nsupportive",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564042481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564058276",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564058276",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564058276,
    "node_id": "IC_kwDOGBlvNc5dOaKk",
    "user": {
      "login": "fubhy",
      "id": 1172528,
      "node_id": "MDQ6VXNlcjExNzI1Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1172528?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubhy",
      "html_url": "https://github.com/fubhy",
      "followers_url": "https://api.github.com/users/fubhy/followers",
      "following_url": "https://api.github.com/users/fubhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubhy/subscriptions",
      "organizations_url": "https://api.github.com/users/fubhy/orgs",
      "repos_url": "https://api.github.com/users/fubhy/repos",
      "events_url": "https://api.github.com/users/fubhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T09:01:57Z",
    "updated_at": "2023-05-26T09:02:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I guess this is a reasonable request and could be solved by changed it to a set of solc versions.\r\n> \r\n> supportive\r\n\r\nWould you implement it by \r\n\r\na) turning `solc_version` into a set (optionally) and changing it's behavior to work \"together\" with `auto_detect_solc`. Such that: \r\nif it's a set, `auto_detect_solc` is enabled, if it's a single value it's disabled and that single version is enforced\r\n\r\nor b) add a new option `auto_detect_solc_versions`? \r\n\r\nHappy to work on this and submit a PR. My preference would be a) if that can be implemented without causing any breaking changes.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564058276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564168900",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564168900",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564168900,
    "node_id": "IC_kwDOGBlvNc5dO1LE",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T10:22:03Z",
    "updated_at": "2023-05-26T10:22:03Z",
    "author_association": "MEMBER",
    "body": "> turning solc_version into a set (optionally)\r\n\r\nthere's a distinction between a pinned version and a range, pinning a version makes finding a compatible version obsolete.\r\nwhereas a range would limit the possible options.\r\n\r\nI'm not entirely sure how to implement this, the relevant code is here:\r\n\r\nhttps://github.com/gakonst/ethers-rs/blob/6708c1fc0c43eb81ec6ade10cbb0a980e67ecdf6/ethers-solc/src/compile/project.rs#L156-L157\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564168900/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564182740",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564182740",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564182740,
    "node_id": "IC_kwDOGBlvNc5dO4jU",
    "user": {
      "login": "fubhy",
      "id": 1172528,
      "node_id": "MDQ6VXNlcjExNzI1Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1172528?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubhy",
      "html_url": "https://github.com/fubhy",
      "followers_url": "https://api.github.com/users/fubhy/followers",
      "following_url": "https://api.github.com/users/fubhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubhy/subscriptions",
      "organizations_url": "https://api.github.com/users/fubhy/orgs",
      "repos_url": "https://api.github.com/users/fubhy/repos",
      "events_url": "https://api.github.com/users/fubhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T10:33:39Z",
    "updated_at": "2023-05-26T10:33:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Gotcha. So I guess we'd want a third `with_sources_and_solc_range` path in `ethers-solc` first?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564182740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564312021",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5050#issuecomment-1564312021",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5050",
    "id": 1564312021,
    "node_id": "IC_kwDOGBlvNc5dPYHV",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T12:22:43Z",
    "updated_at": "2023-05-26T12:22:43Z",
    "author_association": "MEMBER",
    "body": "yeah, which provides a HashSet of allowed versions, I think that should work",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1564312021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
