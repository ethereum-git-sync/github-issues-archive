{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/3942",
  "id": 1508722019,
  "node_id": "I_kwDOGBlvNc5Z7UVj",
  "number": 3942,
  "title": "Foundryup failure due to  GitHub API rate limiting",
  "user": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-12-23T00:46:35Z",
  "updated_at": "2022-12-25T12:05:31Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Getting intermittent failures from foundryup in `slither-action` as seen [here](https://github.com/OpenZeppelin/openzeppelin-contracts/actions/runs/3762093956/jobs/6394460979#logs). The error doesn't seem abort the script and foundryup reports that it finished installing.\r\n\r\n```\r\n[-] Foundry target detected, installing foundry nightly\r\ncurl: (22) The requested URL returned error: 403 \r\nfoundryup: installing foundry (version nightly, tag nightly-)\r\nfoundryup: downloading latest forge and cast\r\n\r\n######################################################################## 100.0%\r\n\r\ngzip: stdin: not in gzip format\r\ntar: Child returned status 1\r\ntar: Error is not recoverable: exiting now\r\nfoundryup: downloading manpages\r\n\r\n######################################################################## 100.0%\r\n\r\ngzip: stdin: not in gzip format\r\ntar: Child returned status 1\r\ntar: Error is not recoverable: exiting now\r\nfoundryup: line 128: /opt/foundry/bin/forge: No such file or directory\r\nfoundryup: installed - \r\nfoundryup: line 129: /opt/foundry/bin/cast: No such file or directory\r\nfoundryup: installed - \r\nfoundryup: done\r\n```\r\n\r\nIn the first two lines we see curl returns 403 status and the next line shows `nightly-`.\r\n\r\n```\r\ncurl: (22) The requested URL returned error: 403 \r\nfoundryup: installing foundry (version nightly, tag nightly-)\r\n```\r\n\r\nWhat seems to be failing is this request:\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/f10df79e8d3a5e02eeac9bd0c4a4297d3d96bbae/foundryup/foundryup#L79-L84\r\n\r\nUnauthenticated requests to the GitHub API are heavily [rate limited](https://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#rate-limiting):\r\n\r\n> For unauthenticated requests, the rate limit allows for up to 60 requests per hour. Unauthenticated requests are associated with the originating IP address, and not the person making requests.\r\n\r\nThis seems to make `foundryup` not well suited for CI environments in its current form. Perhaps it should use the `nightly` tag without a commit hash?\r\n\r\nConsider using `set -o pipefail` in addition to `set -e`. I think this is why the error doesn't abort the script.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1363825549",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3942#issuecomment-1363825549",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942",
    "id": 1363825549,
    "node_id": "IC_kwDOGBlvNc5RSlON",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-23T10:27:57Z",
    "updated_at": "2022-12-23T10:27:57Z",
    "author_association": "MEMBER",
    "body": "my bashscript skills are pretty limited, but we def should handle this.\r\n\r\nhttps://gist.github.com/mohanpedala/1e2ff5661761d3abd0385e8223e16425#set--o-pipefail\r\n\r\nfrom what I understand adding `set -o pipefail` would be useful.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1363825549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364040616",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3942#issuecomment-1364040616",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942",
    "id": 1364040616,
    "node_id": "IC_kwDOGBlvNc5RTZuo",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-23T15:22:57Z",
    "updated_at": "2022-12-23T15:22:57Z",
    "author_association": "NONE",
    "body": "Yeah that should make the script at least catch this failure.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364040616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364041893",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3942#issuecomment-1364041893",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942",
    "id": 1364041893,
    "node_id": "IC_kwDOGBlvNc5RTaCl",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-23T15:24:36Z",
    "updated_at": "2022-12-23T15:24:36Z",
    "author_association": "NONE",
    "body": "Hm, it seems like `ensure` should be doing that but it doesn't seem to be working as intended.\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/b78509fb8e11b7f58a0021cd900b7c7a2d3be503/foundryup/foundryup#L239-L244",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364041893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364668492",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3942#issuecomment-1364668492",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942",
    "id": 1364668492,
    "node_id": "IC_kwDOGBlvNc5RVzBM",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-25T11:48:31Z",
    "updated_at": "2022-12-25T11:48:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "i tried to fix this but was closed https://github.com/foundry-rs/foundry/pull/2221 \r\n\r\nI actually have the fix here: https://github.com/foundry-rs/foundry/pull/3907/files#diff-79a844de4d6869f243ecd1e7ca4d9532d9a4987f85ca63d9f4af85aa227ecb38R22-R32",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364668492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364671003",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3942#issuecomment-1364671003",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3942",
    "id": 1364671003,
    "node_id": "IC_kwDOGBlvNc5RVzob",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-25T12:05:31Z",
    "updated_at": "2022-12-25T12:05:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Getting intermittent failures from foundryup in `slither-action` as seen [here](https://github.com/OpenZeppelin/openzeppelin-contracts/actions/runs/3762093956/jobs/6394460979#logs). The error doesn't seem abort the script and foundryup reports that it finished installing.\r\n> \r\n> ```\r\n> [-] Foundry target detected, installing foundry nightly\r\n> curl: (22) The requested URL returned error: 403 \r\n> foundryup: installing foundry (version nightly, tag nightly-)\r\n> foundryup: downloading latest forge and cast\r\n> \r\n> ######################################################################## 100.0%\r\n> \r\n> gzip: stdin: not in gzip format\r\n> tar: Child returned status 1\r\n> tar: Error is not recoverable: exiting now\r\n> foundryup: downloading manpages\r\n> \r\n> ######################################################################## 100.0%\r\n> \r\n> gzip: stdin: not in gzip format\r\n> tar: Child returned status 1\r\n> tar: Error is not recoverable: exiting now\r\n> foundryup: line 128: /opt/foundry/bin/forge: No such file or directory\r\n> foundryup: installed - \r\n> foundryup: line 129: /opt/foundry/bin/cast: No such file or directory\r\n> foundryup: installed - \r\n> foundryup: done\r\n> ```\r\n> \r\n> In the first two lines we see curl returns 403 status and the next line shows `nightly-`.\r\n> \r\n> ```\r\n> curl: (22) The requested URL returned error: 403 \r\n> foundryup: installing foundry (version nightly, tag nightly-)\r\n> ```\r\n> \r\n> What seems to be failing is this request:\r\n> \r\n> https://github.com/foundry-rs/foundry/blob/f10df79e8d3a5e02eeac9bd0c4a4297d3d96bbae/foundryup/foundryup#L79-L84\r\n> \r\n> Unauthenticated requests to the GitHub API are heavily [rate limited](https://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#rate-limiting):\r\n> \r\n> > For unauthenticated requests, the rate limit allows for up to 60 requests per hour. Unauthenticated requests are associated with the originating IP address, and not the person making requests.\r\n> \r\n> This seems to make `foundryup` not well suited for CI environments in its current form. Perhaps it should use the `nightly` tag without a commit hash?\r\n> \r\n> Consider using `set -o pipefail` in addition to `set -e`. I think this is why the error doesn't abort the script.\r\n\r\nThe real issue is that GitHub has no direct way to directly link to the latest build from GitHub actions of a given repository.\r\n\r\nEven if you do have a link to an artifact, using it requires the visitor to be logged into the GitHub website.[^1]\r\n\r\n[^1]: see https://github.com/actions/upload-artifact/issues/51\r\n\r\n\r\n> Because GitHub doesn't provide any permanent and public links to an artifact (this being the 'latest'), you should use a > service redirect to time-limited links that GitHub can give to the application -- only on behalf of an authenticated user that has access to the repository. So, whenever someone downloads an artifact from a repository that you had added, it would use a service token that is associated with your installation of the GitHub App. -- https://nightly.link/\r\n\r\nAlso, these are pre-releases so a service like https://nightly.link/ wont actually work \r\n\r\nHere is a script we use to download the latest releases in json file, https://github.com/sambacha/foundry-release/blob/master/get-release.sh\r\n\r\njust parse that to get your download link ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1364671003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
