{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2809",
  "id": 1341317079,
  "node_id": "I_kwDOGBlvNc5P8t_X",
  "number": 2809,
  "title": "forge verify-contract returns invalid API Key despite forge script --verify working fine",
  "user": {
    "login": "jordaniza",
    "id": 45881807,
    "node_id": "MDQ6VXNlcjQ1ODgxODA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/45881807?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jordaniza",
    "html_url": "https://github.com/jordaniza",
    "followers_url": "https://api.github.com/users/jordaniza/followers",
    "following_url": "https://api.github.com/users/jordaniza/following{/other_user}",
    "gists_url": "https://api.github.com/users/jordaniza/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jordaniza/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jordaniza/subscriptions",
    "organizations_url": "https://api.github.com/users/jordaniza/orgs",
    "repos_url": "https://api.github.com/users/jordaniza/repos",
    "events_url": "https://api.github.com/users/jordaniza/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jordaniza/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3854218343,
      "node_id": "LA_kwDOGBlvNc7lurRn",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-verify",
      "name": "Cmd-forge-verify",
      "color": "006B75",
      "default": false,
      "description": "Command: forge verify-contract"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-08-17T07:36:36Z",
  "updated_at": "2022-09-19T13:27:12Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (ccb9aa5 2022-08-17T00:03:47.513943128Z)\n\n### What command(s) is the bug in?\n\nforge verify-contract\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nI've mentioned a couple of other, smaller issues with the foundry verification process. This one is a bit more frustrating.\r\n\r\nIn general, I've found that adding `--verify` to my foundry scripts is an awesome way to keep my contracts verified with little effort. I also have a handy `--resume` flag to attempt re-verifications if network conditions are poor.\r\n\r\n`forge-verify` however, I have had extremely mixed results. I am able to deploy, then subsequently verify, very simple contracts (ones without imports or libraries), but then real-world contracts frequently fail. \r\n\r\nSpecifically, verification is accepted, but `verify-check` returns a NOTOK status with `Invalid API Key`. \r\n\r\nThis behaviour has been replicated on several testnets:\r\n\r\nArbitrum Rinkeby\r\nOptiism Kovan\r\nFantom Testnet\r\nPolygon Mumbai\r\nAvalance Fuji\r\n\r\nThe combination of `--verify` working in forge script, but `verify-contract` often not working (but working for less complex contracts) leads me to believe this is a challenge within foundry.\r\n\r\nI am happy to provide more details and, privately, share some of the contracts with the team to investigate if needed. ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1217918160",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2809#issuecomment-1217918160",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
    "id": 1217918160,
    "node_id": "IC_kwDOGBlvNc5Il_TQ",
    "user": {
      "login": "rkrasiuk",
      "id": 25429261,
      "node_id": "MDQ6VXNlcjI1NDI5MjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25429261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkrasiuk",
      "html_url": "https://github.com/rkrasiuk",
      "followers_url": "https://api.github.com/users/rkrasiuk/followers",
      "following_url": "https://api.github.com/users/rkrasiuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkrasiuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkrasiuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkrasiuk/subscriptions",
      "organizations_url": "https://api.github.com/users/rkrasiuk/orgs",
      "repos_url": "https://api.github.com/users/rkrasiuk/repos",
      "events_url": "https://api.github.com/users/rkrasiuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkrasiuk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-17T12:02:18Z",
    "updated_at": "2022-08-17T12:02:29Z",
    "author_association": "COLLABORATOR",
    "body": "@jordaniza would appreciate the invite to sample repo",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1217918160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1217958586",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2809#issuecomment-1217958586",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
    "id": 1217958586,
    "node_id": "IC_kwDOGBlvNc5ImJK6",
    "user": {
      "login": "joshieDo",
      "id": 93316087,
      "node_id": "U_kgDOBY_j9w",
      "avatar_url": "https://avatars.githubusercontent.com/u/93316087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshieDo",
      "html_url": "https://github.com/joshieDo",
      "followers_url": "https://api.github.com/users/joshieDo/followers",
      "following_url": "https://api.github.com/users/joshieDo/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshieDo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshieDo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshieDo/subscriptions",
      "organizations_url": "https://api.github.com/users/joshieDo/orgs",
      "repos_url": "https://api.github.com/users/joshieDo/repos",
      "events_url": "https://api.github.com/users/joshieDo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshieDo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-17T12:42:07Z",
    "updated_at": "2022-08-17T12:43:26Z",
    "author_association": "COLLABORATOR",
    "body": "Being an `Invalid API Key`, it leads me to believe that you're somehow calling it with wrong API Keys or with wrong chain ids.\r\n\r\nFor example, avalanche/fuji key != ethereum/mainnet/goerli keys.\r\n\r\nFor `verify-check` you still have to call it with the correct `--chain-id` and `--etherscan-key`, it's not enough to do `forge vc GUID`.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1217958586/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1217965561",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2809#issuecomment-1217965561",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
    "id": 1217965561,
    "node_id": "IC_kwDOGBlvNc5ImK35",
    "user": {
      "login": "jordaniza",
      "id": 45881807,
      "node_id": "MDQ6VXNlcjQ1ODgxODA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/45881807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jordaniza",
      "html_url": "https://github.com/jordaniza",
      "followers_url": "https://api.github.com/users/jordaniza/followers",
      "following_url": "https://api.github.com/users/jordaniza/following{/other_user}",
      "gists_url": "https://api.github.com/users/jordaniza/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jordaniza/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jordaniza/subscriptions",
      "organizations_url": "https://api.github.com/users/jordaniza/orgs",
      "repos_url": "https://api.github.com/users/jordaniza/repos",
      "events_url": "https://api.github.com/users/jordaniza/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jordaniza/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-17T12:48:32Z",
    "updated_at": "2022-08-17T12:48:32Z",
    "author_association": "NONE",
    "body": "Appreciate the pointers, we'll aware of the chain id and key config settings. Verify works fine if passed after forge script, so the etherscan api key is not the problem.\n\nChain ID I definitely pass, I will share the bash scripts  when putting up the other sample repo for the other issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1217965561/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250077745",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2809#issuecomment-1250077745",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
    "id": 1250077745,
    "node_id": "IC_kwDOGBlvNc5Kgqwx",
    "user": {
      "login": "rkrasiuk",
      "id": 25429261,
      "node_id": "MDQ6VXNlcjI1NDI5MjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25429261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkrasiuk",
      "html_url": "https://github.com/rkrasiuk",
      "followers_url": "https://api.github.com/users/rkrasiuk/followers",
      "following_url": "https://api.github.com/users/rkrasiuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkrasiuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkrasiuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkrasiuk/subscriptions",
      "organizations_url": "https://api.github.com/users/rkrasiuk/orgs",
      "repos_url": "https://api.github.com/users/rkrasiuk/repos",
      "events_url": "https://api.github.com/users/rkrasiuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkrasiuk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-17T14:06:40Z",
    "updated_at": "2022-09-17T14:06:40Z",
    "author_association": "COLLABORATOR",
    "body": "@jordaniza hey, could you give an update on this issue? if it persists - could you pls provide a minimal reproducible example?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250077745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250907828",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2809#issuecomment-1250907828",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
    "id": 1250907828,
    "node_id": "IC_kwDOGBlvNc5Kj1a0",
    "user": {
      "login": "jordaniza",
      "id": 45881807,
      "node_id": "MDQ6VXNlcjQ1ODgxODA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/45881807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jordaniza",
      "html_url": "https://github.com/jordaniza",
      "followers_url": "https://api.github.com/users/jordaniza/followers",
      "following_url": "https://api.github.com/users/jordaniza/following{/other_user}",
      "gists_url": "https://api.github.com/users/jordaniza/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jordaniza/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jordaniza/subscriptions",
      "organizations_url": "https://api.github.com/users/jordaniza/orgs",
      "repos_url": "https://api.github.com/users/jordaniza/repos",
      "events_url": "https://api.github.com/users/jordaniza/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jordaniza/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-19T11:41:44Z",
    "updated_at": "2022-09-19T11:41:44Z",
    "author_association": "NONE",
    "body": "my bad @rkrasiuk this totally slipped my mind.\r\n\r\nI've in general stopped using forge-verify because I have basically had full success deploying with forge script --verify and using --resume if etherscan hasn't caught up. \r\n\r\nI will try verifying contracts on the latest version of foundry and see if my old issues persist!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250907828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1251020695",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2809#issuecomment-1251020695",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2809",
    "id": 1251020695,
    "node_id": "IC_kwDOGBlvNc5KkQ-X",
    "user": {
      "login": "rkrasiuk",
      "id": 25429261,
      "node_id": "MDQ6VXNlcjI1NDI5MjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25429261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkrasiuk",
      "html_url": "https://github.com/rkrasiuk",
      "followers_url": "https://api.github.com/users/rkrasiuk/followers",
      "following_url": "https://api.github.com/users/rkrasiuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkrasiuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkrasiuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkrasiuk/subscriptions",
      "organizations_url": "https://api.github.com/users/rkrasiuk/orgs",
      "repos_url": "https://api.github.com/users/rkrasiuk/repos",
      "events_url": "https://api.github.com/users/rkrasiuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkrasiuk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-19T13:27:12Z",
    "updated_at": "2022-09-19T13:27:12Z",
    "author_association": "COLLABORATOR",
    "body": "@jordaniza thanks for getting back, will wait for the result",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1251020695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
