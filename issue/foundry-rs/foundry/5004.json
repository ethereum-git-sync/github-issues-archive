{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5004",
  "id": 1720373253,
  "node_id": "I_kwDOGBlvNc5mitAF",
  "number": 5004,
  "title": "eth_getProof on anvil node returns wrong RLP encoding",
  "user": {
    "login": "Artifex1",
    "id": 15930369,
    "node_id": "MDQ6VXNlcjE1OTMwMzY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15930369?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Artifex1",
    "html_url": "https://github.com/Artifex1",
    "followers_url": "https://api.github.com/users/Artifex1/followers",
    "following_url": "https://api.github.com/users/Artifex1/following{/other_user}",
    "gists_url": "https://api.github.com/users/Artifex1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Artifex1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Artifex1/subscriptions",
    "organizations_url": "https://api.github.com/users/Artifex1/orgs",
    "repos_url": "https://api.github.com/users/Artifex1/repos",
    "events_url": "https://api.github.com/users/Artifex1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Artifex1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-05-22T19:46:06Z",
  "updated_at": "2023-10-03T19:09:57Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (31fcf5a 2023-05-19T00:04:19.980323193Z)\n\n### What command(s) is the bug in?\n\nanvil\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nSteps to reproduce:\r\n\r\n1. Running a local node with `anvil`\r\n2. Deploying a contract with arbitrary storage writes\r\n3. Getting the proof for one of the storage slots as `cast proof <contract> <slot>`\r\n\r\nThe returning account and storage proof array elements have a wrong RLP encoding which cannot be decoded.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1557865341",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5004#issuecomment-1557865341",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004",
    "id": 1557865341,
    "node_id": "IC_kwDOGBlvNc5c2yN9",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-22T19:51:15Z",
    "updated_at": "2023-05-22T19:51:15Z",
    "author_association": "MEMBER",
    "body": "> The returning account and storage proof array elements have a wrong RLP encoding which cannot be decoded.\r\n\r\ncan you be more specific here, please?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1557865341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1557890314",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5004#issuecomment-1557890314",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004",
    "id": 1557890314,
    "node_id": "IC_kwDOGBlvNc5c24UK",
    "user": {
      "login": "Artifex1",
      "id": 15930369,
      "node_id": "MDQ6VXNlcjE1OTMwMzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15930369?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Artifex1",
      "html_url": "https://github.com/Artifex1",
      "followers_url": "https://api.github.com/users/Artifex1/followers",
      "following_url": "https://api.github.com/users/Artifex1/following{/other_user}",
      "gists_url": "https://api.github.com/users/Artifex1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Artifex1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Artifex1/subscriptions",
      "organizations_url": "https://api.github.com/users/Artifex1/orgs",
      "repos_url": "https://api.github.com/users/Artifex1/repos",
      "events_url": "https://api.github.com/users/Artifex1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Artifex1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-22T20:04:21Z",
    "updated_at": "2023-05-22T20:04:21Z",
    "author_association": "NONE",
    "body": "Sure, consider I have a contract at address `0x5fbdb2315678afecb367f032d93f642f64180aa3` with storage value `0x042648680d4eb4bb47f2cd970fbd52a412a106e2ff3a9e67598084b67aead527` at slot `0x6d55970f1749d3181c34cda959776611ed73b92cf77e72b18a770442010e1b02` (among others). Then `cast proof` for that address and slot returns the following:\r\n\r\n```json\r\n{\r\n    \"address\": \"0x5fbdb2315678afecb367f032d93f642f64180aa3\",\r\n    \"balance\": \"0x0\",\r\n    \"codeHash\": \"0x0baf51d4b6b9c4c112fcdbbf0d258470e5e092f51ddd031716c5651f2bae526f\",\r\n    \"nonce\": \"0x1\",\r\n    \"storageHash\": \"0x4b49692943e98ccd66fe6576928535d984b973b085948d07012beb3491747609\",\r\n    \"accountProof\": [\r\n        \"0xfe33cb8023c0d400ea554e87fc49a073583c3e83ff51809dc81bdb915f238ae2eae2eae7807b511c8799e32a00808434087c343511dcd07849cbb5f45a4f275baab66133be80de95769e8293a11da5da78efc96028ffd48f94fdf20e6b41e464c61ced6d649580cdf571019f90d3c2d07736b8b40868a2f8b5e58d1093bec37b3351d4286abfae8072f49529c0f99a3d46e0a0dce3f3527c53a12c96bfcf30db993d18231e12069680792abc6dc5c7876958852dcdcecf5877b5799d474135a9ef08a2cf2a188592eb80fc1cf0b15da7e492537f17aa327f0a4092b1ed815fc4625ff86c8b1b3f5cd02780bcb3ddeda43386163fa796b29e7b02fb1fa1c38197531bcb1a1920fbd25f5883806d460e9154787237da8e007f64d5baca219f96e084f45a14c90b1ee7a5f08bde\",\r\n        \"0x4004e659e60b21cc961f64ad47f20523c1d329d4bbda245ef3940a76dc89d0911b1901f8440180a04b49692943e98ccd66fe6576928535d984b973b085948d07012beb3491747609a00baf51d4b6b9c4c112fcdbbf0d258470e5e092f51ddd031716c5651f2bae526f\"\r\n    ],\r\n    \"storageProof\": [\r\n        {\r\n            \"key\": \"0x568bf21607c8e6fcea48c26dd9d42250efee29d2f85c09b63e529653b1409126\",\r\n            \"proof\": [\r\n                \"0xfeffff804ea62ea84aec7089a998fe199f8721dfd7ba46ef86bbfb940c9b07c5cfe73b1080d0d2b84e4aeb0ea91fd19acc9d28087a512986ff035aa2fd0b0c4d3d2149aed380428e975a5566e69b020f323e96ff72fbb63acffbb6ce7b3ec96d4f7bab764b818058bc3a3a352b9e193a9bf7b9f6b49cd133d2e9fc44c35e56701e851795776cdb8024dc38da9785c3d749f09e0ad46ca1128fc9ac00a22a923521abc5d362691cdb8028b8ba95dacf1621272f715449879712a2d212be2610de0f0ed79ada569337e58084bb145c5c3024950ce8c729fc0f67da16ac61dff191ca190277938f34f3e2ae80a4df1db1931f3aa807566a4b165e82991facd7b466705de30d4c87600973eb2d80b44672676a3ffe7b61fb902ada1f974c69bfd8c77d9d29d9bd172d19cb2ea0e480e77f6f83dc385ec641063f32553e2a5582ef7c584a79d00a3cd6793dbd77b4de808ff23df2cc8c00fa33dd1fe86ed8a840472bd2f298e7055e3bc93cfc73a33a0e804b7d837177ed80c88c9e0388a28e1be0909f1996ca59477d7b11a0a1a157c23f80bc482970edf4298c7d83ba750af1d06833dda0d5f67d99b2573ca67e1f46d3b5804855aaf27b80e322cbb1832fe45bec6ce3901b66b0df0674df2f00f989e1023380ed2db838f0f5858c320f4a40ad138fa50ed93e02495dfe9d39da81748811a73a801925779e85c71177c6255fd123a42ed9c32908bbe00df4d8417a361cd77c9658\",\r\n                \"0xfe7b8a803d7f81b6beeb519c5e49b824df238e55a0a321689f828c23b0794f15ae01de6280691c0f2b9f918dbc7a60b01a98f629d3e398383993a4b830f0b4cb08ea5438c9808c698f26c5352233b316324c60ff568c522d314a524a2919ae09433f0f16ea4280729984ee5d0a2f303c6896254b84d53e3165de2d9a76a45aae105d7e76a3030180d78ba8ea0eeb210de36dfcecdc150f6fd4bcf0a3a1ee7b422371e6dfb08402418073e4b3cd625130b87e58896ae0c82ecb01797c2ac118b96dc0949d66e416394980a850ca485780908d05af94f8e4ff5910278212c5d4e62656b314c38fc477938380cfa3deaf3c8eb5eca6a1a28157b9aeb2cdda4c86525028a27584a30ea0460434809e566d0e73028f40838805777c8fba3b1134f1f34e7da679dc5f318107330647\",\r\n                \"0xfe001180db41fa988afd65657783828581740e87c2578a016a14caae168f6fc0bda77d6480f29b490dde49949d5e9bfbed8654c8977457eee8135a757a17ec8e321d5daf88\",\r\n                \"0x3e0bf21607c8e6fcea48c26dd9d42250efee29d2f85c09b63e529653b140912684a0042648680d4eb4bb47f2cd970fbd52a412a106e2ff3a9e67598084b67aead527\"\r\n            ],\r\n            \"value\": \"0x42648680d4eb4bb47f2cd970fbd52a412a106e2ff3a9e67598084b67aead527\"\r\n        }\r\n    ]\r\n}\r\n```\r\n\r\nHowever, the `accountProof` and `storageProof[0].proof` elements are not RLP decodable. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1557890314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1557906210",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5004#issuecomment-1557906210",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004",
    "id": 1557906210,
    "node_id": "IC_kwDOGBlvNc5c28Mi",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-22T20:14:15Z",
    "updated_at": "2023-05-22T20:14:15Z",
    "author_association": "MEMBER",
    "body": "tbh, I don't know, eth_getProof is one of the hardest and confusing endpoints",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1557906210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1745240447",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5004#issuecomment-1745240447",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004",
    "id": 1745240447,
    "node_id": "IC_kwDOGBlvNc5oBkF_",
    "user": {
      "login": "Arachnid",
      "id": 17865,
      "node_id": "MDQ6VXNlcjE3ODY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/17865?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Arachnid",
      "html_url": "https://github.com/Arachnid",
      "followers_url": "https://api.github.com/users/Arachnid/followers",
      "following_url": "https://api.github.com/users/Arachnid/following{/other_user}",
      "gists_url": "https://api.github.com/users/Arachnid/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Arachnid/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Arachnid/subscriptions",
      "organizations_url": "https://api.github.com/users/Arachnid/orgs",
      "repos_url": "https://api.github.com/users/Arachnid/repos",
      "events_url": "https://api.github.com/users/Arachnid/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Arachnid/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-03T15:41:38Z",
    "updated_at": "2023-10-03T16:06:03Z",
    "author_association": "NONE",
    "body": "I've just encountered this myself. It'd be really good to see this addressed rather than put in the too-hard basket. Is there anything I can do to help it get fixed?\r\n\r\nAs a concrete example, here's a valid proof, generated by ganache, for a contract with value `0x2a` in slot 1:\r\n```\r\n  \"storageProof\": [\r\n    {\r\n      \"key\": \"0x0000000000000000000000000000000000000000000000000000000000000001\",\r\n      \"proof\": [\r\n        \"0xf8718080a04fc5f13ab2f9ba0c2da88b0151ab0e7cf4d85d08cca45ccd923c6ab76323eb288080a01813db5734a0840cf6e5dac777dc05dcceefaffba841b82cd6fadc347be43a548080808080a0e4449cb51d628e6e071cbba31d760efcf09715ce230ac380c7a239722c0f22118080808080\",\r\n        \"0xe2a0310e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf62a\"\r\n      ],\r\n      \"value\": \"0x2a\"\r\n    }\r\n```\r\n\r\nHere's the corresponding proof generated by Anvil, which should be identical:\r\n```\r\n  \"storageProof\": [\r\n    {\r\n      \"key\": \"0xb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6\",\r\n      \"proof\": [\r\n        \"0xfe2408807eb8461ee885b7c27d3fa0581168a345f6d60500b5dba3a03f7fd7ae0465521a806a6ee3ad11fc804c3bfd7b7be5487aa016a84b8b37a1dcd7c03ba172c39a09fe803877ec5dc03be5250214e5047a8a967dc0e024bd967387b51799a5980a3ba7e8\",\r\n        \"0x40010e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6042a\"\r\n      ],\r\n      \"value\": \"0x2a\"\r\n    }\r\n```\r\n\r\nNote that the `key` is also incorrect, despite the argument being the same (`0x...01`) in both cases.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1745240447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1745565125",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5004#issuecomment-1745565125",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5004",
    "id": 1745565125,
    "node_id": "IC_kwDOGBlvNc5oCzXF",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-03T19:09:56Z",
    "updated_at": "2023-10-03T19:09:56Z",
    "author_association": "MEMBER",
    "body": "could you please prepare a repro for this?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1745565125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
