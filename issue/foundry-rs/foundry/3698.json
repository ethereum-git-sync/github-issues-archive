{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/3698",
  "id": 1451856848,
  "node_id": "I_kwDOGBlvNc5WiZPQ",
  "number": 3698,
  "title": "Multi chain deployment script issues (Ledger, --verify) ",
  "user": {
    "login": "sendra",
    "id": 6848271,
    "node_id": "MDQ6VXNlcjY4NDgyNzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6848271?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sendra",
    "html_url": "https://github.com/sendra",
    "followers_url": "https://api.github.com/users/sendra/followers",
    "following_url": "https://api.github.com/users/sendra/following{/other_user}",
    "gists_url": "https://api.github.com/users/sendra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sendra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sendra/subscriptions",
    "organizations_url": "https://api.github.com/users/sendra/orgs",
    "repos_url": "https://api.github.com/users/sendra/repos",
    "events_url": "https://api.github.com/users/sendra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sendra/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 4182991461,
      "node_id": "LA_kwDOGBlvNc75U2Jl",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-script",
      "name": "Cmd-forge-script",
      "color": "006B75",
      "default": false,
      "description": "Command: forge script"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-11-16T15:57:17Z",
  "updated_at": "2023-04-11T23:03:28Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (903a073 2022-11-15T00:06:12.539932Z)\n\n### What command(s) is the bug in?\n\nforge script scripts/FullMultiChain.s.sol:FullMultiChainDeployment --broadcast --private-key ${PRIVATE_KEY} --verify --multi -vvvv\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\nWhile trying out the new multi chain deployments from a same script I found a few issues.\r\n\r\nWhile using private key for deployment it works correctly, but when using ledger it breaks.\r\n\r\ncommand: `forge script scripts/FullMultiChain.s.sol:FullMultiChainDeployment --broadcast --legacy --ledger --mnemonic-indexes ${MNEMONIC_INDEX} --sender ${LEDGER_SENDER} --verify -vvvv`\r\n\r\nerror: \r\n```\r\n\r\nScript ran successfully.\r\nGas used: 4208925\r\nMulti chain deployment is still under development. Use with caution.\r\n\r\n## Setting up (2) EVMs.\r\n==========================\r\nSimulated On-chain Traces:\r\n\r\n  [1670532] → new TransparentProxyFactory@0xc716bDC36D18D903FAC96D9f1491dCAe0B4A7544\r\n    └─ ← 7505 bytes of code\r\n\r\n  [446734] TransparentProxyFactory::createDeterministicProxyAdmin(0x6D603081563784dB3f83ef1F65Cc389D94365Ac9, 0x54db45112fa098101a2fad13c11ac68f40a4db2489b6578d89830146fa693ed8) \r\n    ├─ [360715] → new ProxyAdmin@0xf3EE93c92342D5FfE50BA3E4E218055Ec0778D89\r\n    │   ├─ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: TransparentProxyFactory: [0xc716bDC36D18D903FAC96D9f1491dCAe0B4A7544])\r\n    │   └─ ← 1683 bytes of code\r\n    ├─ [2371] ProxyAdmin::transferOwnership(0x6D603081563784dB3f83ef1F65Cc389D94365Ac9) \r\n    │   ├─ emit OwnershipTransferred(previousOwner: TransparentProxyFactory: [0xc716bDC36D18D903FAC96D9f1491dCAe0B4A7544], newOwner: 0x6D603081563784dB3f83ef1F65Cc389D94365Ac9)\r\n    │   └─ ← ()\r\n    ├─ emit ProxyAdminDeterministicCreated(proxyAdmin: ProxyAdmin: [0xf3EE93c92342D5FfE50BA3E4E218055Ec0778D89], adminOwner: 0x6D603081563784dB3f83ef1F65Cc389D94365Ac9, salt: 0x54db45112fa098101a2fad13c11ac68f40a4db2489b6578d89830146fa693ed8)\r\n    └─ ← ProxyAdmin: [0xf3EE93c92342D5FfE50BA3E4E218055Ec0778D89]\r\n\r\n  [1670532] → new TransparentProxyFactory@0xA07f8DbbB7ae008904470e10d54716baa7C73e3D\r\n    └─ ← 7505 bytes of code\r\n\r\n  [446734] TransparentProxyFactory::createDeterministicProxyAdmin(0x6D603081563784dB3f83ef1F65Cc389D94365Ac9, 0x54db45112fa098101a2fad13c11ac68f40a4db2489b6578d89830146fa693ed8) \r\n    ├─ [360715] → new ProxyAdmin@0x788A5119e3437aDA6b1B3326DdEE98eb3Bf365b4\r\n    │   ├─ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: TransparentProxyFactory: [0xA07f8DbbB7ae008904470e10d54716baa7C73e3D])\r\n    │   └─ ← 1683 bytes of code\r\n    ├─ [2371] ProxyAdmin::transferOwnership(0x6D603081563784dB3f83ef1F65Cc389D94365Ac9) \r\n    │   ├─ emit OwnershipTransferred(previousOwner: TransparentProxyFactory: [0xA07f8DbbB7ae008904470e10d54716baa7C73e3D], newOwner: 0x6D603081563784dB3f83ef1F65Cc389D94365Ac9)\r\n    │   └─ ← ()\r\n    ├─ emit ProxyAdminDeterministicCreated(proxyAdmin: ProxyAdmin: [0x788A5119e3437aDA6b1B3326DdEE98eb3Bf365b4], adminOwner: 0x6D603081563784dB3f83ef1F65Cc389D94365Ac9, salt: 0x54db45112fa098101a2fad13c11ac68f40a4db2489b6578d89830146fa693ed8)\r\n    └─ ← ProxyAdmin: [0x788A5119e3437aDA6b1B3326DdEE98eb3Bf365b4]\r\n\r\n\r\n==========================\r\n\r\nChain 5\r\n\r\nEstimated total gas used for script: 2752445\r\n\r\nEstimated amount required: 0.29019783444836731 ETH\r\n\r\n==========================\r\n\r\n==========================\r\n\r\nChain 43113\r\n\r\nEstimated total gas used for script: 2752445\r\n\r\nEstimated amount required: 0.068811125 ETH\r\n\r\n==========================\r\n\r\n###\r\nFinding wallets for all the necessary addresses...\r\n\r\n###\r\nFinding wallets for all the necessary addresses...\r\n##\r\nSending transactions [0 - 1].\r\n⠉ [00:00:13] [####################################################################################################################################################] 2/2 txes (0.0s)##\r\nWaiting for receipts.\r\n⠙ [00:00:07] [################################################################################################################################################] 2/2 receipts (0.0s)\r\n##### fuji\r\n✅ Hash: 0xf75011fcada9978aeeb3cec7fd45ea921a4e7bea9056d9c268a6b37bb05e0b7e\r\nContract Address: 0xa07f8dbbb7ae008904470e10d54716baa7c73e3d\r\nBlock: 15859350\r\nPaid: 0.0417633 ETH (1670532 gas * 25 gwei)\r\n\r\n\r\n##### fuji\r\n✅ Hash: 0x18d82180d5136fda63947ec674fa532ec9ea68537ba50995ca3056fe294f7f71\r\nBlock: 15859352\r\nPaid: 0.0105114 ETH (420456 gas * 25 gwei)\r\n\r\n\r\n\r\n==========================\r\n\r\nONCHAIN EXECUTION COMPLETE & SUCCESSFUL.\r\nTotal Paid: 0.0522747 ETH (2090988 gas * avg 25 gwei)\r\n\r\nTransactions saved to: /Users/user/bgd/project/broadcast/multi/FullMultiChain.s.sol-latest/run.json\r\n\r\nError: \r\n[Err(\r\nLedger device not available.\r\n\r\nContext:\r\n- hidapi error: hid_error is not implemented yet)]\r\nmake: *** [deploy-full-flow-ledger] Error 1\r\n```\r\nSo I can sign the transactions on fuji, but when its time to sign on a different network (goerli) it breaks.\r\n\r\nAlso verification does not work with private key or ledger. I am adding the expected `--verify` flag, and have set up on `foundry.toml` the etherscan vars so i guess there should not be any need to add them to the command:\r\n```\r\n[etherscan]\r\nmainnet = { key = \"${ETHERSCAN_API_KEY_ETH}\" }\r\navalanche= { key = \"${ETHERSCAN_API_KEY_AVAX}\" }\r\noptimism= { key = \"${ETHERSCAN_API_KEY_OP}\" }\r\n```\r\n\r\nDon't know if i am missing some flag or maybe the toml config nees something else?\r\n\r\nThx for the help\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698/reactions",
    "total_count": 2,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1504235500",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3698#issuecomment-1504235500",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3698",
    "id": 1504235500,
    "node_id": "IC_kwDOGBlvNc5ZqM_s",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-11T23:03:21Z",
    "updated_at": "2023-04-11T23:03:28Z",
    "author_association": "COLLABORATOR",
    "body": "Can you confirm if this is still an issue? I believe there's been some ledger fixes since this was created",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1504235500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
