{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/188",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/188",
  "id": 1066368050,
  "node_id": "I_kwDOGBlvNc4_j3wy",
  "number": 188,
  "title": "Tests aren't recompiled when one of their imports changes",
  "user": {
    "login": "jparklev",
    "id": 24902242,
    "node_id": "MDQ6VXNlcjI0OTAyMjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/24902242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jparklev",
    "html_url": "https://github.com/jparklev",
    "followers_url": "https://api.github.com/users/jparklev/followers",
    "following_url": "https://api.github.com/users/jparklev/following{/other_user}",
    "gists_url": "https://api.github.com/users/jparklev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jparklev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jparklev/subscriptions",
    "organizations_url": "https://api.github.com/users/jparklev/orgs",
    "repos_url": "https://api.github.com/users/jparklev/repos",
    "events_url": "https://api.github.com/users/jparklev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jparklev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-11-29T18:36:44Z",
  "updated_at": "2021-11-30T08:01:39Z",
  "closed_at": "2021-11-30T08:01:13Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# The Problem\r\n\r\nWhen running tests using `forge test`, an update to the contracts imported by the tests doesn't trigger recompilations for the tests. For example, if we have a test file `test.t.sol`:\r\n\r\n```solidity\r\nimport { Lad } from \"../Lad.sol\";\r\n...\r\nfunction testLad() public { assertEq(lad.flip(), 123); }\r\n...\r\n```\r\n\r\nThen we update the implementation of `lad.flip()` to return `321` rather than `123`, the tests still pass on the next `forge test` since the `test.t.sol` didn't recompile. Changing anything in the test file triggers a recompilation and then the tests fail as expected.\r\n\r\n# Possible Solution\r\n\r\nMy understanding is that this has to do with the way `ethers-rs` is caching and deciding when a file needs to be recompiled. A solution might be invalidate cached files if a) their source has changed, or b) the source of any of their imports has changed. I could be missing something about what ethers is doing atm, though.Â Haven't gotten into that src much yet.\r\n\r\nAlso lemme know if you'd like to push this issue over the the ethers repo for better tracking.",
  "closed_by": {
    "login": "gakonst",
    "id": 17802178,
    "node_id": "MDQ6VXNlcjE3ODAyMTc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gakonst",
    "html_url": "https://github.com/gakonst",
    "followers_url": "https://api.github.com/users/gakonst/followers",
    "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
    "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
    "organizations_url": "https://api.github.com/users/gakonst/orgs",
    "repos_url": "https://api.github.com/users/gakonst/repos",
    "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gakonst/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/188/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981912448",
    "html_url": "https://github.com/foundry-rs/foundry/issues/188#issuecomment-981912448",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188",
    "id": 981912448,
    "node_id": "IC_kwDOGBlvNc46hsuA",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-29T18:44:27Z",
    "updated_at": "2021-11-29T18:44:27Z",
    "author_association": "MEMBER",
    "body": "this is definitely an ethers-solc issue, and you're probably right with your diagnosis.\r\nI assume the following is happening, during compilation we're mostly concerned with src contracts and not necessarily test contracts so that test files aren't properly checked for changes if the src contract is unchanged when we construct the dependency tree from the src contract's pov.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981912448/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981917055",
    "html_url": "https://github.com/foundry-rs/foundry/issues/188#issuecomment-981917055",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188",
    "id": 981917055,
    "node_id": "IC_kwDOGBlvNc46ht1_",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-29T18:51:02Z",
    "updated_at": "2021-11-29T18:51:02Z",
    "author_association": "MEMBER",
    "body": "there were some ethers-solc changes yesterday that are already included on foundry master, so just to clarify this happens with the current master as well @jparklev ?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981917055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981923408",
    "html_url": "https://github.com/foundry-rs/foundry/issues/188#issuecomment-981923408",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188",
    "id": 981923408,
    "node_id": "IC_kwDOGBlvNc46hvZQ",
    "user": {
      "login": "jparklev",
      "id": 24902242,
      "node_id": "MDQ6VXNlcjI0OTAyMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/24902242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jparklev",
      "html_url": "https://github.com/jparklev",
      "followers_url": "https://api.github.com/users/jparklev/followers",
      "following_url": "https://api.github.com/users/jparklev/following{/other_user}",
      "gists_url": "https://api.github.com/users/jparklev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jparklev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jparklev/subscriptions",
      "organizations_url": "https://api.github.com/users/jparklev/orgs",
      "repos_url": "https://api.github.com/users/jparklev/repos",
      "events_url": "https://api.github.com/users/jparklev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jparklev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-29T18:59:50Z",
    "updated_at": "2021-11-29T18:59:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually I think i'm behind by a day or two, let me try with the latest @mattsse. brb",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981923408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981964345",
    "html_url": "https://github.com/foundry-rs/foundry/issues/188#issuecomment-981964345",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188",
    "id": 981964345,
    "node_id": "IC_kwDOGBlvNc46h5Y5",
    "user": {
      "login": "jparklev",
      "id": 24902242,
      "node_id": "MDQ6VXNlcjI0OTAyMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/24902242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jparklev",
      "html_url": "https://github.com/jparklev",
      "followers_url": "https://api.github.com/users/jparklev/followers",
      "following_url": "https://api.github.com/users/jparklev/following{/other_user}",
      "gists_url": "https://api.github.com/users/jparklev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jparklev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jparklev/subscriptions",
      "organizations_url": "https://api.github.com/users/jparklev/orgs",
      "repos_url": "https://api.github.com/users/jparklev/repos",
      "events_url": "https://api.github.com/users/jparklev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jparklev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-29T19:53:27Z",
    "updated_at": "2021-11-29T20:30:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "> there were some ethers-solc changes yesterday that are already included on foundry master, so just to clarify this happens with the current master as well @jparklev ?\r\n\r\nConfirmed on current master ð ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/981964345/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/982376490",
    "html_url": "https://github.com/foundry-rs/foundry/issues/188#issuecomment-982376490",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/188",
    "id": 982376490,
    "node_id": "IC_kwDOGBlvNc46jeAq",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T08:01:38Z",
    "updated_at": "2021-11-30T08:01:38Z",
    "author_association": "MEMBER",
    "body": "fixed in https://github.com/gakonst/foundry/commit/0527eb95ce9c17101b434a0626ba3861836c0a9e / https://github.com/gakonst/ethers-rs/pull/634, closing optimistically, please re-open if still a problem",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/982376490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
