{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5561",
  "id": 1841269377,
  "node_id": "I_kwDOGBlvNc5tv4qB",
  "number": 5561,
  "title": "fix(`remappings`): proposing rollback changes that deduplicates insertion of `remappings` entry with `.contains()` method",
  "user": {
    "login": "cool-mestorf",
    "id": 141713461,
    "node_id": "U_kgDOCHJgNQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/141713461?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cool-mestorf",
    "html_url": "https://github.com/cool-mestorf",
    "followers_url": "https://api.github.com/users/cool-mestorf/followers",
    "following_url": "https://api.github.com/users/cool-mestorf/following{/other_user}",
    "gists_url": "https://api.github.com/users/cool-mestorf/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cool-mestorf/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cool-mestorf/subscriptions",
    "organizations_url": "https://api.github.com/users/cool-mestorf/orgs",
    "repos_url": "https://api.github.com/users/cool-mestorf/repos",
    "events_url": "https://api.github.com/users/cool-mestorf/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cool-mestorf/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "Evalir",
    "id": 26014927,
    "node_id": "MDQ6VXNlcjI2MDE0OTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Evalir",
    "html_url": "https://github.com/Evalir",
    "followers_url": "https://api.github.com/users/Evalir/followers",
    "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
    "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
    "organizations_url": "https://api.github.com/users/Evalir/orgs",
    "repos_url": "https://api.github.com/users/Evalir/repos",
    "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Evalir/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 32,
    "closed_issues": 138,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-08-08T13:32:11Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2023-08-08T12:58:53Z",
  "updated_at": "2023-08-08T13:35:40Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (6672134 2023-08-08T00:21:59.824374000Z)\n\n### What command(s) is the bug in?\n\nforge remappings\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\nThis issue proposes to rollback https://github.com/foundry-rs/foundry/pull/5541 and to implement a different fix for the original issue https://github.com/foundry-rs/foundry/issues/5540.\r\n\r\nconsidering a femplate repo with uniswap/v3-core installed, this remappings file\r\n\r\n```txt\r\nv3-core/=lib/v3-core/\r\n@uniswap/v3-core/=lib/v3-core/\r\n```\r\n\r\ngives this result\r\n\r\n```bash\r\n$ forge remappings\r\n@uniswap/v3-core/=lib/v3-core/\r\nds-test/=lib/forge-std/lib/ds-test/src/\r\nforge-std/=lib/forge-std/src/\r\nsolmate/=lib/solmate/src/\r\nv3-core/=lib/v3-core/\r\n```\r\n\r\nhowever this file, which is just two entries in switched order,\r\n\r\n```txt\r\n@uniswap/v3-core/=lib/v3-core/\r\nv3-core/=lib/v3-core/\r\n```\r\n\r\ngives this result, `v3-core` removed.\r\n\r\n```bash\r\n$ forge remappings\r\n@uniswap/v3-core/=lib/v3-core/\r\nds-test/=lib/forge-std/lib/ds-test/src/\r\nforge-std/=lib/forge-std/src/\r\nsolmate/=lib/solmate/src/\r\n```\r\n\r\nThe problem occurs because of recent fix on remappings entries processing, from merging given configuration and generated entries, sort, and deduplication ([diff](https://github.com/foundry-rs/foundry/pull/5541/files#diff-6620cb198ba2683cd67a6d30c5a96706268bd95e26d02134643f117ea57d0750R36)), to sequentially push entries to configuration object but deduplicate entries that has common suffix ([diff](https://github.com/foundry-rs/foundry/pull/5541/files#diff-5e2a1c419d9d0933e6c8c6f584b3f251326a3f18f96cd748e9bf032ab894255cL155-L156)). Because the entries in `remappings.txt` file are sequentially pushed, some entries may be excluded if they appear behind their supersets - `@uniswap/v3-core` contains `v3-core` but `v3-core` does not contain `@uniswap/v3-core`.\r\n\r\nThis issue was hard to identify and understand when I got foundryup updated and every imports starting with `v3-core` got broken. I was unable to find any official specification for `remappings.txt` file or remappings configuration formats, and if considering `remappings` consumption by solc occurs sequentially, I would suggest applying no sort or deduplication to merged configuration, but just keep their orders to user defined configs first, and auto-generated next. It may be problematic if there are multiple entries with same key pointing to different destinations, but it does not seem to be harmful in case multiple keys pointing to the same destination, just like the above example. And I think this implementation will be much easier for users to understand the behavior, as it does not override any user-defined configurations.\r\n\r\nIf specifications are fixed, I would be more than happy to submit a PR for this task.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1669601374",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5561#issuecomment-1669601374",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561",
    "id": 1669601374,
    "node_id": "IC_kwDOGBlvNc5jhBhe",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-08T13:19:12Z",
    "updated_at": "2023-08-08T13:19:12Z",
    "author_association": "MEMBER",
    "body": "thanks for flagging\r\n\r\ndo you have a repro for this @cool-mestorf ?\r\n\r\n@Evalir why are the remappings still sorted here?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1669601374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1669631794",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5561#issuecomment-1669631794",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561",
    "id": 1669631794,
    "node_id": "IC_kwDOGBlvNc5jhI8y",
    "user": {
      "login": "cool-mestorf",
      "id": 141713461,
      "node_id": "U_kgDOCHJgNQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/141713461?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cool-mestorf",
      "html_url": "https://github.com/cool-mestorf",
      "followers_url": "https://api.github.com/users/cool-mestorf/followers",
      "following_url": "https://api.github.com/users/cool-mestorf/following{/other_user}",
      "gists_url": "https://api.github.com/users/cool-mestorf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cool-mestorf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cool-mestorf/subscriptions",
      "organizations_url": "https://api.github.com/users/cool-mestorf/orgs",
      "repos_url": "https://api.github.com/users/cool-mestorf/repos",
      "events_url": "https://api.github.com/users/cool-mestorf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cool-mestorf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-08T13:34:34Z",
    "updated_at": "2023-08-08T13:34:34Z",
    "author_association": "NONE",
    "body": "The sort version I mentioned is from previous PR; Never mind it. I will bring a reproduction asap.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1669631794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1669633594",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5561#issuecomment-1669633594",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5561",
    "id": 1669633594,
    "node_id": "IC_kwDOGBlvNc5jhJY6",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-08T13:35:40Z",
    "updated_at": "2023-08-08T13:35:40Z",
    "author_association": "MEMBER",
    "body": "I think we found the issue already:\r\n\r\nit's this check\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/6672134672c8e442684d7d9c51fa8f8717b0f600/config/src/providers/remappings.rs#L36-L36\r\nadded for https://github.com/foundry-rs/foundry/issues/5540\r\nwhich should not be contains, but starts_with",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1669633594/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
