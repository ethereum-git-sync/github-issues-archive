{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4658",
  "id": 1643616549,
  "node_id": "I_kwDOGBlvNc5h95kl",
  "number": 4658,
  "title": "RPC calls to non-localhosts are slow",
  "user": {
    "login": "moubctez",
    "id": 12608048,
    "node_id": "MDQ6VXNlcjEyNjA4MDQ4",
    "avatar_url": "https://avatars.githubusercontent.com/u/12608048?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/moubctez",
    "html_url": "https://github.com/moubctez",
    "followers_url": "https://api.github.com/users/moubctez/followers",
    "following_url": "https://api.github.com/users/moubctez/following{/other_user}",
    "gists_url": "https://api.github.com/users/moubctez/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/moubctez/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/moubctez/subscriptions",
    "organizations_url": "https://api.github.com/users/moubctez/orgs",
    "repos_url": "https://api.github.com/users/moubctez/repos",
    "events_url": "https://api.github.com/users/moubctez/events{/privacy}",
    "received_events_url": "https://api.github.com/users/moubctez/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3334394235,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjM1",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "0052CC",
      "default": true,
      "description": "Good for newcomers"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-03-28T10:07:14Z",
  "updated_at": "2023-04-13T10:14:37Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (6c1eee9 2023-03-27T11:13:24.314347Z)\n\n### What command(s) is the bug in?\n\nforge create\n\n### Operating System\n\nmacOS (Intel)\n\n### Describe the bug\n\nI have `anvil` running on 0.0.0.0.\r\n\r\nI benchmark `forge create`\r\n\r\n```\r\ntime forge create --offline --rpc-url=http://127.0.0.1:8545 --private-key=…\r\n1.958u 0.247s 0:00.79 277.2% 1+0k 0+0io 0pf+0w\r\n\r\ntime forge create --offline --rpc-url=http://192.168.0.123:8545 --private-key=…\r\n1.931u 0.246s 0:06.69 32.4% 1+0k 0+0io 0pf+0w\r\n```\r\n\r\n**Why** the second invocation takes about 7 seconds to execute, providing 192.168.0.123 points to the same `anvil` service?\r\n\r\nSame story with `--rpc-url=http://anvil:8545` and `127.0.0.1\tanvil` in /etc/hosts.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1486593186",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4658#issuecomment-1486593186",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658",
    "id": 1486593186,
    "node_id": "IC_kwDOGBlvNc5Ym5yi",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T10:18:51Z",
    "updated_at": "2023-03-28T10:20:46Z",
    "author_association": "MEMBER",
    "body": "> the second invocation takes about 7 seconds to execute,\r\n\r\nthis looks like interval that's being used for checking for tx receipt etc.\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/master/common/src/provider.rs\r\n\r\nfor localhost, we can assume that we can just Hit the node with lots of requests.\r\n\r\nI guess we can add a setting for this and also tune the defaults a bit.\r\n\r\nAnd we also should exempt 0.0.0.0 from this and treat it as local, basically any IP range that is local:\r\n\r\nhttps://doc.rust-lang.org/std/net/struct.Ipv4Addr.html#method.is_link_local",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1486593186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1506655138",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4658#issuecomment-1506655138",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658",
    "id": 1506655138,
    "node_id": "IC_kwDOGBlvNc5Zzbui",
    "user": {
      "login": "lucaprov1989",
      "id": 19309416,
      "node_id": "MDQ6VXNlcjE5MzA5NDE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/19309416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucaprov1989",
      "html_url": "https://github.com/lucaprov1989",
      "followers_url": "https://api.github.com/users/lucaprov1989/followers",
      "following_url": "https://api.github.com/users/lucaprov1989/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucaprov1989/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucaprov1989/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucaprov1989/subscriptions",
      "organizations_url": "https://api.github.com/users/lucaprov1989/orgs",
      "repos_url": "https://api.github.com/users/lucaprov1989/repos",
      "events_url": "https://api.github.com/users/lucaprov1989/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucaprov1989/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T09:35:33Z",
    "updated_at": "2023-04-13T09:35:33Z",
    "author_association": "NONE",
    "body": "I'd like to pick this up.\r\n\r\nI can see already some conditional logic that changes the behaviour from local to not local [here](https://github.com/foundry-rs/foundry/blob/master/common/src/provider.rs#L174).\r\n\r\nThe `is_local_endpoint` function from `ethers_providers` only does a pattern match on the endpoint string, checking only for 2 specific cases.\r\n\r\nHow do you want me to proceed?\r\n@mattsse \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1506655138/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1506685885",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4658#issuecomment-1506685885",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658",
    "id": 1506685885,
    "node_id": "IC_kwDOGBlvNc5ZzjO9",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T09:57:19Z",
    "updated_at": "2023-04-13T09:57:19Z",
    "author_association": "MEMBER",
    "body": "ideally, we fix this in the `is_local_endpoint` function:\r\n\r\nhttps://github.com/gakonst/ethers-rs/blob/9a5b31a0a2302480080ffe34c9e1f4c957d0fd3d/ethers-providers/src/rpc/provider.rs#L1449",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1506685885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1506710899",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4658#issuecomment-1506710899",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4658",
    "id": 1506710899,
    "node_id": "IC_kwDOGBlvNc5ZzpVz",
    "user": {
      "login": "lucaprov1989",
      "id": 19309416,
      "node_id": "MDQ6VXNlcjE5MzA5NDE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/19309416?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucaprov1989",
      "html_url": "https://github.com/lucaprov1989",
      "followers_url": "https://api.github.com/users/lucaprov1989/followers",
      "following_url": "https://api.github.com/users/lucaprov1989/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucaprov1989/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucaprov1989/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucaprov1989/subscriptions",
      "organizations_url": "https://api.github.com/users/lucaprov1989/orgs",
      "repos_url": "https://api.github.com/users/lucaprov1989/repos",
      "events_url": "https://api.github.com/users/lucaprov1989/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucaprov1989/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T10:14:37Z",
    "updated_at": "2023-04-13T10:14:37Z",
    "author_association": "NONE",
    "body": "Ok cool! Shall I open an issue on `ethers-rs` and link it back to here?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1506710899/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
