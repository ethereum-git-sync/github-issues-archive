{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/908",
  "id": 1166839362,
  "node_id": "I_kwDOGBlvNc5FjI5C",
  "number": 908,
  "title": "misleading error message on failed expectEmit cheat code",
  "user": {
    "login": "devtooligan",
    "id": 71567643,
    "node_id": "MDQ6VXNlcjcxNTY3NjQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/71567643?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/devtooligan",
    "html_url": "https://github.com/devtooligan",
    "followers_url": "https://api.github.com/users/devtooligan/followers",
    "following_url": "https://api.github.com/users/devtooligan/following{/other_user}",
    "gists_url": "https://api.github.com/users/devtooligan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/devtooligan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/devtooligan/subscriptions",
    "organizations_url": "https://api.github.com/users/devtooligan/orgs",
    "repos_url": "https://api.github.com/users/devtooligan/repos",
    "events_url": "https://api.github.com/users/devtooligan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/devtooligan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3334394235,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjM1",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "0052CC",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 3593644915,
      "node_id": "LA_kwDOGBlvNc7WMqtz",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-test",
      "name": "Cmd-forge-test",
      "color": "006B75",
      "default": false,
      "description": "Command: forge test"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3703752960,
      "node_id": "LA_kwDOGBlvNc7cwskA",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-cheatcodes",
      "name": "A-cheatcodes",
      "color": "FBCA04",
      "default": false,
      "description": "Area: cheatcodes"
    },
    {
      "id": 3759719580,
      "node_id": "LA_kwDOGBlvNc7gGMSc",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/P-normal",
      "name": "P-normal",
      "color": "D93F0B",
      "default": false,
      "description": "Priority: normal"
    },
    {
      "id": 3759720552,
      "node_id": "LA_kwDOGBlvNc7gGMho",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/D-easy",
      "name": "D-easy",
      "color": "0E8A16",
      "default": false,
      "description": "Difficulty: easy"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 125,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-05-12T14:44:03Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2022-03-11T20:28:51Z",
  "updated_at": "2022-07-03T12:37:13Z",
  "closed_at": "2022-07-03T12:36:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.1.0 (05eb664 2022-03-07T00:08:24.917561+00:00)\n\n### What command(s) is the bug in?\n\nforge test\n\n### Operating System\n\nmacOS (M1)\n\n### Describe the bug\n\nAfter invoking the `expectEmit` cheatcode, if any of the topics or data in the log does not match what was expected, it gives a misleading fail  message, `FAIL. Reason: Expected an emit, but no logs were emitted afterward`   \r\n\r\nIn my example, I had coded:\r\n```\r\n        vm.expectEmit(true, true, true, true);\r\n        emit Liquidity(maturity, user2, user1, address(0), -INITIAL_BASE, 0, INITIAL_BASE);\r\n```\r\n\r\nbut I made a mistake, the 3rd parameter shouldve been user2.\r\n\r\nI got this:\r\n![Screen Shot 2022-03-11 at 12 17 05 PM](https://user-images.githubusercontent.com/71567643/157956741-a6c979d4-004c-4220-9b78-fbb89d22293c.png)\r\n\r\nIt would be nice to have a better message - at least something like \"topics or data did not match what was expected\" or even better if we could show exactly what was wrong, e.g. \"Expected 0xabcbcbcbcb for topic2 but got 0x010191911991\"",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065498075",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1065498075",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1065498075,
    "node_id": "IC_kwDOGBlvNc4_gjXb",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-11T20:35:59Z",
    "updated_at": "2022-03-11T20:35:59Z",
    "author_association": "COLLABORATOR",
    "body": "Seems there may have been an `expectEmit` regression at some point? In https://github.com/gakonst/foundry/issues/592 the failure message was `Reason: Log != expected log`, but I've just confirmed on `forge 0.1.0 (f01d2f7 2022-03-11T00:04:44.960707+00:00)` that when topics don't match I get the same `no logs were emitted` error",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065498075/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065914616",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1065914616",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1065914616,
    "node_id": "IC_kwDOGBlvNc4_iJD4",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-12T16:37:22Z",
    "updated_at": "2022-03-12T16:37:22Z",
    "author_association": "MEMBER",
    "body": "Damn the `expectEmit` issues are stacking up. I would love a tracking issue of some sort so I can fix them during/after the REVM port.\r\n\r\nFWIW this is probably a regression as @mds1 pointed out. The error message is for when you call `expectEmit` but do not emit a log afterwards, which you seem to be doing.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065914616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1173075526",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1173075526",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1173075526,
    "node_id": "IC_kwDOGBlvNc5F67ZG",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-03T12:36:57Z",
    "updated_at": "2022-07-03T12:37:13Z",
    "author_association": "MEMBER",
    "body": "I can't reproduce this anymore:\r\n\r\n```solidity\r\n// SPDX-License-Identifier: UNLICENSED\r\npragma solidity ^0.8.13;\r\n\r\nimport \"forge-std/Test.sol\";\r\n\r\ncontract A {\r\n    event Test(uint256 a);\r\n\r\n    function b() external {\r\n        emit Test(1);\r\n    }\r\n}\r\n\r\ncontract ContractTest is Test {\r\n    event Test(uint256 a);\r\n\r\n    function testExample() public {\r\n        A a = new A();\r\n\r\n        vm.expectEmit(false, true, false, true);\r\n        emit Test(2);\r\n        a.b();\r\n    }\r\n}\r\n```\r\n\r\n```\r\n$ forge test\r\n[⠢] Compiling...\r\nNo files changed, compilation skipped\r\n\r\nRunning 1 test for test/Contract.t.sol:ContractTest\r\n[FAIL. Reason: Log != expected log] testExample() (gas: 70178)\r\nTest result: FAILED. 0 passed; 1 failed; finished in 366.41µs\r\n\r\nFailed tests:\r\n[FAIL. Reason: Log != expected log] testExample() (gas: 70178)\r\n\r\nEncountered a total of 1 failing tests, 0 tests succeeded\r\n```\r\n\r\nBecause of this I am going to close this issue: improved error messages for `expectEmit` is tracked in #592. Let me know if this is still an issue for you :smile: ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1173075526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
