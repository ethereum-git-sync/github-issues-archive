{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/908",
  "id": 1166839362,
  "node_id": "I_kwDOGBlvNc5FjI5C",
  "number": 908,
  "title": "misleading error message on failed expectEmit cheat code",
  "user": {
    "login": "devtooligan",
    "id": 71567643,
    "node_id": "MDQ6VXNlcjcxNTY3NjQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/71567643?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/devtooligan",
    "html_url": "https://github.com/devtooligan",
    "followers_url": "https://api.github.com/users/devtooligan/followers",
    "following_url": "https://api.github.com/users/devtooligan/following{/other_user}",
    "gists_url": "https://api.github.com/users/devtooligan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/devtooligan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/devtooligan/subscriptions",
    "organizations_url": "https://api.github.com/users/devtooligan/orgs",
    "repos_url": "https://api.github.com/users/devtooligan/repos",
    "events_url": "https://api.github.com/users/devtooligan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/devtooligan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3334394235,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjM1",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "0052CC",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 3593644915,
      "node_id": "LA_kwDOGBlvNc7WMqtz",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-test",
      "name": "Cmd-forge-test",
      "color": "006B75",
      "default": false,
      "description": "Command: forge test"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3703752960,
      "node_id": "LA_kwDOGBlvNc7cwskA",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-cheatcodes",
      "name": "A-cheatcodes",
      "color": "FBCA04",
      "default": false,
      "description": "Area: cheatcodes"
    },
    {
      "id": 3759719580,
      "node_id": "LA_kwDOGBlvNc7gGMSc",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/P-normal",
      "name": "P-normal",
      "color": "D93F0B",
      "default": false,
      "description": "Priority: normal"
    },
    {
      "id": 3759720552,
      "node_id": "LA_kwDOGBlvNc7gGMho",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/D-easy",
      "name": "D-easy",
      "color": "0E8A16",
      "default": false,
      "description": "Difficulty: easy"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 23,
    "closed_issues": 156,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2024-01-11T17:22:26Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 4,
  "created_at": "2022-03-11T20:28:51Z",
  "updated_at": "2024-01-27T22:40:11Z",
  "closed_at": "2022-07-03T12:36:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.1.0 (05eb664 2022-03-07T00:08:24.917561+00:00)\n\n### What command(s) is the bug in?\n\nforge test\n\n### Operating System\n\nmacOS (M1)\n\n### Describe the bug\n\nAfter invoking the `expectEmit` cheatcode, if any of the topics or data in the log does not match what was expected, it gives a misleading fail  message, `FAIL. Reason: Expected an emit, but no logs were emitted afterward`   \r\n\r\nIn my example, I had coded:\r\n```\r\n        vm.expectEmit(true, true, true, true);\r\n        emit Liquidity(maturity, user2, user1, address(0), -INITIAL_BASE, 0, INITIAL_BASE);\r\n```\r\n\r\nbut I made a mistake, the 3rd parameter shouldve been user2.\r\n\r\nI got this:\r\n![Screen Shot 2022-03-11 at 12 17 05 PM](https://user-images.githubusercontent.com/71567643/157956741-a6c979d4-004c-4220-9b78-fbb89d22293c.png)\r\n\r\nIt would be nice to have a better message - at least something like \"topics or data did not match what was expected\" or even better if we could show exactly what was wrong, e.g. \"Expected 0xabcbcbcbcb for topic2 but got 0x010191911991\"",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065498075",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1065498075",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1065498075,
    "node_id": "IC_kwDOGBlvNc4_gjXb",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-11T20:35:59Z",
    "updated_at": "2022-03-11T20:35:59Z",
    "author_association": "COLLABORATOR",
    "body": "Seems there may have been an `expectEmit` regression at some point? In https://github.com/gakonst/foundry/issues/592 the failure message was `Reason: Log != expected log`, but I've just confirmed on `forge 0.1.0 (f01d2f7 2022-03-11T00:04:44.960707+00:00)` that when topics don't match I get the same `no logs were emitted` error",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065498075/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065914616",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1065914616",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1065914616,
    "node_id": "IC_kwDOGBlvNc4_iJD4",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-12T16:37:22Z",
    "updated_at": "2022-03-12T16:37:22Z",
    "author_association": "MEMBER",
    "body": "Damn the `expectEmit` issues are stacking up. I would love a tracking issue of some sort so I can fix them during/after the REVM port.\r\n\r\nFWIW this is probably a regression as @mds1 pointed out. The error message is for when you call `expectEmit` but do not emit a log afterwards, which you seem to be doing.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1065914616/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1173075526",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1173075526",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1173075526,
    "node_id": "IC_kwDOGBlvNc5F67ZG",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-03T12:36:57Z",
    "updated_at": "2022-07-03T12:37:13Z",
    "author_association": "MEMBER",
    "body": "I can't reproduce this anymore:\r\n\r\n```solidity\r\n// SPDX-License-Identifier: UNLICENSED\r\npragma solidity ^0.8.13;\r\n\r\nimport \"forge-std/Test.sol\";\r\n\r\ncontract A {\r\n    event Test(uint256 a);\r\n\r\n    function b() external {\r\n        emit Test(1);\r\n    }\r\n}\r\n\r\ncontract ContractTest is Test {\r\n    event Test(uint256 a);\r\n\r\n    function testExample() public {\r\n        A a = new A();\r\n\r\n        vm.expectEmit(false, true, false, true);\r\n        emit Test(2);\r\n        a.b();\r\n    }\r\n}\r\n```\r\n\r\n```\r\n$ forge test\r\n[⠢] Compiling...\r\nNo files changed, compilation skipped\r\n\r\nRunning 1 test for test/Contract.t.sol:ContractTest\r\n[FAIL. Reason: Log != expected log] testExample() (gas: 70178)\r\nTest result: FAILED. 0 passed; 1 failed; finished in 366.41µs\r\n\r\nFailed tests:\r\n[FAIL. Reason: Log != expected log] testExample() (gas: 70178)\r\n\r\nEncountered a total of 1 failing tests, 0 tests succeeded\r\n```\r\n\r\nBecause of this I am going to close this issue: improved error messages for `expectEmit` is tracked in #592. Let me know if this is still an issue for you :smile: ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1173075526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1913356077",
    "html_url": "https://github.com/foundry-rs/foundry/issues/908#issuecomment-1913356077",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/908",
    "id": 1913356077,
    "node_id": "IC_kwDOGBlvNc5yC38t",
    "user": {
      "login": "kwamentw",
      "id": 48419090,
      "node_id": "MDQ6VXNlcjQ4NDE5MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/48419090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kwamentw",
      "html_url": "https://github.com/kwamentw",
      "followers_url": "https://api.github.com/users/kwamentw/followers",
      "following_url": "https://api.github.com/users/kwamentw/following{/other_user}",
      "gists_url": "https://api.github.com/users/kwamentw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kwamentw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kwamentw/subscriptions",
      "organizations_url": "https://api.github.com/users/kwamentw/orgs",
      "repos_url": "https://api.github.com/users/kwamentw/repos",
      "events_url": "https://api.github.com/users/kwamentw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kwamentw/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-27T22:40:09Z",
    "updated_at": "2024-01-27T22:40:09Z",
    "author_association": "NONE",
    "body": "hi @onbjerg,\r\nI am getting this same issue after evoking my `vm.expectEmit()` in my test script, When running the test you can see the values emit, but the error tells you it expected an Emit whilst there was an emit, So i do not know whether foundry can detect the emit or I am just doing something wrong. My test script and error is below ;\r\n\r\nerror:\r\n```solidity\r\n$ forge test --mt testEmitEventTrycatch -vvvvvvv\r\n[⠰] Compiling...\r\n[⠃] Compiling 2 files with 0.8.20\r\n[⠒] Solc 0.8.20 finished in 1.48s\r\nCompiler run successful!\r\n\r\nRunning 1 test for test/TestTryCatch.t.sol:TryCatchTest\r\n[FAIL. Reason: Expected an emit, but the call reverted instead. Ensure you're testing the happy path when using the `expectEmit` cheatcode.] testEmitEventTrycatch() (gas: 11742)\r\nTraces:\r\n  [273525] TryCatchTest::setUp() \r\n    ├─ [218863] → new TryCatchEg@0x5615dEB798BB3E4dFa0139dFa1b3D433Cc23b72f\r\n    │   └─ ← 1093 bytes of code\r\n    └─ ← ()\r\n\r\n  [11742] TryCatchTest::testEmitEventTrycatch() \r\n    ├─ [0] VM::expectEmit() \r\n    │   └─ ← ()\r\n    ├─ [3701] TryCatchEg::LetsTryCatch(21, 4234) \r\n    │   ├─ [411] TryCatchEg::Add(21, 4234) [staticcall]\r\n    │   │   └─ ← 4255\r\n    │   ├─ emit ShowResult(result: 4255)\r\n    │   ├─ emit Log(message: Add successful)\r\n    │   └─ ← ()\r\n    └─ ← \"Log != expected log\"\r\n\r\nTest result: FAILED. 0 passed; 1 failed; 0 skipped; finished in 610.74µs\r\n \r\nRan 1 test suites: 0 tests passed, 1 failed, 0 skipped (1 total tests)\r\n\r\nFailing tests:\r\nEncountered 1 failing test in test/TestTryCatch.t.sol:TryCatchTest\r\n[FAIL. Reason: Expected an emit, but the call reverted instead. Ensure you're testing the happy path when using the `expectEmit` cheatcode.] testEmitEventTrycatch() (gas: 11742)\r\n\r\nEncountered a total of 1 failing tests, 0 tests succeeded\r\n```\r\n\r\nmy test script:\r\n```solidity\r\n    function testEmitEventTrycatch() public {\r\n        vm.expectEmit();\r\n        egoftrycatch.LetsTryCatch(21, 4234);\r\n    }\r\n\r\n```\r\nThe function I am testing:\r\n```solidity\r\nfunction LetsTryCatch(uint256 firstDigit, uint256 secondDigit) external {\r\n        try this.Add(firstDigit, secondDigit) returns (uint256 result) {\r\n            emit ShowResult(result);\r\n            emit Log(\"Add successful\");\r\n        } catch Error(string memory errorMessage) {\r\n            emit Log(errorMessage);\r\n            // revert(errorMessage);\r\n        } catch (bytes memory errorData) {\r\n            emit Log(string(errorData));\r\n            // revert(string(errorData));\r\n        }\r\n    }\r\n```\r\n\r\nThanks in advance",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1913356077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
