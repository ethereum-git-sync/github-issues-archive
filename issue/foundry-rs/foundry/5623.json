{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5623",
  "id": 1849803537,
  "node_id": "I_kwDOGBlvNc5uQcMR",
  "number": 5623,
  "title": "Some incorrect coverage lcov reporting",
  "user": {
    "login": "hellwolf",
    "id": 186660,
    "node_id": "MDQ6VXNlcjE4NjY2MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/186660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hellwolf",
    "html_url": "https://github.com/hellwolf",
    "followers_url": "https://api.github.com/users/hellwolf/followers",
    "following_url": "https://api.github.com/users/hellwolf/following{/other_user}",
    "gists_url": "https://api.github.com/users/hellwolf/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hellwolf/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hellwolf/subscriptions",
    "organizations_url": "https://api.github.com/users/hellwolf/orgs",
    "repos_url": "https://api.github.com/users/hellwolf/repos",
    "events_url": "https://api.github.com/users/hellwolf/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hellwolf/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-08-14T13:42:26Z",
  "updated_at": "2023-12-18T18:07:24Z",
  "closed_at": "2023-12-18T18:07:23Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [ ] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (ca67d15 2023-08-02T00:16:51.291393754Z)\n\n### What command(s) is the bug in?\n\nforge coverage --hardhat --report lcov\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nWe found sporadically some cases that the lcov reporting from foundry did not make sense to us, since the branch should in all cases be hit, here are some examples:\r\n\r\n\r\n- https://app.codecov.io/gh/superfluid-finance/protocol-monorepo/blob/dev/packages%2Fethereum-contracts%2Fcontracts%2Fagreements%2FConstantFlowAgreementV1.sol#L776 (in normal non-branching code path).\r\n\r\n- https://app.codecov.io/gh/superfluid-finance/protocol-monorepo/blob/dev/packages%2Fethereum-contracts%2Fcontracts%2Futils%2FBatchLiquidator.sol#L67 (in normal code block)\r\n\r\n- https://app.codecov.io/gh/superfluid-finance/protocol-monorepo/blob/dev/packages%2Fethereum-contracts%2Fcontracts%2Futils%2FCFAv1Forwarder.sol#L411 (abi.encodeCall)\r\n\r\n- https://app.codecov.io/gh/superfluid-finance/protocol-monorepo/blob/dev/packages%2Fethereum-contracts%2Fcontracts%2Futils%2FIDAv1Forwarder.sol#L21 (normal code paths in a constructor)\r\n\r\n... etc.\r\n\r\nIs there something we could help with to give more diagnostics information about those?\r\n",
  "closed_by": {
    "login": "Evalir",
    "id": 26014927,
    "node_id": "MDQ6VXNlcjI2MDE0OTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Evalir",
    "html_url": "https://github.com/Evalir",
    "followers_url": "https://api.github.com/users/Evalir/followers",
    "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
    "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
    "organizations_url": "https://api.github.com/users/Evalir/orgs",
    "repos_url": "https://api.github.com/users/Evalir/repos",
    "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Evalir/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1709718248",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5623#issuecomment-1709718248",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623",
    "id": 1709718248,
    "node_id": "IC_kwDOGBlvNc5l6Dro",
    "user": {
      "login": "dcposch",
      "id": 169280,
      "node_id": "MDQ6VXNlcjE2OTI4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/169280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcposch",
      "html_url": "https://github.com/dcposch",
      "followers_url": "https://api.github.com/users/dcposch/followers",
      "following_url": "https://api.github.com/users/dcposch/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcposch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcposch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcposch/subscriptions",
      "organizations_url": "https://api.github.com/users/dcposch/orgs",
      "repos_url": "https://api.github.com/users/dcposch/repos",
      "events_url": "https://api.github.com/users/dcposch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcposch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-07T08:39:56Z",
    "updated_at": "2023-09-07T08:40:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "### False negatives in branch coverage\r\n\r\nHere's a clear example. (Ignore the nonsensical  else, I added it to confirm this issue:)\r\n\r\n<img width=\"642\" alt=\"image\" src=\"https://github.com/foundry-rs/foundry/assets/169280/704e2714-457e-45bb-bd85-c23467d798a9\">\r\n\r\n**`forge coverage` correctly shows both branches taken (line coverage in both if and else), but incorrectly reports 1/2 branch coverage for the if**\r\n\r\nusing `--report debug`:\r\n\r\n```\r\nUncovered for src/DaimoAccountFactory.sol:\r\n- Branch (branch: 0, path: 0) (location: source ID 54, line 39, chars 1597-1685, hits: 0)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1709718248/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1861222524",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5623#issuecomment-1861222524",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5623",
    "id": 1861222524,
    "node_id": "IC_kwDOGBlvNc5u8AB8",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-18T18:07:24Z",
    "updated_at": "2023-12-18T18:07:24Z",
    "author_association": "MEMBER",
    "body": "Closing as duplicate, but ack coverage needs more work. Will revisit during next year",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1861222524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
