{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6795",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6795/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6795/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6795/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6795",
  "id": 2080921637,
  "node_id": "I_kwDOGBlvNc58CFgl",
  "number": 6795,
  "title": "Anvil does not fund accounts when forking Arbitrum One",
  "user": {
    "login": "wuya666",
    "id": 30381159,
    "node_id": "MDQ6VXNlcjMwMzgxMTU5",
    "avatar_url": "https://avatars.githubusercontent.com/u/30381159?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wuya666",
    "html_url": "https://github.com/wuya666",
    "followers_url": "https://api.github.com/users/wuya666/followers",
    "following_url": "https://api.github.com/users/wuya666/following{/other_user}",
    "gists_url": "https://api.github.com/users/wuya666/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wuya666/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wuya666/subscriptions",
    "organizations_url": "https://api.github.com/users/wuya666/orgs",
    "repos_url": "https://api.github.com/users/wuya666/repos",
    "events_url": "https://api.github.com/users/wuya666/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wuya666/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2024-01-14T22:22:00Z",
  "updated_at": "2024-01-14T22:22:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (293fad7 2024-01-14T00:19:14.283768427Z)\n\n### What command(s) is the bug in?\n\nanvil --chain-id 42161 --fork-url\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nAs we want to test our project with real blockchain data, we try to fork Arbitrum One by running\r\n\r\n```\r\nanvil --chain-id 42161 --fork-url https://arb-mainnet.g.alchemy.com/v2/<Alchemy API Key>\r\n```\r\n\r\nit starts up seemingly ok\r\n\r\n```\r\n0.2.0 (293fad7 2024-01-14T00:19:14.280402885Z)                                                                           \r\n    https://github.com/foundry-rs/foundry                                                                                    \r\n                                                                                                                             \r\nAvailable Accounts                                                                                                           \r\n==================                                                                                                           \r\n                                                                                                                             \r\n(0) 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000.000000000000000000 ETH)                                                \r\n(1) 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000.000000000000000000 ETH)                                                \r\n(2) 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC (10000.000000000000000000 ETH)                                                \r\n(3) 0x90F79bf6EB2c4f870365E785982E1f101E93b906 (10000.000000000000000000 ETH)                                                \r\n(4) 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 (10000.000000000000000000 ETH)                                                \r\n(5) 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc (10000.000000000000000000 ETH)                                                \r\n(6) 0x976EA74026E726554dB657fA54763abd0C3a0aa9 (10000.000000000000000000 ETH)                                                \r\n(7) 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 (10000.000000000000000000 ETH)                                                \r\n(8) 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f (10000.000000000000000000 ETH)                                                \r\n(9) 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 (10000.000000000000000000 ETH)                                                \r\n                                                                                                                             \r\nPrivate Keys                                                                                                                 \r\n==================                                                                                                           \r\n                                                                                                                             \r\n(0) 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80                                                       \r\n(1) 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d                                                       \r\n(2) 0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a                                                       \r\n(3) 0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6                                                       \r\n(4) 0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a                                                       \r\n(5) 0x8b3a350cf5c34c9194ca85829a2df0ec3153be0318b5e2d3348e872092edffba                                                       \r\n(6) 0x92db14e403b83dfe3df233f83dfa3a0d7096f21ca9b0d6d6b8d88b2b4ec1564e                                                       \r\n(7) 0x4bbbf85ce3377467afe5d46f804f221813b2bb87f24d81f60f1fcdbf7cbf4356                                                       \r\n(8) 0xdbda1821b80551c9d65939329250298aa3472ba22feea921c0cf5d620ea67b97                                                       \r\n(9) 0x2a871d0798f97d79848a013d4936a73bf4cc922c825d33c1cf7073dff6d409c6                                                       \r\n                                                                                                                             \r\nWallet                                                                                                                       \r\n==================                                                                                                           \r\nMnemonic:          test test test test test test test test test test test junk                                               \r\nDerivation path:   m/44'/60'/0'/0/                                                                                           \r\n                                                                                                                             \r\n                                                                                                                             \r\nFork                                                                                                                         \r\n==================                                                                                                           \r\nEndpoint:       https://arb-mainnet.g.alchemy.com/v2/<Alchemy API Key>                                        \r\nBlock number:   170497454                                                                                                    \r\nBlock hash:     0xab0a891e5bac12a87258c365f5eb4e306a30436d71492a90af413cfe52622c62                                           \r\nChain ID:       42161                                                                                                        \r\n                                                                                                                             \r\nBase Fee                                                                                                                     \r\n==================                                                                                                           \r\n                                                                                                                             \r\n100000000                                                                                                                    \r\n                                                                                                                             \r\nGas Limit                                                                                                                    \r\n==================                                                                                                           \r\n                                                                                                                             \r\n30000000                                                                                                                     \r\n                                                                                                                             \r\nGenesis Timestamp                                                                                                            \r\n==================                                                                                                           \r\n                                                                                                                             \r\n1705270167                                                                                                                   \r\n                                                                                                                             \r\nListening on 127.0.0.1:8545\r\n```\r\n\r\nBut when I try to get the balance of the prefunded address, it shows 0\r\n\r\n```\r\n$ curl -X POST -H 'Content-Type: application/json' http://127.0.0.1:8545 -d '{\"jsonrp\r\nc\":\"2.0\",\"method\":\"eth_getBalance\",\"params\":[\"0x90F79bf6EB2c4f870365E785982E1f101E93b906\", \"latest\"],\"id\":1}\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x0\"}\r\n```\r\n\r\nThis bug can be somewhat remediated by setting the chainId of the forked network to <b>any</b> number <b>other</b> than 42161, for example to 42162\r\n\r\n```\r\nanvil --chain-id 42162 --fork-url https://arb-mainnet.g.alchemy.com/v2/<Alchemy API Key>\r\n```\r\n\r\nThen the getBalance call will return the correct result\r\n\r\n```\r\n$ curl -X POST -H 'Content-Type: application/json' http://127.0.0.1:8545 -d '{\"jsonrp\r\nc\":\"2.0\",\"method\":\"eth_getBalance\",\"params\":[\"0x90F79bf6EB2c4f870365E785982E1f101E93b906\", \"latest\"],\"id\":1}'\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x21e19e0c9bab2400000\"}\r\n```\r\n\r\nHowever as our system requires the correct chainId to function on each chain, it is not a good solution for our testing purposes. Right now we had to resort to using Hardhat to fork the chain for tests.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6795/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6795/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
