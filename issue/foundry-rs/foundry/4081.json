{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4081",
  "id": 1531488990,
  "node_id": "I_kwDOGBlvNc5bSKre",
  "number": 4081,
  "title": "Forge fmt sometimes introduces incorrect spacing for multi-line comments with `wrap_comments` enabled",
  "user": {
    "login": "jameswenzel",
    "id": 6371847,
    "node_id": "MDQ6VXNlcjYzNzE4NDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6371847?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jameswenzel",
    "html_url": "https://github.com/jameswenzel",
    "followers_url": "https://api.github.com/users/jameswenzel/followers",
    "following_url": "https://api.github.com/users/jameswenzel/following{/other_user}",
    "gists_url": "https://api.github.com/users/jameswenzel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jameswenzel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jameswenzel/subscriptions",
    "organizations_url": "https://api.github.com/users/jameswenzel/orgs",
    "repos_url": "https://api.github.com/users/jameswenzel/repos",
    "events_url": "https://api.github.com/users/jameswenzel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jameswenzel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3854691308,
      "node_id": "LA_kwDOGBlvNc7lwevs",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-fmt",
      "name": "Cmd-forge-fmt",
      "color": "006B75",
      "default": false,
      "description": "Command: forge fmt"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rkrasiuk",
    "id": 25429261,
    "node_id": "MDQ6VXNlcjI1NDI5MjYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/25429261?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkrasiuk",
    "html_url": "https://github.com/rkrasiuk",
    "followers_url": "https://api.github.com/users/rkrasiuk/followers",
    "following_url": "https://api.github.com/users/rkrasiuk/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkrasiuk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkrasiuk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkrasiuk/subscriptions",
    "organizations_url": "https://api.github.com/users/rkrasiuk/orgs",
    "repos_url": "https://api.github.com/users/rkrasiuk/repos",
    "events_url": "https://api.github.com/users/rkrasiuk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkrasiuk/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rkrasiuk",
      "id": 25429261,
      "node_id": "MDQ6VXNlcjI1NDI5MjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25429261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkrasiuk",
      "html_url": "https://github.com/rkrasiuk",
      "followers_url": "https://api.github.com/users/rkrasiuk/followers",
      "following_url": "https://api.github.com/users/rkrasiuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkrasiuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkrasiuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkrasiuk/subscriptions",
      "organizations_url": "https://api.github.com/users/rkrasiuk/orgs",
      "repos_url": "https://api.github.com/users/rkrasiuk/repos",
      "events_url": "https://api.github.com/users/rkrasiuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkrasiuk/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-01-12T23:35:10Z",
  "updated_at": "2023-02-28T19:12:47Z",
  "closed_at": "2023-02-28T19:05:07Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [x] Foundry\r\n- [x] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (9256265 2023-01-12T00:04:39.480435Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nfmt\r\n\r\n### Operating System\r\n\r\nNone\r\n\r\n### Describe the bug\r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n        assembly { \r\n            /*\r\n             * Checks:\r\n             * 1. Order parameters struct offset == 0x20\r\n             * 2. Additional recipients arr offset == 0x240\r\n             * 3. Signature offset == 0x260 + (recipients.length * 0x40)\r\n             * 4. BasicOrderType between 0 and 23 (i.e. < 24)\r\n             */\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nbecomes\r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n        assembly {\r\n            /*\r\n             * Checks:\r\n             * 1. Order parameters struct offset == 0x20\r\n             * 2. Additional recipients arr offset == 0x240\r\n            * 3. Signature offset == 0x260 + (recipients.length * 0x40)\r\n             * 4. BasicOrderType between 0 and 23 (i.e. < 24)\r\n             */\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nNote that item 3. was shifted to the left by one space. \r\n(Strangely enough, removing the numbers after `recipients.length *` results in correct formatting again.)\r\n\r\nSimilarly happens with this multi-line comment\r\n\r\n```solidity\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n            /*\r\n            * Calculate EIP712 ConsiderationItem hashes for original\r\n            * additional recipients and add a ReceivedItem for each to the\r\n            * consideration array in the OrderFulfilled event. The original\r\n            * additional recipients are all the consideration items signed\r\n            * by the offerer aside from the primary consideration items of\r\n            * the order. Uses memory region from 0x80-0x160 as a buffer for\r\n            * calculating EIP712 ConsiderationItem hashes.\r\n            */\r\n    }\r\n}\r\n```\r\n\r\nbecomes\r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n        /*\r\n            * Calculate EIP712 ConsiderationItem hashes for original\r\n        * additional recipients and add a ReceivedItem for each to the\r\n        * consideration array in the OrderFulfilled event. The original\r\n        * additional recipients are all the consideration items signed\r\n        * by the offerer aside from the primary consideration items of\r\n        * the order. Uses memory region from 0x80-0x160 as a buffer for\r\n            * calculating EIP712 ConsiderationItem hashes.\r\n            */\r\n    }\r\n}\r\n```\r\n\r\nHowever, if spacing is \"correct\" the first time, sometimes (perhaps outside of `assembly` blocks?), it will not dis-align the `*`s:\r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n        /*\r\n         * Calculate EIP712 ConsiderationItem hashes for original\r\n         * additional recipients and add a ReceivedItem for each to the\r\n         * consideration array in the OrderFulfilled event. The original\r\n         * additional recipients are all the consideration items signed\r\n         * by the offerer aside from the primary consideration items of\r\n         * the order. Uses memory region from 0x80-0x160 as a buffer for\r\n         * calculating EIP712 ConsiderationItem hashes.\r\n         */\r\n    }\r\n}\r\n```\r\n\r\nis stable\r\n",
  "closed_by": {
    "login": "mds1",
    "id": 17163988,
    "node_id": "MDQ6VXNlcjE3MTYzOTg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mds1",
    "html_url": "https://github.com/mds1",
    "followers_url": "https://api.github.com/users/mds1/followers",
    "following_url": "https://api.github.com/users/mds1/following{/other_user}",
    "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
    "organizations_url": "https://api.github.com/users/mds1/orgs",
    "repos_url": "https://api.github.com/users/mds1/repos",
    "events_url": "https://api.github.com/users/mds1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mds1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1381381647",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4081#issuecomment-1381381647",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081",
    "id": 1381381647,
    "node_id": "IC_kwDOGBlvNc5SVjYP",
    "user": {
      "login": "rkrasiuk",
      "id": 25429261,
      "node_id": "MDQ6VXNlcjI1NDI5MjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25429261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkrasiuk",
      "html_url": "https://github.com/rkrasiuk",
      "followers_url": "https://api.github.com/users/rkrasiuk/followers",
      "following_url": "https://api.github.com/users/rkrasiuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkrasiuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkrasiuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkrasiuk/subscriptions",
      "organizations_url": "https://api.github.com/users/rkrasiuk/orgs",
      "repos_url": "https://api.github.com/users/rkrasiuk/repos",
      "events_url": "https://api.github.com/users/rkrasiuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkrasiuk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-13T06:41:07Z",
    "updated_at": "2023-01-13T06:41:07Z",
    "author_association": "COLLABORATOR",
    "body": "@jameswenzel thanks for the bug report! this issue will be addressed in scope of #3786, will make sure to add tests",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1381381647/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1381691960",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4081#issuecomment-1381691960",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081",
    "id": 1381691960,
    "node_id": "IC_kwDOGBlvNc5SWvI4",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-13T11:07:42Z",
    "updated_at": "2023-01-13T11:07:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @jameswenzel thanks for the bug report! this issue will be addressed in scope of #3786, will make sure to add tests\r\n\r\nWhy not fuzz the fmter? Can fuzz both the config and fmt results ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1381691960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1448709805",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4081#issuecomment-1448709805",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081",
    "id": 1448709805,
    "node_id": "IC_kwDOGBlvNc5WWY6t",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-28T19:05:07Z",
    "updated_at": "2023-02-28T19:05:07Z",
    "author_association": "COLLABORATOR",
    "body": "I think this is now resolved.\r\n\r\nThis example is left alone and no longer changed.\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n        assembly { \r\n            /*\r\n             * Checks:\r\n             * 1. Order parameters struct offset == 0x20\r\n             * 2. Additional recipients arr offset == 0x240\r\n             * 3. Signature offset == 0x260 + (recipients.length * 0x40)\r\n             * 4. BasicOrderType between 0 and 23 (i.e. < 24)\r\n             */\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThe second example:\r\n\r\n```solidity\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n            /*\r\n            * Calculate EIP712 ConsiderationItem hashes for original\r\n            * additional recipients and add a ReceivedItem for each to the\r\n            * consideration array in the OrderFulfilled event. The original\r\n            * additional recipients are all the consideration items signed\r\n            * by the offerer aside from the primary consideration items of\r\n            * the order. Uses memory region from 0x80-0x160 as a buffer for\r\n            * calculating EIP712 ConsiderationItem hashes.\r\n            */\r\n    }\r\n}\r\n```\r\n\r\nGets changed to\r\n\r\n```solidity\r\ncontract WeirdCommentFormat {\r\n    function weirdComment() internal pure {\r\n        /*\r\n            * Calculate EIP712 ConsiderationItem hashes for original\r\n            * additional recipients and add a ReceivedItem for each to the\r\n            * consideration array in the OrderFulfilled event. The original\r\n            * additional recipients are all the consideration items signed\r\n            * by the offerer aside from the primary consideration items of\r\n            * the order. Uses memory region from 0x80-0x160 as a buffer for\r\n            * calculating EIP712 ConsiderationItem hashes.\r\n            */\r\n    }\r\n}\r\n```\r\n\r\nIn that case my understanding is that the first `/* gets moved to the expected spot, and the rest is left where it is because, imagine if the asterisks were indented hyphens/bullet points, then the formatter wants to leave them where they are. \r\n\r\nSo I'm going to optimistically close this, but @jameswenzel feel free to create a new issue if you have a good suggested behavior for that last case (e.g. maybe if they are asterisks also shift them left, but treat other characters as bullets? but then you can't use asterisks to represent markdown bullets for `forge doc`, and have to use hyphens, which maybe is ok)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1448709805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1448711661",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4081#issuecomment-1448711661",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081",
    "id": 1448711661,
    "node_id": "IC_kwDOGBlvNc5WWZXt",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-28T19:06:28Z",
    "updated_at": "2023-02-28T19:06:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "what about the case of /*! ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1448711661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1448721487",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4081#issuecomment-1448721487",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4081",
    "id": 1448721487,
    "node_id": "IC_kwDOGBlvNc5WWbxP",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-28T19:12:47Z",
    "updated_at": "2023-02-28T19:12:47Z",
    "author_association": "COLLABORATOR",
    "body": "Sorry, what about ` /*!`? I don't see that mentioned in this issue, but if it is not being handled properly please open a new issue for it 🙂",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1448721487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
