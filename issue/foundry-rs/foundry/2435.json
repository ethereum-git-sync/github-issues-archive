{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2435",
  "id": 1313783851,
  "node_id": "I_kwDOGBlvNc5OTsAr",
  "number": 2435,
  "title": "`forge script --verify` fails with \"Etherscan could not detect the deployment\"",
  "user": {
    "login": "hbarcelos",
    "id": 16565602,
    "node_id": "MDQ6VXNlcjE2NTY1NjAy",
    "avatar_url": "https://avatars.githubusercontent.com/u/16565602?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hbarcelos",
    "html_url": "https://github.com/hbarcelos",
    "followers_url": "https://api.github.com/users/hbarcelos/followers",
    "following_url": "https://api.github.com/users/hbarcelos/following{/other_user}",
    "gists_url": "https://api.github.com/users/hbarcelos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hbarcelos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hbarcelos/subscriptions",
    "organizations_url": "https://api.github.com/users/hbarcelos/orgs",
    "repos_url": "https://api.github.com/users/hbarcelos/repos",
    "events_url": "https://api.github.com/users/hbarcelos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hbarcelos/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 4182991461,
      "node_id": "LA_kwDOGBlvNc75U2Jl",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-script",
      "name": "Cmd-forge-script",
      "color": "006B75",
      "default": false,
      "description": "Command: forge script"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 125,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-05-12T14:44:03Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 7,
  "created_at": "2022-07-21T20:47:32Z",
  "updated_at": "2022-08-15T18:30:18Z",
  "closed_at": "2022-08-15T18:30:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (4e141e7 2022-07-21T00:08:59.558233829Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge script\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\nI have a fairly simple contract which I'm trying to deploy though a script:\r\n\r\nContract:\r\n\r\n```solidity\r\npragma solidity ^0.8.14;\r\n\r\ncontract Example {\r\n  uint256 public immutable a;\r\n\r\n  constructor(uint256 a_) {\r\n    a = a_;\r\n  }\r\n}\r\n```\r\n\r\nScript:\r\n```solidity\r\npragma solidity ^0.8.14;\r\n\r\nimport \"forge-std/Script.sol\";\r\nimport {Example} from \"./Example.sol\";\r\n\r\ncontract ExampleDeploy is Script {\r\n  function run() external returns (Example) {\r\n    vm.startBroadcast();\r\n\r\n    Example tpl = new Example(1);\r\n\r\n    vm.stopBroadcast();\r\n\r\n    return tpl;\r\n  }\r\n}\r\n\r\n```\r\n\r\nThen I try to execute the script like:\r\n\r\n```bash\r\nexport ETHERSCAN_API_KEY=MY_API_KEY\r\nforge script ExampleDeploy --fork-url=http://localhost:8545 -vvv --verify --broadcast\r\n```\r\n\r\nThe contract is deployed, however the source code verification fails as I the following error:\r\n\r\n```\r\n> Error: \r\n> Etherscan could not detect the deployment.\r\n```\r\n\r\nI have tried executing this script several times and the failure rate is 100%, always on the verification step.",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1192502739",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1192502739",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1192502739,
    "node_id": "IC_kwDOGBlvNc5HFCXT",
    "user": {
      "login": "joshieDo",
      "id": 93316087,
      "node_id": "U_kgDOBY_j9w",
      "avatar_url": "https://avatars.githubusercontent.com/u/93316087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshieDo",
      "html_url": "https://github.com/joshieDo",
      "followers_url": "https://api.github.com/users/joshieDo/followers",
      "following_url": "https://api.github.com/users/joshieDo/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshieDo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshieDo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshieDo/subscriptions",
      "organizations_url": "https://api.github.com/users/joshieDo/orgs",
      "repos_url": "https://api.github.com/users/joshieDo/repos",
      "events_url": "https://api.github.com/users/joshieDo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshieDo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-22T12:04:10Z",
    "updated_at": "2022-07-22T12:04:10Z",
    "author_association": "COLLABORATOR",
    "body": "Which network? Do you actually see it deployed on the etherscan in question ?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1192502739/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1192562676",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1192562676",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1192562676,
    "node_id": "IC_kwDOGBlvNc5HFQ_0",
    "user": {
      "login": "hbarcelos",
      "id": 16565602,
      "node_id": "MDQ6VXNlcjE2NTY1NjAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16565602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hbarcelos",
      "html_url": "https://github.com/hbarcelos",
      "followers_url": "https://api.github.com/users/hbarcelos/followers",
      "following_url": "https://api.github.com/users/hbarcelos/following{/other_user}",
      "gists_url": "https://api.github.com/users/hbarcelos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hbarcelos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hbarcelos/subscriptions",
      "organizations_url": "https://api.github.com/users/hbarcelos/orgs",
      "repos_url": "https://api.github.com/users/hbarcelos/repos",
      "events_url": "https://api.github.com/users/hbarcelos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hbarcelos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-22T13:15:32Z",
    "updated_at": "2022-07-22T13:15:32Z",
    "author_association": "NONE",
    "body": "Oops, I forgot to specify: I'm using Goerli.\r\n\r\nYes, the contract was deployed to Goerli, however the verification failed.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1192562676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1193202045",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1193202045",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1193202045,
    "node_id": "IC_kwDOGBlvNc5HHtF9",
    "user": {
      "login": "joshieDo",
      "id": 93316087,
      "node_id": "U_kgDOBY_j9w",
      "avatar_url": "https://avatars.githubusercontent.com/u/93316087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshieDo",
      "html_url": "https://github.com/joshieDo",
      "followers_url": "https://api.github.com/users/joshieDo/followers",
      "following_url": "https://api.github.com/users/joshieDo/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshieDo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshieDo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshieDo/subscriptions",
      "organizations_url": "https://api.github.com/users/joshieDo/orgs",
      "repos_url": "https://api.github.com/users/joshieDo/repos",
      "events_url": "https://api.github.com/users/joshieDo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshieDo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-23T23:10:09Z",
    "updated_at": "2022-07-23T23:18:13Z",
    "author_association": "COLLABORATOR",
    "body": "If you call again (once you see it on etherscan) without the `--broadcast` flag, and only with the `--verify`, does it still happen ? I noticed that Goerli etherscan can be quite slow updating sometimes...\r\n\r\nI tried it now, and that's what happened. \r\n1. Gave me that error\r\n2. Had to wait around 2 minutes for the contract to show up on etherscan\r\n3. Called just with the --verify flag and it worked.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1193202045/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1193878931",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1193878931",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1193878931,
    "node_id": "IC_kwDOGBlvNc5HKSWT",
    "user": {
      "login": "0xPhaze",
      "id": 103113487,
      "node_id": "U_kgDOBiVjDw",
      "avatar_url": "https://avatars.githubusercontent.com/u/103113487?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xPhaze",
      "html_url": "https://github.com/0xPhaze",
      "followers_url": "https://api.github.com/users/0xPhaze/followers",
      "following_url": "https://api.github.com/users/0xPhaze/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xPhaze/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xPhaze/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xPhaze/subscriptions",
      "organizations_url": "https://api.github.com/users/0xPhaze/orgs",
      "repos_url": "https://api.github.com/users/0xPhaze/repos",
      "events_url": "https://api.github.com/users/0xPhaze/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xPhaze/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-25T10:41:33Z",
    "updated_at": "2022-07-25T10:41:33Z",
    "author_association": "NONE",
    "body": "I've been running into the same issue. \r\nI'm still trying to verify on rinkeby. Pretty much happened exactly with the new recent update for me.\r\nBefore it would at least wait a bit (or have some retries), now it just instantly spits out the error.\r\nBeen swapping out `--broadcast` with `--resume` after running the script to get it to verify.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1193878931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1194479852",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1194479852",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1194479852,
    "node_id": "IC_kwDOGBlvNc5HMlDs",
    "user": {
      "login": "hbarcelos",
      "id": 16565602,
      "node_id": "MDQ6VXNlcjE2NTY1NjAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16565602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hbarcelos",
      "html_url": "https://github.com/hbarcelos",
      "followers_url": "https://api.github.com/users/hbarcelos/followers",
      "following_url": "https://api.github.com/users/hbarcelos/following{/other_user}",
      "gists_url": "https://api.github.com/users/hbarcelos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hbarcelos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hbarcelos/subscriptions",
      "organizations_url": "https://api.github.com/users/hbarcelos/orgs",
      "repos_url": "https://api.github.com/users/hbarcelos/repos",
      "events_url": "https://api.github.com/users/hbarcelos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hbarcelos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-25T18:53:04Z",
    "updated_at": "2022-07-25T18:53:39Z",
    "author_association": "NONE",
    "body": "> If you call again (once you see it on etherscan) without the `--broadcast` flag, and only with the `--verify`, does it still happen ? I noticed that Goerli etherscan can be quite slow updating sometimes...\r\n> \r\n> I tried it now, and that's what happened.\r\n> \r\n>     1. Gave me that error\r\n> \r\n>     2. Had to wait around 2 minutes for the contract to show up on etherscan\r\n> \r\n>     3. Called just with the --verify flag and it worked.\r\n\r\nYeah, omitting the `--broadcast` flag and calling it again makes the verification go through.\r\n\r\nWould it be possible to embed this mechanism into the command? Like \"if it fails with that specific reason, wait a little bit and try again\".\r\n\r\nAs it is the command will exit with non-zero code, which can lead to all sorts of issues with shells running them.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1194479852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212370945",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1212370945",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1212370945,
    "node_id": "IC_kwDOGBlvNc5IQ1AB",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-11T18:55:28Z",
    "updated_at": "2022-08-11T18:55:28Z",
    "author_association": "MEMBER",
    "body": "Has this been fixed recently? @joshieDo ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212370945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212944451",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2435#issuecomment-1212944451",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2435",
    "id": 1212944451,
    "node_id": "IC_kwDOGBlvNc5ITBBD",
    "user": {
      "login": "joshieDo",
      "id": 93316087,
      "node_id": "U_kgDOBY_j9w",
      "avatar_url": "https://avatars.githubusercontent.com/u/93316087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshieDo",
      "html_url": "https://github.com/joshieDo",
      "followers_url": "https://api.github.com/users/joshieDo/followers",
      "following_url": "https://api.github.com/users/joshieDo/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshieDo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshieDo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshieDo/subscriptions",
      "organizations_url": "https://api.github.com/users/joshieDo/orgs",
      "repos_url": "https://api.github.com/users/joshieDo/repos",
      "events_url": "https://api.github.com/users/joshieDo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshieDo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-12T10:05:08Z",
    "updated_at": "2022-08-12T10:06:34Z",
    "author_association": "COLLABORATOR",
    "body": "Linked the above PR that taclkes this issue. However, it won't fix anything if the indexer takes 2 mins. But I think waiting 25 seconds for a contract should be enough. wdyt",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212944451/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
