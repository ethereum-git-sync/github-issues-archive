{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1159",
  "id": 1188399146,
  "node_id": "I_kwDOGBlvNc5G1Ygq",
  "number": 1159,
  "title": "Disallow some cheatcodes for precompiles",
  "user": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    },
    {
      "id": 3593644915,
      "node_id": "LA_kwDOGBlvNc7WMqtz",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-test",
      "name": "Cmd-forge-test",
      "color": "006B75",
      "default": false,
      "description": "Command: forge test"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3703752960,
      "node_id": "LA_kwDOGBlvNc7cwskA",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-cheatcodes",
      "name": "A-cheatcodes",
      "color": "FBCA04",
      "default": false,
      "description": "Area: cheatcodes"
    },
    {
      "id": 3759719580,
      "node_id": "LA_kwDOGBlvNc7gGMSc",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/P-normal",
      "name": "P-normal",
      "color": "D93F0B",
      "default": false,
      "description": "Priority: normal"
    },
    {
      "id": 3759720362,
      "node_id": "LA_kwDOGBlvNc7gGMeq",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/D-average",
      "name": "D-average",
      "color": "0E8A16",
      "default": false,
      "description": "Difficulty: average"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 125,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-05-12T14:44:03Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2022-03-31T17:18:25Z",
  "updated_at": "2023-05-10T10:56:00Z",
  "closed_at": "2023-05-10T10:55:59Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I think we should disallow `vm.etch` for addresses 0 < n < 10, and throw an error about using an address >10.\r\n\r\nI prefer breaking these early and getting \"correct\" behavior vs hacking something on Revm.\r\n\r\n(This should be fine for transfers etc on the <10 addresses and seems only a vm.etch issue?)\r\n\r\n_Originally posted by @gakonst in https://github.com/gakonst/foundry/issues/1146#issuecomment-1084837454_\r\n\r\nWorth considering disallowing other cheatcodes for those addresses. It's not realistic to `prank` that address or `mockCall` with it, and you also don't want to `save` or `load` slots from there, for example.\r\n\r\nAs for what addresses to block off, to be safe we might also want to:\r\n- Disallow a larger range, such as 0 < n < 99 to account for precompiles being added or other EVM chains that have additional precompiles\r\n- Prevent `etch`ing at addresses that other chains have predeployed contracts at. For example Optimism has [predeployed contracts](https://github.com/ethereum-optimism/optimism/blob/0ac233e73040b372464a9f59a325217254fe8e15/packages/contracts/contracts/libraries/constants/Lib_PredeployAddresses.sol) at `0x420...000` < n < `0x420...013`, not sure about other networks offhand\r\n\r\n_Originally posted by @mds1 in https://github.com/gakonst/foundry/issues/1146#issuecomment-1084848530_\r\n\r\n**This is a breaking change**",
  "closed_by": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228773947",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1159#issuecomment-1228773947",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159",
    "id": 1228773947,
    "node_id": "IC_kwDOGBlvNc5JPZo7",
    "user": {
      "login": "varunsrin",
      "id": 528882,
      "node_id": "MDQ6VXNlcjUyODg4Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/528882?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varunsrin",
      "html_url": "https://github.com/varunsrin",
      "followers_url": "https://api.github.com/users/varunsrin/followers",
      "following_url": "https://api.github.com/users/varunsrin/following{/other_user}",
      "gists_url": "https://api.github.com/users/varunsrin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varunsrin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varunsrin/subscriptions",
      "organizations_url": "https://api.github.com/users/varunsrin/orgs",
      "repos_url": "https://api.github.com/users/varunsrin/repos",
      "events_url": "https://api.github.com/users/varunsrin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varunsrin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T18:02:45Z",
    "updated_at": "2022-08-26T18:02:45Z",
    "author_association": "NONE",
    "body": "One observation is that `vm.prank` from such addresses is only problematic if you are calling a function that expects the caller to be an EOA. For example if it has code like `payable(msg.sender).transfer()`. So for some tests, I can actually use cheat codes like prank from these and it's fine. If we stop pranking from them entirely, then would it be preventing people from testing things they might actually want to test?\r\n\r\nAn alternative might be to issue a warning when this is seen, instead of disallowing. \r\n\r\n\r\nAlso, I've noticed a few other addresses have been problematic in my tests that might be worth adding to this list: \r\n\r\n```\r\n        address(0xCe71065D4017F316EC606Fe4422e11eB2c47c246), // FuzzerDict\r\n        address(0x4e59b44847b379578588920cA78FbF26c0B4956C), // CREATE2 Factory (?)\r\n        address(0xb4c79daB8f259C7Aee6E5b2Aa729821864227e84), // address(this)\r\n        address(0x185a4dc360CE69bDCceE33b3784B0282f7961aea), // ???\r\n        address(0x7109709ECfa91a80626fF3989D68f67F5b1DD12D) // ???\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228773947/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1229560538",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1159#issuecomment-1229560538",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159",
    "id": 1229560538,
    "node_id": "IC_kwDOGBlvNc5JSZra",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-28T21:45:16Z",
    "updated_at": "2022-08-28T21:45:16Z",
    "author_association": "COLLABORATOR",
    "body": "For reference:\r\n- `0x185a4dc360CE69bDCceE33b3784B0282f7961aea` is the default sender account: https://github.com/foundry-rs/foundry/blob/307576dfb9e94536177e940c2710045ada69d8d7/evm/src/lib.rs#L33-L42\r\n- `0x7109709ECfa91a80626fF3989D68f67F5b1DD12D` is the cheatcode address: https://github.com/foundry-rs/foundry/blob/307576dfb9e94536177e940c2710045ada69d8d7/evm/src/executor/abi/mod.rs#L5-L12\r\n\r\nAlso, the last 4 addresses in the above comment should probably all have default labels set if they don't already.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1229560538/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1539044754",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1159#issuecomment-1539044754",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1159",
    "id": 1539044754,
    "node_id": "IC_kwDOGBlvNc5bu_WS",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-08T21:02:12Z",
    "updated_at": "2023-05-08T21:02:12Z",
    "author_association": "MEMBER",
    "body": "Taking this one on @mds1 — was wondering, do we wanna just warn or should we just disallow?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1539044754/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
