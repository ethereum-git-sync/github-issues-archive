{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6593",
  "id": 2039997216,
  "node_id": "I_kwDOGBlvNc55l-Mg",
  "number": 6593,
  "title": "rpc url ending in slash causes issues",
  "user": {
    "login": "sakulstra",
    "id": 4396533,
    "node_id": "MDQ6VXNlcjQzOTY1MzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sakulstra",
    "html_url": "https://github.com/sakulstra",
    "followers_url": "https://api.github.com/users/sakulstra/followers",
    "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
    "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
    "organizations_url": "https://api.github.com/users/sakulstra/orgs",
    "repos_url": "https://api.github.com/users/sakulstra/repos",
    "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sakulstra/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-12-13T15:50:29Z",
  "updated_at": "2023-12-20T13:15:26Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (0ae39ea 2023-12-11T00:27:32.487222000Z)\n\n### What command(s) is the bug in?\n\nforge\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\n> script failed: Could not instantiate forked environment with fork url: `https://redacted//`\r\n\r\nIt seems like when using a rpc ending in `/` the scripts etc break as foundry adds another /.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1859331872",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6593#issuecomment-1859331872",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593",
    "id": 1859331872,
    "node_id": "IC_kwDOGBlvNc5u0ycg",
    "user": {
      "login": "jmcph4",
      "id": 717268,
      "node_id": "MDQ6VXNlcjcxNzI2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/717268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcph4",
      "html_url": "https://github.com/jmcph4",
      "followers_url": "https://api.github.com/users/jmcph4/followers",
      "following_url": "https://api.github.com/users/jmcph4/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcph4/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcph4/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcph4/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcph4/orgs",
      "repos_url": "https://api.github.com/users/jmcph4/repos",
      "events_url": "https://api.github.com/users/jmcph4/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcph4/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-18T00:00:01Z",
    "updated_at": "2023-12-18T00:00:01Z",
    "author_association": "NONE",
    "body": "How is this being invoked?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1859331872/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1859938671",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6593#issuecomment-1859938671",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593",
    "id": 1859938671,
    "node_id": "IC_kwDOGBlvNc5u3Glv",
    "user": {
      "login": "sakulstra",
      "id": 4396533,
      "node_id": "MDQ6VXNlcjQzOTY1MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sakulstra",
      "html_url": "https://github.com/sakulstra",
      "followers_url": "https://api.github.com/users/sakulstra/followers",
      "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
      "organizations_url": "https://api.github.com/users/sakulstra/orgs",
      "repos_url": "https://api.github.com/users/sakulstra/repos",
      "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sakulstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-18T09:35:29Z",
    "updated_at": "2023-12-18T09:35:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jmcph4 e.g. `forge test` (the rpc in env is set to `https://test/`)\r\n\r\nAs a workaround you can ofc remove the trailing /, but foundry should just work with both i guess.\r\nThe rpc used was quicknode if that matters.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1859938671/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1862024793",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6593#issuecomment-1862024793",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593",
    "id": 1862024793,
    "node_id": "IC_kwDOGBlvNc5u_D5Z",
    "user": {
      "login": "jmcph4",
      "id": 717268,
      "node_id": "MDQ6VXNlcjcxNzI2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/717268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmcph4",
      "html_url": "https://github.com/jmcph4",
      "followers_url": "https://api.github.com/users/jmcph4/followers",
      "following_url": "https://api.github.com/users/jmcph4/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmcph4/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmcph4/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmcph4/subscriptions",
      "organizations_url": "https://api.github.com/users/jmcph4/orgs",
      "repos_url": "https://api.github.com/users/jmcph4/repos",
      "events_url": "https://api.github.com/users/jmcph4/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmcph4/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-19T02:55:41Z",
    "updated_at": "2023-12-19T02:55:41Z",
    "author_association": "NONE",
    "body": "> @jmcph4 e.g. `forge test` (the rpc in env is set to `https://test/`)\r\n\r\nYeah just managed to reproduce this locally.\r\n\r\n> As a workaround you can ofc remove the trailing /, but foundry should just work with both i guess.\r\n\r\nDefinitely agree.\r\n\r\n> The rpc used was quicknode if that matters.\r\n\r\nNo, I've done it with llama (I wouldn't expect it to matter anyway).\r\n\r\n```rust\r\n/// Tests that we can launch in forking mode when our RPC URL has trailing slashes\r\n#[tokio::test(flavor = \"multi_thread\")]\r\nasync fn test_launch_fork_trailing_slash() {\r\n    let mut rpc_url = foundry_common::rpc::next_http_archive_rpc_endpoint();\r\n    rpc_url.push('/');\r\n    rpc_url.push('/');\r\n    let runner = forked_runner(&rpc_url).await;\r\n    let filter = Filter::new(\".*\", \".*\", &format!(\".*fork{RE_PATH_SEPARATOR}Launch\"));\r\n    TestConfig::with_filter(runner, filter).run().await;\r\n}\r\n```\r\n\r\nInterestingly this passes, so I assume the URL is being mutated much earlier in the pipeline.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1862024793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1864440216",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6593#issuecomment-1864440216",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593",
    "id": 1864440216,
    "node_id": "IC_kwDOGBlvNc5vIRmY",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-20T13:04:20Z",
    "updated_at": "2023-12-20T13:04:20Z",
    "author_association": "MEMBER",
    "body": "do you have an example for how you're using this?\r\n\r\nwe currently have a bug that this hack tried to address when the same fork URL is used twice for creating the same fork.\r\nif you're creating the same fork, could you instead try to reuse the existing uint256 id?\r\napparently, there are some edge cases or we should just fix this properly...",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1864440216/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1864455745",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6593#issuecomment-1864455745",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6593",
    "id": 1864455745,
    "node_id": "IC_kwDOGBlvNc5vIVZB",
    "user": {
      "login": "sakulstra",
      "id": 4396533,
      "node_id": "MDQ6VXNlcjQzOTY1MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sakulstra",
      "html_url": "https://github.com/sakulstra",
      "followers_url": "https://api.github.com/users/sakulstra/followers",
      "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
      "organizations_url": "https://api.github.com/users/sakulstra/orgs",
      "repos_url": "https://api.github.com/users/sakulstra/repos",
      "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sakulstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-20T13:15:07Z",
    "updated_at": "2023-12-20T13:15:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mattsse i think we don't select a fork multiple times.\r\n\r\nFaced the issue here:\r\nhttps://github.com/bgd-labs/aave-proposals-v3/blob/main/src/20231212_AaveV3Ethereum_ContinuousSecurityProposalAaveCertora/AaveV3Ethereum_ContinuousSecurityProposalAaveCertoraPart2_20231212.t.sol#L17\r\n\r\nWhich essentially only does `vm.createSelectFork(vm.rpcUrl('mainnet'), 18771153);` here.\r\nhttps://github.com/bgd-labs/aave-proposals-v3/blob/main/src/20231212_AaveV3Ethereum_ContinuousSecurityProposalAaveCertora/BaseCertoraTest.t.sol#L17\r\n\r\nAs i said it's not a big deal as it's easy to work around (by removing the slash), just a bit weird as obviously there's some wrong url mutation somewhere.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1864455745/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
