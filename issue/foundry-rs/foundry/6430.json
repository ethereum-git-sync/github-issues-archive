{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6430",
  "id": 2010880642,
  "node_id": "I_kwDOGBlvNc5325qC",
  "number": 6430,
  "title": "The 'forge --via-ir' compilation option leads to a contract running state that is inconsistent with expectations",
  "user": {
    "login": "fpChan",
    "id": 29588923,
    "node_id": "MDQ6VXNlcjI5NTg4OTIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/29588923?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fpChan",
    "html_url": "https://github.com/fpChan",
    "followers_url": "https://api.github.com/users/fpChan/followers",
    "following_url": "https://api.github.com/users/fpChan/following{/other_user}",
    "gists_url": "https://api.github.com/users/fpChan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fpChan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fpChan/subscriptions",
    "organizations_url": "https://api.github.com/users/fpChan/orgs",
    "repos_url": "https://api.github.com/users/fpChan/repos",
    "events_url": "https://api.github.com/users/fpChan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fpChan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-11-26T03:54:03Z",
  "updated_at": "2023-11-27T13:41:08Z",
  "closed_at": "2023-11-27T13:41:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\n 0.2.0 (3e12d88 2023-11-17T00:33:21.440760000Z)\n\n### What command(s) is the bug in?\n\n--via-ir\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\n## source code\r\n```sol\r\n        uint256 startAt = block.timestamp;\r\n        console2.log(\"startAt %d now %d\", startAt, block.timestamp);\r\n        vm.warp(startAt + 1 days);\r\n        console2.log(\"startAt %d now %d\", startAt, block.timestamp);\r\n```\r\n\r\n## run without --via-ir\r\n`forge test --match-contract CounterTest  -vv`\r\nThe result meets expectations.\r\n```\r\nLogs:\r\n  startAt 1 now 1\r\n  startAt 1 now 86401\r\n```\r\n\r\n## run with --via-ir\r\n`forge test --match-contract CounterTest  -vv  --via-ir`\r\nThe result does not meet expectations.\r\n```\r\nLogs:\r\n  startAt 1 now 1\r\n  startAt 86401 now 86401\r\n```\r\n\r\n<img width=\"792\" alt=\"image\" src=\"https://github.com/foundry-rs/foundry/assets/29588923/efa34624-585f-423a-828f-5b7894a365e9\">\r\n\r\n",
  "closed_by": {
    "login": "Evalir",
    "id": 26014927,
    "node_id": "MDQ6VXNlcjI2MDE0OTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Evalir",
    "html_url": "https://github.com/Evalir",
    "followers_url": "https://api.github.com/users/Evalir/followers",
    "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
    "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
    "organizations_url": "https://api.github.com/users/Evalir/orgs",
    "repos_url": "https://api.github.com/users/Evalir/repos",
    "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Evalir/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1827854918",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6430#issuecomment-1827854918",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6430",
    "id": 1827854918,
    "node_id": "IC_kwDOGBlvNc5s8tpG",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-27T13:41:07Z",
    "updated_at": "2023-11-27T13:41:07Z",
    "author_association": "MEMBER",
    "body": "`--via-ir` introduces quite a few optimizations which can make a lot of things, including sourcemaps, innacurate. What you're seeing is your code being optimized in the logs. You can disable certain optimizations for IR compilation, but in general we recommend running tests without ir. See https://github.com/ethereum/solidity/issues/12533",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1827854918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
