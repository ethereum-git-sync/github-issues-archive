{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5860",
  "id": 1904098816,
  "node_id": "I_kwDOGBlvNc5xfj4A",
  "number": 5860,
  "title": "Crashed while testing transferFrom: called `Option::unwrap()` on a `None` value",
  "user": {
    "login": "x1250",
    "id": 8151891,
    "node_id": "MDQ6VXNlcjgxNTE4OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8151891?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/x1250",
    "html_url": "https://github.com/x1250",
    "followers_url": "https://api.github.com/users/x1250/followers",
    "following_url": "https://api.github.com/users/x1250/following{/other_user}",
    "gists_url": "https://api.github.com/users/x1250/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/x1250/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/x1250/subscriptions",
    "organizations_url": "https://api.github.com/users/x1250/orgs",
    "repos_url": "https://api.github.com/users/x1250/repos",
    "events_url": "https://api.github.com/users/x1250/events{/privacy}",
    "received_events_url": "https://api.github.com/users/x1250/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-09-20T04:22:56Z",
  "updated_at": "2023-09-20T04:29:00Z",
  "closed_at": "2023-09-20T04:28:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [ ] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (135ee3e 2022-12-29T00:04:02.850095146Z)\n\n### What command(s) is the bug in?\n\nforge test -vvv --fork-url https://bsc-dataseed.binance.org/ --fork-block-number 31596150 --debug testTransferFromWithoutTax\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nThis test fails:\r\n\r\n  function testTransferFromWithoutTax() public {\r\n    uint256 allowanceAmount = 500 * 10**18;\r\n    uint256 transferAmount = 200 * 10**18;\r\n\r\n    // Bob aprueba un allowance para carol\r\n    token.approve(carol, allowanceAmount);\r\n\r\n    uint256 initialBalanceBob = token.balanceOf(bob);\r\n    uint256 initialBalanceCarol = token.balanceOf(carol);\r\n\r\n    vm.stopPrank();\r\n    vm.startPrank(carol);\r\n    // Carol transfers from Bob\r\n    token.transferFrom(bob, carol, transferAmount);\r\n    vm.stopPrank();\r\n\r\n    uint256 finalBalanceBob = token.balanceOf(bob);\r\n    uint256 finalBalanceCarol = token.balanceOf(carol);\r\n\r\n    require(finalBalanceBob == initialBalanceBob - transferAmount, \"BOB_WRONG_FINAL_BALANCE\");\r\n    require(finalBalanceCarol == initialBalanceCarol + transferAmount, \"CAROL_WRONG_FINAL_BALANCE\");\r\n  }\r\n\r\n\r\n$ RUST_BACKTRACE=1 forge test -vvv --fork-url https://bsc-dataseed.binance.org/ --fork-block-number 31596150 --debug testTransferFromWithoutTax\r\n[⠢] Compiling...\r\nNo files changed, compilation skipped\r\n2023-09-20T04:18:36.536211Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38, \r\n(code: -32000, message: missing trie node, data: None)) address=0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38\r\n2023-09-20T04:18:36.536272Z ERROR forge::multi_runner: error=Failed to get account for 0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38: 0x1804c8ab1f12e6bbf3894d4083f33e07309d1f38\r\nThe application panicked (crashed).\r\nMessage:  called `Option::unwrap()` on a `None` value\r\nLocation: cli/src/cmd/forge/test/mod.rs:185\r\n\r\nThis is a bug. Consider reporting it at https://github.com/foundry-rs/foundry\r\n\r\n  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\r\n   1: __libc_start_call_main<unknown>\r\n      at ./csu/../sysdeps/nptl/libc_start_call_main.h:58\r\n   2: __libc_start_main_impl<unknown>\r\n      at ./csu/../csu/libc-start.c:392\r\n\r\nRun with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering.\r\nRun with RUST_BACKTRACE=full to include source snippets.\r\n",
  "closed_by": {
    "login": "Evalir",
    "id": 26014927,
    "node_id": "MDQ6VXNlcjI2MDE0OTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Evalir",
    "html_url": "https://github.com/Evalir",
    "followers_url": "https://api.github.com/users/Evalir/followers",
    "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
    "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
    "organizations_url": "https://api.github.com/users/Evalir/orgs",
    "repos_url": "https://api.github.com/users/Evalir/repos",
    "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Evalir/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1726947890",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5860#issuecomment-1726947890",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5860",
    "id": 1726947890,
    "node_id": "IC_kwDOGBlvNc5m7yIy",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-20T04:28:32Z",
    "updated_at": "2023-09-20T04:29:00Z",
    "author_association": "MEMBER",
    "body": "Hi! Thanks for reporting. Sadly though, this is an RPC issue and somewhat common when using bsc endpoints—we'd recommend using more reliable ones and make sure you can historically query and replay the block you're targeting.\r\n\r\nClosing as not a bug, but a common chain-specific quirk.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1726947890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
