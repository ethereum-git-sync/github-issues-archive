{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2275",
  "id": 1301825821,
  "node_id": "I_kwDOGBlvNc5NmEkd",
  "number": 2275,
  "title": "YulException on deal in --via-ir mode",
  "user": {
    "login": "sakulstra",
    "id": 4396533,
    "node_id": "MDQ6VXNlcjQzOTY1MzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sakulstra",
    "html_url": "https://github.com/sakulstra",
    "followers_url": "https://api.github.com/users/sakulstra/followers",
    "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
    "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
    "organizations_url": "https://api.github.com/users/sakulstra/orgs",
    "repos_url": "https://api.github.com/users/sakulstra/repos",
    "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sakulstra/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3777098561,
      "node_id": "LA_kwDOGBlvNc7hIfNB",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-build",
      "name": "Cmd-forge-build",
      "color": "006B75",
      "default": false,
      "description": "Command: forge build"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2022-07-12T09:56:36Z",
  "updated_at": "2022-08-11T19:21:41Z",
  "closed_at": "2022-08-11T19:21:41Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nfoundryup: installed - forge 0.2.0 (7bc3e60 2022-07-12T00:04:40.748127213Z) foundryup: installed - cast 0.2.0 (7bc3e60 2022-07-12T00:04:40.748127213Z) foundryup: installed - anvil 0.1.0 (7bc3e60 2022-07-12T00:04:40.766134156Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge test --via-ir  --rpc-url=${MAINNET_RPC}\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\nHey, i'm trying to deal some DAI to an address in `--via-ir` mode (not sure if that's related)\r\n\r\nBut if i `deal(DAI, DAI_WHALE, 10000 ether);` it breaks with:\r\n```sh\r\nforge test -vvv --rpc-url=${MAINNET_RPC} --fork-block-number 15008553 --via-ir\r\n[⠊] Compiling...\r\n[⠒] Compiling 1 files with 0.8.11\r\n[⠰] Solc 0.8.11 finished in 24.11s\r\nError: \r\nCompiler run failed\r\nYulException: Variable _2 is 1 too deep in the stack [ _2 expr_mpos_3 _6 _18 _1 _16 expr_component_mpos_1 _10 RET var_ins_mpos _4 _7 _3 _14 var_i expr_1 _27 ]\r\n\r\n\r\n\r\nmake: *** [Makefile:10: test] Error 1\r\n```\r\n\r\nInterestingly when i change the code to first deal ETH it compiles.\r\n```\r\naddress internal constant DAI = 0x6B175474E89094C44Da98b954EedeAC495271d0F;\r\naddress internal constant DAI_WHALE = 0xbEbc44782C7dB0a1A60Cb6fe97d0b483032FF1C7;\r\n\r\nfunction setUp() public {\r\n       deal(DAI_WHALE, 10000 ether);\r\n       deal(DAI, DAI_WHALE, 10000 ether);\r\n}\r\n```",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1181760219",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1181760219",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1181760219,
    "node_id": "IC_kwDOGBlvNc5GcDrb",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-12T13:27:21Z",
    "updated_at": "2022-07-12T13:27:21Z",
    "author_association": "MEMBER",
    "body": "hmm this a solc error, not too familiar with stack limitations with `--via-ir`, \r\nmaybe this is some yul weirdness where the variable needs to be loaded first separately @onbjerg ?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1181760219/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182844111",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1182844111",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1182844111,
    "node_id": "IC_kwDOGBlvNc5GgMTP",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T07:04:00Z",
    "updated_at": "2022-07-13T07:04:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "try adding the `--optimize` flag to your command and see if it still happens @sakulstra ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182844111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182948495",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1182948495",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1182948495,
    "node_id": "IC_kwDOGBlvNc5GglyP",
    "user": {
      "login": "sakulstra",
      "id": 4396533,
      "node_id": "MDQ6VXNlcjQzOTY1MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sakulstra",
      "html_url": "https://github.com/sakulstra",
      "followers_url": "https://api.github.com/users/sakulstra/followers",
      "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
      "organizations_url": "https://api.github.com/users/sakulstra/orgs",
      "repos_url": "https://api.github.com/users/sakulstra/repos",
      "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sakulstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T08:50:00Z",
    "updated_at": "2022-07-13T08:50:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sambacha same error as before\r\n```\r\nforge test -vv --rpc-url=${mainnetrpc} --fork-block-number 15127191 --via-ir --optimize\r\n[⠊] Compiling...\r\n[⠑] Compiling 1 files with 0.8.11\r\n[⠊] Solc 0.8.11 finished in 26.68s\r\nError: \r\nCompiler run failed\r\nYulException: Variable _2 is 1 too deep in the stack [ _2 expr_mpos_3 _6 _18 _1 _16 expr_component_mpos_1 _10 RET var_ins_mpos _4 _7 _3 _14 var_i expr_1 _27 ]\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182948495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182952325",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1182952325",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1182952325,
    "node_id": "IC_kwDOGBlvNc5GgmuF",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T08:53:53Z",
    "updated_at": "2022-07-13T08:53:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @sambacha same error as before\r\n> \r\n> ```\r\n> forge test -vv --rpc-url=${mainnetrpc} --fork-block-number 15127191 --via-ir --optimize\r\n> [⠊] Compiling...\r\n> [⠑] Compiling 1 files with 0.8.11\r\n> [⠊] Solc 0.8.11 finished in 26.68s\r\n> Error: \r\n> Compiler run failed\r\n> YulException: Variable _2 is 1 too deep in the stack [ _2 expr_mpos_3 _6 _18 _1 _16 expr_component_mpos_1 _10 RET var_ins_mpos _4 _7 _3 _14 var_i expr_1 _27 ]\r\n> ```\r\n\r\nOK, I should have just linked this, https://github.com/foundry-rs/book/pull/443/files#diff-9d6a4ff29353827a267f01dc126bbf4f7d547a68a3fe000919fa6708185602ecR169-R176 \r\n\r\n>**Note**    \r\n> If you encounter compiler errors when using `via_ir`, explicitly enable the legacy `optimizer` and leave `optimizerSteps` as an empty string\r\n```toml\r\nvia_ir = true\r\noptimizerSteps = ''\r\noptimizer = true\r\n```\r\nyou may have to define `optimizerSteps = '' ` in your toml config as well. In fact try just defining those under the TOML config and running `forge test -vv --rpc-url=${mainnetrpc} --fork-block-number 15127191 `\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182952325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182974408",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1182974408",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1182974408,
    "node_id": "IC_kwDOGBlvNc5GgsHI",
    "user": {
      "login": "sakulstra",
      "id": 4396533,
      "node_id": "MDQ6VXNlcjQzOTY1MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sakulstra",
      "html_url": "https://github.com/sakulstra",
      "followers_url": "https://api.github.com/users/sakulstra/followers",
      "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
      "organizations_url": "https://api.github.com/users/sakulstra/orgs",
      "repos_url": "https://api.github.com/users/sakulstra/repos",
      "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sakulstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T09:15:03Z",
    "updated_at": "2022-07-13T09:15:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sambacha added\r\n```\r\n[default]\r\noptimizer = true\r\noptimizer_runs = 200\r\nlibs = ['lib']\r\nvia_ir = true\r\noptimizerSteps = ''\r\n```\r\nbut still i get the exact same error",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182974408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182977300",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1182977300",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1182977300,
    "node_id": "IC_kwDOGBlvNc5Ggs0U",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T09:17:31Z",
    "updated_at": "2022-07-13T09:17:31Z",
    "author_association": "MEMBER",
    "body": "the optimizerSteps are configured like this:\r\n\r\nhttps://book.getfoundry.sh/reference/forge/forge-build.html?highlight=optimizerSteps#additional-optimizer-settings",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1182977300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1183002879",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1183002879",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1183002879,
    "node_id": "IC_kwDOGBlvNc5GgzD_",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T09:41:35Z",
    "updated_at": "2022-07-13T09:41:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "> the optimizerSteps are configured like this:\n> \n> \n> \n> https://book.getfoundry.sh/reference/forge/forge-build.html?highlight=optimizerSteps#additional-optimizer-settings\n\nIn the link to the updated book there is a link to a twitter thread where the empty string for the selection is recommended ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1183002879/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1183003432",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1183003432",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1183003432,
    "node_id": "IC_kwDOGBlvNc5GgzMo",
    "user": {
      "login": "sakulstra",
      "id": 4396533,
      "node_id": "MDQ6VXNlcjQzOTY1MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4396533?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sakulstra",
      "html_url": "https://github.com/sakulstra",
      "followers_url": "https://api.github.com/users/sakulstra/followers",
      "following_url": "https://api.github.com/users/sakulstra/following{/other_user}",
      "gists_url": "https://api.github.com/users/sakulstra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sakulstra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sakulstra/subscriptions",
      "organizations_url": "https://api.github.com/users/sakulstra/orgs",
      "repos_url": "https://api.github.com/users/sakulstra/repos",
      "events_url": "https://api.github.com/users/sakulstra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sakulstra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T09:42:08Z",
    "updated_at": "2022-07-13T09:45:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mattsse In fact i am now getting different errors which i guess is a good sign:\r\n```\r\nforge test -vvv --rpc-url=<> --fork-block-number 15127191 --via-ir\r\n[⠊] Compiling...\r\n[⠒] Compiling 47 files with 0.8.11\r\n[⠢] Compiling 3 files with 0.8.10\r\n[⠆] Compiling 4 files with 0.6.12\r\n[⠢] Solc 0.8.10 finished in 24.33ms\r\n[⠔] Solc 0.6.12 finished in 857.64ms\r\n[⠊] Solc 0.8.11 finished in 7.05s\r\nError: \r\nCompiler run failed\r\nYulException: Cannot swap Slot JUNK with Slot RET: too deep in the stack by 1 slots in [ JUNK RET[read_from_storage_split_offset_uint256] _2 expr_19204_component_1_mpos expr_19170_address RET[finalize_allocation] var_ins_19123_mpos _6 _4 var_self_19099_slot _5 _7 _3 _1 _8 var_i expr_11 RET ]\r\n```\r\n\r\nWhen i completely disable the optimizer it will result in:\r\n```\r\nError: \r\nCompiler run failed\r\nYulException: Variable var_m_7723_mpos is 7 slot(s) too deep inside the stack.\r\n```\r\n\r\nHonestly for me the workaround with first dealing eth is good enough for now :sweat_smile: \r\nHere's a reproduction: https://github.com/bgd-labs/example-aave-v2-listing/tree/fix/proposal-fix",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1183003432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212393725",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2275#issuecomment-1212393725",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2275",
    "id": 1212393725,
    "node_id": "IC_kwDOGBlvNc5IQ6j9",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-11T19:21:41Z",
    "updated_at": "2022-08-11T19:21:41Z",
    "author_association": "MEMBER",
    "body": "Closing since I don't think we can do anything about stack to deep errors even in the Yul IR optimizer mode, other than maybe refactor how `deal` works, but that is in the Forge Std repository. Let me know if I am wrong here and I will reopen",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212393725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
