{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1411",
  "id": 1214419107,
  "node_id": "I_kwDOGBlvNc5IYpCj",
  "number": 1411,
  "title": "forge init fails in Docker container due to lack of Git",
  "user": {
    "login": "kacperzuk",
    "id": 7718341,
    "node_id": "MDQ6VXNlcjc3MTgzNDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7718341?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kacperzuk",
    "html_url": "https://github.com/kacperzuk",
    "followers_url": "https://api.github.com/users/kacperzuk/followers",
    "following_url": "https://api.github.com/users/kacperzuk/following{/other_user}",
    "gists_url": "https://api.github.com/users/kacperzuk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kacperzuk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kacperzuk/subscriptions",
    "organizations_url": "https://api.github.com/users/kacperzuk/orgs",
    "repos_url": "https://api.github.com/users/kacperzuk/repos",
    "events_url": "https://api.github.com/users/kacperzuk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kacperzuk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3334394235,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjM1",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "0052CC",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 3756509527,
      "node_id": "LA_kwDOGBlvNc7f58lX",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-releases",
      "name": "A-releases",
      "color": "FBCA04",
      "default": false,
      "description": "Area: releases/packaging"
    },
    {
      "id": 3759719580,
      "node_id": "LA_kwDOGBlvNc7gGMSc",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/P-normal",
      "name": "P-normal",
      "color": "D93F0B",
      "default": false,
      "description": "Priority: normal"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-04-25T12:15:27Z",
  "updated_at": "2022-04-28T02:28:14Z",
  "closed_at": "2022-04-28T02:28:14Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge, Other (please describe)\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [ ] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (5490c4a 2022-04-25T10:46:12.972666458+00:00) \r\n\r\n### What command(s) is the bug in?\r\n\r\nforge init\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\nI've built foundry Docker image from `master` branch (5490c4a0fef0a83827e4d5642730ea9ceff641b2) using:\r\n```\r\ndocker build -t foundry:latest .\r\n```\r\n\r\nHowever, this image fails on `forge init`:\r\n```\r\n> docker run foundry \"forge init --no-git /test\"\r\nInitializing /test...\r\nInstalling ds-test in \"/test/lib/ds-test\", (url: https://github.com/dapphub/ds-test, tag: None)\r\nError:\r\n   0: No such file or directory (os error 2)\r\n\r\nLocation:\r\n   cli/src/cmd/forge/install.rs:107\r\n\r\nBacktrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it.\r\nRun with RUST_BACKTRACE=full to include source snippets.\r\n```\r\n\r\nThis is due to `forge init` trying to run `git`, which is missing in the image. After this patch to Dockerfile it works correctly:\r\n```\r\n--- Dockerfile  2022-04-25 13:30:16.624326460 +0200\r\n+++ Dockerfile-git      2022-04-25 13:30:45.170368985 +0200\r\n@@ -15,10 +15,10 @@\r\n ENV GLIBC_KEY_FILE=/etc/apk/keys/sgerrand.rsa.pub\r\n ENV GLIBC_RELEASE=https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.35-r0/glibc-2.35-r0.apk\r\n\r\n-RUN apk add linux-headers gcompat\r\n+RUN apk add linux-headers gcompat git\r\n RUN wget -q -O ${GLIBC_KEY_FILE} ${GLIBC_KEY} \\\r\n     && wget -O glibc.apk ${GLIBC_RELEASE} \\\r\n     && apk add glibc.apk --force\r\n```\r\n\r\nThis patch still doesn't allow running init without `--no-git` due to unconfigured git, but I think this isn't something that is expected to work:\r\n```\r\nAuthor identity unknown\r\n\r\n*** Please tell me who you are.\r\n\r\nRun\r\n\r\n  git config --global user.email \"you@example.com\"\r\n  git config --global user.name \"Your Name\"\r\n\r\nto set your account's default identity.\r\nOmit --global to set the identity only in this repository.\r\n\r\nfatal: unable to auto-detect email address (got 'unknown@7a491a9c0095.(none)')\r\n```\r\n\r\nIs git not installed on purpose to reduce image size or is it something that's considered a bug? If it's on purpose, would it be a good idea to add a note about this to https://book.getfoundry.sh/tutorials/foundry-docker.html ? In either case I'd be happy to submit a PR.",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1109971672",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1411#issuecomment-1109971672",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411",
    "id": 1109971672,
    "node_id": "IC_kwDOGBlvNc5CKNLY",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-26T15:58:24Z",
    "updated_at": "2022-04-26T15:58:24Z",
    "author_association": "MEMBER",
    "body": "I think packaging git is fine personally, so supportive of a PR for that, should be simple. We probably just forgot ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1109971672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1110544928",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1411#issuecomment-1110544928",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411",
    "id": 1110544928,
    "node_id": "IC_kwDOGBlvNc5CMZIg",
    "user": {
      "login": "dmfxyz",
      "id": 100147743,
      "node_id": "U_kgDOBfgiHw",
      "avatar_url": "https://avatars.githubusercontent.com/u/100147743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dmfxyz",
      "html_url": "https://github.com/dmfxyz",
      "followers_url": "https://api.github.com/users/dmfxyz/followers",
      "following_url": "https://api.github.com/users/dmfxyz/following{/other_user}",
      "gists_url": "https://api.github.com/users/dmfxyz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dmfxyz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dmfxyz/subscriptions",
      "organizations_url": "https://api.github.com/users/dmfxyz/orgs",
      "repos_url": "https://api.github.com/users/dmfxyz/repos",
      "events_url": "https://api.github.com/users/dmfxyz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dmfxyz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T05:05:30Z",
    "updated_at": "2022-04-27T05:08:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "I lean a bit the other way and think that git should remain excluded from the base image build.  I don't see a use-case except when users should already be extending the image. For example:\r\n```\r\ndocker run foundry \"forge init --no-git /test\"\r\n```\r\nunless I'm missing something, all this would do is init a repo and exit the docker container immediately. \r\n\r\nPreferred usage pattern for developing within Docker would be one of two things:\r\n- Mount the local filesystem to Docker\r\n- Build a development image off of the base image and install any dependencies needed\r\n\r\nIf you look at, say, the `rust:alpine` or `python:alpine` images, they do not ship with git. I don't lean too strongly, but would advise against. Happy to add documentation to the book page.\r\n \r\nEDIT: Perhaps this is motivation to add a Development focused image that's built on ubuntu or another distro, and include git there, while keeping the alpine image as tidy as possible for production use.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1110544928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1110663875",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1411#issuecomment-1110663875",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411",
    "id": 1110663875,
    "node_id": "IC_kwDOGBlvNc5CM2LD",
    "user": {
      "login": "kacperzuk",
      "id": 7718341,
      "node_id": "MDQ6VXNlcjc3MTgzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7718341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kacperzuk",
      "html_url": "https://github.com/kacperzuk",
      "followers_url": "https://api.github.com/users/kacperzuk/followers",
      "following_url": "https://api.github.com/users/kacperzuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/kacperzuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kacperzuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kacperzuk/subscriptions",
      "organizations_url": "https://api.github.com/users/kacperzuk/orgs",
      "repos_url": "https://api.github.com/users/kacperzuk/repos",
      "events_url": "https://api.github.com/users/kacperzuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kacperzuk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T07:47:46Z",
    "updated_at": "2022-04-27T07:47:46Z",
    "author_association": "NONE",
    "body": "@dmfxyz unfortunately `forge init --no-git /test` fails, as it still uses `git ls-remote` when installing dependencies:\r\n\r\n```\r\n> docker run foundry \"forge init --no-git /test\"\r\nInitializing /test...\r\nInstalling ds-test in \"/test/lib/ds-test\", (url: https://github.com/dapphub/ds-test, tag: None)\r\nError:\r\n   0: No such file or directory (os error 2)\r\n\r\nLocation:\r\n   cli/src/cmd/forge/install.rs:107\r\n\r\nBacktrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it.\r\nRun with RUST_BACKTRACE=full to include source snippets.\r\n```\r\n\r\nPersonally I agree that users should handle it themselves by building a new development image, it just makes sense to mention in the docs that git is required and not provided in ghcr.io/foundry-rs/foundry, given that the error message itself doesn't mention git.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1110663875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1111263868",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1411#issuecomment-1111263868",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411",
    "id": 1111263868,
    "node_id": "IC_kwDOGBlvNc5CPIp8",
    "user": {
      "login": "dmfxyz",
      "id": 100147743,
      "node_id": "U_kgDOBfgiHw",
      "avatar_url": "https://avatars.githubusercontent.com/u/100147743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dmfxyz",
      "html_url": "https://github.com/dmfxyz",
      "followers_url": "https://api.github.com/users/dmfxyz/followers",
      "following_url": "https://api.github.com/users/dmfxyz/following{/other_user}",
      "gists_url": "https://api.github.com/users/dmfxyz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dmfxyz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dmfxyz/subscriptions",
      "organizations_url": "https://api.github.com/users/dmfxyz/orgs",
      "repos_url": "https://api.github.com/users/dmfxyz/repos",
      "events_url": "https://api.github.com/users/dmfxyz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dmfxyz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T17:15:55Z",
    "updated_at": "2022-04-27T17:16:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "@kacperzuk cool, agree we should mention it in the book since the error is very nebulous. Thanks for calling it out. \n\nDo you want to make the PR into the foundry book? Otherwise I'm happy to do it. \n\n\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1111263868/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1111472557",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1411#issuecomment-1111472557",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1411",
    "id": 1111472557,
    "node_id": "IC_kwDOGBlvNc5CP7mt",
    "user": {
      "login": "dmfxyz",
      "id": 100147743,
      "node_id": "U_kgDOBfgiHw",
      "avatar_url": "https://avatars.githubusercontent.com/u/100147743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dmfxyz",
      "html_url": "https://github.com/dmfxyz",
      "followers_url": "https://api.github.com/users/dmfxyz/followers",
      "following_url": "https://api.github.com/users/dmfxyz/following{/other_user}",
      "gists_url": "https://api.github.com/users/dmfxyz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dmfxyz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dmfxyz/subscriptions",
      "organizations_url": "https://api.github.com/users/dmfxyz/orgs",
      "repos_url": "https://api.github.com/users/dmfxyz/repos",
      "events_url": "https://api.github.com/users/dmfxyz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dmfxyz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T20:52:24Z",
    "updated_at": "2022-04-27T20:52:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here: https://github.com/foundry-rs/book/pull/245, I think we can close once this is merged.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1111472557/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
