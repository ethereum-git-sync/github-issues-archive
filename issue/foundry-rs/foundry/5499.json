{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5499",
  "id": 1827069229,
  "node_id": "I_kwDOGBlvNc5s5t0t",
  "number": 5499,
  "title": "perf: `anvil_mine` is much slower than `hardhat_mine`",
  "user": {
    "login": "fp-crypto",
    "id": 83050944,
    "node_id": "MDQ6VXNlcjgzMDUwOTQ0",
    "avatar_url": "https://avatars.githubusercontent.com/u/83050944?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fp-crypto",
    "html_url": "https://github.com/fp-crypto",
    "followers_url": "https://api.github.com/users/fp-crypto/followers",
    "following_url": "https://api.github.com/users/fp-crypto/following{/other_user}",
    "gists_url": "https://api.github.com/users/fp-crypto/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fp-crypto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fp-crypto/subscriptions",
    "organizations_url": "https://api.github.com/users/fp-crypto/orgs",
    "repos_url": "https://api.github.com/users/fp-crypto/repos",
    "events_url": "https://api.github.com/users/fp-crypto/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fp-crypto/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-07-28T20:46:47Z",
  "updated_at": "2023-08-03T08:07:34Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I attempted to move my testing from `hardhat node` to `anvil`. Some of my testing requires mining a large number of blocks. `anvil_mine` execution time seems to scale linearly relative to block count, whereas `hardhat_mine` with `hardhat node` is nearly constant. See the following benchmarks:\r\n\r\n#### Anvil\r\n```Python\r\nIn [1]: import timeit\r\n\r\nIn [2]: [timeit.timeit(stmt=(f'chain.mine({i})'), globals=globals(), number=50) for i in [1, 1\r\n   ...: 0, 100, 1000]]\r\nOut[2]:\r\n[0.07101033299113624,\r\n 0.39050891700026114,\r\n 6.034164124997915,\r\n 276.3122650830046]\r\n```\r\n\r\n#### Hardhat\r\n```Python\r\nIn [1]: import timeit\r\n\r\nIn [2]: [timeit.timeit(stmt=(f'chain.mine({i})'), globals=globals(), number=50) for i in [1, 1\r\n   ...: 0, 100, 1000]]\r\nOut[2]:\r\n[0.10906625000643544,\r\n 0.09370395800215192,\r\n 0.0902477499912493,\r\n 0.08129970800655428]\r\n```\r\n\r\nI'm using:\r\n* `anvil 0.1.0 (0e33b3e 2023-07-26T00:26:08.161934000Z)`\r\n* `hardhat 9.6.7`\r\n* `ape 0.6.14` (for testing)\r\n\r\n\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/41bae8e6265e905f73c3f4eac14a5ba9275417a4/anvil/src/eth/api.rs#L1421-L1440",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1663487217",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5499#issuecomment-1663487217",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5499",
    "id": 1663487217,
    "node_id": "IC_kwDOGBlvNc5jJszx",
    "user": {
      "login": "fvictorio",
      "id": 417134,
      "node_id": "MDQ6VXNlcjQxNzEzNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417134?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fvictorio",
      "html_url": "https://github.com/fvictorio",
      "followers_url": "https://api.github.com/users/fvictorio/followers",
      "following_url": "https://api.github.com/users/fvictorio/following{/other_user}",
      "gists_url": "https://api.github.com/users/fvictorio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fvictorio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fvictorio/subscriptions",
      "organizations_url": "https://api.github.com/users/fvictorio/orgs",
      "repos_url": "https://api.github.com/users/fvictorio/repos",
      "events_url": "https://api.github.com/users/fvictorio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fvictorio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T08:07:34Z",
    "updated_at": "2023-08-03T08:07:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "The reason Hardhat's time is constant is that when more than N blocks are mined (I don't remember the value of N) they are not actually mined. Instead, a fake range of blocks is created and then the last ones are actually mined. This means that the hash of the latest block is kind of fake, but that's an acceptable trade-off.\r\n\r\nThere are some non-obvious things to keep in mind to implement this approach though. Happy to share them here if someone is interested in implementing this in Anvil.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1663487217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
