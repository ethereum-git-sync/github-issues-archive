{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1285",
  "id": 1202737155,
  "node_id": "I_kwDOGBlvNc5HsFAD",
  "number": 1285,
  "title": "flaky unit tests: cast::finds_block and config::can_extract_config_values",
  "user": {
    "login": "dcposch",
    "id": 169280,
    "node_id": "MDQ6VXNlcjE2OTI4MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/169280?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dcposch",
    "html_url": "https://github.com/dcposch",
    "followers_url": "https://api.github.com/users/dcposch/followers",
    "following_url": "https://api.github.com/users/dcposch/following{/other_user}",
    "gists_url": "https://api.github.com/users/dcposch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dcposch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dcposch/subscriptions",
    "organizations_url": "https://api.github.com/users/dcposch/orgs",
    "repos_url": "https://api.github.com/users/dcposch/repos",
    "events_url": "https://api.github.com/users/dcposch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dcposch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3746533612,
      "node_id": "LA_kwDOGBlvNc7fT5Ds",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-meta",
      "name": "T-meta",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: meta"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-04-13T04:26:47Z",
  "updated_at": "2022-06-21T08:03:56Z",
  "closed_at": "2022-06-21T08:03:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nCast\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\n64087b5\n\n### What command(s) is the bug in?\n\ncargo test\n\n### Operating System\n\nmacOS (amd)\n\n### Describe the bug\n\nI just forked foundry to make my first PR.\r\n\r\nThe contributor guide is useful. However, on a fresh checkout, two of the unit tests fail:\r\n\r\n```\r\n$ cargo --version\r\ncargo 1.59.0 (49d8809dc 2022-02-10)\r\n$ git log -n1 --oneline\r\n64087b5\r\n```\r\n\r\nrunning tests:\r\n\r\n```\r\n$ RUST_BACKTRACE=1 cargo test\r\n\r\n[...]\r\n\r\nfailures:\r\n    cast::finds_block\r\n    config::can_extract_config_values\r\n\r\ntest result: FAILED. 36 passed; 2 failed\r\n```\r\n\r\ndetails below.",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097544880",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1285#issuecomment-1097544880",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
    "id": 1097544880,
    "node_id": "IC_kwDOGBlvNc5BazSw",
    "user": {
      "login": "dcposch",
      "id": 169280,
      "node_id": "MDQ6VXNlcjE2OTI4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/169280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcposch",
      "html_url": "https://github.com/dcposch",
      "followers_url": "https://api.github.com/users/dcposch/followers",
      "following_url": "https://api.github.com/users/dcposch/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcposch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcposch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcposch/subscriptions",
      "organizations_url": "https://api.github.com/users/dcposch/orgs",
      "repos_url": "https://api.github.com/users/dcposch/repos",
      "events_url": "https://api.github.com/users/dcposch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcposch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-13T04:32:10Z",
    "updated_at": "2022-04-13T23:28:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "### `config::can_extract_config_values` fails if `ETHERSCAN_API_KEY` is set\r\n\r\nsee https://github.com/gakonst/foundry/blob/64087b59c0ac9abb4b5e04d8c84e8bab47f4c6c3/cli/tests/it/config.rs#L71\r\n\r\ndiffing the test error message:\r\n\r\n```\r\n< etherscan_api_key: Some(\"...\"),\r\n---\r\n> etherscan_api_key: None,\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097544880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097551520",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1285#issuecomment-1097551520",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
    "id": 1097551520,
    "node_id": "IC_kwDOGBlvNc5Ba06g",
    "user": {
      "login": "dcposch",
      "id": 169280,
      "node_id": "MDQ6VXNlcjE2OTI4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/169280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcposch",
      "html_url": "https://github.com/dcposch",
      "followers_url": "https://api.github.com/users/dcposch/followers",
      "following_url": "https://api.github.com/users/dcposch/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcposch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcposch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcposch/subscriptions",
      "organizations_url": "https://api.github.com/users/dcposch/orgs",
      "repos_url": "https://api.github.com/users/dcposch/repos",
      "events_url": "https://api.github.com/users/dcposch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcposch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-13T04:44:31Z",
    "updated_at": "2022-04-13T23:28:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "### `cast::finds_block` fails if `ETH_RPC_URL` is set\r\n\r\nlooks like the test skips by default\r\n\r\nhttps://github.com/gakonst/foundry/blob/64087b59c0ac9abb4b5e04d8c84e8bab47f4c6c3/cli/tests/it/cast.rs#L12-L15\r\n\r\nwhen an RPC endpoint is set, it tries to find a block by timestamp.\r\n\r\ni cant get that to work even when running the test manually using the released binaries. is `cast find-block` working?\r\n\r\n```\r\n$  cast find-block --rpc-url <valid RPC URL> 1647843609\r\n1 \r\n```\r\n\r\nthis should print `6574364`, the block number closest to that timestamp.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097551520/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097552801",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1285#issuecomment-1097552801",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
    "id": 1097552801,
    "node_id": "IC_kwDOGBlvNc5Ba1Oh",
    "user": {
      "login": "dcposch",
      "id": 169280,
      "node_id": "MDQ6VXNlcjE2OTI4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/169280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcposch",
      "html_url": "https://github.com/dcposch",
      "followers_url": "https://api.github.com/users/dcposch/followers",
      "following_url": "https://api.github.com/users/dcposch/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcposch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcposch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcposch/subscriptions",
      "organizations_url": "https://api.github.com/users/dcposch/orgs",
      "repos_url": "https://api.github.com/users/dcposch/repos",
      "events_url": "https://api.github.com/users/dcposch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcposch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-13T04:47:30Z",
    "updated_at": "2022-04-13T04:47:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "after removing those two env variables, tests pass. this is not necessarily a bug, but seems fragile.\r\n\r\noverall the new developer experience seems good to me.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097552801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097822027",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1285#issuecomment-1097822027",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
    "id": 1097822027,
    "node_id": "IC_kwDOGBlvNc5Bb29L",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-13T09:42:42Z",
    "updated_at": "2022-04-13T09:42:42Z",
    "author_association": "MEMBER",
    "body": "Re `cast::finds_block` it actually skips if `ETH_RPC_URL` is *unset*, not if it is set. The intention is that you can run unit tests and integration tests that do not touch an RPC without failing the entire test suite locally\r\n\r\nIn CI these tests are ran in separate workflow jobs with their own configuration set",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1097822027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1098571879",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1285#issuecomment-1098571879",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
    "id": 1098571879,
    "node_id": "IC_kwDOGBlvNc5BeuBn",
    "user": {
      "login": "dcposch",
      "id": 169280,
      "node_id": "MDQ6VXNlcjE2OTI4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/169280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dcposch",
      "html_url": "https://github.com/dcposch",
      "followers_url": "https://api.github.com/users/dcposch/followers",
      "following_url": "https://api.github.com/users/dcposch/following{/other_user}",
      "gists_url": "https://api.github.com/users/dcposch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dcposch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dcposch/subscriptions",
      "organizations_url": "https://api.github.com/users/dcposch/orgs",
      "repos_url": "https://api.github.com/users/dcposch/repos",
      "events_url": "https://api.github.com/users/dcposch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dcposch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-13T23:28:00Z",
    "updated_at": "2022-04-13T23:28:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@onbjerg yes, i should've phrased it more clearly. if `ETH_RPC_URL` is set, then the unit tests fail bc of an issue in finds_block. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1098571879/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1161402212",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1285#issuecomment-1161402212",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1285",
    "id": 1161402212,
    "node_id": "IC_kwDOGBlvNc5FOZdk",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-21T08:03:56Z",
    "updated_at": "2022-06-21T08:03:56Z",
    "author_association": "MEMBER",
    "body": "I don't think this is the case anymore, so I'm closing it. Feel free to ping if this is not the case :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1161402212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
