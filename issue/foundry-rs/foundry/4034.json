{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4034",
  "id": 1519408601,
  "node_id": "I_kwDOGBlvNc5akFXZ",
  "number": 4034,
  "title": "forge flatten duplication of interfaces/contract names #262",
  "user": {
    "login": "gbalabasquer",
    "id": 12644398,
    "node_id": "MDQ6VXNlcjEyNjQ0Mzk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/12644398?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gbalabasquer",
    "html_url": "https://github.com/gbalabasquer",
    "followers_url": "https://api.github.com/users/gbalabasquer/followers",
    "following_url": "https://api.github.com/users/gbalabasquer/following{/other_user}",
    "gists_url": "https://api.github.com/users/gbalabasquer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gbalabasquer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gbalabasquer/subscriptions",
    "organizations_url": "https://api.github.com/users/gbalabasquer/orgs",
    "repos_url": "https://api.github.com/users/gbalabasquer/repos",
    "events_url": "https://api.github.com/users/gbalabasquer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gbalabasquer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-01-04T18:31:01Z",
  "updated_at": "2023-09-11T12:04:50Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [x] Foundry\n- [ ] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (a44159a 2023-01-02T00:04:45.597843Z)\n\n### What command(s) is the bug in?\n\nforge flatten\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\nWhen running `forge flatten <file>` in a project that the path of files includes multiple interfaces/contracts with the same name, the command can't solve the duplication and just generate the output with the same name repeated.\r\nFor example if running `forge flatten` command in this file: https://github.com/makerdao/spells-goerli/blob/solc-0.8/src/DssSpell.sol will generate the result with two `OracleLike` interfaces. `Hevm` would have produced `OracleLike_1` and `OracleLike_2` instead.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1384238561",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4034#issuecomment-1384238561",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
    "id": 1384238561,
    "node_id": "IC_kwDOGBlvNc5Sgc3h",
    "user": {
      "login": "gbalabasquer",
      "id": 12644398,
      "node_id": "MDQ6VXNlcjEyNjQ0Mzk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/12644398?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gbalabasquer",
      "html_url": "https://github.com/gbalabasquer",
      "followers_url": "https://api.github.com/users/gbalabasquer/followers",
      "following_url": "https://api.github.com/users/gbalabasquer/following{/other_user}",
      "gists_url": "https://api.github.com/users/gbalabasquer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gbalabasquer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gbalabasquer/subscriptions",
      "organizations_url": "https://api.github.com/users/gbalabasquer/orgs",
      "repos_url": "https://api.github.com/users/gbalabasquer/repos",
      "events_url": "https://api.github.com/users/gbalabasquer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gbalabasquer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-16T15:49:56Z",
    "updated_at": "2023-01-16T15:49:56Z",
    "author_association": "NONE",
    "body": "@mattsse @gakonst do you think this is something that could be addressed in the short term? It seems to be the only thing that's pending to do a full migration from dapp to forge in the Makerdao's spells repos. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1384238561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1505650868",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4034#issuecomment-1505650868",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
    "id": 1505650868,
    "node_id": "IC_kwDOGBlvNc5Zvmi0",
    "user": {
      "login": "The-Arbiter",
      "id": 103920908,
      "node_id": "U_kgDOBjG1DA",
      "avatar_url": "https://avatars.githubusercontent.com/u/103920908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/The-Arbiter",
      "html_url": "https://github.com/The-Arbiter",
      "followers_url": "https://api.github.com/users/The-Arbiter/followers",
      "following_url": "https://api.github.com/users/The-Arbiter/following{/other_user}",
      "gists_url": "https://api.github.com/users/The-Arbiter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/The-Arbiter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/The-Arbiter/subscriptions",
      "organizations_url": "https://api.github.com/users/The-Arbiter/orgs",
      "repos_url": "https://api.github.com/users/The-Arbiter/repos",
      "events_url": "https://api.github.com/users/The-Arbiter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/The-Arbiter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-12T17:23:36Z",
    "updated_at": "2023-04-12T17:23:36Z",
    "author_association": "NONE",
    "body": "Hi @gakonst @mattsse - our migration to forge is nearly complete, with the exception of this issue. \r\n\r\nFoundry needs to be able to rename interfaces in flattened contracts to prevent collisions.\r\n\r\nFor example, if we have `VatLike` in an imported contract and it will collide with a defined `VatLike` in the child contract, dapp will rename both of those to VatLike_1 and VatLike_2 and fix the references.\r\n\r\nFor example, [this contract](https://goerli.etherscan.io/address/0x8F6215237467f7E30bc841d14785A7B7b4eb5987#code) has the `LineMomLike` interface twice, so it turns into `LineMomLike_1` and `LineMomLike_2`.\r\n\r\nI've also been informed about Foundry flattening sometimes having issues due to duplicate licenses. Someone shared the following code snipped with me as they have said it fixes the issues most of the time:\r\n\r\n```\r\nremove-duplicate-licenses() {\r\n  awk '!(/SPDX/ && seen[$0]++)' $@\r\n}\r\n```\r\n\r\nI understand that this is a separate issue however I wanted to raise it here. I am aiming for us to migrate our spells to foundry before the end of the month - this is the last issue we are having at the moment.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1505650868/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1652691194",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4034#issuecomment-1652691194",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
    "id": 1652691194,
    "node_id": "IC_kwDOGBlvNc5ighD6",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-26T23:44:50Z",
    "updated_at": "2023-07-26T23:44:50Z",
    "author_association": "COLLABORATOR",
    "body": "@Evalir Just bumping this issue as it still seems to be present. Here's another repro for you:\r\n1. Clone https://github.com/scopelift/pooltogether-governor-upgrade/, install deps, and run `forge flatten src/PoolTogetherGovernor.sol > flat.sol`\r\n2. Run `solc flat.sol` and it errors due to duplicate definitions, i.e. forge is not flattening correctly",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1652691194/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1709929206",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4034#issuecomment-1709929206",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
    "id": 1709929206,
    "node_id": "IC_kwDOGBlvNc5l63L2",
    "user": {
      "login": "SidestreamSweatyPumpkin",
      "id": 132688698,
      "node_id": "U_kgDOB-irOg",
      "avatar_url": "https://avatars.githubusercontent.com/u/132688698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SidestreamSweatyPumpkin",
      "html_url": "https://github.com/SidestreamSweatyPumpkin",
      "followers_url": "https://api.github.com/users/SidestreamSweatyPumpkin/followers",
      "following_url": "https://api.github.com/users/SidestreamSweatyPumpkin/following{/other_user}",
      "gists_url": "https://api.github.com/users/SidestreamSweatyPumpkin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SidestreamSweatyPumpkin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SidestreamSweatyPumpkin/subscriptions",
      "organizations_url": "https://api.github.com/users/SidestreamSweatyPumpkin/orgs",
      "repos_url": "https://api.github.com/users/SidestreamSweatyPumpkin/repos",
      "events_url": "https://api.github.com/users/SidestreamSweatyPumpkin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SidestreamSweatyPumpkin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-07T10:45:44Z",
    "updated_at": "2023-09-07T10:45:44Z",
    "author_association": "NONE",
    "body": "It seems like the flattening breaks on the level of ethers-rs package and not in foundry. So The issue was also raised there: https://github.com/gakonst/ethers-rs/issues/2588",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1709929206/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1710086171",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4034#issuecomment-1710086171",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
    "id": 1710086171,
    "node_id": "IC_kwDOGBlvNc5l7dgb",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-07T12:42:38Z",
    "updated_at": "2023-09-07T12:42:38Z",
    "author_association": "MEMBER",
    "body": "fixing this properly would require resolving all imports/usages and renaming everything accordingly.\r\n\r\n> just generate the output with the same name repeated.\r\n\r\ndo you mean it generates the exact same interface twice, or does this happen when the project imports two identical interfaces?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1710086171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1713743288",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4034#issuecomment-1713743288",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4034",
    "id": 1713743288,
    "node_id": "IC_kwDOGBlvNc5mJaW4",
    "user": {
      "login": "SidestreamColdMelon",
      "id": 132689270,
      "node_id": "U_kgDOB-itdg",
      "avatar_url": "https://avatars.githubusercontent.com/u/132689270?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SidestreamColdMelon",
      "html_url": "https://github.com/SidestreamColdMelon",
      "followers_url": "https://api.github.com/users/SidestreamColdMelon/followers",
      "following_url": "https://api.github.com/users/SidestreamColdMelon/following{/other_user}",
      "gists_url": "https://api.github.com/users/SidestreamColdMelon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SidestreamColdMelon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SidestreamColdMelon/subscriptions",
      "organizations_url": "https://api.github.com/users/SidestreamColdMelon/orgs",
      "repos_url": "https://api.github.com/users/SidestreamColdMelon/repos",
      "events_url": "https://api.github.com/users/SidestreamColdMelon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SidestreamColdMelon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T12:04:50Z",
    "updated_at": "2023-09-11T12:04:50Z",
    "author_association": "NONE",
    "body": "> do you mean it generates the exact same interface twice, or does this happen when the project imports two identical interfaces?\r\n\r\nIt happens when project imports two interfaces with the same name (but they don't have to be identical besides the name). I think this external issue https://github.com/gakonst/ethers-rs/issues/2588 clearly outlines what happens. \r\n\r\nHere is the except from it:\r\n\r\n> For example: given two files `FileA` and `FileB`\r\n> \r\n> ```solidity\r\n> // FileA.sol\r\n> pragma solidity ^0.8.10;\r\n> import * as B from \"./FileB.sol\";\r\n> \r\n> interface FooBar {\r\n>     function foo() external;\r\n> }\r\n> contract A {\r\n>     function execute() external {\r\n>         FooBar(address(0)).foo();\r\n>     }\r\n> }\r\n> ```\r\n> \r\n> ```solidity\r\n> // FileB.sol\r\n> pragma solidity ^0.8.10;\r\n>\r\n> interface FooBar {\r\n>     function bar() external;\r\n> }\r\n> contract B {\r\n>     function execute() external {\r\n>         FooBar(address(0)).bar();\r\n>     }\r\n> }\r\n> ```\r\n> \r\n> Flattening will produce\r\n> \r\n> ```solidity\r\n> pragma solidity ^0.8.10;\r\n> \r\n> interface FooBar {\r\n>     function bar() external;\r\n> }\r\n> contract B {\r\n>     function execute() external {\r\n>         FooBar(address(0)).bar();\r\n>     }\r\n> }\r\n> \r\n> interface FooBar { // here we have a conflict with the interface declared above\r\n>     function foo() external;\r\n> }\r\n> contract A {\r\n>     function execute() external {\r\n>         FooBar(address(0)).foo();\r\n>     }\r\n> }\r\n> ```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1713743288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
