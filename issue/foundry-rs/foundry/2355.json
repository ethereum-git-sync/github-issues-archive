{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2355",
  "id": 1307034103,
  "node_id": "I_kwDOGBlvNc5N58H3",
  "number": 2355,
  "title": "`forge coverage` w/ hardhat",
  "user": {
    "login": "HrikB",
    "id": 23041116,
    "node_id": "MDQ6VXNlcjIzMDQxMTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/23041116?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/HrikB",
    "html_url": "https://github.com/HrikB",
    "followers_url": "https://api.github.com/users/HrikB/followers",
    "following_url": "https://api.github.com/users/HrikB/following{/other_user}",
    "gists_url": "https://api.github.com/users/HrikB/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/HrikB/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/HrikB/subscriptions",
    "organizations_url": "https://api.github.com/users/HrikB/orgs",
    "repos_url": "https://api.github.com/users/HrikB/repos",
    "events_url": "https://api.github.com/users/HrikB/events{/privacy}",
    "received_events_url": "https://api.github.com/users/HrikB/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-07-17T08:50:02Z",
  "updated_at": "2022-09-19T11:54:09Z",
  "closed_at": "2022-07-17T13:59:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Describe the feature you would like\n\nGiven that foundry supports hardhat integration, it would be great if `forge coverage` result was calculated using hardhat js tests as well.\n\n### Additional context\n\n_No response_",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1186526871",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2355#issuecomment-1186526871",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355",
    "id": 1186526871,
    "node_id": "IC_kwDOGBlvNc5GuPaX",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-17T13:59:31Z",
    "updated_at": "2022-07-17T14:12:24Z",
    "author_association": "MEMBER",
    "body": "This is not planned as it increases complexity of coverage a lot - more cases to cover on project structure, coverage would need to be inside of Anvil that would need to generate a seperate report with raw data we could merge into `forge coverage` reports for Forge tests etc.\r\n\r\nAnvil should be 1:1 with Hardhat node (or close to), so it should be possible to use solidity-coverage (although slower than Anvil) to generate coverage reports for Hardhat projects that use Anvil",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1186526871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1245607627",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2355#issuecomment-1245607627",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355",
    "id": 1245607627,
    "node_id": "IC_kwDOGBlvNc5KPnbL",
    "user": {
      "login": "ZeroEkkusu",
      "id": 94782988,
      "node_id": "U_kgDOBaZGDA",
      "avatar_url": "https://avatars.githubusercontent.com/u/94782988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZeroEkkusu",
      "html_url": "https://github.com/ZeroEkkusu",
      "followers_url": "https://api.github.com/users/ZeroEkkusu/followers",
      "following_url": "https://api.github.com/users/ZeroEkkusu/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZeroEkkusu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZeroEkkusu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZeroEkkusu/subscriptions",
      "organizations_url": "https://api.github.com/users/ZeroEkkusu/orgs",
      "repos_url": "https://api.github.com/users/ZeroEkkusu/repos",
      "events_url": "https://api.github.com/users/ZeroEkkusu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZeroEkkusu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-13T15:50:42Z",
    "updated_at": "2022-09-13T15:50:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "@onbjerg, this issue is related one I wanted to open.\r\n\r\nWe have a hybrid Hardhat/Foundry project and I tried merging the Hardhat and Forge coverage reports:\r\n\r\n```bash\r\ngenhtml foundry-lcov.info hardhat-lcov.info -o hybrid-coverage --branch-coverage\r\n```\r\n\r\nFrom what I can tell, they are not compatible. It works for merging multiple Hardhat *or* Forge coverage reports.\r\n\r\nThe issues I identified:\r\n\r\n- Hardhat counts `unchecked`, lines that revert, and maybe something else, while Forge does not, so the `Total` number of lines is bigger in Hardhat reports\r\n- There are 2x the number of `Total` lines, functions, and branches\r\n- Sometimes, the number of `Hit` functions is the expected + 1\r\n- Otherwise, seems okay\r\n\r\nIs it possible to produce a report that is compatible with Hardhat?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1245607627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250414256",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2355#issuecomment-1250414256",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355",
    "id": 1250414256,
    "node_id": "IC_kwDOGBlvNc5Kh86w",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-18T23:51:05Z",
    "updated_at": "2022-09-18T23:51:05Z",
    "author_association": "MEMBER",
    "body": "Try using a merge-specific tool for lcov files such as `lcov --add-tracefile ...`. Otherwise, it is not going to be in scope for a while since it would be highly dependent on how Hardhat outputs its report in terms of file names etc. and that's not really something we can do much about.\r\n\r\nFor the function hits, it's probably because I opted to name them `<contract>::<function>` to avoid name clashes whereas Hardhat might just do `<function>`.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250414256/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250875572",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2355#issuecomment-1250875572",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2355",
    "id": 1250875572,
    "node_id": "IC_kwDOGBlvNc5Kjti0",
    "user": {
      "login": "ZeroEkkusu",
      "id": 94782988,
      "node_id": "U_kgDOBaZGDA",
      "avatar_url": "https://avatars.githubusercontent.com/u/94782988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ZeroEkkusu",
      "html_url": "https://github.com/ZeroEkkusu",
      "followers_url": "https://api.github.com/users/ZeroEkkusu/followers",
      "following_url": "https://api.github.com/users/ZeroEkkusu/following{/other_user}",
      "gists_url": "https://api.github.com/users/ZeroEkkusu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ZeroEkkusu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ZeroEkkusu/subscriptions",
      "organizations_url": "https://api.github.com/users/ZeroEkkusu/orgs",
      "repos_url": "https://api.github.com/users/ZeroEkkusu/repos",
      "events_url": "https://api.github.com/users/ZeroEkkusu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ZeroEkkusu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-19T11:06:44Z",
    "updated_at": "2022-09-19T11:54:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for the feedback and the suggestion, I tested it out. I'm going to document the results here for future reference:\r\n\r\n- No branch coverage (I'm probably doing something wrong)\r\n- `Total` lines are OK\r\n- 2x `Total` functions (maybe because you named them differently)\r\n- `unchecked`, lines that revert, etc are reported as not covered (because of Hardhat)\r\n- `Hit` functions are expected + 1 sometimes\r\n\r\n<br>\r\n\r\n*Link https://github.com/sc-forks/solidity-coverage/issues/734*",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1250875572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
