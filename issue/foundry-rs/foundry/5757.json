{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5757",
  "id": 1874529513,
  "node_id": "I_kwDOGBlvNc5vuwzp",
  "number": 5757,
  "title": "\"forge test\" throws error when for an underlying delegate call from a static call",
  "user": {
    "login": "sukanyaparashar",
    "id": 25079663,
    "node_id": "MDQ6VXNlcjI1MDc5NjYz",
    "avatar_url": "https://avatars.githubusercontent.com/u/25079663?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sukanyaparashar",
    "html_url": "https://github.com/sukanyaparashar",
    "followers_url": "https://api.github.com/users/sukanyaparashar/followers",
    "following_url": "https://api.github.com/users/sukanyaparashar/following{/other_user}",
    "gists_url": "https://api.github.com/users/sukanyaparashar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sukanyaparashar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sukanyaparashar/subscriptions",
    "organizations_url": "https://api.github.com/users/sukanyaparashar/orgs",
    "repos_url": "https://api.github.com/users/sukanyaparashar/repos",
    "events_url": "https://api.github.com/users/sukanyaparashar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sukanyaparashar/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-08-30T23:49:49Z",
  "updated_at": "2023-09-11T14:57:31Z",
  "closed_at": "2023-09-11T14:47:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0\n\n### What command(s) is the bug in?\n\nforge test\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\n**ISSUE**\r\n\r\nI am trying to run `forge test` on NEON Devnet to get Chainlink price feed. But I am getting an error `[FAIL. Reason: toUint8_outOfBounds]`.\r\n\r\nThis is the test file:\r\n```\r\n// SPDX-License-Identifier: UNLICENSED\r\npragma solidity ^0.8.21;\r\n\r\nimport \"forge-std/Test.sol\";\r\n\r\ninterface AggregatorV3Interface {\r\n    function decimals() external view returns (uint8);\r\n\r\n    function description() external view returns (string memory);\r\n\r\n    function version() external view returns (uint256);\r\n\r\n    function getRoundData(\r\n        uint80 _roundId\r\n    )\r\n        external\r\n        view\r\n        returns (\r\n            uint80 roundId,\r\n            int256 answer,\r\n            uint256 startedAt,\r\n            uint256 updatedAt,\r\n            uint80 answeredInRound\r\n        );\r\n\r\n    function latestRoundData()\r\n        external\r\n        view\r\n        returns (\r\n            uint80 roundId,\r\n            int256 answer,\r\n            uint256 startedAt,\r\n            uint256 updatedAt,\r\n            uint80 answeredInRound\r\n        );\r\n}\r\n\r\ncontract ChainlinkTestTest is Test {\r\n\r\n    AggregatorV3Interface public priceFeed;\r\n\r\n    function setUp() public {\r\n        priceFeed = AggregatorV3Interface(0xec852B2A009f49E4eE4ffEddeDcF81a1AD1bbD6d);\r\n    }\r\n\r\n    function testPriceFeed() public {\r\n        (, int256 price, , , ) = priceFeed.latestRoundData();\r\n        emit log_named_int(\"Price:\", price);\r\n    }\r\n\r\n}\r\n```\r\nAnd `0xec852B2A009f49E4eE4ffEddeDcF81a1AD1bbD6d` is the Chhainlink price feed on Neon Devnet.\r\n\r\nWhen `forge test` is run, the following error is thrown:\r\n```\r\n$ forge test --rpc-url $RPC_URL -vvvvv\r\n[⠰] Compiling...\r\nNo files changed, compilation skipped\r\n\r\nRunning 1 test for test/ChainlinkTest.t.sol:ChainlinkTestTest\r\n[FAIL. Reason: toUint8_outOfBounds] testPriceFeed() (gas: 17231)\r\nTraces:\r\n  [22269] ChainlinkTestTest::setUp() \r\n    └─ ← ()\r\n\r\n  [17231] ChainlinkTestTest::testPriceFeed() \r\n    ├─ [12148] 0xec852B2A009f49E4eE4ffEddeDcF81a1AD1bbD6d::latestRoundData() [staticcall]\r\n    │   ├─ [6928] 0xb4820dC05E23d26FfE290Ce82DA94c894903C034::getLatestRound(54711267442576681404593257684989943639952621180004110670920145519824699960726 [5.471e76]) [delegatecall]\r\n    │   │   ├─ [0] 0xff00000000000000000000000000000000000002::2b3c8322(78f57ae1195e8c497a8be054ad52adf4c8976f8436732309e22af7067724ad96000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000c0) [staticcall]\r\n    │   │   │   └─ ← ()\r\n    │   │   ├─ [0] 0xff00000000000000000000000000000000000002::43ca5161(78f57ae1195e8c497a8be054ad52adf4c8976f8436732309e22af7067724ad96000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000c0) [staticcall]\r\n    │   │   │   └─ ← ()\r\n    │   │   └─ ← \"toUint8_outOfBounds\"\r\n    │   └─ ← \"toUint8_outOfBounds\"\r\n    └─ ← \"toUint8_outOfBounds\"\r\n\r\nTest result: FAILED. 0 passed; 1 failed; 0 skipped; finished in 31.08s\r\nRan 1 test suites: 0 tests passed, 1 failed, 0 skipped (1 total tests)\r\n\r\nFailing tests:\r\nEncountered 1 failing test in test/ChainlinkTest.t.sol:ChainlinkTestTest\r\n[FAIL. Reason: toUint8_outOfBounds] testPriceFeed() (gas: 17231)\r\n\r\nEncountered a total of 1 failing tests, 0 tests succeeded\r\n```\r\nHowever if I call the function `latestRoundData()` with `cast call` command, it returns the correct data -\r\n```\r\n$ cast call 0xec852B2A009f49E4eE4ffEddeDcF81a1AD1bbD6d --rpc-url $RPC_URL \"latestRoundData()\"                                                                  1 ↵\r\n0x00000000000000000000000000000000000000000000000000000000008748f7000000000000000000000000000000000000000000000000000000007c6517c00000000000000000000000000000000000000000000000000000000064efd54e0000000000000000000000000000000000000000000000000000000064efd54e00000000000000000000000000000000000000000000000000000000008748f7\r\n```\r\nAny help will be highly appreciated. Thanks!",
  "closed_by": {
    "login": "mds1",
    "id": 17163988,
    "node_id": "MDQ6VXNlcjE3MTYzOTg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mds1",
    "html_url": "https://github.com/mds1",
    "followers_url": "https://api.github.com/users/mds1/followers",
    "following_url": "https://api.github.com/users/mds1/following{/other_user}",
    "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
    "organizations_url": "https://api.github.com/users/mds1/orgs",
    "repos_url": "https://api.github.com/users/mds1/repos",
    "events_url": "https://api.github.com/users/mds1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mds1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1713731667",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5757#issuecomment-1713731667",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757",
    "id": 1713731667,
    "node_id": "IC_kwDOGBlvNc5mJXhT",
    "user": {
      "login": "sukanyaparashar",
      "id": 25079663,
      "node_id": "MDQ6VXNlcjI1MDc5NjYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/25079663?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sukanyaparashar",
      "html_url": "https://github.com/sukanyaparashar",
      "followers_url": "https://api.github.com/users/sukanyaparashar/followers",
      "following_url": "https://api.github.com/users/sukanyaparashar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sukanyaparashar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sukanyaparashar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sukanyaparashar/subscriptions",
      "organizations_url": "https://api.github.com/users/sukanyaparashar/orgs",
      "repos_url": "https://api.github.com/users/sukanyaparashar/repos",
      "events_url": "https://api.github.com/users/sukanyaparashar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sukanyaparashar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T11:57:02Z",
    "updated_at": "2023-09-11T11:57:02Z",
    "author_association": "NONE",
    "body": "Hello everyone! Any update on this issue?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1713731667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714041708",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5757#issuecomment-1714041708",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757",
    "id": 1714041708,
    "node_id": "IC_kwDOGBlvNc5mKjNs",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:47:39Z",
    "updated_at": "2023-09-11T14:47:40Z",
    "author_association": "COLLABORATOR",
    "body": "This seems like a bug in your code. That `toUint8_outOfBounds` error is not thrown by forge—it is thrown by a solidity method called `toUint8` that casts some input to a uint8. The value you are trying to cast to a uint8 is too big to fit into a uint8, so it throws that error. Going to close this since it's not a forge issue, but if you are stuck, please provide a repo or full code snippet to reproduce the error with",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714041708/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714053622",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5757#issuecomment-1714053622",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757",
    "id": 1714053622,
    "node_id": "IC_kwDOGBlvNc5mKmH2",
    "user": {
      "login": "sukanyaparashar",
      "id": 25079663,
      "node_id": "MDQ6VXNlcjI1MDc5NjYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/25079663?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sukanyaparashar",
      "html_url": "https://github.com/sukanyaparashar",
      "followers_url": "https://api.github.com/users/sukanyaparashar/followers",
      "following_url": "https://api.github.com/users/sukanyaparashar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sukanyaparashar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sukanyaparashar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sukanyaparashar/subscriptions",
      "organizations_url": "https://api.github.com/users/sukanyaparashar/orgs",
      "repos_url": "https://api.github.com/users/sukanyaparashar/repos",
      "events_url": "https://api.github.com/users/sukanyaparashar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sukanyaparashar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:53:59Z",
    "updated_at": "2023-09-11T14:53:59Z",
    "author_association": "NONE",
    "body": "Thanks for the reply, @mds1 . I am just not able to understand why `cast call` command doesn't throw error for the same function call but `forge test` does. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714053622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714056796",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5757#issuecomment-1714056796",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757",
    "id": 1714056796,
    "node_id": "IC_kwDOGBlvNc5mKm5c",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:55:36Z",
    "updated_at": "2023-09-11T14:55:36Z",
    "author_association": "COLLABORATOR",
    "body": "Because `cast call` is printing the raw return data without decoding it. That return data includes multiple values. One of those values is larger than a uint8, but your solidity code is trying to decode it into a uint8",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714056796/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714060357",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5757#issuecomment-1714060357",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5757",
    "id": 1714060357,
    "node_id": "IC_kwDOGBlvNc5mKnxF",
    "user": {
      "login": "sukanyaparashar",
      "id": 25079663,
      "node_id": "MDQ6VXNlcjI1MDc5NjYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/25079663?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sukanyaparashar",
      "html_url": "https://github.com/sukanyaparashar",
      "followers_url": "https://api.github.com/users/sukanyaparashar/followers",
      "following_url": "https://api.github.com/users/sukanyaparashar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sukanyaparashar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sukanyaparashar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sukanyaparashar/subscriptions",
      "organizations_url": "https://api.github.com/users/sukanyaparashar/orgs",
      "repos_url": "https://api.github.com/users/sukanyaparashar/repos",
      "events_url": "https://api.github.com/users/sukanyaparashar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sukanyaparashar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T14:57:31Z",
    "updated_at": "2023-09-11T14:57:31Z",
    "author_association": "NONE",
    "body": "Okay, Thanks for the explanation @mds1 . ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1714060357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
