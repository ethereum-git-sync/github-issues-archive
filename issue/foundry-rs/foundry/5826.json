{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5826",
  "id": 1894037812,
  "node_id": "I_kwDOGBlvNc5w5Lk0",
  "number": 5826,
  "title": "allow tests to introspect (test name, test file, test runner)",
  "user": {
    "login": "holic",
    "id": 508855,
    "node_id": "MDQ6VXNlcjUwODg1NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/508855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holic",
    "html_url": "https://github.com/holic",
    "followers_url": "https://api.github.com/users/holic/followers",
    "following_url": "https://api.github.com/users/holic/following{/other_user}",
    "gists_url": "https://api.github.com/users/holic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holic/subscriptions",
    "organizations_url": "https://api.github.com/users/holic/orgs",
    "repos_url": "https://api.github.com/users/holic/repos",
    "events_url": "https://api.github.com/users/holic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-09-13T08:42:32Z",
  "updated_at": "2023-09-19T16:28:05Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Describe the feature you would like\n\nI have a few test files that each call `vm.ffi` to run a separate process during `setUp`. However, the tests running in parallel causes trouble for that specific process.\r\n\r\nI'd like to be able to identify which test is being run (either the test function name, test file name, or some arbitrary test runner ID) so that I can pass it into `vm.ffi` process as an extra argument to separate executions of that process.\r\n\r\nI could work around this by writing to some temporary file, but I'd like to do avoid fs writes and leaving around tmp files.\r\n\n\n### Additional context\n\n_No response_",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717646139",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5826#issuecomment-1717646139",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
    "id": 1717646139,
    "node_id": "IC_kwDOGBlvNc5mYTM7",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-13T13:33:16Z",
    "updated_at": "2023-09-13T13:33:16Z",
    "author_association": "COLLABORATOR",
    "body": "Another workaround is to use `msg.data` or `msg.data[0:4]` as the extra ffi argument, but this will of course only give you the function selector+calldata, not the file name. So it's not guaranteed to be unique if you have the same test function sigs in multiple files",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717646139/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717761246",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5826#issuecomment-1717761246",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
    "id": 1717761246,
    "node_id": "IC_kwDOGBlvNc5mYvTe",
    "user": {
      "login": "holic",
      "id": 508855,
      "node_id": "MDQ6VXNlcjUwODg1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/508855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holic",
      "html_url": "https://github.com/holic",
      "followers_url": "https://api.github.com/users/holic/followers",
      "following_url": "https://api.github.com/users/holic/following{/other_user}",
      "gists_url": "https://api.github.com/users/holic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holic/subscriptions",
      "organizations_url": "https://api.github.com/users/holic/orgs",
      "repos_url": "https://api.github.com/users/holic/repos",
      "events_url": "https://api.github.com/users/holic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-13T14:36:30Z",
    "updated_at": "2023-09-13T14:37:12Z",
    "author_association": "NONE",
    "body": "That's not a bad idea! Although I am using `vm.ffi` inside `setUp` which would have the same function selector for each test file.\r\n\r\nI was also wondering if I could introspect the test bytecode. Does the test file have its bytecode at `address(this)` in tests?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717761246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717958784",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5826#issuecomment-1717958784",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
    "id": 1717958784,
    "node_id": "IC_kwDOGBlvNc5mZfiA",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-13T16:32:06Z",
    "updated_at": "2023-09-13T16:32:06Z",
    "author_association": "COLLABORATOR",
    "body": "> That's not a bad idea! Although I am using `vm.ffi` inside `setUp` which would have the same function selector for each test file.\r\n\r\nThis might not work the way you expect. `setUp` is run one time and then the resulting state is cached to use at the beginning of each test in the contract.\r\n\r\n> I was also wondering if I could introspect the test bytecode. Does the test file have its bytecode at `address(this)` in tests?\r\n\r\nIIUC, then yes with `address(this).code`",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717958784/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717991865",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5826#issuecomment-1717991865",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
    "id": 1717991865,
    "node_id": "IC_kwDOGBlvNc5mZnm5",
    "user": {
      "login": "holic",
      "id": 508855,
      "node_id": "MDQ6VXNlcjUwODg1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/508855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holic",
      "html_url": "https://github.com/holic",
      "followers_url": "https://api.github.com/users/holic/followers",
      "following_url": "https://api.github.com/users/holic/following{/other_user}",
      "gists_url": "https://api.github.com/users/holic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holic/subscriptions",
      "organizations_url": "https://api.github.com/users/holic/orgs",
      "repos_url": "https://api.github.com/users/holic/repos",
      "events_url": "https://api.github.com/users/holic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-13T16:56:29Z",
    "updated_at": "2023-09-13T16:56:29Z",
    "author_association": "NONE",
    "body": "> This might not work the way you expect. setUp is run one time and then the resulting state is cached to use at the beginning of each test in the contract.\r\n\r\nYep, that's intended! My specific use case is calling out to a deploy script that just needs to happen once per test file/contract.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1717991865/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1722428691",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5826#issuecomment-1722428691",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
    "id": 1722428691,
    "node_id": "IC_kwDOGBlvNc5mqi0T",
    "user": {
      "login": "holic",
      "id": 508855,
      "node_id": "MDQ6VXNlcjUwODg1NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/508855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holic",
      "html_url": "https://github.com/holic",
      "followers_url": "https://api.github.com/users/holic/followers",
      "following_url": "https://api.github.com/users/holic/following{/other_user}",
      "gists_url": "https://api.github.com/users/holic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holic/subscriptions",
      "organizations_url": "https://api.github.com/users/holic/orgs",
      "repos_url": "https://api.github.com/users/holic/repos",
      "events_url": "https://api.github.com/users/holic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-17T08:56:40Z",
    "updated_at": "2023-09-17T08:56:40Z",
    "author_association": "NONE",
    "body": "I tried to ask this a few times in the Telegram chat, but got no reply, so hoping I can get an answer here:\r\n\r\nIf I run a test against an anvil node and inside the test I call `vm.ffi` to spawn a separate process that creates contracts on that same anvil node, will the test be aware of that chain state? Or will its state be stuck as a fork of when the test started (prior to creating contracts)?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1722428691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1726038946",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5826#issuecomment-1726038946",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5826",
    "id": 1726038946,
    "node_id": "IC_kwDOGBlvNc5m4UOi",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-19T16:28:04Z",
    "updated_at": "2023-09-19T16:28:04Z",
    "author_association": "COLLABORATOR",
    "body": "forge will query the chain for state/code as needed then cache the response, so the answer depends on your exact setup. It should be easy to test this to get an answer for your specific case",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1726038946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
