{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2965",
  "id": 1352417148,
  "node_id": "I_kwDOGBlvNc5QnD98",
  "number": 2965,
  "title": "anvil `TypedTransaction` fastrlp decoding of `Create` transactions fails",
  "user": {
    "login": "sveitser",
    "id": 1040871,
    "node_id": "MDQ6VXNlcjEwNDA4NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sveitser",
    "html_url": "https://github.com/sveitser",
    "followers_url": "https://api.github.com/users/sveitser/followers",
    "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
    "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
    "organizations_url": "https://api.github.com/users/sveitser/orgs",
    "repos_url": "https://api.github.com/users/sveitser/repos",
    "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sveitser/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2022-08-26T15:25:33Z",
  "updated_at": "2022-08-26T19:25:10Z",
  "closed_at": "2022-08-26T19:25:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [ ] Foundry\n- [ ] Foundryup\n\n### What version of Foundry are you on?\n\n4e11d1ff1d01cec67399cb7fdaaf7fa3cf467532\n\n### What command(s) is the bug in?\n\n_No response_\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nI have tried to switch over from using `rlp` to `fastrlp` but I get failures every time I decode a `create` transactions.\r\n\r\nBelow is an example.\r\n\r\nA Create tx \r\n- https://goerli.etherscan.io/tx/0x7d82c63a0d24b4622cb8f836fff374f64578693b2dfc3db5f53963ecd063674f\r\n- https://goerli.etherscan.io/getRawTx?tx=0x7d82c63a0d24b4622cb8f836fff374f64578693b2dfc3db5f53963ecd063674f\r\n\r\n```rust\r\nlet tx_bytes =\r\n      hex::decode(\"02f901ee05228459682f008459682f11830209bf8080b90195608060405234801561001057600080fd5b50610175806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c80630c49c36c14610030575b600080fd5b61003861004e565b604051610045919061011d565b60405180910390f35b60606020600052600f6020527f68656c6c6f2073746174656d696e64000000000000000000000000000000000060405260406000f35b600081519050919050565b600082825260208201905092915050565b60005b838110156100be5780820151818401526020810190506100a3565b838111156100cd576000848401525b50505050565b6000601f19601f8301169050919050565b60006100ef82610084565b6100f9818561008f565b93506101098185602086016100a0565b610112816100d3565b840191505092915050565b6000602082019050818103600083015261013781846100e4565b90509291505056fea264697066735822122051449585839a4ea5ac23cae4552ef8a96b64ff59d0668f76bfac3796b2bdbb3664736f6c63430008090033c080a0136ebffaa8fc8b9fda9124de9ccb0b1f64e90fbd44251b4c4ac2501e60b104f9a07eb2999eec6d185ef57e91ed099afb0a926c5b536f0155dd67e537c7476e1471\")\r\n          .unwrap();\r\nanvil_core::eth::transaction::TypedTransaction::decode(&mut &tx_bytes[..]).unwrap();\r\n```\r\n\r\nFails with\r\n```\r\nthread 'test::test_decode' panicked at 'called `Result::unwrap()` on an `Err` value: UnexpectedString\r\n```\r\n\r\nFor other `create` transactions the `DecodeError` returned varies. It also affects Legacy as well as `0x01` and `0x02` transactions.",
  "closed_by": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228636507",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228636507",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228636507,
    "node_id": "IC_kwDOGBlvNc5JO4Fb",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T15:26:44Z",
    "updated_at": "2022-08-26T15:26:44Z",
    "author_association": "MEMBER",
    "body": "`rlp::decode` works?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228636507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228637043",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228637043",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228637043,
    "node_id": "IC_kwDOGBlvNc5JO4Nz",
    "user": {
      "login": "sveitser",
      "id": 1040871,
      "node_id": "MDQ6VXNlcjEwNDA4NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sveitser",
      "html_url": "https://github.com/sveitser",
      "followers_url": "https://api.github.com/users/sveitser/followers",
      "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
      "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
      "organizations_url": "https://api.github.com/users/sveitser/orgs",
      "repos_url": "https://api.github.com/users/sveitser/repos",
      "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sveitser/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T15:27:15Z",
    "updated_at": "2022-08-26T15:29:02Z",
    "author_association": "NONE",
    "body": "Yes that works.\r\n\r\nedit: I did not try this particular transaction. I will try to make sure. I was running all the official Ethereum state tests through signing, encoding and decoding and was using `rlp` before and had no issues with that. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228637043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228660011",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228660011",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228660011,
    "node_id": "IC_kwDOGBlvNc5JO90r",
    "user": {
      "login": "sveitser",
      "id": 1040871,
      "node_id": "MDQ6VXNlcjEwNDA4NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sveitser",
      "html_url": "https://github.com/sveitser",
      "followers_url": "https://api.github.com/users/sveitser/followers",
      "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
      "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
      "organizations_url": "https://api.github.com/users/sveitser/orgs",
      "repos_url": "https://api.github.com/users/sveitser/repos",
      "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sveitser/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T15:48:17Z",
    "updated_at": "2022-08-26T15:48:17Z",
    "author_association": "NONE",
    "body": "No sorry, it also fails in this example with `ExpectedToBeList`. Is this expected because it's not a valid RLP encoding because of the version prefix?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228660011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228662544",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228662544",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228662544,
    "node_id": "IC_kwDOGBlvNc5JO-cQ",
    "user": {
      "login": "sveitser",
      "id": 1040871,
      "node_id": "MDQ6VXNlcjEwNDA4NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sveitser",
      "html_url": "https://github.com/sveitser",
      "followers_url": "https://api.github.com/users/sveitser/followers",
      "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
      "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
      "organizations_url": "https://api.github.com/users/sveitser/orgs",
      "repos_url": "https://api.github.com/users/sveitser/repos",
      "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sveitser/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T15:51:13Z",
    "updated_at": "2022-08-26T15:51:13Z",
    "author_association": "NONE",
    "body": "I will try come up with a better example.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228662544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228665234",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228665234",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228665234,
    "node_id": "IC_kwDOGBlvNc5JO_GS",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T15:54:10Z",
    "updated_at": "2022-08-26T15:54:10Z",
    "author_association": "MEMBER",
    "body": "ref \r\n\r\nhttps://github.com/foundry-rs/foundry/blob/863561af4bec68dcd62a99672574be4577ea3855/anvil/src/eth/api.rs#L736-L745",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228665234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228696418",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228696418",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228696418,
    "node_id": "IC_kwDOGBlvNc5JPGti",
    "user": {
      "login": "sveitser",
      "id": 1040871,
      "node_id": "MDQ6VXNlcjEwNDA4NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sveitser",
      "html_url": "https://github.com/sveitser",
      "followers_url": "https://api.github.com/users/sveitser/followers",
      "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
      "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
      "organizations_url": "https://api.github.com/users/sveitser/orgs",
      "repos_url": "https://api.github.com/users/sveitser/repos",
      "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sveitser/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T16:27:17Z",
    "updated_at": "2022-08-26T16:27:17Z",
    "author_association": "NONE",
    "body": "Thanks. I should not have picked that example. I'm still not quite sure if there isn't an issue with the `fastrlp` decoding.\r\n\r\nBelow are a toy `Call` and `Create` tx encoded and then decoded once each with `rlp` and `fastrlp`. The `fastrlp` decode step fails for the `Create` transaction, the other 3 tests pass.\r\n\r\n```rust\r\n#[cfg(test)]\r\nmod test2 {\r\n    use anvil_core::eth::transaction::{EIP2930Transaction, TransactionKind, TypedTransaction};\r\n    use ethereum_types::{Address, H256, U256};\r\n    use ethers_core::types::Bytes;\r\n\r\n    // passes\r\n    #[test]\r\n    fn test_decode_rlp_create() {\r\n        let tx = TypedTransaction::EIP2930(EIP2930Transaction {\r\n            chain_id: 1u64,\r\n            nonce: U256::from(0),\r\n            gas_price: U256::from(1),\r\n            gas_limit: U256::from(2),\r\n            kind: TransactionKind::Create,\r\n            value: U256::from(3),\r\n            input: Bytes::from(vec![1, 2]),\r\n            odd_y_parity: true,\r\n            r: H256::default(),\r\n            s: H256::default(),\r\n            access_list: vec![].into(),\r\n        });\r\n\r\n        let encoded = rlp::encode(&tx);\r\n        let decoded: TypedTransaction = rlp::decode(&encoded).unwrap();\r\n        assert_eq!(decoded, tx);\r\n    }\r\n\r\n    // passes\r\n    #[test]\r\n    fn test_decode_rlp_call() {\r\n        let tx = TypedTransaction::EIP2930(EIP2930Transaction {\r\n            chain_id: 1u64,\r\n            nonce: U256::from(0),\r\n            gas_price: U256::from(1),\r\n            gas_limit: U256::from(2),\r\n            kind: TransactionKind::Call(Address::default()),\r\n            value: U256::from(3),\r\n            input: Bytes::from(vec![1, 2]),\r\n            odd_y_parity: true,\r\n            r: H256::default(),\r\n            s: H256::default(),\r\n            access_list: vec![].into(),\r\n        });\r\n\r\n        let encoded = rlp::encode(&tx);\r\n        let decoded: TypedTransaction = rlp::decode(&encoded).unwrap();\r\n        assert_eq!(decoded, tx);\r\n    }\r\n\r\n    // fails\r\n    #[test]\r\n    fn test_decode_fastrlp_create() {\r\n        use bytes::BytesMut;\r\n        use fastrlp::{Decodable, Encodable};\r\n\r\n        let tx = TypedTransaction::EIP2930(EIP2930Transaction {\r\n            chain_id: 1u64,\r\n            nonce: U256::from(0),\r\n            gas_price: U256::from(1),\r\n            gas_limit: U256::from(2),\r\n            kind: TransactionKind::Create,\r\n            value: U256::from(3),\r\n            input: Bytes::from(vec![1, 2]),\r\n            odd_y_parity: true,\r\n            r: H256::default(),\r\n            s: H256::default(),\r\n            access_list: vec![].into(),\r\n        });\r\n\r\n        let mut encoded = BytesMut::new();\r\n        tx.encode(&mut encoded);\r\n\r\n        let decoded = TypedTransaction::decode(&mut &*encoded).unwrap();\r\n        // XXX fails with: `Err` value: UnexpectedString',\r\n        assert_eq!(decoded, tx);\r\n    }\r\n\r\n    // passes\r\n    #[test]\r\n    fn test_decode_fastrlp_call() {\r\n        use bytes::BytesMut;\r\n        use fastrlp::{Decodable, Encodable};\r\n\r\n        let tx = TypedTransaction::EIP2930(EIP2930Transaction {\r\n            chain_id: 1u64,\r\n            nonce: U256::from(0),\r\n            gas_price: U256::from(1),\r\n            gas_limit: U256::from(2),\r\n            kind: TransactionKind::Call(Address::default()),\r\n            value: U256::from(3),\r\n            input: Bytes::from(vec![1, 2]),\r\n            odd_y_parity: true,\r\n            r: H256::default(),\r\n            s: H256::default(),\r\n            access_list: vec![].into(),\r\n        });\r\n\r\n        let mut encoded = BytesMut::new();\r\n        tx.encode(&mut encoded);\r\n\r\n        let decoded = TypedTransaction::decode(&mut &*encoded).unwrap();\r\n        assert_eq!(decoded, tx);\r\n    }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228696418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228715383",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228715383",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228715383,
    "node_id": "IC_kwDOGBlvNc5JPLV3",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T16:49:20Z",
    "updated_at": "2022-08-26T16:49:20Z",
    "author_association": "MEMBER",
    "body": "perhaps the issue is here\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/863561af4bec68dcd62a99672574be4577ea3855/anvil/core/src/eth/transaction/mod.rs#L178-L187",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228715383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228725287",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228725287",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228725287,
    "node_id": "IC_kwDOGBlvNc5JPNwn",
    "user": {
      "login": "sveitser",
      "id": 1040871,
      "node_id": "MDQ6VXNlcjEwNDA4NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sveitser",
      "html_url": "https://github.com/sveitser",
      "followers_url": "https://api.github.com/users/sveitser/followers",
      "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
      "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
      "organizations_url": "https://api.github.com/users/sveitser/orgs",
      "repos_url": "https://api.github.com/users/sveitser/repos",
      "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sveitser/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T17:01:53Z",
    "updated_at": "2022-08-26T17:01:53Z",
    "author_association": "NONE",
    "body": "But I think the `rlp` code is working fine.\r\n\r\nIn the following code the `buf` is passed in as mutable but `.first()` does not seem to mutate the buffer. Could this be the problem?\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/863561af4bec68dcd62a99672574be4577ea3855/anvil/core/src/eth/transaction/mod.rs#L205-L218\r\n\r\nIn the following snippet `encoded` is still the same (b\"\\x80\") at the end:\r\n\r\n```rust\r\nuse bytes::BytesMut;\r\nuse fastrlp::{Decodable, Encodable};\r\nlet kind = TransactionKind::Create;\r\nlet mut encoded = BytesMut::new();\r\nkind.encode(&mut encoded);\r\nprintln!(\"encoded: {:?}\", encoded);\r\n\r\nlet decoded = TransactionKind::decode(&mut &*encoded).unwrap();\r\nassert_eq!(kind, decoded);\r\nprintln!(\"encoded after: {:?}\", encoded);\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228725287/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228754444",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228754444",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228754444,
    "node_id": "IC_kwDOGBlvNc5JPU4M",
    "user": {
      "login": "sveitser",
      "id": 1040871,
      "node_id": "MDQ6VXNlcjEwNDA4NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1040871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sveitser",
      "html_url": "https://github.com/sveitser",
      "followers_url": "https://api.github.com/users/sveitser/followers",
      "following_url": "https://api.github.com/users/sveitser/following{/other_user}",
      "gists_url": "https://api.github.com/users/sveitser/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sveitser/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sveitser/subscriptions",
      "organizations_url": "https://api.github.com/users/sveitser/orgs",
      "repos_url": "https://api.github.com/users/sveitser/repos",
      "events_url": "https://api.github.com/users/sveitser/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sveitser/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T17:38:14Z",
    "updated_at": "2022-08-26T17:38:14Z",
    "author_association": "NONE",
    "body": "My previous snippet does not consume what's in `encoded` anyway but I think the one below might illustrate a problem that the empty string of `Create` is not consumed.\r\n\r\n```rust\r\nuse bytes::BytesMut;\r\nuse fastrlp::{Decodable, Encodable};\r\nlet kind = TransactionKind::Create;\r\nlet mut encoded = BytesMut::new();\r\nkind.encode(&mut encoded);\r\nlet encoded: &mut &[u8] = &mut &*encoded;\r\nprintln!(\"create encoded before: {:?}\", encoded);\r\n\r\nlet decoded = TransactionKind::decode(encoded).unwrap();\r\nassert_eq!(kind, decoded);\r\nprintln!(\"create encoded after : {:?}\", encoded);\r\n\r\nlet kind = TransactionKind::Call(Address::default());\r\nlet mut encoded = BytesMut::new();\r\nkind.encode(&mut encoded);\r\nlet encoded: &mut &[u8] = &mut &*encoded;\r\nprintln!(\"call encoded before: {:?}\", encoded);\r\n\r\nlet decoded = TransactionKind::decode(encoded).unwrap();\r\nassert_eq!(kind, decoded);\r\nprintln!(\"call encoded after : {:?}\", encoded);\r\n```\r\n\r\nPrints\r\n```\r\ncreate encoded before: [128]\r\ncreate encoded after : [128]\r\ncall encoded before: [148, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\ncall encoded after : []\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228754444/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228757650",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228757650",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228757650,
    "node_id": "IC_kwDOGBlvNc5JPVqS",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T17:42:08Z",
    "updated_at": "2022-08-26T17:42:08Z",
    "author_association": "MEMBER",
    "body": "cc @Rjected ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228757650/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228814940",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2965#issuecomment-1228814940",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2965",
    "id": 1228814940,
    "node_id": "IC_kwDOGBlvNc5JPjpc",
    "user": {
      "login": "Rjected",
      "id": 6798349,
      "node_id": "MDQ6VXNlcjY3OTgzNDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6798349?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Rjected",
      "html_url": "https://github.com/Rjected",
      "followers_url": "https://api.github.com/users/Rjected/followers",
      "following_url": "https://api.github.com/users/Rjected/following{/other_user}",
      "gists_url": "https://api.github.com/users/Rjected/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Rjected/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Rjected/subscriptions",
      "organizations_url": "https://api.github.com/users/Rjected/orgs",
      "repos_url": "https://api.github.com/users/Rjected/repos",
      "events_url": "https://api.github.com/users/Rjected/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Rjected/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T18:53:49Z",
    "updated_at": "2022-08-26T18:53:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, the problem is that the 0x80 byte is not being consumed. good catch, here's a fix: #2968!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1228814940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
