{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2065",
  "id": 1279990682,
  "node_id": "I_kwDOGBlvNc5MSxua",
  "number": 2065,
  "title": "Enable writing gas reports for specific contracts to `.snapshot`",
  "user": {
    "login": "wilsoncusack",
    "id": 6678357,
    "node_id": "MDQ6VXNlcjY2NzgzNTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6678357?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wilsoncusack",
    "html_url": "https://github.com/wilsoncusack",
    "followers_url": "https://api.github.com/users/wilsoncusack/followers",
    "following_url": "https://api.github.com/users/wilsoncusack/following{/other_user}",
    "gists_url": "https://api.github.com/users/wilsoncusack/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wilsoncusack/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wilsoncusack/subscriptions",
    "organizations_url": "https://api.github.com/users/wilsoncusack/orgs",
    "repos_url": "https://api.github.com/users/wilsoncusack/repos",
    "events_url": "https://api.github.com/users/wilsoncusack/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wilsoncusack/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3759773804,
      "node_id": "LA_kwDOGBlvNc7gGZhs",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-gas-snapshots",
      "name": "A-gas-snapshots",
      "color": "FBCA04",
      "default": false,
      "description": "Area: gas snapshotting/reporting"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-06-22T11:26:54Z",
  "updated_at": "2023-07-02T14:07:13Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Describe the feature you would like\n\nProblem: \r\nCurrently, changes in `.snapshot` do not necessarily reflect gas changes a developer cares about. Snapshots directly reflect the gas use of the test functions, and only indirectly reflect the gas used by the contract being tested. \r\n\r\nIf a developer changes a test and the contract being tested in the same diff, they lose signal in the `.snapshot` as to the gas effect of their changes. \r\n\r\nWe see many developers solve this by creating super minimal tests with names like `testXGas` so that they always have some indication of *exclusively* the changing gas use in the contract being tested. \r\n\r\nIn fact, for me personally, I generally *only* care about the snapshot of these functions. The gas snapshot of all the other functions is mostly just noise. \r\n\r\n`Proposed solution`\r\nA very useful tool is `forge test --gas-report` it shows the gas use of each function in each contract! This is great, and could be super powered by (1) enabling writing this gas report to the snapshot (2) enabling passing arguments as to which contracts we exclusively want gas reports for. \r\n\r\nThe command might look something like \r\n```\r\nforge snapshot --gas-report --contracts MyContract\r\n```\r\nThis command could run existing snapshot functionality and additionally write the gas report of the specified contracts to the end of the snapshot. Though, for me personally, if writing the gas-report to snapshot existed, I could do without the existing snapshot functionality entirely, I think. Possibly still nice for quickly checking gas of something, though. \n\n### Additional context\n\n_No response_",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1163005602",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2065#issuecomment-1163005602",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065",
    "id": 1163005602,
    "node_id": "IC_kwDOGBlvNc5FUg6i",
    "user": {
      "login": "wilsoncusack",
      "id": 6678357,
      "node_id": "MDQ6VXNlcjY2NzgzNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6678357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wilsoncusack",
      "html_url": "https://github.com/wilsoncusack",
      "followers_url": "https://api.github.com/users/wilsoncusack/followers",
      "following_url": "https://api.github.com/users/wilsoncusack/following{/other_user}",
      "gists_url": "https://api.github.com/users/wilsoncusack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wilsoncusack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wilsoncusack/subscriptions",
      "organizations_url": "https://api.github.com/users/wilsoncusack/orgs",
      "repos_url": "https://api.github.com/users/wilsoncusack/repos",
      "events_url": "https://api.github.com/users/wilsoncusack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wilsoncusack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-22T11:55:14Z",
    "updated_at": "2022-06-22T11:55:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Another idea would be to just have a new `.gas-report` file. Possibly in `foundry.toml` one could specify which contracts to include.  ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1163005602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1163136664",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2065#issuecomment-1163136664",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065",
    "id": 1163136664,
    "node_id": "IC_kwDOGBlvNc5FVA6Y",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-22T13:59:45Z",
    "updated_at": "2022-06-22T13:59:45Z",
    "author_association": "MEMBER",
    "body": "As mentioned in another snapshot/gas report issue/request recently we used to talk about just merging `forge snapshot` and the gas report feature because they both have strengths and shortcomings: snapshots have `--check`, `--diff` and disk saving (which gas reports lack) and gas reports have more info and less noise in the readings",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1163136664/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1163177437",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2065#issuecomment-1163177437",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065",
    "id": 1163177437,
    "node_id": "IC_kwDOGBlvNc5FVK3d",
    "user": {
      "login": "wilsoncusack",
      "id": 6678357,
      "node_id": "MDQ6VXNlcjY2NzgzNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6678357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wilsoncusack",
      "html_url": "https://github.com/wilsoncusack",
      "followers_url": "https://api.github.com/users/wilsoncusack/followers",
      "following_url": "https://api.github.com/users/wilsoncusack/following{/other_user}",
      "gists_url": "https://api.github.com/users/wilsoncusack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wilsoncusack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wilsoncusack/subscriptions",
      "organizations_url": "https://api.github.com/users/wilsoncusack/orgs",
      "repos_url": "https://api.github.com/users/wilsoncusack/repos",
      "events_url": "https://api.github.com/users/wilsoncusack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wilsoncusack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-22T14:30:03Z",
    "updated_at": "2022-06-22T14:30:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "> As mentioned in another snapshot/gas report issue/request recently we used to talk about just merging `forge snapshot` and the gas report feature because they both have strengths and shortcomings: snapshots have `--check`, `--diff` and disk saving (which gas reports lack) and gas reports have more info and less noise in the readings\r\n\r\nOk got it, thanks. Feel free to close if this is a duplicate. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1163177437/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1610480690",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2065#issuecomment-1610480690",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065",
    "id": 1610480690,
    "node_id": "IC_kwDOGBlvNc5f_fwy",
    "user": {
      "login": "wilsoncusack",
      "id": 6678357,
      "node_id": "MDQ6VXNlcjY2NzgzNTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6678357?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wilsoncusack",
      "html_url": "https://github.com/wilsoncusack",
      "followers_url": "https://api.github.com/users/wilsoncusack/followers",
      "following_url": "https://api.github.com/users/wilsoncusack/following{/other_user}",
      "gists_url": "https://api.github.com/users/wilsoncusack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wilsoncusack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wilsoncusack/subscriptions",
      "organizations_url": "https://api.github.com/users/wilsoncusack/orgs",
      "repos_url": "https://api.github.com/users/wilsoncusack/repos",
      "events_url": "https://api.github.com/users/wilsoncusack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wilsoncusack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-28T01:42:54Z",
    "updated_at": "2023-06-28T01:42:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gakonst I'm happy to work on this if we can get consensus on what to implement :)  ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1610480690/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1616675401",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2065#issuecomment-1616675401",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2065",
    "id": 1616675401,
    "node_id": "IC_kwDOGBlvNc5gXIJJ",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-02T14:05:37Z",
    "updated_at": "2023-07-02T14:07:13Z",
    "author_association": "COLLABORATOR",
    "body": "Maybe some optimizoors disagree (and I'd be curious to hear their thoughts first), but my suggestion would be:\r\n- deprecate the existing `forge snapshot` behavior for the reasons mentioned above (it's sensitive to test file changes)\r\n- replace it with `forge snapshot <subcommand>` as spec'd out in https://github.com/foundry-rs/foundry/issues/2056, where `forge snapshot gas` uses the gas-report behavior and supports `--diff` and `--check` options\r\n\r\nIf we go this route I'd split things into a few PRs:\r\n- First PR: Adds `forge snapshot gas` with support for the diff/check flags, keep `forge snapshot` behavior but log a warning that \"it's deprecated and will be removed, use `forge snapshot gas` instead\r\n- Future PRs add additional subcommands to `forge snapshot`",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1616675401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
