{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4572",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4572/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4572/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4572/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4572",
  "id": 1626608222,
  "node_id": "I_kwDOGBlvNc5g9BJe",
  "number": 4572,
  "title": "The application panicked (crashed). Message:  called `Option::unwrap()` on a `None` value",
  "user": {
    "login": "MikeHathaway",
    "id": 13224356,
    "node_id": "MDQ6VXNlcjEzMjI0MzU2",
    "avatar_url": "https://avatars.githubusercontent.com/u/13224356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MikeHathaway",
    "html_url": "https://github.com/MikeHathaway",
    "followers_url": "https://api.github.com/users/MikeHathaway/followers",
    "following_url": "https://api.github.com/users/MikeHathaway/following{/other_user}",
    "gists_url": "https://api.github.com/users/MikeHathaway/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MikeHathaway/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MikeHathaway/subscriptions",
    "organizations_url": "https://api.github.com/users/MikeHathaway/orgs",
    "repos_url": "https://api.github.com/users/MikeHathaway/repos",
    "events_url": "https://api.github.com/users/MikeHathaway/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MikeHathaway/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-03-16T02:59:49Z",
  "updated_at": "2023-03-16T13:11:02Z",
  "closed_at": "2023-03-16T13:11:01Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (816e00b 2023-03-15T23:48:07.408117962Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge test\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\nThe bug occurs while running invariant tests on a forked network. If `vm.rollFork()` is used within the invariant tests, the application crashes with the following message: `Message:  called \"Option::unwrap()\" on a \"None\" value`.\r\n\r\nHere is the backtrace:\r\n```\r\nMessage:  called `Option::unwrap()` on a `None` value\r\nLocation: /home/computer/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-2.3.1/src/evm_impl.rs:261\r\n\r\nThis is a bug. Consider reporting it at https://github.com/foundry-rs/foundry\r\n\r\n  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\r\n   1: color_eyre::config::PanicHook::panic_report::h8d77887187ce1497\r\n      at <unknown source file>:<unknown line>\r\n   2: color_eyre::config::PanicHook::into_panic_hook::{{closure}}::h147a08adf4b74296\r\n      at <unknown source file>:<unknown line>\r\n   3: <alloc::boxed::Box<F,A> as core::ops::function::Fn<Args>>::call::h813f31c5cc72640d\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/alloc/src/boxed.rs:2032\r\n   4: std::panicking::rust_panic_with_hook::h2e61684db9120e8e\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/std/src/panicking.rs:692\r\n   5: std::panicking::begin_panic_handler::{{closure}}::h63d39cc19c97d34a\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/std/src/panicking.rs:577\r\n   6: std::sys_common::backtrace::__rust_end_short_backtrace::h8da6b271e1c3c543\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/std/src/sys_common/backtrace.rs:137\r\n   7: rust_begin_unwind<unknown>\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/std/src/panicking.rs:575\r\n   8: core::panicking::panic_fmt::h89c37196e57a859c\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/core/src/panicking.rs:64\r\n   9: core::panicking::panic::h6df13a00f7b57b98\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/core/src/panicking.rs:111\r\n  10: revm::evm_impl::EVMImpl<GSPEC,DB,_>::finalize::h38522f17d901b87e\r\n      at <unknown source file>:<unknown line>\r\n  11: <revm::evm_impl::EVMImpl<GSPEC,DB,_> as revm::evm_impl::Transact>::transact::h17df1d06a74b7007\r\n      at <unknown source file>:<unknown line>\r\n  12: foundry_evm::executor::Executor::call_raw::h84d9e2322c8090e3\r\n      at <unknown source file>:<unknown line>\r\n  13: core::ops::function::impls::<impl core::ops::function::Fn<A> for &F>::call::hfbd401bb222b4f4c\r\n      at <unknown source file>:<unknown line>\r\n  14: proptest::test_runner::runner::call_test::h60d0784af739d222\r\n      at <unknown source file>:<unknown line>\r\n  15: proptest::test_runner::runner::TestRunner::gen_and_run_case::h592257ab61574f81\r\n      at <unknown source file>:<unknown line>\r\n  16: proptest::test_runner::runner::TestRunner::run_in_process::h1801b91fc12abca1\r\n      at <unknown source file>:<unknown line>\r\n  17: proptest::test_runner::runner::TestRunner::run::h56466cf24f018569\r\n      at <unknown source file>:<unknown line>\r\n  18: foundry_evm::fuzz::invariant::executor::InvariantExecutor::invariant_fuzz::h514b01c12462e41f\r\n      at <unknown source file>:<unknown line>\r\n  19: forge::runner::ContractRunner::run_invariant_test::h411cde93516a8c31\r\n      at <unknown source file>:<unknown line>\r\n  20: forge::runner::ContractRunner::run_tests::hdf4c40e377495bd4\r\n      at <unknown source file>:<unknown line>\r\n  21: forge::multi_runner::MultiContractRunner::run_tests::hdfc938cde8ebf055\r\n      at <unknown source file>:<unknown line>\r\n  22: <rayon::iter::map::MapFolder<C,F> as rayon::iter::plumbing::Folder<T>>::consume::h031b6ac1f7114bf5\r\n      at <unknown source file>:<unknown line>\r\n  23: rayon::iter::plumbing::Folder::consume_iter::h7ffac4d26fd604c2\r\n      at <unknown source file>:<unknown line>\r\n  24: rayon::iter::plumbing::bridge_producer_consumer::helper::he4bfe72545d682e4\r\n      at <unknown source file>:<unknown line>\r\n  25: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once::h2decb729bc466890\r\n      at <unknown source file>:<unknown line>\r\n  26: <rayon_core::job::StackJob<L,F,R> as rayon_core::job::Job>::execute::h49490b6c1026b73f\r\n      at <unknown source file>:<unknown line>\r\n  27: rayon_core::registry::WorkerThread::wait_until_cold::h8636eb5784db2ef3\r\n      at <unknown source file>:<unknown line>\r\n  28: rayon_core::registry::ThreadBuilder::run::hb6b8f2dfaeccc535\r\n      at <unknown source file>:<unknown line>\r\n  29: std::sys_common::backtrace::__rust_begin_short_backtrace::hcdfdb035f3af8cbf\r\n      at <unknown source file>:<unknown line>\r\n  30: core::ops::function::FnOnce::call_once{{vtable.shim}}::h4a87f760cb8a67ee\r\n      at <unknown source file>:<unknown line>\r\n  31: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hdbff13d45d6b3b01\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/alloc/src/boxed.rs:2000\r\n  32: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h1e5384a2b7a0037a\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/alloc/src/boxed.rs:2000\r\n  33: std::sys::unix::thread::Thread::new::thread_start::h4b8540c4f94d9763\r\n      at /rustc/0468a00ae3fd6ef1a6a0f9eaf637d7aa9e604acc/library/std/src/sys/unix/thread.rs:108\r\n  34: start_thread<unknown>\r\n      at /build/glibc-CVJwZb/glibc-2.27/nptl/pthread_create.c:463\r\n  35: clone<unknown>\r\n      at /build/glibc-CVJwZb/glibc-2.27/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95\r\n\r\n```",
  "closed_by": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4572/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4572/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
