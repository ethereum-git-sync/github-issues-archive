{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1563",
  "id": 1229273782,
  "node_id": "I_kwDOGBlvNc5JRTq2",
  "number": 1563,
  "title": "Trace fails to match interface functions and events",
  "user": {
    "login": "dekz",
    "id": 27389,
    "node_id": "MDQ6VXNlcjI3Mzg5",
    "avatar_url": "https://avatars.githubusercontent.com/u/27389?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dekz",
    "html_url": "https://github.com/dekz",
    "followers_url": "https://api.github.com/users/dekz/followers",
    "following_url": "https://api.github.com/users/dekz/following{/other_user}",
    "gists_url": "https://api.github.com/users/dekz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dekz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dekz/subscriptions",
    "organizations_url": "https://api.github.com/users/dekz/orgs",
    "repos_url": "https://api.github.com/users/dekz/repos",
    "events_url": "https://api.github.com/users/dekz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dekz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3593644915,
      "node_id": "LA_kwDOGBlvNc7WMqtz",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-test",
      "name": "Cmd-forge-test",
      "color": "006B75",
      "default": false,
      "description": "Command: forge test"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3703753090,
      "node_id": "LA_kwDOGBlvNc7cwsmC",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/A-tracing",
      "name": "A-tracing",
      "color": "FBCA04",
      "default": false,
      "description": "Area: tracing"
    },
    {
      "id": 3759719790,
      "node_id": "LA_kwDOGBlvNc7gGMVu",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/P-low",
      "name": "P-low",
      "color": "D93F0B",
      "default": false,
      "description": "Priority: low"
    },
    {
      "id": 3759720129,
      "node_id": "LA_kwDOGBlvNc7gGMbB",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/D-hard",
      "name": "D-hard",
      "color": "0E8A16",
      "default": false,
      "description": "Difficulty: hard"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 125,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-05-12T14:44:03Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 7,
  "created_at": "2022-05-09T07:02:58Z",
  "updated_at": "2022-07-28T21:27:35Z",
  "closed_at": "2022-07-28T17:17:09Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (85f69d9 2022-05-09T00:04:25.613861+00:00)\n\n### What command(s) is the bug in?\n\nforge test -vvvv -f MAINNET_FORK\n\n### Operating System\n\nmacOS (M1)\n\n### Describe the bug\n\nExpected a Forge trace to match against signatures and events contained in an `interface`. \r\n\r\nOn the current version the signatures fail to match and the bytes4 is printed instead.\r\n\r\n```\r\n[PASS] testExample() (gas: 7688)\r\nTraces:\r\n  [7688] ContractTest::testExample()\r\n    ├─ [2480] 0xb4e1…c9dc::70a08231(000000000000000000000000b4c79dab8f259c7aee6e5b2aa729821864227e84) [staticcall]\r\n    │   └─ ← 0x0000000000000000000000000000000000000000000000000000000000000000\r\n    └─ ← ()\r\n```\r\n\r\nIf instead this interface is converted to a stubbed contract, and that contract is deployed, then the signatures match as expected.\r\n\r\n```\r\n[PASS] testStub() (gas: 7666)\r\nTraces:\r\n  [7666] ContractStubTest::testStub()\r\n    ├─ [2480] 0xb4e1…c9dc::balanceOf(ContractStubTest: [0xb4c79dab8f259c7aee6e5b2aa729821864227e84]) [staticcall]\r\n    │   └─ ← 0\r\n    └─ ← ()\r\n```\r\n\r\n\r\nRepro project can be found here: https://github.com/dekz/foundry-interface-match",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1120743676",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1120743676",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1120743676,
    "node_id": "IC_kwDOGBlvNc5CzTD8",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T07:29:10Z",
    "updated_at": "2022-05-09T07:29:10Z",
    "author_association": "MEMBER",
    "body": "We currently can't do this because we do the matching based on bytecode. To support this we would have to parse the test contract and determine it that way, but that would be way more complex (for imo, little gain), not cover all edge cases (e.g. if the interface uses an address in a storage variable) and even produce wrong guesses as well. Not sure what the best path forward is here.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1120743676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1121663487",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1121663487",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1121663487,
    "node_id": "IC_kwDOGBlvNc5C2zn_",
    "user": {
      "login": "dekz",
      "id": 27389,
      "node_id": "MDQ6VXNlcjI3Mzg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/27389?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dekz",
      "html_url": "https://github.com/dekz",
      "followers_url": "https://api.github.com/users/dekz/followers",
      "following_url": "https://api.github.com/users/dekz/following{/other_user}",
      "gists_url": "https://api.github.com/users/dekz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dekz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dekz/subscriptions",
      "organizations_url": "https://api.github.com/users/dekz/orgs",
      "repos_url": "https://api.github.com/users/dekz/repos",
      "events_url": "https://api.github.com/users/dekz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dekz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T22:58:14Z",
    "updated_at": "2022-05-09T22:58:14Z",
    "author_association": "NONE",
    "body": "Work around is to either:  \r\n* Modify interface to a stubbed contract (and deploy in test) so it finds the match\r\n* Export an `ETHERSCAN_API_KEY` to use the `EtherscanIdentifier` in various places.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1121663487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1122342033",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1122342033",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1122342033,
    "node_id": "IC_kwDOGBlvNc5C5ZSR",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-10T12:43:30Z",
    "updated_at": "2022-05-10T12:43:30Z",
    "author_association": "MEMBER",
    "body": "Sure, if these are forked tests then the recommended way is to set `ETHERSCAN_API_KEY`, but the repro you shared did not suggest it was forked tests :smile: ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1122342033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1125142737",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1125142737",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1125142737,
    "node_id": "IC_kwDOGBlvNc5DEFDR",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-12T15:34:34Z",
    "updated_at": "2022-05-12T15:35:07Z",
    "author_association": "COLLABORATOR",
    "body": "I'm running into this now and from a user perspective it definitely feels like a bug that should be fixed—it's confusing that my interface is defined and visible in the `out` folder but the trace doesn't decode it's methods, and the workarounds aren't ideal. This makes debugging harder when you have lots of interfaces, as traces become not very readable. \r\n\r\n> We currently can't do this because we do the matching based on bytecode. To support this we would have to parse the test contract and determine it that way, but that would be way more complex (for imo, little gain), not cover all edge cases (e.g. if the interface uses an address in a storage variable) and even produce wrong guesses as well. Not sure what the best path forward is here.\r\n\r\nCould we add fallback to attempt decoding by ABI when bytecode matching fails? Something like this:\r\n- Take the ABIs from all artifacts and merge them into a single vector of functions. If there's function selector collisions, just keep the first and log a warning so the user knows decoding may be inaccurate for some selectors. This is basically a mini 4byte.directory of all local, known signatures.\r\n- Attempt match by bytecode like we currently do\r\n- If no match is found, fallback to using the set of all functions to try decoding",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1125142737/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1172620347",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1172620347",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1172620347,
    "node_id": "IC_kwDOGBlvNc5F5MQ7",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-01T18:42:51Z",
    "updated_at": "2022-07-01T18:42:51Z",
    "author_association": "MEMBER",
    "body": "@dekz There's been some changes to tracing and new identifiers have been added, is this still an issue for you?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1172620347/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1198424418",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1198424418",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1198424418,
    "node_id": "IC_kwDOGBlvNc5HboFi",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T17:17:09Z",
    "updated_at": "2022-07-28T17:17:09Z",
    "author_association": "MEMBER",
    "body": "Closing - let me know if this is still an issue for you :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1198424418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1198649164",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1563#issuecomment-1198649164",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1563",
    "id": 1198649164,
    "node_id": "IC_kwDOGBlvNc5Hce9M",
    "user": {
      "login": "dekz",
      "id": 27389,
      "node_id": "MDQ6VXNlcjI3Mzg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/27389?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dekz",
      "html_url": "https://github.com/dekz",
      "followers_url": "https://api.github.com/users/dekz/followers",
      "following_url": "https://api.github.com/users/dekz/following{/other_user}",
      "gists_url": "https://api.github.com/users/dekz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dekz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dekz/subscriptions",
      "organizations_url": "https://api.github.com/users/dekz/orgs",
      "repos_url": "https://api.github.com/users/dekz/repos",
      "events_url": "https://api.github.com/users/dekz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dekz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T21:27:34Z",
    "updated_at": "2022-07-28T21:27:34Z",
    "author_association": "NONE",
    "body": "sorry mate just saw this, thanks so much, I'll give it a whirl today and report back if there are any issues.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1198649164/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
