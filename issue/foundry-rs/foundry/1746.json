{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1746",
  "id": 1250060989,
  "node_id": "I_kwDOGBlvNc5Kgmq9",
  "number": 1746,
  "title": "Anvil crashes with: `Failed to get storage`",
  "user": {
    "login": "sunwrobert",
    "id": 6511174,
    "node_id": "MDQ6VXNlcjY1MTExNzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6511174?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sunwrobert",
    "html_url": "https://github.com/sunwrobert",
    "followers_url": "https://api.github.com/users/sunwrobert/followers",
    "following_url": "https://api.github.com/users/sunwrobert/following{/other_user}",
    "gists_url": "https://api.github.com/users/sunwrobert/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sunwrobert/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sunwrobert/subscriptions",
    "organizations_url": "https://api.github.com/users/sunwrobert/orgs",
    "repos_url": "https://api.github.com/users/sunwrobert/repos",
    "events_url": "https://api.github.com/users/sunwrobert/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sunwrobert/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 4077188949,
      "node_id": "LA_kwDOGBlvNc7zBPdV",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-anvil",
      "name": "C-anvil",
      "color": "5319E7",
      "default": false,
      "description": "Command: anvil"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2022-05-26T20:48:56Z",
  "updated_at": "2022-05-29T08:50:36Z",
  "closed_at": "2022-05-29T08:50:36Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (fc534d9 2022-05-23T00:04:01.500526763Z)\n\n### What command(s) is the bug in?\n\nanvil --fork-url\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nHi foundry team, I'm from the OpenSea team. We're currently in the process of trying to migrate from hardhat in our e2e tests to anvil and are running into some issues. It appears that anvil crashes during our testing with a pretty obscure error. \r\n\r\nFull trace: \r\n```\r\nproject-polygon-mainnet-1  | thread 'fork-backend-thread' panicked at 'Failed to get storage for 0x8f3câ€¦a063 at 63793490285618327566453423202919073693767156451540437757185495221258080913552\r\nproject-polygon-mainnet-1  | error sending request for url (https://polygon-mainnet.g.alchemy.com/v2/XXXXXXXXXXX): connection error: connection reset', /home/runner/work/foundry/foundry/evm/src/executor/fork/backend.rs:302:33\r\nproject-polygon-mainnet-1  | note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nproject-polygon-mainnet-1  | ./scripts/run_polygon.sh: line 5:    10 Aborted                 (core dumped) anvil --host 0.0.0.0 --fork-url=\"https://polygon-mainnet.g.alchemy.com/v2/XXXXXXXXXXXXXXXXX\" --fork-block-number=28798565 --port=8545\r\n```\r\n\r\nAny idea what's going on here? \r\n\r\nWould also be great if we could have a direct contact for assistance in this migration if that would be possible. Thanks!",
  "closed_by": {
    "login": "sunwrobert",
    "id": 6511174,
    "node_id": "MDQ6VXNlcjY1MTExNzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6511174?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sunwrobert",
    "html_url": "https://github.com/sunwrobert",
    "followers_url": "https://api.github.com/users/sunwrobert/followers",
    "following_url": "https://api.github.com/users/sunwrobert/following{/other_user}",
    "gists_url": "https://api.github.com/users/sunwrobert/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sunwrobert/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sunwrobert/subscriptions",
    "organizations_url": "https://api.github.com/users/sunwrobert/orgs",
    "repos_url": "https://api.github.com/users/sunwrobert/repos",
    "events_url": "https://api.github.com/users/sunwrobert/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sunwrobert/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139392386",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1139392386",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1139392386,
    "node_id": "IC_kwDOGBlvNc5D6b-C",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T08:21:28Z",
    "updated_at": "2022-05-27T08:21:28Z",
    "author_association": "MEMBER",
    "body": "> `error sending request for url (https://polygon-mainnet.g.alchemy.com/v2/XXXXXXXXXXX): connection error: connection reset'`\r\n\r\nlooks like you hit a connection reset error.\r\nwe currently panic/crash in fork mode if we can't connect because that's the safe way.\r\n\r\nsince alchemy updated how they count their units, we've been Hit with a lot of 429 rate limit errors, we're about to integrate a rate aware provider that automatically does retries.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139392386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139727084",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1139727084",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1139727084,
    "node_id": "IC_kwDOGBlvNc5D7trs",
    "user": {
      "login": "sunwrobert",
      "id": 6511174,
      "node_id": "MDQ6VXNlcjY1MTExNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6511174?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sunwrobert",
      "html_url": "https://github.com/sunwrobert",
      "followers_url": "https://api.github.com/users/sunwrobert/followers",
      "following_url": "https://api.github.com/users/sunwrobert/following{/other_user}",
      "gists_url": "https://api.github.com/users/sunwrobert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sunwrobert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sunwrobert/subscriptions",
      "organizations_url": "https://api.github.com/users/sunwrobert/orgs",
      "repos_url": "https://api.github.com/users/sunwrobert/repos",
      "events_url": "https://api.github.com/users/sunwrobert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sunwrobert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T15:32:11Z",
    "updated_at": "2022-05-27T15:32:58Z",
    "author_association": "NONE",
    "body": "Are you also aware of any read timeouts? Have been getting a decent amount of errors regarding that. Don't think it's completely related to the above as was seeing read timeout logs at times where there weren't any crashes \n\nOr maybe the retries above you were mentioning will help with that. Thanks for looking into this",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139727084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139747078",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1139747078",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1139747078,
    "node_id": "IC_kwDOGBlvNc5D7ykG",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T15:56:38Z",
    "updated_at": "2022-05-27T15:56:38Z",
    "author_association": "MEMBER",
    "body": "wdym by \"read timeouts\"?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139747078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139755384",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1139755384",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1139755384,
    "node_id": "IC_kwDOGBlvNc5D70l4",
    "user": {
      "login": "sunwrobert",
      "id": 6511174,
      "node_id": "MDQ6VXNlcjY1MTExNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6511174?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sunwrobert",
      "html_url": "https://github.com/sunwrobert",
      "followers_url": "https://api.github.com/users/sunwrobert/followers",
      "following_url": "https://api.github.com/users/sunwrobert/following{/other_user}",
      "gists_url": "https://api.github.com/users/sunwrobert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sunwrobert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sunwrobert/subscriptions",
      "organizations_url": "https://api.github.com/users/sunwrobert/orgs",
      "repos_url": "https://api.github.com/users/sunwrobert/repos",
      "events_url": "https://api.github.com/users/sunwrobert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sunwrobert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T16:07:20Z",
    "updated_at": "2022-05-27T16:07:20Z",
    "author_association": "NONE",
    "body": "Our client that hits our RPC node (anvil), for example getting the latest block, just times out, due to anvil not sending us a response back. This only happens later on in our test cycle. Sorry I don't have more concrete numbers. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139755384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139762716",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1139762716",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1139762716,
    "node_id": "IC_kwDOGBlvNc5D72Yc",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T16:15:10Z",
    "updated_at": "2022-05-27T16:15:10Z",
    "author_association": "MEMBER",
    "body": "there was an issue that could lead to situation like that, which was fixed in https://github.com/foundry-rs/foundry/pull/1689 68acdf52de5a5a951419ad788ad4e9ba508c6011\r\n\r\nthe version you referenced predates that fix, should be included in nightly though",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139762716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139918032",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1139918032",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1139918032,
    "node_id": "IC_kwDOGBlvNc5D8cTQ",
    "user": {
      "login": "sunwrobert",
      "id": 6511174,
      "node_id": "MDQ6VXNlcjY1MTExNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6511174?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sunwrobert",
      "html_url": "https://github.com/sunwrobert",
      "followers_url": "https://api.github.com/users/sunwrobert/followers",
      "following_url": "https://api.github.com/users/sunwrobert/following{/other_user}",
      "gists_url": "https://api.github.com/users/sunwrobert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sunwrobert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sunwrobert/subscriptions",
      "organizations_url": "https://api.github.com/users/sunwrobert/orgs",
      "repos_url": "https://api.github.com/users/sunwrobert/repos",
      "events_url": "https://api.github.com/users/sunwrobert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sunwrobert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T18:25:59Z",
    "updated_at": "2022-05-27T18:25:59Z",
    "author_association": "NONE",
    "body": "Seem to still be hitting that issue, but would love to try again when the rate aware provider you mentioned before gets implemented. Any idea on when that would be?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1139918032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1140394126",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1140394126",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1140394126,
    "node_id": "IC_kwDOGBlvNc5D-QiO",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T07:26:48Z",
    "updated_at": "2022-05-29T07:26:48Z",
    "author_association": "MEMBER",
    "body": "@sunwrobert the rate limiting should be present in the latest version, can you give it another try?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1140394126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1140405538",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1746#issuecomment-1140405538",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1746",
    "id": 1140405538,
    "node_id": "IC_kwDOGBlvNc5D-TUi",
    "user": {
      "login": "sunwrobert",
      "id": 6511174,
      "node_id": "MDQ6VXNlcjY1MTExNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6511174?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sunwrobert",
      "html_url": "https://github.com/sunwrobert",
      "followers_url": "https://api.github.com/users/sunwrobert/followers",
      "following_url": "https://api.github.com/users/sunwrobert/following{/other_user}",
      "gists_url": "https://api.github.com/users/sunwrobert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sunwrobert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sunwrobert/subscriptions",
      "organizations_url": "https://api.github.com/users/sunwrobert/orgs",
      "repos_url": "https://api.github.com/users/sunwrobert/repos",
      "events_url": "https://api.github.com/users/sunwrobert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sunwrobert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T08:50:36Z",
    "updated_at": "2022-05-29T08:50:36Z",
    "author_association": "NONE",
    "body": "The rate limiting seems to have fixed it. I do still have other issues but will open a separate issue for those. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1140405538/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
