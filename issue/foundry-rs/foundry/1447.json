{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1447",
  "id": 1219364940,
  "node_id": "I_kwDOGBlvNc5IrghM",
  "number": 1447,
  "title": "Nul Byte Error when using FFI ",
  "user": {
    "login": "Gaonuk",
    "id": 43006704,
    "node_id": "MDQ6VXNlcjQzMDA2NzA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/43006704?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gaonuk",
    "html_url": "https://github.com/Gaonuk",
    "followers_url": "https://api.github.com/users/Gaonuk/followers",
    "following_url": "https://api.github.com/users/Gaonuk/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gaonuk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gaonuk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gaonuk/subscriptions",
    "organizations_url": "https://api.github.com/users/Gaonuk/orgs",
    "repos_url": "https://api.github.com/users/Gaonuk/repos",
    "events_url": "https://api.github.com/users/Gaonuk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gaonuk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394237,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjM3",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-question",
      "name": "T-question",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: question"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-04-28T22:11:35Z",
  "updated_at": "2022-04-29T17:04:43Z",
  "closed_at": "2022-04-29T17:04:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (107f477 2022-04-28T00:12:56.368074407+00:00)\n\n### What command(s) is the bug in?\n\nforge test --ffi\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nRunning forge test with ffi enabled and trying to pass an encoded array of addresses generates a `[FAIL. Reason: nul byte found in provided data]`\r\n\r\nHere is the code i'm using that creates the error\r\n``` solidity\r\n(address[] memory components, uint256[] memory quantities) = exchangeModule.getRequiredIssuanceComponents(address(issuanceModule), false, outputToken, web3Amount);\r\nstring[] memory inputs = new string[](4);\r\ninputs[0] = \"node\";\r\ninputs[1] = \"scripts/fetch-quotes.js\";\r\ninputs[2] = string(abi.encode(components)); // I want to pass the array to the JS file\r\ninputs[3] = string(abi.encode(quantities));\r\nbytes memory res = vm.ffi(inputs);\r\n```\r\n\r\nHere is the error i'm getting\r\n\r\n![nul](https://user-images.githubusercontent.com/43006704/165855951-125a7efb-3e53-4da5-a38a-c0042645256c.png)\r\n\r\n",
  "closed_by": {
    "login": "Gaonuk",
    "id": 43006704,
    "node_id": "MDQ6VXNlcjQzMDA2NzA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/43006704?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gaonuk",
    "html_url": "https://github.com/Gaonuk",
    "followers_url": "https://api.github.com/users/Gaonuk/followers",
    "following_url": "https://api.github.com/users/Gaonuk/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gaonuk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gaonuk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gaonuk/subscriptions",
    "organizations_url": "https://api.github.com/users/Gaonuk/orgs",
    "repos_url": "https://api.github.com/users/Gaonuk/repos",
    "events_url": "https://api.github.com/users/Gaonuk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gaonuk/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1112714991",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1447#issuecomment-1112714991",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447",
    "id": 1112714991,
    "node_id": "IC_kwDOGBlvNc5CUq7v",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-28T22:33:21Z",
    "updated_at": "2022-04-28T22:34:58Z",
    "author_association": "MEMBER",
    "body": "Does your script expect raw bytes encoded as a string, or does it expect bytes encoded as a hexadecimal string? The reason I'm asking is that `string(bytes(..))` just converts the bytes to their corresponding UTF8 characters, it does not result in a string like \"0xblablabla\".\r\n\r\nI think the FFI cheatcode is working(?), but the input to your script is incorrect, which makes it exit with exit code 1, which is why you revert here.\r\n\r\nIf you want to convert the bytes to a hexadecimal string, you need to use some conversion function that handles that for you",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1112714991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1113533636",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1447#issuecomment-1113533636",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1447",
    "id": 1113533636,
    "node_id": "IC_kwDOGBlvNc5CXyzE",
    "user": {
      "login": "Gaonuk",
      "id": 43006704,
      "node_id": "MDQ6VXNlcjQzMDA2NzA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/43006704?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gaonuk",
      "html_url": "https://github.com/Gaonuk",
      "followers_url": "https://api.github.com/users/Gaonuk/followers",
      "following_url": "https://api.github.com/users/Gaonuk/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gaonuk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gaonuk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gaonuk/subscriptions",
      "organizations_url": "https://api.github.com/users/Gaonuk/orgs",
      "repos_url": "https://api.github.com/users/Gaonuk/repos",
      "events_url": "https://api.github.com/users/Gaonuk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gaonuk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T17:04:43Z",
    "updated_at": "2022-04-29T17:04:43Z",
    "author_association": "NONE",
    "body": "Thanks! I found a conversor to change from bytes to bytes32 and then from bytes32 to hex and that did the work!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1113533636/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
