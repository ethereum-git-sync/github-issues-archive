{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5902",
  "id": 1912184845,
  "node_id": "I_kwDOGBlvNc5x-aAN",
  "number": 5902,
  "title": "Remappings with the same prefix but different contexts are broken",
  "user": {
    "login": "mateuszradomski",
    "id": 33978857,
    "node_id": "MDQ6VXNlcjMzOTc4ODU3",
    "avatar_url": "https://avatars.githubusercontent.com/u/33978857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mateuszradomski",
    "html_url": "https://github.com/mateuszradomski",
    "followers_url": "https://api.github.com/users/mateuszradomski/followers",
    "following_url": "https://api.github.com/users/mateuszradomski/following{/other_user}",
    "gists_url": "https://api.github.com/users/mateuszradomski/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mateuszradomski/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mateuszradomski/subscriptions",
    "organizations_url": "https://api.github.com/users/mateuszradomski/orgs",
    "repos_url": "https://api.github.com/users/mateuszradomski/repos",
    "events_url": "https://api.github.com/users/mateuszradomski/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mateuszradomski/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-09-25T19:52:41Z",
  "updated_at": "2023-10-18T08:50:54Z",
  "closed_at": "2023-10-18T08:50:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (ec3f9bd 2023-09-19T13:46:42.143604000Z)\n\n### What command(s) is the bug in?\n\nevery forge subcommand\n\n### Operating System\n\nNone\n\n### Describe the bug\n\nHello,\r\n\r\nWe're trying to use forge for testing in L2Beat but we've encountered a problem that makes it hard to integrate it into our workflow. The problem in question is that since we download all of the source code from Etherscan we end up with a big directory with many different subdirectories where each one of them corresponds to source code for a given contract in a given project.\r\n\r\nSomething like this:\r\n\r\n```\r\n.code\r\n├── Colosseum\r\n│   ├── implementation\r\n│   └── proxy\r\n└── KromaPortal\r\n    ├── implementation\r\n    └── proxy\r\n```\r\n\r\nWe would want to create a single foundry project to test all of the different contracts. Each contract provides its own dependencies like `@openzeppelin` in the `implementation` folder. The idea we came up with is to use remappings and create a following structure for the test folder\r\n\r\n```\r\ntest\r\n├── Colosseum\r\n└── KromaPortal\r\n```\r\n\r\nWhere for each test subdirectory we would specify a different remapping using the context feature of solc. As its [documentation](https://docs.soliditylang.org/en/latest/path-resolution.html#import-remapping) specifies, it is possible to create a remapping per module using the context field with the same prefix but a different value.\r\n\r\n>As a more complex example, suppose you rely on a module that uses an old version of dapp-bin that you checked out to /project/dapp-bin_old, then you can run:\r\n> ```\r\n>solc module1:github.com/ethereum/dapp-bin/=dapp-bin/ \\\r\n>      module2:github.com/ethereum/dapp-bin/=dapp-bin_old/ \\\r\n>      --base-path /project \\\r\n>      source.sol\r\n>```\r\n\r\nBut creating a following remapping (it does not matter there the remapping is specified, both `remappings.txt` and `foundry.toml` do not work) fails to be parsed by `forge remappings` subcommand:\r\n\r\n```\r\ntest/Colosseum/:@code/=code/Colosseum/implementation/\r\ntest/KromaPortal/:@code/=code/KromaPortal/implementation/\r\ncode/Colosseum/:@openzeppelin/=code/Colosseum/implementation/node_modules/@openzeppelin/\r\ncode/Colosseum/:@rari-capital/=code/Colosseum/implementation/node_modules/@rari-capital/\r\ncode/KromaPortal/:@openzeppelin/=code/KromaPortal/implementation/node_modules/@openzeppelin/\r\ncode/KromaPortal/:@rari-capital/=code/KromaPortal/implementation/node_modules/@rari-capital/\r\n```\r\n\r\n---\r\n\r\nExpected `forge remappings` output:\r\n```\r\ntest/Colosseum/:@code/=code/Colosseum/implementation/\r\ntest/KromaPortal/:@code/=code/KromaPortal/implementation/\r\ncode/Colosseum/:@openzeppelin/=code/Colosseum/implementation/node_modules/@openzeppelin/\r\ncode/Colosseum/:@rari-capital/=code/Colosseum/implementation/node_modules/@rari-capital/\r\ncode/KromaPortal/:@openzeppelin/=code/KromaPortal/implementation/node_modules/@openzeppelin/\r\ncode/KromaPortal/:@rari-capital/=code/KromaPortal/implementation/node_modules/@rari-capital/\r\n```\r\n\r\nActual `forge remappings` output:\r\n```\r\ntest/Colosseum/:@code/=code/Colosseum/implementation/\r\ncode/Colosseum/:@openzeppelin/=code/Colosseum/implementation/node_modules/@openzeppelin/\r\ncode/Colosseum/:@rari-capital/=code/Colosseum/implementation/node_modules/@rari-capital/\r\n```\r\n\r\n---\r\n\r\nThis is not only observed in the `forge remappings` subcommand but `forge test` also fails as if it did not know the second set of remappings. I've created a repository that will allow you to repro that case [here](https://github.com/mateuszradomski/forge-repo). \r\nI've also been able to **fix the issue** myself, the code is in #5901, I've marked it as a draft since I don't expect that the lack of tests is going to be passable, but I wanted to provide a jumping of point anyway.\r\n\r\nI'm open to answering any questions to get this issue solved as soon as possible, thanks in advance!",
  "closed_by": {
    "login": "mateuszradomski",
    "id": 33978857,
    "node_id": "MDQ6VXNlcjMzOTc4ODU3",
    "avatar_url": "https://avatars.githubusercontent.com/u/33978857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mateuszradomski",
    "html_url": "https://github.com/mateuszradomski",
    "followers_url": "https://api.github.com/users/mateuszradomski/followers",
    "following_url": "https://api.github.com/users/mateuszradomski/following{/other_user}",
    "gists_url": "https://api.github.com/users/mateuszradomski/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mateuszradomski/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mateuszradomski/subscriptions",
    "organizations_url": "https://api.github.com/users/mateuszradomski/orgs",
    "repos_url": "https://api.github.com/users/mateuszradomski/repos",
    "events_url": "https://api.github.com/users/mateuszradomski/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mateuszradomski/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1742327708",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5902#issuecomment-1742327708",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902",
    "id": 1742327708,
    "node_id": "IC_kwDOGBlvNc5n2c-c",
    "user": {
      "login": "Evalir",
      "id": 26014927,
      "node_id": "MDQ6VXNlcjI2MDE0OTI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Evalir",
      "html_url": "https://github.com/Evalir",
      "followers_url": "https://api.github.com/users/Evalir/followers",
      "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
      "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
      "organizations_url": "https://api.github.com/users/Evalir/orgs",
      "repos_url": "https://api.github.com/users/Evalir/repos",
      "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Evalir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-02T02:39:57Z",
    "updated_at": "2023-10-02T02:39:57Z",
    "author_association": "MEMBER",
    "body": "Right, so, remapping contexts, at this point in time, are not supported. We tried to introduce them back in July but ran into the issue that introducing them can break existing repo setups for a _lot_ of users, therefore, we're a bit wary of introducing them again. Will look at the PR draft!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1742327708/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1767985640",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5902#issuecomment-1767985640",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5902",
    "id": 1767985640,
    "node_id": "IC_kwDOGBlvNc5pYVHo",
    "user": {
      "login": "mateuszradomski",
      "id": 33978857,
      "node_id": "MDQ6VXNlcjMzOTc4ODU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33978857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mateuszradomski",
      "html_url": "https://github.com/mateuszradomski",
      "followers_url": "https://api.github.com/users/mateuszradomski/followers",
      "following_url": "https://api.github.com/users/mateuszradomski/following{/other_user}",
      "gists_url": "https://api.github.com/users/mateuszradomski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mateuszradomski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mateuszradomski/subscriptions",
      "organizations_url": "https://api.github.com/users/mateuszradomski/orgs",
      "repos_url": "https://api.github.com/users/mateuszradomski/repos",
      "events_url": "https://api.github.com/users/mateuszradomski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mateuszradomski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-18T08:50:53Z",
    "updated_at": "2023-10-18T08:50:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing as #5901 has been merged.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1767985640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
