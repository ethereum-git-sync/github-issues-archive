{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4815",
  "id": 1681568043,
  "node_id": "I_kwDOGBlvNc5kOrEr",
  "number": 4815,
  "title": "`cast run` reverts transactions that were previously mined",
  "user": {
    "login": "ArielTM",
    "id": 20728006,
    "node_id": "MDQ6VXNlcjIwNzI4MDA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/20728006?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ArielTM",
    "html_url": "https://github.com/ArielTM",
    "followers_url": "https://api.github.com/users/ArielTM/followers",
    "following_url": "https://api.github.com/users/ArielTM/following{/other_user}",
    "gists_url": "https://api.github.com/users/ArielTM/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ArielTM/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ArielTM/subscriptions",
    "organizations_url": "https://api.github.com/users/ArielTM/orgs",
    "repos_url": "https://api.github.com/users/ArielTM/repos",
    "events_url": "https://api.github.com/users/ArielTM/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ArielTM/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752609,
      "node_id": "LA_kwDOGBlvNc7cwseh",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-cast",
      "name": "C-cast",
      "color": "5319E7",
      "default": false,
      "description": "Command: cast"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-04-24T15:42:47Z",
  "updated_at": "2023-06-14T11:41:51Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nCast\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (8307d6d 2023-04-20T00:04:05.351215855Z)\n\n### What command(s) is the bug in?\n\ncast run 0x4f96531fea4c57ff7f449eda5528aa3b888e8c5a3895a20b8e290236859b803\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nFollowing https://github.com/foundry-rs/foundry/issues/4784#issuecomment-1520402694\r\n\r\nIt seems cast run reverts certain txs although they were ok on-chain (on BSC)\r\n\r\nMy guess is that during the block tx replay a tx got reverted due to gas issue, but it's just a guess.\r\n\r\nFor example:\r\n```\r\ncast run 0x4f96531fea4c57ff7f449eda5528aa3b888e8c5a3895a20b8e290236859b803\r\n\r\nTraces:\r\n  [10636] 0x0000000000000000000000000000000000002000::handlePackage(0x00000000000000000000000000000000000000000000000000000e35fa931a0000f86ea0424e42000000000000000000000000000000000000000000000000000000000094000000000000000000000000000000000000000088012640e60f85900094652743b63551ff7801390c3f9c9e7c6f813934ab9424a72d29e07cc9f3da8b84928c3f01cbed1667068463386bb1, 0x0aca090a066961766c3a76120e00000100380200000000010da5c11aaf09ad090aaa090a2f08191084a3b80818c185d4800122206a972442231cdcbd083f53f5b6e7d1364d01a7c3e39481a393663421d9d91e730a2f081810b2e4b90518c185d480012220015e9258171954de124eadca473471c85a218d1b4f30ab6046123df79b143e100a2f081710b2a4ba0218c185d480012220653ec3905c6eea07cd6122664c235a5bbee741796e9beb0090b651f1881aa6af0a2e081610b2a47b18c185d48001222010da239ec014e3708bb63394a6ac659bf0a5775e01fb061ba47489f5a70a1e590a2e081510b2a44b18c185d48001222016d590ab6e451029d6e0fe2e414519bad0722c7960915b09709a8d79489e689f0a2e081410b2a41b18c185d4800122206e5d42435b893a6ef3d2c3226dc3d8fc6298b50765c14401717cce9d4779b1740a2e081310b2a40f18c185d480012220a66c4e211073542bdfbe41b7ffb3c97233e1328e08307585572572e2086a70660a2e081210b2a40918c185d480012a20738409db352aca07a690bc4ded764df13f89fe2c67b52cc4abe46b6c2fc338eb0a2e081110c9cd0718c185d480012220353625c7e426e552dc34322c8f6611b7739c284396701459a688b207b5dbf3820a2e081010c9cd0318c185d480012220b1aedefe5cc273a110c724013f06d2bc2ad75593cb6059a1368518c9ab1a00a80a2e080f10c9cd0118c185d4800122205ea9f3914db297bb2a2167c73b48d65ef750412881a41b26431b505e1b0807120a2d080e10c94d18c185d480012220b97f7e32e4d277849f64577f85a44e3b6d9a1d2530269ebe30be41b39b440b200a2d080d10c92d18c185d4800122200399c47d3bbf6ed48669168eb251d5fd752b00533814d000f38712dd62964ea30a2d080c10c91d18c185d480012220d01401b0367f7ad0a8e27c68191ca1c9f372c856b92b5a88ce18afc7ec8b57220a2d080b10c90d18c185d4800122201c49817ed769b2c971d2d664a0159536ea9d2dd5eb6806664d45cb96454887cb0a2d080a10c90518c185d48001222087d1784161028044abe3a22bbc0cf6ec1ffef84fe8623822f0bc678d1fde774c0a2d080910c90318c185d4800122201bd56a7c0b5ef2e680e787d00d2d939eda10c179a42cf7263c3b8076b9290a450a2d080810c90118c185d480012220e23dec73d06c81b1262b666a4cf2eeedb11ffeca9904d8c483a80064b0fc88290a2c0807104918c185d48001222040263f2dfc02dd566655722724fe81fe18b87232ac40cb05542050f092b787a40a2c0806102918c185d480012220f1b4196785570bd4d2cdb1aabd75073fcfd03d149178262eee1aa586897935340a2c0805101918c185d480012220ba2a4a6a89d2016af614ddf0f6a188c5778d3d904bf08c9f32d5f67b6ad31f630a2c0804100918c185d480012a203e063ec1a405429330acbf3c8d8d9b9bc0896b62e16c402e5278a433c26a38860a2c08021004189e84d480012220d3de7e1f460416dfcfd7087b3cea53d69cd14bef0d0356e00237a99393ae08430a2c0801100218b782d480012a2079910f25ca52937622a172ffe733d9855617ea97b94312e7778d03339d49fd111a380a0e00000100380200000000010da5c11220dc019dfc95c17d4e6cc9b01a0af7e19b4d65bb5f8079c5f0e4c610ea3b83de8418daffd380010aa0060a0a6d756c746973746f726512036962631a8c068a060a87060a370a0974696d655f6c6f636b122a0a2808c285d48001122096061422d74bba67611b6dacdf2f5af0c7f2dd691b58dda2c127fab323a86f590a340a06627269646765122a0a2808c285d4800112201696f48f0831247582113e127d54c8dfd5a83ce7d59f87b5dbc43d3289287f000a330a057374616b65122a0a2808c285d4800112205e1f9742d64ec7c4201b50cbce12811434e94466968db0a46219df27ff4591250a310a03696263122a0a2808c285d480011220802e53b03b5102a5ded1616eed192eadbacf44afd0c05bbd5fb940d2ce9ad2260a310a03646578122a0a2808c285d480011220cad6f6f6afb55918aa5bbdefaea0aaa3f51dd2690c9e47121807edcff0097b450a300a027363122a0a2808c285d480011220da94c326004cb8820c79bf56dc48f6012398aef99cdc5d9cc67232af0a05f87e0a330a057061697273122a0a2808c285d480011220169b9ad412650e0f5052d93b1e147de1426eddad2ebd37d486c5bb030bea0f220a310a03676f76122a0a2808c285d480011220b0ac9a0b0d9d5acfd9576e46350fd053891aa4906c9cef12f0543f84ff0dcb7e0a360a08736c617368696e67122a0a2808c285d4800112201f1e46c77ff40db56b5d452c366d00fb31407ec226cb0fd62622d52f36310c4e0a120a066f7261636c6512080a0608c285d480010a390a0b61746f6d69635f73776170122a0a2808c285d480011220346b46d969a5f8ba7da621a101887d6175c5a6d2e280f9a07a64984ae4f6bd320a0f0a0376616c12080a0608c285d480010a100a046d61696e12080a0608c285d480010a310a03616363122a0a2808c285d4800112201d4cb45805ac0bfdb6a631771d4915aee28b9f6e08d87afa6af5f3a0400de7880a180a0c7374616b655f72657761726412080a0608c285d480010a340a06706172616d73122a0a2808c285d4800112206a1d4fb8b9332ca6a41d90b7df90081123fcd32c709c550d66078c75b16ef0730a340a06746f6b656e73122a0a2808c285d4800112207a39d6d967cb7223678c7046072f9c97a9ac774a290352ea0d677fb0379722c8, 269812419, 17671617, 2) \r\n    ├─ [2500] 0x0000000000000000000000000000000000001006::isRelayer(0x8224340C3b5135528327a56Df2f403AE619851e2) [staticcall]\r\n    │   └─ ← 0x0000000000000000000000000000000000000000000000000000000000000001\r\n    └─ ← \"sequence not in order\"\r\n\r\n\r\nTransaction failed.\r\nGas used: 66532\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1590620061",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4815#issuecomment-1590620061",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815",
    "id": 1590620061,
    "node_id": "IC_kwDOGBlvNc5ezu-d",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-14T07:21:07Z",
    "updated_at": "2023-06-14T07:21:07Z",
    "author_association": "MEMBER",
    "body": "Cc @rakita",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1590620061/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1590630832",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4815#issuecomment-1590630832",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815",
    "id": 1590630832,
    "node_id": "IC_kwDOGBlvNc5ezxmw",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-14T07:29:29Z",
    "updated_at": "2023-06-14T07:29:29Z",
    "author_association": "MEMBER",
    "body": "Cc @rakita @ArielTM what is a good RPC url to repro?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1590630832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1590828100",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4815#issuecomment-1590828100",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815",
    "id": 1590828100,
    "node_id": "IC_kwDOGBlvNc5e0hxE",
    "user": {
      "login": "rakita",
      "id": 13179220,
      "node_id": "MDQ6VXNlcjEzMTc5MjIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13179220?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rakita",
      "html_url": "https://github.com/rakita",
      "followers_url": "https://api.github.com/users/rakita/followers",
      "following_url": "https://api.github.com/users/rakita/following{/other_user}",
      "gists_url": "https://api.github.com/users/rakita/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rakita/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rakita/subscriptions",
      "organizations_url": "https://api.github.com/users/rakita/orgs",
      "repos_url": "https://api.github.com/users/rakita/repos",
      "events_url": "https://api.github.com/users/rakita/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rakita/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-14T09:23:32Z",
    "updated_at": "2023-06-14T09:23:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Cc @rakita\r\n\r\n@gakonst It is related to BSC chain, I am not familiar with the differences.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1590828100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1591025597",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4815#issuecomment-1591025597",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4815",
    "id": 1591025597,
    "node_id": "IC_kwDOGBlvNc5e1R-9",
    "user": {
      "login": "ArielTM",
      "id": 20728006,
      "node_id": "MDQ6VXNlcjIwNzI4MDA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/20728006?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ArielTM",
      "html_url": "https://github.com/ArielTM",
      "followers_url": "https://api.github.com/users/ArielTM/followers",
      "following_url": "https://api.github.com/users/ArielTM/following{/other_user}",
      "gists_url": "https://api.github.com/users/ArielTM/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ArielTM/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ArielTM/subscriptions",
      "organizations_url": "https://api.github.com/users/ArielTM/orgs",
      "repos_url": "https://api.github.com/users/ArielTM/repos",
      "events_url": "https://api.github.com/users/ArielTM/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ArielTM/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-14T11:37:26Z",
    "updated_at": "2023-06-14T11:41:51Z",
    "author_association": "NONE",
    "body": "@gakonst @rakita Sorry about this tx hash, I don't know where it came from. Let's focus on 0x72f9b15c44529b1681c14e2650664d2aca9e41b68474e16fd3c15003f12e0130 mentioned here https://github.com/foundry-rs/foundry/issues/4784 .\r\nI don't think BSC has different gas rule, it's just in a different evm version. I guess a BSC fix would be defining evm versions based on the BSC blocks\r\n\r\nYou can reproduce using \r\n```\r\ncurl http://127.0.0.1:8545/ \\\r\n  -X POST \\\r\n  -H \"Content-Type: application/json\" \\\r\n  --data '{\"method\":\"trace_replayTransaction\",\"params\":[\"0x72f9b15c44529b1681c14e2650664d2aca9e41b68474e16fd3c15003f12e0130\",[\"trace\"]],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1591025597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
