{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6703",
  "id": 2064883123,
  "node_id": "I_kwDOGBlvNc57E52z",
  "number": 6703,
  "title": "Variable _1 is one level too deep in the stack",
  "user": {
    "login": "Renzo1",
    "id": 32818202,
    "node_id": "MDQ6VXNlcjMyODE4MjAy",
    "avatar_url": "https://avatars.githubusercontent.com/u/32818202?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Renzo1",
    "html_url": "https://github.com/Renzo1",
    "followers_url": "https://api.github.com/users/Renzo1/followers",
    "following_url": "https://api.github.com/users/Renzo1/following{/other_user}",
    "gists_url": "https://api.github.com/users/Renzo1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Renzo1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Renzo1/subscriptions",
    "organizations_url": "https://api.github.com/users/Renzo1/orgs",
    "repos_url": "https://api.github.com/users/Renzo1/repos",
    "events_url": "https://api.github.com/users/Renzo1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Renzo1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2024-01-04T02:01:55Z",
  "updated_at": "2024-01-04T13:47:59Z",
  "closed_at": "2024-01-04T13:47:59Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "My foundry tests suddenly stopped working. Could anyone please help me understand why a previously functional foundry test might fail due to the following error?\r\n```\r\nError:\r\nCompiler run failed:\r\nError: Yul exception: Variable _1 is one level too deep in the stack [ RET memPtr _2 _5 zero_struct_VaultForTest_mpos _1 _6 _4 var_j expr_component_1 _31 _26 _10 _8 _32 _9 _35 _34 _15 _36 _33 _22 ]\r\nMemory guard was present.\r\nMemory guard was present.\r\n```\r\nI tried writing an empty test function (testMint) in efforts to debug the issue, and got thesame error. \r\n```\r\nfunction testMint() public {\r\n        assert(true);\r\n    }\r\n```",
  "closed_by": {
    "login": "Evalir",
    "id": 26014927,
    "node_id": "MDQ6VXNlcjI2MDE0OTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26014927?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Evalir",
    "html_url": "https://github.com/Evalir",
    "followers_url": "https://api.github.com/users/Evalir/followers",
    "following_url": "https://api.github.com/users/Evalir/following{/other_user}",
    "gists_url": "https://api.github.com/users/Evalir/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Evalir/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Evalir/subscriptions",
    "organizations_url": "https://api.github.com/users/Evalir/orgs",
    "repos_url": "https://api.github.com/users/Evalir/repos",
    "events_url": "https://api.github.com/users/Evalir/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Evalir/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1876219852",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6703#issuecomment-1876219852",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703",
    "id": 1876219852,
    "node_id": "IC_kwDOGBlvNc5v1NfM",
    "user": {
      "login": "DaniPopes",
      "id": 57450786,
      "node_id": "MDQ6VXNlcjU3NDUwNzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/57450786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DaniPopes",
      "html_url": "https://github.com/DaniPopes",
      "followers_url": "https://api.github.com/users/DaniPopes/followers",
      "following_url": "https://api.github.com/users/DaniPopes/following{/other_user}",
      "gists_url": "https://api.github.com/users/DaniPopes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DaniPopes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DaniPopes/subscriptions",
      "organizations_url": "https://api.github.com/users/DaniPopes/orgs",
      "repos_url": "https://api.github.com/users/DaniPopes/repos",
      "events_url": "https://api.github.com/users/DaniPopes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DaniPopes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-04T02:20:56Z",
    "updated_at": "2024-01-04T02:20:56Z",
    "author_association": "MEMBER",
    "body": "Can you please share more details? Forge version, Solc version, any minimal example...",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1876219852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1876242570",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6703#issuecomment-1876242570",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703",
    "id": 1876242570,
    "node_id": "IC_kwDOGBlvNc5v1TCK",
    "user": {
      "login": "Renzo1",
      "id": 32818202,
      "node_id": "MDQ6VXNlcjMyODE4MjAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/32818202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Renzo1",
      "html_url": "https://github.com/Renzo1",
      "followers_url": "https://api.github.com/users/Renzo1/followers",
      "following_url": "https://api.github.com/users/Renzo1/following{/other_user}",
      "gists_url": "https://api.github.com/users/Renzo1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Renzo1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Renzo1/subscriptions",
      "organizations_url": "https://api.github.com/users/Renzo1/orgs",
      "repos_url": "https://api.github.com/users/Renzo1/repos",
      "events_url": "https://api.github.com/users/Renzo1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Renzo1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-04T02:57:25Z",
    "updated_at": "2024-01-04T02:59:28Z",
    "author_association": "NONE",
    "body": "\r\n\r\n```bash\r\n$ forge --version\r\nforge 0.2.0 (bf56869 2023-07-05T00:07:51.006216400Z)\r\n\r\nsolc version: 0.8.17\r\n\r\nMinimal example:\r\nAs mentioned in my initial post, I attempted to create an empty function and encountered the same error.\r\n```\r\nfunction testMint() public {\r\n    assert(true);\r\n}\r\n```\r\n\r\nThis is what my Foundry.toml looks like:\r\n```toml\r\n[profile.default]\r\nsrc = 'contracts'\r\nout = 'out'\r\nlibs = ['node_modules', 'lib']\r\ntest = 'test/foundry'\r\ncache_path  = 'cache_forge'\r\noptimizer = true\r\nviaIR = true\r\n\r\n[fuzz]\r\nruns = 10\r\n\r\n[invariant]\r\nruns = 10\r\ndepth = 10\r\n```\r\n\r\nApart from the above, I honestly can't pinpoint where things went wrong. One moment, all functions were working, then it stopped. It briefly worked again (when I commented out some lines in the testFunction I was testing), but then stopped again. I thought it might be something in the testFunction(), so I decided to create an empty function, but the problem persisted. I even test other functions that worked before, but they also stopped working. I have tried restarting my system, but the issue remains. I created a new Foundry project to check if it's a global issue, and everything worked fine. I then attempted to copy my project into this new project, but the error persisted.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1876242570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1876910465",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6703#issuecomment-1876910465",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6703",
    "id": 1876910465,
    "node_id": "IC_kwDOGBlvNc5v32GB",
    "user": {
      "login": "Renzo1",
      "id": 32818202,
      "node_id": "MDQ6VXNlcjMyODE4MjAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/32818202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Renzo1",
      "html_url": "https://github.com/Renzo1",
      "followers_url": "https://api.github.com/users/Renzo1/followers",
      "following_url": "https://api.github.com/users/Renzo1/following{/other_user}",
      "gists_url": "https://api.github.com/users/Renzo1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Renzo1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Renzo1/subscriptions",
      "organizations_url": "https://api.github.com/users/Renzo1/orgs",
      "repos_url": "https://api.github.com/users/Renzo1/repos",
      "events_url": "https://api.github.com/users/Renzo1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Renzo1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-04T11:04:13Z",
    "updated_at": "2024-01-04T11:04:13Z",
    "author_association": "NONE",
    "body": "Thanks for the support.\r\nI have managed to resolve the issue.\r\n\r\nThe problem originated from a struct I added to my test.\r\n\r\nAnyone facing the same error should inspect their error message for matching variables or datatypes, and then consider removing them from the test and trying again.\r\n\r\nIn my case it was `VaultForTest` struct.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1876910465/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
