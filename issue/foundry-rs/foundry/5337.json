{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5337",
  "id": 1794868065,
  "node_id": "I_kwDOGBlvNc5q-4Nh",
  "number": 5337,
  "title": "ecpairing precompile decoding is incorrect",
  "user": {
    "login": "recmo",
    "id": 4532328,
    "node_id": "MDQ6VXNlcjQ1MzIzMjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4532328?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/recmo",
    "html_url": "https://github.com/recmo",
    "followers_url": "https://api.github.com/users/recmo/followers",
    "following_url": "https://api.github.com/users/recmo/following{/other_user}",
    "gists_url": "https://api.github.com/users/recmo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/recmo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/recmo/subscriptions",
    "organizations_url": "https://api.github.com/users/recmo/orgs",
    "repos_url": "https://api.github.com/users/recmo/repos",
    "events_url": "https://api.github.com/users/recmo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/recmo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-07-08T09:54:42Z",
  "updated_at": "2023-07-08T15:45:54Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge, Other (please describe)\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [ ] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (c78a811 2023-07-08T00:13:27.174343000Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge test\r\n\r\n### Operating System\r\n\r\nmacOS (Apple Silicon)\r\n\r\n### Describe the bug\r\n\r\nhttps://github.com/foundry-rs/foundry/blob/c78a811a8af95fb1e029427583a07b2ca3a3fa51/evm/src/trace/decoder.rs#L130\r\n\r\nI'm not sure where `x1, y1, x3, x2, y3, y2` comes from, but it's there.\r\n\r\nThe ecpairing interface doesn't follow the ABI standard strictly and is `((x, y), ((x0, x1), (y0, y1)))*`. See [eip-197].\r\n\r\n[eip-197]: https://eips.ethereum.org/EIPS/eip-197#encoding",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1627116065",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5337#issuecomment-1627116065",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337",
    "id": 1627116065,
    "node_id": "IC_kwDOGBlvNc5g-9Ih",
    "user": {
      "login": "DaniPopes",
      "id": 57450786,
      "node_id": "MDQ6VXNlcjU3NDUwNzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/57450786?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DaniPopes",
      "html_url": "https://github.com/DaniPopes",
      "followers_url": "https://api.github.com/users/DaniPopes/followers",
      "following_url": "https://api.github.com/users/DaniPopes/following{/other_user}",
      "gists_url": "https://api.github.com/users/DaniPopes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DaniPopes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DaniPopes/subscriptions",
      "organizations_url": "https://api.github.com/users/DaniPopes/orgs",
      "repos_url": "https://api.github.com/users/DaniPopes/repos",
      "events_url": "https://api.github.com/users/DaniPopes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DaniPopes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-08T11:02:14Z",
    "updated_at": "2023-07-08T11:02:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "We were using the definitions from evm.codes and looks like it was incorrect there, see smlxl/evm.codes#236\n\nThis is a simple fix, just renaming the parameters correctly, if anybody wants to take this on ðŸ™‚ ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1627116065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1627384480",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5337#issuecomment-1627384480",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5337",
    "id": 1627384480,
    "node_id": "IC_kwDOGBlvNc5g_-qg",
    "user": {
      "login": "recmo",
      "id": 4532328,
      "node_id": "MDQ6VXNlcjQ1MzIzMjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4532328?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/recmo",
      "html_url": "https://github.com/recmo",
      "followers_url": "https://api.github.com/users/recmo/followers",
      "following_url": "https://api.github.com/users/recmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/recmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/recmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/recmo/subscriptions",
      "organizations_url": "https://api.github.com/users/recmo/orgs",
      "repos_url": "https://api.github.com/users/recmo/repos",
      "events_url": "https://api.github.com/users/recmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/recmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-08T15:40:36Z",
    "updated_at": "2023-07-08T15:45:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's a bit more complicated than renaming. The number of variables itself is dynamic. Note that precompile contracts do not follow ABI encoding rules, and for this one and `modexp` there is no ABI equivalent. What maybe works is decoding the first couple point pairs and decode the rest as raw bytes? Or just do everything as raw bytes.\r\n\r\nAs it is right now, when you have a Groth16 pairing check it looks like this:\r\n\r\n```\r\nPRECOMPILE::ecpairing(\r\n17519552636721698831893983089005607244313436617223871493622354365226943523095 [1.751e76],\r\n7121326991389379063369205750624509106532474629342682182707280696044506219231 [7.121e75],\r\n8956693125727482614765896064098910453911452457095550427166762652229288610568 [8.956e75],\r\n8339411128381037772491803473605093476447566279367653017086352304208450530941 [8.339e75],\r\n1852029409971259439300520532102969363036906940939032723317032686200726164899 [1.852e75],\r\n20939026486477391100834172923405965640443170384568933644798260848108189293729 [2.093e76]\r\n)\r\n```\r\n\r\nBut this is missing most of the data. The actual calldata is:\r\n\r\n```\r\n26bbb723f965460ca7282cd75f0e3e7c67b15817f7cee60856b394936ed02917\r\n0fbe873ac672168143a91535450bab6c412dce8dc8b66a88f2da6e245f9282df\r\n13cd4f0451538ece5014fe6688b197aefcc611a5c6a7c319f834f2188ba04b08\r\n126ff07e81490a1b6ae92b2d9e700c8e23e9d5c7f6ab857027213819a6c9ae7d\r\n04183624c9858a56c54deb237c26cb4355bc2551312004e65fc5b299440b15a3\r\n2e4b11aa549ad6c667057b18be4f4437fda92f018a59430ebb992fa3462c9ca1\r\n2d4d9aa7e302d9df41749d5507949d05dbea33fbb16c643b22f599a2be6df2e2\r\n14bedd503c37ceb061d8ec60209fe345ce89830a19230301f076caff004d1926\r\n0967032fcbf776d1afc985f88877f182d38480a653f2decaa9794cbc3bf3060c\r\n0e187847ad4c798374d0d6732bf501847dd68bc0e071241e0213bc7fc13db7ab\r\n304cfbd1e08a704a99f5e847d93f8c3caafddec46b7a0d379da69a4d112346a7\r\n1739c1b1a457a8c7313123d24d2f9192f896b7c63eea05a9d57f06547ad0cec8\r\n001d6fedb032f70e377635238e0563f131670001f6abf439adb3a9d5d52073c6\r\n1889afe91e4e367f898a7fcd6464e5ca4e822fe169bccb624f6aeb87e4d060bc\r\n198e9393920d483a7260bfb731fb5d25f1aa493335a9e71297e485b7aef312c2\r\n1800deef121f1e76426a00665e5c4479674322d4f75edadd46debd5cd992f6ed\r\n090689d0585ff075ec9e99ad690c3395bc4b313370b38ef355acdadcd122975b\r\n12c85ea5db8c6deb4aab71808dcb408fe3d1e7690c43d37b4ce6cc0166fa7daa\r\n2dde6d7baf0bfa09329ec8d44c38282f5bf7f9ead1914edd7dcaebb498c84519\r\n0c359f868a85c6e6c1ea819cfab4a867501a3688324d74df1fe76556558b1937\r\n29f41c6e0e30802e2749bfb0729810876f3423e6f24829ad3e30adb1934f1c8a\r\n030e7a5f70bb5daa6e18d80d6d447e772efb0bb7fb9d0ffcd54fc5a48af1286d\r\n0ea726b117e48cda8bce2349405f006a84cdd3dcfba12efc990df25970a27b6d\r\n30364cd4f8a293b1a04f0153548d3e01baad091c69097ca4e9f26be63e4095b5\r\n```\r\n\r\nI don't care much about the variable names, but I do care about being able to see all the calldata.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1627384480/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
