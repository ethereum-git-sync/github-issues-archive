{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6825",
  "id": 2084847633,
  "node_id": "I_kwDOGBlvNc58REAR",
  "number": 6825,
  "title": "--skip-simulation does not skip simulation",
  "user": {
    "login": "Philogy",
    "id": 21957732,
    "node_id": "MDQ6VXNlcjIxOTU3NzMy",
    "avatar_url": "https://avatars.githubusercontent.com/u/21957732?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Philogy",
    "html_url": "https://github.com/Philogy",
    "followers_url": "https://api.github.com/users/Philogy/followers",
    "following_url": "https://api.github.com/users/Philogy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Philogy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Philogy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Philogy/subscriptions",
    "organizations_url": "https://api.github.com/users/Philogy/orgs",
    "repos_url": "https://api.github.com/users/Philogy/repos",
    "events_url": "https://api.github.com/users/Philogy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Philogy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2024-01-16T20:30:18Z",
  "updated_at": "2024-01-17T06:20:27Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (24abca6 2024-01-16T00:26:29.551032000Z)\n\n### What command(s) is the bug in?\n\nforge script --skip-simulation\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\nOften there are things that my script depends on that foundry is unable to simulate correctly (self-destruct reinit, hot/cold storage gas cost).\r\n\r\nWhether `--skip-simulation` is provided or not `forge script` will simulate the script first before attempting to broadcast it. Meaning that if it's incorrectly failing in the simulation I'm unable to broadcast transactions using foundry.\r\n\r\nThe `--skip-simulation` flag does however get the script runner to exclaim \"SKIPPING ON CHAIN SIMULATION.\" after it has successfully _ran the simulation_ ðŸ˜…\r\n![image](https://github.com/foundry-rs/foundry/assets/21957732/a6c0dea2-53ed-4e70-9ebb-6a6083e18e16)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894495457",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6825#issuecomment-1894495457",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
    "id": 1894495457,
    "node_id": "IC_kwDOGBlvNc5w67Th",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-16T20:53:03Z",
    "updated_at": "2024-01-16T20:53:03Z",
    "author_association": "MEMBER",
    "body": "thanks for flagging, possible regression, fixing asap",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894495457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894505346",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6825#issuecomment-1894505346",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
    "id": 1894505346,
    "node_id": "IC_kwDOGBlvNc5w69uC",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-16T21:00:57Z",
    "updated_at": "2024-01-16T21:01:24Z",
    "author_association": "MEMBER",
    "body": "do you have a minimal repro for this?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894505346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894517874",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6825#issuecomment-1894517874",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
    "id": 1894517874,
    "node_id": "IC_kwDOGBlvNc5w7Axy",
    "user": {
      "login": "Sabnock01",
      "id": 24715302,
      "node_id": "MDQ6VXNlcjI0NzE1MzAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/24715302?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sabnock01",
      "html_url": "https://github.com/Sabnock01",
      "followers_url": "https://api.github.com/users/Sabnock01/followers",
      "following_url": "https://api.github.com/users/Sabnock01/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sabnock01/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sabnock01/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sabnock01/subscriptions",
      "organizations_url": "https://api.github.com/users/Sabnock01/orgs",
      "repos_url": "https://api.github.com/users/Sabnock01/repos",
      "events_url": "https://api.github.com/users/Sabnock01/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sabnock01/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-16T21:10:20Z",
    "updated_at": "2024-01-16T21:10:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Had some previous discussion in #5776",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894517874/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894531391",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6825#issuecomment-1894531391",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
    "id": 1894531391,
    "node_id": "IC_kwDOGBlvNc5w7EE_",
    "user": {
      "login": "Philogy",
      "id": 21957732,
      "node_id": "MDQ6VXNlcjIxOTU3NzMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/21957732?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Philogy",
      "html_url": "https://github.com/Philogy",
      "followers_url": "https://api.github.com/users/Philogy/followers",
      "following_url": "https://api.github.com/users/Philogy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Philogy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Philogy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Philogy/subscriptions",
      "organizations_url": "https://api.github.com/users/Philogy/orgs",
      "repos_url": "https://api.github.com/users/Philogy/repos",
      "events_url": "https://api.github.com/users/Philogy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Philogy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-16T21:21:01Z",
    "updated_at": "2024-01-16T21:21:01Z",
    "author_association": "NONE",
    "body": "Yeah based on @Evalir's comment here: https://github.com/foundry-rs/foundry/issues/5776#issuecomment-1867287499 it does seem like this _intentional_ and kind of unavoidable based on how scripts currently work.\r\n\r\nUnfortunately, this does mean that `forge script` is unusable for me in many use-cases. Specifically because of the simulation being in 1 tx (meaning gas accounting for warm/cold storage slots will be off and self-destruct / reinit doesn't work).\r\n\r\nNot sure how you'd fix this exactly, maybe have a separate environment in which the script contract is run and the actual simulation itself, any external CALLs made in one are captured and emitted as transactions in the actual environment?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894531391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894539402",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6825#issuecomment-1894539402",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
    "id": 1894539402,
    "node_id": "IC_kwDOGBlvNc5w7GCK",
    "user": {
      "login": "Philogy",
      "id": 21957732,
      "node_id": "MDQ6VXNlcjIxOTU3NzMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/21957732?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Philogy",
      "html_url": "https://github.com/Philogy",
      "followers_url": "https://api.github.com/users/Philogy/followers",
      "following_url": "https://api.github.com/users/Philogy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Philogy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Philogy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Philogy/subscriptions",
      "organizations_url": "https://api.github.com/users/Philogy/orgs",
      "repos_url": "https://api.github.com/users/Philogy/repos",
      "events_url": "https://api.github.com/users/Philogy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Philogy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-16T21:27:34Z",
    "updated_at": "2024-01-16T21:27:34Z",
    "author_association": "NONE",
    "body": "Here's a minimal [repro](https://gist.github.com/Philogy/90e0a294b2587162ab14027c8f2fe14a)\r\n\r\nThis seems like a niche case but there are others like self-destruct, reinit or other weird dependencies like gas-price that would cause the same issue",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1894539402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1895010540",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6825#issuecomment-1895010540",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6825",
    "id": 1895010540,
    "node_id": "IC_kwDOGBlvNc5w85Ds",
    "user": {
      "login": "plotchy",
      "id": 98172525,
      "node_id": "U_kgDOBdn-bQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/98172525?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/plotchy",
      "html_url": "https://github.com/plotchy",
      "followers_url": "https://api.github.com/users/plotchy/followers",
      "following_url": "https://api.github.com/users/plotchy/following{/other_user}",
      "gists_url": "https://api.github.com/users/plotchy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/plotchy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/plotchy/subscriptions",
      "organizations_url": "https://api.github.com/users/plotchy/orgs",
      "repos_url": "https://api.github.com/users/plotchy/repos",
      "events_url": "https://api.github.com/users/plotchy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/plotchy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-17T06:20:27Z",
    "updated_at": "2024-01-17T06:20:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "copying good background provided by @evalir from #5776 :\r\n> --skip-simulation avoids using the provided URL to do gas estimation. It does not prevent foundry from simulating the script locally. The latter is not possible to disable, as we must simulate the script to gather all the transactions to broadcast. If the local simulation fails, the whole script fails.\r\n\r\nmuch of my experience with wanting this feature to avoid local sim was around similar edge cases. On-chain randomness where the randomness is seeded by things like gas, gas-limit, coinbase, etc that is difficult to match exactly in a forge script.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1895010540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
