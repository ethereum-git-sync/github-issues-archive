{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/5111",
  "id": 1742249171,
  "node_id": "I_kwDOGBlvNc5n2JzT",
  "number": 5111,
  "title": "anvil disk caching not working anymore?",
  "user": {
    "login": "michprev",
    "id": 7281754,
    "node_id": "MDQ6VXNlcjcyODE3NTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michprev",
    "html_url": "https://github.com/michprev",
    "followers_url": "https://api.github.com/users/michprev/followers",
    "following_url": "https://api.github.com/users/michprev/following{/other_user}",
    "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
    "organizations_url": "https://api.github.com/users/michprev/orgs",
    "repos_url": "https://api.github.com/users/michprev/repos",
    "events_url": "https://api.github.com/users/michprev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michprev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-06-05T17:48:36Z",
  "updated_at": "2023-06-05T18:55:59Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nanvil 0.1.0 (08a629a 2023-06-03T00:05:11.227787246Z)\n\n### What command(s) is the bug in?\n\nanvil\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\nIt seems that anvil disk caching does not work now. If I launch anvil and send some transactions, the `~/.foundry/anvil/tmp` directory is not created anymore.\r\n\r\nI am trying to take advantage of anvil caching when running fork tests, but the tests always take the same time (12s for a few transactions) no matter what parameters I set. I think this may be related to the fact that the `tmp` directory is not created.\r\n\r\n```\r\nanvil -f https://mainnet.infura.io/v3/API_KEY --fork-block-number 17386454 --fork-chain-id 1\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577249733",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5111#issuecomment-1577249733",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111",
    "id": 1577249733,
    "node_id": "IC_kwDOGBlvNc5eAuvF",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T18:10:44Z",
    "updated_at": "2023-06-05T18:13:04Z",
    "author_association": "MEMBER",
    "body": "> It seems that anvil disk caching\r\n\r\nwhat caching do you mean?\r\n\r\n```\r\n~/.foundry/cache/rpc/mainnet/17386454\r\n```\r\n\r\nshould exist?\r\n\r\n\r\ncould you perhaps try another key? maybe you're rate-limited on this one",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577249733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577259185",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5111#issuecomment-1577259185",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111",
    "id": 1577259185,
    "node_id": "IC_kwDOGBlvNc5eAxCx",
    "user": {
      "login": "michprev",
      "id": 7281754,
      "node_id": "MDQ6VXNlcjcyODE3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michprev",
      "html_url": "https://github.com/michprev",
      "followers_url": "https://api.github.com/users/michprev/followers",
      "following_url": "https://api.github.com/users/michprev/following{/other_user}",
      "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
      "organizations_url": "https://api.github.com/users/michprev/orgs",
      "repos_url": "https://api.github.com/users/michprev/repos",
      "events_url": "https://api.github.com/users/michprev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michprev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T18:18:45Z",
    "updated_at": "2023-06-05T18:18:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "I remember there always was the `~/.foundry/anvil/tmp` directory causing my disk running out of space quickly. This directory is not created anymore even when launching anvil with default parameters (by just simply running `anvil`).\r\n\r\nThe directory `~/.foundry/cache/rpc/mainnet/17386454` exists but its presence does not speed up my fork tests. It runs 16s for the first time (with `~/.foundry/cache/rpc` removed) and 15.4s for the second time (with `~/.foundry/cache/rpc/mainnet/17386454/storage.json` present).",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577259185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577270333",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5111#issuecomment-1577270333",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111",
    "id": 1577270333,
    "node_id": "IC_kwDOGBlvNc5eAzw9",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T18:28:33Z",
    "updated_at": "2023-06-05T18:28:33Z",
    "author_association": "MEMBER",
    "body": "this was for caching the entire state/history of the chain, this is now stored in a regular tmp dir because this is only valid for the time the chain exists.\r\n\r\nthis shouldn't have any impact on rpc though because all rpc state is cached in rpc folder, so idk what's causing this, can you try another key?\r\nor have a look at the logs maybe you can identify the logs this way",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577270333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577287344",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5111#issuecomment-1577287344",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111",
    "id": 1577287344,
    "node_id": "IC_kwDOGBlvNc5eA36w",
    "user": {
      "login": "michprev",
      "id": 7281754,
      "node_id": "MDQ6VXNlcjcyODE3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michprev",
      "html_url": "https://github.com/michprev",
      "followers_url": "https://api.github.com/users/michprev/followers",
      "following_url": "https://api.github.com/users/michprev/following{/other_user}",
      "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
      "organizations_url": "https://api.github.com/users/michprev/orgs",
      "repos_url": "https://api.github.com/users/michprev/repos",
      "events_url": "https://api.github.com/users/michprev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michprev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T18:43:35Z",
    "updated_at": "2023-06-05T18:43:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am experiencing the same behavior with Alchemy. Anvil sends many `eth_getCode`, `eth_getBalance`, `eth_getStorageAt` requests as if there was no cache. I can create a minimal example. Are there any anvil/foundry logs I can inspect?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577287344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577302321",
    "html_url": "https://github.com/foundry-rs/foundry/issues/5111#issuecomment-1577302321",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/5111",
    "id": 1577302321,
    "node_id": "IC_kwDOGBlvNc5eA7kx",
    "user": {
      "login": "michprev",
      "id": 7281754,
      "node_id": "MDQ6VXNlcjcyODE3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7281754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michprev",
      "html_url": "https://github.com/michprev",
      "followers_url": "https://api.github.com/users/michprev/followers",
      "following_url": "https://api.github.com/users/michprev/following{/other_user}",
      "gists_url": "https://api.github.com/users/michprev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michprev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michprev/subscriptions",
      "organizations_url": "https://api.github.com/users/michprev/orgs",
      "repos_url": "https://api.github.com/users/michprev/repos",
      "events_url": "https://api.github.com/users/michprev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michprev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-05T18:55:59Z",
    "updated_at": "2023-06-05T18:55:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Minimal example project: https://github.com/michprev/anvil-forking-issue",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1577302321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
