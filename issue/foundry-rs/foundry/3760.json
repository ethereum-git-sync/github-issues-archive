{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/3760",
  "id": 1463065896,
  "node_id": "I_kwDOGBlvNc5XNJ0o",
  "number": 3760,
  "title": "Option to persist all archive data",
  "user": {
    "login": "fubhy",
    "id": 1172528,
    "node_id": "MDQ6VXNlcjExNzI1Mjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1172528?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fubhy",
    "html_url": "https://github.com/fubhy",
    "followers_url": "https://api.github.com/users/fubhy/followers",
    "following_url": "https://api.github.com/users/fubhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/fubhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fubhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fubhy/subscriptions",
    "organizations_url": "https://api.github.com/users/fubhy/orgs",
    "repos_url": "https://api.github.com/users/fubhy/repos",
    "events_url": "https://api.github.com/users/fubhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fubhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    },
    {
      "id": 4077188949,
      "node_id": "LA_kwDOGBlvNc7zBPdV",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-anvil",
      "name": "C-anvil",
      "color": "5319E7",
      "default": false,
      "description": "Command: anvil"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-24T09:51:00Z",
  "updated_at": "2023-08-28T09:30:06Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Describe the feature you would like\n\nAs described [here](https://github.com/foundry-rs/foundry/pull/3730#issuecomment-1323605612) it would be great if there was an option for Anvil to act as a full-blown a archive node, persisting all data also between restarts.\r\n\r\nThis would be required for using Anvil in a local or shared development environment with Subgraphs, Substreams, Firehose, etc. but would also be useful in development environments without these components.\r\n\r\nThe ability to restart Anvil without losing any data is crucial for a smooth developer experience from back to front and would enable Anvil to be used in similar fashion to how Ganache and Hardhat are being used today to develop and test dApp frontends and data pipelines.\n\n### Additional context\n\nOriginal discussion: https://github.com/foundry-rs/foundry/pull/3730#issuecomment-1323605612",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760/reactions",
    "total_count": 5,
    "+1": 5,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1536706206",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3760#issuecomment-1536706206",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760",
    "id": 1536706206,
    "node_id": "IC_kwDOGBlvNc5bmEae",
    "user": {
      "login": "desi",
      "id": 15041,
      "node_id": "MDQ6VXNlcjE1MDQx",
      "avatar_url": "https://avatars.githubusercontent.com/u/15041?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/desi",
      "html_url": "https://github.com/desi",
      "followers_url": "https://api.github.com/users/desi/followers",
      "following_url": "https://api.github.com/users/desi/following{/other_user}",
      "gists_url": "https://api.github.com/users/desi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/desi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/desi/subscriptions",
      "organizations_url": "https://api.github.com/users/desi/orgs",
      "repos_url": "https://api.github.com/users/desi/repos",
      "events_url": "https://api.github.com/users/desi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/desi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T19:51:22Z",
    "updated_at": "2023-05-05T19:51:22Z",
    "author_association": "NONE",
    "body": "+1",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1536706206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1695358447",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3760#issuecomment-1695358447",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3760",
    "id": 1695358447,
    "node_id": "IC_kwDOGBlvNc5lDR3v",
    "user": {
      "login": "golden-expiriensu",
      "id": 83108115,
      "node_id": "MDQ6VXNlcjgzMTA4MTE1",
      "avatar_url": "https://avatars.githubusercontent.com/u/83108115?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/golden-expiriensu",
      "html_url": "https://github.com/golden-expiriensu",
      "followers_url": "https://api.github.com/users/golden-expiriensu/followers",
      "following_url": "https://api.github.com/users/golden-expiriensu/following{/other_user}",
      "gists_url": "https://api.github.com/users/golden-expiriensu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/golden-expiriensu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/golden-expiriensu/subscriptions",
      "organizations_url": "https://api.github.com/users/golden-expiriensu/orgs",
      "repos_url": "https://api.github.com/users/golden-expiriensu/repos",
      "events_url": "https://api.github.com/users/golden-expiriensu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/golden-expiriensu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-28T09:30:05Z",
    "updated_at": "2023-08-28T09:30:05Z",
    "author_association": "NONE",
    "body": "Hi guys! Is this still planned? We use anvil as a private testnet to develop our application in the context of the mainnet. We fork mainnet and deploy a ton of contracts on that fork and then set up dozens of integrations with protocols (CurveFi, UniV3, Aave and others). Anvil node runs in the cloud 24/7 and obviously after a certain time all information about old transactions (made on the fork) removes from memory cache => disappears forever. At the moment we use hardhat-deploy (unfortunately we are still dependent on hardhat, but we are trying to switch completely to foundry) to deploy contracts. The problems start when we need to update/deploy contracts without redeploying the whole system, as the information about the old contracts (transactions are checked by the hh-deploy library) being deleted from memory. It turns out that if we need to update one facet in Diamond, we need to redeploy entire system :(. Why is this not a solution? If you update contracts, you have to drop all the data on dev databases on the backend, because they store data relevant to previous version of contracts, and if you leave everything as it is, there will be a disynchronisation with the blockchain. I hope I have described why persistent transactions would be incredibly helpful to our project. By the way, for us, it would be enough that in addition to state.json foundry would also write a transaction.json file with all transactions made after forking. Maybe you would consider this as a one step of making everything persistent? Thanks in advance :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1695358447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
