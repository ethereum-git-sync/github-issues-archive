{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2139",
  "id": 1285768488,
  "node_id": "I_kwDOGBlvNc5Mo0Uo",
  "number": 2139,
  "title": "Fuzzer provides values greater than max uint256",
  "user": {
    "login": "PaulRBerg",
    "id": 8782666,
    "node_id": "MDQ6VXNlcjg3ODI2NjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PaulRBerg",
    "html_url": "https://github.com/PaulRBerg",
    "followers_url": "https://api.github.com/users/PaulRBerg/followers",
    "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
    "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
    "repos_url": "https://api.github.com/users/PaulRBerg/repos",
    "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-06-27T12:56:37Z",
  "updated_at": "2022-06-27T18:31:12Z",
  "closed_at": "2022-06-27T18:12:26Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (5385486 2022-06-27T00:04:55.418541Z)\n\n### What command(s) is the bug in?\n\nforge test\n\n### Operating System\n\nmacOS (Apple Silicon)\n\n### Describe the bug\n\nI have a test in which I am fuzzing the inputs like this:\r\n\r\n```solidity\r\nfunction testBurn__DecreaseHolderBalance(\r\n    address holder,\r\n    uint256 mintAmount,\r\n    uint256 burnAmount\r\n) external {\r\n    vm.assume(holder != address(0)\r\n    vm.assume(mintAmount > 0);\r\n    vm.assume(burnAmount > 0);\r\n    vm.assume(mintAmount > burnAmount);\r\n    // ...\r\n}\r\n```\r\n\r\nI wrote the test assuming that the Foundry fuzzer won't pass values greater than max uint256. But it looks like the fuzzer does just that:\r\n\r\n<img width=\"1728\" alt=\"foundry-fuzzer-over-max-uint256\" src=\"https://user-images.githubusercontent.com/8782666/175945803-6e1b6189-06bf-45d4-a92a-e32f4986f1b0.png\">\r\n\r\nBut `115792089237316195423570985008687907853269984665640564039457584007913129639936` doesn't fit in the `uint256` type - it's greater than the maximum value permitted by 1. If you were to set this value as a constant, the Solidity compiler would throw with the following error:\r\n\r\n> TypeError: Type int_const 1157...(70 digits omitted)...9936 is not implicitly convertible to expected type uint256. Literal is too large to fit in uint256.\r\n\r\nMy test fails presumably because `115792089237316195423570985008687907853269984665640564039457584007913129639936` is overflown and set to 0, but this means that the `vm.assume(mintAmount > 0)` exclusion is not respected by Foundry. So even if Foundry were to support values greater than max uint256, it should double-check that the resultant values still respect all exclusions.\r\n\r\nMy recommendation would be to not allow values greater than what is permitted by the Solidity types.",
  "closed_by": {
    "login": "PaulRBerg",
    "id": 8782666,
    "node_id": "MDQ6VXNlcjg3ODI2NjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PaulRBerg",
    "html_url": "https://github.com/PaulRBerg",
    "followers_url": "https://api.github.com/users/PaulRBerg/followers",
    "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
    "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
    "repos_url": "https://api.github.com/users/PaulRBerg/repos",
    "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167339809",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2139#issuecomment-1167339809",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
    "id": 1167339809,
    "node_id": "IC_kwDOGBlvNc5FlDEh",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T13:15:36Z",
    "updated_at": "2022-06-27T13:23:16Z",
    "author_association": "MEMBER",
    "body": "Doing `2^256 - 115792089237316195423570985008687907853269984665640564039457584007913129639936` results in 0, so I don't think it's too large to fit in a uint256(?), but it does look like you mint some arbitrary smaller amount in `setUp`, so minting `2^256` tokens on top of that would obviously overflow, no?\r\n\r\nEdit: Ah, right, the max value is `2^256 - 1`. Not sure why we generate a value larger than uint256, it shouldn't be possible given we use U256 in Rust which only has 256 bits. Even weirder is that Solidity parses it just fine from the calldata?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167339809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167353359",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2139#issuecomment-1167353359",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
    "id": 1167353359,
    "node_id": "IC_kwDOGBlvNc5FlGYP",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T13:27:36Z",
    "updated_at": "2022-06-27T13:29:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, max uint256 is `2^256 - 1`, not `2^256`.\r\n\r\n> but it does look like you mint some arbitrary smaller amount in `setUp`, so minting 2^256 tokens on top of that would obviously overflow, no?\r\n\r\nYeah I have accounted for the amount I'm minting in `setUp` in my test, this ain't about that.\r\n\r\n> Even weirder is that Solidity parses it just fine from the calldata?\r\n\r\nPerhaps it just overflows the value. And `2^256` in the `uint256` type is `0`, which makes my test fail, because I assume that `mintAmount` is not 0.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167353359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167357955",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2139#issuecomment-1167357955",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
    "id": 1167357955,
    "node_id": "IC_kwDOGBlvNc5FlHgD",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T13:31:29Z",
    "updated_at": "2022-06-27T13:31:29Z",
    "author_association": "MEMBER",
    "body": "If it just overflowed it wouldn't pass `vm.assume`. It wouldn't make sense that it only overflowed in the internal call. Can you paste the calldata here? It's not easy to transcribe by eye",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167357955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167362126",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2139#issuecomment-1167362126",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
    "id": 1167362126,
    "node_id": "IC_kwDOGBlvNc5FlIhO",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T13:35:15Z",
    "updated_at": "2022-06-27T13:35:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sure, it's `0x7bfe93590000000000000000000000000000000000000000000000000000000000000001fffffffffffffffffffffffffffffffffffffffffffe587bc8626624be0000000000000000000000000000000000000000000000000000000000000000000001`.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167362126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167415210",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2139#issuecomment-1167415210",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
    "id": 1167415210,
    "node_id": "IC_kwDOGBlvNc5FlVeq",
    "user": {
      "login": "mds1",
      "id": 17163988,
      "node_id": "MDQ6VXNlcjE3MTYzOTg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17163988?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mds1",
      "html_url": "https://github.com/mds1",
      "followers_url": "https://api.github.com/users/mds1/followers",
      "following_url": "https://api.github.com/users/mds1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mds1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mds1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mds1/subscriptions",
      "organizations_url": "https://api.github.com/users/mds1/orgs",
      "repos_url": "https://api.github.com/users/mds1/repos",
      "events_url": "https://api.github.com/users/mds1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mds1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T14:19:07Z",
    "updated_at": "2022-06-27T14:19:07Z",
    "author_association": "COLLABORATOR",
    "body": "The value generated by the fuzzer is not larger than uint256. \r\n\r\nWhile the value pasted in the issue description is equal to 2^256 which is greater than the max uint256, the calldata value is `fffffffffffffffffffffffffffffffffffffffffffe587bc8626624be000000`, which is less than that value.\r\n\r\nWhen converted to decimal, one digit differs. I put a hyphen before/after that digit to make it more readable\r\n- 11579208923731619542357098500868790785326998466564056-2-039457584007913129639936\r\n- 11579208923731619542357098500868790785326998466564056-4-039457584007913129639936\r\n\r\nSo I'm guessing you looked at the decimal representation and noticed the similarities to 2^256 and simply misread the value",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167415210/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167637373",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2139#issuecomment-1167637373",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2139",
    "id": 1167637373,
    "node_id": "IC_kwDOGBlvNc5FmLt9",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-27T17:18:17Z",
    "updated_at": "2022-06-27T18:31:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mds1 you're absolutely right. The decimal value contains a \"2\" in it, but I fooled myself that it is `2^256` and it contains a \"4\".\r\n\r\nMy test must be failing then due to other reason. Sorry for the false positive!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1167637373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
