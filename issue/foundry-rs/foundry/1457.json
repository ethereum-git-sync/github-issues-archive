{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1457",
  "id": 1220380319,
  "node_id": "I_kwDOGBlvNc5IvYaf",
  "number": 1457,
  "title": "Set private key env vars in CI for tests",
  "user": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394237,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjM3",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-question",
      "name": "T-question",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: question"
    },
    {
      "id": 3746533612,
      "node_id": "LA_kwDOGBlvNc7fT5Ds",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-meta",
      "name": "T-meta",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: meta"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-04-29T09:47:01Z",
  "updated_at": "2022-06-10T09:53:53Z",
  "closed_at": "2022-06-10T09:53:52Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### Component\n\nForge, Cast\n\n### Describe the feature you would like\n\nwe recently added tests that only run if private key, rpc URL and etherscan API key are set in ci, the integration tests check:\r\n* `forge verify*`\r\n* `forge create`\r\n\r\nand are only run if the env vars are present.\r\n\r\nIt'd be nice to also run them in CI to catch issues.\r\n\r\nthis would require:\r\n* secure env setup (so no one steals our PK)\r\n* feature gating these tests and run them separately because they can be flaky (network/endpoint etc..)\n\n### Additional context\n\n_No response_",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1147407539",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1457#issuecomment-1147407539",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457",
    "id": 1147407539,
    "node_id": "IC_kwDOGBlvNc5EZAyz",
    "user": {
      "login": "StErMi",
      "id": 146166,
      "node_id": "MDQ6VXNlcjE0NjE2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/146166?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StErMi",
      "html_url": "https://github.com/StErMi",
      "followers_url": "https://api.github.com/users/StErMi/followers",
      "following_url": "https://api.github.com/users/StErMi/following{/other_user}",
      "gists_url": "https://api.github.com/users/StErMi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StErMi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StErMi/subscriptions",
      "organizations_url": "https://api.github.com/users/StErMi/orgs",
      "repos_url": "https://api.github.com/users/StErMi/repos",
      "events_url": "https://api.github.com/users/StErMi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StErMi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-06T12:45:21Z",
    "updated_at": "2022-06-06T12:45:21Z",
    "author_association": "NONE",
    "body": "Hi there, I'm trying to have a common way to launch both local and CI tests scripts and I was wondering if it's possible make `forge test` (and other commands) to automatically pick up `.env` files based on the profile.\r\n\r\nIn my scenario we have two different use case:\r\n\r\n1) GitHub actions CI tests\r\n2) Local test to be run before commit/push\r\n\r\nI would like to be able to define the same `scripts` in `package.json` and be able to run them equally both locally with `npm run test:whatever` and by GitHub CI.\r\n\r\n## GitHub actions\r\n\r\nI can easily define `env` variables in the `yml` with constant values or getting the value of them from GitHub secrets.\r\nAfter that I can easily call the tests scripts via `npm run test` and `npm run test:fork` (this one is using the setupping the env variable `FOUNDRY_ETH_RPC_URL`\r\n\r\nEverything is good here.\r\n\r\n## Local tests\r\n\r\nI would like to use the same scripts that I'm using for the CI also locally to have only one source to lunch my tests. The problem is that as far as I get it's not possible to do it currently.\r\n\r\nSo I was thinking that foundry could enhance the way it loads `env` variables from `.env` file based on `profiles`.\r\n\r\nYou would have `foundry.toml` where you define all you \"public\" env variables and profiles but also `.env` file where you can define \"secret\" value for some env variables. \r\n\r\nIf no profile is specified when the command is launched the `default` profile is used so it will try to load `.env` file if it exists.\r\nIn case where a `profile` is specified it will try to load that specific env file. For example if you specify that the profile is `prod` it will try to load `.env.prod` env file.\r\n\r\nIt would work like `foundry.toml` work so if a more specific profile is used it will laod first the `.env` and then will merge the `.env.$profile_name` config.\r\n\r\nIn this way we would be able to have the same scripts for both Github CI and local testing. \r\n\r\nHere's the repo I'm currently testing on: https://github.com/StErMi/forge-sol-challenge",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1147407539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1151180262",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1457#issuecomment-1151180262",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457",
    "id": 1151180262,
    "node_id": "IC_kwDOGBlvNc5EnZ3m",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-09T14:18:27Z",
    "updated_at": "2022-06-09T14:18:27Z",
    "author_association": "MEMBER",
    "body": "@StErMi check out https://github.com/foundry-rs/foundry/issues/1034",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1151180262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1152158258",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1457#issuecomment-1152158258",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457",
    "id": 1152158258,
    "node_id": "IC_kwDOGBlvNc5ErIoy",
    "user": {
      "login": "StErMi",
      "id": 146166,
      "node_id": "MDQ6VXNlcjE0NjE2Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/146166?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StErMi",
      "html_url": "https://github.com/StErMi",
      "followers_url": "https://api.github.com/users/StErMi/followers",
      "following_url": "https://api.github.com/users/StErMi/following{/other_user}",
      "gists_url": "https://api.github.com/users/StErMi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StErMi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StErMi/subscriptions",
      "organizations_url": "https://api.github.com/users/StErMi/orgs",
      "repos_url": "https://api.github.com/users/StErMi/repos",
      "events_url": "https://api.github.com/users/StErMi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StErMi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-10T09:20:51Z",
    "updated_at": "2022-06-10T09:20:51Z",
    "author_association": "NONE",
    "body": "> @StErMi check out #1034\r\n\r\nThat's precisely what I was looking for!",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1152158258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1152186207",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1457#issuecomment-1152186207",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1457",
    "id": 1152186207,
    "node_id": "IC_kwDOGBlvNc5ErPdf",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-10T09:53:52Z",
    "updated_at": "2022-06-10T09:53:52Z",
    "author_association": "MEMBER",
    "body": "Closing this issue in that case :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1152186207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
