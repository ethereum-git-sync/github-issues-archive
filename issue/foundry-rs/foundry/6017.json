{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/6017",
  "id": 1933699233,
  "node_id": "I_kwDOGBlvNc5zQeih",
  "number": 6017,
  "title": "Memory Consumption Steadily Increases during Prolonged Transaction Replays",
  "user": {
    "login": "mshakeg",
    "id": 40227090,
    "node_id": "MDQ6VXNlcjQwMjI3MDkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mshakeg",
    "html_url": "https://github.com/mshakeg",
    "followers_url": "https://api.github.com/users/mshakeg/followers",
    "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
    "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
    "organizations_url": "https://api.github.com/users/mshakeg/orgs",
    "repos_url": "https://api.github.com/users/mshakeg/repos",
    "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mshakeg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2023-10-09T19:56:25Z",
  "updated_at": "2023-10-20T09:59:36Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nAnvil\r\n\r\n### Describe the feature you would like\r\n\r\n**Description**\r\n\r\nI've been utilizing Anvil `0.2.0` (5be158b 2023-10-02T00:23:45.472182000Z) as a local Ethereum node for a Uniswap V3 backtester project. The backtester replays all transactions for a specific Uniswap V3 Pool. However, I've noticed a consistent and steady increase in memory usage over time as more transactions are replayed, even with the `--prune-history` flag enabled. Below is the exact command I'm using to start the anvil node:\r\n\r\n```shell\r\nanvil --prune-history --timestamp 1619820000 --order fifo --code-size-limit 4294967296 -m \"test test test test test test test test test test test junk\" --gas-limit 100000000000 --gas-price 0 --base-fee 0\r\n```\r\n\r\n**Observations**\r\n\r\n1. The memory consumption increases steadily with the replaying of transactions.\r\n2. When replaying transactions for backtesting, I first set the block's timestamp using `evm_setNextBlockTimestamp` and then utilize `evm_mine` to mine the block.\r\n3. After around 10 minutes of running, the Docker stats indicate that Anvil has consumed around 9.247GiB of memory:\r\n\r\n```\r\nde526102010a   web3-backtester-anvil-1-1        98.78%    9.247GiB / 62.01GiB   14.91%    12.3MB / 15.6MB   4.77MB / 0B       11\r\n```\r\n\r\n4. I'm only deploying contracts at the very start and the rest(and vast majority) of the runtime is spent replaying transactions for the backtest.\r\n\r\n**Expected Behavior**\r\n\r\nStable memory consumption or a slower, more controlled growth in memory usage over time when replaying transactions.\r\n\r\n**Possible Solutions**\r\n\r\nWhile I'm not certain about the root cause, I'd appreciate if the team could investigate:\r\n\r\n1. Whether transaction replays might be causing memory leaks or if there are specific internal data structures growing unbounded.\r\n2. If the `--prune-history` flag could be further optimized or if there's a possibility of introducing additional pruning or memory management features.\r\n\r\n### Additional context\r\n\r\n**Environment Details**\r\n\r\n- Anvil Version: `0.2.0`\r\n- Host: EC2 instance (8 vCPU, 64 GB RAM)\r\n- Docker container",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1756409093",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1756409093",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1756409093,
    "node_id": "IC_kwDOGBlvNc5osK0F",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-10T23:00:25Z",
    "updated_at": "2023-10-10T23:00:25Z",
    "author_association": "MEMBER",
    "body": "I think the offloading to disk could def use some work.\r\n\r\ndo you have some kind script that I can use to repro this by any chance? that would help, I don't think this is complex to fix, but having something available for debugging would really help here",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1756409093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1757459859",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1757459859",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1757459859,
    "node_id": "IC_kwDOGBlvNc5owLWT",
    "user": {
      "login": "mshakeg",
      "id": 40227090,
      "node_id": "MDQ6VXNlcjQwMjI3MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mshakeg",
      "html_url": "https://github.com/mshakeg",
      "followers_url": "https://api.github.com/users/mshakeg/followers",
      "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
      "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
      "organizations_url": "https://api.github.com/users/mshakeg/orgs",
      "repos_url": "https://api.github.com/users/mshakeg/repos",
      "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mshakeg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T11:19:02Z",
    "updated_at": "2023-10-11T11:19:02Z",
    "author_association": "NONE",
    "body": "Hey @mattsse thanks for the reply, the backtester is still private so I just created [this repo](https://github.com/mshakeg/anvil-backtester) that is a minimal reproduction of the issue.\r\n\r\nIt would be great if the anvil node had a very lightweight configuration so it drops all historical/archive state and for most cases(including mine on an MBP M1 16GB) would likely not even need to offload to disk, I thought the `--prune-history` flag did this, but it seems not.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1757459859/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1757529928",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1757529928",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1757529928,
    "node_id": "IC_kwDOGBlvNc5owcdI",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T11:54:04Z",
    "updated_at": "2023-10-11T11:54:04Z",
    "author_association": "MEMBER",
    "body": "thanks! \r\nI'll take a look",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1757529928/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1759027568",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1759027568",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1759027568,
    "node_id": "IC_kwDOGBlvNc5o2KFw",
    "user": {
      "login": "mshakeg",
      "id": 40227090,
      "node_id": "MDQ6VXNlcjQwMjI3MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mshakeg",
      "html_url": "https://github.com/mshakeg",
      "followers_url": "https://api.github.com/users/mshakeg/followers",
      "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
      "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
      "organizations_url": "https://api.github.com/users/mshakeg/orgs",
      "repos_url": "https://api.github.com/users/mshakeg/repos",
      "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mshakeg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-12T06:55:17Z",
    "updated_at": "2023-10-12T16:15:08Z",
    "author_association": "NONE",
    "body": "another issue I noticed is that the anvil node slows down significantly as more and more transactions are replayed, it took about 1 hour to replay the first 50k logs and then about 5 hours to replay the next 50k logs, it'll likely only get worse on more logs.\r\n\r\nEdit: It does get worse to replay the next 50k logs i.e. from 100-150k took about 10 hours.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1759027568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1770992177",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1770992177",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1770992177,
    "node_id": "IC_kwDOGBlvNc5pjzIx",
    "user": {
      "login": "mshakeg",
      "id": 40227090,
      "node_id": "MDQ6VXNlcjQwMjI3MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mshakeg",
      "html_url": "https://github.com/mshakeg",
      "followers_url": "https://api.github.com/users/mshakeg/followers",
      "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
      "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
      "organizations_url": "https://api.github.com/users/mshakeg/orgs",
      "repos_url": "https://api.github.com/users/mshakeg/repos",
      "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mshakeg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T13:28:45Z",
    "updated_at": "2023-10-19T13:28:45Z",
    "author_association": "NONE",
    "body": "Hi @mattsse don't want to come off as impatient, but I just wanted to ask if you could provide a rough ETA on this?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1770992177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1771636948",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1771636948",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1771636948,
    "node_id": "IC_kwDOGBlvNc5pmQjU",
    "user": {
      "login": "09tangriro",
      "id": 47002898,
      "node_id": "MDQ6VXNlcjQ3MDAyODk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/47002898?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/09tangriro",
      "html_url": "https://github.com/09tangriro",
      "followers_url": "https://api.github.com/users/09tangriro/followers",
      "following_url": "https://api.github.com/users/09tangriro/following{/other_user}",
      "gists_url": "https://api.github.com/users/09tangriro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/09tangriro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/09tangriro/subscriptions",
      "organizations_url": "https://api.github.com/users/09tangriro/orgs",
      "repos_url": "https://api.github.com/users/09tangriro/repos",
      "events_url": "https://api.github.com/users/09tangriro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/09tangriro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T20:10:46Z",
    "updated_at": "2023-10-19T20:10:46Z",
    "author_association": "NONE",
    "body": "+1\r\n\r\nHi guys! We've been building a general smart contract testing framework called [dojo](https://dojo.compasslabs.ai/), but we're heavily limited by the throughput `anvil` can handle. \r\nLike @mshakeg mentioned, we noticed unusually heavy memory usage, and especially transactions take a significant amount of time to process. At first, we also noticed transactions slowing down as the simulation went on but that was actually fixed by awaiting the transaction receipt (implying that there's some sort of queue in anvil that's getting clogged up?), but still transactions in particular take a huge amount of time to process given how few of them there actually are in a simulation. In the graph below you can see that over half of our execution time is spent waiting for anvil to process a transaction.\r\n\r\n![image](https://github.com/foundry-rs/foundry/assets/47002898/4700e38b-ff50-4ce7-862e-d66e8814c21d)\r\n\r\nIn particular, uniswap mint transactions appear to take a long time to process, presumably because it's a complex transaction (x-axis is transaction index, y-axis is seconds):\r\n![image](https://github.com/foundry-rs/foundry/assets/47002898/b5afa243-e152-4712-b24b-ecbc584b1c1f)\r\n\r\nHow far do you think it would be feasible to cut this throughput time down? [Chaos Labs](https://chaoslabs.xyz/solutions/simulations) appear to have a private fork of `anvil` and made a version with massively increased throughput. I'm hoping we can do the same with the open-source version.\r\n\r\nIf it's useful, me and @scheuclu are more than happy to help with this if we could get some onboarding guidance as well :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1771636948/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1771660127",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1771660127",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1771660127,
    "node_id": "IC_kwDOGBlvNc5pmWNf",
    "user": {
      "login": "mshakeg",
      "id": 40227090,
      "node_id": "MDQ6VXNlcjQwMjI3MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mshakeg",
      "html_url": "https://github.com/mshakeg",
      "followers_url": "https://api.github.com/users/mshakeg/followers",
      "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
      "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
      "organizations_url": "https://api.github.com/users/mshakeg/orgs",
      "repos_url": "https://api.github.com/users/mshakeg/repos",
      "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mshakeg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T20:29:17Z",
    "updated_at": "2023-10-19T21:28:07Z",
    "author_association": "NONE",
    "body": "@09tangriro thanks for sharing. Could you share a graph of the processing times for the uniswap mint transactions(and perhaps even for swap transactions) for the first 10,000 logs and compare how much faster it is to the later average of ~2.2s\r\n\r\nIf I had to guess it probably slows down as much as 100x; from ~20ms to 2s",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1771660127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1771839762",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1771839762",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1771839762,
    "node_id": "IC_kwDOGBlvNc5pnCES",
    "user": {
      "login": "09tangriro",
      "id": 47002898,
      "node_id": "MDQ6VXNlcjQ3MDAyODk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/47002898?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/09tangriro",
      "html_url": "https://github.com/09tangriro",
      "followers_url": "https://api.github.com/users/09tangriro/followers",
      "following_url": "https://api.github.com/users/09tangriro/following{/other_user}",
      "gists_url": "https://api.github.com/users/09tangriro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/09tangriro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/09tangriro/subscriptions",
      "organizations_url": "https://api.github.com/users/09tangriro/orgs",
      "repos_url": "https://api.github.com/users/09tangriro/repos",
      "events_url": "https://api.github.com/users/09tangriro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/09tangriro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T23:32:12Z",
    "updated_at": "2023-10-19T23:32:12Z",
    "author_association": "NONE",
    "body": "Here's some graphs on time taken for different transactions on a sim with uniswap for a day, I'll correct myself, the trend is definitely clear that tx time is increasing:\r\n![timing_contract_transact_exactOutputSingle](https://github.com/foundry-rs/foundry/assets/47002898/7e4bbdc4-3747-4b73-91ec-9759746f709d)\r\n![timing_contract_transact_increaseLiquidity](https://github.com/foundry-rs/foundry/assets/47002898/8e88ba49-6bbf-4bb6-b611-f4324283a5b4)\r\n![timing_contract_transact_mint](https://github.com/foundry-rs/foundry/assets/47002898/d6798610-7e2e-4292-830f-491631cc17a0)\r\n![timing_contract_transact_burn](https://github.com/foundry-rs/foundry/assets/47002898/833aa6a1-2a3a-4582-b2dc-c7a13729e3ab)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1771839762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1772173103",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1772173103",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1772173103,
    "node_id": "IC_kwDOGBlvNc5poTcv",
    "user": {
      "login": "mshakeg",
      "id": 40227090,
      "node_id": "MDQ6VXNlcjQwMjI3MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mshakeg",
      "html_url": "https://github.com/mshakeg",
      "followers_url": "https://api.github.com/users/mshakeg/followers",
      "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
      "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
      "organizations_url": "https://api.github.com/users/mshakeg/orgs",
      "repos_url": "https://api.github.com/users/mshakeg/repos",
      "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mshakeg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T06:41:49Z",
    "updated_at": "2023-10-20T06:41:49Z",
    "author_association": "NONE",
    "body": "@09tangriro thanks, are these scatter plots over a similar time frame/number of transactions as the initial line plot you shared? I would guess not as the transaction_mint time doesn't eventually end up around 2s. Do the times for the other transactions also end up around 2s?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1772173103/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1772305704",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1772305704",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1772305704,
    "node_id": "IC_kwDOGBlvNc5poz0o",
    "user": {
      "login": "09tangriro",
      "id": 47002898,
      "node_id": "MDQ6VXNlcjQ3MDAyODk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/47002898?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/09tangriro",
      "html_url": "https://github.com/09tangriro",
      "followers_url": "https://api.github.com/users/09tangriro/followers",
      "following_url": "https://api.github.com/users/09tangriro/following{/other_user}",
      "gists_url": "https://api.github.com/users/09tangriro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/09tangriro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/09tangriro/subscriptions",
      "organizations_url": "https://api.github.com/users/09tangriro/orgs",
      "repos_url": "https://api.github.com/users/09tangriro/repos",
      "events_url": "https://api.github.com/users/09tangriro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/09tangriro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T08:29:30Z",
    "updated_at": "2023-10-20T08:50:07Z",
    "author_association": "NONE",
    "body": "The other plot uses a forked chain, which increases transaction times a lot. To better isolate anvil it should be noted that the scatter plots obtained recently are not run on a forked chain, but purely local development. \r\n\r\nIdeally, I'd like for these times to be O(1) and also try to cut times in general by a factor of 10 so a transaction takes in the order of 1ms. I'm curious, on the surface of it, the Ethereum opcodes shouldn't require ms to process, it's just addition, subtraction, and memory access. [According to this benchmark though](https://github.com/ziyadedher/evm-bench), `rEVM` and even `evmone` take ms to 10s of ms to process ERC20 transactions. Does anyone know why the EVM requires so much compute power?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1772305704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1772436373",
    "html_url": "https://github.com/foundry-rs/foundry/issues/6017#issuecomment-1772436373",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/6017",
    "id": 1772436373,
    "node_id": "IC_kwDOGBlvNc5ppTuV",
    "user": {
      "login": "mshakeg",
      "id": 40227090,
      "node_id": "MDQ6VXNlcjQwMjI3MDkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/40227090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mshakeg",
      "html_url": "https://github.com/mshakeg",
      "followers_url": "https://api.github.com/users/mshakeg/followers",
      "following_url": "https://api.github.com/users/mshakeg/following{/other_user}",
      "gists_url": "https://api.github.com/users/mshakeg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mshakeg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mshakeg/subscriptions",
      "organizations_url": "https://api.github.com/users/mshakeg/orgs",
      "repos_url": "https://api.github.com/users/mshakeg/repos",
      "events_url": "https://api.github.com/users/mshakeg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mshakeg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T09:59:35Z",
    "updated_at": "2023-10-20T09:59:35Z",
    "author_association": "NONE",
    "body": "> The other plot uses a forked chain, which increases transaction times a lot.\r\n\r\n@09tangriro thanks for clarifying that.\r\n\r\n> I'd like for these times to be O(1)\r\n\r\nI agree, I see no reason why the processing time for a transaction should increase so drastically. Your scatter plots seem to be processing only a few thousand txs, so it's not as pronounced. In any case, the plots seem to be linear so the processing time per transaction would likely eventually be much greater than the initial processing time which is unacceptable imo.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1772436373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
