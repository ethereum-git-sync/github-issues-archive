{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/1149",
  "id": 1187676017,
  "node_id": "I_kwDOGBlvNc5Gyn9x",
  "number": 1149,
  "title": "Tests pass with failed assertion in external call ",
  "user": {
    "login": "FrankieIsLost",
    "id": 88221686,
    "node_id": "MDQ6VXNlcjg4MjIxNjg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/88221686?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/FrankieIsLost",
    "html_url": "https://github.com/FrankieIsLost",
    "followers_url": "https://api.github.com/users/FrankieIsLost/followers",
    "following_url": "https://api.github.com/users/FrankieIsLost/following{/other_user}",
    "gists_url": "https://api.github.com/users/FrankieIsLost/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/FrankieIsLost/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FrankieIsLost/subscriptions",
    "organizations_url": "https://api.github.com/users/FrankieIsLost/orgs",
    "repos_url": "https://api.github.com/users/FrankieIsLost/repos",
    "events_url": "https://api.github.com/users/FrankieIsLost/events{/privacy}",
    "received_events_url": "https://api.github.com/users/FrankieIsLost/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-03-31T08:05:03Z",
  "updated_at": "2022-04-06T15:12:18Z",
  "closed_at": "2022-04-06T15:12:17Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\n\nForge\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (09d53c2 2022-03-31T00:32:45.902442+00:00)\n\n### What command(s) is the bug in?\n\nforge test\n\n### Operating System\n\nmacOS (M1)\n\n### Describe the bug\n\nTests are passing even though assertion fails \r\n![Screen Shot 2022-03-31 at 12 58 28 AM](https://user-images.githubusercontent.com/88221686/161006566-82666b24-b704-4421-b54c-a307a03de7ae.png)\r\n\r\n## How to reproduce \r\n\r\nRun ` forge test -vv` with the following test contract: \r\n\r\n```\r\ncontract TestMain is DSTest {\r\n\r\n    TestUtil util = new TestUtil();\r\n\r\n    function testInternalCall() public { \r\n        shouldFailInternal();\r\n    }\r\n\r\n    function shouldFailInternal() public {\r\n        assertTrue(false);\r\n    }\r\n\r\n    function testExternalCall() public { \r\n        util.shouldFailExternal();\r\n    }\r\n}\r\n\r\ncontract TestUtil is DSTest { \r\n    function shouldFailExternal() public { \r\n        assertTrue(false);\r\n    }\r\n}\r\n\r\n```\r\n\r\n## Expected Result \r\n\r\nBoth tests should fail \r\n\r\n## Actual Result \r\n\r\nOnly the test where the assertion fails in an internal call fails. Test where assertion fails in external call passes. \r\n\r\n## Severity \r\n\r\nThis is likely a high sev bug. Code bases with complex tests are likely to refactor their testing into multiple contracts. This bug can cause tests to fail silently. \r\n",
  "closed_by": {
    "login": "brockelmore",
    "id": 31553173,
    "node_id": "MDQ6VXNlcjMxNTUzMTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/31553173?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brockelmore",
    "html_url": "https://github.com/brockelmore",
    "followers_url": "https://api.github.com/users/brockelmore/followers",
    "following_url": "https://api.github.com/users/brockelmore/following{/other_user}",
    "gists_url": "https://api.github.com/users/brockelmore/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brockelmore/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brockelmore/subscriptions",
    "organizations_url": "https://api.github.com/users/brockelmore/orgs",
    "repos_url": "https://api.github.com/users/brockelmore/repos",
    "events_url": "https://api.github.com/users/brockelmore/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brockelmore/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1084473131",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1149#issuecomment-1084473131",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
    "id": 1084473131,
    "node_id": "IC_kwDOGBlvNc5Ao78r",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-31T11:43:06Z",
    "updated_at": "2022-03-31T11:47:03Z",
    "author_association": "MEMBER",
    "body": "This is not a bug - `assertTrue(false)` does not revert, it just sets `failed = true` in the contract. We **only** check `failed` on test contracts, not the contracts that it itself deployed.\r\n\r\nYou should:\r\n\r\n- use inheritance to get around this, or\r\n- make `TestUtil` a library, or\r\n- make `TestUtil` its own test suite, or\r\n- have your `TestUtil` contract revert, or\r\n- override `failed` in your main test\r\n\r\nI don't think iterating over all members of the test contract to check `failed` on every address is something we want to do\r\n\r\n- it's expensive and,\r\n- it's likely to produce other weird behavior and, \r\n- it would require every member of the contract to be public (otherwise we're back to square 1), or it would require us to run with tracing always\r\n\r\nI also don't think this is how DappTools behaves",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1084473131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1084958133",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1149#issuecomment-1084958133",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
    "id": 1084958133,
    "node_id": "IC_kwDOGBlvNc5AqyW1",
    "user": {
      "login": "d-xo",
      "id": 6689924,
      "node_id": "MDQ6VXNlcjY2ODk5MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6689924?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/d-xo",
      "html_url": "https://github.com/d-xo",
      "followers_url": "https://api.github.com/users/d-xo/followers",
      "following_url": "https://api.github.com/users/d-xo/following{/other_user}",
      "gists_url": "https://api.github.com/users/d-xo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/d-xo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/d-xo/subscriptions",
      "organizations_url": "https://api.github.com/users/d-xo/orgs",
      "repos_url": "https://api.github.com/users/d-xo/repos",
      "events_url": "https://api.github.com/users/d-xo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/d-xo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-31T18:29:34Z",
    "updated_at": "2022-03-31T18:29:34Z",
    "author_association": "NONE",
    "body": "related: https://github.com/dapphub/dapptools/issues/768",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1084958133/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1084959951",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1149#issuecomment-1084959951",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
    "id": 1084959951,
    "node_id": "IC_kwDOGBlvNc5AqyzP",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-31T18:31:47Z",
    "updated_at": "2022-03-31T18:31:47Z",
    "author_association": "MEMBER",
    "body": "Interesting solution, addresses my concerns! Thanks for sharing.\r\n\r\nI imagine this would require support in https://github.com/dapphub/ds-test/, though?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1084959951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1085341137",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1149#issuecomment-1085341137",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
    "id": 1085341137,
    "node_id": "IC_kwDOGBlvNc5AsP3R",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-01T02:25:39Z",
    "updated_at": "2022-04-01T02:25:39Z",
    "author_association": "MEMBER",
    "body": "Yeah we could have a specific address / storage slot which we treat as the global?",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1085341137/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1086077233",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1149#issuecomment-1086077233",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
    "id": 1086077233,
    "node_id": "IC_kwDOGBlvNc5AvDkx",
    "user": {
      "login": "brockelmore",
      "id": 31553173,
      "node_id": "MDQ6VXNlcjMxNTUzMTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/31553173?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brockelmore",
      "html_url": "https://github.com/brockelmore",
      "followers_url": "https://api.github.com/users/brockelmore/followers",
      "following_url": "https://api.github.com/users/brockelmore/following{/other_user}",
      "gists_url": "https://api.github.com/users/brockelmore/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brockelmore/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brockelmore/subscriptions",
      "organizations_url": "https://api.github.com/users/brockelmore/orgs",
      "repos_url": "https://api.github.com/users/brockelmore/repos",
      "events_url": "https://api.github.com/users/brockelmore/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brockelmore/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-01T15:54:58Z",
    "updated_at": "2022-04-01T15:54:58Z",
    "author_association": "MEMBER",
    "body": "https://github.com/dapphub/ds-test/pull/30\r\n\r\nimplementing a fix upstream that should fix this",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1086077233/reactions",
      "total_count": 3,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1090386913",
    "html_url": "https://github.com/foundry-rs/foundry/issues/1149#issuecomment-1090386913",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/1149",
    "id": 1090386913,
    "node_id": "IC_kwDOGBlvNc5A_fvh",
    "user": {
      "login": "brockelmore",
      "id": 31553173,
      "node_id": "MDQ6VXNlcjMxNTUzMTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/31553173?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brockelmore",
      "html_url": "https://github.com/brockelmore",
      "followers_url": "https://api.github.com/users/brockelmore/followers",
      "following_url": "https://api.github.com/users/brockelmore/following{/other_user}",
      "gists_url": "https://api.github.com/users/brockelmore/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brockelmore/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brockelmore/subscriptions",
      "organizations_url": "https://api.github.com/users/brockelmore/orgs",
      "repos_url": "https://api.github.com/users/brockelmore/repos",
      "events_url": "https://api.github.com/users/brockelmore/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brockelmore/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-06T15:12:17Z",
    "updated_at": "2022-04-06T15:12:17Z",
    "author_association": "MEMBER",
    "body": "Fixed upstream :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1090386913/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
