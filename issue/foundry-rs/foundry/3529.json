{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/3529",
  "id": 1419227019,
  "node_id": "I_kwDOGBlvNc5Ul6-L",
  "number": 3529,
  "title": "Bugs testing with Mumbai testnet",
  "user": {
    "login": "0xCaso",
    "id": 22419450,
    "node_id": "MDQ6VXNlcjIyNDE5NDUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22419450?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xCaso",
    "html_url": "https://github.com/0xCaso",
    "followers_url": "https://api.github.com/users/0xCaso/followers",
    "following_url": "https://api.github.com/users/0xCaso/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xCaso/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xCaso/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xCaso/subscriptions",
    "organizations_url": "https://api.github.com/users/0xCaso/orgs",
    "repos_url": "https://api.github.com/users/0xCaso/repos",
    "events_url": "https://api.github.com/users/0xCaso/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xCaso/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-10-22T10:18:29Z",
  "updated_at": "2022-10-22T10:28:00Z",
  "closed_at": "2022-10-22T10:28:00Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (75ca1a8 2022-10-22T00:10:39.243783072Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge test, forge script\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Describe the bug\r\n\r\n## `forge test/coverage`\r\nWhen I'm testing with Mumbai (Polygon testnet) I see often these errors, running the command `forge test` (or `coverage`):\r\n\r\n```\r\n[⠰] Compiling...\r\n[⠢] Compiling 2 files with 0.8.13\r\n[⠆] Solc 0.8.13 finished in 19.75s\r\nCompiler run successful\r\nThe application panicked (crashed).\r\nMessage:  Unable to create fork: \r\nCould not instantiate forked environment with fork url: https://rpc-mumbai.matic.today\r\n\r\nContext:\r\n- Error #0: Failed to get gas price\r\n- Error #1: Deserialization Error: expected value at line 1 column 1. Response: User is not authorized to perform this action\r\nLocation: evm/src/executor/backend/mod.rs:410\r\n\r\nThis is a bug. Consider reporting it at https://github.com/foundry-rs/foundry\r\n\r\nBacktrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it.\r\nRun with RUST_BACKTRACE=full to include source snippets.\r\n[1]    26251 IOT instruction (core dumped)  forge test --fork-url https://rpc-mumbai.matic.today --fork-block-number  -vv\r\n```\r\nor:\r\n```\r\n[⠒] Compiling...\r\n[⠒] Compiling 32 files with 0.8.13\r\n[⠘] Solc 0.8.13 finished in 2.39s\r\nCompiler run successful\r\nAnalysing contracts...\r\nRunning tests...\r\nError: \r\nCould not instantiate forked environment with fork url: https://rpc-mumbai.matic.today\r\n\r\nContext:\r\n- Error #0: Failed to get block 28669025\r\n- Error #1: Deserialization Error: expected value at line 1 column 1. Response: User is not authorized to perform this action\r\n```\r\n## `forge script`\r\nWhen using `forge script` command, this problem happens more often (in the case below, I also don't own the addresses inside `GetAccount(0x...)`, mismatching the account derived from the provided private key):\r\n```\r\n[⠘] Compiling...\r\n[⠘] Compiling 1 files with 0.8.13\r\n[⠃] Solc 0.8.13 finished in 28.91s\r\nCompiler run successful\r\n2022-10-22T09:42:56.741034Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0x5b73c5498c1e3b4dba84de0f1833c4a029d90519, \r\nDeserialization Error: expected value at line 1 column 1. Response: User is not authorized to perform this action) address=0x5b73c5498c1e3b4dba84de0f1833c4a029d90519\r\n2022-10-22T09:42:58.340769Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0xb0ad7295130421ac286daa9910158d4d2eb67f70, \r\nDeserialization Error: expected value at line 1 column 1. Response: User is not authorized to perform this action) address=0xb0ad7295130421ac286daa9910158d4d2eb67f70\r\n```\r\nor:\r\n```\r\n[⠒] Compiling...\r\nNo files changed, compilation skipped\r\n2022-10-22T09:47:02.210072Z ERROR sharedbackend: Failed to send/recv `basic` err=GetAccount(0x0000000000000000000000000000000000000000, \r\nDeserialization Error: expected value at line 1 column 1. Response: User is not authorized to perform this action) address=0x0000000000000000000000000000000000000000\r\nThe application panicked (crashed).\r\nMessage:  called `Option::unwrap()` on a `None` value\r\nLocation: /home/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/revm-2.1.0/src/evm_impl.rs:258\r\n\r\nThis is a bug. Consider reporting it at https://github.com/foundry-rs/foundry\r\n\r\nBacktrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it.\r\nRun with RUST_BACKTRACE=full to include source snippets.\r\n[1]    37794 IOT instruction (core dumped)  forge script script/Deploy.s.sol:Deploy --rpc-url $MUMBAI_RPC_URL --broadcast\r\n```\r\nI don't know if they're all related to RPC problems or Foundry bugs, so I report everything I get. Also, if these are all RPC problems, maybe should be treated in another way.",
  "closed_by": {
    "login": "0xCaso",
    "id": 22419450,
    "node_id": "MDQ6VXNlcjIyNDE5NDUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22419450?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xCaso",
    "html_url": "https://github.com/0xCaso",
    "followers_url": "https://api.github.com/users/0xCaso/followers",
    "following_url": "https://api.github.com/users/0xCaso/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xCaso/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xCaso/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xCaso/subscriptions",
    "organizations_url": "https://api.github.com/users/0xCaso/orgs",
    "repos_url": "https://api.github.com/users/0xCaso/repos",
    "events_url": "https://api.github.com/users/0xCaso/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xCaso/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287753679",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3529#issuecomment-1287753679",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529",
    "id": 1287753679,
    "node_id": "IC_kwDOGBlvNc5MwY_P",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-22T10:22:07Z",
    "updated_at": "2022-10-22T10:22:07Z",
    "author_association": "MEMBER",
    "body": "> Response: User is not authorized to perform this action\r\n\r\ncould you try another rpc enpoint, looks like you're not authorized to use this",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287753679/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287754481",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3529#issuecomment-1287754481",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529",
    "id": 1287754481,
    "node_id": "IC_kwDOGBlvNc5MwZLx",
    "user": {
      "login": "0xCaso",
      "id": 22419450,
      "node_id": "MDQ6VXNlcjIyNDE5NDUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22419450?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xCaso",
      "html_url": "https://github.com/0xCaso",
      "followers_url": "https://api.github.com/users/0xCaso/followers",
      "following_url": "https://api.github.com/users/0xCaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xCaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xCaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xCaso/subscriptions",
      "organizations_url": "https://api.github.com/users/0xCaso/orgs",
      "repos_url": "https://api.github.com/users/0xCaso/repos",
      "events_url": "https://api.github.com/users/0xCaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xCaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-22T10:25:31Z",
    "updated_at": "2022-10-22T10:26:15Z",
    "author_association": "NONE",
    "body": "Actually, the problem comes out randomly: sometimes tests run successfully, also I managed to deploy the contracts with the script after 5/6 attempts, so I don't think the authorization is the problem",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287754481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287754646",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3529#issuecomment-1287754646",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529",
    "id": 1287754646,
    "node_id": "IC_kwDOGBlvNc5MwZOW",
    "user": {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-22T10:26:39Z",
    "updated_at": "2022-10-22T10:26:39Z",
    "author_association": "MEMBER",
    "body": "maybe there's rate-limiting involved that we don't catch but this definitely an issue with the endpoint.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287754646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287754847",
    "html_url": "https://github.com/foundry-rs/foundry/issues/3529#issuecomment-1287754847",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/3529",
    "id": 1287754847,
    "node_id": "IC_kwDOGBlvNc5MwZRf",
    "user": {
      "login": "0xCaso",
      "id": 22419450,
      "node_id": "MDQ6VXNlcjIyNDE5NDUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22419450?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xCaso",
      "html_url": "https://github.com/0xCaso",
      "followers_url": "https://api.github.com/users/0xCaso/followers",
      "following_url": "https://api.github.com/users/0xCaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xCaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xCaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xCaso/subscriptions",
      "organizations_url": "https://api.github.com/users/0xCaso/orgs",
      "repos_url": "https://api.github.com/users/0xCaso/repos",
      "events_url": "https://api.github.com/users/0xCaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xCaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-22T10:28:00Z",
    "updated_at": "2022-10-22T10:28:00Z",
    "author_association": "NONE",
    "body": "Perfect then, I'll close the issue, thanks :)",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1287754847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
