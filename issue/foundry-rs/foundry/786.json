{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/786",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/786",
  "id": 1146344997,
  "node_id": "I_kwDOGBlvNc5EU9Yl",
  "number": 786,
  "title": "ðŸ§° Feature: replace remappings.txt with foundry.source",
  "user": {
    "login": "sambacha",
    "id": 32783916,
    "node_id": "MDQ6VXNlcjMyNzgzOTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sambacha",
    "html_url": "https://github.com/sambacha",
    "followers_url": "https://api.github.com/users/sambacha/followers",
    "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
    "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
    "organizations_url": "https://api.github.com/users/sambacha/orgs",
    "repos_url": "https://api.github.com/users/sambacha/repos",
    "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sambacha/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3593644820,
      "node_id": "LA_kwDOGBlvNc7WMqsU",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-feature",
      "name": "T-feature",
      "color": "BFD4F2",
      "default": false,
      "description": "Type: feature"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-02-22T01:03:28Z",
  "updated_at": "2022-08-11T20:07:52Z",
  "closed_at": "2022-08-11T20:07:52Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge, Cast, Other (please describe)\r\n\r\n### Describe the feature you would like\r\n\r\n# foundry.source.json - replacement for remappings.txt\r\n\r\nTLDR: remappings.txt is encumbered by its own inadequacies. Such great rust-based tooling must be worthy of superior configuration format than the currently used one.\r\n\r\n> ðŸ§° This is a working draft, your questions and critiques are most welcomed. \r\n\r\n[TOC]\r\n  * [Motivation](#motivation)\r\n    + [current format: remappings.txt](#current-format--remappingstxt)\r\n      - [proposed format: foundry.source.json](#proposed-format--foundrysourcejson)\r\n  * [Import Maps](#import-maps)\r\n    + [Import Maps](#import-maps-1)\r\n  * [Generate the import mappings](#generate-the-import-mappings)\r\n      - [Inline Imports for contract testing](#inline-imports-for-contract-testing)\r\n\r\n##  ðŸ’¡ Motivation\r\n\r\nReplace `remappings.txt` with a new file, `foundry.source.json`\r\n\r\n- Remappings can be auto-generated and declared\r\n- Support for inline imports via remapping\r\n- Support for parallelizable test running via `@Scoping`\r\n- Support for `Resolutions` for changing a contract dependency with a user replacement\r\n- Support for nested directory structures for monorepos\r\n- Enable deployment a more declarative deployment process (potentially)\r\n\r\n\r\nHere are some issues that this change can potentially solve / eliminate \r\n\r\nhttps://github.com/gakonst/foundry/issues/768 - resolutions \r\nhttps://github.com/gakonst/foundry/issues/744 - inline imports \r\nhttps://github.com/gakonst/foundry/issues/768 - scopes \r\n\r\n\r\n## ðŸš¨ current format: remappings.txt\r\n\r\n```sh\r\nds-test/=lib/ds-test/src/\r\n@openzeppelin/=node_modules/@openzeppelin/\r\n@rari-capital/=node_modules/@rari-capital/\r\n@manifoldxyz/=node_modules/@manifoldxyz/\r\n```\r\n\r\n\r\n\r\n## ðŸ›  proposed format: foundry.source.json\r\n\r\nFoundry Source file format would be `.json`\r\n\r\nNote the leading :,  in the first entry which is necessary when the remapping context is empty. Otherwise the https: part would be interpreted by the compiler as the context.\r\n\r\n> {@link https://docs.soliditylang.org/en/develop/path-resolution.html#using-urls-in-imports}\r\n\r\n\r\n```jsonc\r\n{\r\n \r\n\t\"#imports\": {\r\n         \":https://github.com/sambacha/forge-scripts/\": \"$(pwd)/src/injected Inject.sol\",\r\n\t\t\"@openzeppelin/contracts/\": \"/node_modules/@openzeppelin/contracts/\", // validate against: ^[a-z][-a-z0-9]{0,255}$\r\n\t\t \"@uniswap/v2-core/\": \"/node_modules/@uniswap/v2-core/\",\r\n\t\t \"@uniswap/v3-periphery/\": \"/node_modules/@uniswap/v3-periphery/\"\r\n\t\t \"@boringcrypto/boring-solidity\": \"git+https://github.com/boringcrypto/BoringSolidity#ccb743d4\" // example using git repo\r\n\t},\r\n\t\"#inline\": {\r\n            \"@yearn/sdk/contracts/BaseStrategyV1.sol/\": [\"@scope1\", \"BaseStrategy\"], // see Inline Imports section for more\r\n\t},\r\n\t\"#resolutions\": {\r\n        \"@uniswap/v2-core/contracts/interfaces/IUniswapV2Pair.sol\": \"src/updates/IUniswapV2Pair02.sol\",\r\n    \"forge-stdlib\": {  // replacing hardhat's console with a forge-stdlib version\r\n      \"stdlib/console.sol\": \"hardhat/console.sol\"\r\n    },\r\n\t},\r\n  \"#scopes\":  {\r\n  \"tbd\": \"l8r\"\r\n}\r\n```\r\n\r\n## Import Maps\r\n\r\n> ex. [import_map rust crate used by Deno](https://crates.io/crates/import_map)\r\n\r\n> Note to use with esm / URL based imports\r\n\r\n```shell=\r\n ?pin=BUILD_VERSON\r\n```\r\n\r\n### Import Maps \r\n\r\nRead the specification here: https://github.com/WICG/import-maps\r\n\r\n```jsonc \r\n{\r\n \"dependencies\": {\r\n      \"@openzeppelin/contracts\": \"^4.5.0\",\r\n      \"@uniswap/v2-core\": \"^1.0.1\",\r\n      \"@uniswap/v3-periphery\": \"^1.4.0\"\r\n    }\r\n}\r\n```\r\n## Generate the import mappings \r\n\r\nGenerating a useful import map for existing nodejs projects is obtained by running the following command\r\n\r\n```sh \r\n$ npx importly < package.json > forge-importmap.json\r\n$ cat forge-importmap.json\r\n```\r\n\r\nWhich gives us:\r\n\r\n```jsonc \r\n{\r\n\r\n\"imports\": {\r\n\t\"@openzeppelin/contracts/\": \"/node_modules/@openzeppelin/contracts/\",\r\n\t\"@uniswap/v2-core/\": \"/node_modules/@uniswap/v2-core/\",\r\n\t\"@uniswap/v3-periphery/\": \"/node_modules/@uniswap/v3-periphery/\"\r\n\t},\r\n\"scopes\": {}\r\n}\r\n```\r\n\r\n\r\n#### Inline Imports for contract testing\r\n\r\nCreate a template solidity file and have forge compile however many times you define an import for that file\r\n\r\n```solidity\r\npragma solidity *;\r\n\r\n// We are actually importing \r\n// @yearn/sdk/contracts/BaseStrategyV1.sol, as defined in the forge-source file\r\nimport '<%= scope1 %>';\r\n\r\ncontract <%= scope1 %>Factory {\r\n\r\n    function newInstance() public returns(address) {\r\n     //  contractName = BaseStrategy, taken from @title in natspec\r\n        return new <%= contractName %>Data();\r\n    }\r\n}\r\n\r\n```\r\n\r\n## Summary\r\n\r\n![](https://en.meming.world/images/en/4/4a/Modern_Problems_Require_Modern_Solutions.jpg)\r\n\r\n\r\n\r\n### Additional context\r\n\r\n_No response_",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/786/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1053632282",
    "html_url": "https://github.com/foundry-rs/foundry/issues/786#issuecomment-1053632282",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786",
    "id": 1053632282,
    "node_id": "IC_kwDOGBlvNc4-zSca",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-27T17:59:51Z",
    "updated_at": "2022-02-27T17:59:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually, running\r\n\r\n```sh\r\nforge config --basic > foundry.toml\r\n```\r\n\r\ncreates a remappings for you as well, so this part at least should be aliased possibly ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1053632282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1061471055",
    "html_url": "https://github.com/foundry-rs/foundry/issues/786#issuecomment-1061471055",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786",
    "id": 1061471055,
    "node_id": "IC_kwDOGBlvNc4_RMNP",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-08T07:03:38Z",
    "updated_at": "2022-03-08T07:03:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Updated spec to include example of using a URL in which a colon `:`, is prefixed to the URL. This is  necessary when the remapping context is empty. Otherwise the https: part would be interpreted by the compiler as the context.\r\n\r\n{@link https://docs.soliditylang.org/en/develop/path-resolution.html#using-urls-in-imports }",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1061471055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1078623275",
    "html_url": "https://github.com/foundry-rs/foundry/issues/786#issuecomment-1078623275",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786",
    "id": 1078623275,
    "node_id": "IC_kwDOGBlvNc5ASnwr",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-25T03:41:56Z",
    "updated_at": "2022-03-25T03:41:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "the newest forge update includes a command `forge tree` which is similar to the example I provided above \r\n\r\n```\r\n$ forge tree\r\nsrc/TxManager.sol 0.6.7\r\nâ”œâ”€â”€ lib/ds-auth/src/auth.sol >=0.6.7\r\nâ”œâ”€â”€ lib/ds-token/lib/ds-math/src/math.sol >0.4.13\r\nâ”œâ”€â”€ lib/ds-token/lib/ds-stop/lib/ds-note/src/note.sol >=0.4.23\r\nâ””â”€â”€ lib/ds-token/lib/erc20/src/erc20.sol >0.4.20\r\nsrc/TxManager.t.sol 0.6.7\r\nâ”œâ”€â”€ lib/ds-test/src/test.sol >=0.4.23\r\nâ”œâ”€â”€ lib/ds-token/src/base.sol >=0.4.23\r\nâ”‚   â”œâ”€â”€ lib/ds-token/lib/erc20/src/erc20.sol >0.4.20\r\nâ”‚   â””â”€â”€ lib/ds-token/lib/ds-math/src/math.sol >0.4.13\r\nâ””â”€â”€ src/TxManager.sol 0.6.7 (*)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1078623275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1151968228",
    "html_url": "https://github.com/foundry-rs/foundry/issues/786#issuecomment-1151968228",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786",
    "id": 1151968228,
    "node_id": "IC_kwDOGBlvNc5EqaPk",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-10T05:43:17Z",
    "updated_at": "2022-06-10T05:43:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is partially implemented here: https://github.com/sambacha/forge-nix",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1151968228/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212437524",
    "html_url": "https://github.com/foundry-rs/foundry/issues/786#issuecomment-1212437524",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/786",
    "id": 1212437524,
    "node_id": "IC_kwDOGBlvNc5IRFQU",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-11T20:07:52Z",
    "updated_at": "2022-08-11T20:07:52Z",
    "author_association": "MEMBER",
    "body": "Closing this as out of scope for a couple of reasons:\r\n\r\n- I don't think this will see much usage, mostly because it isn't very explicit in the source code itself, which makes reasoning about imports harder, which makes auditing harder\r\n- This augments Solidity, which means we need to add some sort of preprocessing step which is itself out of scope for now. Augmenting Solidity also breaks compatibility with every other tool people might use (slither, echidna etc.)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212437524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
