{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/4701",
  "id": 1657725891,
  "node_id": "I_kwDOGBlvNc5izuPD",
  "number": 4701,
  "title": "Multichain deployment gives EOA nonce changed unexpectedly while sending transactions",
  "user": {
    "login": "0xTimepunk",
    "id": 45543880,
    "node_id": "MDQ6VXNlcjQ1NTQzODgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/45543880?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xTimepunk",
    "html_url": "https://github.com/0xTimepunk",
    "followers_url": "https://api.github.com/users/0xTimepunk/followers",
    "following_url": "https://api.github.com/users/0xTimepunk/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xTimepunk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xTimepunk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xTimepunk/subscriptions",
    "organizations_url": "https://api.github.com/users/0xTimepunk/orgs",
    "repos_url": "https://api.github.com/users/0xTimepunk/repos",
    "events_url": "https://api.github.com/users/0xTimepunk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xTimepunk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 4182991461,
      "node_id": "LA_kwDOGBlvNc75U2Jl",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-script",
      "name": "Cmd-forge-script",
      "color": "006B75",
      "default": false,
      "description": "Command: forge script"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-04-06T16:31:02Z",
  "updated_at": "2023-10-13T22:10:44Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (93016e6 2023-04-06T00:04:49.011111000Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge script\r\n\r\n### Operating System\r\n\r\nmacOS (Apple Silicon)\r\n\r\n### Describe the bug\r\n\r\nWhen doing a multi chain local deployment, with the script pointing to localhost instances of Anvil (6 running at the same time, each forking different mainnet RPCs using quick nodes as a provider), the forge script always gives the following error:\r\n\r\n`EOA nonce changed unexpectedly while sending transactions. Expected 3421 got 3370 from provider.), Err(\r\nEOA nonce changed unexpectedly while sending transactions. Expected 289 got 238 from provider.)]`\r\n\r\nThe nonces with errors are always different. It seems to be the issue with two of the providers, but I'm not sure how to find which one as the logs don't say.\r\n\r\nThe script is ran with \r\n\r\n```\r\nforge script script/Local.Deploy.s.sol \\\r\n    --broadcast \\\r\n    --private-key $LOCAL_PRIVATE_KEY\r\n```\r\n\r\nand is automatically detected as multi chain deployment. ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701/reactions",
    "total_count": 4,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1678121378",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4701#issuecomment-1678121378",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701",
    "id": 1678121378,
    "node_id": "IC_kwDOGBlvNc5kBhmi",
    "user": {
      "login": "wrinkledeth",
      "id": 97406595,
      "node_id": "U_kgDOBc5Ogw",
      "avatar_url": "https://avatars.githubusercontent.com/u/97406595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wrinkledeth",
      "html_url": "https://github.com/wrinkledeth",
      "followers_url": "https://api.github.com/users/wrinkledeth/followers",
      "following_url": "https://api.github.com/users/wrinkledeth/following{/other_user}",
      "gists_url": "https://api.github.com/users/wrinkledeth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wrinkledeth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wrinkledeth/subscriptions",
      "organizations_url": "https://api.github.com/users/wrinkledeth/orgs",
      "repos_url": "https://api.github.com/users/wrinkledeth/repos",
      "events_url": "https://api.github.com/users/wrinkledeth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wrinkledeth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-14T21:49:16Z",
    "updated_at": "2023-08-14T21:49:16Z",
    "author_association": "NONE",
    "body": "I'm experiencing the same bug. Also on mac (AppleSilicon), also during multi chain local deployment.  I don't always get this error, it happens intermittently. ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1678121378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1762304623",
    "html_url": "https://github.com/foundry-rs/foundry/issues/4701#issuecomment-1762304623",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/4701",
    "id": 1762304623,
    "node_id": "IC_kwDOGBlvNc5pCqJv",
    "user": {
      "login": "ArshanKhanifar",
      "id": 10492324,
      "node_id": "MDQ6VXNlcjEwNDkyMzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/10492324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ArshanKhanifar",
      "html_url": "https://github.com/ArshanKhanifar",
      "followers_url": "https://api.github.com/users/ArshanKhanifar/followers",
      "following_url": "https://api.github.com/users/ArshanKhanifar/following{/other_user}",
      "gists_url": "https://api.github.com/users/ArshanKhanifar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ArshanKhanifar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ArshanKhanifar/subscriptions",
      "organizations_url": "https://api.github.com/users/ArshanKhanifar/orgs",
      "repos_url": "https://api.github.com/users/ArshanKhanifar/repos",
      "events_url": "https://api.github.com/users/ArshanKhanifar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ArshanKhanifar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-13T22:10:44Z",
    "updated_at": "2023-10-13T22:10:44Z",
    "author_association": "NONE",
    "body": "I'm experiencing the same bug here.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1762304623/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
