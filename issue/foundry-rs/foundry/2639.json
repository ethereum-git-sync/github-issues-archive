{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2639",
  "id": 1330599410,
  "node_id": "I_kwDOGBlvNc5PT1Xy",
  "number": 2639,
  "title": "Debugger: No srcmap index ",
  "user": {
    "login": "markisus",
    "id": 469689,
    "node_id": "MDQ6VXNlcjQ2OTY4OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/469689?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/markisus",
    "html_url": "https://github.com/markisus",
    "followers_url": "https://api.github.com/users/markisus/followers",
    "following_url": "https://api.github.com/users/markisus/following{/other_user}",
    "gists_url": "https://api.github.com/users/markisus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/markisus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/markisus/subscriptions",
    "organizations_url": "https://api.github.com/users/markisus/orgs",
    "repos_url": "https://api.github.com/users/markisus/repos",
    "events_url": "https://api.github.com/users/markisus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/markisus/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 3703752787,
      "node_id": "LA_kwDOGBlvNc7cwshT",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-forge",
      "name": "C-forge",
      "color": "5319E7",
      "default": false,
      "description": "Command: forge"
    },
    {
      "id": 3776975605,
      "node_id": "LA_kwDOGBlvNc7hIBL1",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/Cmd-forge-debug",
      "name": "Cmd-forge-debug",
      "color": "006B75",
      "default": false,
      "description": "Command: forge run"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-08-06T01:10:41Z",
  "updated_at": "2022-08-11T18:11:13Z",
  "closed_at": "2022-08-11T18:11:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\r\n\r\nForge\r\n\r\n### Have you ensured that all of these are up to date?\r\n\r\n- [X] Foundry\r\n- [X] Foundryup\r\n\r\n### What version of Foundry are you on?\r\n\r\nforge 0.2.0 (92f8951 2022-08-06T00:12:01.790485419Z)\r\n\r\n### What command(s) is the bug in?\r\n\r\nforge test --debug \r\n\r\n### Operating System\r\n\r\nWSL2 in Windows 11\r\n\r\n### Describe the bug\r\n\r\n```solidity\r\n// Contract.t.sol\r\n// SPDX-License-Identifier: UNLICENSED\r\npragma solidity ^0.8.13;\r\n\r\nimport \"forge-std/Test.sol\";\r\n\r\ncontract ContractTest is Test {\r\n    function setUp() public {}\r\n\r\n    function noSrcMap(bytes memory in1, uint256[6] memory in2) public view returns (bool) {\r\n        return false;\r\n    }\r\n\r\n    function testNoSrcMap() public {\r\n        bytes memory in1;\r\n        uint256[6] memory in2;\r\n        noSrcMap(in1, in2);\r\n    }\r\n}\r\n```\r\n\r\nRun `forge test --debug testNoSrcMap` and step through. When debugger hits the noSrcMap() function call, the source disappears and the debugger reports \"No src map index\"",
  "closed_by": {
    "login": "onbjerg",
    "id": 8862627,
    "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/onbjerg",
    "html_url": "https://github.com/onbjerg",
    "followers_url": "https://api.github.com/users/onbjerg/followers",
    "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
    "organizations_url": "https://api.github.com/users/onbjerg/orgs",
    "repos_url": "https://api.github.com/users/onbjerg/repos",
    "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/onbjerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207117556",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1207117556",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1207117556,
    "node_id": "IC_kwDOGBlvNc5H8yb0",
    "user": {
      "login": "markisus",
      "id": 469689,
      "node_id": "MDQ6VXNlcjQ2OTY4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/469689?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markisus",
      "html_url": "https://github.com/markisus",
      "followers_url": "https://api.github.com/users/markisus/followers",
      "following_url": "https://api.github.com/users/markisus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markisus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markisus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markisus/subscriptions",
      "organizations_url": "https://api.github.com/users/markisus/orgs",
      "repos_url": "https://api.github.com/users/markisus/repos",
      "events_url": "https://api.github.com/users/markisus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markisus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-06T01:22:59Z",
    "updated_at": "2022-08-06T01:22:59Z",
    "author_association": "NONE",
    "body": "I also tried `forge debug test/Contract.t.sol` which crashed the program.\r\n```\r\nforge debug test/Contract.t.sol \r\n[⠆] Compiling...\r\nNo files changed, compilation skipped\r\nThe application panicked (crashed).\r\nMessage:  Function signature not found in the ABI\r\nLocation: cli/src/cmd/forge/script/mod.rs:412\r\n\r\nThis is a bug. Consider reporting it at https://github.com/foundry-rs/foundry\r\n\r\n  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\r\n   1: __libc_start_main<unknown>\r\n      at /build/glibc-SzIz7B/glibc-2.31/csu/../csu/libc-start.c:308\r\n\r\nRun with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering.\r\nRun with RUST_BACKTRACE=full to include source snippets.\r\nAborted\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207117556/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207440445",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1207440445",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1207440445,
    "node_id": "IC_kwDOGBlvNc5H-BQ9",
    "user": {
      "login": "joshieDo",
      "id": 93316087,
      "node_id": "U_kgDOBY_j9w",
      "avatar_url": "https://avatars.githubusercontent.com/u/93316087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshieDo",
      "html_url": "https://github.com/joshieDo",
      "followers_url": "https://api.github.com/users/joshieDo/followers",
      "following_url": "https://api.github.com/users/joshieDo/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshieDo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshieDo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshieDo/subscriptions",
      "organizations_url": "https://api.github.com/users/joshieDo/orgs",
      "repos_url": "https://api.github.com/users/joshieDo/repos",
      "events_url": "https://api.github.com/users/joshieDo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshieDo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-07T16:18:14Z",
    "updated_at": "2022-08-07T16:19:22Z",
    "author_association": "COLLABORATOR",
    "body": "`debug` and `script` executes the `run()` function by default from the contract passed. If you don't have one or specifiy an alternative through `--sig`, it will give that error (which should be better). ",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207440445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207441449",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1207441449",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1207441449,
    "node_id": "IC_kwDOGBlvNc5H-Bgp",
    "user": {
      "login": "joshieDo",
      "id": 93316087,
      "node_id": "U_kgDOBY_j9w",
      "avatar_url": "https://avatars.githubusercontent.com/u/93316087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshieDo",
      "html_url": "https://github.com/joshieDo",
      "followers_url": "https://api.github.com/users/joshieDo/followers",
      "following_url": "https://api.github.com/users/joshieDo/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshieDo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshieDo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshieDo/subscriptions",
      "organizations_url": "https://api.github.com/users/joshieDo/orgs",
      "repos_url": "https://api.github.com/users/joshieDo/repos",
      "events_url": "https://api.github.com/users/joshieDo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshieDo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-07T16:25:09Z",
    "updated_at": "2022-08-07T16:25:09Z",
    "author_association": "COLLABORATOR",
    "body": "About the original bug, is this just a simplification of what you've hit in another project?\r\n\r\nAbout this specific case, this seems like an optimization made by the compiler, leading to certain `srcmaps` not being present. I have an impression,  `forge coverage` has similar challenges when the optimizer is turned on (@onbjerg  right..? )\r\n\r\nI tried it locally, and once i added `optimizer = false` to my `foundry.toml`, i was able to step through everything nicely.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207441449/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207451871",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1207451871",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1207451871,
    "node_id": "IC_kwDOGBlvNc5H-EDf",
    "user": {
      "login": "markisus",
      "id": 469689,
      "node_id": "MDQ6VXNlcjQ2OTY4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/469689?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markisus",
      "html_url": "https://github.com/markisus",
      "followers_url": "https://api.github.com/users/markisus/followers",
      "following_url": "https://api.github.com/users/markisus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markisus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markisus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markisus/subscriptions",
      "organizations_url": "https://api.github.com/users/markisus/orgs",
      "repos_url": "https://api.github.com/users/markisus/repos",
      "events_url": "https://api.github.com/users/markisus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markisus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-07T17:32:23Z",
    "updated_at": "2022-08-07T17:32:38Z",
    "author_association": "NONE",
    "body": "Weird, `optimizer = false` doesn't seem to help me. Right now I have this in my foundry.toml and still getting the no srcmap issue.\r\n```\r\n[profile.default]\r\nsrc = 'src'\r\nout = 'out'\r\nlibs = ['lib']\r\nvia_ir = false\r\noptimizer = false\r\noptimizer_runs = 0\r\noptimizer_steps = 0\r\n\r\n# See more config options https://github.com/foundry-rs/foundry/tree/master/config\r\n```\r\n\r\nAnd yes this snippet is coming from the signature in this contract https://github.com/tornadocash/tornado-core/blob/1ef6a263ac6a0e476d063fcb269a9df65a1bd56a/contracts/Verifier.sol#L192\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207451871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207452857",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1207452857",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1207452857,
    "node_id": "IC_kwDOGBlvNc5H-ES5",
    "user": {
      "login": "markisus",
      "id": 469689,
      "node_id": "MDQ6VXNlcjQ2OTY4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/469689?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/markisus",
      "html_url": "https://github.com/markisus",
      "followers_url": "https://api.github.com/users/markisus/followers",
      "following_url": "https://api.github.com/users/markisus/following{/other_user}",
      "gists_url": "https://api.github.com/users/markisus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/markisus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/markisus/subscriptions",
      "organizations_url": "https://api.github.com/users/markisus/orgs",
      "repos_url": "https://api.github.com/users/markisus/repos",
      "events_url": "https://api.github.com/users/markisus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/markisus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-07T17:38:16Z",
    "updated_at": "2022-08-07T17:38:16Z",
    "author_association": "NONE",
    "body": "Nevermind I think this was due to a secondary bug. Changing foundry.toml is not sufficient to trigger a recompile. You also have to make a no-op change to the contract for it to blow away the cache.",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1207452857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1208411945",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1208411945",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1208411945,
    "node_id": "IC_kwDOGBlvNc5IBucp",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-08T17:35:04Z",
    "updated_at": "2022-08-08T17:36:22Z",
    "author_association": "MEMBER",
    "body": "@joshieDo The source map is always present unless the contract is abstract or a library with only internal functions (those don't have bytecode). The optimizer just makes the source map not so helpful in some situations (e.g. some bytecode maps to the wrong source range, some source ranges have no associated bytecode in the source map etc.)\r\n\r\nIf the debugger didn't crash, it's likely not a bug: we added this message because we knew there is a chance that some source is not covered by the source map. Not entirely sure what the solution would be here :)\r\n\r\n@markisus Can you report the optimizer config setting not triggering a rebuild as a separate bug? If running w/o the optimizer works, imo we should close this issue, since it's not really something we can do anything about :/",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1208411945/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212325307",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2639#issuecomment-1212325307",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2639",
    "id": 1212325307,
    "node_id": "IC_kwDOGBlvNc5IQp27",
    "user": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-11T18:11:12Z",
    "updated_at": "2022-08-11T18:11:12Z",
    "author_association": "MEMBER",
    "body": "Closed since it's a source map issue in Solidity, created #2726 for the optimizer issue",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1212325307/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
