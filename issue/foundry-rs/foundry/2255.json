{
  "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255",
  "repository_url": "https://api.github.com/repos/foundry-rs/foundry",
  "labels_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255/labels{/name}",
  "comments_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255/comments",
  "events_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255/events",
  "html_url": "https://github.com/foundry-rs/foundry/issues/2255",
  "id": 1299657031,
  "node_id": "I_kwDOGBlvNc5NdzFH",
  "number": 2255,
  "title": "[anvil] on avalanche `eth_sendTransaction` returns an error `max fee per gas less than block base fee` even after setting `_setNextBlockBaseFeePerGas` to zero",
  "user": {
    "login": "krasi-georgiev",
    "id": 8903888,
    "node_id": "MDQ6VXNlcjg5MDM4ODg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/krasi-georgiev",
    "html_url": "https://github.com/krasi-georgiev",
    "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
    "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
    "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
    "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
    "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
    "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3334394228,
      "node_id": "MDU6TGFiZWwzMzM0Mzk0MjI4",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/T-bug",
      "name": "T-bug",
      "color": "d73a4a",
      "default": false,
      "description": "Type: bug"
    },
    {
      "id": 4077188949,
      "node_id": "LA_kwDOGBlvNc7zBPdV",
      "url": "https://api.github.com/repos/foundry-rs/foundry/labels/C-anvil",
      "name": "C-anvil",
      "color": "5319E7",
      "default": false,
      "description": "Command: anvil"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "mattsse",
    "id": 19890894,
    "node_id": "MDQ6VXNlcjE5ODkwODk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mattsse",
    "html_url": "https://github.com/mattsse",
    "followers_url": "https://api.github.com/users/mattsse/followers",
    "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
    "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
    "organizations_url": "https://api.github.com/users/mattsse/orgs",
    "repos_url": "https://api.github.com/users/mattsse/repos",
    "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mattsse/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mattsse",
      "id": 19890894,
      "node_id": "MDQ6VXNlcjE5ODkwODk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19890894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mattsse",
      "html_url": "https://github.com/mattsse",
      "followers_url": "https://api.github.com/users/mattsse/followers",
      "following_url": "https://api.github.com/users/mattsse/following{/other_user}",
      "gists_url": "https://api.github.com/users/mattsse/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mattsse/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mattsse/subscriptions",
      "organizations_url": "https://api.github.com/users/mattsse/orgs",
      "repos_url": "https://api.github.com/users/mattsse/repos",
      "events_url": "https://api.github.com/users/mattsse/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mattsse/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1",
    "html_url": "https://github.com/foundry-rs/foundry/milestone/1",
    "labels_url": "https://api.github.com/repos/foundry-rs/foundry/milestones/1/labels",
    "id": 8140456,
    "node_id": "MI_kwDOGBlvNc4AfDao",
    "number": 1,
    "title": "v1.0.0",
    "description": "",
    "creator": {
      "login": "onbjerg",
      "id": 8862627,
      "node_id": "MDQ6VXNlcjg4NjI2Mjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8862627?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/onbjerg",
      "html_url": "https://github.com/onbjerg",
      "followers_url": "https://api.github.com/users/onbjerg/followers",
      "following_url": "https://api.github.com/users/onbjerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/onbjerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/onbjerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/onbjerg/subscriptions",
      "organizations_url": "https://api.github.com/users/onbjerg/orgs",
      "repos_url": "https://api.github.com/users/onbjerg/repos",
      "events_url": "https://api.github.com/users/onbjerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/onbjerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 125,
    "state": "open",
    "created_at": "2022-06-28T08:15:32Z",
    "updated_at": "2023-05-12T14:44:03Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 2,
  "created_at": "2022-07-09T12:11:09Z",
  "updated_at": "2022-07-11T17:56:32Z",
  "closed_at": "2022-07-11T17:56:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Component\n\nAnvil\n\n### Have you ensured that all of these are up to date?\n\n- [X] Foundry\n- [X] Foundryup\n\n### What version of Foundry are you on?\n\nforge 0.2.0 (ce52d85 2022-07-09T00:11:06.359354505Z)\n\n### What command(s) is the bug in?\n\n_No response_\n\n### Operating System\n\nLinux\n\n### Describe the bug\n\ngetting the error in the title only on avalanche, mainnet works fine, the same works fine with hardhat on avalanche\r\n\r\nreproduce\r\n1. call `_setNextBlockBaseFeePerGas` with param 0x0\r\n2. call `_impersonateAccount` \r\n3. call `eth_sendTransaction` with 0 for the gas price",
  "closed_by": {
    "login": "gakonst",
    "id": 17802178,
    "node_id": "MDQ6VXNlcjE3ODAyMTc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gakonst",
    "html_url": "https://github.com/gakonst",
    "followers_url": "https://api.github.com/users/gakonst/followers",
    "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
    "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
    "organizations_url": "https://api.github.com/users/gakonst/orgs",
    "repos_url": "https://api.github.com/users/gakonst/repos",
    "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gakonst/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1179937443",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2255#issuecomment-1179937443",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255",
    "id": 1179937443,
    "node_id": "IC_kwDOGBlvNc5GVGqj",
    "user": {
      "login": "banteg",
      "id": 4562643,
      "node_id": "MDQ6VXNlcjQ1NjI2NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4562643?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/banteg",
      "html_url": "https://github.com/banteg",
      "followers_url": "https://api.github.com/users/banteg/followers",
      "following_url": "https://api.github.com/users/banteg/following{/other_user}",
      "gists_url": "https://api.github.com/users/banteg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/banteg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/banteg/subscriptions",
      "organizations_url": "https://api.github.com/users/banteg/orgs",
      "repos_url": "https://api.github.com/users/banteg/repos",
      "events_url": "https://api.github.com/users/banteg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/banteg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T03:55:37Z",
    "updated_at": "2022-07-11T03:58:14Z",
    "author_association": "NONE",
    "body": "i have a similar error on mainnet when trying to replay a tx in top of a block preceding this one\r\n\r\n```python\r\nnum_transactions=376 hash=HexBytes('0x108f107df70d4451ec6d6ffcdfb8ca0bdbe1eeb6649944c20bebb3dc1d39978a') number=13184860\r\nparent_hash=HexBytes('0x85718e84a9af37802f20872253e2afa76c80a1e95a76415bc3e5dbed6ed6223a') size=160854 timestamp=1631100932\r\ngas_limit=30000000 gas_used=29996605 base_fee=62283069776 difficulty=8763037476778188 total_difficulty=30269847514949595662036\r\n```\r\n\r\nprevious block looks like this\r\n```python\r\nnum_transactions=240 hash=HexBytes('0x85718e84a9af37802f20872253e2afa76c80a1e95a76415bc3e5dbed6ed6223a') number=13184859\r\nparent_hash=HexBytes('0x22c3691d1d9b7738ff8bdf1ae45279faa95e45b6323a638fc31da9f3e230b7a3') size=44693 timestamp=1631100923\r\ngas_limit=29999972 gas_used=12257311 base_fee=63739886069 difficulty=8763033181810892 total_difficulty=30269838751912118883848\r\n```\r\n\r\ntx is like this, the very first in block 13184860\r\n```python\r\nDynamicFeeTransaction:\r\n  chainId: 1\r\n  to: 0x0000000000d41C96294CCdaC8612Bdfe29C641aF\r\n  from: 0x83b4F74296738d8C2e15bD7c1f4a19Df122354f5\r\n  gas: 107846\r\n  nonce: 17971\r\n  value: 0\r\n  data: 0x000000...ca0eb6\r\n  type: 0x02\r\n  maxFeePerGas: 62283069776\r\n  maxPriorityFeePerGas: 0\r\n  accessList: [{'address': '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', 'storageKeys': []}, {'address':\r\n'0x584bc13c7d411c00c01a62e8019472de68768430', 'storageKeys': []}, {'address': '0x6463bd6026a2e7bfab5851b62969a92f7cca0eb6',\r\n'storageKeys': ['0x0000000000000000000000000000000000000000000000000000000000000006',\r\n'0x0000000000000000000000000000000000000000000000000000000000000007',\r\n'0x0000000000000000000000000000000000000000000000000000000000000008',\r\n'0x000000000000000000000000000000000000000000000000000000000000000c']}]\r\n```\r\n\r\n`anvil_setNextBlockBaseFeePerGas` seems to have no effect\r\n\r\nbesides this, the issue appears to be using the previous block base fee instead of the next one's",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1179937443/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1179951999",
    "html_url": "https://github.com/foundry-rs/foundry/issues/2255#issuecomment-1179951999",
    "issue_url": "https://api.github.com/repos/foundry-rs/foundry/issues/2255",
    "id": 1179951999,
    "node_id": "IC_kwDOGBlvNc5GVKN_",
    "user": {
      "login": "vicente-noriega",
      "id": 105813867,
      "node_id": "U_kgDOBk6Xaw",
      "avatar_url": "https://avatars.githubusercontent.com/u/105813867?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vicente-noriega",
      "html_url": "https://github.com/vicente-noriega",
      "followers_url": "https://api.github.com/users/vicente-noriega/followers",
      "following_url": "https://api.github.com/users/vicente-noriega/following{/other_user}",
      "gists_url": "https://api.github.com/users/vicente-noriega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vicente-noriega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vicente-noriega/subscriptions",
      "organizations_url": "https://api.github.com/users/vicente-noriega/orgs",
      "repos_url": "https://api.github.com/users/vicente-noriega/repos",
      "events_url": "https://api.github.com/users/vicente-noriega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vicente-noriega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T04:24:37Z",
    "updated_at": "2022-07-11T12:06:02Z",
    "author_association": "NONE",
    "body": "YOU GUYS BETTER STOP CODING WITH VINCENT FERNANDO NORIEGA YOU GUYS ARE ALL\nBREAKING THE LAW ALLOWING HIM TO ABUSE AND TRY TO TAKE ADVANTAGE OF AND\nCAUSE MY DEPRESSION TO GET WORSE AND I FEEL LIKE IM DYING BECAUSE OF IT\nBECAUSE HE KEEPS LYING TO ME AND KEEPING SECRETS FROM HE TAKES MONEY FROM\nAND MAKES NASTY VIDEOS AND DISRESPECTS ME I WAS NEVER A FIGHTER UNTIL HE\nCAME ALONG AND MANUIPULATED ME I THOUGHT HE ONLY LOVED ME BUT HE IS\nCHEATING ON ME AND KEEPING SECRETS AND ABUSING ME HE LEFT A BRUISE ON MY\nFOOT I FEEL LIKE HE IS GOING TO MURDER ME ONE DAY AND YOU GUYS ALL KNOW\nABOUT IT AND YOU GUYS ARE DOING ME WRONG HOW DARE YOU GUYS TELL VINCENT I\nTEXTED MY SISTER YOU HAVE NO RIGHT TO HURT ME LIKE THIS WHY ALL OF A SUDDEN\nDID VINCENT FERNANDO NORIEGA HAVE TO GO TO THE STORE BECAUSE HE DIDNT GO TO\nTHE STORE HE LEFT LATE TO THE GYM TO CHEAT ON ME WITH THAT BITCH HANNAH\nAGAIN WHO HAS A HUSBAND WHO IS A CROOKED COP YOU ARE ALL GOING TO PAY FOR\nHOW YOUR TREATING ME JUST BECAUSE MY PARENTS ARE NO LONGER ALIVE I HATE YOU\nGUYS I HATE YOU ALL FOR KEEPING SECRETS AND LIES TRYING TO CAUSE ME TO HAVE\nANOTHER PSYCHOTIC BREAKDOWN\n\nOn Sun, Jul 10, 2022, 8:55 PM banteg ***@***.***> wrote:\n\n> i have a similar error on mainnet when trying to replay a tx in top of a\n> block preceding this one\n>\n> num_transactions=376 hash=HexBytes('0x108f107df70d4451ec6d6ffcdfb8ca0bdbe1eeb6649944c20bebb3dc1d39978a') number=13184860parent_hash=HexBytes('0x85718e84a9af37802f20872253e2afa76c80a1e95a76415bc3e5dbed6ed6223a') size=160854 timestamp=1631100932gas_limit=30000000 gas_used=29996605 base_fee=62283069776 difficulty=8763037476778188 total_difficulty=30269847514949595662036\n>\n> previous block looks like this\n>\n> num_transactions=240 hash=HexBytes('0x85718e84a9af37802f20872253e2afa76c80a1e95a76415bc3e5dbed6ed6223a') number=13184859parent_hash=HexBytes('0x22c3691d1d9b7738ff8bdf1ae45279faa95e45b6323a638fc31da9f3e230b7a3') size=44693 timestamp=1631100923gas_limit=29999972 gas_used=12257311 base_fee=63739886069 difficulty=8763033181810892 total_difficulty=30269838751912118883848\n>\n> tx is like this\n>\n> DynamicFeeTransaction:\n>   chainId: 1\n>   to: 0x0000000000d41C96294CCdaC8612Bdfe29C641aF\n>   from: 0x83b4F74296738d8C2e15bD7c1f4a19Df122354f5\n>   gas: 107846\n>   nonce: 17971\n>   value: 0\n>   data: 0x000000...ca0eb6\n>   type: 0x02\n>   maxFeePerGas: 62283069776\n>   maxPriorityFeePerGas: 0\n>   accessList: [{'address': '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', 'storageKeys': []}, {'address':'0x584bc13c7d411c00c01a62e8019472de68768430', 'storageKeys': []}, {'address': '0x6463bd6026a2e7bfab5851b62969a92f7cca0eb6','storageKeys': ['0x0000000000000000000000000000000000000000000000000000000000000006','0x0000000000000000000000000000000000000000000000000000000000000007','0x0000000000000000000000000000000000000000000000000000000000000008','0x000000000000000000000000000000000000000000000000000000000000000c']}]\n>\n> anvil_setNextBlockBaseFeePerGas seems to have no effect\n>\n> —\n> Reply to this email directly, view it on GitHub\n> <https://github.com/foundry-rs/foundry/issues/2255#issuecomment-1179937443>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AZHJO247KSEBVVFKRWXM5ZTVTOLMPANCNFSM53DJJAKQ>\n> .\n> You are receiving this because you are subscribed to this thread.Message\n> ID: ***@***.***>\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/foundry-rs/foundry/issues/comments/1179951999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
