{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/18360",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/18360",
  "id": 2062615918,
  "node_id": "I_kwDOAx4p2c568QVu",
  "number": 18360,
  "title": "remove `|| true` hacks from `make nix-purge` ",
  "user": {
    "login": "siddarthkay",
    "id": 64726664,
    "node_id": "MDQ6VXNlcjY0NzI2NjY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siddarthkay",
    "html_url": "https://github.com/siddarthkay",
    "followers_url": "https://api.github.com/users/siddarthkay/followers",
    "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
    "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
    "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
    "repos_url": "https://api.github.com/users/siddarthkay/repos",
    "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "siddarthkay",
    "id": 64726664,
    "node_id": "MDQ6VXNlcjY0NzI2NjY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siddarthkay",
    "html_url": "https://github.com/siddarthkay",
    "followers_url": "https://api.github.com/users/siddarthkay/followers",
    "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
    "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
    "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
    "repos_url": "https://api.github.com/users/siddarthkay/repos",
    "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2024-01-02T15:58:36Z",
  "updated_at": "2024-01-29T06:17:02Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Problem\r\n\r\nI introduced a bunch of hacks in the purge script for Darwin here : https://github.com/status-im/status-mobile/pull/18192\r\nWe should remove these hacks and modify the script to work without omitting failures",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/18360/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1913682931",
    "html_url": "https://github.com/status-im/status-mobile/issues/18360#issuecomment-1913682931",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360",
    "id": 1913682931,
    "node_id": "IC_kwDOAx4p2c5yEHvz",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-28T18:27:05Z",
    "updated_at": "2024-01-28T18:27:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Removed hacks here : https://github.com/status-im/status-mobile/commit/1e2acbfacba9b5d78c596cbb90e5f6b47ec5e5ea\r\n\r\nfirst failure I get when i do `make nix-purge` is this : \r\n\r\n```\r\nmake nix-purge\r\nnix/scripts/purge.sh\r\nAre you sure you want to purge Nix?\r\n[y/n]: y\r\nDetected multi-user Nix installation.\r\nPassword:\r\nmake: *** [nix-purge] Error 3\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1913682931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1913684978",
    "html_url": "https://github.com/status-im/status-mobile/issues/18360#issuecomment-1913684978",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360",
    "id": 1913684978,
    "node_id": "IC_kwDOAx4p2c5yEIPy",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-28T18:35:06Z",
    "updated_at": "2024-01-28T18:35:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "I retry `make nix-purge` and this time I get : \r\n\r\n```\r\nmake nix-purge\r\nnix/scripts/purge.sh\r\nAre you sure you want to purge Nix?\r\n[y/n]: y\r\nDetected multi-user Nix installation.\r\nPassword:\r\nUnload failed: 5: Input/output error\r\nTry running `launchctl bootout` as root for richer errors.\r\nmake: *** [nix-purge] Error 3\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1913684978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1913902148",
    "html_url": "https://github.com/status-im/status-mobile/issues/18360#issuecomment-1913902148",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360",
    "id": 1913902148,
    "node_id": "IC_kwDOAx4p2c5yE9RE",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-29T03:31:16Z",
    "updated_at": "2024-01-29T03:31:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "After I replaced this code with this function `nix_purge_darwin_multi_user_service` by referring : \r\nhttps://nixos.org/manual/nix/stable/installation/uninstall.html#:~:text=Stop%20and%20remove%20the%20Nix%20daemon%20services%3A\r\n\r\n```bash\r\nnix_purge_darwin_multi_user_service() {\r\n    sudo launchctl unload /Library/LaunchDaemons/org.nixos.nix-daemon.plist\r\n    sudo rm /Library/LaunchDaemons/org.nixos.nix-daemon.plist\r\n    sudo launchctl unload /Library/LaunchDaemons/org.nixos.darwin-store.plist\r\n    sudo rm /Library/LaunchDaemons/org.nixos.darwin-store.plist\r\n}\r\n```\r\n\r\nI did get the unload failed error but the script continued all the way till the end and purged nix : \r\n```\r\nmake nix-purge\r\nnix/scripts/purge.sh\r\nAre you sure you want to purge Nix?\r\n[y/n]: y\r\nDetected multi-user Nix installation.\r\nPassword:\r\nUnload failed: 5: Input/output error\r\nTry running `launchctl bootout` as root for richer errors.\r\nStarted APFS operation\r\nDeleting APFS Volume from its APFS Container\r\nUnmounting disk3s7\r\nErasing any xART session referenced by 460BF433-5022-44B1-9D24-BE191B1CC0AD\r\nDeleting Volume\r\nRemoving any Preboot and Recovery Directories\r\nFinished APFS operation\r\nYou will need to reboot your system!\r\nPurged all Nix files from your system.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1913902148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1914031551",
    "html_url": "https://github.com/status-im/status-mobile/issues/18360#issuecomment-1914031551",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18360",
    "id": 1914031551,
    "node_id": "IC_kwDOAx4p2c5yFc2_",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-29T06:17:01Z",
    "updated_at": "2024-01-29T06:17:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "this time it didn't even provide the `unload failed` warning\r\n\r\n```\r\nmake nix-purge\r\nnix/scripts/purge.sh\r\nAre you sure you want to purge Nix?\r\n[y/n]: y\r\nDetected multi-user Nix installation.\r\nPassword:\r\nStarted APFS operation\r\nDeleting APFS Volume from its APFS Container\r\nUnmounting disk3s7\r\nErasing any xART session referenced by 2191F157-2768-4A54-AC70-2403B09ABC85\r\nDeleting Volume\r\nRemoving any Preboot and Recovery Directories\r\nFinished APFS operation\r\nYou will need to reboot your system!\r\nPurged all Nix files from your system.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1914031551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
