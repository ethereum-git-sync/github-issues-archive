{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/13783",
  "id": 1333485266,
  "node_id": "I_kwDOAx4p2c5Pe17S",
  "number": 13783,
  "title": "Android builds fail on Darwin due to watchman issues",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 448876669,
      "node_id": "MDU6TGFiZWw0NDg4NzY2Njk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/android",
      "name": "android",
      "color": "5319e7",
      "default": false,
      "description": null
    },
    {
      "id": 1311328202,
      "node_id": "MDU6TGFiZWwxMzExMzI4MjAy",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/nix",
      "name": "nix",
      "color": "0052cc",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 17,
  "created_at": "2022-08-09T16:11:27Z",
  "updated_at": "2022-08-10T10:09:47Z",
  "closed_at": "2022-08-10T10:09:46Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Currently if someone tries to build Android on a Darwin OS using a multi-user Nix installation they will get this from Gradle:\r\n```\r\n> Task :app:bundleReleaseJsAndAssets\r\nwarning: the transform cache was reset.\r\n2022-08-09T13:21:32,914: [cli] unable to talk to your watchman on /tmp/tmp-status-mobile-a94797710/jenkins-state/sock! (Permission denied)\r\n\r\nWatchman:  watchman --no-pretty get-sockname returned with exit code=1, signal=null, stderr= 2022-08-09T13:21:32,914: [cli] unable to talk to your watchman on /tmp/tmp-status-mobile-a94797710/jenkins-state/sock! (Permission denied)\r\n```\r\nWhich is caused by limited permissions of the `watchman` socket:\r\n```\r\njenkins@maci7-03.ms-eu-dublin.slave.ci:~/status-mobile % ls -l /tmp/tmp-status-mobile-a94797710/jenkins-state/sock \r\nsrw-------  1 jenkins  wheel  0 Aug  9 14:14 /tmp/tmp-status-mobile-a94797710/jenkins-state/sock\r\njenkins@maci7-03.ms-eu-dublin.slave.ci:~/status-mobile % ls -l /tmp/tmp-status-mobile-a94797710/             \r\ntotal 40\r\n-rw-r--r--  1 jenkins  wheel  16527 Aug  9 15:52 env-vars\r\ndrwx------  5 jenkins  wheel    160 Aug  9 14:14 jenkins-state\r\n```\r\nCreated by the `scripts/build-android.sh` script:\r\nhttps://github.com/status-im/status-mobile/blob/b565cbf85e496dd08c73230d45fe24d90b989c77/scripts/build-android.sh#L54-L58\r\n\r\nSince builds are run as `nixbld*` users we either have to fix permissions, or change how we start Watchman in the first place.",
  "closed_by": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/13783/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209590382",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209590382",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209590382,
    "node_id": "IC_kwDOAx4p2c5IGOJu",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:13:27Z",
    "updated_at": "2022-08-09T16:13:27Z",
    "author_association": "MEMBER",
    "body": "If I try to drop starting Watchman entirely, and remove it from the Android build, I get this:\r\n```\r\n> Task :app:bundleReleaseJsAndAssets\r\nwarning: the transform cache was reset.\r\n                 Welcome to React Native!\r\n                Learn once, write anywhere\r\n\r\n\r\nnode:events:505\r\n      throw er; // Unhandled 'error' event\r\n      ^\r\n\r\nError: EMFILE: too many open files, watch\r\n    at FSEvent.FSWatcher._handle.onchange (node:internal/fs/watchers:204:21)\r\nEmitted 'error' event on NodeWatcher instance at:\r\n    at NodeWatcher.checkedEmitError (/private/tmp/nix-build-status-mobile-build-nightly-android.drv-0/node_modules/sane/src/node_watcher.js:143:12)\r\n    at FSWatcher.emit (node:events:527:28)\r\n    at FSEvent.FSWatcher._handle.onchange (node:internal/fs/watchers:210:12) {\r\n  errno: -24,\r\n  syscall: 'watch',\r\n  code: 'EMFILE',\r\n  filename: null\r\n}\r\n\r\n> Task :app:bundleReleaseJsAndAssets FAILED\r\n```\r\nWhich makes sense, since that's kinda what Watchman fixes for a lot of people:\r\n\r\n* https://stackoverflow.com/questions/58675179/error-emfile-too-many-open-files-react-native-cli",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209590382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209594668",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209594668",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209594668,
    "node_id": "IC_kwDOAx4p2c5IGPMs",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:17:43Z",
    "updated_at": "2022-08-09T16:17:43Z",
    "author_association": "MEMBER",
    "body": "Normally, we provide a wrapped Watchman instance which already has a socket path specified:\r\nhttps://github.com/status-im/status-mobile/blob/b565cbf85e496dd08c73230d45fe24d90b989c77/nix/mobile/android/watchman.nix#L13-L15\r\n\r\nBut if I try to provide unwrapped Watchman directly to the Android build, it fails with:\r\n```\r\n[cli] Failed to open /var/empty/Library/LaunchAgents/com.github.facebook.watchman.plist for write: No such file or directory\r\n\r\nWatchman:  watchman --no-pretty get-sockname returned with exit code=null, signal=SIGABRT, stderr= 2022-08-09T15:47:23,705: [cli] Failed to open /var/empty/Library/LaunchAgents/com.github.facebook.watchman.plist for write: No such file or directory\r\n\r\nError! Failed to open file: /private/tmp/nix-build-status-mobile-build-nightly-android.drv-0/android/app/build/generated/assets/react/release/index.android.bundle\r\n\r\n> Task :app:bundleReleaseJsAndAssets FAILED\r\n```\r\nWhich is something I have not seen before.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209594668/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209596541",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209596541",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209596541,
    "node_id": "IC_kwDOAx4p2c5IGPp9",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:19:38Z",
    "updated_at": "2022-08-09T16:19:38Z",
    "author_association": "MEMBER",
    "body": "Interestingly enough, this was originally introduced to `Fix Android build on macOS` by Pedro: https://github.com/status-im/status-mobile/commit/46e3b528098b23a498d8c3559b202f48625cdfd1\r\n\r\nSo I assume this was done to fix the `EMFILE: too many open files` error seen above.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209596541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209605302",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209605302",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209605302,
    "node_id": "IC_kwDOAx4p2c5IGRy2",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:28:06Z",
    "updated_at": "2022-08-09T16:28:06Z",
    "author_association": "MEMBER",
    "body": "It appears the `com.github.facebook.watchman.plist` path can be found in the `spawn_via_launchd()` function:\r\n```cpp\r\n  snprintf(\r\n      plist_path,\r\n      sizeof(plist_path),\r\n      \"%s/Library/LaunchAgents/com.github.facebook.watchman.plist\",\r\n      pw->pw_dir);\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/main.cpp#L466-L470\r\n\r\nAnd inside of `try_spawn_watchman()` function we can see this:\r\n```cpp\r\n#if defined(__APPLE__)\r\n  return spawn_via_launchd();\r\n#elif defined(_WIN32)\r\n  return spawn_win32(daemon_argv);\r\n#else\r\n  return run_service_as_daemon();\r\n#endif\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/main.cpp#L969-L976\r\n\r\nSo it appears the default way Watchman wants to spawn under Darwin is using Launchd, but that can't work in Nix sandbox.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209605302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209608067",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209608067",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209608067,
    "node_id": "IC_kwDOAx4p2c5IGSeD",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:30:44Z",
    "updated_at": "2022-08-09T16:30:44Z",
    "author_association": "MEMBER",
    "body": "The docs aren't very helpful in understanding how the path is actually determined:\r\n\r\n>If you’re integrating against watchman using the unix socket and either the JSON or BSER protocol, you may need to discover the correct socket path. Rather than hard-coding the path or replicating the logic discussed in [Command Line](https://facebook.github.io/watchman/docs/cli-options.html), __you can simply execute the CLI to determine the path__. This has the side effect of spawning the service for your user if it was not already running–bonus!\r\n\r\nhttps://facebook.github.io/watchman/docs/cmd/get-sockname.html",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209608067/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209618562",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209618562",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209618562,
    "node_id": "IC_kwDOAx4p2c5IGVCC",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:41:21Z",
    "updated_at": "2022-08-09T16:41:21Z",
    "author_association": "MEMBER",
    "body": "The `get_unix_sock_name` and `get_named_pipe_sock_path` functions just return values from flags:\r\n```cpp\r\nconst std::string& get_unix_sock_name() {\r\n  return flags.unix_sock_name;\r\n}\r\n\r\nconst std::string& get_named_pipe_sock_path() {\r\n  return flags.named_pipe_path;\r\n}\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/sockname.cpp#L25-L31\r\n\r\nThe `unix_sock_name` flag is the `--unix-listener-path` CLI flag:\r\n```cpp\r\n    {\"unix-listener-path\",\r\n     'u',\r\n#ifdef _WIN32\r\n     \"Specify alternate unix domain socket path (specifying this will disable\"\r\n     \" named pipes unless `--named-pipe-path` is specified)\",\r\n#else\r\n     \"Specify alternate unix domain socket path\",\r\n#endif\r\n     REQ_STRING,\r\n     &flags.unix_sock_name,\r\n     \"PATH\",\r\n     IS_DAEMON},\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/Options.cpp#L85-L96\r\n\r\nWhich default value is generated by `compute_file_name`:\r\n```cpp\r\n  compute_file_name(flags.unix_sock_name, user, \"sock\", \"sockname\");\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/main.cpp#L802\r\n\r\nWhich is defined here:\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/main.cpp#L698",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209618562/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209619393",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209619393",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209619393,
    "node_id": "IC_kwDOAx4p2c5IGVPB",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:42:09Z",
    "updated_at": "2022-08-09T16:42:09Z",
    "author_association": "MEMBER",
    "body": "According to the socket docs:\r\n\r\n>The server will create a unix domain socket for communication with its clients. The location of the socket depends on compile time options and command line flags. It is recommended that you invoke `watchman get-sockname` to discover the location, or if you are being invoked via a trigger (since version 2.9.7) __you will find the location in the `$WATCHMAN_SOCK` environmental variable__.\r\n\r\nhttps://facebook.github.io/watchman/docs/socket-interface.html\r\n\r\nWe might be able to use the `WATCHMAN_SOCK` env variable to enforce our own path.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209619393/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209621791",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209621791",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209621791,
    "node_id": "IC_kwDOAx4p2c5IGV0f",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T16:44:36Z",
    "updated_at": "2022-08-09T16:44:36Z",
    "author_association": "MEMBER",
    "body": "No, that doesn't seem to work:\r\n```\r\n > export WATCHMAN_SOCK=/totally/legit/path\r\n > watchman get-sockname                   \r\n{\r\n    \"version\": \"4.9.0\",\r\n    \"sockname\": \"/tmp/jakubgs-state/sock\"\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209621791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209638483",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209638483",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209638483,
    "node_id": "IC_kwDOAx4p2c5IGZ5T",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T17:01:47Z",
    "updated_at": "2022-08-09T17:01:47Z",
    "author_association": "MEMBER",
    "body": "This flag might be of interest:\r\n```cpp\r\n    {\"no-site-spawner\",\r\n     'S',\r\n     \"Don't use the site or system spawner\",\r\n     OPT_NONE,\r\n     &flags.no_site_spawner,\r\n     NULL,\r\n     IS_DAEMON},\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/Options.cpp#L40-L46\r\n\r\nWhich does this:\r\n```cpp\r\n  if (flags.no_site_spawner) {\r\n    // The astute reader will notice this we're calling run_service_as_daemon()\r\n    // here and not the various other platform spawning functions in the block\r\n    // further below in this function.  This is deliberate: we want\r\n    // to do the most simple background running possible when the\r\n    // no_site_spawner flag is used.   In the future we plan to\r\n    // migrate the platform spawning functions to use the site_spawn\r\n    // functionality.\r\n    return run_service_as_daemon();\r\n  }\r\n```\r\nhttps://github.com/facebook/watchman/blob/208a092dc895fcbea9d52de2ebaf84947ba24c77/watchman/main.cpp#L950-L959\r\n\r\nWhich could possibly a way to have it spawn a daemon without using Launchd.\r\n\r\nBut it appears this flag was introduced in:\r\n\r\n* https://github.com/facebook/watchman/issues/558\r\n* https://github.com/facebook/watchman/pull/559\r\n* https://github.com/facebook/watchman/commit/227806d70f6436280e28537ee7b3d1cfcf4f0125\r\n\r\nWhich was only introduced in release [v2020.05.11.00](https://github.com/facebook/watchman/releases/tag/v2020.05.11.00).",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209638483/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209657258",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209657258",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209657258,
    "node_id": "IC_kwDOAx4p2c5IGeeq",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T17:21:42Z",
    "updated_at": "2022-08-09T17:22:18Z",
    "author_association": "MEMBER",
    "body": "I tried building most recent `v2022.08.08.00` and the `v2020.05.11.00` but for both I get:\r\n```\r\nAssessing boost...\r\nTraceback (most recent call last):\r\n  File \"/build/source/build/fbcode_builder/getdeps.py\", line 1275, in <module>\r\n    sys.exit(main())\r\n  File \"/build/source/build/fbcode_builder/getdeps.py\", line 1258, in main\r\n    return args.func(args)\r\n  File \"/build/source/build/fbcode_builder/getdeps.py\", line 109, in run\r\n    self.run_project_cmd(args, loader, manifest)\r\n  File \"/build/source/build/fbcode_builder/getdeps.py\", line 575, in run_project_cmd\r\n    cached_project = CachedProject(cache, loader, m)\r\n  File \"/build/source/build/fbcode_builder/getdeps.py\", line 227, in __init__\r\n    self.cache_file_name = \"-\".join(\r\nTypeError: sequence item 1: expected str instance, NoneType found\r\n```\r\nWhich appears to be due to them having some kind of weird custom Facebook-specific dependency fetching code:\r\n\r\n>The main entry point is the `getdeps.py` script. This script has several subcommands, but the most notable is the build command. This will download and build all dependencies for a project, and then build the project itself.\r\n\r\nhttps://github.com/facebook/watchman/tree/v2022.08.08.00/build/fbcode_builder\r\n\r\nBecause we can never reinvent the wheel enough times...",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209657258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209680215",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209680215",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209680215,
    "node_id": "IC_kwDOAx4p2c5IGkFX",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T17:40:27Z",
    "updated_at": "2022-08-09T17:40:39Z",
    "author_association": "MEMBER",
    "body": "So, what are my options:\r\n\r\n1. Try to get new release of Watchman built with Nix and use the new `--no-site-spawner` flag.\r\n    - This might not even be doable with the `fbcode_builder` garbage in the way.\r\n2. Try to start Watchman in the Nix build sandbox context instead of user context.\r\n    - Might be cleaner and simpler than trying to pass config values and paths into the sandbox.\r\n3. Try to fix the `EMFILE: too many open files` error and bypass Watchman entirely.\r\n    - Sounds like a good idea, but could be quite the rabbit hole to go down.\r\n4. Leave current behavior and just adjust permissions of the created socket.\r\n    - Ugly, but would work, and would not mess with a well tested way of doing things.\r\n\r\nI'm learning towards either option 2 or 3.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209680215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209686858",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209686858",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209686858,
    "node_id": "IC_kwDOAx4p2c5IGltK",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T17:45:22Z",
    "updated_at": "2022-08-09T17:49:22Z",
    "author_association": "MEMBER",
    "body": "I tried editing the `NumberOfFiles` setting for the `nix-daemon` on the MacOS host, but that doesn't solve the error:\r\n```\r\nadmin@maci7-03.ms-eu-dublin.slave.ci:~ % sudo grep -A3 SoftResourceLimits /Library/LaunchDaemons/org.nixos.nix-daemon.plist\r\n    <key>SoftResourceLimits</key>\r\n    <dict>\r\n      <key>NumberOfFiles</key>\r\n      <integer>65535</integer>\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209686858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209689435",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209689435",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209689435,
    "node_id": "IC_kwDOAx4p2c5IGmVb",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T17:48:14Z",
    "updated_at": "2022-08-09T17:48:26Z",
    "author_association": "MEMBER",
    "body": "If I run `ulimit -Sf` in the Nix build sandbox shell I just get `unlimited`, which is useless.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209689435/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209724808",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209724808",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209724808,
    "node_id": "IC_kwDOAx4p2c5IGu-I",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T18:25:29Z",
    "updated_at": "2022-08-09T18:25:29Z",
    "author_association": "MEMBER",
    "body": "One idea I had to fix `MFILE: too many open files` was to use `--no-watch-fs`/`org.gradle.vfs.watch=false` but unfortunately this option is only available starting from Gradle 6:\r\nhttps://docs.gradle.org/6.8.3/userguide/gradle_daemon.html#sec:daemon_watch_fs\r\n\r\nAnd we are stuck on Gradle 5 until we are able to upgrade to React-Native v68:\r\n\r\n* https://github.com/status-im/status-mobile/pull/13460\r\n\r\nAnd that is blocked on some `react-native-navigation` issues:\r\n\r\n* https://github.com/wix/react-native-navigation/issues/7527\r\n* https://github.com/wix/react-native-navigation/issues/7466\r\n\r\nAnd also this might not be the right way to go about it, since the watching might be done by React Native and not Gradle.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209724808/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209751764",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209751764",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209751764,
    "node_id": "IC_kwDOAx4p2c5IG1jU",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T18:46:49Z",
    "updated_at": "2022-08-09T18:46:49Z",
    "author_association": "MEMBER",
    "body": "While looking into this issue:\r\n\r\n* https://github.com/facebook/metro/issues/355\r\n\r\nI found this suggestion from 2019:\r\n```\r\nsed -i -e 's/watch: true/watch: false/' node_modules/metro/src/node-haste/DependencyGraph.js\r\n```\r\nBut when I look at the same file in our `node_modules` I can see this:\r\n```js\r\n      watch: watch == null ? !ci.isCI : watch\r\n```\r\nWhich uses the `ci-info` package, which checks environment variables, like `CI`:\r\n```js\r\nexports.isCI = !!(\r\n  env.CI || // Travis CI, CircleCI, Cirrus CI, Gitlab CI, Appveyor, CodeShip, dsari\r\n  env.CONTINUOUS_INTEGRATION || // Travis CI, Cirrus CI\r\n  env.BUILD_NUMBER || // Jenkins, TeamCity\r\n  env.RUN_ID || // TaskCluster, dsari\r\n  exports.name ||\r\n  false\r\n)\r\n```\r\nhttps://github.com/watson/ci-info/blob/18fe88088b626a6dcefc66e66fb32badb05ea216/index.js#L52-L59\r\n\r\nSo setting `CI=true` might be the ticket to stopping `metro` from using `jest-haste-map` with `watch=true`.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209751764/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209758296",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1209758296",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1209758296,
    "node_id": "IC_kwDOAx4p2c5IG3JY",
    "user": {
      "login": "chrispader",
      "id": 20173411,
      "node_id": "MDQ6VXNlcjIwMTczNDEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20173411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chrispader",
      "html_url": "https://github.com/chrispader",
      "followers_url": "https://api.github.com/users/chrispader/followers",
      "following_url": "https://api.github.com/users/chrispader/following{/other_user}",
      "gists_url": "https://api.github.com/users/chrispader/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chrispader/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chrispader/subscriptions",
      "organizations_url": "https://api.github.com/users/chrispader/orgs",
      "repos_url": "https://api.github.com/users/chrispader/repos",
      "events_url": "https://api.github.com/users/chrispader/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chrispader/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T18:54:00Z",
    "updated_at": "2022-08-09T18:54:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "> So setting `CI=true` might be the ticket to stopping `metro` from using `jest-haste-map` with `watch=true`.\r\n\r\nBut this wouldn't fix the issue for local builds on Darwin right?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1209758296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1210457499",
    "html_url": "https://github.com/status-im/status-mobile/issues/13783#issuecomment-1210457499",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13783",
    "id": 1210457499,
    "node_id": "IC_kwDOAx4p2c5IJh2b",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-10T10:09:46Z",
    "updated_at": "2022-08-10T10:09:46Z",
    "author_association": "MEMBER",
    "body": "Fixed in: https://github.com/status-im/status-mobile/pull/13784",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1210457499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
