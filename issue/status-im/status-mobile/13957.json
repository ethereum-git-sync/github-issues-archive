{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/13957",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/13957",
  "id": 1366611057,
  "node_id": "I_kwDOAx4p2c5RdNRx",
  "number": 13957,
  "title": "Group chat history unavailable for newly added member until some action is taken (some messages can be lost)",
  "user": {
    "login": "qoqobolo",
    "id": 67952253,
    "node_id": "MDQ6VXNlcjY3OTUyMjUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/67952253?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qoqobolo",
    "html_url": "https://github.com/qoqobolo",
    "followers_url": "https://api.github.com/users/qoqobolo/followers",
    "following_url": "https://api.github.com/users/qoqobolo/following{/other_user}",
    "gists_url": "https://api.github.com/users/qoqobolo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qoqobolo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qoqobolo/subscriptions",
    "organizations_url": "https://api.github.com/users/qoqobolo/orgs",
    "repos_url": "https://api.github.com/users/qoqobolo/repos",
    "events_url": "https://api.github.com/users/qoqobolo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qoqobolo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "cammellos",
    "id": 1017008,
    "node_id": "MDQ6VXNlcjEwMTcwMDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cammellos",
    "html_url": "https://github.com/cammellos",
    "followers_url": "https://api.github.com/users/cammellos/followers",
    "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
    "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
    "organizations_url": "https://api.github.com/users/cammellos/orgs",
    "repos_url": "https://api.github.com/users/cammellos/repos",
    "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cammellos/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-mobile/milestones/59",
    "html_url": "https://github.com/status-im/status-mobile/milestone/59",
    "labels_url": "https://api.github.com/repos/status-im/status-mobile/milestones/59/labels",
    "id": 7721557,
    "node_id": "MI_kwDOAx4p2c4AddJV",
    "number": 59,
    "title": "Release 1.20",
    "description": "",
    "creator": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 4,
    "closed_issues": 54,
    "state": "closed",
    "created_at": "2022-02-28T16:35:08Z",
    "updated_at": "2022-12-02T16:06:03Z",
    "due_on": null,
    "closed_at": "2022-12-02T16:06:03Z"
  },
  "comments": 5,
  "created_at": "2022-09-08T15:59:19Z",
  "updated_at": "2022-09-12T11:21:13Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n\r\n## Problem \r\n\r\nSometimes (in ~90% of cases), if a user was added to a new group chat while offline, and some messages were sent in that group from other members (from admin in this particular case), then when the user comes back online, the group chat history won't be available until some action triggers it to load (lock - unlock the screen, relogin and switch to another app worked while replication). \r\n\r\nThe waiting time for the message history to load without any actions was up to 10 minutes.\r\n\r\nSometimes, chat history was loaded partially (the last sent messages were more likely to be delivered).\r\n\r\nSometimes, some messages never load for the user. \r\nIn order to reproduce this, you need to create several chat groups and send several messages there (while the new member is offline). The issue with the message history never loaded was reproduced with 5 groups with 10 messages in each.\r\nIn that case, ~70% of messages were eventually delivered, but nothing helped to receive the rest of the messages.\r\n\r\n#### Expected behavior\r\nGroup chat history is loaded right after the user logged in\r\n\r\n#### Actual behavior\r\nSome trigger needed in most cases\r\n\r\n### Reproduction (this is reproducible in most cases)\r\n\r\n1. UserA and UserB are contacts\r\n2. UserA closes Status\r\n3. UserB creates group chat with UserA\r\n4. UserB sends several messages\r\n5. UserA logs in and checks the group chat\r\n6. Wait for a while\r\n7. If history doesn't load, try locking and unlocking the screen. The bug report also triggered the loading of the history (shake the phone and go to email, and then back to the group chat).\r\n\r\n**Steps for `never loaded messages`:**\r\n1. UserA and UserB are contacts\r\n2. UserA closes the app\r\n3. UserB creates 5 group chats with UserA and send 10 messages in each group\r\n4. UserA logs in and checks the group chat\r\n5. Wait for a while, try to relogin\r\n\r\n### Additional Information\r\n\r\n- Status version: RC 1.20\r\n- Operating System: Android, iOS\r\n\r\n### Logs \r\n\r\nUserA before any actions (in ~5 min of waiting for messages with open chat) [geth.log](https://github.com/status-im/status-mobile/files/9528374/geth.log)\r\nUserA after screen lock - unlock  [geth.log](https://github.com/status-im/status-mobile/files/9528386/geth.log)\r\nUserB (sender) [geth.log](https://github.com/status-im/status-mobile/files/9528392/geth.log)\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/13957/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1241753971",
    "html_url": "https://github.com/status-im/status-mobile/issues/13957#issuecomment-1241753971",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957",
    "id": 1241753971,
    "node_id": "IC_kwDOAx4p2c5KA6lz",
    "user": {
      "login": "qoqobolo",
      "id": 67952253,
      "node_id": "MDQ6VXNlcjY3OTUyMjUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/67952253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qoqobolo",
      "html_url": "https://github.com/qoqobolo",
      "followers_url": "https://api.github.com/users/qoqobolo/followers",
      "following_url": "https://api.github.com/users/qoqobolo/following{/other_user}",
      "gists_url": "https://api.github.com/users/qoqobolo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qoqobolo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qoqobolo/subscriptions",
      "organizations_url": "https://api.github.com/users/qoqobolo/orgs",
      "repos_url": "https://api.github.com/users/qoqobolo/repos",
      "events_url": "https://api.github.com/users/qoqobolo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qoqobolo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-09T09:48:18Z",
    "updated_at": "2022-09-09T09:54:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "### Case with the lost messages\r\n\r\n**Receiver:**\r\n\r\nAfter ~10 mins of waiting, before relogin [geth.log](https://github.com/status-im/status-mobile/files/9534267/geth.log)\r\nAfter relogin [geth.log](https://github.com/status-im/status-mobile/files/9534276/geth.log)\r\n\r\nMessages received right after the first login\r\n<img width=\"485\" alt=\"Screenshot 2022-09-09 at 11 40 43\" src=\"https://user-images.githubusercontent.com/67952253/189321243-d93bb501-188b-45aa-9af6-261c11f8c408.png\">\r\n\r\nMessages received after waiting ~10 mins and sending the logs (call \"Report a bug\" pop-up, go to email and back). 10 messages in each group were sent by Sender:\r\n<img width=\"393\" alt=\"Screenshot 2022-09-09 at 11 43 37\" src=\"https://user-images.githubusercontent.com/67952253/189321890-062287e4-8626-42bf-8077-9db021b45c42.png\">\r\n\r\n\r\n**Sender:**\r\n\r\n[geth.log](https://github.com/status-im/status-mobile/files/9534313/geth.log)\r\n\r\nhttps://user-images.githubusercontent.com/67952253/189322168-c0388807-e542-49d4-a3f0-712058942c68.MP4\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1241753971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1241983232",
    "html_url": "https://github.com/status-im/status-mobile/issues/13957#issuecomment-1241983232",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957",
    "id": 1241983232,
    "node_id": "IC_kwDOAx4p2c5KBykA",
    "user": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-09T13:34:36Z",
    "updated_at": "2022-09-09T13:34:36Z",
    "author_association": "MEMBER",
    "body": "So far what I am getting:\r\n- Peer was alwasy connected to the same mailserver throughout `mail-03.do-ams3.eth.prod`\r\n- Connection looked stable\r\n- Requests were successful\r\nThe timestamps also checks out, I'll be looking at exactly when the peer has sent messages to cross check in the other logs",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1241983232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243511034",
    "html_url": "https://github.com/status-im/status-mobile/issues/13957#issuecomment-1243511034",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957",
    "id": 1243511034,
    "node_id": "IC_kwDOAx4p2c5KHnj6",
    "user": {
      "login": "qoqobolo",
      "id": 67952253,
      "node_id": "MDQ6VXNlcjY3OTUyMjUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/67952253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qoqobolo",
      "html_url": "https://github.com/qoqobolo",
      "followers_url": "https://api.github.com/users/qoqobolo/followers",
      "following_url": "https://api.github.com/users/qoqobolo/following{/other_user}",
      "gists_url": "https://api.github.com/users/qoqobolo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qoqobolo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qoqobolo/subscriptions",
      "organizations_url": "https://api.github.com/users/qoqobolo/orgs",
      "repos_url": "https://api.github.com/users/qoqobolo/repos",
      "events_url": "https://api.github.com/users/qoqobolo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qoqobolo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T10:08:00Z",
    "updated_at": "2022-09-12T10:08:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "New logs [geth.log](https://github.com/status-im/status-mobile/files/9546970/geth.log)\r\n\r\npk 0x043fcbe384316f331b26ec92f8eaacd55625786d7974b8ec9dc43c5c3057547187d7b4b69e419611c38ad1679b834f215b785562a6c80ec5e605b54b8bd73cdbb3 (Positive Soupy Veery)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243511034/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243540309",
    "html_url": "https://github.com/status-im/status-mobile/issues/13957#issuecomment-1243540309",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957",
    "id": 1243540309,
    "node_id": "IC_kwDOAx4p2c5KHutV",
    "user": {
      "login": "qoqobolo",
      "id": 67952253,
      "node_id": "MDQ6VXNlcjY3OTUyMjUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/67952253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qoqobolo",
      "html_url": "https://github.com/qoqobolo",
      "followers_url": "https://api.github.com/users/qoqobolo/followers",
      "following_url": "https://api.github.com/users/qoqobolo/following{/other_user}",
      "gists_url": "https://api.github.com/users/qoqobolo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qoqobolo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qoqobolo/subscriptions",
      "organizations_url": "https://api.github.com/users/qoqobolo/orgs",
      "repos_url": "https://api.github.com/users/qoqobolo/repos",
      "events_url": "https://api.github.com/users/qoqobolo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qoqobolo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T10:33:20Z",
    "updated_at": "2022-09-12T10:33:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "New users:\r\n**Sender** `Minty Giddy Mussel` 0x04e707de8db3d21ad1efee98ed77b55f046111fd4f8d6d1271a0a80568056978f2a92f0b57da3bac9030d0831ba2236909650cb24d7e69d805c2d3a624e5be1b67\r\n[geth.log](https://github.com/status-im/status-mobile/files/9547111/geth.log)\r\n\r\n\r\n**Receiver**  `Nautical Green Armyworm` 0x040f4e6f3b75eaf88847b53a3c9562c21bba3ec49cfcb9cba278f6da11b58d2d3aaa8ad39ba7d261b6093a3add3d39ad96f6293e8203c5b0e0c860dc4fe74d2503\r\n\r\nMessages received right after login (before sending logs)\r\n<img width=\"542\" alt=\"Screenshot 2022-09-12 at 12 26 38\" src=\"https://user-images.githubusercontent.com/67952253/189631663-dc95a78c-1a1c-401e-accf-a84036300e1c.png\">\r\n\r\nReceiver's state after ~5 mins of waiting and sending logs (without relogin)\r\nLogs: \r\n[geth.log](https://github.com/status-im/status-mobile/files/9547129/geth.log)\r\n\r\n<img width=\"608\" alt=\"Screenshot 2022-09-12 at 12 30 39\" src=\"https://user-images.githubusercontent.com/67952253/189632346-44c03f6d-2e19-48ac-b350-b8db66dc3afd.png\">\r\n\r\nLogs after relogin: \r\n[geth.log](https://github.com/status-im/status-mobile/files/9547138/geth.log)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243540309/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243594169",
    "html_url": "https://github.com/status-im/status-mobile/issues/13957#issuecomment-1243594169",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13957",
    "id": 1243594169,
    "node_id": "IC_kwDOAx4p2c5KH725",
    "user": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T11:21:13Z",
    "updated_at": "2022-09-12T11:21:13Z",
    "author_association": "MEMBER",
    "body": "I think I might have found the issue:\r\n```\r\n\"can't create a new group chat without us being a member\"\r\n```\r\nit's in the logs, likely due to the recent changes in group chat protocol.\r\nInvestigating",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243594169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
