{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/3778",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/3778/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/3778/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/3778/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/3778",
  "id": 311677732,
  "node_id": "MDU6SXNzdWUzMTE2Nzc3MzI=",
  "number": 3778,
  "title": "Offline messages not received until message sender sends one more message ",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 517247009,
      "node_id": "MDU6TGFiZWw1MTcyNDcwMDk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/high-priority",
      "name": "high-priority",
      "color": "000000",
      "default": false,
      "description": null
    },
    {
      "id": 794860412,
      "node_id": "MDU6TGFiZWw3OTQ4NjA0MTI=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/release",
      "name": "release",
      "color": "30dcff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-04-05T16:16:54Z",
  "updated_at": "2018-04-12T15:31:41Z",
  "closed_at": "2018-04-12T15:31:41Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "\r\n***Type***: Bug\r\n\r\n***Summary***: Offline inbox messages does not arrive after contact appears online (even staying >10 minutes). However, please see the details in reproduction ***when*** offline messages arrive:\r\n\r\n#### Expected behavior\r\nOffline messages received after contact appears online\r\n#### Actual behavior\r\nOffline messages are not received after contact appears online\r\n\r\n### Reproduction\r\n\r\n- Install fresh develop build on Device 1 and Device 2\r\n- Create Contact1 and Contact2 respectively\r\n- Both contacts are online and exchanged a text messages\r\n- Contact2 enables airplane mode on device\r\n- Contact1 sends 10 text messages to Contact2\r\n- Contact2 disables airplane mode and stays on Home/1-1chat screen. (you can even stay up to 10 minutes here). \r\n**Actual result:** no messages received by Contact2\r\n\r\n- Contact2 navigates to 1-1 chat screen and sends a text message to Contact1\r\n**Actual result:** Message received by Contact1 as expected\r\n\r\n- Contact1 sends one more text message to Contact2\r\n**Actual result:** The very last text message received by Contact2. Also there are 10 messages appeared as 'Waiting for the message to arrive...'. Contact2 can stay for a while (checked 10+ minutes) - but all the messages keep staying in 'Waiting for the message to arrive...' state.\r\n\r\n- Contact2 re-logins and navigates to 1-1 chat with Contact1\r\n**Actual result:** No messages that were sent while he was offline at all.\r\n\r\n### Additional Information\r\n* Status version: Develop 0.9.10-846-ge9af024e (with merged new-protocol changes)\r\n* Operating System: Android and iOS\r\n\r\n### Additional Information\r\nIf Contact2 closed the app instead airplane mode - PN received for messages sent to him fine. \r\n\r\n#### Logs\r\n\r\nTF logs for the Contact2 who was offline starting from \"get back online\" step above: https://app.testfairy.com/projects/4803622-status/builds/8048398/sessions/6/?accessToken=LYoAjoVIPtC3Ru1MAGDq-xrouIM\r\n\r\nFrom the logs:\r\n```00:50 I/ReactNativeJS: INFO [status-im.transport.inbox:148] - offline inbox: fetch-peers response [{:id \"03f3661686d30509d621dbe5ee2e3082923f25e94fd41a2dd8dd34bb12a0c4e8fbde52247c6c55e86dc209a8e7c4a5ae56058c65f7b01734d3ab73818b44e2a3\", :name \"StatusIM/v0.9.9-unstable/linux-amd64/go1.9.3\", :caps [\"les/1\" \"les/2\" \"shh/6\"], :network {:localAddress \"192.168.2.63:35517\", :remoteAddress \"188.166.33.47:30303\", :inbound false, :trusted false, :static true}, :protocols {:shh \"unknown\"}} {:id \"dffef3874011709b12d1e540d83ddb19a9db8614ad9151d05bcf813585e45cbebba5aaea223fe315786c401d8cecb1ad2de9f179680c536ea30311fb21fa934b\", :name \"StatusIM/v0.9.9-unstable/linux-amd64/go1.9.3\", :caps [\"les/1\" \"les/2\" \"shh/6\"], :network {:localAddress \"192.168.2.63:37027\", :remoteAddress \"188.166.100.178:30303\", :inbound false, :trusted false, :static true}, :protocols {:shh \"unknown\"}}]\r\n00:50 I/ReactNativeJS: INFO [status-im.transport.inbox:154] - Peer enode://fa63a6cc730468c5456eab365b2a7a68a166845423c8c9acc363e5f8c4699ff6d954e7ec58f13ae49568600cff9899561b54f6fc2b9923136cd7104911f31cce@163.172.168.202:30303 is not registered. Retrying fetch peers.\r\n00:55 D/ReactNativeJS: DEBUG [status-im.utils.handlers:35] - Handling re-frame event:  :status-im.transport.inbox/fetch-peers\r\n00:55 D/ReactNativeJS: DEBUG [status-im.utils.handlers:35] - Handling re-frame event:  :status-im.transport.inbox/check-peer-added\r\n00:55 I/ReactNativeJS: INFO [status-im.transport.inbox:148] - offline inbox: fetch-peers response [{:id \"03f3661686d30509d621dbe5ee2e3082923f25e94fd41a2dd8dd34bb12a0c4e8fbde52247c6c55e86dc209a8e7c4a5ae56058c65f7b01734d3ab73818b44e2a3\", :name \"StatusIM/v0.9.9-unstable/linux-amd64/go1.9.3\", :caps [\"les/1\" \"les/2\" \"shh/6\"], :network {:localAddress \"192.168.2.63:35517\", :remoteAddress \"188.166.33.47:30303\", :inbound false, :trusted false, :static true}, :protocols {:shh \"unknown\"}} {:id \"dffef3874011709b12d1e540d83ddb19a9db8614ad9151d05bcf813585e45cbebba5aaea223fe315786c401d8cecb1ad2de9f179680c536ea30311fb21fa934b\", :name \"StatusIM/v0.9.9-unstable/linux-amd64/go1.9.3\", :caps [\"les/1\" \"les/2\" \"shh/6\"], :network {:localAddress \"192.168.2.63:37027\", :remoteAddress \"188.166.100.178:30303\", :inbound false, :trusted false, :static true}, :protocols {:shh \"unknown\"}}]\r\n00:55 I/ReactNativeJS: INFO [status-im.transport.inbox:154] - Peer enode://fa63a6cc730468c5456eab365b2a7a68a166845423c8c9acc363e5f8c4699ff6d954e7ec58f13ae49568600cff9899561b54f6fc2b9923136cd7104911f31cce@163.172.168.202:30303 is not registered. Retrying fetch peers.\r\n00:55 E/ReactNativeJS: ERROR [status-im.transport.inbox:157] - Could not connect to mailserver\r\n00:55 E/unknown:ReactNative: console.error: \"ERROR [status-im.transport.inbox:157] - Could not connect to mailserver\", stack:\r\n00:55 E/unknown:ReactNative: cljs$core$IFn$_invoke$arity$3@12:347932\r\n00:55 E/unknown:ReactNative: cljs$core$IFn$_invoke$arity$2@12:347729\r\n00:55 E/unknown:ReactNative: cljs$core$IFn$_invoke$arity$2@12:353001\r\n00:55 E/unknown:ReactNative: c@12:5305735\r\n00:55 E/unknown:ReactNative: r@12:5305917\r\n00:55 E/unknown:ReactNative: <unknown>@12:3240146\r\n00:55 E/unknown:ReactNative: <unknown>@12:3259481\r\n00:55 E/unknown:ReactNative: cljs$core$IKVReduce$_kv_reduce$arity$3@12:545631\r\n00:55 E/unknown:ReactNative: _kv_reduce@12:158196\r\n00:55 E/unknown:ReactNative: reduce_kv@12:268208\r\n00:55 E/unknown:ReactNative: cljs$core$IFn$_invoke$arity$10@12:3256787\r\n00:55 E/unknown:ReactNative: <unknown>@12:5811908\r\n00:55 E/unknown:ReactNative: <unknown>@12:3950298\r\n00:55 E/unknown:ReactNative: invoke_interceptor_fn@12:3878235\r\n00:55 E/unknown:ReactNative: invoke_interceptors@12:3878536\r\n00:55 E/unknown:ReactNative: execute@12:3880233\r\n00:55 E/unknown:ReactNative: handle@12:3889958\r\n00:55 E/unknown:ReactNative: re_frame$router$IEventQueue$_process_1st_event_in_queue$arity$1@12:3924691\r\n00:55 E/unknown:ReactNative: re_frame$router$IEventQueue$_run_queue$arity$1@12:3905427\r\n00:55 E/unknown:ReactNative: <unknown>@12:3911179\r\n00:55 E/unknown:ReactNative: re_frame$router$IEventQueue$_fsm_trigger$arity$3@12:3915390\r\n00:55 E/unknown:ReactNative: <unknown>@12:3907945\r\n00:55 E/unknown:ReactNative: <unknown>@32:1369\r\n00:55 E/unknown:ReactNative: x@32:643\r\n00:55 E/unknown:ReactNative: callTimers@32:2788\r\n00:55 E/unknown:ReactNative: value@27:3582\r\n00:55 E/unknown:ReactNative: <unknown>@27:1067\r\n00:55 E/unknown:ReactNative: value@27:3009\r\n00:55 E/unknown:ReactNative: value@27:1039\r\n03:14 D/ViewRootImpl@ac693ee[MainActivity]: ViewPostImeInputStage processPointer 0\r\n```\r\n\n\n<blockquote><div><strong><a href=\"https://app.testfairy.com/projects/4803622-status/builds/8048398/sessions/6/?accessToken=LYoAjoVIPtC3Ru1MAGDq-xrouIM\">TestFairy: Status 0.9.10-846-ge9af024e+ (2403) @6</a></strong></div></blockquote>",
  "closed_by": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/3778/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/3778/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380733944",
    "html_url": "https://github.com/status-im/status-mobile/issues/3778#issuecomment-380733944",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3778",
    "id": 380733944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDczMzk0NA==",
    "user": {
      "login": "flexsurfer",
      "id": 11790366,
      "node_id": "MDQ6VXNlcjExNzkwMzY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/11790366?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/flexsurfer",
      "html_url": "https://github.com/flexsurfer",
      "followers_url": "https://api.github.com/users/flexsurfer/followers",
      "following_url": "https://api.github.com/users/flexsurfer/following{/other_user}",
      "gists_url": "https://api.github.com/users/flexsurfer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/flexsurfer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/flexsurfer/subscriptions",
      "organizations_url": "https://api.github.com/users/flexsurfer/orgs",
      "repos_url": "https://api.github.com/users/flexsurfer/repos",
      "events_url": "https://api.github.com/users/flexsurfer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/flexsurfer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T09:11:42Z",
    "updated_at": "2018-04-12T09:11:42Z",
    "author_association": "MEMBER",
    "body": "fixed by https://github.com/status-im/status-react/pull/3836",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380733944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380847170",
    "html_url": "https://github.com/status-im/status-mobile/issues/3778#issuecomment-380847170",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3778",
    "id": 380847170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDg0NzE3MA==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T15:31:41Z",
    "updated_at": "2018-04-12T15:31:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Offline inboxing is not fixed completely. \r\n\r\nApparently, because app fails to connect to mailservers (```00:55 E/unknown:ReactNative: console.error: \"ERROR [status-im.transport.inbox:157] - Could not connect to mailserver\",```) which is still the case - offline inboxed messages do not arrive at an account. \r\n\r\nThis is described separately in https://github.com/status-im/status-react/issues/3853. \r\nLet's close current issue. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380847170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
