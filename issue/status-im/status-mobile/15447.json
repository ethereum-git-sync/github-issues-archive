{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/15447",
  "id": 1635962845,
  "node_id": "I_kwDOAx4p2c5hgs_d",
  "number": 15447,
  "title": "Create a custom Gradle task to list all dependencies",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 933023569,
      "node_id": "MDU6TGFiZWw5MzMwMjM1Njk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/feature",
      "name": "feature",
      "color": "172b9e",
      "default": false,
      "description": "feature requests"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "siddarthkay",
    "id": 64726664,
    "node_id": "MDQ6VXNlcjY0NzI2NjY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siddarthkay",
    "html_url": "https://github.com/siddarthkay",
    "followers_url": "https://api.github.com/users/siddarthkay/followers",
    "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
    "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
    "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
    "repos_url": "https://api.github.com/users/siddarthkay/repos",
    "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-03-22T15:09:09Z",
  "updated_at": "2023-05-24T05:02:57Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "There is a terrible hack hidden in how we generate the [`nix/deps/gradle/deps.json`](https://github.com/status-im/status-mobile/blob/develop/nix/deps/gradle/deps.json) which is consumed by the [Gradle dependencies derivation](https://github.com/status-im/status-mobile/blob/develop/nix/deps/gradle/default.nix) which is responsible for [providing Gradle with all necessary dependencies for builds](https://github.com/status-im/status-mobile/blob/8c358d4ae4449c852dda11097f543cf52a61b9dc/nix/mobile/android/release.nix#L137). This hack is this AWK script:\r\nhttps://github.com/status-im/status-mobile/blob/8c358d4ae4449c852dda11097f543cf52a61b9dc/nix/deps/gradle/gradle_parser.awk#L17-L46\r\nWhich parses the output of a [Gradle call that prints tree of dependencies](https://github.com/status-im/status-mobile/blob/8c358d4ae4449c852dda11097f543cf52a61b9dc/nix/deps/gradle/get_deps.sh#L33-L37) which looks like this:\r\n```\r\ndebugCompileClasspath - Resolved configuration for compilation for variant: debug\r\n+--- com.facebook.react:react-native:+ -> 0.63.5\r\n|    +--- com.facebook.infer.annotation:infer-annotation:0.11.2\r\n|    |    \\--- com.google.code.findbugs:jsr305:3.0.1 -> 3.0.2\r\n|    +--- com.facebook.yoga:proguard-annotations:1.14.1\r\n|    +--- javax.inject:javax.inject:1\r\n|    +--- androidx.appcompat:appcompat:1.0.2\r\n|    |    +--- androidx.annotation:annotation:1.0.0\r\n|    |    +--- androidx.core:core:1.0.1\r\n|    |    |    +--- androidx.annotation:annotation:1.0.0\r\n|    |    |    +--- androidx.collection:collection:1.0.0\r\n|    |    |    |    \\--- androidx.annotation:annotation:1.0.0\r\n```\r\nThe result of parsing this file is [`nix/deps/gradle/deps.list`](https://github.com/status-im/status-mobile/blob/develop/nix/deps/gradle/deps.list) which is then turned into [`nix/deps/gradle/deps.urls`](https://github.com/status-im/status-mobile/blob/develop/nix/deps/gradle/deps.urls) which in turn is used to create [`nix/deps/gradle/deps.json`](https://github.com/status-im/status-mobile/blob/develop/nix/deps/gradle/deps.json).\r\n\r\nThis is not a good way of generating this list of dependencies. And is possibly the cause of some dependencies being missed in the [React Native upgrade PR](https://github.com/status-im/status-mobile/pull/15203), specifically:\r\n\r\n* https://github.com/status-im/status-mobile/pull/15203#issuecomment-1458869315\r\n     - `org.jetbrains.kotlin.jvm:org.jetbrains.kotlin.jvm.gradle.plugin:1.6.10`\r\n* https://github.com/status-im/status-mobile/pull/15203#issuecomment-1458517211\r\n    - `com.android.tools.lint:lint-gradle:30.3.0`\r\n\r\nWhich is why we need a more proper solution, in the form of a custom Gradle task that can print out the list of dependencies as it is without the need for parsing disgusting trees with AWK. Such a solution would most probably be close to a task like this:\r\n```groovy\r\ntask printDependencies {\r\n    doLast {\r\n        def depsSet = new TreeSet<String>()\r\n\r\n        configurations.all { config ->\r\n            if (!config.name.toLowerCase().startsWith('test')) {\r\n                config.allDependencies.all { dep ->\r\n                    if (dep.group && dep.name && dep.version) {\r\n                        depsSet.add(\"${dep.group}:${dep.name}:${dep.version}\")\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        depsSet.each { println it }\r\n    }\r\n}\r\n```\r\nWhich was found in some StackOverflow by @siddarthkay .",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/15447/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1480790295",
    "html_url": "https://github.com/status-im/status-mobile/issues/15447#issuecomment-1480790295",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
    "id": 1480790295,
    "node_id": "IC_kwDOAx4p2c5YQxEX",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-23T08:42:20Z",
    "updated_at": "2023-03-23T08:42:45Z",
    "author_association": "MEMBER",
    "body": "It is worth noting that Gradle often picks a newer version of a package over an older one when resolving dependencies:\r\n```\r\n+--- com.facebook.react:react-native:+ -> 0.63.5\r\n|    +--- com.facebook.infer.annotation:infer-annotation:0.11.2\r\n|    |    \\--- com.google.code.findbugs:jsr305:3.0.1 -> 3.0.2\r\n```\r\nIn this case we see that `com.google.code.findbugs:jsr305` is required at `3.0.1` but `3.0.2` will be used in its stead.\r\nThis usually means that the version definition allows this, and there are other dependencies that pull in the newer verison.\r\n\r\nIt would be good to support this, as it would allow us to keep the Gradle dependencies derivation on the smaller side.\r\nEvery dependency we pull in that is not necessary will make fetching dependencies slower, and take up more space locally.\r\n\r\nNow, this is not absolutely necessary, if it turns out to be difficult, but it would be good to have.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1480790295/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1495872062",
    "html_url": "https://github.com/status-im/status-mobile/issues/15447#issuecomment-1495872062",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
    "id": 1495872062,
    "node_id": "IC_kwDOAx4p2c5ZKTI-",
    "user": {
      "login": "alwx",
      "id": 911127,
      "node_id": "MDQ6VXNlcjkxMTEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alwx",
      "html_url": "https://github.com/alwx",
      "followers_url": "https://api.github.com/users/alwx/followers",
      "following_url": "https://api.github.com/users/alwx/following{/other_user}",
      "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
      "organizations_url": "https://api.github.com/users/alwx/orgs",
      "repos_url": "https://api.github.com/users/alwx/repos",
      "events_url": "https://api.github.com/users/alwx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alwx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T12:17:07Z",
    "updated_at": "2023-04-04T12:19:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "I tried multiple different approaches, not very successfully, but here are some results:\r\n\r\n1. The `printDependencies` task from above works but it shows only the direct dependencies and doesn't return any sub-dependencies (here is the class definition: https://github.com/gradle/gradle/blob/master/subprojects/dependency-management/src/main/java/org/gradle/api/internal/artifacts/dependencies/DefaultExternalModuleDependency.java)\r\n\r\n2. However, I found out that there is a Project Report Plugin that can generate a complete dependency report, and it can be added this way:\r\nhttps://github.com/status-im/status-mobile/blob/33055ffe4f960f1c01683b0e5911e1ae098a49b5/android/build.gradle#L41\r\n\r\nIt seems to show everything we need but in a tree-like structure which means parsing it with the same script again, and that's something we want to avoid.\r\n\r\nWe can try to utilize some code from `DependencyReportTask` and use it to get all the dependencies. Here is its documentation: https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/diagnostics/DependencyReportTask.html\r\n\r\nAll the current results can be found here: https://github.com/status-im/status-mobile/pull/15539",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1495872062/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1495877660",
    "html_url": "https://github.com/status-im/status-mobile/issues/15447#issuecomment-1495877660",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
    "id": 1495877660,
    "node_id": "IC_kwDOAx4p2c5ZKUgc",
    "user": {
      "login": "alwx",
      "id": 911127,
      "node_id": "MDQ6VXNlcjkxMTEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alwx",
      "html_url": "https://github.com/alwx",
      "followers_url": "https://api.github.com/users/alwx/followers",
      "following_url": "https://api.github.com/users/alwx/following{/other_user}",
      "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
      "organizations_url": "https://api.github.com/users/alwx/orgs",
      "repos_url": "https://api.github.com/users/alwx/repos",
      "events_url": "https://api.github.com/users/alwx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alwx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T12:21:14Z",
    "updated_at": "2023-04-04T12:21:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm currently checking if something can be extracted from [DependencyReportTask](https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/diagnostics/DependencyReportTask.html) or some code from it can be used separately in another task to generate a plain list of dependencies (see `DepReport.groovy` file in my PR)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1495877660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1497129842",
    "html_url": "https://github.com/status-im/status-mobile/issues/15447#issuecomment-1497129842",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
    "id": 1497129842,
    "node_id": "IC_kwDOAx4p2c5ZPGNy",
    "user": {
      "login": "alwx",
      "id": 911127,
      "node_id": "MDQ6VXNlcjkxMTEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alwx",
      "html_url": "https://github.com/alwx",
      "followers_url": "https://api.github.com/users/alwx/followers",
      "following_url": "https://api.github.com/users/alwx/following{/other_user}",
      "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
      "organizations_url": "https://api.github.com/users/alwx/orgs",
      "repos_url": "https://api.github.com/users/alwx/repos",
      "events_url": "https://api.github.com/users/alwx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alwx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T08:41:23Z",
    "updated_at": "2023-04-05T08:41:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to temporarily pause all the work to focus on more urgent UI issues for 0.23.0.\r\n\r\nCurrent results:\r\nHaven't really managed to generate a list of dependencies but pretty sure it's not hard to achieve that by utilizing the code from `DependencyReportTask` and rewriting it that way so that it will be generating a plain list instead of a tree. It requires some Java knowledge and I can check it out once I finish with the current issues but feel free to take this issue and work on it in the meantime. ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1497129842/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1497182318",
    "html_url": "https://github.com/status-im/status-mobile/issues/15447#issuecomment-1497182318",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
    "id": 1497182318,
    "node_id": "IC_kwDOAx4p2c5ZPTBu",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T09:22:34Z",
    "updated_at": "2023-04-05T09:22:34Z",
    "author_association": "MEMBER",
    "body": "Thanks for looking into it.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1497182318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1560461249",
    "html_url": "https://github.com/status-im/status-mobile/issues/15447#issuecomment-1560461249",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15447",
    "id": 1560461249,
    "node_id": "IC_kwDOAx4p2c5dAr_B",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-24T05:02:41Z",
    "updated_at": "2023-05-24T05:02:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey! @alwx : I'm assigning this to myself to give it a shot.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1560461249/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
