{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/6955",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/6955",
  "id": 386072676,
  "node_id": "MDU6SXNzdWUzODYwNzI2NzY=",
  "number": 6955,
  "title": "Install nvm or iOS slaves",
  "user": {
    "login": "yenda",
    "id": 1181225,
    "node_id": "MDQ6VXNlcjExODEyMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1181225?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yenda",
    "html_url": "https://github.com/yenda",
    "followers_url": "https://api.github.com/users/yenda/followers",
    "following_url": "https://api.github.com/users/yenda/following{/other_user}",
    "gists_url": "https://api.github.com/users/yenda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yenda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yenda/subscriptions",
    "organizations_url": "https://api.github.com/users/yenda/orgs",
    "repos_url": "https://api.github.com/users/yenda/repos",
    "events_url": "https://api.github.com/users/yenda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yenda/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 668403972,
      "node_id": "MDU6TGFiZWw2Njg0MDM5NzI=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/blocker",
      "name": "blocker",
      "color": "5319e7",
      "default": false,
      "description": null
    },
    {
      "id": 793864892,
      "node_id": "MDU6TGFiZWw3OTM4NjQ4OTI=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/devops",
      "name": "devops",
      "color": "71b503",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-11-30T07:41:11Z",
  "updated_at": "2018-12-06T18:21:03Z",
  "closed_at": "2018-12-06T18:21:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Problem\r\n\r\nNow that we moved to `yarn`, we can also upgrade to node 10. However we need to upgrade realm as well since node 10 only supported from realm `2.19.0`.\r\nThe problem is that there is a commit before `2.19.0` of realm that assumes use of a node package manager for iOS release process with realm. It seems like it is going to take a while for upstream to fix this as they need to make changes to their CI before a fix is merged.\r\n\r\n# Implementation\r\n\r\nIn order to be able to upgrade realm and node the quickest path for us is to install nvm on iOS slaves.\r\n\r\n# Acceptance Criteria\r\n\r\nnvm is installed on iOS slaves and https://github.com/status-im/status-react/pull/6949 can be built\r\n\r\n# Future Steps\r\n\r\nnvm is installed on all slaves\r\n",
  "closed_by": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/6955/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443188649",
    "html_url": "https://github.com/status-im/status-mobile/issues/6955#issuecomment-443188649",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955",
    "id": 443188649,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MzE4ODY0OQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-30T12:25:03Z",
    "updated_at": "2018-11-30T12:35:46Z",
    "author_association": "MEMBER",
    "body": "So here are the issues with NVM:\r\n\r\n* `nvm` is not a script or a binary, it's a huge shell function, which means we can't easily link to it.\r\n* Jenkins does not run `interactive` shells so it does not load things like `nvm` from `.bashrc` for example.\r\n  - Calls to `nvm use ${VER}` have no effect between invocations of `sh`.\r\n  - This means we'd need to run `nvm.sh` for every invocation of `sh`, like so:\r\n  `sh 'source ~/.nvm/nvm.sh && ${COMAND}'`\r\n  which is stupid.\r\n* Node version can be changed with `nvm alias default ${VER}` but for it to take effect Jenkins node needs to be reconnected.\r\n\r\nAs an alternative we could use the [NVM Wrapper Plugin](https://wiki.jenkins.io/display/JENKINS/Nvm+Wrapper+Plugin) which can be used in a declarative pipeline like so:\r\n```groovy\r\npipeline {\r\n    agent { label \"linux\" }\r\n    \r\n    stages {\r\n        stage('Test') {\r\n            steps {\r\n                nvm('v10.14.1') {\r\n                    sh 'node --version'\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\nExample run: https://ci.status.im/job/tests/job/nvm-test/5/console\r\n\r\n<blockquote><img src=\"/static/e7749a62/favicon.ico\" width=\"48\" align=\"right\"><div><strong><a href=\"https://ci.status.im/job/tests/job/nvm-test/5/console\">tests Â» nvm-test #5 Console [Jenkins]</a></strong></div></blockquote>",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443188649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443189115",
    "html_url": "https://github.com/status-im/status-mobile/issues/6955#issuecomment-443189115",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955",
    "id": 443189115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MzE4OTExNQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-30T12:27:20Z",
    "updated_at": "2018-11-30T12:27:20Z",
    "author_association": "MEMBER",
    "body": "Now, this syntax means we have to use `nvm('v10.14.1')` in every Stage where we need the specific version of Node. This is an improvement over calling `nvm.sh` in every `sh` invocation, but still a bit messy.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443189115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443189827",
    "html_url": "https://github.com/status-im/status-mobile/issues/6955#issuecomment-443189827",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955",
    "id": 443189827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MzE4OTgyNw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-30T12:30:24Z",
    "updated_at": "2018-11-30T12:35:15Z",
    "author_association": "MEMBER",
    "body": "I might add that the disadvantage of this approach is that we node version would have to be hardcoded in the `Jenkinsfile`s, or possibly loaded from a file from `status-react`(`NODEJS_VERSION`) and then used via a variable in `nvm()` call, like so:\r\n```groovy\r\nstage('Test') {\r\n    steps {\r\n        def nodeVersion = readFile(\"${env.WORKSPACE}/NODEJS_VERSION\").trim()\r\n        nvm(nodeVersion) {\r\n            sh 'DO STUFF'\r\n        }\r\n    }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443189827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443210433",
    "html_url": "https://github.com/status-im/status-mobile/issues/6955#issuecomment-443210433",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955",
    "id": 443210433,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MzIxMDQzMw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-30T13:56:02Z",
    "updated_at": "2018-11-30T13:56:14Z",
    "author_association": "MEMBER",
    "body": "It appears that the approach with NVM Wrapper Plugin works as shown in: https://github.com/status-im/status-react/pull/6949\r\nNot sure though if this is the approach we want to use for all builds.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/443210433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/444975798",
    "html_url": "https://github.com/status-im/status-mobile/issues/6955#issuecomment-444975798",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/6955",
    "id": 444975798,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NDk3NTc5OA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-06T18:21:01Z",
    "updated_at": "2018-12-06T18:21:03Z",
    "author_association": "MEMBER",
    "body": "So this is pretty much done, we have NVM on slaves:\r\nhttps://github.com/status-im/infra-misc/commit/4a6cd137ba828c121ba0a75b0772d182364a4b5a\r\nAnd we use it in builds using the `nvm()` wrapper:\r\nhttps://github.com/status-im/status-react/blob/develop/ci/Jenkinsfile.ios#L30\r\nI consider this done.\n\n<blockquote><img src=\"https://avatars3.githubusercontent.com/u/11767950?s=400&v=4\" width=\"48\" align=\"right\"><div><img src=\"https://assets-cdn.github.com/favicon.ico\" height=\"14\"> GitHub</div><div><strong><a href=\"https://github.com/status-im/status-react\">status-im/status-react</a></strong></div><div>a free (libre) open source, mobile OS for Ethereum - status-im/status-react</div></blockquote>",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/444975798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
