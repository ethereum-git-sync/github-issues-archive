{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/3397",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/3397",
  "id": 298954383,
  "node_id": "MDU6SXNzdWUyOTg5NTQzODM=",
  "number": 3397,
  "title": "[Perf] User story 5: Time lags in message sending in chats having a lot of data ",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 783781483,
      "node_id": "MDU6TGFiZWw3ODM3ODE0ODM=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/performance",
      "name": "performance",
      "color": "dd3bd8",
      "default": false,
      "description": null
    },
    {
      "id": 795655580,
      "node_id": "MDU6TGFiZWw3OTU2NTU1ODA=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/chat",
      "name": "chat",
      "color": "f70cb0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-mobile/milestones/21",
    "html_url": "https://github.com/status-im/status-mobile/milestone/21",
    "labels_url": "https://api.github.com/repos/status-im/status-mobile/milestones/21/labels",
    "id": 3355444,
    "node_id": "MDk6TWlsZXN0b25lMzM1NTQ0NA==",
    "number": 21,
    "title": "Beta",
    "description": "Issues and blockers required for the Q2 beta release",
    "creator": {
      "login": "chadyj",
      "id": 116099,
      "node_id": "MDQ6VXNlcjExNjA5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116099?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chadyj",
      "html_url": "https://github.com/chadyj",
      "followers_url": "https://api.github.com/users/chadyj/followers",
      "following_url": "https://api.github.com/users/chadyj/following{/other_user}",
      "gists_url": "https://api.github.com/users/chadyj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chadyj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chadyj/subscriptions",
      "organizations_url": "https://api.github.com/users/chadyj/orgs",
      "repos_url": "https://api.github.com/users/chadyj/repos",
      "events_url": "https://api.github.com/users/chadyj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chadyj/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 119,
    "state": "closed",
    "created_at": "2018-05-17T18:10:04Z",
    "updated_at": "2018-07-04T09:00:36Z",
    "due_on": "2018-06-20T07:00:00Z",
    "closed_at": "2018-07-04T09:00:36Z"
  },
  "comments": 5,
  "created_at": "2018-02-21T12:39:05Z",
  "updated_at": "2018-05-24T12:50:01Z",
  "closed_at": "2018-05-24T12:50:00Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### User Story\r\n\r\nAs a user I want my message to appear in the chat in <0.3 seconds after I tap the 'Send' message button  \r\n\r\n***Type***: Bug\r\n\r\n***Summary***: There are noticeable lags when sending a message in chat when this particular chat has already a lot of messages. The higher number of exchanged messages - the higher delay between the tap on 'Send message' button and appearance of actual message in the chat. Any type of chat affected. \r\n\r\nTwo points impacts on the lags (depends on a device - numbers are below taken from Samsung J7 on Android 7.0): \r\n- **number of messages** \r\nFor instance: contact starts 1-1 chat with another contact and sends the very first text message (e.g. 'Hello'). It takes <0.3 seconds for the message to appear in the chat.\r\nBoth contacts exchange with 100+ one-line text messages. \r\nNow when the same contact sends the message - it takes 2-3 seconds for the message to appear in the chat.\r\n\r\n- ~**message content size**~\r\n~For instance: contact starts a public chat with another contact and sends the very first one-line text message (e.g. 'Hello'). It takes <0.3 seconds for the message to appear in the chat.\r\nThe same contact sends seconds huge message with 1000 lines in total. Third one-line text message sending takes <2-3 seconds for the message to appear in the chat.~\r\n\r\n**UPDATE: after new protocol integration!**\r\nThe responsiveness improved: I don't see a dependency between message content size and time lags on message sending.\r\nThe number of messages still matters though. Figures are twice lower since the issue originally has been reported, - but lags are still noticeable (see 'Reproduction' scenario below) \r\n\r\nGoal here: disregard of the data size in the chat - message should appear in <0.3 seconds after contact tap on 'Send message' button. \r\n\r\n#### Expected behaviour\r\nNo lags in message sending in the chats having a lot of messages \r\n\r\n#### Actual behavior\r\nLags in message sending in the chats having a lot of messages \r\n\r\n### Reproduction (related to 'number of messages')\r\n- Open Status and create a new account\r\n- Start 1-1 chat with contact (or Group Chat, or join public chat) \r\n- Send the first one-line message (e.g. 'Hey') and pay attention to delay between the tap on 'Send message' button and when the message appears in chat.\r\n- Send (or receive) 100 one-line messages\r\n- Send one-line message again and pay attention to the delay between the tap on 'Send message' button and when the message appears in chat.\r\n\r\n\r\n### Additional Information\r\n* Status version: 338th develop (15st of April), release 0.9.17\r\n* Operating System: Android, iOS\r\n\r\nTF session: https://app.testfairy.com/projects/4803622-status/builds/8101280/sessions/39/?accessToken=kwALQm6gV6bUKr08VQEVj/hhJe0\r\n",
  "closed_by": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/3397/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/381407557",
    "html_url": "https://github.com/status-im/status-mobile/issues/3397#issuecomment-381407557",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397",
    "id": 381407557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTQwNzU1Nw==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-15T13:41:17Z",
    "updated_at": "2018-04-15T13:41:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Since the new protocol changes - this issue looks much better! \r\nI don't see any dependency between message content size and time delays on message sending like we had before.\r\nBut still the number of messages matter. \r\n\r\nSo the description slightly updated keeping the scenario of how the number of messages impacts to the delay between tap 'Send message' button and when the actual message appears in the chat.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/381407557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/387754718",
    "html_url": "https://github.com/status-im/status-mobile/issues/3397#issuecomment-387754718",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397",
    "id": 387754718,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4Nzc1NDcxOA==",
    "user": {
      "login": "lukaszfryc",
      "id": 7532782,
      "node_id": "MDQ6VXNlcjc1MzI3ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7532782?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lukaszfryc",
      "html_url": "https://github.com/lukaszfryc",
      "followers_url": "https://api.github.com/users/lukaszfryc/followers",
      "following_url": "https://api.github.com/users/lukaszfryc/following{/other_user}",
      "gists_url": "https://api.github.com/users/lukaszfryc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lukaszfryc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lukaszfryc/subscriptions",
      "organizations_url": "https://api.github.com/users/lukaszfryc/orgs",
      "repos_url": "https://api.github.com/users/lukaszfryc/repos",
      "events_url": "https://api.github.com/users/lukaszfryc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lukaszfryc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-09T14:19:19Z",
    "updated_at": "2018-05-09T14:19:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Serhy what device you used to test it? For me there is no significant difference between first and 100th message. But, I use relatively fast devices - iPhone 8, Galaxy S8. ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/387754718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/387769914",
    "html_url": "https://github.com/status-im/status-mobile/issues/3397#issuecomment-387769914",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397",
    "id": 387769914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4Nzc2OTkxNA==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-09T15:03:20Z",
    "updated_at": "2018-05-09T15:03:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Samsung Galaxy Note 4 and Samsung J7 has similar behavior for me in this relation: almost instant message appearance when I send a message in empty chat and ~3 seconds lag if I have 100-150 messages in the chat.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/387769914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/387773194",
    "html_url": "https://github.com/status-im/status-mobile/issues/3397#issuecomment-387773194",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397",
    "id": 387773194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4Nzc3MzE5NA==",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-09T15:12:45Z",
    "updated_at": "2018-05-09T15:12:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "@lukaszfryc there are the same lags if you receive messages too, you just don't see them that obviously. @janherich found the main reason, now we just need to fix it 😄 ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/387773194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/391702493",
    "html_url": "https://github.com/status-im/status-mobile/issues/3397#issuecomment-391702493",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3397",
    "id": 391702493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTcwMjQ5Mw==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-24T12:50:00Z",
    "updated_at": "2018-05-24T12:50:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "https://github.com/status-im/status-react/pull/4221 fixed this issue. \r\nWithing the chat with the 2000+ of messages on Galaxy Note 4 I don't have any lags sending a message.  ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/391702493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
