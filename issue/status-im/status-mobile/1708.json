{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/1708",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/1708",
  "id": 253722638,
  "node_id": "MDU6SXNzdWUyNTM3MjI2Mzg=",
  "number": 1708,
  "title": "Improve speed of Jenkins builds",
  "user": {
    "login": "oskarth",
    "id": 1552237,
    "node_id": "MDQ6VXNlcjE1NTIyMzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1552237?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/oskarth",
    "html_url": "https://github.com/oskarth",
    "followers_url": "https://api.github.com/users/oskarth/followers",
    "following_url": "https://api.github.com/users/oskarth/following{/other_user}",
    "gists_url": "https://api.github.com/users/oskarth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/oskarth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/oskarth/subscriptions",
    "organizations_url": "https://api.github.com/users/oskarth/orgs",
    "repos_url": "https://api.github.com/users/oskarth/repos",
    "events_url": "https://api.github.com/users/oskarth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/oskarth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 692308696,
      "node_id": "MDU6TGFiZWw2OTIzMDg2OTY=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/tech-debt",
      "name": "tech-debt",
      "color": "e99695",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2017-08-29T16:14:02Z",
  "updated_at": "2018-01-03T12:01:00Z",
  "closed_at": "2018-01-03T12:01:00Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## User Story\r\n\r\nAs a developer, I want builds to finish quickly so I can see if things work / QA can quickly test binaries.\r\n\r\n## Summary\r\nWhen there are new dependencies it can take over 40 minutes to build. It seems like this can be improved drastically with a better instance type. See http://185.90.37.243:8080/blue/organizations/jenkins/Github%20Org%20Builder%2Fstatus-react/detail/feature%2Fpush-notifications-spike-%231599/7/pipeline/\r\n\r\nIn addition:\r\n-  we should setup DNS so we can go to `build.status.im` or something like that\r\n- CocoaPods should be updated to 1.3.1\r\n\r\n*Type*: Feature (tooling)",
  "closed_by": {
    "login": "oskarth",
    "id": 1552237,
    "node_id": "MDQ6VXNlcjE1NTIyMzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1552237?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/oskarth",
    "html_url": "https://github.com/oskarth",
    "followers_url": "https://api.github.com/users/oskarth/followers",
    "following_url": "https://api.github.com/users/oskarth/following{/other_user}",
    "gists_url": "https://api.github.com/users/oskarth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/oskarth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/oskarth/subscriptions",
    "organizations_url": "https://api.github.com/users/oskarth/orgs",
    "repos_url": "https://api.github.com/users/oskarth/repos",
    "events_url": "https://api.github.com/users/oskarth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/oskarth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/1708/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/328047540",
    "html_url": "https://github.com/status-im/status-mobile/issues/1708#issuecomment-328047540",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708",
    "id": 328047540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODA0NzU0MA==",
    "user": {
      "login": "oskarth",
      "id": 1552237,
      "node_id": "MDQ6VXNlcjE1NTIyMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1552237?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oskarth",
      "html_url": "https://github.com/oskarth",
      "followers_url": "https://api.github.com/users/oskarth/followers",
      "following_url": "https://api.github.com/users/oskarth/following{/other_user}",
      "gists_url": "https://api.github.com/users/oskarth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oskarth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oskarth/subscriptions",
      "organizations_url": "https://api.github.com/users/oskarth/orgs",
      "repos_url": "https://api.github.com/users/oskarth/repos",
      "events_url": "https://api.github.com/users/oskarth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oskarth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-08T09:06:11Z",
    "updated_at": "2017-09-08T09:06:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Basic profile comparison of Jenkins and building iOS locally with mid-line MBP Pro 2017 for http://185.90.37.243:8080/blue/organizations/jenkins/Github%20Org%20Builder%2Fstatus-react/detail/feature%2Fpush-notifications-spike-2-%231599/7/pipeline/7\r\n\r\nTotal build: 2h 4m. Git&Deps 18m, Tests 5m, Build 5m, Build (Android) 58m, Deploy 0m, Build iOS 36m, Deploy 0m, Slack Notification 0m. Let's focus on three areas: Git&Deps, build iOS and ordering. Only tested for iOS, but it seems likely build iOS and build Android are similar in terms of bottlenecks and generic steps.\r\n\r\n### 1) Git & Deps\r\n\r\nTook 18m for Jenkins, takes 9m locally.\r\n\r\n(a) Twice the time, which suggest CPU/RAM/more instances could cut this in half.\r\n\r\n(b) This removes the `node_modules` directory, which I guess is the prudent thing to do, and it isn't a huge win in the grand scheme of thing. It might be worth revisiting though, as very often `node_modules` don't change.\r\n\r\n(c) `npm install` is obviously the slow part here, and there's a particular slow part of this: `node ./scripts/download-mapbox-gl-native-ios-if-on-mac.js 3.3.1`. Locally this can take 5m+, or around 70% of the install time (locally) due to some crazy install procedure. It even times out sometimes. I think we can vendor this or figure out a better solution, but it might not be super trivial.\r\n\r\n### 2) Build iOS\r\n\r\n36m on Jenkins, 5m locally. Normally this step is quicker on Jenkins, so it seems the box got overwhelmed with other jobs, but that just illustrates the point. 7x difference is huge.\r\n\r\n### 3) Ordering\r\n\r\nInstead of building iOS and Android sequentially, we can consider building them as separate builds in parallel, or we can notify on slack with the most easily tested platform first, before moving on to the next one. This would build time in half.\r\n\r\n### Summary\r\n\r\nThere are lots of things we can do to cut the building time in half many times over. Let's start with the easy ones. As a start, I suggest attaching to the box, running a few builds and check `htop`. I don't know the specifics of how Jenkins is setup wrt parallelization of builds, but that might be a separate piece of work.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/328047540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/328101161",
    "html_url": "https://github.com/status-im/status-mobile/issues/1708#issuecomment-328101161",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708",
    "id": 328101161,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODEwMTE2MQ==",
    "user": {
      "login": "oskarth",
      "id": 1552237,
      "node_id": "MDQ6VXNlcjE1NTIyMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1552237?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oskarth",
      "html_url": "https://github.com/oskarth",
      "followers_url": "https://api.github.com/users/oskarth/followers",
      "following_url": "https://api.github.com/users/oskarth/following{/other_user}",
      "gists_url": "https://api.github.com/users/oskarth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oskarth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oskarth/subscriptions",
      "organizations_url": "https://api.github.com/users/oskarth/orgs",
      "repos_url": "https://api.github.com/users/oskarth/repos",
      "events_url": "https://api.github.com/users/oskarth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oskarth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-08T13:19:40Z",
    "updated_at": "2017-09-08T13:20:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Notes after talking to @rasom \r\n\r\nWe can see here http://185.90.37.243:8080/job/status-react-nightly/ (build #283) that if multiple jobs aren't running simultaneously Git&Deps takes 6-7m and building iOS 14m, which is in the ballpark of running things locally. The issue is thus with multiple builds running concurrently.\r\n\r\nRunning multiple macos instances might be expensive. Also need to configure server, if company that provides Jenkin servers can just copy instance that'd simplify things. Check in with @jarradh next week.\r\n\r\nWith multiple instances we could also potentially split up the Android and iOS builds, so the expensive macos instances don't need to impact Android builds. This would cut build time in half and allow for an arbitrary number of concurrent builds (on average we seem to have a few builds running at any given time, so this might be a factor of 2-3 on peak commit/test hours).",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/328101161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/328806689",
    "html_url": "https://github.com/status-im/status-mobile/issues/1708#issuecomment-328806689",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708",
    "id": 328806689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyODgwNjY4OQ==",
    "user": {
      "login": "oskarth",
      "id": 1552237,
      "node_id": "MDQ6VXNlcjE1NTIyMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1552237?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oskarth",
      "html_url": "https://github.com/oskarth",
      "followers_url": "https://api.github.com/users/oskarth/followers",
      "following_url": "https://api.github.com/users/oskarth/following{/other_user}",
      "gists_url": "https://api.github.com/users/oskarth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oskarth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oskarth/subscriptions",
      "organizations_url": "https://api.github.com/users/oskarth/orgs",
      "repos_url": "https://api.github.com/users/oskarth/repos",
      "events_url": "https://api.github.com/users/oskarth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oskarth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-12T10:06:45Z",
    "updated_at": "2017-09-12T10:06:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "As a first step: https://github.com/status-im/status-react/issues/1828",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/328806689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/354996133",
    "html_url": "https://github.com/status-im/status-mobile/issues/1708#issuecomment-354996133",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/1708",
    "id": 354996133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDk5NjEzMw==",
    "user": {
      "login": "oskarth",
      "id": 1552237,
      "node_id": "MDQ6VXNlcjE1NTIyMzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1552237?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oskarth",
      "html_url": "https://github.com/oskarth",
      "followers_url": "https://api.github.com/users/oskarth/followers",
      "following_url": "https://api.github.com/users/oskarth/following{/other_user}",
      "gists_url": "https://api.github.com/users/oskarth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oskarth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oskarth/subscriptions",
      "organizations_url": "https://api.github.com/users/oskarth/orgs",
      "repos_url": "https://api.github.com/users/oskarth/repos",
      "events_url": "https://api.github.com/users/oskarth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oskarth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-03T12:01:00Z",
    "updated_at": "2018-01-03T12:01:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Issue and profiling a bit outdated but many observations still stand. Closing this in favor of more targeted https://github.com/status-im/status-react/issues/2880",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/354996133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
