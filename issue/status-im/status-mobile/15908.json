{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/15908",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/15908/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/15908/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/15908/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/15908",
  "id": 1710731066,
  "node_id": "I_kwDOAx4p2c5l9686",
  "number": 15908,
  "title": "Limit the maximum number of unfurleable URLs",
  "user": {
    "login": "ilmotta",
    "id": 46027,
    "node_id": "MDQ6VXNlcjQ2MDI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/46027?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ilmotta",
    "html_url": "https://github.com/ilmotta",
    "followers_url": "https://api.github.com/users/ilmotta/followers",
    "following_url": "https://api.github.com/users/ilmotta/following{/other_user}",
    "gists_url": "https://api.github.com/users/ilmotta/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ilmotta/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ilmotta/subscriptions",
    "organizations_url": "https://api.github.com/users/ilmotta/orgs",
    "repos_url": "https://api.github.com/users/ilmotta/repos",
    "events_url": "https://api.github.com/users/ilmotta/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ilmotta/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5371443419,
      "node_id": "LA_kwDOAx4p2c8AAAABQCm42w",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:MURLPreview",
      "name": "E:MURLPreview",
      "color": "64805B",
      "default": false,
      "description": "URL Preview feature"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-05-15T19:55:09Z",
  "updated_at": "2023-07-14T14:23:48Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Problem\r\n\r\nDepends on https://github.com/status-im/status-mobile/pull/15891\r\n\r\nUnfurled URLs need to be sent to clients from status-go, and they usually contain thumbnail and favicon data URIs. Although most users don't share huge lists of links, if a user pastes (or painfully) types a long list of URLs, this can cause the app to behave in unexpected ways.\r\n\r\nHow long is too long? We don't know yet, maybe 5, 10 link previews, 20?\r\n\r\nAt the protocol level we can theoretically indefinitely split messages in chunks, each with one or a handful of previews, therefore, the artificial limitation we want to impose on users is at the UX level, catering for a worst case scenario.\r\n\r\n## Open question\r\n\r\nHow should we let users know they've reached the artificial limit?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/15908/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/15908/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1550890253",
    "html_url": "https://github.com/status-im/status-mobile/issues/15908#issuecomment-1550890253",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15908",
    "id": 1550890253,
    "node_id": "IC_kwDOAx4p2c5ccLUN",
    "user": {
      "login": "ibrkhalil",
      "id": 33176106,
      "node_id": "MDQ6VXNlcjMzMTc2MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/33176106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ibrkhalil",
      "html_url": "https://github.com/ibrkhalil",
      "followers_url": "https://api.github.com/users/ibrkhalil/followers",
      "following_url": "https://api.github.com/users/ibrkhalil/following{/other_user}",
      "gists_url": "https://api.github.com/users/ibrkhalil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ibrkhalil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ibrkhalil/subscriptions",
      "organizations_url": "https://api.github.com/users/ibrkhalil/orgs",
      "repos_url": "https://api.github.com/users/ibrkhalil/repos",
      "events_url": "https://api.github.com/users/ibrkhalil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ibrkhalil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-17T07:27:46Z",
    "updated_at": "2023-05-17T07:27:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can we unfurl a specific amount and have an endpoint on status-go that'll unfurl anything extra on demand (Click to show preview), Or instead of breaking the message into chunks, Can we break up the previews into chunks?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1550890253/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1551079001",
    "html_url": "https://github.com/status-im/status-mobile/issues/15908#issuecomment-1551079001",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15908",
    "id": 1551079001,
    "node_id": "IC_kwDOAx4p2c5cc5ZZ",
    "user": {
      "login": "ilmotta",
      "id": 46027,
      "node_id": "MDQ6VXNlcjQ2MDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/46027?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ilmotta",
      "html_url": "https://github.com/ilmotta",
      "followers_url": "https://api.github.com/users/ilmotta/followers",
      "following_url": "https://api.github.com/users/ilmotta/following{/other_user}",
      "gists_url": "https://api.github.com/users/ilmotta/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ilmotta/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ilmotta/subscriptions",
      "organizations_url": "https://api.github.com/users/ilmotta/orgs",
      "repos_url": "https://api.github.com/users/ilmotta/repos",
      "events_url": "https://api.github.com/users/ilmotta/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ilmotta/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-17T09:42:07Z",
    "updated_at": "2023-05-17T09:42:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Can we unfurl a specific amount and have an endpoint on status-go that'll unfurl anything extra on demand (Click to show preview), Or instead of breaking the message into chunks, Can we break up the previews into chunks?\r\n\r\n@ibrkhalil, I'm not sure I fully understood the idea. Thanks for sharing!\r\n\r\nThere's a fundamental requirement for us to take in consideration: only the sender will unfurl due to privacy concerns. So the UX has to be very *synchronous*, i.e. there can't be another moment where the user can request more URLs to unfurl, it's either when composing or never (or when editing). status-go has to unfurl all the bytes from all URLs and immediately provide them to the client, so the client can display them to the user, because the user has to be given a chance to decide to send with or without previews. After sending a message, status-go must respect that choice and store all the data in a `ChatMessage` protobuf (or in multiple in the future).\r\n\r\nSo allowing the user to unfurl on demand seems to me to violate this *synchronous* requirement.\r\n\r\nI see this issue as composed of two parts:\r\n\r\n1. How many URLs should we unfurl that won't impact the UX? Each preview will require, in general, 3 HTTP requests, many can fail or timeout (as far as I tested). Images will need to be compressed and resized. The data will be returned to clients as data URIs base64 encoded, so all of this can put too much pressure on the client and make the experience slow. That's why a hard limit should be imposed. We could say this issue is worried about an edge case.\r\n2. There's the status-go part, the more complex one, and the one I'm not planning on solving to be honest. Depending on the total size of all previews, the message might be too big for the network. I've heard ~125 KiB is a healthy limit, so that's when splitting into multiple messages could be the ideal solution. I'm not going to work on this because John told me someone might be working on creating a general solution to deal with larger messages.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1551079001/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
