{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/3786",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/3786/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/3786/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/3786/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/3786",
  "id": 311952508,
  "node_id": "MDU6SXNzdWUzMTE5NTI1MDg=",
  "number": 3786,
  "title": "Messages are not received in chats or stay in 'Waiting for message to arrive...' state",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 517247009,
      "node_id": "MDU6TGFiZWw1MTcyNDcwMDk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/high-priority",
      "name": "high-priority",
      "color": "000000",
      "default": false,
      "description": null
    },
    {
      "id": 794860412,
      "node_id": "MDU6TGFiZWw3OTQ4NjA0MTI=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/release",
      "name": "release",
      "color": "30dcff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-04-06T12:12:27Z",
  "updated_at": "2018-04-12T10:32:52Z",
  "closed_at": "2018-04-12T10:32:52Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "***Type***: Bug\r\n\r\n***Summary***: With the new protocol changes made in latest nightly develop build there are issues with message receiving.  What happens is that even device stays online - the app frequently loses connection, so messages sent to this Contact are not received. After some time once message sender sends one more message - it picks up all previous messages from offline inbox (from offline inbox - because bunch of unreceived messages appears in 'Waiting for message to arrive...' state - very similar to that described in #3778 but here Contact does not even need to go into offline mode).\r\n\r\n#### Expected behaviour\r\nNo lost messages when exchanging in 1-1 / public chat\r\n\r\n#### Actual behavior\r\nMessages are not received in 1-1 / public chat. If to keep send messages then at some point the last sent message is received by the recipient and everything that were previously not received appears as 'Waiting for a message to arrive...' and keep stay in that state (I waited > 10 minutes).\r\n![2018-04-06 14 36 48](https://user-images.githubusercontent.com/8749671/38420688-4a5d294a-39ad-11e8-8bfb-cbb102595874.jpg)\r\n\r\n\r\n\r\n### Reproduction\r\n\r\n- Install fresh build on Device 1 and Device 2\r\n- Create Contact1 and Contact2 respectively\r\n- Contact1 adds Contact2 in contacts \r\n- Both contacts navigate to 1-1 chat\r\n- Contact1 sends 20 messages to Contact2\r\n- Contact2 sends 20 messages to Contact1\r\n\r\n\r\n### Additional Information\r\n* Status version: 0.9.10-847-g74281a74+ (nightly for the 6th of April)\r\n* Operating System: Android and iOS\r\n\r\n#### Logs\r\n\r\nTF logs for two device sessions can be seen here:\r\nhttps://app.testfairy.com/projects/4803590-status/builds/8054021/sessions/6/?accessToken=5EmvIeVdbOvjg1c6LzLgFonSOV0\r\nhttps://app.testfairy.com/projects/4803622-status/builds/8053965/sessions/61/?accessToken=tQkFFR5W8TznDXPHnSjyUStFgq4",
  "closed_by": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/3786/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/3786/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380733906",
    "html_url": "https://github.com/status-im/status-mobile/issues/3786#issuecomment-380733906",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3786",
    "id": 380733906,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDczMzkwNg==",
    "user": {
      "login": "flexsurfer",
      "id": 11790366,
      "node_id": "MDQ6VXNlcjExNzkwMzY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/11790366?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/flexsurfer",
      "html_url": "https://github.com/flexsurfer",
      "followers_url": "https://api.github.com/users/flexsurfer/followers",
      "following_url": "https://api.github.com/users/flexsurfer/following{/other_user}",
      "gists_url": "https://api.github.com/users/flexsurfer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/flexsurfer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/flexsurfer/subscriptions",
      "organizations_url": "https://api.github.com/users/flexsurfer/orgs",
      "repos_url": "https://api.github.com/users/flexsurfer/repos",
      "events_url": "https://api.github.com/users/flexsurfer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/flexsurfer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T09:11:36Z",
    "updated_at": "2018-04-12T09:11:50Z",
    "author_association": "MEMBER",
    "body": "fixed by https://github.com/status-im/status-react/pull/3836",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380733906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380757104",
    "html_url": "https://github.com/status-im/status-mobile/issues/3786#issuecomment-380757104",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3786",
    "id": 380757104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDc1NzEwNA==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T10:32:08Z",
    "updated_at": "2018-04-12T10:32:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "In the develop build which includes #3836 fix (336 nightly) - can't reproduce anymore on Android 6.0 (Note 4 real device), Android 7.0 (Samsung J7 real), iPhoneX.\r\nAll messages arrive at accounts, no lost messages as well as no 'Waiting for a message to arrive anymore...'. \r\nGladly closing this issue!",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380757104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
