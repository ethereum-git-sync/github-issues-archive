{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/14984",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/14984/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/14984/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/14984/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/14984",
  "id": 1570116141,
  "node_id": "I_kwDOAx4p2c5dlhIt",
  "number": 14984,
  "title": "Contact requests, messages are delivered with delay",
  "user": {
    "login": "pavloburykh",
    "id": 97245802,
    "node_id": "U_kgDOBcvaag",
    "avatar_url": "https://avatars.githubusercontent.com/u/97245802?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pavloburykh",
    "html_url": "https://github.com/pavloburykh",
    "followers_url": "https://api.github.com/users/pavloburykh/followers",
    "following_url": "https://api.github.com/users/pavloburykh/following{/other_user}",
    "gists_url": "https://api.github.com/users/pavloburykh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pavloburykh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pavloburykh/subscriptions",
    "organizations_url": "https://api.github.com/users/pavloburykh/orgs",
    "repos_url": "https://api.github.com/users/pavloburykh/repos",
    "events_url": "https://api.github.com/users/pavloburykh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pavloburykh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 517247009,
      "node_id": "MDU6TGFiZWw1MTcyNDcwMDk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/high-priority",
      "name": "high-priority",
      "color": "000000",
      "default": false,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-02-03T16:37:03Z",
  "updated_at": "2023-02-03T17:47:32Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Since 02 Feb or 03 Feb we started facing an issue with delivery of CR and messages in chats. \r\n\r\nReproducible on latest nightly\r\n\r\n**Steps:**\r\n1. User A sends CR to User B - pay attention how much time it takes for CR to be delivered to receiver\r\n2. User B accepts CR - pay attention how much time it takes for User B to appear in contact list of User A after CR acception\r\n3. User A sends several messages in a row - pay attention at messages delivery time and order of delivered messages\r\n\r\n**Actual result:** delivery delay is observed within CRs, CR decisions, messages. Messages in chat are delivered in random order. \r\n\r\n**Expected result:** no delivery delay. \r\n\r\n\r\nhttps://user-images.githubusercontent.com/97245802/216657118-fb6bf709-510e-4136-86e4-4cf72ba2ca81.mp4\r\n\r\n[User_B_receiver.zip](https://github.com/status-im/status-mobile/files/10580817/User_B_receiver.zip)\r\n[User_A_sender.zip](https://github.com/status-im/status-mobile/files/10580816/User_A_sender.zip)\r\n\r\n### Additional Information\r\n\r\n- Status version: nightly \r\n- Operating System: Android, iOS\r\n\r\n\r\n[comment]: # (Please, add logs/notes if necessary)\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/14984/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/14984/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1416163187",
    "html_url": "https://github.com/status-im/status-mobile/issues/14984#issuecomment-1416163187",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/14984",
    "id": 1416163187,
    "node_id": "IC_kwDOAx4p2c5UaO9z",
    "user": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T17:12:45Z",
    "updated_at": "2023-02-03T17:12:45Z",
    "author_association": "MEMBER",
    "body": "This looks like a waku issue @richard-ramos any recent change that could have triggered it?\r\n\r\nIn the logs I see a bunch of:\r\n\r\n```\r\nt=2023-02-03T13:56:22+0000 lvl=warn msg=\"keep alive hasnt been executed recently. Killing all connections to peers\"\r\n\r\n```\r\n```\r\nt=2023-02-03T16:15:25+0000 lvl=eror msg=\"could not send message\" envelopeHash=0x9ccbaa8c9b25675a6de4baa8b3daa244288466462e02cde2779fcefabb5a947c error=\"not enough peers to publish\"\r\n```\r\n\r\n```\r\nt=2023-02-03T13:20:25+0000 lvl=info msg=\"connecting to peer\" peerID=16Uiu2HAm56MbHycb9SQDuL78EEu67jtK9yVV1oUAzx4JzLK1HAiN error=\"failed to dial 16Uiu2HAm56MbHycb9SQDuL78EEu67jtK9yVV1oUAzx4JzLK1HAiN:\\n  * [/ip4/89.130.215.58/tcp/60000] failed to negotiate security protocol: peer id mismatch: expected 16Uiu2HAm56MbHycb9SQDuL78EEu67jtK9yVV1oUAzx4JzLK1HAiN, but remote key matches 16Uiu2HAm4E6Yf6qHsRL3PE9LTpKKtU1bUMsTM1tJArTEasC5EnmW\\n  * [/ip4/34.121.100.108/tcp/8000/tls/sni/node-01.gc-us-central1-a.wakuv2.prod.statusim.net/ws] failed to negotiate security protocol: peer id mismatch: expected 16Uiu2HAm56MbHycb9SQDuL78EEu67jtK9yVV1oUAzx4JzLK1HAiN, but remote key matches 16Uiu2HAmVkKntsECaYfefR1V2yCR79CegLATuTPE6B9TxgxBiiiA\"\r\n```\r\n\r\nlooks like we have only one peer at times",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1416163187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1416201221",
    "html_url": "https://github.com/status-im/status-mobile/issues/14984#issuecomment-1416201221",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/14984",
    "id": 1416201221,
    "node_id": "IC_kwDOAx4p2c5UaYQF",
    "user": {
      "login": "richard-ramos",
      "id": 1106587,
      "node_id": "MDQ6VXNlcjExMDY1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1106587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richard-ramos",
      "html_url": "https://github.com/richard-ramos",
      "followers_url": "https://api.github.com/users/richard-ramos/followers",
      "following_url": "https://api.github.com/users/richard-ramos/following{/other_user}",
      "gists_url": "https://api.github.com/users/richard-ramos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richard-ramos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richard-ramos/subscriptions",
      "organizations_url": "https://api.github.com/users/richard-ramos/orgs",
      "repos_url": "https://api.github.com/users/richard-ramos/repos",
      "events_url": "https://api.github.com/users/richard-ramos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richard-ramos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T17:47:32Z",
    "updated_at": "2023-02-03T17:47:32Z",
    "author_association": "MEMBER",
    "body": "I added this code: https://github.com/waku-org/go-waku/blob/master/waku/v2/node/keepalive.go#L46-L47\r\nwhich checks if it's been > ~90s since the last time the keepAlive code was executed, and if so, i disconnect all the peers. Is I use this in desktop to detect if the machine had gone to sleep and it's waking up, to attempt to reconnect to peers.\r\n\r\nDo mobile phones suspend execution when they're not active? if so, this is probably what's causing the issue, and perhaps we should increase that time to ... 5-10m instead? ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1416201221/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
