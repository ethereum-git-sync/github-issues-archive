{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/13228",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/13228",
  "id": 1184869295,
  "node_id": "I_kwDOAx4p2c5Gn6uv",
  "number": 13228,
  "title": "Message preview and unread counter are displayed on the recipient's side if the message was sent and deleted while the recipient was offline",
  "user": {
    "login": "qoqobolo",
    "id": 67952253,
    "node_id": "MDQ6VXNlcjY3OTUyMjUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/67952253?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qoqobolo",
    "html_url": "https://github.com/qoqobolo",
    "followers_url": "https://api.github.com/users/qoqobolo/followers",
    "following_url": "https://api.github.com/users/qoqobolo/following{/other_user}",
    "gists_url": "https://api.github.com/users/qoqobolo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qoqobolo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qoqobolo/subscriptions",
    "organizations_url": "https://api.github.com/users/qoqobolo/orgs",
    "repos_url": "https://api.github.com/users/qoqobolo/repos",
    "events_url": "https://api.github.com/users/qoqobolo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qoqobolo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 795655580,
      "node_id": "MDU6TGFiZWw3OTU2NTU1ODA=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/chat",
      "name": "chat",
      "color": "f70cb0",
      "default": false,
      "description": null
    },
    {
      "id": 3990911030,
      "node_id": "LA_kwDOAx4p2c7t4Hg2",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:Bugfixes",
      "name": "E:Bugfixes",
      "color": "32BD0C",
      "default": false,
      "description": ""
    },
    {
      "id": 4011372929,
      "node_id": "LA_kwDOAx4p2c7vGLGB",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:ChatFeatures",
      "name": "E:ChatFeatures",
      "color": "35103C",
      "default": false,
      "description": ""
    },
    {
      "id": 4875568527,
      "node_id": "LA_kwDOAx4p2c8AAAABIptFjw",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/recheck",
      "name": "recheck",
      "color": "767FB8",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jo-mut",
    "id": 28704507,
    "node_id": "MDQ6VXNlcjI4NzA0NTA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/28704507?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jo-mut",
    "html_url": "https://github.com/jo-mut",
    "followers_url": "https://api.github.com/users/jo-mut/followers",
    "following_url": "https://api.github.com/users/jo-mut/following{/other_user}",
    "gists_url": "https://api.github.com/users/jo-mut/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jo-mut/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jo-mut/subscriptions",
    "organizations_url": "https://api.github.com/users/jo-mut/orgs",
    "repos_url": "https://api.github.com/users/jo-mut/repos",
    "events_url": "https://api.github.com/users/jo-mut/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jo-mut/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jo-mut",
      "id": 28704507,
      "node_id": "MDQ6VXNlcjI4NzA0NTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28704507?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jo-mut",
      "html_url": "https://github.com/jo-mut",
      "followers_url": "https://api.github.com/users/jo-mut/followers",
      "following_url": "https://api.github.com/users/jo-mut/following{/other_user}",
      "gists_url": "https://api.github.com/users/jo-mut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jo-mut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jo-mut/subscriptions",
      "organizations_url": "https://api.github.com/users/jo-mut/orgs",
      "repos_url": "https://api.github.com/users/jo-mut/repos",
      "events_url": "https://api.github.com/users/jo-mut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jo-mut/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-mobile/milestones/60",
    "html_url": "https://github.com/status-im/status-mobile/milestone/60",
    "labels_url": "https://api.github.com/repos/status-im/status-mobile/milestones/60/labels",
    "id": 8197709,
    "node_id": "MI_kwDOAx4p2c4AfRZN",
    "number": 60,
    "title": "Release 1.21",
    "description": "",
    "creator": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 8,
    "closed_issues": 18,
    "state": "closed",
    "created_at": "2022-07-15T09:35:16Z",
    "updated_at": "2023-01-26T17:14:14Z",
    "due_on": null,
    "closed_at": "2022-12-02T16:05:58Z"
  },
  "comments": 4,
  "created_at": "2022-03-29T13:24:44Z",
  "updated_at": "2022-12-06T10:06:54Z",
  "closed_at": "2022-12-06T10:06:54Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n\r\n## Problem \r\nMessage preview and unread counter are displayed on the recipient's side on the Home screen if the message was sent and deleted while the recipient was offline. The number of unread messages increases with every deleted message.\r\nThe issue is relevant for all chat and messages types. \r\n\r\n\r\n#### Expected behavior\r\nNo message on the recipient's side when returning online\r\n\r\n#### Actual behavior\r\nhttps://user-images.githubusercontent.com/67952253/160586085-8f7b6520-400b-4c04-900c-ff3541d97368.MP4\r\n\r\n### Reproduction\r\n\r\n1. Device1 and device2 start a 1-1 chat\r\n2. Device2 closes the app\r\n3. Device1 sends a message and deletes it\r\n4. Device2 logs in\r\n\r\n### Additional Information\r\n\r\n- Status version: nightly 29/03\r\n- Operating System: Android, iOS\r\n\r\n### Logs\r\n[Sender geth.log](https://github.com/status-im/status-react/files/8371778/geth.log)\r\n[Recipient geth.log](https://github.com/status-im/status-react/files/8371779/geth.log)\r\n\r\n\r\n",
  "closed_by": {
    "login": "churik",
    "id": 4557972,
    "node_id": "MDQ6VXNlcjQ1NTc5NzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4557972?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/churik",
    "html_url": "https://github.com/churik",
    "followers_url": "https://api.github.com/users/churik/followers",
    "following_url": "https://api.github.com/users/churik/following{/other_user}",
    "gists_url": "https://api.github.com/users/churik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/churik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/churik/subscriptions",
    "organizations_url": "https://api.github.com/users/churik/orgs",
    "repos_url": "https://api.github.com/users/churik/repos",
    "events_url": "https://api.github.com/users/churik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/churik/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/13228/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1095507993",
    "html_url": "https://github.com/status-im/status-mobile/issues/13228#issuecomment-1095507993",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228",
    "id": 1095507993,
    "node_id": "IC_kwDOAx4p2c5BTCAZ",
    "user": {
      "login": "jo-mut",
      "id": 28704507,
      "node_id": "MDQ6VXNlcjI4NzA0NTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28704507?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jo-mut",
      "html_url": "https://github.com/jo-mut",
      "followers_url": "https://api.github.com/users/jo-mut/followers",
      "following_url": "https://api.github.com/users/jo-mut/following{/other_user}",
      "gists_url": "https://api.github.com/users/jo-mut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jo-mut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jo-mut/subscriptions",
      "organizations_url": "https://api.github.com/users/jo-mut/orgs",
      "repos_url": "https://api.github.com/users/jo-mut/repos",
      "events_url": "https://api.github.com/users/jo-mut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jo-mut/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-11T19:59:27Z",
    "updated_at": "2022-04-11T19:59:27Z",
    "author_association": "MEMBER",
    "body": "I noticed something funny. When local notifications are switched on the receiving device the last message of a chat does not get updated when a message is deleted while the app is not active until the recipient replies in the chat. This behaviour also affects un-viewed messages counter and seems to have  a relation with local notifications\r\n\r\nThe other case which I have managed to address is a scenario where the location notifications are switched off. The last message of a chat gets updated when a message is received, sent or deleted but the counter for un-viewed messages is not updated to account for the count of the deleted messages when the app on the receiving end is not active. This results in the count for un-viewed messages being more than the number of messages that have not been seen by the recipient. However this is something that I have looked into and solved on status-go and seems to work fine",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1095507993/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243558215",
    "html_url": "https://github.com/status-im/status-mobile/issues/13228#issuecomment-1243558215",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228",
    "id": 1243558215,
    "node_id": "IC_kwDOAx4p2c5KHzFH",
    "user": {
      "login": "churik",
      "id": 4557972,
      "node_id": "MDQ6VXNlcjQ1NTc5NzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4557972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/churik",
      "html_url": "https://github.com/churik",
      "followers_url": "https://api.github.com/users/churik/followers",
      "following_url": "https://api.github.com/users/churik/following{/other_user}",
      "gists_url": "https://api.github.com/users/churik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/churik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/churik/subscriptions",
      "organizations_url": "https://api.github.com/users/churik/orgs",
      "repos_url": "https://api.github.com/users/churik/repos",
      "events_url": "https://api.github.com/users/churik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/churik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T10:49:22Z",
    "updated_at": "2022-09-12T10:49:22Z",
    "author_association": "MEMBER",
    "body": "One more scenario with public chat.\r\nUser A: join any public chats, send several messages, delete the last one, log out \r\nUser B: join same public chat \r\n\r\nExpected result: no last message is shown \r\nActual result: User B is seeing last message (deleted) in preview",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243558215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243602397",
    "html_url": "https://github.com/status-im/status-mobile/issues/13228#issuecomment-1243602397",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228",
    "id": 1243602397,
    "node_id": "IC_kwDOAx4p2c5KH93d",
    "user": {
      "login": "jo-mut",
      "id": 28704507,
      "node_id": "MDQ6VXNlcjI4NzA0NTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/28704507?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jo-mut",
      "html_url": "https://github.com/jo-mut",
      "followers_url": "https://api.github.com/users/jo-mut/followers",
      "following_url": "https://api.github.com/users/jo-mut/following{/other_user}",
      "gists_url": "https://api.github.com/users/jo-mut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jo-mut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jo-mut/subscriptions",
      "organizations_url": "https://api.github.com/users/jo-mut/orgs",
      "repos_url": "https://api.github.com/users/jo-mut/repos",
      "events_url": "https://api.github.com/users/jo-mut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jo-mut/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T11:28:14Z",
    "updated_at": "2022-09-12T11:28:14Z",
    "author_association": "MEMBER",
    "body": "@churik  the issue for 1 on 1 chats is now resolved and it should also be resolved in  the of  public chats. I will however test to confirm that it works fine with public chats ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1243602397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1339074508",
    "html_url": "https://github.com/status-im/status-mobile/issues/13228#issuecomment-1339074508",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13228",
    "id": 1339074508,
    "node_id": "IC_kwDOAx4p2c5P0KfM",
    "user": {
      "login": "churik",
      "id": 4557972,
      "node_id": "MDQ6VXNlcjQ1NTc5NzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4557972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/churik",
      "html_url": "https://github.com/churik",
      "followers_url": "https://api.github.com/users/churik/followers",
      "following_url": "https://api.github.com/users/churik/following{/other_user}",
      "gists_url": "https://api.github.com/users/churik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/churik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/churik/subscriptions",
      "organizations_url": "https://api.github.com/users/churik/orgs",
      "repos_url": "https://api.github.com/users/churik/repos",
      "events_url": "https://api.github.com/users/churik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/churik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T10:06:54Z",
    "updated_at": "2022-12-06T10:06:54Z",
    "author_association": "MEMBER",
    "body": "The label `recheck` is added in order to keep an eye on it while testing this part of the redesigned app.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1339074508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
