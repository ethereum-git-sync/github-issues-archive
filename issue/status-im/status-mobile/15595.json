{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/15595",
  "id": 1657404079,
  "node_id": "I_kwDOAx4p2c5iyfqv",
  "number": 15595,
  "title": "Build status-go for i386 only for simulator",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 448876669,
      "node_id": "MDU6TGFiZWw0NDg4NzY2Njk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/android",
      "name": "android",
      "color": "5319e7",
      "default": false,
      "description": null
    },
    {
      "id": 933023569,
      "node_id": "MDU6TGFiZWw5MzMwMjM1Njk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/feature",
      "name": "feature",
      "color": "172b9e",
      "default": false,
      "description": "feature requests"
    },
    {
      "id": 4052544927,
      "node_id": "LA_kwDOAx4p2c7xjO2f",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:MDeveloperXP",
      "name": "E:MDeveloperXP",
      "color": "0F662F",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "yakimant",
    "id": 1529006,
    "node_id": "MDQ6VXNlcjE1MjkwMDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1529006?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yakimant",
    "html_url": "https://github.com/yakimant",
    "followers_url": "https://api.github.com/users/yakimant/followers",
    "following_url": "https://api.github.com/users/yakimant/following{/other_user}",
    "gists_url": "https://api.github.com/users/yakimant/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yakimant/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yakimant/subscriptions",
    "organizations_url": "https://api.github.com/users/yakimant/orgs",
    "repos_url": "https://api.github.com/users/yakimant/repos",
    "events_url": "https://api.github.com/users/yakimant/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yakimant/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "yakimant",
      "id": 1529006,
      "node_id": "MDQ6VXNlcjE1MjkwMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1529006?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yakimant",
      "html_url": "https://github.com/yakimant",
      "followers_url": "https://api.github.com/users/yakimant/followers",
      "following_url": "https://api.github.com/users/yakimant/following{/other_user}",
      "gists_url": "https://api.github.com/users/yakimant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yakimant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yakimant/subscriptions",
      "organizations_url": "https://api.github.com/users/yakimant/orgs",
      "repos_url": "https://api.github.com/users/yakimant/repos",
      "events_url": "https://api.github.com/users/yakimant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yakimant/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-04-06T13:11:49Z",
  "updated_at": "2023-07-14T14:23:42Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "There is a time saving to be made in building `status-go` only for `i386`, since currently we always build for 3 architectures:\r\nhttps://github.com/status-im/status-mobile/blob/0656ad8cb2af018c4d396b41d6c89ba6a6cd3f80/nix/status-go/mobile/default.nix#L4-L8\r\nBut building only for for `i386` for simulator runs we can save over two minutes:\r\n| Config | Build Time |\r\n|-|-|\r\n| `[ \"android/arm\" \"android/arm64\" \"android/386\" ]` | 3 min 51 sec |\r\n| `[ \"android/arm64\" ]` |  1 min 27 sec |\r\n| `[ \"android/arm\" ]` | 1 min 28 sec |\r\n| `[ \"android/386\" ]` | 1 min 27 sec |\r\n\r\nThe normal way developers use a simulator is via `make run-android`, so we'd need to modify the shell for that.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/15595/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598802695",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1598802695",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1598802695,
    "node_id": "IC_kwDOAx4p2c5fS8sH",
    "user": {
      "login": "yakimant",
      "id": 1529006,
      "node_id": "MDQ6VXNlcjE1MjkwMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1529006?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yakimant",
      "html_url": "https://github.com/yakimant",
      "followers_url": "https://api.github.com/users/yakimant/followers",
      "following_url": "https://api.github.com/users/yakimant/following{/other_user}",
      "gists_url": "https://api.github.com/users/yakimant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yakimant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yakimant/subscriptions",
      "organizations_url": "https://api.github.com/users/yakimant/orgs",
      "repos_url": "https://api.github.com/users/yakimant/repos",
      "events_url": "https://api.github.com/users/yakimant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yakimant/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T13:33:46Z",
    "updated_at": "2023-06-20T13:33:46Z",
    "author_association": "MEMBER",
    "body": "Trying to `run-android` on local macOS with Apple Silicon showed the following compatibility:\r\n- `x86_64` emulator doesn't start, `arm64-v8a` is needed\r\n- `ANDROID_ABI_INCLUDE=x86` can't run\r\n- `status-go: targets=[\"android/386\"]` can't run\r\n\r\nSo if we do `make run-android` on arm - it makes sense to build both mobile app and status-go for arm.\r\n\r\nProbably it's the same if we run on Linux (x86): x86 emulator/app abi/status-go targets.\r\n\r\n@siddarthkay, please confirm.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598802695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598807918",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1598807918",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1598807918,
    "node_id": "IC_kwDOAx4p2c5fS99u",
    "user": {
      "login": "yakimant",
      "id": 1529006,
      "node_id": "MDQ6VXNlcjE1MjkwMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1529006?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yakimant",
      "html_url": "https://github.com/yakimant",
      "followers_url": "https://api.github.com/users/yakimant/followers",
      "following_url": "https://api.github.com/users/yakimant/following{/other_user}",
      "gists_url": "https://api.github.com/users/yakimant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yakimant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yakimant/subscriptions",
      "organizations_url": "https://api.github.com/users/yakimant/orgs",
      "repos_url": "https://api.github.com/users/yakimant/repos",
      "events_url": "https://api.github.com/users/yakimant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yakimant/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T13:36:45Z",
    "updated_at": "2023-06-20T13:36:45Z",
    "author_association": "MEMBER",
    "body": "I suggest to make `status-go` target mapped by `ANDROID_ABI_INCLUDE` of status-mobile app.\r\n\r\nHere is the suggested mapping:\r\n| ANDROID_ABI_INCLUDE | status-go target |\r\n|--------|--------|\r\n| armeabi-v7a | android/arm |\r\n| arm64-v8a | android/arm64 |\r\n| x86 | android/386 |\r\n| x86_64 | android/386 |\r\n\r\n@siddarthkay, what do you think?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598807918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598811213",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1598811213",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1598811213,
    "node_id": "IC_kwDOAx4p2c5fS-xN",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T13:38:41Z",
    "updated_at": "2023-06-20T13:38:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "\r\n\r\n\r\n\r\n> please confirm.\r\n\r\n- yes Android Studio on mac allows us to create an `x86_64` it however crashes on startup and only `arm64` android emulators work on macOS.\r\n- not sure about not including x86 from CPU Architecture target in `ANDROID_ABI_INCLUDE `\r\n- not really sure about `status-go: targets=[\"android/386\"]` either",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598811213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598813493",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1598813493",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1598813493,
    "node_id": "IC_kwDOAx4p2c5fS_U1",
    "user": {
      "login": "yakimant",
      "id": 1529006,
      "node_id": "MDQ6VXNlcjE1MjkwMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1529006?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yakimant",
      "html_url": "https://github.com/yakimant",
      "followers_url": "https://api.github.com/users/yakimant/followers",
      "following_url": "https://api.github.com/users/yakimant/following{/other_user}",
      "gists_url": "https://api.github.com/users/yakimant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yakimant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yakimant/subscriptions",
      "organizations_url": "https://api.github.com/users/yakimant/orgs",
      "repos_url": "https://api.github.com/users/yakimant/repos",
      "events_url": "https://api.github.com/users/yakimant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yakimant/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T13:39:59Z",
    "updated_at": "2023-06-20T13:39:59Z",
    "author_association": "MEMBER",
    "body": "So if my understading is correct, based on research and hints from @jakubgs, here is my proposal:\r\n- Make `status-go` targets as a parameter (targets.status-go.mobile.android Nix function)\r\n- Switch from config to env (`status-im.android.abi-include` to `ANDROID_ABI_INCLUDE`) for `targets.mobile.android`\r\n  - Fix build-android.sh to support the change\r\n  - Fix status-jenkins-lib/vars/android.groovy to support the change\r\n  - Alternatives\r\n    - add config to nix shells\r\n    - add `ANDROID_ABI_INCLUDE_OVERRIDE` instead\r\n- Add mapping logic for `targets.mobile.android`:\r\n  - Choose appropriate `status-go` targets based on `ANDROID_ABI_INCLUDE`\r\n  - Set build/shell env vatiable to `ANDROID_ABI_INCLUDE`\r\n- Set `ANDROID_ABI_INCLUDE` in shell.sh based on architecture: x86 or arm64-v8a",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598813493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598813882",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1598813882",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1598813882,
    "node_id": "IC_kwDOAx4p2c5fS_a6",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T13:40:15Z",
    "updated_at": "2023-06-20T13:40:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "by specifying `ANDROID_ABI_INCLUDE ` in `build.gradle` we use those targets to build a universal apk which allows us to share apk with testing team and it works for them irrespective of the phones they have ( either x86 or arm )\r\n@jakubgs correct me if i am wrong over here....",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1598813882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1599343017",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1599343017",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1599343017,
    "node_id": "IC_kwDOAx4p2c5fVAmp",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T18:54:32Z",
    "updated_at": "2023-06-20T18:54:32Z",
    "author_association": "MEMBER",
    "body": "I think we need to get rid of `nix/config.nix` first in a separate PR, by using `builins.getEnv`, and moving the setting of those config values closer to where they are being used. And expand documentation in `nix/DETAILS.md` to include information about that.\r\n\r\nOnce that is done we will have a clearer picture of how to apply these settings, but the suggested `nix/mobile/android/default.nix` certainly looks like one of the candidates. At least for Android builds and shell.\r\n\r\n@siddarthkay yes, that's correct, but we also make a separate build for E2E tests just for that reason with only `x86`:\r\n```groovy\r\n  if (utils.isE2EBuild()) {\r\n    androidAbiInclude = 'x86' /* e2e builds are used with simulators */\r\n```\r\nhttps://github.com/status-im/status-jenkins-lib/blob/4a933b88e2c9fc4cd6191797a89cfa4ef4fdb2cd/vars/android.groovy#L11-L12",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1599343017/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1600445666",
    "html_url": "https://github.com/status-im/status-mobile/issues/15595#issuecomment-1600445666",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/15595",
    "id": 1600445666,
    "node_id": "IC_kwDOAx4p2c5fZNzi",
    "user": {
      "login": "yakimant",
      "id": 1529006,
      "node_id": "MDQ6VXNlcjE1MjkwMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1529006?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yakimant",
      "html_url": "https://github.com/yakimant",
      "followers_url": "https://api.github.com/users/yakimant/followers",
      "following_url": "https://api.github.com/users/yakimant/following{/other_user}",
      "gists_url": "https://api.github.com/users/yakimant/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yakimant/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yakimant/subscriptions",
      "organizations_url": "https://api.github.com/users/yakimant/orgs",
      "repos_url": "https://api.github.com/users/yakimant/repos",
      "events_url": "https://api.github.com/users/yakimant/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yakimant/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-21T08:49:00Z",
    "updated_at": "2023-06-21T08:49:00Z",
    "author_association": "MEMBER",
    "body": "@churik, can you please comment, how (if) you run e2e tests locally.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1600445666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
