{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/3108",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/3108/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/3108/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/3108/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/3108",
  "id": 290412318,
  "node_id": "MDU6SXNzdWUyOTA0MTIzMTg=",
  "number": 3108,
  "title": "[Perf] User story 3: Time lag when user sends the very first message in group chat",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 783781483,
      "node_id": "MDU6TGFiZWw3ODM3ODE0ODM=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/performance",
      "name": "performance",
      "color": "dd3bd8",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-01-22T10:15:34Z",
  "updated_at": "2018-04-15T12:39:26Z",
  "closed_at": "2018-04-15T12:39:26Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### User Story\r\n\r\nAs a user I want my message appear in the chat in <0.3 second after I tap the 'Send' message button\r\n\r\n***Type***: Bug\r\n\r\n***Summary***: There is a noticeable time lag on the first message sending in group chat comparing to next message sending. This is the time delay when user taps on \"Send\" message blue button and when the actual message appears in group chat list. Depends from device, but on Samsung J7 with Android 7.0 - it's up to 3-4 seconds (while it's <0.5 seconds for next messages). \r\nThis is not a case for 1-1 chats or public chats.\r\n\r\nNote: Similar issue is in #3397 . I believe the fix for both may be the same.\r\n\r\n#### Expected behavior\r\nNo time lags when user send in group chat the first message\r\n\r\n#### Actual behavior\r\nTime lags when user send in group chat the first message\r\n\r\n### Reproduction\r\n\r\n1) Open Status and create new account\r\n2) Create \"New group chat\" with the contact. You should wind up on Group Chat screen at this point.\r\n3) In this newly created group chat - type any text/emoji message (e.g. \"Hey\")\r\n4) Tap on 'Send message' blue button and note the delay after you tap on it and when the message appears in group chat messages list.\r\n**Actual result:** Time delay is 3-4 seconds\r\n5) Send several more messages (repeat 3-4 item above)\r\n**Actual result:** Time delay is <0.5 seconds\r\n\r\n\r\n### Additional Information\r\n* Status version: Develop 0.9.10-600-g54e83c58+, release 0.9.13\r\n* Operating System: Android 7.0, iOS\r\n\r\nTF session (from 00:50) - pay attention on tap on the Send message button and when the message appears in list of messages: https://app.testfairy.com/projects/4803622-status/builds/7534654/sessions/37/?accessToken=TbcEuX6hk3Vk4gyrn6vWwhhE2WQ",
  "closed_by": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/3108/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/3108/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/360410618",
    "html_url": "https://github.com/status-im/status-mobile/issues/3108#issuecomment-360410618",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3108",
    "id": 360410618,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDQxMDYxOA==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T09:29:37Z",
    "updated_at": "2018-01-25T09:29:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Short talk we had in slack recently as a vector for investigation here:\r\n\r\n[1] it looks like when user sends the message - we process it first (encrypt/encode) on background and then display in chat list. Disregard of what’s happening now when user taps on blue ‘Send’ message button - it it possible to prioritise UI message rendering process first and then do the rest of things related to actual send-deliver message? So the queue may look like: User types the message content -> User taps on ‘Send’ button -> Message appears in chat list right away with the status ‘Pending…’ -> All the rest messaging related processes...\r\n\r\n[2] sending a message is actually when Whisper’s PoW is performed so it’s blocking. I guess it’s done via `CallRPC` call so I wonder if that is done in the main thread or not…\r\n\r\n[3] we can render message immediately after pressing send button, `CallRPC` is always async because it goes through RN bridge and communication through this bridge is always async",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/360410618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/381403525",
    "html_url": "https://github.com/status-im/status-mobile/issues/3108#issuecomment-381403525",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3108",
    "id": 381403525,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTQwMzUyNQ==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-15T12:39:23Z",
    "updated_at": "2018-04-15T12:39:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "After new protocol, this issue does not take place anymore!  \r\n6 group chat members - on Galaxy Note 4 - very first message in the group chat appears with the same delay as all further messages.\r\nNote, the number/size of the messages still matters in order how fast message appears in the chat screen after contact taps on 'Send message' button (https://github.com/status-im/status-react/issues/3397)\r\n \r\nHappy to close this issue!",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/381403525/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
