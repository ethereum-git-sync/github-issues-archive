{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/8441",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/8441/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/8441/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/8441/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/8441",
  "id": 458122739,
  "node_id": "MDU6SXNzdWU0NTgxMjI3Mzk=",
  "number": 8441,
  "title": "Long sync (90+ sec) when Fetch24History in 1-1 / Group chats",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 783781483,
      "node_id": "MDU6TGFiZWw3ODM3ODE0ODM=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/performance",
      "name": "performance",
      "color": "dd3bd8",
      "default": false,
      "description": null
    },
    {
      "id": 1143032367,
      "node_id": "MDU6TGFiZWwxMTQzMDMyMzY3",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/core",
      "name": "core",
      "color": "8befdd",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-06-19T16:58:38Z",
  "updated_at": "2020-09-17T10:49:01Z",
  "closed_at": "2020-09-17T10:49:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "***Type***: Bug\r\n\r\n***Summary***: When 'Fetch 24 history' action in 1-1, but especially in Group, chat has tapped - app syncing (blue progress bar) takes 90+ seconds almost always (sometimes longer).\r\nIn public chat it's less than 2 seconds. It does not depend from devices: there are similar values for Low-Middle (Android 8) and iPhoneX (iOS 12).\r\n\r\nIt also depends on mailserver user is connected to, so in below scenarios everything reproduced when connected to the same mail-01.ams3 mailserver\r\n\r\n\r\n#### Expected behavior\r\nApp sync takes <2s (same as for public chat) when fetching 24h history in 1-1/Group Chat with `Fetch 24h history` chat option\r\n\r\n#### Actual behavior\r\n\r\nApp sync takes 90+ seconds when fetching 24h history in 1-1/Group Chat with `Fetch 24h history` chat option. Please see video and logs below.\r\n\r\n### Reproduction 1 (Group Chat)\r\n\r\n- Open Status and create new account (UserA)\r\n- With another device add UserA in contacts\r\n- Create `Group Chat` with UserA. Send a single 1 line text message.\r\n- UserA joins the group chat. Wait until syncing at this stage is completed.\r\n- UserA from the GroupChat -> top-right chat menu button taps `Fetch last 24 hours`\r\n\r\nVideo for above scenario: https://drive.google.com/file/d/1iArQsh24q-iQf9cs-hsnc7RtJ6CJxF2u/view\r\nLogcat: [1to1Fetch24Logcat.log](https://github.com/status-im/status-react/files/3307151/GroupNightlyFetch24hLogcat.log)\r\nGeth.log (with DEBUG log level):   [GroupNightlyFetch24geth.log](https://github.com/status-im/status-react/files/3307149/GroupNightlyFetch24geth.log)\r\n\r\n\r\n### Reproduction 2 (1-1 chat)\r\n- Open Status and create new account (UserA)\r\n- With another device add UserA in contacts and send text message\r\n- UserA from the 1-1 chat view -> top-right chat menu button taps `Fetch last 24 hours`\r\n\r\nVideo for above scenario: https://drive.google.com/file/d/1-3SbQli-gv_z7tlpzcdtPW1nBFDFnvv3/view\r\nLogcat: [1to1Fetch24Logcat.log](https://github.com/status-im/status-react/files/3307144/11ChatNightly2ChatFetch24hSyncing.log)\r\nGeth.log (with DEBUG log level): [1to1Fetch24geth.log](https://github.com/status-im/status-react/files/3307146/11NightlyFetch24hgeth.log)\r\n\r\n\r\n### Additional Information\r\n\r\n- Status version: Develop Nightly build 19th of June (2019061902)\r\n- Operating System: Android and iOS\r\n",
  "closed_by": {
    "login": "cammellos",
    "id": 1017008,
    "node_id": "MDQ6VXNlcjEwMTcwMDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cammellos",
    "html_url": "https://github.com/cammellos",
    "followers_url": "https://api.github.com/users/cammellos/followers",
    "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
    "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
    "organizations_url": "https://api.github.com/users/cammellos/orgs",
    "repos_url": "https://api.github.com/users/cammellos/repos",
    "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cammellos/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/8441/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/8441/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/503971181",
    "html_url": "https://github.com/status-im/status-mobile/issues/8441#issuecomment-503971181",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8441",
    "id": 503971181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMzk3MTE4MQ==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-20T10:24:10Z",
    "updated_at": "2019-06-20T10:24:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mandrigin @cammellos I'm wondering if this reproducible issue could be one of the major reasons of when syncing may take 10+ minutes which can happen from time to time (Note: the 10+ minutes sync may also be because of the location of mailserver user is connected to - happens usually when mailserver autoconnection is set - but it's separate from this issue.)\r\n\r\nSo if the contact has several 1-1, several group chats and logins to account we start sync of the last 24h history in those chats it takes long time to finish due to bug reproduced here.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/503971181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/503974006",
    "html_url": "https://github.com/status-im/status-mobile/issues/8441#issuecomment-503974006",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8441",
    "id": 503974006,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMzk3NDAwNg==",
    "user": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-20T10:33:48Z",
    "updated_at": "2019-06-20T10:33:48Z",
    "author_association": "MEMBER",
    "body": "The issue is a known behaviour, not quite a bug.\n\n\n1 to 1 and group chats receive messages from what we call the discovery\ntopic.\n\nThis topic contains all the data that is exchanged on 1 to 1 and group\nchats from anyone who uses status.\n\nso when you fetch the last 24 hours, you will be receiving all the 1 to 1\nmessages sent on status ( you will only keep the ones that are for you).\n\nwhen you fetch a public chat, you only receive messages for that chat, so\nit s much faster.\n\n\nwe are addressing the issue by moving to a partitioned/negotiated topic\nwhich will alleviate the load, but will only happen when people start using\nthe new version ( pr is now under testing).\n\n\n overall group chats vs one to one should take the same time (it s the same\nrequest), number of chats is also not relevant ( more or less), as we\nalways fetch the discovery topic, even if you don't have any chats.\n\nbut it is definitely the reason for the 10 minutes syncing\n\n\n\n\n\nOn Thu, Jun 20, 2019, 12:24 Sergey Chumak <notifications@github.com> wrote:\n\n> @mandrigin <https://github.com/mandrigin> @cammellos\n> <https://github.com/cammellos> I'm wondering if this reproducible issue\n> could be one of the major reasons of when syncing may take 10+ minutes\n> which can happen from time to time (Note: the 10+ minutes sync may also be\n> because of the location of mailserver user is connected to - happens\n> usually when mailserver autoconnection is set - but it's separate from this\n> issue.)\n>\n> So if the contact has several 1-1, several group chats and logins to\n> account we start sync of the last 24h history in those chats it takes long\n> time to finish due to bug reproduced here.\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/status-im/status-react/issues/8441?email_source=notifications&email_token=AAHYJMBHIAQQL5C7MF2U5TDP3NLFLA5CNFSM4HZLSJT2YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGODYE723I#issuecomment-503971181>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAHYJMD2Y2737KGGVEF43YTP3NLFLANCNFSM4HZLSJTQ>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/503974006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
