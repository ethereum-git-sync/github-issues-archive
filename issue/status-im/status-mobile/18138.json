{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/18138",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/18138",
  "id": 2034933832,
  "node_id": "I_kwDOAx4p2c55SqBI",
  "number": 18138,
  "title": "research for enabling new architecture in react-native",
  "user": {
    "login": "siddarthkay",
    "id": 64726664,
    "node_id": "MDQ6VXNlcjY0NzI2NjY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siddarthkay",
    "html_url": "https://github.com/siddarthkay",
    "followers_url": "https://api.github.com/users/siddarthkay/followers",
    "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
    "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
    "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
    "repos_url": "https://api.github.com/users/siddarthkay/repos",
    "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 783781483,
      "node_id": "MDU6TGFiZWw3ODM3ODE0ODM=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:Mobile%20Performance%20MVP",
      "name": "E:Mobile Performance MVP",
      "color": "dd3bd8",
      "default": false,
      "description": ""
    },
    {
      "id": 933023569,
      "node_id": "MDU6TGFiZWw5MzMwMjM1Njk=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/feature",
      "name": "feature",
      "color": "172b9e",
      "default": false,
      "description": "feature requests"
    },
    {
      "id": 981718332,
      "node_id": "MDU6TGFiZWw5ODE3MTgzMzI=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:Mobile%20React%20Native",
      "name": "E:Mobile React Native",
      "color": "329799",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "siddarthkay",
    "id": 64726664,
    "node_id": "MDQ6VXNlcjY0NzI2NjY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siddarthkay",
    "html_url": "https://github.com/siddarthkay",
    "followers_url": "https://api.github.com/users/siddarthkay/followers",
    "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
    "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
    "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
    "repos_url": "https://api.github.com/users/siddarthkay/repos",
    "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-12-11T06:36:56Z",
  "updated_at": "2023-12-20T15:04:20Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Feature Issue\r\nThis issue will contain research for enabling new architecture in react-native.\r\n\r\n- [ ] iOS still runs on JSC we need to enable Hermes there first.\r\n- [ ] For iOS we need to do prepend `RCT_NEW_ARCH_ENABLED=1` flag along with pod install to enable new architecture. We run pod install during our build process here : `nix/mobile/ios/shells/cocoapods.nix`\r\n- [ ] For Android we need to set `newArchEnabled` flag to true at `android/gradle.properties`\r\n\r\nLibraries that support new architecture and WIP : https://github.com/reactwg/react-native-new-architecture/discussions/6#discussion-3897049\r\n\r\nDepends on : #17241 \r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/18138/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1849434644",
    "html_url": "https://github.com/status-im/status-mobile/issues/18138#issuecomment-1849434644",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138",
    "id": 1849434644,
    "node_id": "IC_kwDOAx4p2c5uPCIU",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-11T06:59:48Z",
    "updated_at": "2023-12-11T07:09:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "When we enable new architecture for iOS the first thing that breaks is the `react-native-permissions` library : \r\n\r\n```\r\n[React-RCTFabric] Building library libReact-RCTFabric.a\r\n⚠️  /Users/siddarthkumar/code/experiments/status-mobile/ios/Pods/Pods.xcodeproj: The iOS Simulator deployment target 'IPHONEOS_DEPLOYMENT_TARGET' is set to 11.0, but the range of supported deployment target versions is 12.0 to 17.0.99. (in target 'RNPermissions' from project 'Pods')\r\nWriteAuxiliaryFile /Users/siddarthkumar/Library/Developer/Xcode/DerivedData/StatusIm-fxiitjbbybrcsqcxqartjfyvqxdo/Build/Intermediates.noindex/Pods.build/Debug-iphonesimulator/RNPermissions.build/RNPermissions-project-headers.hmap (in target 'RNPermissions' from project 'Pods')\r\n    cd /Users/siddarthkumar/code/experiments/status-mobile/ios/Pods\r\n[RNPermissions] Compiling RNPermissions-dummy.m\r\n[RNPermissions] Compiling RNPermissionsModule.mm\r\n❌ /Users/siddarthkumar/code/experiments/status-mobile/ios/Pods/Headers/Public/RCTTypeSafety/RCTTypeSafety/RCTConvertHelpers.h:46:53: 'value' is unavailable: introduced in iOS 12.0\r\n  return vec.has_value() ? RCTConvertVecToArray(vec.value(), convertor) : nil;\r\n                                                    ^\r\n[RNPermissions] Compiling RNPermissionsHelper.m\r\n[RNPermissions] Compiling RNPermissionsModule.mm\r\n❌ /Users/siddarthkumar/code/experiments/status-mobile/ios/Pods/Headers/Public/RCTTypeSafety/RCTTypeSafety/RCTConvertHelpers.h:46:53: 'value' is unavailable: introduced in iOS 12.0\r\n  return vec.has_value() ? RCTConvertVecToArray(vec.value(), convertor) : nil;\r\n                                                    ^\r\n[RNPermissions] Compiling RNPermissionsHelper.m\r\n```\r\n\r\nseems like https://github.com/zoontek/react-native-permissions/releases/tag/4.0.0 release has a fix for this.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1849434644/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1849447189",
    "html_url": "https://github.com/status-im/status-mobile/issues/18138#issuecomment-1849447189",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138",
    "id": 1849447189,
    "node_id": "IC_kwDOAx4p2c5uPFMV",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-11T07:11:13Z",
    "updated_at": "2023-12-11T07:22:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "When we enable new architecture for Android the first thing that breaks is the `react-native-gesture-handler` library : \r\n\r\n```\r\nFAILURE: Build failed with an exception.\r\n\r\n* Where:\r\nBuild file '/Users/siddarthkumar/code/experiments/status-mobile/node_modules/react-native-gesture-handler/android/build.gradle' line: 197\r\n\r\n* What went wrong:\r\nA problem occurred evaluating project ':react-native-gesture-handler'.\r\n> Project with path ':ReactAndroid' could not be found in project ':react-native-gesture-handler'.\r\n\r\n* Try:\r\n> Run with --stacktrace option to get the stack trace.\r\n> Run with --info or --debug option to get more log output.\r\n> Run with --scan to get full insights.\r\n\r\n* Get more help at https://help.gradle.org\r\n\r\nBUILD FAILED in 42s\r\nerror Failed to install the app.\r\nmake: *** [run-android] Error 1\r\n```\r\nseems like https://github.com/software-mansion/react-native-gesture-handler/releases/tag/2.12.0 has support for new architecture.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1849447189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1849506809",
    "html_url": "https://github.com/status-im/status-mobile/issues/18138#issuecomment-1849506809",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138",
    "id": 1849506809,
    "node_id": "IC_kwDOAx4p2c5uPTv5",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-11T08:01:22Z",
    "updated_at": "2023-12-11T08:03:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "update : `react-native-gesture-handler` error went away after upgrading that library to 2.12.0\r\n\r\nThe next thing to break is `react-native-camera-roll`\r\nwith the following message\r\n\r\n```\r\n> Task :react-native-camera-kit:compileDebugKotlin\r\n'compileDebugJavaWithJavac' task (current target is 11) and 'compileDebugKotlin' task (current target is 1.8) jvm target compatibility should be set to the same Java version.\r\n\r\n> Task :react-native-camera-roll_camera-roll:compileDebugJavaWithJavac FAILED\r\n```\r\nand \r\n\r\n```\r\nNote: Recompile with -Xlint:deprecation for details.\r\n/Users/siddarthkumar/code/experiments/status-mobile/node_modules/@react-native-camera-roll/camera-roll/android/src/main/java/com/reactnativecommunity/cameraroll/CameraRollModule.java:67: error: CameraRollModule is not abstract and does not override abstract method getPhotoThumbnail(String,ReadableMap,Promise) in NativeCameraRollModuleSpec\r\npublic class CameraRollModule extends NativeCameraRollModuleSpec {\r\n       ^\r\nNote: /Users/siddarthkumar/code/experiments/status-mobile/node_modules/@react-native-camera-roll/camera-roll/android/src/main/java/com/reactnativecommunity/cameraroll/CameraRollModule.java uses or overrides a deprecated API.\r\nNote: Recompile with -Xlint:deprecation for details.\r\nNote: /Users/siddarthkumar/code/experiments/status-mobile/node_modules/@react-native-camera-roll/camera-roll/android/src/main/java/com/reactnativecommunity/cameraroll/CameraRollPackage.java uses unchecked or unsafe operations.\r\nNote: Recompile with -Xlint:unchecked for details.\r\n1 error\r\n\r\nFAILURE: Build failed with an exception.\r\n\r\n* What went wrong:\r\nExecution failed for task ':react-native-camera-roll_camera-roll:compileDebugJavaWithJavac'.\r\n> Compilation failed; see the compiler error output for details.\r\n\r\n* Try:\r\n> Run with --stacktrace option to get the stack trace.\r\n> Run with --info or --debug option to get more log output.\r\n> Run with --scan to get full insights.\r\n\r\n* Get more help at https://help.gradle.org\r\n\r\nBUILD FAILED in 1m 26s\r\nerror Failed to install the app.\r\ninfo Run CLI with --verbose flag for more details.\r\nmake: *** [run-android] Error 1\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1849506809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1851799561",
    "html_url": "https://github.com/status-im/status-mobile/issues/18138#issuecomment-1851799561",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/18138",
    "id": 1851799561,
    "node_id": "IC_kwDOAx4p2c5uYDgJ",
    "user": {
      "login": "siddarthkay",
      "id": 64726664,
      "node_id": "MDQ6VXNlcjY0NzI2NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/64726664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siddarthkay",
      "html_url": "https://github.com/siddarthkay",
      "followers_url": "https://api.github.com/users/siddarthkay/followers",
      "following_url": "https://api.github.com/users/siddarthkay/following{/other_user}",
      "gists_url": "https://api.github.com/users/siddarthkay/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siddarthkay/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siddarthkay/subscriptions",
      "organizations_url": "https://api.github.com/users/siddarthkay/orgs",
      "repos_url": "https://api.github.com/users/siddarthkay/repos",
      "events_url": "https://api.github.com/users/siddarthkay/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siddarthkay/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-12T10:52:18Z",
    "updated_at": "2023-12-12T10:52:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "If I just remove the fork of `react-native-camera-roll` and use the library's latest version `7.2.0` I get the builds to work on android, but the onboarding screens crash within a few seconds with this message : \r\n\r\n```\r\nFatal signal 6 (SIGABRT), code -1 (SI_QUEUE) in tid 9378 (.ethereum.debug), pid 9378 (.ethereum.debug)\r\nAbort message: '/Users/siddarthkumar/code/experiments/status-mobile/node_modules/\r\nreact-native-reanimated/Common/cpp/NativeModules/NativeReanimatedModule.cpp:539: \r\nfunction operator(): assertion failed (family.getSurfaceId() == surfaceId_)'\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1851799561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
