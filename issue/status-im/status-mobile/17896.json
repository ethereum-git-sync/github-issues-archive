{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/17896",
  "id": 1991449969,
  "node_id": "I_kwDOAx4p2c52sx1x",
  "number": 17896,
  "title": "Error while storing wallet `raw-balances`",
  "user": {
    "login": "ulisesmac",
    "id": 90291778,
    "node_id": "MDQ6VXNlcjkwMjkxNzc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ulisesmac",
    "html_url": "https://github.com/ulisesmac",
    "followers_url": "https://api.github.com/users/ulisesmac/followers",
    "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
    "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
    "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
    "repos_url": "https://api.github.com/users/ulisesmac/repos",
    "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3990911030,
      "node_id": "LA_kwDOAx4p2c7t4Hg2",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:Mobile%20Bug%20MVP",
      "name": "E:Mobile Bug MVP",
      "color": "B60205",
      "default": false,
      "description": ""
    },
    {
      "id": 4052407486,
      "node_id": "LA_kwDOAx4p2c7xitS-",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/E:Mobile%20Wallet%20MVP",
      "name": "E:Mobile Wallet MVP",
      "color": "69E609",
      "default": false,
      "description": "Design system components, initial research and page wireframes"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "ulisesmac",
    "id": 90291778,
    "node_id": "MDQ6VXNlcjkwMjkxNzc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ulisesmac",
    "html_url": "https://github.com/ulisesmac",
    "followers_url": "https://api.github.com/users/ulisesmac/followers",
    "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
    "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
    "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
    "repos_url": "https://api.github.com/users/ulisesmac/repos",
    "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ulisesmac",
      "id": 90291778,
      "node_id": "MDQ6VXNlcjkwMjkxNzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ulisesmac",
      "html_url": "https://github.com/ulisesmac",
      "followers_url": "https://api.github.com/users/ulisesmac/followers",
      "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
      "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
      "repos_url": "https://api.github.com/users/ulisesmac/repos",
      "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-11-13T20:42:05Z",
  "updated_at": "2023-11-13T21:21:27Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n\r\n## Problem \r\n\r\n~The `utils.number/parse-int` function is returning `0` or the default value given  when we attempt to parse very long numbers, such as wallet `raw-balance` values, e.g. 150 000 SNTs would be represented as `150000000000000000000000`, and:~\r\n\r\n```clojure\r\n(parse-int \"150000000000000000000000\")\r\n;; => 0\r\n```\r\n~The reason is we are checking if the number is an integer using `clojure.core/integer?`, which says no.~\r\n\r\n### Update:\r\n\r\nWhile requesting and storing the `:raw-balance` for the wallet in app-db, `utils.number/parse-int` has been used, that function returns a `0` when the number is too large (e.g. 150 000 SNT, would be `\"150000000000000000000000\"`).\r\n\r\nFor wallet balances, we should always use big number functions (please check the ns `utils.money`).\r\n\r\nThis issue consists of updating the raw-balance stored to properly use big numbers.\r\n\r\n#### Expected behavior\r\n\r\nProperly store the raw balances, test with 150,000 received and other smaller and bigger amounts.\r\n\r\n#### Actual behavior\r\n\r\nIf we receive a big raw balance, the total balance in the account cards in the wallet page report $0.00\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/17896/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809070754",
    "html_url": "https://github.com/status-im/status-mobile/issues/17896#issuecomment-1809070754",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
    "id": 1809070754,
    "node_id": "IC_kwDOAx4p2c5r1Dqi",
    "user": {
      "login": "ulisesmac",
      "id": 90291778,
      "node_id": "MDQ6VXNlcjkwMjkxNzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ulisesmac",
      "html_url": "https://github.com/ulisesmac",
      "followers_url": "https://api.github.com/users/ulisesmac/followers",
      "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
      "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
      "repos_url": "https://api.github.com/users/ulisesmac/repos",
      "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-13T20:42:51Z",
    "updated_at": "2023-11-13T20:42:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ilmotta Maybe you are interested on this.\r\nAn easy solution would be to just use `number?` but I'm wondering why it wasn't the first approach",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809070754/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809073844",
    "html_url": "https://github.com/status-im/status-mobile/issues/17896#issuecomment-1809073844",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
    "id": 1809073844,
    "node_id": "IC_kwDOAx4p2c5r1Ea0",
    "user": {
      "login": "ulisesmac",
      "id": 90291778,
      "node_id": "MDQ6VXNlcjkwMjkxNzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ulisesmac",
      "html_url": "https://github.com/ulisesmac",
      "followers_url": "https://api.github.com/users/ulisesmac/followers",
      "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
      "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
      "repos_url": "https://api.github.com/users/ulisesmac/repos",
      "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-13T20:45:14Z",
    "updated_at": "2023-11-13T20:45:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Interesting and funny that:\r\n```clojure\r\n(number? ##NaN)\r\n;; => true\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809073844/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809098419",
    "html_url": "https://github.com/status-im/status-mobile/issues/17896#issuecomment-1809098419",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
    "id": 1809098419,
    "node_id": "IC_kwDOAx4p2c5r1Kaz",
    "user": {
      "login": "ulisesmac",
      "id": 90291778,
      "node_id": "MDQ6VXNlcjkwMjkxNzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ulisesmac",
      "html_url": "https://github.com/ulisesmac",
      "followers_url": "https://api.github.com/users/ulisesmac/followers",
      "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
      "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
      "repos_url": "https://api.github.com/users/ulisesmac/repos",
      "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-13T20:55:30Z",
    "updated_at": "2023-11-13T20:55:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "And besides the docstring of `NaN?` (https://cljs.github.io/api/cljs.core/NaNQMARK)\r\n\r\n> Returns true if num is NaN, else false\r\n\r\n```clojure\r\n(NaN? ##NaN)\r\n(NaN? \"Hola\")\r\n(NaN? \"0x\")\r\n;; All of them => true\r\n\r\n(NaN? 10)\r\n(NaN? \"0x0\")\r\n(NaN? \"0x1\")\r\n;; All of them => false\r\n```\r\n\r\nMaybe due to the implementation based on JS:\r\n```clojure\r\n(defn ^boolean NaN?\r\n  [val]\r\n  (js/isNaN val))\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809098419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809113050",
    "html_url": "https://github.com/status-im/status-mobile/issues/17896#issuecomment-1809113050",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
    "id": 1809113050,
    "node_id": "IC_kwDOAx4p2c5r1N_a",
    "user": {
      "login": "ilmotta",
      "id": 46027,
      "node_id": "MDQ6VXNlcjQ2MDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/46027?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ilmotta",
      "html_url": "https://github.com/ilmotta",
      "followers_url": "https://api.github.com/users/ilmotta/followers",
      "following_url": "https://api.github.com/users/ilmotta/following{/other_user}",
      "gists_url": "https://api.github.com/users/ilmotta/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ilmotta/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ilmotta/subscriptions",
      "organizations_url": "https://api.github.com/users/ilmotta/orgs",
      "repos_url": "https://api.github.com/users/ilmotta/repos",
      "events_url": "https://api.github.com/users/ilmotta/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ilmotta/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-13T21:01:18Z",
    "updated_at": "2023-11-13T21:01:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Interesting @ulisesmac! What's going on is that very big numbers can't be represented as integers in the computer without a special big int implementation.\r\n\r\nThe function `utils.number/parse-int` deals only with the max value of 2147483647.\r\n\r\nIn the part of the code dealing with wallet and token values, we should *always* use bignums, which currently live in `utils.money`, otherwise they overflow, etc.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809113050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809117082",
    "html_url": "https://github.com/status-im/status-mobile/issues/17896#issuecomment-1809117082",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
    "id": 1809117082,
    "node_id": "IC_kwDOAx4p2c5r1O-a",
    "user": {
      "login": "ilmotta",
      "id": 46027,
      "node_id": "MDQ6VXNlcjQ2MDI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/46027?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ilmotta",
      "html_url": "https://github.com/ilmotta",
      "followers_url": "https://api.github.com/users/ilmotta/followers",
      "following_url": "https://api.github.com/users/ilmotta/following{/other_user}",
      "gists_url": "https://api.github.com/users/ilmotta/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ilmotta/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ilmotta/subscriptions",
      "organizations_url": "https://api.github.com/users/ilmotta/orgs",
      "repos_url": "https://api.github.com/users/ilmotta/repos",
      "events_url": "https://api.github.com/users/ilmotta/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ilmotta/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-13T21:02:50Z",
    "updated_at": "2023-11-13T21:02:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "The bug to me is in the calling code, which should use proper bignums, not in the function `utils.number/parse-int`, which will never work with large numbers such as the ones we use to represent token values.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809117082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809133935",
    "html_url": "https://github.com/status-im/status-mobile/issues/17896#issuecomment-1809133935",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/17896",
    "id": 1809133935,
    "node_id": "IC_kwDOAx4p2c5r1TFv",
    "user": {
      "login": "ulisesmac",
      "id": 90291778,
      "node_id": "MDQ6VXNlcjkwMjkxNzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/90291778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ulisesmac",
      "html_url": "https://github.com/ulisesmac",
      "followers_url": "https://api.github.com/users/ulisesmac/followers",
      "following_url": "https://api.github.com/users/ulisesmac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ulisesmac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ulisesmac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ulisesmac/subscriptions",
      "organizations_url": "https://api.github.com/users/ulisesmac/orgs",
      "repos_url": "https://api.github.com/users/ulisesmac/repos",
      "events_url": "https://api.github.com/users/ulisesmac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ulisesmac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-13T21:14:54Z",
    "updated_at": "2023-11-13T21:14:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @ilmotta !!!\r\n\r\nI agree, as you said we should use `utils.money/bignumber` when receiving the raw-balances. I'll update the issue to properly solve it",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1809133935/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
