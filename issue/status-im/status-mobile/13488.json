{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/13488",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/13488",
  "id": 1273208474,
  "node_id": "I_kwDOAx4p2c5L456a",
  "number": 13488,
  "title": "`make shell TARGET=ios` failing at `.../status-go-develop-efa1480-ios.drv`",
  "user": {
    "login": "PEZ",
    "id": 30010,
    "node_id": "MDQ6VXNlcjMwMDEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/30010?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PEZ",
    "html_url": "https://github.com/PEZ",
    "followers_url": "https://api.github.com/users/PEZ/followers",
    "following_url": "https://api.github.com/users/PEZ/following{/other_user}",
    "gists_url": "https://api.github.com/users/PEZ/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PEZ/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PEZ/subscriptions",
    "organizations_url": "https://api.github.com/users/PEZ/orgs",
    "repos_url": "https://api.github.com/users/PEZ/repos",
    "events_url": "https://api.github.com/users/PEZ/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PEZ/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-06-16T08:07:56Z",
  "updated_at": "2022-06-20T07:34:18Z",
  "closed_at": "2022-06-20T07:34:17Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Problem\r\n\r\nFollowing the STARTING_GUIDE, running `make shell TARGET=ios` I run up against an error I don't know how to get past. The script stops at:\r\n\r\n```\r\nmkdir -p $WORK/b847/\r\ncat >$WORK/b847/importcfg << 'EOF' # internal\r\n# import config\r\nimportmap zombiezen.com/go/sqlite=github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite\r\nimportmap zombiezen.com/go/sqlite/fs=github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/fs\r\npackagefile context=$WORK/b052/_pkg_.a\r\npackagefile crypto/rand=$WORK/b091/_pkg_.a\r\npackagefile errors=$WORK/b003/_pkg_.a\r\npackagefile fmt=$WORK/b002/_pkg_.a\r\npackagefile io=$WORK/b027/_pkg_.a\r\npackagefile math/big=$WORK/b058/_pkg_.a\r\npackagefile reflect=$WORK/b016/_pkg_.a\r\npackagefile runtime=$WORK/b007/_pkg_.a\r\npackagefile strings=$WORK/b041/_pkg_.a\r\npackagefile sync=$WORK/b022/_pkg_.a\r\npackagefile github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite=$WORK/b820/_pkg_.a\r\npackagefile github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/fs=$WORK/b848/_pkg_.a\r\nEOF\r\n/nix/store/ksvg2i33xd0b6rwhm97l3rjfan797bpy-go-1.17.10/share/go/pkg/tool/darwin_arm64/compile -o $WORK/b847/_pkg_.a -trimpath \"/private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex=>github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex;$WORK/b847=>\" -p github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex -complete -buildid 3htKwtLT2k6YElEMxh0u/3htKwtLT2k6YElEMxh0u -goversion go1.17.10 -importcfg $WORK/b847/importcfg -pack -c=4 /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/exec.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/pool.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/query.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/rand_id.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/savepoint.go\r\n/nix/store/ksvg2i33xd0b6rwhm97l3rjfan797bpy-go-1.17.10/share/go/pkg/tool/darwin_arm64/buildid -w $WORK/b847/_pkg_.a # internal\r\ncp $WORK/b847/_pkg_.a /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go-cache/38/388ae30ce9e78aff6cde7ab79379ac9c2e8dfe6c69cd2561a51a144c0ccf0c3f-d # internal\r\n\r\nerror: builder for '/nix/store/35rfpx6pmrri6zmz6a7sg5jbbfa67a5g-status-go-develop-efa1480-ios.drv' failed with exit code 1;\r\n       last 10 log lines:\r\n       > packagefile runtime=$WORK/b007/_pkg_.a\r\n       > packagefile strings=$WORK/b041/_pkg_.a\r\n       > packagefile sync=$WORK/b022/_pkg_.a\r\n       > packagefile github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite=$WORK/b820/_pkg_.a\r\n       > packagefile github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/fs=$WORK/b848/_pkg_.a\r\n       > EOF\r\n       > /nix/store/ksvg2i33xd0b6rwhm97l3rjfan797bpy-go-1.17.10/share/go/pkg/tool/darwin_arm64/compile -o $WORK/b847/_pkg_.a -trimpath \"/private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex=>github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex;$WORK/b847=>\" -p github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex -complete -buildid 3htKwtLT2k6YElEMxh0u/3htKwtLT2k6YElEMxh0u -goversion go1.17.10 -importcfg $WORK/b847/importcfg -pack -c=4 /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/exec.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/pool.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/query.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/rand_id.go /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go/src/github.com/status-im/status-go/vendor/zombiezen.com/go/sqlite/sqlitex/savepoint.go\r\n       > /nix/store/ksvg2i33xd0b6rwhm97l3rjfan797bpy-go-1.17.10/share/go/pkg/tool/darwin_arm64/buildid -w $WORK/b847/_pkg_.a # internal\r\n       > cp $WORK/b847/_pkg_.a /private/tmp/nix-build-status-go-develop-efa1480-ios.drv-0/go-cache/38/388ae30ce9e78aff6cde7ab79379ac9c2e8dfe6c69cd2561a51a144c0ccf0c3f-d # internal\r\n       >\r\n       For full logs, run 'nix log /nix/store/35rfpx6pmrri6zmz6a7sg5jbbfa67a5g-status-go-develop-efa1480-ios.drv'.\r\nmake: *** [shell] Error 1\r\n```\r\n\r\nI'm on an Macbook Pro M1.\r\n\r\nI'm new to both Nix and Go.\r\n\r\nTrying to get the full logs I get:\r\n\r\n```\r\nnix log /nix/store/35rfpx6pmrri6zmz6a7sg5jbbfa67a5g-status-go-develop-efa1480-ios.drv\r\nerror: experimental Nix feature 'nix-command' is disabled; use '--extra-experimental-features nix-command' to override\r\n```\r\n\r\nNot believing `nix log` would be an extra-experimental feature, I still tried to use that option, without success.\r\n\r\nAnyone have some idea what I could try now? Thanks in advance! üôè \r\n",
  "closed_by": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/13488/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1157399898",
    "html_url": "https://github.com/status-im/status-mobile/issues/13488#issuecomment-1157399898",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488",
    "id": 1157399898,
    "node_id": "IC_kwDOAx4p2c5E_IVa",
    "user": {
      "login": "PEZ",
      "id": 30010,
      "node_id": "MDQ6VXNlcjMwMDEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/30010?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PEZ",
      "html_url": "https://github.com/PEZ",
      "followers_url": "https://api.github.com/users/PEZ/followers",
      "following_url": "https://api.github.com/users/PEZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/PEZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PEZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PEZ/subscriptions",
      "organizations_url": "https://api.github.com/users/PEZ/orgs",
      "repos_url": "https://api.github.com/users/PEZ/repos",
      "events_url": "https://api.github.com/users/PEZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PEZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T08:46:56Z",
    "updated_at": "2022-06-16T08:46:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Possibly related issues:\r\n\r\n* https://github.com/status-im/status-react/issues/12798\r\n* https://github.com/status-im/status-react/issues/12794\r\n\r\nI ran into #12794 trying to build for Android instead",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1157399898/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1157404037",
    "html_url": "https://github.com/status-im/status-mobile/issues/13488#issuecomment-1157404037",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488",
    "id": 1157404037,
    "node_id": "IC_kwDOAx4p2c5E_JWF",
    "user": {
      "login": "PEZ",
      "id": 30010,
      "node_id": "MDQ6VXNlcjMwMDEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/30010?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PEZ",
      "html_url": "https://github.com/PEZ",
      "followers_url": "https://api.github.com/users/PEZ/followers",
      "following_url": "https://api.github.com/users/PEZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/PEZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PEZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PEZ/subscriptions",
      "organizations_url": "https://api.github.com/users/PEZ/orgs",
      "repos_url": "https://api.github.com/users/PEZ/repos",
      "events_url": "https://api.github.com/users/PEZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PEZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T08:51:15Z",
    "updated_at": "2022-06-16T08:51:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "So, in #12794 I also found a workaround that makes me able to build the shell:\r\n\r\n```\r\narch -x86_64 make shell TARGET=ios\r\n```\r\n\r\nSo now I have the app running in the iOS Simulator. üéâ Except for this M1 stumble block, it was super smooth.\r\n\r\nMaybe I should close the issue, but I'll leave it open for now, because maybe there is something that can be done to make it easier to find the workaround, until the issue is fixed? Also, it seems @jakubgs made some changes that should shield iOS builds from the limitation, and I still ran in to it. (And maybe I am misunderstanding the fixes.)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1157404037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1160081534",
    "html_url": "https://github.com/status-im/status-mobile/issues/13488#issuecomment-1160081534",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/13488",
    "id": 1160081534,
    "node_id": "IC_kwDOAx4p2c5FJXB-",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-20T07:34:17Z",
    "updated_at": "2022-06-20T07:34:17Z",
    "author_association": "MEMBER",
    "body": "The `nix` binary is a new interface for multiple older commands like `nix-build` or `nix-store`, and it is not stable yet. And it can indeed by enabled by specifying `nix-command` for `extra-experimental-features` config in `/etc/nix/nix.conf`.\r\n\r\nThe specific `status-go` build failure is a random failure that is known, but I have not yet been able to reproduce it effectively:\r\n\r\n* https://github.com/status-im/status-react/issues/13346",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/1160081534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
