{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/3853",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/3853",
  "id": 313775300,
  "node_id": "MDU6SXNzdWUzMTM3NzUzMDA=",
  "number": 3853,
  "title": "Can't receive offline inbox messages until re-login to account",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 613726715,
      "node_id": "MDU6TGFiZWw2MTM3MjY3MTU=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/Tested%20-%20Issues",
      "name": "Tested - Issues",
      "color": "d93f0b",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "yenda",
    "id": 1181225,
    "node_id": "MDQ6VXNlcjExODEyMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1181225?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yenda",
    "html_url": "https://github.com/yenda",
    "followers_url": "https://api.github.com/users/yenda/followers",
    "following_url": "https://api.github.com/users/yenda/following{/other_user}",
    "gists_url": "https://api.github.com/users/yenda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yenda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yenda/subscriptions",
    "organizations_url": "https://api.github.com/users/yenda/orgs",
    "repos_url": "https://api.github.com/users/yenda/repos",
    "events_url": "https://api.github.com/users/yenda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yenda/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "yenda",
      "id": 1181225,
      "node_id": "MDQ6VXNlcjExODEyMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1181225?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yenda",
      "html_url": "https://github.com/yenda",
      "followers_url": "https://api.github.com/users/yenda/followers",
      "following_url": "https://api.github.com/users/yenda/following{/other_user}",
      "gists_url": "https://api.github.com/users/yenda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yenda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yenda/subscriptions",
      "organizations_url": "https://api.github.com/users/yenda/orgs",
      "repos_url": "https://api.github.com/users/yenda/repos",
      "events_url": "https://api.github.com/users/yenda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yenda/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-04-12T15:23:08Z",
  "updated_at": "2018-05-03T20:41:15Z",
  "closed_at": "2018-05-03T20:41:15Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "*Type*: Bug\r\n*Summary*: Messages sent to contact which is offline - are not received after contact appears online. However, after re-login to account - sometimes not from the first try, - but offline messages received and in the appropriate order.\r\n**Note:** It was confirmed that offline messages are received (after several account re-logins) while both contacts on Mainnet with upstream RPC and Ropsten with upstream RPC.\r\n\r\n#### Expected behavior\r\nMessages are received from an offline inbox after contact appears online \r\n\r\n#### Actual behavior\r\nMessages are not received from an offline inbox after contact appears online \r\n\r\n### Reproduction\r\n1) Install fresh develop build on Device 1 and Device 2\r\n2) Create Contact1 and Contact2 respectively\r\n3) Both contacts are online and exchanged a text messages\r\n4) Contact2 enables airplane mode on device\r\n5) Contact1 sends 10 text messages to Contact2\r\n6) Contact2 disables airplane mode and stays on Home/1-1chat screen for 5+ minutes\r\n**Actual result:** No messages received.\r\n\r\n7) Contact2 re-logins to the account (or stops and starts the app)\r\n**Actual result:** Messages are received from offline inbox. **Note:** It may require repeating several times this step as not always it works.\r\n\r\n### Additional Information\r\n* Status version: Develop nightly build (336th in Jenkins)\r\n* Operating System: Android and iOS\r\n\r\n#### Logs\r\n\r\nFrom TF session https://app.testfairy.com/projects/4803622-status/builds/8092250/sessions/36/?accessToken=d6n--lIHkdqqi2Qo-9-ovwyxejc\r\nnoticed in logs:\r\n```00:55 I/ReactNativeJS: INFO [status-im.transport.inbox:154] - Peer enode://fa63a6cc730468c5456eab365b2a7a68a166845423c8c9acc363e5f8c4699ff6d954e7ec58f13ae49568600cff9899561b54f6fc2b9923136cd7104911f31cce@163.172.168.202:30303 is not registered. Retrying fetch peers.\r\n00:55 E/ReactNativeJS: ERROR [status-im.transport.inbox:157] - Could not connect to mailserver\r\n00:55 E/unknown:ReactNative: console.error: \"ERROR [status-im.transport.inbox:157] - Could not connect to mailserver\", stack:\r\ncljs$core$IFn$_invoke$arity$3@12:347932\r\ncljs$core$IFn$_invoke$arity$2@12:347729\r\ncljs$core$IFn$_invoke$arity$2@12:353001\r\nc@12:5508618\r\nr@12:5508800\r\n<unknown>@12:3240368\r\n<unknown>@12:3259703\r\ncljs$core$IKVReduce$_kv_reduce$arity$3@12:545631\r\n_kv_reduce@12:158196\r\nreduce_kv@12:268208\r\ncljs$core$IFn$_invoke$arity$10@12:3257009\r\n<unknown>@12:6012645\r\n<unknown>@12:3950520\r\ninvoke_interceptor_fn@12:3878457\r\ninvoke_interceptors@12:3878758\r\nexecute@12:3880455\r\nhandle@12:3890180\r\nre_frame$router$IEventQueue$_process_1st_event_in_queue$arity$1@12:3924913\r\nre_frame$router$IEventQueue$_run_queue$arity$1@12:3905649\r\n<unknown>@12:3911401\r\nre_frame$router$IEventQueue$_fsm_trigger$arity$3@12:3915612\r\n<unknown>@12:3908167\r\n<unknown>@32:1369\r\nx@32:643\r\ncallTimers@32:2788\r\nvalue@27:3582\r\n<unknown>@27:1067\r\nvalue@27:3009\r\nvalue@27:1039\r\n02:27 D/ViewRootImpl: ViewPostImeInputStage ```\r\n\r\n<blockquote><div><strong><a href=\"https://app.testfairy.com/projects/4803622-status/builds/8092250/sessions/36/?accessToken=d6n--lIHkdqqi2Qo-9-ovwyxejc\">TestFairy: Status 0.9.10-869-g7148734e+ (2426) @36</a></strong></div></blockquote>",
  "closed_by": {
    "login": "yenda",
    "id": 1181225,
    "node_id": "MDQ6VXNlcjExODEyMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1181225?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yenda",
    "html_url": "https://github.com/yenda",
    "followers_url": "https://api.github.com/users/yenda/followers",
    "following_url": "https://api.github.com/users/yenda/following{/other_user}",
    "gists_url": "https://api.github.com/users/yenda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yenda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yenda/subscriptions",
    "organizations_url": "https://api.github.com/users/yenda/orgs",
    "repos_url": "https://api.github.com/users/yenda/repos",
    "events_url": "https://api.github.com/users/yenda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yenda/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/3853/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380877474",
    "html_url": "https://github.com/status-im/status-mobile/issues/3853#issuecomment-380877474",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853",
    "id": 380877474,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDg3NzQ3NA==",
    "user": {
      "login": "yenda",
      "id": 1181225,
      "node_id": "MDQ6VXNlcjExODEyMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1181225?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yenda",
      "html_url": "https://github.com/yenda",
      "followers_url": "https://api.github.com/users/yenda/followers",
      "following_url": "https://api.github.com/users/yenda/following{/other_user}",
      "gists_url": "https://api.github.com/users/yenda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yenda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yenda/subscriptions",
      "organizations_url": "https://api.github.com/users/yenda/orgs",
      "repos_url": "https://api.github.com/users/yenda/repos",
      "events_url": "https://api.github.com/users/yenda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yenda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T17:06:24Z",
    "updated_at": "2018-04-12T17:06:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "So in some cases messages are received by offline inbox ? It is a bit surprising because it seems that the mailservers in the config are ropsten mailservers and not mainnet so you should never receive any offline message",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380877474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380885506",
    "html_url": "https://github.com/status-im/status-mobile/issues/3853#issuecomment-380885506",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853",
    "id": 380885506,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDg4NTUwNg==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T17:34:42Z",
    "updated_at": "2018-04-12T17:34:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Correct. Offline messages received (after tricks with re-login / stop-starting and app) in both cases: When contacts are on Mainnet with upstream RPC or Ropsten with upstream RPC. \r\nUpdated description with this note.\r\nTF session for offline inbox message receiving while contact is on the Mainnet RPC: https://app.testfairy.com/projects/4803622-status/builds/8092250/sessions/43/?accessToken=bVdRPEP8cp-R5hX308SwIyKh1oA\n\n<blockquote><div><strong><a href=\"https://app.testfairy.com/projects/4803622-status/builds/8092250/sessions/43/?accessToken=bVdRPEP8cp-R5hX308SwIyKh1oA\">TestFairy: Status 0.9.10-869-g7148734e+ (2426) @43</a></strong></div></blockquote>",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/380885506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/383062174",
    "html_url": "https://github.com/status-im/status-mobile/issues/3853#issuecomment-383062174",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853",
    "id": 383062174,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzA2MjE3NA==",
    "user": {
      "login": "asemiankevich",
      "id": 28752642,
      "node_id": "MDQ6VXNlcjI4NzUyNjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/28752642?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asemiankevich",
      "html_url": "https://github.com/asemiankevich",
      "followers_url": "https://api.github.com/users/asemiankevich/followers",
      "following_url": "https://api.github.com/users/asemiankevich/following{/other_user}",
      "gists_url": "https://api.github.com/users/asemiankevich/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asemiankevich/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asemiankevich/subscriptions",
      "organizations_url": "https://api.github.com/users/asemiankevich/orgs",
      "repos_url": "https://api.github.com/users/asemiankevich/repos",
      "events_url": "https://api.github.com/users/asemiankevich/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asemiankevich/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-20T11:01:16Z",
    "updated_at": "2018-04-20T11:08:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "i am receiving this\r\n![image](https://user-images.githubusercontent.com/28752642/39047633-3e0545f0-44a3-11e8-8d96-c97879f09c5a.png)\r\nand i am able to receive messages @yenda . Is it something we can improve\r\n\r\ni also noticed some time lag when receiving messages from offline, it is quite annoying",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/383062174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/383080900",
    "html_url": "https://github.com/status-im/status-mobile/issues/3853#issuecomment-383080900",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/3853",
    "id": 383080900,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzA4MDkwMA==",
    "user": {
      "login": "yenda",
      "id": 1181225,
      "node_id": "MDQ6VXNlcjExODEyMjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1181225?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yenda",
      "html_url": "https://github.com/yenda",
      "followers_url": "https://api.github.com/users/yenda/followers",
      "following_url": "https://api.github.com/users/yenda/following{/other_user}",
      "gists_url": "https://api.github.com/users/yenda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yenda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yenda/subscriptions",
      "organizations_url": "https://api.github.com/users/yenda/orgs",
      "repos_url": "https://api.github.com/users/yenda/repos",
      "events_url": "https://api.github.com/users/yenda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yenda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-20T12:31:19Z",
    "updated_at": "2018-04-20T12:31:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's probably because mailserver is saturated. Regarding lag it can be improved by only fetching messages since last time it was done, I'll look into this next week",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/383080900/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
