{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/7933",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/7933",
  "id": 430449150,
  "node_id": "MDU6SXNzdWU0MzA0NDkxNTA=",
  "number": 7933,
  "title": "joining public chat with messages throws error",
  "user": {
    "login": "bitsikka",
    "id": 42058840,
    "node_id": "MDQ6VXNlcjQyMDU4ODQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/42058840?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bitsikka",
    "html_url": "https://github.com/bitsikka",
    "followers_url": "https://api.github.com/users/bitsikka/followers",
    "following_url": "https://api.github.com/users/bitsikka/following{/other_user}",
    "gists_url": "https://api.github.com/users/bitsikka/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bitsikka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bitsikka/subscriptions",
    "organizations_url": "https://api.github.com/users/bitsikka/orgs",
    "repos_url": "https://api.github.com/users/bitsikka/repos",
    "events_url": "https://api.github.com/users/bitsikka/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bitsikka/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-04-08T13:23:24Z",
  "updated_at": "2019-04-19T10:02:08Z",
  "closed_at": "2019-04-19T10:02:08Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Problem\r\n\r\nWhen joining new busy public chat that is sure to have offline messages being fetched from mail-server(not empty after joining), following error is thrown:\r\n\r\n```\r\nconsole.error: \"re-frame: no handler registered for effect:\", {\"ns\":null,\"name\":\"wallet-selected-asset\",\"fqn\":\"wallet-selected-asset\",\"_hash\":-157625120,\"cljs$lang$protocol_mask$partition0$\":2153775105,\"cljs$lang$protocol_mask$partition1$\":4096}, \". Ignoring.\"\r\nerror\r\n    \r\n_callTimer\r\n    RefreshControl.js:178:8\r\ncallTimers\r\n    StatusBar.js:320:6\r\n__callFunction\r\n    \r\n<unknown>\r\n    FS.common.js:276:13\r\n__guard\r\n    FS.common.js:481:6\r\ncallFunctionReturnFlushedQueue\r\n    FS.common.js:275:11\r\n```\r\n\r\n# Implementation\r\n\r\nA bug was introduced in #7454 whereby part of event handler behind event `:message/add` is returning db instead of cofx\r\n\r\nfix by returning cofx\r\n\r\nPR with fix coming up",
  "closed_by": {
    "login": "rasom",
    "id": 2364994,
    "node_id": "MDQ6VXNlcjIzNjQ5OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2364994?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rasom",
    "html_url": "https://github.com/rasom",
    "followers_url": "https://api.github.com/users/rasom/followers",
    "following_url": "https://api.github.com/users/rasom/following{/other_user}",
    "gists_url": "https://api.github.com/users/rasom/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rasom/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rasom/subscriptions",
    "organizations_url": "https://api.github.com/users/rasom/orgs",
    "repos_url": "https://api.github.com/users/rasom/repos",
    "events_url": "https://api.github.com/users/rasom/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rasom/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/7933/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/480833732",
    "html_url": "https://github.com/status-im/status-mobile/issues/7933#issuecomment-480833732",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933",
    "id": 480833732,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDgzMzczMg==",
    "user": {
      "login": "churik",
      "id": 4557972,
      "node_id": "MDQ6VXNlcjQ1NTc5NzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4557972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/churik",
      "html_url": "https://github.com/churik",
      "followers_url": "https://api.github.com/users/churik/followers",
      "following_url": "https://api.github.com/users/churik/following{/other_user}",
      "gists_url": "https://api.github.com/users/churik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/churik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/churik/subscriptions",
      "organizations_url": "https://api.github.com/users/churik/orgs",
      "repos_url": "https://api.github.com/users/churik/repos",
      "events_url": "https://api.github.com/users/churik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/churik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-08T13:34:10Z",
    "updated_at": "2019-04-08T13:34:10Z",
    "author_association": "MEMBER",
    "body": "@bitsikka I didn't face this error when joining #status (which is most of the busy chats as I know).\r\nAny clues how it can be reproducible and what it depends on (i.e. the number of messages, a message with some content, etc)?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/480833732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/480854320",
    "html_url": "https://github.com/status-im/status-mobile/issues/7933#issuecomment-480854320",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933",
    "id": 480854320,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDg1NDMyMA==",
    "user": {
      "login": "bitsikka",
      "id": 42058840,
      "node_id": "MDQ6VXNlcjQyMDU4ODQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/42058840?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bitsikka",
      "html_url": "https://github.com/bitsikka",
      "followers_url": "https://api.github.com/users/bitsikka/followers",
      "following_url": "https://api.github.com/users/bitsikka/following{/other_user}",
      "gists_url": "https://api.github.com/users/bitsikka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bitsikka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bitsikka/subscriptions",
      "organizations_url": "https://api.github.com/users/bitsikka/orgs",
      "repos_url": "https://api.github.com/users/bitsikka/repos",
      "events_url": "https://api.github.com/users/bitsikka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bitsikka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-08T14:26:25Z",
    "updated_at": "2019-04-08T14:26:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "@churik it should be any public chat with any number or kind of messages - or basically, it has to be not empty upon joining\r\n\r\nNot sure why you are not getting the error but it may be due to few reasons\r\n- I'm encountering the errors in development build where errors of this type manifests in UI\r\n- It is possible I have perhaps slower connection than yours\r\n- perhaps in your case the errors are in the log, but not shown on the UI\r\n\r\nThe reason I'm suspecting those may be the cause is because one of the logic behind #7454 fix is (in general) that, it checks if the sync with mailserver(or otherwise) completed *twice*:\r\n- once when mailserver tells the client that request is completed(but messages may not have arrived yet)\r\n- once again (for redundancy of when the messages actually arrive and added; and also to account for messages received via peers at join time(i.e. messages not from mailserver)\r\n\r\nwith those checks it transitions the app state to essentially *synced* which is then used to determine what state of intro screens to show.\r\n\r\nerror happens in the second(redundency) case, which if the connection is fast, could be skipped.\r\n\r\nalso incidentally the error for this resemble errors in log for #7917 - therefore the earlier confusion",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/480854320/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/480857832",
    "html_url": "https://github.com/status-im/status-mobile/issues/7933#issuecomment-480857832",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/7933",
    "id": 480857832,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDg1NzgzMg==",
    "user": {
      "login": "churik",
      "id": 4557972,
      "node_id": "MDQ6VXNlcjQ1NTc5NzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4557972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/churik",
      "html_url": "https://github.com/churik",
      "followers_url": "https://api.github.com/users/churik/followers",
      "following_url": "https://api.github.com/users/churik/following{/other_user}",
      "gists_url": "https://api.github.com/users/churik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/churik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/churik/subscriptions",
      "organizations_url": "https://api.github.com/users/churik/orgs",
      "repos_url": "https://api.github.com/users/churik/repos",
      "events_url": "https://api.github.com/users/churik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/churik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-08T14:34:39Z",
    "updated_at": "2019-04-08T14:34:39Z",
    "author_association": "MEMBER",
    "body": "@bitsikka you are right, it is not shown in UI. Found this error in logs after joining chat.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/480857832/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
