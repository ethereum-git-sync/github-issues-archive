{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/8757",
  "id": 480969110,
  "node_id": "MDU6SXNzdWU0ODA5NjkxMTA=",
  "number": 8757,
  "title": "[nix] Android builds failing due to \"still alive\" error",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1311328202,
      "node_id": "MDU6TGFiZWwxMzExMzI4MjAy",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/nix",
      "name": "nix",
      "color": "0052cc",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2019-08-15T02:41:34Z",
  "updated_at": "2020-04-29T19:35:28Z",
  "closed_at": "2019-08-22T15:49:26Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Currently Android builds randomly fail due to some form of race condition resulting in this error:\n```\nfinding garbage collector roots...\nremoving stale temporary roots file '/nix/var/nix/temproots/29792'\nremoving stale temporary roots file '/nix/var/nix/temproots/29812'\nerror: cannot delete path \\\n  '/nix/store/0w5f4dk7zcsylq426yq8yj32y6s8lbzj-status-react-source-gradle-install' \\\n  since it is still alive\nmake: *** [Makefile:158: jsbundle-android] Error 1\n```\nhttps://ci.status.im/job/status-react/job/prs/job/android/view/change-requests/job/PR-8713/2/",
  "closed_by": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/8757/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/521493991",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-521493991",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 521493991,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMTQ5Mzk5MQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-15T02:47:36Z",
    "updated_at": "2019-08-15T02:47:36Z",
    "author_association": "MEMBER",
    "body": "Related Nix issue: https://github.com/NixOS/nix/issues/1810\r\nWhich would have added more info about why exactly the Nix store entry is \"alive\", but there hasn't been any activity there in almost a year.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/521493991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/521494247",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-521494247",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 521494247,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMTQ5NDI0Nw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-15T02:49:11Z",
    "updated_at": "2019-08-15T02:49:11Z",
    "author_association": "MEMBER",
    "body": "I checked manual for `nix-build` to see if I could disable garbage collection after build - since we run `nix/clean.sh` afterwards anyway - but couldn't find anything useful in that regard.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/521494247/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/522680187",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-522680187",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 522680187,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMjY4MDE4Nw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-19T17:39:09Z",
    "updated_at": "2019-08-19T17:39:09Z",
    "author_association": "MEMBER",
    "body": "One idea I have is to switch CI hosts to a multi-user Nix installation:\r\nhttps://nixos.org/nix/manual/#sect-multi-user-installation\r\nWorth a try.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/522680187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/522776158",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-522776158",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 522776158,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMjc3NjE1OA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-19T22:20:35Z",
    "updated_at": "2019-08-19T22:20:35Z",
    "author_association": "MEMBER",
    "body": "I attempted to install Nix in multi-user mode on `linux-04` but I've encountered an issue that the `jenkins` user does not get a profile folder. When sourcing `/etc/profile.d/nix.sh` it creates a symlink from `~/.nix-profile` to `/nix/var/nix/profiles/per-user/jenkins/profile` which does not exist.\r\nI've opened an issue: https://github.com/NixOS/nix/issues/3051",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/522776158/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/522788664",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-522788664",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 522788664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMjc4ODY2NA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-19T23:12:51Z",
    "updated_at": "2019-08-19T23:12:51Z",
    "author_association": "MEMBER",
    "body": "I also upgrade Nix from `2.2.1` to `2.2.2` on all hosts in https://github.com/status-im/infra-ci/commit/4b285d0fb62bc71161f2196ffd89859d53e01216.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/522788664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523021340",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523021340",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523021340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzAyMTM0MA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T13:43:51Z",
    "updated_at": "2019-08-20T13:43:51Z",
    "author_association": "MEMBER",
    "body": "It seems like it is still happening, case in point:\r\nhttps://ci.status.im/job/status-react/job/prs/job/android-e2e/job/PR-8764/14/\r\nPedro showed me this from the manual:\r\n>`--no-out-link`\r\n>Do not create a symlink to the output path. __Note that as a result the output does not become a root of the garbage collector, and so might be deleted by nix-store --gc__.\r\n\r\nNot sure if this is relevant to our case as we do not use `--gc`:\r\nhttps://github.com/status-im/status-react/blob/ab39aa4969eb156d5ce79591f197e24286b14309/nix/build.sh#L33-L39",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523021340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523022201",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523022201",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523022201,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzAyMjIwMQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T13:45:58Z",
    "updated_at": "2019-08-20T13:45:58Z",
    "author_association": "MEMBER",
    "body": "But if you look really close at the log the error isn't actually the result of `nix-build`:\r\nhttps://ci.status.im/blue/organizations/jenkins/status-react%2Fprs%2Fandroid-e2e/detail/PR-8764/14/pipeline\r\nYou can see that the call to `nix/build.sh` happens later:\r\n```\r\n[2019-08-20T08:56:41.202Z] nix/build.sh targets.mobile.jsbundle && \\\r\n```\r\nThe error happens before that. Not sure if that's a log glitch or what. But if it happened earlier, for example in the shell initialization phase, why would `nix/build.sh` be called at all?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523022201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523023755",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523023755",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523023755,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzAyMzc1NQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T13:49:39Z",
    "updated_at": "2019-08-20T13:49:39Z",
    "author_association": "MEMBER",
    "body": "If I run two builds at the same time locally on of the waits with message:\r\n```\r\nthese derivations will be built:\r\n  /nix/store/lm8wzrlwabh5mpkasp3q53yx6isd3670-status-react-build-jsbundle-android.drv\r\nwaiting for locks or build slots...\r\n```\r\nSo there should not be a clash.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523023755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523025290",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523025290",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523025290,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzAyNTI5MA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T13:53:07Z",
    "updated_at": "2019-08-20T13:53:07Z",
    "author_association": "MEMBER",
    "body": "Also, so far I've seen two versions of this error:\r\n```\r\ncannot delete path '/nix/store/{H}-status-react-build-jsbundle-android.drv' since it is still alive\r\n```\r\nAnd:\r\n```\r\ncannot delete path '/nix/store/{H}-status-react-source-gradle-install' since it is still alive\r\n```\r\nWhich is kinda interesting.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523025290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523026220",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523026220",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523026220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzAyNjIyMA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T13:55:08Z",
    "updated_at": "2019-08-20T13:55:08Z",
    "author_association": "MEMBER",
    "body": "I managed to reproduce the error locally by running 2 builds in 2 different folders on the same host, but on different commits. One on `develop`, and another on `bug/8748-fix-setup-with-initialized-keycard`.\r\n![still_alive_error](https://user-images.githubusercontent.com/2212681/63353314-8e9cd480-c330-11e9-9a13-d130107dd11f.png)\r\nWhich shows that the error is indeed some kind of race condition.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523026220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523031500",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523031500",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523031500,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzAzMTUwMA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T14:07:15Z",
    "updated_at": "2019-08-20T14:07:15Z",
    "author_association": "MEMBER",
    "body": "Okay, interesting. When building again on two folders I saw this in one console from `nix/clean.sh`:\r\n```\r\ndeleting '/nix/store/9cmnspsjvxqnpp4z0gmx6bhivqkjxbj1-status-react-source-jsbundle'\r\n```\r\nAnd this from the build in another console:\r\n```\r\nerror: cannot delete path '/nix/store/9cmnspsjvxqnpp4z0gmx6bhivqkjxbj1-status-react-source-jsbundle' since it is still alive\r\n```\r\nMaybe the `nix/clean.sh` needs some kind of lock, or check for ongoing `nix-build` calls.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523031500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523040373",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523040373",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523040373,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzA0MDM3Mw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T14:27:33Z",
    "updated_at": "2019-08-20T14:27:33Z",
    "author_association": "MEMBER",
    "body": "I ran the builds in parallel with this line commented out:\r\nhttps://github.com/status-im/status-react/blob/dcb741520844126582427d855eb784065e800592/nix/build.sh#L13\r\nAnd was no able to reproduce the failure. Which indicates that the issue is not with `nix-build` as I previously thought, but rather with the `nix/clean.sh` script that has stages to it, and can collect paths to remove first and then removes them, which can cause two executions of `nix/clean.sh` to try to remove the same thing.\r\n\r\nWe do use `--ignore-liveness` in `nix/clean.sh`:\r\nhttps://github.com/status-im/status-react/blob/dcb741520844126582427d855eb784065e800592/nix/clean.sh#L60\r\nBut that doesn't seem to fix the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523040373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523168353",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523168353",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523168353,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzE2ODM1Mw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-20T19:50:32Z",
    "updated_at": "2019-08-20T19:50:32Z",
    "author_association": "MEMBER",
    "body": "Potential fix #8788, works locally so should work in CI as well.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523168353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523928740",
    "html_url": "https://github.com/status-im/status-mobile/issues/8757#issuecomment-523928740",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/8757",
    "id": 523928740,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMzkyODc0MA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-22T14:23:58Z",
    "updated_at": "2019-08-22T14:23:58Z",
    "author_association": "MEMBER",
    "body": "I merged #8788 but it seems like the issue is still happening, though less frequently:\r\n```\r\nerror: cannot delete path '/nix/store/qmrraqygl5dxghh35i0l9666j04ahpjm-status-react-build-jsbundle-android.drv' since it is still alive\r\nmake: *** [Makefile:159: jsbundle-android] Error 1\r\n```\r\nhttps://ci.status.im/job/status-react/job/prs/job/android-e2e/job/PR-8811/8/\r\n\r\nSo I just made a PR where we ignore `nix/clean.sh` failures in `nix/build.sh` when in CI: #8817",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/523928740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
