{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/10189",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/10189",
  "id": 584467003,
  "node_id": "MDU6SXNzdWU1ODQ0NjcwMDM=",
  "number": 10189,
  "title": "App crash when closing WebView",
  "user": {
    "login": "Serhy",
    "id": 8749671,
    "node_id": "MDQ6VXNlcjg3NDk2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Serhy",
    "html_url": "https://github.com/Serhy",
    "followers_url": "https://api.github.com/users/Serhy/followers",
    "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
    "organizations_url": "https://api.github.com/users/Serhy/orgs",
    "repos_url": "https://api.github.com/users/Serhy/repos",
    "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Serhy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    },
    {
      "id": 916015974,
      "node_id": "MDU6TGFiZWw5MTYwMTU5NzQ=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/e2e%20test%20blocker",
      "name": "e2e test blocker",
      "color": "bc0753",
      "default": false,
      "description": ""
    },
    {
      "id": 934926722,
      "node_id": "MDU6TGFiZWw5MzQ5MjY3MjI=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/browser",
      "name": "browser",
      "color": "def99f",
      "default": false,
      "description": ""
    },
    {
      "id": 956251551,
      "node_id": "MDU6TGFiZWw5NTYyNTE1NTE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/high-severity",
      "name": "high-severity",
      "color": "c91a34",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-03-19T14:48:24Z",
  "updated_at": "2020-04-30T00:35:03Z",
  "closed_at": "2020-03-24T09:49:06Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Bug Report\n\n## Problem\nApp crashes when WebView is closed via top-left cross icon. \n**NOTE:** In develop builds (nightly 19th March) `...-univeral.apk` it may not crash from the first time but if to open-close up to 20 times the same Dapp it may crash.\n\nHowever with the builds from https://github.com/status-im/status-react/pull/10090 (https://status-im-prs.ams3.digitaloceanspaces.com/StatusIm-200318-154045-e28f8e-pr-universal.apk) on Android 9 it crashes with the same stacktrace in logcat from the very first attempt (just open and close DApp).\nAnd also develop nightly builds `-x86.apk` crashing all the time when autotests are running on emulators. \n\n#### Expected behavior\n\nCan proceed using app after closing webview\n#### Actual behavior\n\nApp crashes and closes.  In logcat: \n\n```\n\n--------- beginning of crash\n03-19 16:22:40.911 15236 15253 F libc    : Fatal signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x20 in tid 15253 (RenderThread), pid 15236 (status.ethereum)\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger: Display 0 HWC layers:\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger:     type    |    handle    | flag |  format   |   source crop (l,t,r,b)    |         frame       | name \n03-19 16:22:40.976  3305  3305 I SurfaceFlinger: ------------+--------------+------+-----------+----------------------------+---------------------+------\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger:      Device | 0x7009546020 | 0082 | RGBA_8888 |   0.0    0.0 1080.0 2220.0 |    0    0 1080 2220 | im.status.ethereum/im.status.ethereum.MainActivity[15236]#1\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger:      Device | 0x7015e536a0 | 0000 | RGBA_8888 |   0.0    0.0 1080.0   72.0 |    0    0 1080   72 | StatusBar[4142]#0\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger:      Device | 0x7015e54580 | 0000 | RGBA_8888 |   0.0    0.0 1080.0  144.0 |    0 2076 1080 2220 | NavigationBar[4142]#0\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger:      Device | 0x7015a4a340 | 0000 | RGBA_8888 |   0.0    0.0   99.0   99.0 |  513  718  612  817 | Sprite#3\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger:      Device | 0x7015a4a180 | 0000 | RGBA_8888 |   0.0    0.0   99.0   99.0 |  554  730  653  829 | Sprite#8\n03-19 16:22:40.976  3305  3305 I SurfaceFlinger: \n03-19 16:22:40.985  3827  3988 D InputReader: Input event(7): value=0 when=39976.242501\n03-19 16:22:40.985  3827  3988 D InputReader: Input event(7): value=0 when=39976.242501\n03-19 16:22:40.985  3827  3988 I InputReader: Touch event's action is 0x1 (deviceType=0) [pCnt=1, s=] when=39976.242501\n03-19 16:22:40.986  3827  3987 I clp-JNI : Add pinfo.  (channel) f8bdfec im.status.ethereum/im.status.ethereum.MainActivity (server) (pkg) AppWindowToken{61411f4 token=Token{31b7c7 ActivityRecord{497d506 u0 im.status.ethereum/.MainActivity t1903}}} 15236 10345 (action) 1\n\n```\n\n\n#### Notes\nhttps://github.com/status-im/status-react/pull/9945 seems the PR introduced that bug\n\n### Reproduction\n\n1) Open Status and create new account\n2) Open Browser -> dap.ps (or any other Dapp or website)\n3) Tap top-left `X` cross icon\nActual result: App crashes with `03-19 14:15:34.466 24256 24272 F libc    : Fatal signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x20 in tid 24272 (RenderThread), pid 24256 (tus.ethereum.pr)\n`\n\n### Additional Information\n- Status version: develop nightly 19th of March\n- Operating System: Android and iOS\n\n#### Logs\n(Full crash log: \n\n[crashNightly11.txt](https://github.com/status-im/status-react/files/4355148/crashNightly11.txt)",
  "closed_by": {
    "login": "siphiuel",
    "id": 1019573,
    "node_id": "MDQ6VXNlcjEwMTk1NzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1019573?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siphiuel",
    "html_url": "https://github.com/siphiuel",
    "followers_url": "https://api.github.com/users/siphiuel/followers",
    "following_url": "https://api.github.com/users/siphiuel/following{/other_user}",
    "gists_url": "https://api.github.com/users/siphiuel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siphiuel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siphiuel/subscriptions",
    "organizations_url": "https://api.github.com/users/siphiuel/orgs",
    "repos_url": "https://api.github.com/users/siphiuel/repos",
    "events_url": "https://api.github.com/users/siphiuel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siphiuel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/10189/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601634057",
    "html_url": "https://github.com/status-im/status-mobile/issues/10189#issuecomment-601634057",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189",
    "id": 601634057,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTYzNDA1Nw==",
    "user": {
      "login": "churik",
      "id": 4557972,
      "node_id": "MDQ6VXNlcjQ1NTc5NzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4557972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/churik",
      "html_url": "https://github.com/churik",
      "followers_url": "https://api.github.com/users/churik/followers",
      "following_url": "https://api.github.com/users/churik/following{/other_user}",
      "gists_url": "https://api.github.com/users/churik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/churik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/churik/subscriptions",
      "organizations_url": "https://api.github.com/users/churik/orgs",
      "repos_url": "https://api.github.com/users/churik/repos",
      "events_url": "https://api.github.com/users/churik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/churik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T10:40:35Z",
    "updated_at": "2020-03-20T10:40:35Z",
    "author_association": "MEMBER",
    "body": "сс @rachelhamlin ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601634057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601677258",
    "html_url": "https://github.com/status-im/status-mobile/issues/10189#issuecomment-601677258",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189",
    "id": 601677258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTY3NzI1OA==",
    "user": {
      "login": "siphiuel",
      "id": 1019573,
      "node_id": "MDQ6VXNlcjEwMTk1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1019573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siphiuel",
      "html_url": "https://github.com/siphiuel",
      "followers_url": "https://api.github.com/users/siphiuel/followers",
      "following_url": "https://api.github.com/users/siphiuel/following{/other_user}",
      "gists_url": "https://api.github.com/users/siphiuel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siphiuel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siphiuel/subscriptions",
      "organizations_url": "https://api.github.com/users/siphiuel/orgs",
      "repos_url": "https://api.github.com/users/siphiuel/repos",
      "events_url": "https://api.github.com/users/siphiuel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siphiuel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T12:34:06Z",
    "updated_at": "2020-03-20T12:34:06Z",
    "author_association": "MEMBER",
    "body": "Seems that `react-native-screens` is the cause. It has been introduced in https://github.com/status-im/status-react/pull/10176. \r\n\r\nAdded some more detail [here](https://github.com/status-im/status-react/pull/10090#issuecomment-601675870).",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601677258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601735469",
    "html_url": "https://github.com/status-im/status-mobile/issues/10189#issuecomment-601735469",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189",
    "id": 601735469,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTczNTQ2OQ==",
    "user": {
      "login": "Ferossgp",
      "id": 5794620,
      "node_id": "MDQ6VXNlcjU3OTQ2MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5794620?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ferossgp",
      "html_url": "https://github.com/Ferossgp",
      "followers_url": "https://api.github.com/users/Ferossgp/followers",
      "following_url": "https://api.github.com/users/Ferossgp/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ferossgp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ferossgp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ferossgp/subscriptions",
      "organizations_url": "https://api.github.com/users/Ferossgp/orgs",
      "repos_url": "https://api.github.com/users/Ferossgp/repos",
      "events_url": "https://api.github.com/users/Ferossgp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ferossgp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T14:41:32Z",
    "updated_at": "2020-03-20T14:41:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually the problem is not in `react-native-screens` but it became visible with it. When the screen is removed from stack the lib clears the screen from memory, and if some functions are called on non-existing components they will crash. I've debugged that bug, and the reason for the crash in develop is that `sendToBridge` is called when the component is unmounted and there are stale animation listeners. IMO better to fix that memory leak than remove the lib. The memory leak came from the reference which is stored in re-frame. When the reference is extracted from DB, and in DB we remove it (as a callback from the component) - we still have the value passed into functions and the check before `sendToBridge` is true (cause the ref is not null) but the ref points to an already unexisting component.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601735469/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601792322",
    "html_url": "https://github.com/status-im/status-mobile/issues/10189#issuecomment-601792322",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/10189",
    "id": 601792322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTc5MjMyMg==",
    "user": {
      "login": "Serhy",
      "id": 8749671,
      "node_id": "MDQ6VXNlcjg3NDk2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8749671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Serhy",
      "html_url": "https://github.com/Serhy",
      "followers_url": "https://api.github.com/users/Serhy/followers",
      "following_url": "https://api.github.com/users/Serhy/following{/other_user}",
      "gists_url": "https://api.github.com/users/Serhy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Serhy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Serhy/subscriptions",
      "organizations_url": "https://api.github.com/users/Serhy/orgs",
      "repos_url": "https://api.github.com/users/Serhy/repos",
      "events_url": "https://api.github.com/users/Serhy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Serhy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T16:29:07Z",
    "updated_at": "2020-03-20T16:29:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've got when it reproduced (in develop) 100% on Android 9 / 10\r\nIt happens when cursor is in the URL input while user closes WebView. So to reproduce:\r\n1) Open Status and navigate to Browser\r\n2) Open dap.ps\r\n3) Put cursor in URL input (keyboard appears)\r\n4) Tap `X` closing webview button",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/601792322/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
