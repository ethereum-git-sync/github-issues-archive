{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/191",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/191/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/191/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/191/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/191",
  "id": 171960486,
  "node_id": "MDU6SXNzdWUxNzE5NjA0ODY=",
  "number": 191,
  "title": "Delivery of the messages",
  "user": {
    "login": "rasom",
    "id": 2364994,
    "node_id": "MDQ6VXNlcjIzNjQ5OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2364994?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rasom",
    "html_url": "https://github.com/rasom",
    "followers_url": "https://api.github.com/users/rasom/followers",
    "following_url": "https://api.github.com/users/rasom/following{/other_user}",
    "gists_url": "https://api.github.com/users/rasom/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rasom/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rasom/subscriptions",
    "organizations_url": "https://api.github.com/users/rasom/orgs",
    "repos_url": "https://api.github.com/users/rasom/repos",
    "events_url": "https://api.github.com/users/rasom/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rasom/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "alwx",
    "id": 911127,
    "node_id": "MDQ6VXNlcjkxMTEyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alwx",
    "html_url": "https://github.com/alwx",
    "followers_url": "https://api.github.com/users/alwx/followers",
    "following_url": "https://api.github.com/users/alwx/following{/other_user}",
    "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
    "organizations_url": "https://api.github.com/users/alwx/orgs",
    "repos_url": "https://api.github.com/users/alwx/repos",
    "events_url": "https://api.github.com/users/alwx/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alwx/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "alwx",
      "id": 911127,
      "node_id": "MDQ6VXNlcjkxMTEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alwx",
      "html_url": "https://github.com/alwx",
      "followers_url": "https://api.github.com/users/alwx/followers",
      "following_url": "https://api.github.com/users/alwx/following{/other_user}",
      "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
      "organizations_url": "https://api.github.com/users/alwx/orgs",
      "repos_url": "https://api.github.com/users/alwx/repos",
      "events_url": "https://api.github.com/users/alwx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alwx/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2016-08-18T17:49:03Z",
  "updated_at": "2016-08-29T10:47:05Z",
  "closed_at": "2016-08-29T10:47:00Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Whisper doesn't guarantee delivery, so the only way for us to make sure that message was successfully delivered is to receive `ack` message.\n",
  "closed_by": {
    "login": "rasom",
    "id": 2364994,
    "node_id": "MDQ6VXNlcjIzNjQ5OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2364994?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rasom",
    "html_url": "https://github.com/rasom",
    "followers_url": "https://api.github.com/users/rasom/followers",
    "following_url": "https://api.github.com/users/rasom/following{/other_user}",
    "gists_url": "https://api.github.com/users/rasom/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rasom/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rasom/subscriptions",
    "organizations_url": "https://api.github.com/users/rasom/orgs",
    "repos_url": "https://api.github.com/users/rasom/repos",
    "events_url": "https://api.github.com/users/rasom/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rasom/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/191/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/191/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241419282",
    "html_url": "https://github.com/status-im/status-mobile/issues/191#issuecomment-241419282",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/191",
    "id": 241419282,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTQxOTI4Mg==",
    "user": {
      "login": "alwx",
      "id": 911127,
      "node_id": "MDQ6VXNlcjkxMTEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alwx",
      "html_url": "https://github.com/alwx",
      "followers_url": "https://api.github.com/users/alwx/followers",
      "following_url": "https://api.github.com/users/alwx/following{/other_user}",
      "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
      "organizations_url": "https://api.github.com/users/alwx/orgs",
      "repos_url": "https://api.github.com/users/alwx/repos",
      "events_url": "https://api.github.com/users/alwx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alwx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T13:53:35Z",
    "updated_at": "2016-08-22T13:53:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "@rasom `ack` handling exists and works — we try to send the message several times within the specified time interval. But interval is too small and message won't be delivered in the case user is offline. Am I right that the goal of this task is to fix delivery completely by making it more predictable and \"stable\"?\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241419282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241423456",
    "html_url": "https://github.com/status-im/status-mobile/issues/191#issuecomment-241423456",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/191",
    "id": 241423456,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTQyMzQ1Ng==",
    "user": {
      "login": "rasom",
      "id": 2364994,
      "node_id": "MDQ6VXNlcjIzNjQ5OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2364994?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rasom",
      "html_url": "https://github.com/rasom",
      "followers_url": "https://api.github.com/users/rasom/followers",
      "following_url": "https://api.github.com/users/rasom/following{/other_user}",
      "gists_url": "https://api.github.com/users/rasom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rasom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rasom/subscriptions",
      "organizations_url": "https://api.github.com/users/rasom/orgs",
      "repos_url": "https://api.github.com/users/rasom/repos",
      "events_url": "https://api.github.com/users/rasom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rasom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T14:06:38Z",
    "updated_at": "2016-08-22T14:06:38Z",
    "author_association": "MEMBER",
    "body": "So... What we have now. Imagine that user1 wants to send a message to the user2. Currently, if user2 is offline the message will be sent six times with interval [100ms](https://github.com/status-im/status-lib/blob/bdce876ce0a33fb98bd1247349c5cb5eff651415/src/cljs/status_im/protocol/defaults.cljs#L8) and  [ttl 100 seconds](https://github.com/status-im/status-lib/blob/0deb67fade09d5c258a39f339dfe0ce0160e7376/src/cljs/status_im/protocol/web3.cljs#L13). And, in the result, if user2 will not appear in the application during that 100s he will not see the message. Never. That is wrong, the message should be delivered. \n\nAnother issue is that the message should be delivered if user1 closed the application and then opened it again. Currently, all pending messages are lost after restart.\n\nAnother issue is that current delivery implementation continues attempts to send message even if user has switched accounts. This means that messages will be sent from wrong identity.\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241423456/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241428084",
    "html_url": "https://github.com/status-im/status-mobile/issues/191#issuecomment-241428084",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/191",
    "id": 241428084,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTQyODA4NA==",
    "user": {
      "login": "rasom",
      "id": 2364994,
      "node_id": "MDQ6VXNlcjIzNjQ5OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2364994?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rasom",
      "html_url": "https://github.com/rasom",
      "followers_url": "https://api.github.com/users/rasom/followers",
      "following_url": "https://api.github.com/users/rasom/following{/other_user}",
      "gists_url": "https://api.github.com/users/rasom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rasom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rasom/subscriptions",
      "organizations_url": "https://api.github.com/users/rasom/orgs",
      "repos_url": "https://api.github.com/users/rasom/repos",
      "events_url": "https://api.github.com/users/rasom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rasom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T14:21:12Z",
    "updated_at": "2016-08-22T14:34:38Z",
    "author_association": "MEMBER",
    "body": "Optionally TTL could be lower and an interval between attempts to send a message again could be bigger. For instance, we can send it each 10 seconds with TTL 12 seconds or something like this. It shouldn't be a problem if two instances of the same message will exist at the same time as we handle this on the receiving side. At the same time, the delivery loop can still have 100ms interval. \n\nAlso, we can watch if user2 is online or not and add/remove the message from pending queue in according to this.\n\nOr any your idea how to implement this, @alwx \n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241428084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241477387",
    "html_url": "https://github.com/status-im/status-mobile/issues/191#issuecomment-241477387",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/191",
    "id": 241477387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTQ3NzM4Nw==",
    "user": {
      "login": "alwx",
      "id": 911127,
      "node_id": "MDQ6VXNlcjkxMTEyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/911127?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alwx",
      "html_url": "https://github.com/alwx",
      "followers_url": "https://api.github.com/users/alwx/followers",
      "following_url": "https://api.github.com/users/alwx/following{/other_user}",
      "gists_url": "https://api.github.com/users/alwx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alwx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alwx/subscriptions",
      "organizations_url": "https://api.github.com/users/alwx/orgs",
      "repos_url": "https://api.github.com/users/alwx/repos",
      "events_url": "https://api.github.com/users/alwx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alwx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T16:55:05Z",
    "updated_at": "2016-08-22T16:55:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "This approach will lead us to another problem — both users should anyway be online. One of the possible solutions is to use much higher TTL, that will allow us to deliver a message also when our sender is offline. \n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241477387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241484254",
    "html_url": "https://github.com/status-im/status-mobile/issues/191#issuecomment-241484254",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/191",
    "id": 241484254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTQ4NDI1NA==",
    "user": {
      "login": "rasom",
      "id": 2364994,
      "node_id": "MDQ6VXNlcjIzNjQ5OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2364994?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rasom",
      "html_url": "https://github.com/rasom",
      "followers_url": "https://api.github.com/users/rasom/followers",
      "following_url": "https://api.github.com/users/rasom/following{/other_user}",
      "gists_url": "https://api.github.com/users/rasom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rasom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rasom/subscriptions",
      "organizations_url": "https://api.github.com/users/rasom/orgs",
      "repos_url": "https://api.github.com/users/rasom/repos",
      "events_url": "https://api.github.com/users/rasom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rasom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T17:19:10Z",
    "updated_at": "2016-08-22T17:19:10Z",
    "author_association": "MEMBER",
    "body": "I don't know how it was planned to be done at the very beginning, but.. that actually can be absolutely fine for our application, because at scale a big number of messages with long TTL can lead to another kind of problem. \n\nAnyway, those parameters (loop interval, retransmission interval, ttl) have to be tunable, the main goal is to be sure that the message was delivered.\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/241484254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
