{
  "url": "https://api.github.com/repos/status-im/status-mobile/issues/9270",
  "repository_url": "https://api.github.com/repos/status-im/status-mobile",
  "labels_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270/comments",
  "events_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270/events",
  "html_url": "https://github.com/status-im/status-mobile/issues/9270",
  "id": 511338804,
  "node_id": "MDU6SXNzdWU1MTEzMzg4MDQ=",
  "number": 9270,
  "title": "Status-go version missing from About page",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 330296931,
      "node_id": "MDU6TGFiZWwzMzAyOTY5MzE=",
      "url": "https://api.github.com/repos/status-im/status-mobile/labels/bug",
      "name": "bug",
      "color": "fc2929",
      "default": true,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-10-23T13:52:05Z",
  "updated_at": "2020-04-29T20:08:59Z",
  "closed_at": "2019-11-04T20:12:46Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Problem\nRight now the app is not showing the `status-go` version:\n![](https://user-images.githubusercontent.com/2212681/67287042-acc2b480-f4da-11e9-925c-82f6bed39a9b.jpg)\nThis also translates to that version not being shown in peer name when connecting to other peers.\n\n## Notes\nBased on my investigation and help from Eric and Adam I found out this:\n\n#### Before\nWe used to set the `Version` value by using the `-X` flag in `-ldflags` when building `status-go`:\n>```Makefile\n>BUILD_FLAGS_MOBILE ?= $(shell echo \"-ldflags '\\\n> -X main.buildStamp=`date -u '+%Y-%m-%d.%H:%M:%S'` \\\n> -X github.com/status-im/status-go/params.Version=$(RELEASE_TAG) \\\n> -X github.com/status-im/status-go/params.GitCommit=$(GIT_COMMIT)'\")\n>```\n>https://github.com/status-im/status-go/blob/81b0a7b2/Makefile#L25-L28\n\nAnd this in turn sets the value of `Version` in the `NodeConfig` structure when `NewNodeConfig` is called. But currently it appears that it is not called at all. So setting it this way does nothing.\n\n#### Nix\nCurrently we are not even using the `-X` flags when building `status-go` for mobile:\nhttps://github.com/status-im/status-react/blob/57b1722863148579e0b6d4413c912e55106a3749/nix/status-go/default.nix#L56-L57\n\n#### Now\nRight now the config of `status-go` node is modified when a Status account is created/recovered via the `settings_saveNodeConfig` RPC call that modified the `NodeConfig` struct:\nhttps://github.com/status-im/status-react/blob/57b1722863148579e0b6d4413c912e55106a3749/src/status_im/node/core.cljs#L138-L147\nBut this config does not include a value for `Version`, only the `Name` set here:\nhttps://github.com/status-im/status-react/blob/57b1722863148579e0b6d4413c912e55106a3749/src/status_im/node/core.cljs#L56-L57\n\n## Solutions\nI can see 2 options here, either:\n\n* Modify `status-go` so that setting `Version` at compile time with `-X` works\n* Modify `status-react` so it sets the right `Version` value with `settings_saveNodeConfig`\n\nThe first option makes most sense to me.\n\n",
  "closed_by": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/9270/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/545455774",
    "html_url": "https://github.com/status-im/status-mobile/issues/9270#issuecomment-545455774",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270",
    "id": 545455774,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTQ1NTc3NA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-23T13:54:57Z",
    "updated_at": "2019-10-23T13:54:57Z",
    "author_association": "MEMBER",
    "body": "I have attempted to fix this issue in #9262 but quickly realized that adding the `-X` flags at build time changes nothing. Which is why I'm pretty sure that `NewNodeConfig` is never called when `status-go` is run within a mobile app, because if it was then the value of `params.Version` would have been assigned to the `Version` within `NodeConfig` structure here:\r\nhttps://github.com/status-im/status-go/blob/81b0a7b29/params/config.go#L563",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/545455774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/545458113",
    "html_url": "https://github.com/status-im/status-mobile/issues/9270#issuecomment-545458113",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270",
    "id": 545458113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTQ1ODExMw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-23T14:00:08Z",
    "updated_at": "2019-10-23T14:00:08Z",
    "author_association": "MEMBER",
    "body": "But this `GenerateConfig` method in `mobile/status.go` makes me wonder:\r\nhttps://github.com/status-im/status-go/blob/81b0a7b29/mobile/status.go#L51-L52\r\nIt appears to be using `NewNodeConfig` function, which doesn't add up for me because if it does then setting `Version` with `-X` flags should work.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/545458113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/545468447",
    "html_url": "https://github.com/status-im/status-mobile/issues/9270#issuecomment-545468447",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270",
    "id": 545468447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0NTQ2ODQ0Nw==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-23T14:22:44Z",
    "updated_at": "2019-10-23T14:22:44Z",
    "author_association": "MEMBER",
    "body": "I've built my own branch of `status-go` with some additional logging in `GenerateConfig` and I could not find it being called in the app logs. After that I've looked at how it's called in `status-react` and I found the `modules/react-native-status/ios/RCTStatus/RCTStatus.m` file.\r\nFor example, it appears to define how to call `OpenAccounts` from `status-go/mobile/status.go`:\r\nhttps://github.com/status-im/status-react/blob/57b1722863148579e0b6d4413c912e55106a3749/modules/react-native-status/ios/RCTStatus/RCTStatus.m#L451-L463\r\nBut I could not find any such equivalent for `GenerateConfig`, which I think confirms that it's not called.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/545468447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/546870284",
    "html_url": "https://github.com/status-im/status-mobile/issues/9270#issuecomment-546870284",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270",
    "id": 546870284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0Njg3MDI4NA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-28T09:48:04Z",
    "updated_at": "2019-10-28T09:48:04Z",
    "author_association": "MEMBER",
    "body": "After discussing this with Adam it looks like there's a `loadNodeConfig()` method that is __always__ called, and this includes `status-react`, and could always set `Version`:\r\nhttps://github.com/status-im/status-go/blob/81b0a7b2/api/backend.go#L344-L353\r\nBy adding here a line for setting `Version` I can make the `params.Version` value be relevant again:\r\nI will do a test branch to verify this today.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/546870284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/546998275",
    "html_url": "https://github.com/status-im/status-mobile/issues/9270#issuecomment-546998275",
    "issue_url": "https://api.github.com/repos/status-im/status-mobile/issues/9270",
    "id": 546998275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0Njk5ODI3NQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-28T15:22:22Z",
    "updated_at": "2019-10-28T15:22:22Z",
    "author_association": "MEMBER",
    "body": "I've found the fix for the missing version: https://github.com/status-im/status-go/pull/1656\r\nWith this merged I'll be able to make #9262 work.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-mobile/issues/comments/546998275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
