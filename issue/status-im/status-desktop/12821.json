{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/12821",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/12821",
  "id": 2005587460,
  "node_id": "I_kwDOD5KrTM53itYE",
  "number": 12821,
  "title": "Retrieve images from Status-go to generate thumbnail images in reply",
  "user": {
    "login": "kounkou",
    "id": 2589171,
    "node_id": "MDQ6VXNlcjI1ODkxNzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kounkou",
    "html_url": "https://github.com/kounkou",
    "followers_url": "https://api.github.com/users/kounkou/followers",
    "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
    "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
    "organizations_url": "https://api.github.com/users/kounkou/orgs",
    "repos_url": "https://api.github.com/users/kounkou/repos",
    "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kounkou/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 4548141040,
      "node_id": "LA_kwDOD5KrTM8AAAABDxcf8A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/messenger-team",
      "name": "messenger-team",
      "color": "232858",
      "default": false,
      "description": ""
    },
    {
      "id": 5954122732,
      "node_id": "LA_kwDOD5KrTM8AAAABYuSz7A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:%20Desktop%20Chat%20Messages%20&%20Chat%20Features",
      "name": "E: Desktop Chat Messages & Chat Features",
      "color": "F2960B",
      "default": false,
      "description": ""
    },
    {
      "id": 6343085517,
      "node_id": "LA_kwDOD5KrTM8AAAABehPNzQ",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/sprint-12-19",
      "name": "sprint-12-19",
      "color": "FFFFFF",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [
    {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/61",
    "html_url": "https://github.com/status-im/status-desktop/milestone/61",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/61/labels",
    "id": 8739485,
    "node_id": "MI_kwDOD5KrTM4AhVqd",
    "number": 61,
    "title": "0.16",
    "description": "## Messaging & Communities team\r\n\r\n**1.  Fix bug and stabilise Communities and Messaging functionality**\r\n\r\n**2.  Reduce size of community description metadata**\r\n- better compressions, less duplication\r\n\r\n**3. Use data sync layer (or other mechanism) to improve community description reliability**\r\n- Every time a new user joins the community, the Control Node updates and signs the description.\r\n- Random back off to stop it being too chatty \r\n\r\n**4. Continue work on profile showcase**\r\n\r\n&nbsp;\r\n\r\n## Wallet Team\r\n\r\n**1. Complete support for Community minted assets**\r\n\r\n**2. Complete token visibility management screens**\r\n\r\n**3. Continue working on WalletConnect support**\r\n\r\n**4. Minor updates to Asset screens**\r\n\r\n**5. Continue fixing bugs, making optimisations and keeping tech debt low**\r\n\r\n\r\n\r\n\r\n",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 168,
    "closed_issues": 153,
    "state": "open",
    "created_at": "2022-12-09T15:06:43Z",
    "updated_at": "2024-01-04T17:54:44Z",
    "due_on": "2024-01-31T08:00:00Z",
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2023-11-22T05:11:06Z",
  "updated_at": "2024-01-04T17:42:38Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nFrom PR : https://github.com/status-im/status-desktop/pull/12806\r\nIssue   : #10986 \r\n \r\n> I think using only the messages received here might not generate a good map, because newMessagesLoaded only contains ~20 messages. In most cases, it should be ok, but if someone replied to an old message, then the album of messages wouldn't be part of the messages seq, so we'd also not find the images.\r\n\r\njrainville\r\n\r\nIn the code creates a map that solely relies on the received messages. The received message having a limit of ~20 messages, reply on an image for older messages, the code will not be able to obtain the images for that older message.\r\nA solution would be to have access to the DB from status-go to fetch the corresponding message images and populate the Qml properties accordingly.\r\n\r\n\r\n### Steps to reproduce\r\n\r\n1- Find very old message with album images (more than 20 message earlier)\r\n2- Reply to the message with album images\r\n\r\n#### Expected behavior\r\n\r\n- The old message images are not rendered in the reply thumbnails\r\n\r\n#### Actual behavior\r\n\r\n- The old message images should be rendered in the reply thumbnails\r\n\r\n### Additional information\r\n\r\n- https://github.com/status-im/status-desktop/issues/10986\r\n- https://github.com/status-im/status-desktop/pull/12806",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/12821/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823158197",
    "html_url": "https://github.com/status-im/status-desktop/issues/12821#issuecomment-1823158197",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821",
    "id": 1823158197,
    "node_id": "IC_kwDOD5KrTM5sqy-1",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-22T17:04:37Z",
    "updated_at": "2023-11-22T17:04:37Z",
    "author_association": "MEMBER",
    "body": "For whoever works on this in the future, I think the optimal solution would be to improve the Message object in status-go itself so that any time we get the Quoted message, it also returns the album of images as part of it.\r\n\r\nObviously, this would only be local when retrieving messages from the DB, as we do not want to pass the full album of images when sending the images on the network.\r\n\r\nSo with luck, only modifying the persistence layer by improving the query would be enough! :crossed_fingers: ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823158197/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1867382390",
    "html_url": "https://github.com/status-im/status-desktop/issues/12821#issuecomment-1867382390",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821",
    "id": 1867382390,
    "node_id": "IC_kwDOD5KrTM5vTf52",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-22T08:24:23Z",
    "updated_at": "2024-01-04T17:41:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "From my analysis, this ticket requires to add a new column in the sqlite database for the quoted album Images. then follow a process for making the databse migration (I am not aware of this process, I saw couple of PR with similar changes, but it’s quite cryptic how the migrations are done. Example : https://github.com/status-im/status-go/pull/2869) So I need to ask around.\r\n\r\n------\r\n\r\nJust to complete why this is the optimal solution : \r\n\r\nwhen a message has multiple images attached to it, it will be broken to multiple messages as per https://github.com/status-im/status-go/blob/develop/services/chat/api_send_messages.go#L104, and the format of each message contains only 1 image as per https://github.com/status-im/status-desktop/blob/master/src/app_service/service/message/dto/message.nim#L89\r\nThat explains why we get a code to build the album of images https://github.com/status-im/status-desktop/blob/master/src/app/modules/main/chat_section/chat_content/messages/module.nim#L739\r\n\r\nTherefore, the idea is to populate the message quoted images with the images so that the reader of the message on the view side can just display those images accordingly.\r\n\r\n------\r\n\r\nTo be precise, each message should be filled with 1 quoted message image only. A specific code in the chat_content/messages/module.nim will aggregate the split quoted messages images to form the quoted message images.\r\n\r\n```\r\nproc updateItemsByAlbum(self: Module, items: var seq[Item], message: MessageDto): bool =\r\n  for i in 0 ..< items.len:\r\n    let item = items[i]\r\n    if item.albumId == message.albumId:\r\n      # Check if message already in album\r\n      for j in 0 ..< item.albumMessageIds.len:\r\n        if item.albumMessageIds[j] == message.id:\r\n          return true\r\n        \r\n        var albumImages = item.albumMessageImages\r\n        var quotedAlbumImages = item.quotedMessageAlbumMessageImages\r\n        var albumMessagesIds = item.albumMessageIds\r\n        albumMessagesIds.add(message.id)\r\n        albumImages.add(message.image)\r\n        item.albumMessageImages = albumImages\r\n        item.albumMessageIds = albumMessagesIds\r\n\r\n        quotedAlbumImages.add(message.quotedMessage.albumImages)\r\n        item.quotedMessageAlbumMessageImages = quotedAlbumImages\r\n\r\n        items[i] = item\r\n        return true\r\n  return false\r\n```\r\n\r\nto be able to fill each message with a quoted image, we can fill the image path ~~before sending the split message to status-go~~ (previous idea is known to be resource intensive) or use sql query to fill the quoted image",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1867382390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1870886092",
    "html_url": "https://github.com/status-im/status-desktop/issues/12821#issuecomment-1870886092",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12821",
    "id": 1870886092,
    "node_id": "IC_kwDOD5KrTM5vg3TM",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-28T07:08:11Z",
    "updated_at": "2024-01-04T17:42:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "[Steps are complete]\r\n\r\nHere are steps I set myself to be able to deliver this ticket : \r\n\r\n    - Step 1 : Setup the code for being able to do DB migration\r\n    - Step 2 : Update unittest in status-go to have reception of the message with QuotedMessage images and return QuotedMessage images persisted in DB — in progress\r\n    - Step 3 : Send PR with :SQL script for altering the user_messages table, and the migration files — in progress\r\n    - Step 4 : Perform changes on the status-desktop to use status-go new changes — waiting to start\r\n    - Step 5 : Send PR with status-desktop changes in the view — waiting to start",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1870886092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
