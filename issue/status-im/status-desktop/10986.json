{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/10986",
  "id": 1747562299,
  "node_id": "I_kwDOD5KrTM5oKa87",
  "number": 10986,
  "title": "Album of images disappears from reply after reloading the app",
  "user": {
    "login": "borismelnik",
    "id": 82511785,
    "node_id": "MDQ6VXNlcjgyNTExNzg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/82511785?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/borismelnik",
    "html_url": "https://github.com/borismelnik",
    "followers_url": "https://api.github.com/users/borismelnik/followers",
    "following_url": "https://api.github.com/users/borismelnik/following{/other_user}",
    "gists_url": "https://api.github.com/users/borismelnik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/borismelnik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/borismelnik/subscriptions",
    "organizations_url": "https://api.github.com/users/borismelnik/orgs",
    "repos_url": "https://api.github.com/users/borismelnik/repos",
    "events_url": "https://api.github.com/users/borismelnik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/borismelnik/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 4548141040,
      "node_id": "LA_kwDOD5KrTM8AAAABDxcf8A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/messenger-team",
      "name": "messenger-team",
      "color": "232858",
      "default": false,
      "description": ""
    },
    {
      "id": 5745637395,
      "node_id": "LA_kwDOD5KrTM8AAAABVnd4Ew",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Desktop%20Community%20Bugfixes%20MVP",
      "name": "E:Desktop Community Bugfixes MVP",
      "color": "01CE46",
      "default": false,
      "description": "Misc bug fixes about communities that are due for the MVP"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "kounkou",
    "id": 2589171,
    "node_id": "MDQ6VXNlcjI1ODkxNzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kounkou",
    "html_url": "https://github.com/kounkou",
    "followers_url": "https://api.github.com/users/kounkou/followers",
    "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
    "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
    "organizations_url": "https://api.github.com/users/kounkou/orgs",
    "repos_url": "https://api.github.com/users/kounkou/repos",
    "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kounkou/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/77",
    "html_url": "https://github.com/status-im/status-desktop/milestone/77",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/77/labels",
    "id": 9909318,
    "node_id": "MI_kwDOD5KrTM4AlzRG",
    "number": 77,
    "title": "0.15.5 - Stabilizing release",
    "description": "A point milestone where we focus the Messaging and Communities team 100% on bug fixing, stabilisation, reliability and finishing any unfinished items from 0.15  \r\n\r\n**1.  Fix bug and stabilise Communities and Messaging functionality**\r\n\r\n**2.  Reduce size of community description metadata**\r\n- better compressions, less duplication\r\n\r\n**3. Use data sync layer (or other mechanism) to improve community description reliability**\r\n- Every time a new user joins the community, the Control Node updates and signs the description.\r\n- Random back off to stop it being too chatty \r\n\r\n**4. Continue work on profile showcase **\r\n\r\n\r\n\r\n--- Wallet ---\r\n\r\n- Improved handling of community minted tokens: Community Asset and NFT designs for Asset screens\r\n- Token visibility management\r\n- Minor updates to Asset screens\r\n- Continue work on WalletConnect integration\r\n- Database re-encryption flows",
    "creator": {
      "login": "John-44",
      "id": 22846356,
      "node_id": "MDQ6VXNlcjIyODQ2MzU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/22846356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/John-44",
      "html_url": "https://github.com/John-44",
      "followers_url": "https://api.github.com/users/John-44/followers",
      "following_url": "https://api.github.com/users/John-44/following{/other_user}",
      "gists_url": "https://api.github.com/users/John-44/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/John-44/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/John-44/subscriptions",
      "organizations_url": "https://api.github.com/users/John-44/orgs",
      "repos_url": "https://api.github.com/users/John-44/repos",
      "events_url": "https://api.github.com/users/John-44/events{/privacy}",
      "received_events_url": "https://api.github.com/users/John-44/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 130,
    "closed_issues": 57,
    "state": "open",
    "created_at": "2023-09-11T16:40:59Z",
    "updated_at": "2023-11-27T18:46:39Z",
    "due_on": "2023-12-07T08:00:00Z",
    "closed_at": null
  },
  "comments": 9,
  "created_at": "2023-06-08T10:11:35Z",
  "updated_at": "2023-11-27T18:26:15Z",
  "closed_at": "2023-11-22T22:32:51Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n## Description\r\n\r\nAlbum of images disappeared form reply after reloading the app\r\n\r\n## Steps to reproduce\r\n\r\n1. Send several images as an album with text\r\n2. Reply on the message with album - images displayed in reply message\r\n3. Reload the app - images not displayed anymore\r\n\r\n#### Expected behavior\r\n\r\nAlbum of images and text must be displayed in reply till original message exists \r\n\r\n#### Actual behavior\r\n\r\nAlbum of images disappeared from reply, user can see just text message\r\n\r\n### Additional Information\r\n\r\n- Status desktop version: `latest master`\r\n- Operating System: `all`\r\n\r\n![Ð¡Ð½Ð¸Ð¼Ð¾Ðº ÑÐºÑ€Ð°Ð½Ð° 2023-06-08 Ð² 13 02 48](https://github.com/status-im/status-desktop/assets/82511785/8d259235-0dd0-4c75-95a8-da8a0206b795)\r\n\r\n\r\n",
  "closed_by": {
    "login": "kounkou",
    "id": 2589171,
    "node_id": "MDQ6VXNlcjI1ODkxNzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kounkou",
    "html_url": "https://github.com/kounkou",
    "followers_url": "https://api.github.com/users/kounkou/followers",
    "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
    "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
    "organizations_url": "https://api.github.com/users/kounkou/orgs",
    "repos_url": "https://api.github.com/users/kounkou/repos",
    "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kounkou/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/10986/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1806175002",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1806175002",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1806175002,
    "node_id": "IC_kwDOD5KrTM5rqAsa",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-10T17:56:31Z",
    "updated_at": "2023-11-10T21:19:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi,\n\nI could reproduce the issue easily by following exactly the same actions stated in the Description.\n\nBefore reload\n\n![Image](https://github.com/status-im/status-desktop/assets/2589171/39c7b1ec-1b52-42d0-a91a-e21ca5bee277)\n\nAfter reload\n\n![Image](https://github.com/status-im/status-desktop/assets/2589171/e3dc97b9-f560-429f-88b9-94a6662a9a64)\n\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1806175002/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1809904439",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1809904439",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1809904439,
    "node_id": "IC_kwDOD5KrTM5r4PM3",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-14T10:07:21Z",
    "updated_at": "2023-11-15T17:44:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Currently, I fixed the display of the images after reload\nNext step is to fix the images that are actually displayed to be the correct ones.\nI have also noticed that the problem is only related to the first quoted message, the rest of the messages do not have the specified problem.\n\nAttaching screenshots for visibility\n\n![Image](https://github.com/status-im/status-desktop/assets/2589171/3ba75323-aef8-43c2-b650-2a14af0dabb0)\n\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1809904439/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1812081241",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1812081241",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1812081241,
    "node_id": "IC_kwDOD5KrTM5sAipZ",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-15T09:21:13Z",
    "updated_at": "2023-11-15T17:33:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Based on my analysis of possible solutions, there could be 2 ways of solving this issue \n\nMy understanding is that when we first use Status to send/receive message with albums, those message are perfectly set in the ChatView. However, we do not store those messages in a way that enables us to display them correctly when reloading the app. Thatâ€™s why I am adding new 2 properties : the count of quoted message images in album and the actually images links for the quoted message. This should resolve the problem when reloading the app.  There is another way of achieving this by fetching asynchronously the quoted message infos. But this is very slow and not preferred method.\n\n1- [preferred] Add new properties in nim and do a binding with Qml\nHere I will need 2 properties : images of an album, and the actual number of images in the album. Please note that these images I need are quoted images, similar to already existing quotedMessage Text.\n\n2- [slow] Call a function to retrieve the images for a specific message id\nThis option is slow and probably asynchronous\n\nI am currently working on implementing solution 1-",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1812081241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1813148074",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1813148074",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1813148074,
    "node_id": "IC_kwDOD5KrTM5sEnGq",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-15T19:37:16Z",
    "updated_at": "2023-11-15T19:37:16Z",
    "author_association": "MEMBER",
    "body": "I wonder now if it's not a problem in status-go. We do see the images when we first receive the reply, that means that the model supports showing them correctly and also that we get all the wanted data from the backend when we receive it through the signal (event from status-go).\r\n\r\nHowever, on app reload, we do not use the signal, we use a function to get messages in pages (like 20 messages), and probably that function doesn't return the album of messages as part of the message.\r\n\r\nOne way to check what you receive from status-go would be to `echo jsonSignal` in `signals_manager.nim`. That will show you all the signals received from status-go.\r\nYou can then identify what you get when you receive a reply with an album.\r\n\r\nThen, you can compare with what we get on app start by doing `echo msgsResponse` in `asyncFetchChatMessagesTask`in `message/async_tasks.nim`.\r\n\r\nIf you see that the returned message in the latter is missing info compared to the one in the former, that means we are missing something in sttaus-go.\r\n\r\nIn that case, @borismelnik can help you identify how he passed the album to the message reply.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1813148074/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1814143059",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1814143059",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1814143059,
    "node_id": "IC_kwDOD5KrTM5sIaBT",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-16T10:09:49Z",
    "updated_at": "2023-11-16T17:44:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you @jrainville, this is gold!\nI captured some logs. I will analyze them more in a few. I can see that the image are indeed returned in status, so this might explain why whatever I did in nim, I still saw unexpected results\nI had a conversation with @borismelnik  on the nim part. The status go seem to be the right place to check now. I'll shift to status go",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1814143059/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1815998810",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1815998810",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1815998810,
    "node_id": "IC_kwDOD5KrTM5sPfFa",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-17T09:08:35Z",
    "updated_at": "2023-11-17T09:12:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I have added some `echo` lines as recommended above, here are the observations : \n\n### Before the reboot\nI added some logs lines to to print the signal received. It's just a signal here, I seems logical to me that I don't see the actual payload. So here I am missing finding the actual place where the payload is sent from `nim` to `status-go`\nI am also not able to observe any communication on the way `status-go` to `nim`, by observing on the status-go side.\n\nEx : \n```\n---> receiveSignal decoded signal : {\"type\":\"messages.new\",\"event\":{\"notifications\":null,\"statusUpdates\":[{\"publicKey\":\"0x04c429330e366166687319c372775b39a917352e1af7f1510bf0a7a7805f7a2597030753529f3ff5e55b5a27c1d0be154312fa924532ac2ad005ed403223a43e9b\",\"statusType\":1,\"clock\":1700211606,\"text\":\"\"}],\"discordOldestMessageTimestamp\":0}}\n```\n\n### After reboot\nAfter reboot, I have much more info that I can analyze after pretifying the json.  What I can see is : The quoted message which I am interested with comes with a matching text and image from the `asyncFetchChatMessagesTaskin` perspective.\nFor my particular test however, while I was expecting 2 images, only actually 1 image repeated in messages. While the albumImage count is correct.\n\nSo based on above observations, there is something not working correctly when loading the messages from status-go. So as action : \n\n- I need to confirm what is actually sent before reboot (I need better way to observe the message sent from nim to status-go)\n- Once I know above, I can either have to fix status-go or making sure the code retrieve the info and displays them correctly.\n\nEx:\n```\n[\n  {\n    \"id\": \"0x5a02b81d98a2abc6879f02a6e82a6416ff083f76347da7d589905727d87dd6cc\",\n    \"whisperTimestamp\": 1700209257936,\n    \"from\": \"0x049563f3dae3c4dc1f1ff72463ab2f7ffa5011bf0f938c0dd87db8955d61ad70ff49393ad1c1dc53890df4e091af1b3d64724017ad9b0fdce6236f8965c4489278\",\n    \"alias\": \"\",\n    \"identicon\": \"\",\n    \"seen\": true,\n    \"outgoingStatus\": \"delivered\",\n    \"quotedMessage\": {\n      \"id\": \"0xd9c8ae3adf49fe4f5c8fe18327f015652ad204c17fd377a5828b0b3f168ba258\",\n      \"contentType\": 7,\n      \"from\": \"0x049563f3dae3c4dc1f1ff72463ab2f7ffa5011bf0f938c0dd87db8955d61ad70ff49393ad1c1dc53890df4e091af1b3d64724017ad9b0fdce6236f8965c4489278\",\n      \"text\": \"Sender message 1\",\n      \"parsedText\": [\n        {\n          \"type\": \"paragraph\",\n          \"children\": [\n            {\n              \"literal\": \"Sender message 1\"\n            }\n          ]\n        }\n      ],\n      \"albumImagesCount\": 2,\n      \"image\": \"https://Localhost:39325/messages/images?messageId=0xd9c8ae3adf49fe4f5c8fe18327f015652ad204c17fd377a5828b0b3f168ba258\"\n    },\n    \"rtl\": false,\n    \"parsedText\": [\n      {\n        \"type\": \"paragraph\",\n        \"children\": [\n          {\n            \"literal\": \"Receiver message 1\"\n          }\n        ]\n      }\n    ],\n    \"lineCount\": 0,\n    \"text\": \"Receiver message 1\",\n    \"chatId\": \"0x04c429330e366166687319c372775b39a917352e1af7f1510bf0a7a7805f7a2597030753529f3ff5e55b5a27c1d0be154312fa924532ac2ad005ed403223a43e9b\",\n    \"localChatId\": \"0x04c429330e366166687319c372775b39a917352e1af7f1510bf0a7a7805f7a2597030753529f3ff5e55b5a27c1d0be154312fa924532ac2ad005ed403223a43e9b\",\n    \"clock\": 1700209257936,\n    \"replace\": \"\",\n    \"responseTo\": \"0xd9c8ae3adf49fe4f5c8fe18327f015652ad204c17fd377a5828b0b3f168ba258\",\n    \"ensName\": \"\",\n    \"displayName\": \"\",\n    \"image\": \"https://Localhost:39325/messages/images?messageId=0x5a02b81d98a2abc6879f02a6e82a6416ff083f76347da7d589905727d87dd6cc\",\n    \"albumId\": \"371a1c7d-26a4-4caa-8abc-d70ee3dba7b4\",\n    \"albumImagesCount\": 3,\n    \"gapParameters\": {},\n    \"timestamp\": 1700209257936,\n    \"contentType\": 7,\n    \"messageType\": 1,\n    \"compressedKey\": \"zQ3shXTwuHEukauQdkJhELxj9Bk575cRrAqzjuZfJzbabVfGa\",\n    \"emojiHash\": [\n      \"ðŸ‘¨ðŸ¿â€ðŸŽ¨\",\n      \"ðŸ˜©\",\n      \"ðŸ±\",\n      \"ðŸ‘ŠðŸ¿\",\n      \"ðŸ‘©ðŸ¾â€ðŸš’\",\n      \"ðŸš£â€â™‚ï¸\",\n      \"ðŸ‘©ðŸ¼â€ðŸ¦°\",\n      \"ðŸŒ°\",\n      \"ðŸ””\",\n      \"ðŸ…¿ï¸\",\n      \"ðŸ™†ðŸ¼â€â™‚ï¸\",\n      \"ðŸ¤½ðŸ¿\",\n      \"ðŸ¤¹ðŸ¾\",\n      \"ðŸ“½ï¸\"\n    ]\n  }\n  ...\n  ]\n  \n````",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1815998810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1816558071",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1816558071",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1816558071,
    "node_id": "IC_kwDOD5KrTM5sRnn3",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-17T14:46:44Z",
    "updated_at": "2023-11-17T14:46:44Z",
    "author_association": "MEMBER",
    "body": "> For my particular test however, while I was expecting 2 images, only actually 1 image repeated in messages. While the albumImage count is correct.\r\n\r\nI think the image there is actually the user's image, to easily display the user info from the message.\r\n\r\nThe actual images would come in an album property.\r\n\r\n> I am also not able to observe any communication on the way status-go to nim, by observing on the status-go side.\r\n\r\nIt would look something like `{\"type\": \"message-new\", ...}`  with a big payload. \r\n\r\nNow that I rethink about it, the album feature can be a little complex, because the images can come in multiple different messages from waku. So sometimes the album has 3 images, but you might receive only 2 at first. Then we show a loading until we receive the final image.\r\n\r\nSo I think the issue here is that when we generate/populate the `quotedMessage` in status-go, we probably don't have the same code to recreate the album?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1816558071/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1816674344",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1816674344",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1816674344,
    "node_id": "IC_kwDOD5KrTM5sSEAo",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-17T15:53:18Z",
    "updated_at": "2023-11-17T15:53:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "\nHey, thanks for following along ðŸ™ŒðŸ¾,\n\n> I think the image there is actually the user's image, to easily display the user info from the message.\n\nFor the image I have checked it myself. It's served by the localhost when Status in running. So I opened it on a browser (magic!), and it's one of the original message to which I replied.\n\n> The actual images would come in an album property.\n\nwhat you mentioned below matched my observation. A message can be split into multiple message, I thought there is no such thing as album in quotedMessage structure. Those images can be grouped in album later on. \n\n> It would look something like `{\"type\": \"message-new\", ...}`  with a big payload.\n\nRight... There must something else that I am missing here cause I saw similar messages type message-new but no payload. I'll post the code here in a few.\n\n> Now that I rethink about it, the album feature can be a little complex, because the images can come in multiple different messages from waku. So sometimes the album has 3 images, but you might receive only 2 at first. Then we show a loading until we receive the final image.\n\nIndeed thanks for sharing ðŸ‘ðŸ¾\n\n> So I think the issue here is that when we generate/populate the `quotedMessage` in status-go, we probably don't have the same code to recreate the album?\n\nRight, I'll check the nim module again today",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1816674344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1818704470",
    "html_url": "https://github.com/status-im/status-desktop/issues/10986#issuecomment-1818704470",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10986",
    "id": 1818704470,
    "node_id": "IC_kwDOD5KrTM5sZzpW",
    "user": {
      "login": "kounkou",
      "id": 2589171,
      "node_id": "MDQ6VXNlcjI1ODkxNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2589171?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kounkou",
      "html_url": "https://github.com/kounkou",
      "followers_url": "https://api.github.com/users/kounkou/followers",
      "following_url": "https://api.github.com/users/kounkou/following{/other_user}",
      "gists_url": "https://api.github.com/users/kounkou/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kounkou/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kounkou/subscriptions",
      "organizations_url": "https://api.github.com/users/kounkou/orgs",
      "repos_url": "https://api.github.com/users/kounkou/repos",
      "events_url": "https://api.github.com/users/kounkou/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kounkou/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-20T09:49:23Z",
    "updated_at": "2023-11-20T09:49:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi,\n\nThe reason why the before reload everything works perfectly is because inside MessageView.qml\n\nhttps://github.com/status-im/status-desktop/blob/78303105915e17c4e8ff4d176f8b46e3b8381dae/ui/imports/shared/views/chat/MessageView.qml#L669\n\nOn `onResponseMessageChanged` signal, we call the `messageStore.getMessageByIdAsJson(responseToMessageWithId)` to obtain the images of the quotedMessage. \n\nBut the model is not made aware of this change at any time. Therefore, when reloading the application, the message doesn't contain the necessary quoted Images to be displayed.\nHowever, the quotedMessage text already exists in the model.\n\nI am currently exploring a solution where I gather the images from the message module in nim.\n\nCurrently, I am able to retrieve one image per quotedMessage. Once all the images retrieved, I will expose a quotedMessageAlbumCount and quotedMessageAlbumImages to be used in the MessageView component for any replies.\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1818704470/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
