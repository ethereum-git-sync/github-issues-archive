{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/9490",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/9490",
  "id": 1576330603,
  "node_id": "I_kwDOD5KrTM5d9OVr",
  "number": 9490,
  "title": "Investigate Mac CPU issues issues",
  "user": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2140496678,
      "node_id": "MDU6TGFiZWwyMTQwNDk2Njc4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/macos",
      "name": "macos",
      "color": "167a78",
      "default": false,
      "description": ""
    },
    {
      "id": 3166254951,
      "node_id": "MDU6TGFiZWwzMTY2MjU0OTUx",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/performance",
      "name": "performance",
      "color": "7F1B66",
      "default": false,
      "description": ""
    },
    {
      "id": 3904301025,
      "node_id": "LA_kwDOD5KrTM7otufh",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:PerformanceImprovements",
      "name": "E:PerformanceImprovements",
      "color": "7D613C",
      "default": false,
      "description": ""
    },
    {
      "id": 4220089404,
      "node_id": "LA_kwDOD5KrTM77iXQ8",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/S:3",
      "name": "S:3",
      "color": "03A6A2",
      "default": false,
      "description": "We know what needs to be done, some extra steps, but thatâ€™s it, little to no unknowns"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "borismelnik",
    "id": 82511785,
    "node_id": "MDQ6VXNlcjgyNTExNzg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/82511785?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/borismelnik",
    "html_url": "https://github.com/borismelnik",
    "followers_url": "https://api.github.com/users/borismelnik/followers",
    "following_url": "https://api.github.com/users/borismelnik/following{/other_user}",
    "gists_url": "https://api.github.com/users/borismelnik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/borismelnik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/borismelnik/subscriptions",
    "organizations_url": "https://api.github.com/users/borismelnik/orgs",
    "repos_url": "https://api.github.com/users/borismelnik/repos",
    "events_url": "https://api.github.com/users/borismelnik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/borismelnik/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "borismelnik",
      "id": 82511785,
      "node_id": "MDQ6VXNlcjgyNTExNzg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/82511785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/borismelnik",
      "html_url": "https://github.com/borismelnik",
      "followers_url": "https://api.github.com/users/borismelnik/followers",
      "following_url": "https://api.github.com/users/borismelnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/borismelnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/borismelnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/borismelnik/subscriptions",
      "organizations_url": "https://api.github.com/users/borismelnik/orgs",
      "repos_url": "https://api.github.com/users/borismelnik/repos",
      "events_url": "https://api.github.com/users/borismelnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/borismelnik/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/55",
    "html_url": "https://github.com/status-im/status-desktop/milestone/55",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/55/labels",
    "id": 8475711,
    "node_id": "MI_kwDOD5KrTM4AgVQ_",
    "number": 55,
    "title": "0.11.0",
    "description": "Communities:\r\n- Token Based Functionality\r\n\r\nGeneral:\r\n- User Profile showcase\r\n",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 195,
    "state": "closed",
    "created_at": "2022-09-28T20:32:13Z",
    "updated_at": "2023-04-24T18:15:13Z",
    "due_on": "2023-03-24T07:00:00Z",
    "closed_at": "2023-04-24T18:15:13Z"
  },
  "comments": 3,
  "created_at": "2023-02-08T15:28:09Z",
  "updated_at": "2023-03-06T15:36:20Z",
  "closed_at": "2023-03-06T15:36:19Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nOn Mac, users experience a crazy amount of CPU usage, even with the app in the background, whereas Linux and even Windows don't have that issue.\r\n\r\nThe only 2 things that come to mind that are different on Mac are the Frame (to have the Mac buttons and such at the top), and the OS notifications (we have custom DOtherSide code for those on Mac).\r\n\r\nTry to comment those out and see if the app still uses as much CPU in the background. We are aiming for close to 0 when the app is in the background and no messages are being received.\r\n\r\nThe goal of this issue is just to get information. We can decide after what to do with those depending on the findings.",
  "closed_by": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/9490/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1452424545",
    "html_url": "https://github.com/status-im/status-desktop/issues/9490#issuecomment-1452424545",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490",
    "id": 1452424545,
    "node_id": "IC_kwDOD5KrTM5Wkj1h",
    "user": {
      "login": "borismelnik",
      "id": 82511785,
      "node_id": "MDQ6VXNlcjgyNTExNzg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/82511785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/borismelnik",
      "html_url": "https://github.com/borismelnik",
      "followers_url": "https://api.github.com/users/borismelnik/followers",
      "following_url": "https://api.github.com/users/borismelnik/following{/other_user}",
      "gists_url": "https://api.github.com/users/borismelnik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/borismelnik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/borismelnik/subscriptions",
      "organizations_url": "https://api.github.com/users/borismelnik/orgs",
      "repos_url": "https://api.github.com/users/borismelnik/repos",
      "events_url": "https://api.github.com/users/borismelnik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/borismelnik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T19:16:00Z",
    "updated_at": "2023-03-02T19:16:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jrainville I test it and seems like it doesn't help :( \nThere is maybe a problem with Qt specifically in current platform implementation. We can fix it if we start using analyzer tools for app. I tried to run it with Xcode analyzer but failed - it stuck on running state or after attaching to running process.\nOne think in OS notifications code looks weird:\n`\nvoid OSNotification::showNotificationMacOs(QString title, QString message, \n    QString identifier)\n{\n    if (!m_notificationHelper)\n        return;\n\n    NSUserNotification* notification = [[NSUserNotification alloc] init];\n    notification.title = title.toNSString();\n    notification.informativeText = message.toNSString();\n    notification.soundName = NSUserNotificationDefaultSoundName;\n    notification.hasActionButton = false;\n    notification.identifier = identifier.toNSString();\n    \n    NSUserNotificationCenter* center = NSUserNotificationCenter.defaultUserNotificationCenter;\n    center.delegate = m_notificationHelper->delegate;\n    [center deliverNotification:notification];\n    [notification release];\n}\n`\n\nthere `center.delegate` is initialized when every notification was shown, but I think its the same instance every time so no memory leaks.\n\nAny new ideas? :)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1452424545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1452436430",
    "html_url": "https://github.com/status-im/status-desktop/issues/9490#issuecomment-1452436430",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490",
    "id": 1452436430,
    "node_id": "IC_kwDOD5KrTM5WkmvO",
    "user": {
      "login": "caybro",
      "id": 5377645,
      "node_id": "MDQ6VXNlcjUzNzc2NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377645?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caybro",
      "html_url": "https://github.com/caybro",
      "followers_url": "https://api.github.com/users/caybro/followers",
      "following_url": "https://api.github.com/users/caybro/following{/other_user}",
      "gists_url": "https://api.github.com/users/caybro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caybro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caybro/subscriptions",
      "organizations_url": "https://api.github.com/users/caybro/orgs",
      "repos_url": "https://api.github.com/users/caybro/repos",
      "events_url": "https://api.github.com/users/caybro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caybro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T19:27:29Z",
    "updated_at": "2023-03-02T19:27:29Z",
    "author_association": "MEMBER",
    "body": "@alexjba has a lot of good news here :)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1452436430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1453143182",
    "html_url": "https://github.com/status-im/status-desktop/issues/9490#issuecomment-1453143182",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/9490",
    "id": 1453143182,
    "node_id": "IC_kwDOD5KrTM5WnTSO",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-03T08:16:59Z",
    "updated_at": "2023-03-03T08:16:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "I guess we're working on the same thing #8139\r\nSo these are my findings so far:\r\n1. ~90% of the CPU usage wile the app is in the background is consumed by status-go. I've shared some profiling data here #8139 that can be analysed using `Instruments`.\r\n2. While the app is in foreground min 10% of CPU is consumed by the renderer. This usually happens when we animate things on the screen. Most common are the StatusChatInput cursor and the busy indicator in the message history.\r\n\r\n4. Now on the bright side, the app can be compiled natively for M1 and the performance is better. It was the first time I've seen the app consuming 7% CPU while actually using the app ðŸŽ‰ . Usually I've seen it around 15-20%. One thing to note here is that the arm build I'm using is slowed down by the [Address sanitizer](https://clang.llvm.org/docs/AddressSanitizer.html). Unfortunately status-go will freeze with the normal nim compilation flags and the only workaround I've found is to enable the `Address sanitizer`. See https://github.com/golang/go/issues/48437",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1453143182/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
