{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/8901",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/8901/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/8901/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/8901/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/8901",
  "id": 1511883522,
  "node_id": "I_kwDOD5KrTM5aHYMC",
  "number": 8901,
  "title": "`chat_getMembers` should be cached to not hit the DB each time we add a member",
  "user": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2351074091,
      "node_id": "MDU6TGFiZWwyMzUxMDc0MDkx",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/refactor",
      "name": "refactor",
      "color": "ef9870",
      "default": false,
      "description": ""
    },
    {
      "id": 3205511249,
      "node_id": "MDU6TGFiZWwzMjA1NTExMjQ5",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/priority%202:%20medium",
      "name": "priority 2: medium",
      "color": "FBCA04",
      "default": false,
      "description": "an issue that is not severely affecting the overall app, it may interfere with some users users expe"
    },
    {
      "id": 3904301025,
      "node_id": "LA_kwDOD5KrTM7otufh",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:PerformanceImprovements",
      "name": "E:PerformanceImprovements",
      "color": "7D613C",
      "default": false,
      "description": ""
    },
    {
      "id": 4220089404,
      "node_id": "LA_kwDOD5KrTM77iXQ8",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/S:3",
      "name": "S:3",
      "color": "03A6A2",
      "default": false,
      "description": "We know what needs to be done, some extra steps, but thatâ€™s it, little to no unknowns"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [
    {
      "login": "mprakhov",
      "id": 117639195,
      "node_id": "U_kgDOBwMIGw",
      "avatar_url": "https://avatars.githubusercontent.com/u/117639195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mprakhov",
      "html_url": "https://github.com/mprakhov",
      "followers_url": "https://api.github.com/users/mprakhov/followers",
      "following_url": "https://api.github.com/users/mprakhov/following{/other_user}",
      "gists_url": "https://api.github.com/users/mprakhov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mprakhov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mprakhov/subscriptions",
      "organizations_url": "https://api.github.com/users/mprakhov/orgs",
      "repos_url": "https://api.github.com/users/mprakhov/repos",
      "events_url": "https://api.github.com/users/mprakhov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mprakhov/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/54",
    "html_url": "https://github.com/status-im/status-desktop/milestone/54",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/54/labels",
    "id": 8475707,
    "node_id": "MI_kwDOD5KrTM4AgVQ7",
    "number": 54,
    "title": "0.10.0",
    "description": "General:\r\n- Memory Usage Improvements (part 3)\r\n\r\nGeneral:\r\n- Account Syncing",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 95,
    "state": "closed",
    "created_at": "2022-09-28T20:31:48Z",
    "updated_at": "2023-02-13T17:24:23Z",
    "due_on": "2023-01-27T08:00:00Z",
    "closed_at": "2023-02-01T14:52:43Z"
  },
  "comments": 2,
  "created_at": "2022-12-27T15:02:17Z",
  "updated_at": "2023-02-01T11:09:56Z",
  "closed_at": "2023-02-01T11:09:55Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nRight now, each time we add a member in a community, especially when we join, we do a call to `getChatMembers`, which calls `chat_getMembers` which hits the DB. \r\n\r\nIt's slow and probably unnecessary since that list doesn't change that often.\r\n\r\nWe just need to make sure that we update that list when we receive the appropriate signals so it stays up to date.",
  "closed_by": {
    "login": "mprakhov",
    "id": 117639195,
    "node_id": "U_kgDOBwMIGw",
    "avatar_url": "https://avatars.githubusercontent.com/u/117639195?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mprakhov",
    "html_url": "https://github.com/mprakhov",
    "followers_url": "https://api.github.com/users/mprakhov/followers",
    "following_url": "https://api.github.com/users/mprakhov/following{/other_user}",
    "gists_url": "https://api.github.com/users/mprakhov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mprakhov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mprakhov/subscriptions",
    "organizations_url": "https://api.github.com/users/mprakhov/orgs",
    "repos_url": "https://api.github.com/users/mprakhov/repos",
    "events_url": "https://api.github.com/users/mprakhov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mprakhov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/8901/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/8901/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1404750722",
    "html_url": "https://github.com/status-im/status-desktop/issues/8901#issuecomment-1404750722",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8901",
    "id": 1404750722,
    "node_id": "IC_kwDOD5KrTM5TusuC",
    "user": {
      "login": "mprakhov",
      "id": 117639195,
      "node_id": "U_kgDOBwMIGw",
      "avatar_url": "https://avatars.githubusercontent.com/u/117639195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mprakhov",
      "html_url": "https://github.com/mprakhov",
      "followers_url": "https://api.github.com/users/mprakhov/followers",
      "following_url": "https://api.github.com/users/mprakhov/following{/other_user}",
      "gists_url": "https://api.github.com/users/mprakhov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mprakhov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mprakhov/subscriptions",
      "organizations_url": "https://api.github.com/users/mprakhov/orgs",
      "repos_url": "https://api.github.com/users/mprakhov/repos",
      "events_url": "https://api.github.com/users/mprakhov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mprakhov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T09:36:47Z",
    "updated_at": "2023-01-26T09:39:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "The changes are on review.\r\n\r\nI want to raise another question.\r\nIn status-go right now we have 3 types of members:\r\n\r\n```\r\ntype Member struct {\r\n\t// Community Roles\r\n\tRoles []protobuf.CommunityMember_Roles `json:\"roles,omitempty\"`\r\n\t// Admin indicates if the member is an admin of the group chat\r\n\tAdmin bool `json:\"admin\"`\r\n\t// Joined indicates if the member has joined the group chat\r\n\tJoined bool `json:\"joined\"`\r\n}\r\n```\r\n\r\n```\r\n// ChatMember represents a member who participates in a group chat\r\ntype ChatMember struct {\r\n\t// ID is the hex encoded public key of the member\r\n\tID string `json:\"id\"`\r\n\t// Admin indicates if the member is an admin of the group chat\r\n\tAdmin bool `json:\"admin\"`\r\n}\r\n```\r\n\r\n```\r\ntype CommunityMember struct {\r\n\tRoles                []CommunityMember_Roles `protobuf:\"varint,1,rep,packed,name=roles,proto3,enum=protobuf.CommunityMember_Roles\" json:\"roles,omitempty\"`\r\n\tXXX_NoUnkeyedLiteral struct{}                `json:\"-\"`\r\n\tXXX_unrecognized     []byte                  `json:\"-\"`\r\n\tXXX_sizecache        int32                   `json:\"-\"`\r\n}\r\n```\r\n\r\nDifferent type of structures sends as a JSON to nim code in different cases. For example, \r\n- during chat/channel/community creation - `Member`\r\n- during group chat updates - `ChatMember`\r\n- during community/channel updates - `CommunityMember`\r\n\r\nThey all are saved under one key - `members`. So by reading the code it's even hard to say, what and when you'll receive under `members` key\r\n\r\nCan we union all of them into one structure during sending/returning data from status-go? I don't see a big difference between them, it just brings unnecessary complexity\r\nI think we can just return one type \r\n```\r\nChatMember {\r\nid\r\nroles\r\njoined\r\n}\r\n```\r\n\r\ncc @jrainville @cammellos ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1404750722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1404769631",
    "html_url": "https://github.com/status-im/status-desktop/issues/8901#issuecomment-1404769631",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8901",
    "id": 1404769631,
    "node_id": "IC_kwDOD5KrTM5TuxVf",
    "user": {
      "login": "cammellos",
      "id": 1017008,
      "node_id": "MDQ6VXNlcjEwMTcwMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1017008?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cammellos",
      "html_url": "https://github.com/cammellos",
      "followers_url": "https://api.github.com/users/cammellos/followers",
      "following_url": "https://api.github.com/users/cammellos/following{/other_user}",
      "gists_url": "https://api.github.com/users/cammellos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cammellos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cammellos/subscriptions",
      "organizations_url": "https://api.github.com/users/cammellos/orgs",
      "repos_url": "https://api.github.com/users/cammellos/repos",
      "events_url": "https://api.github.com/users/cammellos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cammellos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T09:52:53Z",
    "updated_at": "2023-01-26T09:52:53Z",
    "author_association": "MEMBER",
    "body": "> Can we union all of them into one structure during sending/returning data from status-go? I don't see a big difference between them, it just brings unnecessary complexity\r\nI think we can just return one type\r\n\r\nI would keep things separate in terms of community vs private chats, at least at the struct level. \r\nI agree without you that are similar, but they will change for different reasons and product requirements (they already have 1 out of 3 fields different), though it's fine to make it consistent in terms of how to serialize them and/or re-use an embedded type if we want to.\r\nIf we add roles to private group chats, then probably it might be a good time to think about it.\r\n\r\n\r\nIn mobile we don't use `type Member struct {`, so that could be consolidated from our side. \r\n`CommunityMember` is also a protobuf definition, in theory we should not expose those to the client, since they are protocol specific.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1404769631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
