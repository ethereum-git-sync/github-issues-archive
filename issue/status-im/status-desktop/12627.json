{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/12627",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/12627/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/12627/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/12627/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/12627",
  "id": 1975220725,
  "node_id": "I_kwDOD5KrTM51u3n1",
  "number": 12627,
  "title": "failed to set `journal_mode` pragma: file is not a database\"",
  "user": {
    "login": "fryorcraken",
    "id": 110212804,
    "node_id": "U_kgDOBpG2xA",
    "avatar_url": "https://avatars.githubusercontent.com/u/110212804?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fryorcraken",
    "html_url": "https://github.com/fryorcraken",
    "followers_url": "https://api.github.com/users/fryorcraken/followers",
    "following_url": "https://api.github.com/users/fryorcraken/following{/other_user}",
    "gists_url": "https://api.github.com/users/fryorcraken/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fryorcraken/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fryorcraken/subscriptions",
    "organizations_url": "https://api.github.com/users/fryorcraken/orgs",
    "repos_url": "https://api.github.com/users/fryorcraken/repos",
    "events_url": "https://api.github.com/users/fryorcraken/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fryorcraken/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 5745579465,
      "node_id": "LA_kwDOD5KrTM8AAAABVnaVyQ",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Desktop%20DB%20Improvement",
      "name": "E:Desktop DB Improvement",
      "color": "C6AB09",
      "default": false,
      "description": "Add a dedicated db for wallet"
    },
    {
      "id": 5843953760,
      "node_id": "LA_kwDOD5KrTM8AAAABXFOoYA",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Desktop%20Bugfixes%200.16",
      "name": "E:Desktop Bugfixes 0.16",
      "color": "5A1BE3",
      "default": false,
      "description": "Misc bug fixes in Desktop app overall for 0.16"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-11-02T23:59:28Z",
  "updated_at": "2023-11-06T15:28:36Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n## Description\r\n\r\n\r\nGetting \"password incorrect\" when trying to log in.\r\nI use a password manager so confident my password is correct.\r\n\r\nThis is with 0.14.1. I did a fresh install of 0.14.1 few days ago\r\n\r\n## Steps to reproduce\r\n\r\n<!-- example: step 1. do X step 2. do Y etc.. -->\r\n\r\nStart app, enter password\r\n\r\n#### Expected behavior\r\n\r\nlogs in\r\n\r\n#### Actual behavior\r\n\r\nincorrect password\r\n\r\n### Additional Information\r\n\r\n- Status desktop version: 0.14.1\r\n- Operating System: Fedora Linux x86-64\r\n\r\n```\r\n▶ ~/.local/bin/StatusIm-Desktop-v0.14.1-43748b-x86_64.AppImage \r\nINFO [11-03|10:51:27.804] Status backend initialized               backend=geth version=0.166.9 commit=c4238018a IpfsGatewayURL=https://ipfs.status.im/\r\nInfo: Warning: Ignoring XDG_SESSION_TYPE=wayland on Gnome. Use QT_QPA_PLATFORM=wayland to run on Wayland anyway. (:0, )\r\nINF 2023-11-03 10:51:28.075+11:00 Version: 0.14.1                            topics=\"status-app\" tid=5674 file=nim_status_client.nim:189\r\nINF 2023-11-03 10:51:28.075+11:00 Commit: 43748b06f                          topics=\"status-app\" tid=5674 file=nim_status_client.nim:190\r\nINF 2023-11-03 10:51:28.075+11:00 Current date:                              topics=\"status-app\" tid=5674 file=nim_status_client.nim:191 currentDateTime=2023-11-03T10:51:28+11:00\r\nINF 2023-11-03 10:51:28.075+11:00 starting application controller...         topics=\"status-app\" tid=5674 file=nim_status_client.nim:193\r\nINF 2023-11-03 10:51:31.058+11:00 starting application...                    topics=\"status-app\" tid=5674 file=nim_status_client.nim:196\r\nWRN 2023-11-03 10:51:31.059+11:00 Error decoding signal                      topics=\"signals-manager\" tid=5674 file=signals_manager.nim:41 err=\"Unknown signal received: mediaserver.started\"\r\nDebug: Network Cache Dir:  \"/home/fryorcraken/.config/Status/tmp/netcache\" (:0, )\r\nERROR[11-03|10:52:08.977] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nfailed to set `journal_mode` pragma: file is not a database\r\nERR 2023-11-03 10:52:08.977+11:00 error:                                     topics=\"accounts-service\" tid=5674 file=service.nim:619 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:09.451] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:09.451] failed to start a node                   key-uid=0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:09.452+11:00 node.login                                 topics=\"signals-manager\" tid=5674 file=signals_manager.nim:46 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:09.454+11:00 login error                                topics=\"app-controller\" tid=5674 file=module.nim:436 methodName=onNodeLogin errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:19.901] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nfailed to set `journal_mode` pragma: file is not a database\r\nERR 2023-11-03 10:52:19.901+11:00 error:                                     topics=\"accounts-service\" tid=5674 file=service.nim:619 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:20.365] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:20.365] failed to start a node                   key-uid=0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:20.367+11:00 node.login                                 topics=\"signals-manager\" tid=5674 file=signals_manager.nim:46 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:20.368+11:00 login error                                topics=\"app-controller\" tid=5674 file=module.nim:436 methodName=onNodeLogin errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:36.103] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nfailed to set `journal_mode` pragma: file is not a database\r\nERR 2023-11-03 10:52:36.103+11:00 error:                                     topics=\"accounts-service\" tid=5674 file=service.nim:619 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:36.566] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:36.566] failed to start a node                   key-uid=0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:36.566+11:00 node.login                                 topics=\"signals-manager\" tid=5674 file=signals_manager.nim:46 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:36.567+11:00 login error                                topics=\"app-controller\" tid=5674 file=module.nim:436 methodName=onNodeLogin errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:43.989] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nfailed to set `journal_mode` pragma: file is not a database\r\nERR 2023-11-03 10:52:43.989+11:00 error:                                     topics=\"accounts-service\" tid=5674 file=service.nim:619 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:44.453] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:52:44.453] failed to start a node                   key-uid=0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:44.453+11:00 node.login                                 topics=\"signals-manager\" tid=5674 file=signals_manager.nim:46 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:52:44.454+11:00 login error                                topics=\"app-controller\" tid=5674 file=module.nim:436 methodName=onNodeLogin errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\n^CSIGINT: Interrupted by Ctrl-C.\r\n\r\n\r\n~                                                                                                                                                                                                                                                                         ⍉\r\n▶ ~/.local/bin/StatusIm-Desktop-v0.14.1-43748b-x86_64.AppImage\r\nINFO [11-03|10:53:02.020] Status backend initialized               backend=geth version=0.166.9 commit=c4238018a IpfsGatewayURL=https://ipfs.status.im/\r\nInfo: Warning: Ignoring XDG_SESSION_TYPE=wayland on Gnome. Use QT_QPA_PLATFORM=wayland to run on Wayland anyway. (:0, )\r\nINF 2023-11-03 10:53:02.258+11:00 Version: 0.14.1                            topics=\"status-app\" tid=7807 file=nim_status_client.nim:189\r\nINF 2023-11-03 10:53:02.258+11:00 Commit: 43748b06f                          topics=\"status-app\" tid=7807 file=nim_status_client.nim:190\r\nINF 2023-11-03 10:53:02.258+11:00 Current date:                              topics=\"status-app\" tid=7807 file=nim_status_client.nim:191 currentDateTime=2023-11-03T10:53:02+11:00\r\nINF 2023-11-03 10:53:02.258+11:00 starting application controller...         topics=\"status-app\" tid=7807 file=nim_status_client.nim:193\r\nINF 2023-11-03 10:53:04.756+11:00 starting application...                    topics=\"status-app\" tid=7807 file=nim_status_client.nim:196\r\nWRN 2023-11-03 10:53:04.756+11:00 Error decoding signal                      topics=\"signals-manager\" tid=7807 file=signals_manager.nim:41 err=\"Unknown signal received: mediaserver.started\"\r\nDebug: Network Cache Dir:  \"/home/fryorcraken/.config/Status/tmp/netcache\" (:0, )\r\nERROR[11-03|10:53:16.280] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nfailed to set `journal_mode` pragma: file is not a database\r\nERR 2023-11-03 10:53:16.280+11:00 error:                                     topics=\"accounts-service\" tid=7807 file=service.nim:619 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:53:16.744] failed to initialize wallet db           package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:53:16.745] failed to start a node                   key-uid=0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:53:16.745+11:00 node.login                                 topics=\"signals-manager\" tid=7807 file=signals_manager.nim:46 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:53:16.746+11:00 login error                                topics=\"app-controller\" tid=7807 file=module.nim:436 methodName=onNodeLogin errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\n```\r\n\r\nNote I also renamed my wallet file :\r\n\r\n```\r\n▶ cd ~/.config/Status                                                                                                                                                                                                                                                           \r\n▶ find . -name '*wallet*'\r\n./data/0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390-wallet.db                                         \r\n▶ cd data \r\n▶ mv 0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390-wallet.db 0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390-wallet.db-bk\r\n```\r\n\r\nBut still getting an error:\r\n\r\n```\r\n.config/Status/data                                                                                                                                                                                                                                                        \r\n▶ ~/.local/bin/StatusIm-Desktop-v0.14.1-43748b-x86_64.AppImage                                                                                                   \r\nINFO [11-03|10:56:29.245] Status backend initialized               backend=geth version=0.166.9 commit=c4238018a IpfsGatewayURL=https://ipfs.status.im/\r\nInfo: Warning: Ignoring XDG_SESSION_TYPE=wayland on Gnome. Use QT_QPA_PLATFORM=wayland to run on Wayland anyway. (:0, )\r\nINF 2023-11-03 10:56:29.494+11:00 Version: 0.14.1                            topics=\"status-app\" tid=11170 file=nim_status_client.nim:189\r\nINF 2023-11-03 10:56:29.495+11:00 Commit: 43748b06f                          topics=\"status-app\" tid=11170 file=nim_status_client.nim:190\r\nINF 2023-11-03 10:56:29.495+11:00 Current date:                              topics=\"status-app\" tid=11170 file=nim_status_client.nim:191 currentDateTime=2023-11-03T10:56:29+11:00\r\nINF 2023-11-03 10:56:29.495+11:00 starting application controller...         topics=\"status-app\" tid=11170 file=nim_status_client.nim:193\r\nINF 2023-11-03 10:56:31.999+11:00 starting application...                    topics=\"status-app\" tid=11170 file=nim_status_client.nim:196\r\nWRN 2023-11-03 10:56:31.999+11:00 Error decoding signal                      topics=\"signals-manager\" tid=11170 file=signals_manager.nim:41 err=\"Unknown signal received: mediaserver.started\"\r\nDebug: Network Cache Dir:  \"/home/fryorcraken/.config/Status/tmp/netcache\" (:0, )\r\nOne or more databases not created\r\nERR 2023-11-03 10:56:41.761+11:00 error:                                     topics=\"accounts-service\" tid=11170 file=service.nim:619 procName=verifyDatabasePassword errDesription=\"One or more databases not created\"\r\nERROR[11-03|10:56:42.725] failed to initialize db                  package=status-go/api.GethStatusBackend err=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERROR[11-03|10:56:42.725] failed to start a node                   key-uid=0x74c9c15fe362623c55226f9ba674fd9cca46f83c280a0fd75a7d256b0639a390 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:56:42.740+11:00 node.login                                 topics=\"signals-manager\" tid=11170 file=signals_manager.nim:46 error=\"failed to set `journal_mode` pragma: file is not a database\"\r\nERR 2023-11-03 10:56:42.742+11:00 login error                                topics=\"app-controller\" tid=11170 file=module.nim:436 methodName=onNodeLogin errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\n\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/12627/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/12627/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1792817090",
    "html_url": "https://github.com/status-im/status-desktop/issues/12627#issuecomment-1792817090",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12627",
    "id": 1792817090,
    "node_id": "IC_kwDOD5KrTM5q3DfC",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-03T17:03:11Z",
    "updated_at": "2023-11-03T17:03:11Z",
    "author_association": "MEMBER",
    "body": "`procName=verifyDatabasePassword errDesription=\"One or more databases not created\"`\r\n@alexjba does the DB recreate itself when it is renamed/deleted?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1792817090/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1794292403",
    "html_url": "https://github.com/status-im/status-desktop/issues/12627#issuecomment-1794292403",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12627",
    "id": 1794292403,
    "node_id": "IC_kwDOD5KrTM5q8rqz",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-06T08:21:08Z",
    "updated_at": "2023-11-06T08:21:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "> `procName=verifyDatabasePassword errDesription=\"One or more databases not created\"` @alexjba does the DB recreate itself when it is renamed/deleted?\r\n\r\nThis error should be from `verifyPassword` because the wallet db was renamed. But on `login` a new DB should be created.\r\n\r\nBut looking at the code, I think we might have a bug that will affect the users that are still using the upper case hash (not sure it's the case here, but I remember discussions about accounts that were never migrated to lower case hash).\r\n\r\nLet's consider a newly migrated account using upper case hash. This account doesn't have the wallet DB.\r\nWe have this flow:\r\n1. Call `verifyPassword` with the upper case hash. The wallet DB is missing and this call will fail. The application will consider the `verifyPassword` failed because the DB is encrypted using the lower case hash and will try a login.\r\n2. Call `login` with lower case hash. The wallet DB is created with the lower case hash, but the main db login will fail because it's using the upper case hash.\r\n\r\nFrom this step on, the account cannot be used.\r\nI also think that introducing a wrong password on the first login after migrating to 0.14 will have the same effect.\r\n\r\n@IvanBelyakoff Do you think this could be the case here?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1794292403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
