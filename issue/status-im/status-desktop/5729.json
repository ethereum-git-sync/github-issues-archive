{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/5729",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/5729/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/5729/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/5729/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/5729",
  "id": 1234924015,
  "node_id": "I_kwDOD5KrTM5Jm3Hv",
  "number": 5729,
  "title": "Community channels are rendered twice after joining community",
  "user": {
    "login": "0x-r4bbit",
    "id": 445106,
    "node_id": "MDQ6VXNlcjQ0NTEwNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x-r4bbit",
    "html_url": "https://github.com/0x-r4bbit",
    "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
    "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
    "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
    "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
    "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2347610790,
      "node_id": "MDU6TGFiZWwyMzQ3NjEwNzkw",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/Chat",
      "name": "Chat",
      "color": "9279e0",
      "default": false,
      "description": ""
    },
    {
      "id": 3205510054,
      "node_id": "MDU6TGFiZWwzMjA1NTEwMDU0",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/priority%201:%20high",
      "name": "priority 1: high",
      "color": "D93F0B",
      "default": false,
      "description": "an issue that is extremely important to fix, that interferes with the majority of users, occurs ofte"
    },
    {
      "id": 3955125927,
      "node_id": "LA_kwDOD5KrTM7rvm6n",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Communities",
      "name": "E:Communities",
      "color": "E56631",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "richard-ramos",
    "id": 1106587,
    "node_id": "MDQ6VXNlcjExMDY1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1106587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/richard-ramos",
    "html_url": "https://github.com/richard-ramos",
    "followers_url": "https://api.github.com/users/richard-ramos/followers",
    "following_url": "https://api.github.com/users/richard-ramos/following{/other_user}",
    "gists_url": "https://api.github.com/users/richard-ramos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/richard-ramos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/richard-ramos/subscriptions",
    "organizations_url": "https://api.github.com/users/richard-ramos/orgs",
    "repos_url": "https://api.github.com/users/richard-ramos/repos",
    "events_url": "https://api.github.com/users/richard-ramos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/richard-ramos/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "richard-ramos",
      "id": 1106587,
      "node_id": "MDQ6VXNlcjExMDY1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1106587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richard-ramos",
      "html_url": "https://github.com/richard-ramos",
      "followers_url": "https://api.github.com/users/richard-ramos/followers",
      "following_url": "https://api.github.com/users/richard-ramos/following{/other_user}",
      "gists_url": "https://api.github.com/users/richard-ramos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richard-ramos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richard-ramos/subscriptions",
      "organizations_url": "https://api.github.com/users/richard-ramos/orgs",
      "repos_url": "https://api.github.com/users/richard-ramos/repos",
      "events_url": "https://api.github.com/users/richard-ramos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richard-ramos/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/50",
    "html_url": "https://github.com/status-im/status-desktop/milestone/50",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/50/labels",
    "id": 7959065,
    "node_id": "MI_kwDOD5KrTM4AeXIZ",
    "number": 50,
    "title": "0.5.0.beta.rc0",
    "description": "",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 29,
    "state": "closed",
    "created_at": "2022-05-09T12:54:00Z",
    "updated_at": "2022-10-04T13:09:46Z",
    "due_on": "2022-05-17T07:00:00Z",
    "closed_at": "2022-10-04T13:09:46Z"
  },
  "comments": 1,
  "created_at": "2022-05-13T08:45:03Z",
  "updated_at": "2022-05-17T15:37:44Z",
  "closed_at": "2022-05-17T15:37:34Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Here's what I've done:\r\n\r\n1. I run two desktop instances with two different accounts respectively (\"A1\" and \"A2\")\r\n2. A1 is the owner of a community with two channels that have each their message history\r\n3. A1 sends A2 a contact request\r\n4. Once A2 accepts that, A1 sends A2 a link to his community\r\n5. A2 clicks \"Join\" and is taken straight to the community in the first channel\r\n\r\nHere's what it looks like:\r\n![Screenshot from 2022-05-13 10-12-59](https://user-images.githubusercontent.com/445106/168245173-82ad889f-b2bb-4294-ae50-6c400fb4e783.png)\r\n\r\nNotice a few things that are off here:\r\n\r\n1. The two channels are rendered twice\r\n2. At the same time, channel information seems to be missing, resulting desktop rendering black circles\r\n3. There are no messages in the channels (or at least the first two), but notice how the second `#test` channel is bold because it does have messages\r\n\r\nNext up, A2 selects the `#test` channel which is bold, which then shows this:\r\n\r\n![Screenshot from 2022-05-13 10-13-17](https://user-images.githubusercontent.com/445106/168245550-cccceb57-71e1-4a11-9021-d8c5a0a0bef7.png)\r\n\r\n1. We see the channel information which seems to be missing in the first two channels\r\n2. We see the last message that was sent to the channel (the only one that day, which is why there's only one to see)\r\n3. However, Members are not shown\r\n\r\nA quick look at the logs gives me these two errors:\r\n\r\n```\r\nERR 2022-05-13 10:13:26.014+02:00 rpc response error                         topics=\"rpc\" tid=123976 file=core.nim:29 err=\"\\nstatus-go error [methodName:wakuext_chatMessages, code:-32000, mes\r\nsage:can\\'t find chat ]\\n\"                                                                                                                                                                     \r\nERR 2022-05-13 10:13:26.014+02:00 [threadpool task thread] exception         topics=\"task-threadpool\" tid=123976 file=threadpool.nim:100 error=\"\\nstatus-go error [methodName:wakuext_chatMessa\r\nges, code:-32000, message:can\\'t find chat ]\\n\"\r\n```\r\nand\r\n\r\n```\r\nERR 2022-05-13 10:13:26.244+02:00 rpc response error                         topics=\"rpc\" tid=123980 file=core.nim:29 err=\"\\nstatus-go error [methodName:wakuext_markAllRead, code:-32000, mess\r\nage:chat not found ]\\n\"                                                                                                                                                                        \r\nERR 2022-05-13 10:13:26.244+02:00 [threadpool task thread] exception         topics=\"task-threadpool\" tid=123980 file=threadpool.nim:100 error=\"\\nstatus-go error [methodName:wakuext_markAllRe\r\nad, code:-32000, message:chat not found ]\\n\r\n```\r\n\r\nThere are no obvious errors related to chat members not showing though.\r\n\r\n\r\nTwo make sure this isn't a weird one-time event, I tried the thing again with a new desktop instance and a new account (\"A3\").\r\nGoing through the same steps mentioned at the beginning I see this:\r\n![Screenshot from 2022-05-13 10-43-01](https://user-images.githubusercontent.com/445106/168246121-28154553-d33d-4473-a5b8-907167a2877d.png)\r\n\r\nSo it seems be behave exactly the same (which is good because we can reproduce this). Only thing that seems different now is that the channels which are rendered twice are in different order.\r\nAnother thing that is different, is that all members are shown in all four channel instances.\r\n",
  "closed_by": {
    "login": "iurimatias",
    "id": 176720,
    "node_id": "MDQ6VXNlcjE3NjcyMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iurimatias",
    "html_url": "https://github.com/iurimatias",
    "followers_url": "https://api.github.com/users/iurimatias/followers",
    "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
    "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
    "organizations_url": "https://api.github.com/users/iurimatias/orgs",
    "repos_url": "https://api.github.com/users/iurimatias/repos",
    "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iurimatias/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/5729/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/5729/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1125807720",
    "html_url": "https://github.com/status-im/status-desktop/issues/5729#issuecomment-1125807720",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/5729",
    "id": 1125807720,
    "node_id": "IC_kwDOD5KrTM5DGnZo",
    "user": {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-13T08:48:30Z",
    "updated_at": "2022-05-13T08:48:30Z",
    "author_association": "MEMBER",
    "body": "The good news: This is not happening after restarting the app, so we're most likely handling some signals wrong in the app and it's only incorrectly stored in memory.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1125807720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
