{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/5353",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/5353/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/5353/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/5353/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/5353",
  "id": 1192828375,
  "node_id": "I_kwDOD5KrTM5HGR3X",
  "number": 5353,
  "title": "App crashes when fetching more messages",
  "user": {
    "login": "0x-r4bbit",
    "id": 445106,
    "node_id": "MDQ6VXNlcjQ0NTEwNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x-r4bbit",
    "html_url": "https://github.com/0x-r4bbit",
    "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
    "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
    "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
    "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
    "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 3166424543,
      "node_id": "MDU6TGFiZWwzMTY2NDI0NTQz",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/general",
      "name": "general",
      "color": "427672",
      "default": false,
      "description": ""
    },
    {
      "id": 3205510054,
      "node_id": "MDU6TGFiZWwzMjA1NTEwMDU0",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/priority%201:%20high",
      "name": "priority 1: high",
      "color": "D93F0B",
      "default": false,
      "description": "an issue that is extremely important to fix, that interferes with the majority of users, occurs ofte"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "0x-r4bbit",
    "id": 445106,
    "node_id": "MDQ6VXNlcjQ0NTEwNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x-r4bbit",
    "html_url": "https://github.com/0x-r4bbit",
    "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
    "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
    "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
    "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
    "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-04-05T08:50:17Z",
  "updated_at": "2022-04-13T15:16:46Z",
  "closed_at": "2022-04-13T15:16:46Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "This is something that first came up during testing the community history archive protocol, which is why I thought the crash is related to those changes. However it turns out this crash is reproducable when there's not community history archive in play at all.\r\n\r\nHere's how it happens:\r\n\r\n1. Create a community\r\n2. Create a channel\r\n3. Send some messages to that channel (although, possible this isn't necessary)\r\n4. Invite someone to that community\r\n5. Login as that someone, join the community\r\n6. Enter the channel, and click \"Fetch more messages\"\r\n\r\nThe app crashes with:\r\n\r\n```\r\nTraceback (most recent call last)\r\n/home/rabbit/projects/status-im/status-desktop/src/nim_status_client.nim(164) nim_status_client\r\n/home/rabbit/projects/status-im/status-desktop/src/nim_status_client.nim(161) mainProc\r\n/home/rabbit/projects/status-im/status-desktop/vendor/nimqml/src/nimqml/private/qguiapplication.nim(29) exec\r\n/home/rabbit/projects/status-im/status-desktop/vendor/nimqml/src/nimqml/private/qobject.nim(49) qobjectCallback\r\n/home/rabbit/projects/status-im/status-desktop/vendor/nimqml/src/nimqml/private/qobject.nim(34) onSlotCalled\r\n/home/rabbit/projects/status-im/status-desktop/vendor/nimbus-build-system/vendor/Nim/lib/core/macros.nim(587) onSlotCalled\r\n/home/rabbit/projects/status-im/status-desktop/src/app/modules/main/chat_section/chat_content/messages/view.nim(152) requestMoreMessages\r\n/home/rabbit/projects/status-im/status-desktop/src/app/modules/main/chat_section/chat_content/messages/io_interface.nim(112) requestMoreMessages\r\n/home/rabbit/projects/status-im/status-desktop/src/app/modules/main/chat_section/chat_content/messages/module.nim(474) requestMoreMessages\r\n/home/rabbit/projects/status-im/status-desktop/src/app/modules/main/chat_section/chat_content/messages/controller.nim(245) requestMoreMessages\r\n/home/rabbit/projects/status-im/status-desktop/src/app_service/service/mailservers/service.nim(83) requestMoreMessages\r\nSIGSEGV: Illegal storage access. (Attempt to read from nil?)\r\nmake: *** [Makefile:582: run-linux] Segmentation fault (core dumped)\r\n\r\n```\r\n\r\nNotice how the stack trace says that it fails at `requestMoreMessages`.\r\nThis calls `SyncChatFromSyncedFrom` in status-go. \r\nI tried debugging this but it's kinda hard. The moment the fetch more button is clicked the app crashes even ignoring logs.\r\n\r\nOne important note:\r\nWhen restarting the app (as that invited someone) and entering the channel again, hitting the \"fetch more messages\" button now doesn't crash it anymore.\r\nSo this seems to be only an issue upon recent community invite...\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "0x-r4bbit",
    "id": 445106,
    "node_id": "MDQ6VXNlcjQ0NTEwNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x-r4bbit",
    "html_url": "https://github.com/0x-r4bbit",
    "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
    "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
    "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
    "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
    "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/5353/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/5353/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1088440534",
    "html_url": "https://github.com/status-im/status-desktop/issues/5353#issuecomment-1088440534",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/5353",
    "id": 1088440534,
    "node_id": "IC_kwDOD5KrTM5A4EjW",
    "user": {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-05T08:51:52Z",
    "updated_at": "2022-04-05T08:51:52Z",
    "author_association": "MEMBER",
    "body": "Happy to investigate this further, but will work on landing https://github.com/status-im/status-go/pull/2576 and https://github.com/status-im/status-go/pull/2585",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1088440534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1088730035",
    "html_url": "https://github.com/status-im/status-desktop/issues/5353#issuecomment-1088730035",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/5353",
    "id": 1088730035,
    "node_id": "IC_kwDOD5KrTM5A5LOz",
    "user": {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-05T13:51:31Z",
    "updated_at": "2022-04-05T13:51:31Z",
    "author_association": "MEMBER",
    "body": "Noticed that the exact same thing happens after importing a community (and then trying to fetch more messages)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1088730035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
