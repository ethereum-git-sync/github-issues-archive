{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/4221",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/4221",
  "id": 1067665587,
  "node_id": "I_kwDOD5KrTM4_o0iz",
  "number": 4221,
  "title": "App doesn't close because of getLatestVersion failing and taking a long time to close the thread",
  "user": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 3166424543,
      "node_id": "MDU6TGFiZWwzMTY2NDI0NTQz",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/general",
      "name": "general",
      "color": "427672",
      "default": false,
      "description": ""
    },
    {
      "id": 3205511249,
      "node_id": "MDU6TGFiZWwzMjA1NTExMjQ5",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/priority%202:%20medium",
      "name": "priority 2: medium",
      "color": "FBCA04",
      "default": false,
      "description": "an issue that is not severely affecting the overall app, it may interfere with some users users expe"
    },
    {
      "id": 3453362183,
      "node_id": "LA_kwDOD5KrTM7N1iAH",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/on%20hold",
      "name": "on hold",
      "color": "1311DA",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-11-30T20:53:31Z",
  "updated_at": "2022-02-24T16:23:38Z",
  "closed_at": "2022-02-24T16:23:38Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "This problem is two fold.\r\n\r\nRight now, if we have a thread that has a task that takes a long time to finish and we close the app while it is running, the app won't fully close until that thread is done.\r\nThat could be fixed by finding a way to send info to that thread that we are closing and then that thread could stop it's operation, but I don't know if it's doable easily, especially with an HTTP request that is blocking as will be explained next.\r\n\r\nThe other part  of the problem is that `getLatestVersion` is currently broken and the IPFS files are unavailable because they were not pinned. To fix this, we need to re-upload the files, pin them and point the `desktop.status.eth` address to the IPFS hash. Richard is the owner of the domain for now.\r\n\r\nSo, to fix this issue, it would require to either fix one or both of those problems.\r\n\r\nLogs:\r\n\r\n```\r\nERR 2021-12-01 10:37:51.717+03:00 Error while getting latest version information tid=5407285 file=view.nim:147 msg=\"408 Request Timeout\" Traceback (most recent call last) /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/src/app_service/tasks/threadpool.nim(113) taskThread /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/vendor/status-lib/vendor/nim-task-runner/vendor/nim-chronos/chronos/asyncloop.nim(1082) waitFor /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/vendor/status-lib/vendor/nim-task-runner/vendor/nim-chronos/chronos/asyncloop.nim(279) poll /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/src/app_service/tasks/threadpool.nim(98) runner /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/src/app/utilsView/view.nim(157) :anonymous /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/src/app_service/tasks/qt.nim(16) finish /Users/jenkins/workspace/s-desktop_branches_macos_PR-4194/vendor/nimqml/src/nimqml.nim(42) signal_handler SIGSEGV: Illegal storage access. (Attempt to read from nil?) QObject::~QObject: Timers cannot be stopped from another thread\r\n```",
  "closed_by": {
    "login": "iurimatias",
    "id": 176720,
    "node_id": "MDQ6VXNlcjE3NjcyMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iurimatias",
    "html_url": "https://github.com/iurimatias",
    "followers_url": "https://api.github.com/users/iurimatias/followers",
    "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
    "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
    "organizations_url": "https://api.github.com/users/iurimatias/orgs",
    "repos_url": "https://api.github.com/users/iurimatias/repos",
    "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iurimatias/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/4221/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/983665500",
    "html_url": "https://github.com/status-im/status-desktop/issues/4221#issuecomment-983665500",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221",
    "id": 983665500,
    "node_id": "IC_kwDOD5KrTM46oYtc",
    "user": {
      "login": "anastasiyaig",
      "id": 82375995,
      "node_id": "MDQ6VXNlcjgyMzc1OTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/82375995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/anastasiyaig",
      "html_url": "https://github.com/anastasiyaig",
      "followers_url": "https://api.github.com/users/anastasiyaig/followers",
      "following_url": "https://api.github.com/users/anastasiyaig/following{/other_user}",
      "gists_url": "https://api.github.com/users/anastasiyaig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/anastasiyaig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/anastasiyaig/subscriptions",
      "organizations_url": "https://api.github.com/users/anastasiyaig/orgs",
      "repos_url": "https://api.github.com/users/anastasiyaig/repos",
      "events_url": "https://api.github.com/users/anastasiyaig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/anastasiyaig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-01T13:57:33Z",
    "updated_at": "2021-12-01T13:57:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "@iurimatias this is the issue about logout",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/983665500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/984573713",
    "html_url": "https://github.com/status-im/status-desktop/issues/4221#issuecomment-984573713",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221",
    "id": 984573713,
    "node_id": "IC_kwDOD5KrTM46r2cR",
    "user": {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-02T12:14:50Z",
    "updated_at": "2021-12-02T12:14:50Z",
    "author_association": "MEMBER",
    "body": "Thanks for detailing this issue!\r\n\r\n> That could be fixed by finding a way to send info to that thread that we are closing and then that thread could stop it's operation, but I don't know if it's doable easily, especially with an HTTP request that is blocking as will be explained next.\r\n\r\nI think this really boils down to the task runner having an API to close threads Whether there's an HTTP call or or any other I/O happening behind it shouldn't matter too much (although,  the in-flight HTTP request can't be cancelled anymore, but that shouldn't keep us from closing the thread).\r\n\r\nI've looked into the code and was surprised we're checking for updates on initialization right away, but I guess it does make sense if we want to prompt users that a new version is available.\r\nOne thing we can do for now (at least to have it unblock the release), is to **not** check for updates implicitly, but wait for users to actually perform the check. \r\n\r\nWe would then at least:\r\n\r\n1. not have a broken sign out process anymore because the threaded task is pushed back to some later point in time. In fact it may never happen because the user might not run it (I guess though, the same issue will occur with any other thread task that takes too long, so this is really just fighting symptoms)\r\n1.1 Another option would be to see if we could put a timeout into the HTTP call so that even if it replies with a bad gateway (which takes time and is slow), we can at least control the amount of time we're willing to wait\r\n2. make it explicit for the user in the sense that, when checks for updates are done, a loading indication can be shown (should do that either way btw). Then when the user closes the app beforehand, it's a bit more \"expected\" something might be wrong (instead looking at some freezing app).\r\n\r\n> The other part of the problem is that getLatestVersion is currently broken and the IPFS files are unavailable because they were not pinned. To fix this, we need to re-upload the files, pin them and point the desktop.status.eth address to the IPFS hash. Richard is the owner of the domain for now.\r\n\r\nDo we know what's the current process for uploading/pinning those files? Is this done manually by someone? Do we have to do this on a periodical basis, so it would make sense to automate this?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/984573713/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/984679690",
    "html_url": "https://github.com/status-im/status-desktop/issues/4221#issuecomment-984679690",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221",
    "id": 984679690,
    "node_id": "IC_kwDOD5KrTM46sQUK",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-02T14:30:33Z",
    "updated_at": "2021-12-02T14:30:33Z",
    "author_association": "MEMBER",
    "body": ">  Another option would be to see if we could put a timeout into the HTTP call so that even if it replies with a bad gateway\r\n\r\nThis would be very helpful. Right now, the `timeout` property of `httpclient` seems broken as listed here: https://github.com/nim-lang/Nim/issues/14807#issuecomment-921646701\r\nFixing that timeout would at least help in the case of http requests\r\n\r\n> Do we know what's the current process for uploading/pinning those files? Is this done manually by someone? Do we have to do this on a periodical basis, so it would make sense to automate this?\r\n\r\nRight now, @richard-ramos does it manually. Apparently, there is/was a tool that was in the works to make that process automatic.\r\nAnyway, I feel like if we have to manually do that process each time we have a new release, it is not a good thing. We should check where the tool is at and see if in the meantime we don't want to do something else for the version check (like checking on Github or something)",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/984679690/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1050029418",
    "html_url": "https://github.com/status-im/status-desktop/issues/4221#issuecomment-1050029418",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/4221",
    "id": 1050029418,
    "node_id": "IC_kwDOD5KrTM4-li1q",
    "user": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-24T16:23:38Z",
    "updated_at": "2022-02-24T16:23:38Z",
    "author_association": "MEMBER",
    "body": "no longer relevant and will be fixed by #4884",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1050029418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
