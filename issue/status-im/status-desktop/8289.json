{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/8289",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/8289/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/8289/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/8289/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/8289",
  "id": 1451749652,
  "node_id": "I_kwDOD5KrTM5Wh_EU",
  "number": 8289,
  "title": "Chat `categoryId` is cleared with receiving new message",
  "user": {
    "login": "igor-sirotin",
    "id": 25482501,
    "node_id": "MDQ6VXNlcjI1NDgyNTAx",
    "avatar_url": "https://avatars.githubusercontent.com/u/25482501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/igor-sirotin",
    "html_url": "https://github.com/igor-sirotin",
    "followers_url": "https://api.github.com/users/igor-sirotin/followers",
    "following_url": "https://api.github.com/users/igor-sirotin/following{/other_user}",
    "gists_url": "https://api.github.com/users/igor-sirotin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/igor-sirotin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/igor-sirotin/subscriptions",
    "organizations_url": "https://api.github.com/users/igor-sirotin/orgs",
    "repos_url": "https://api.github.com/users/igor-sirotin/repos",
    "events_url": "https://api.github.com/users/igor-sirotin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/igor-sirotin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-16T14:52:49Z",
  "updated_at": "2023-04-25T08:25:30Z",
  "closed_at": "2023-04-25T08:25:30Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n## Description\r\n\r\nThe signal about new message in a community channel contains no `categoryId` for chat.\r\nWith this signal chat information is updated in desktop and therefore `categoryId` is cleared.\r\n\r\nI need this `categoryId` field to retrieve information for OS notifications.\r\n\r\n\r\n```json\r\n{\r\n    \"type\": \"messages.new\",\r\n    \"event\": {\r\n        \"chats\": [\r\n            {\r\n                \"id\": \"0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9075b04ef-45d3-44ea-963d-05e51ffa2fc5\",\r\n                \"name\": \"general\",\r\n                \"description\": \"General channel for the community\",\r\n                \"color\": \"#4360DF\",\r\n                \"emoji\": \"\",\r\n                \"active\": true,\r\n                \"chatType\": 6,\r\n                \"timestamp\": 1668609834150,\r\n                \"lastClockValue\": 1668609833106,\r\n                \"deletedAtClockValue\": 0,\r\n                \"ReadMessagesAtClockValue\": 1668536567731,\r\n                \"unviewedMessagesCount\": 21,\r\n                \"unviewedMentionsCount\": 0,\r\n                \"lastMessage\": {\r\n                    \"id\": \"0xb49bcd9cd153ad79e03fd1a18ecf3d04c7e41c0bf9bd43a82dd33d09f1e346e6\",\r\n                    \"whisperTimestamp\": 1668609833000,\r\n                    \"from\": \"0x0476397bc3b03711383d714d115b2e3999a3477eb441b295ee02385c7fa35328368eec4120c1d7286b0916d38aef7bc415f800cd26d6df1642592183e87e0ab508\",\r\n                    \"alias\": \"Wild Feisty Goldenmantledgroundsquirrel\",\r\n                    \"identicon\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAiklEQVR4nOzWwQmFQAwG4ffEXmzLIizDImzLarQBhSwSGH7mO+9hh0DI9AthCI0hNIbQGEJjCI0hNIbQxITM1YfHfl69X3m2bsu/8i5mIobQGEJjCI0hNIbQlG+tUW83UtfNFjMRQ2gMofm8tUa3U9c2i5mIITSGqEnMRAyhMYTGEBpDaO4AAAD//5POEGncqtj1AAAAAElFTkSuQmCC\",\r\n                    \"seen\": false,\r\n                    \"quotedMessage\": null,\r\n                    \"rtl\": false,\r\n                    \"parsedText\": [\r\n                        {\r\n                            \"type\": \"paragraph\",\r\n                            \"children\": [\r\n                                {\r\n                                    \"literal\": \"66\"\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    \"lineCount\": 0,\r\n                    \"text\": \"66\",\r\n                    \"chatId\": \"0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9075b04ef-45d3-44ea-963d-05e51ffa2fc5\",\r\n                    \"localChatId\": \"0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9075b04ef-45d3-44ea-963d-05e51ffa2fc5\",\r\n                    \"clock\": 1668609833106,\r\n                    \"replace\": \"\",\r\n                    \"responseTo\": \"\",\r\n                    \"new\": true,\r\n                    \"ensName\": \"sirotin.stateofus.eth\",\r\n                    \"displayName\": \"sirotin\",\r\n                    \"timestamp\": 1668609833106,\r\n                    \"contentType\": 1,\r\n                    \"messageType\": 5\r\n                },\r\n                \"members\": null,\r\n                \"membershipUpdateEvents\": null,\r\n                \"identicon\": \"\",\r\n                \"muted\": false,\r\n                \"communityId\": \"0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9\",\r\n                \"joined\": 1667303635723,\r\n                \"syncedTo\": 1668609822,\r\n                \"syncedFrom\": 1666525975,\r\n                \"firstMessageTimestamp\": 1666714383\r\n            }\r\n        ],\r\n        \"messages\": [\r\n            {\r\n                \"id\": \"0xb49bcd9cd153ad79e03fd1a18ecf3d04c7e41c0bf9bd43a82dd33d09f1e346e6\",\r\n                \"whisperTimestamp\": 1668609833000,\r\n                \"from\": \"0x0476397bc3b03711383d714d115b2e3999a3477eb441b295ee02385c7fa35328368eec4120c1d7286b0916d38aef7bc415f800cd26d6df1642592183e87e0ab508\",\r\n                \"alias\": \"Wild Feisty Goldenmantledgroundsquirrel\",\r\n                \"identicon\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAiklEQVR4nOzWwQmFQAwG4ffEXmzLIizDImzLarQBhSwSGH7mO+9hh0DI9AthCI0hNIbQGEJjCI0hNIbQxITM1YfHfl69X3m2bsu/8i5mIobQGEJjCI0hNIbQlG+tUW83UtfNFjMRQ2gMofm8tUa3U9c2i5mIITSGqEnMRAyhMYTGEBpDaO4AAAD//5POEGncqtj1AAAAAElFTkSuQmCC\",\r\n                \"seen\": false,\r\n                \"quotedMessage\": null,\r\n                \"rtl\": false,\r\n                \"parsedText\": [\r\n                    {\r\n                        \"type\": \"paragraph\",\r\n                        \"children\": [\r\n                            {\r\n                                \"literal\": \"66\"\r\n                            }\r\n                        ]\r\n                    }\r\n                ],\r\n                \"lineCount\": 0,\r\n                \"text\": \"66\",\r\n                \"chatId\": \"0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9075b04ef-45d3-44ea-963d-05e51ffa2fc5\",\r\n                \"localChatId\": \"0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9075b04ef-45d3-44ea-963d-05e51ffa2fc5\",\r\n                \"clock\": 1668609833106,\r\n                \"replace\": \"\",\r\n                \"responseTo\": \"\",\r\n                \"new\": true,\r\n                \"ensName\": \"\",\r\n                \"displayName\": \"\",\r\n                \"gapParameters\": {},\r\n                \"timestamp\": 1668609833106,\r\n                \"contentType\": 1,\r\n                \"messageType\": 5\r\n            }\r\n        ],\r\n        \"notifications\": null,\r\n        \"discordOldestMessageTimestamp\": 0\r\n    }\r\n}\r\n```\r\n\r\n\r\nMy log output in  Chat.Service `updateOrAddChat`:\r\n```bash\r\n<<<--- updating chat: chatId = 0x02679b8c5d4b3a9e2f9258f3378362f1bec95bab89c760d39661911da49ea7aef9075b04ef-45d3-44ea-963d-05e51ffa2fc5\r\nprevious categoryId = d235a5aa-721f-485a-92a1-86e9893ae7cb\r\nnew categoryId = \r\n```\r\n\r\n## Steps to reproduce\r\n\r\n1. With user X create a community\r\n2. Create a category and a channel in it\r\n3. Add user Y to the community\r\n4. Send a message to a created channel\r\n5. User Y receives a `new.message` signal with a chat having no `categoryId`.\r\n\r\n\r\n",
  "closed_by": {
    "login": "igor-sirotin",
    "id": 25482501,
    "node_id": "MDQ6VXNlcjI1NDgyNTAx",
    "avatar_url": "https://avatars.githubusercontent.com/u/25482501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/igor-sirotin",
    "html_url": "https://github.com/igor-sirotin",
    "followers_url": "https://api.github.com/users/igor-sirotin/followers",
    "following_url": "https://api.github.com/users/igor-sirotin/following{/other_user}",
    "gists_url": "https://api.github.com/users/igor-sirotin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/igor-sirotin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/igor-sirotin/subscriptions",
    "organizations_url": "https://api.github.com/users/igor-sirotin/orgs",
    "repos_url": "https://api.github.com/users/igor-sirotin/repos",
    "events_url": "https://api.github.com/users/igor-sirotin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/igor-sirotin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/8289/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/8289/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1317291775",
    "html_url": "https://github.com/status-im/status-desktop/issues/8289#issuecomment-1317291775",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8289",
    "id": 1317291775,
    "node_id": "IC_kwDOD5KrTM5OhEb_",
    "user": {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-16T16:23:49Z",
    "updated_at": "2022-11-16T16:23:49Z",
    "author_association": "MEMBER",
    "body": "@igor-sirotin took the freedom to update your issue description as the JSON was unreadable.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1317291775/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1521382084",
    "html_url": "https://github.com/status-im/status-desktop/issues/8289#issuecomment-1521382084",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8289",
    "id": 1521382084,
    "node_id": "IC_kwDOD5KrTM5arnLE",
    "user": {
      "login": "igor-sirotin",
      "id": 25482501,
      "node_id": "MDQ6VXNlcjI1NDgyNTAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25482501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/igor-sirotin",
      "html_url": "https://github.com/igor-sirotin",
      "followers_url": "https://api.github.com/users/igor-sirotin/followers",
      "following_url": "https://api.github.com/users/igor-sirotin/following{/other_user}",
      "gists_url": "https://api.github.com/users/igor-sirotin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/igor-sirotin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/igor-sirotin/subscriptions",
      "organizations_url": "https://api.github.com/users/igor-sirotin/orgs",
      "repos_url": "https://api.github.com/users/igor-sirotin/repos",
      "events_url": "https://api.github.com/users/igor-sirotin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/igor-sirotin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-25T08:25:30Z",
    "updated_at": "2023-04-25T08:25:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seems to be fixed in https://github.com/status-im/status-desktop/pull/9064",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1521382084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
