{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/11967",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/11967",
  "id": 1859460076,
  "node_id": "I_kwDOD5KrTM5u1Rvs",
  "number": 11967,
  "title": "Community direct invite doesn't show up sometimes ",
  "user": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 4548141040,
      "node_id": "LA_kwDOD5KrTM8AAAABDxcf8A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/messenger-team",
      "name": "messenger-team",
      "color": "232858",
      "default": false,
      "description": ""
    },
    {
      "id": 5745637395,
      "node_id": "LA_kwDOD5KrTM8AAAABVnd4Ew",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Desktop%20Community%20Bugfixes%20MVP",
      "name": "E:Desktop Community Bugfixes MVP",
      "color": "01CE46",
      "default": false,
      "description": "Misc bug fixes about communities that are due for the MVP"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [
    {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/76",
    "html_url": "https://github.com/status-im/status-desktop/milestone/76",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/76/labels",
    "id": 9826175,
    "node_id": "MI_kwDOD5KrTM4Ale9_",
    "number": 76,
    "title": "0.14.0 RC",
    "description": "",
    "creator": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 4,
    "closed_issues": 1,
    "state": "open",
    "created_at": "2023-08-22T18:32:10Z",
    "updated_at": "2023-08-23T18:15:47Z",
    "due_on": "2023-09-01T07:00:00Z",
    "closed_at": null
  },
  "comments": 3,
  "created_at": "2023-08-21T14:07:05Z",
  "updated_at": "2023-08-23T21:03:39Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n## Description\r\n\r\nDiscovered using the Status Wallet team community.\r\n\r\nAnthony, who's an admin, tried to invite me using a direct invite (using the modal), and I don,t see it appearing in the chat list.\r\n\r\nI see those logs:\r\n```\r\nINF 2023-08-21 09:56:52.272-04:00 received                                   topics=\"signals-manager\" tid=31513 file=messages.nim:70 signal=messages.new messageID=0x14a5194839afdaeb92a3e0f17e0217e6cc97b1cc75656584d14a76c0653eb37b\r\nERR 2023-08-21 09:56:52.274-04:00 requested community doesn't exists         topics=\"community-service\" tid=31513 file=service.nim:715 communityId=0x04cfd95ab9ba683134943979e5fbecd1713298e2db9b81e46e9775d73bb3e4fe511d0774f5fd0d19d60ca252469baa4d21855a908edc3db47847fa2d6303ff\r\n```\r\n\r\n## Steps to reproduce\r\n\r\nUnsure, but maybe it needs a community with an admin permission\r\n\r\nSend the invite from the admin to a non-member.\r\n\r\nResult: nothing shows in the chat\r\n\r\n#### Expected behavior\r\n\r\nThe invite shows up\r\n\r\n### Additional Information\r\n\r\n- Status desktop version: master `3e8f710560149022d38aeb27227e8fa482de2d86` \r\n- Operating System: Ubuntu 20\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/11967/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1690560166",
    "html_url": "https://github.com/status-im/status-desktop/issues/11967#issuecomment-1690560166",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967",
    "id": 1690560166,
    "node_id": "IC_kwDOD5KrTM5kw-am",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T20:02:24Z",
    "updated_at": "2023-08-23T20:02:24Z",
    "author_association": "MEMBER",
    "body": "I've found the issue here.\r\n\r\nIt's that when an admin sends a direct invite (or shares the community), they use the encrypted community they already have in their DB, because they can't encrypt it themselves.\r\n\r\nHowever, it then doesn't have the signature, so in `HandleWrappedCommunityDescriptionMessage`, `applicationMetadataMessage.RecoverKey()` returns empty (no signer). That then throws an error in the `HandleCommunityDescriptionMessage`.\r\n\r\nI'm trying to figure out if it's better to just handle that on the receiver side and accept the description from the admin as is. Then I just need to figure out how to add the CommunityID to the message properly so that I can save it (the description doesn't have the ID).\r\n\r\nAnother option is to fix on the sender side, but that would require saving the control node's signature and sending it as part of the message. I'm not sure if that's even doable.\r\n\r\n@mprakhov have you experienced that type of scenario when doing the Admin work? What do you recommend?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1690560166/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1690571273",
    "html_url": "https://github.com/status-im/status-desktop/issues/11967#issuecomment-1690571273",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967",
    "id": 1690571273,
    "node_id": "IC_kwDOD5KrTM5kxBIJ",
    "user": {
      "login": "mprakhov",
      "id": 117639195,
      "node_id": "U_kgDOBwMIGw",
      "avatar_url": "https://avatars.githubusercontent.com/u/117639195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mprakhov",
      "html_url": "https://github.com/mprakhov",
      "followers_url": "https://api.github.com/users/mprakhov/followers",
      "following_url": "https://api.github.com/users/mprakhov/following{/other_user}",
      "gists_url": "https://api.github.com/users/mprakhov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mprakhov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mprakhov/subscriptions",
      "organizations_url": "https://api.github.com/users/mprakhov/orgs",
      "repos_url": "https://api.github.com/users/mprakhov/repos",
      "events_url": "https://api.github.com/users/mprakhov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mprakhov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T20:11:04Z",
    "updated_at": "2023-08-23T20:11:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jrainville I think I missed this scenario (admin invite)\r\nQuestion - if the admin invites the user - can he send `CommunityDescriptionProtocolMessage`? This msg contains control node signature",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1690571273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1690635700",
    "html_url": "https://github.com/status-im/status-desktop/issues/11967#issuecomment-1690635700",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/11967",
    "id": 1690635700,
    "node_id": "IC_kwDOD5KrTM5kxQ20",
    "user": {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T21:03:39Z",
    "updated_at": "2023-08-23T21:03:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I've found the issue here.\r\n> \r\n> It's that when an admin sends a direct invite (or shares the community), they use the encrypted community they already have in their DB, because they can't encrypt it themselves.\r\n> \r\n> However, it then doesn't have the signature, so in `HandleWrappedCommunityDescriptionMessage`, `applicationMetadataMessage.RecoverKey()` returns empty (no signer). That then throws an error in the `HandleCommunityDescriptionMessage`.\r\n> \r\n> I'm trying to figure out if it's better to just handle that on the receiver side and accept the description from the admin as is. Then I just need to figure out how to add the CommunityID to the message properly so that I can save it (the description doesn't have the ID).\r\n> \r\n> Another option is to fix on the sender side, but that would require saving the control node's signature and sending it as part of the message. I'm not sure if that's even doable.\r\n> \r\n> @mprakhov have you experienced that type of scenario when doing the Admin work? What do you recommend?\r\n\r\nSee: https://github.com/status-im/status-desktop/issues/11859. It was resolved already, `CommunityDescription` stored in database should be signed by control node, so that we can share it with others.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1690635700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
