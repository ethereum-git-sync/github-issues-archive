{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/9073",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/9073/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/9073/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/9073/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/9073",
  "id": 1529671876,
  "node_id": "I_kwDOD5KrTM5bLPDE",
  "number": 9073,
  "title": "Seeing a new community link in a channel shouldn't fetch anything from it apart from the metadata",
  "user": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2588688093,
      "node_id": "MDU6TGFiZWwyNTg4Njg4MDkz",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/Communities",
      "name": "Communities",
      "color": "3923e0",
      "default": false,
      "description": ""
    },
    {
      "id": 2987757762,
      "node_id": "MDU6TGFiZWwyOTg3NzU3NzYy",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/to%20analyze",
      "name": "to analyze",
      "color": "5CC421",
      "default": false,
      "description": ""
    },
    {
      "id": 3205511249,
      "node_id": "MDU6TGFiZWwzMjA1NTExMjQ5",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/priority%202:%20medium",
      "name": "priority 2: medium",
      "color": "FBCA04",
      "default": false,
      "description": "an issue that is not severely affecting the overall app, it may interfere with some users users expe"
    },
    {
      "id": 3904301025,
      "node_id": "LA_kwDOD5KrTM7otufh",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:PerformanceImprovements",
      "name": "E:PerformanceImprovements",
      "color": "7D613C",
      "default": false,
      "description": ""
    },
    {
      "id": 3955125927,
      "node_id": "LA_kwDOD5KrTM7rvm6n",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Communities",
      "name": "E:Communities",
      "color": "E56631",
      "default": false,
      "description": ""
    },
    {
      "id": 4220089404,
      "node_id": "LA_kwDOD5KrTM77iXQ8",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/S:3",
      "name": "S:3",
      "color": "03A6A2",
      "default": false,
      "description": "We know what needs to be done, some extra steps, but thatâ€™s it, little to no unknowns"
    },
    {
      "id": 4548141040,
      "node_id": "LA_kwDOD5KrTM8AAAABDxcf8A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/messenger-team",
      "name": "messenger-team",
      "color": "232858",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/54",
    "html_url": "https://github.com/status-im/status-desktop/milestone/54",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/54/labels",
    "id": 8475707,
    "node_id": "MI_kwDOD5KrTM4AgVQ7",
    "number": 54,
    "title": "0.10.0",
    "description": "General:\r\n- Memory Usage Improvements (part 3)\r\n\r\nGeneral:\r\n- Account Syncing",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 95,
    "state": "closed",
    "created_at": "2022-09-28T20:31:48Z",
    "updated_at": "2023-02-13T17:24:23Z",
    "due_on": "2023-01-27T08:00:00Z",
    "closed_at": "2023-02-01T14:52:43Z"
  },
  "comments": 2,
  "created_at": "2023-01-11T20:45:49Z",
  "updated_at": "2023-01-23T16:49:46Z",
  "closed_at": "2023-01-23T16:49:46Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n## Description\r\n\r\nIuri just experienced a case where he joined `#test` and there were a lot of community links and then he got a lot of those calls:\r\n\r\n```\r\nDBG 2023-01-11 15:38:02.780-05:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=8361757 file=core.nim:20 rpc_method=wakuext_messageByMessageID\r\nDBG 2023-01-11 15:38:02.781-05:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=8361757 file=core.nim:20 rpc_method=wakuext_emojiReactionsByChatIDMessageID\r\n\r\nDBG 2023-01-11 15:38:07.065-05:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=8361757 file=core.nim:20 rpc_method=chat_getMember\r\n```\r\n\r\nIf this is indeed what happened, we need to fix it.\r\n\r\nWe should only fetch the metadata of the community, ie name, description and member count.\r\n\r\nOnly when the community is spectated do we want to get more details like the messages.\r\n\r\n",
  "closed_by": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/9073/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/9073/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1385459292",
    "html_url": "https://github.com/status-im/status-desktop/issues/9073#issuecomment-1385459292",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/9073",
    "id": 1385459292,
    "node_id": "IC_kwDOD5KrTM5SlG5c",
    "user": {
      "login": "0x-r4bbit",
      "id": 445106,
      "node_id": "MDQ6VXNlcjQ0NTEwNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/445106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x-r4bbit",
      "html_url": "https://github.com/0x-r4bbit",
      "followers_url": "https://api.github.com/users/0x-r4bbit/followers",
      "following_url": "https://api.github.com/users/0x-r4bbit/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x-r4bbit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x-r4bbit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x-r4bbit/subscriptions",
      "organizations_url": "https://api.github.com/users/0x-r4bbit/orgs",
      "repos_url": "https://api.github.com/users/0x-r4bbit/repos",
      "events_url": "https://api.github.com/users/0x-r4bbit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x-r4bbit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T13:54:22Z",
    "updated_at": "2023-01-17T13:54:22Z",
    "author_association": "MEMBER",
    "body": "I've just tried this and I experience the same. **However** judging by the logs, I don't think what you guys describe here is really what's happening.\r\n\r\nThis\r\n```\r\nDBG 2023-01-11 15:38:02.780-05:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=8361757 file=core.nim:20 rpc_method=wakuext_messageByMessageID\r\nDBG 2023-01-11 15:38:02.781-05:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=8361757 file=core.nim:20 rpc_method=wakuext_emojiReactionsByChatIDMessageID\r\n```\r\nSeems to be happening for every message in the channel.\r\n\r\nAnd this one:\r\n```\r\nDBG 2023-01-11 15:38:07.065-05:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=8361757 file=core.nim:20 rpc_method=chat_getMembers\r\n```\r\n\r\nSeems to be called once upon joining the channel as well. I also see it a second time after all emoji reactions where requested.\r\nThis seems unrelated yet to whether the messages contain community invites.\r\n\r\nThen, I do see a bunch of\r\n\r\n```\r\nDBG 2023-01-17 14:46:07.293+01:00 NewBE_callPrivateRPC                       topics=\"rpc\" tid=2683851 file=core.nim:20 rpc_method=wakuext_requestCommunityInfoFromMailserver                   \r\nDBG 2023-01-17 14:46:07.327+01:00 [threadpool task thread] initiating task   topics=\"task-threadpool\" tid=2683852 file=threadpool.nim:92 messageType=AsyncRequestCommunityInfoTaskArg:ObjectTyp\r\ne threadid=11 task=\"{\\\"$type\\\":\\\"AsyncRequestCommunityInfoTaskArg:ObjectType\\\",\\\"communityId\\\":\\\"0x03ec4ee5fe1684254bb3486df8176eeae9ae847ce66067bfd9337129cef0328bfe\\\",\\\"vptr\\\":94332371200128\r\n,\\\"slot\\\":\\\"asyncCommunityInfoLoaded\\\",\\\"tptr\\\":94332345954896}\"    \r\n```\r\n\r\nWhich we get once per shared community ^ This seems correct so far\r\n\r\nThere's no new `chat_getMembers` call after that.\r\nSo It seems this was a misinterpretation.\r\n\r\nI assume the `chat_getMembers` call is just a standard procedure for every channel we join. We could probably remove that call if the chat is a public channel ( we want to get rid of those inside Status anyways), but other than that, it doesn't look like we're fetching more information than needed. \r\n\r\nThe community info requested from mailservers are also just community description, so it's just metadata.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1385459292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1400661261",
    "html_url": "https://github.com/status-im/status-desktop/issues/9073#issuecomment-1400661261",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/9073",
    "id": 1400661261,
    "node_id": "IC_kwDOD5KrTM5TfGUN",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-23T16:49:46Z",
    "updated_at": "2023-01-23T16:49:46Z",
    "author_association": "MEMBER",
    "body": "According to Pascal's findings, only the members call is not ok for a public chat, and public chats are going away as part of https://github.com/status-im/status-desktop/issues/8504, so we should be ok.\r\n\r\nClosing for now. Reopen if we experience something similar again",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1400661261/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
