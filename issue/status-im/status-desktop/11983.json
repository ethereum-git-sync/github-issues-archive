{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/11983",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/11983/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/11983/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/11983/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/11983",
  "id": 1861380564,
  "node_id": "I_kwDOD5KrTM5u8mnU",
  "number": 11983,
  "title": "General approach for displaying contact details",
  "user": {
    "login": "MishkaRogachev",
    "id": 2522130,
    "node_id": "MDQ6VXNlcjI1MjIxMzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2522130?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MishkaRogachev",
    "html_url": "https://github.com/MishkaRogachev",
    "followers_url": "https://api.github.com/users/MishkaRogachev/followers",
    "following_url": "https://api.github.com/users/MishkaRogachev/following{/other_user}",
    "gists_url": "https://api.github.com/users/MishkaRogachev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MishkaRogachev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MishkaRogachev/subscriptions",
    "organizations_url": "https://api.github.com/users/MishkaRogachev/orgs",
    "repos_url": "https://api.github.com/users/MishkaRogachev/repos",
    "events_url": "https://api.github.com/users/MishkaRogachev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MishkaRogachev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2987757762,
      "node_id": "MDU6TGFiZWwyOTg3NzU3NzYy",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/to%20analyze",
      "name": "to analyze",
      "color": "5CC421",
      "default": false,
      "description": ""
    },
    {
      "id": 5806024051,
      "node_id": "LA_kwDOD5KrTM8AAAABWhDlcw",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Desktop%20Contact%20Requests",
      "name": "E:Desktop Contact Requests",
      "color": "F88BBF",
      "default": false,
      "description": "Anything related to mutual contacts and sending/receiving contact requests"
    },
    {
      "id": 6014763800,
      "node_id": "LA_kwDOD5KrTM8AAAABZoIDGA",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Misc%20Bugfixes",
      "name": "E:Misc Bugfixes",
      "color": "61D0D9",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-22T12:41:23Z",
  "updated_at": "2023-11-06T15:46:54Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### The Problem\r\n\r\nIn general, we display model-based contact details using the standard QAbstractItemModel mechanisms. However, in a few\r\nIn a few places we need to display contact details based on a specific contactId. Here are just a few of them:\r\n\r\n- [Profile](https://github.com/status-im/status-desktop/blob/master/ui/imports/shared/views/ProfileDialogView.qml#L87)\r\n- [Contact Verification](https://github.com/status-im/status-desktop/blob/master/ui/imports/shared/popups/ContactVerificationRequestPopup.qml#L49)\r\n- [TransactionAddress](https://github.com/status-im/status-desktop/blob/master/ui/imports/shared/controls/TransactionAddress.qml#L128-L129)\r\n- [Activity Center](https://github.com/status-im/status-desktop/blob/master/ui/app/mainui/activitycenter/views/ActivityNotificationMessage.qml#L62) (and there are few more connections for different Actypes and this is done deliberately)\r\n- Contacts for 1-to-1 chats in [RootStore](https://github.com/status-im/status-desktop/blob/master/ui/app/AppLayouts/Chat/stores/RootStore.qml#L730)\r\n\r\nWe use the `Utils.getContactDetailsAsJson` function to retrieve the data, but we also need to know about updates to this contact's and for this we subscribe to the signal from the model in contactsStore. More precisely, to 3 different models because contacts are stored in `myContactsModel`, `receivedContactRequestsModel`, `sentContactRequestsModel`. And we don't receive signals about users who are not in contacts, and we won't see until restart that the user has changed profile pic or alias.\r\n\r\nAnother problem is that requesting contact data by id is synchronous and can lead to frezzes on UI\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/11983/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/11983/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1696222154",
    "html_url": "https://github.com/status-im/status-desktop/issues/11983#issuecomment-1696222154",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/11983",
    "id": 1696222154,
    "node_id": "IC_kwDOD5KrTM5lGkvK",
    "user": {
      "login": "igor-sirotin",
      "id": 25482501,
      "node_id": "MDQ6VXNlcjI1NDgyNTAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25482501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/igor-sirotin",
      "html_url": "https://github.com/igor-sirotin",
      "followers_url": "https://api.github.com/users/igor-sirotin/followers",
      "following_url": "https://api.github.com/users/igor-sirotin/following{/other_user}",
      "gists_url": "https://api.github.com/users/igor-sirotin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/igor-sirotin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/igor-sirotin/subscriptions",
      "organizations_url": "https://api.github.com/users/igor-sirotin/orgs",
      "repos_url": "https://api.github.com/users/igor-sirotin/repos",
      "events_url": "https://api.github.com/users/igor-sirotin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/igor-sirotin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-28T19:04:08Z",
    "updated_at": "2023-08-28T19:04:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'd like to mention another related problem.\r\n\r\n## Intro details\r\n\r\nWhen working on https://github.com/status-im/status-desktop/issues/11854 I discovered this property:\r\nhttps://github.com/status-im/status-desktop/blob/123ed272c20a3c1d49f29c69c6a508fe319dedee/ui/app/AppLayouts/Chat/stores/RootStore.qml#L732\r\nwhich is updated with many `Connections`/`Binding` components below, e.g. this one:\r\nhttps://github.com/status-im/status-desktop/blob/10a7b385d548a725ff7cddba29a5e775b9b41c09/ui/app/AppLayouts/Chat/stores/RootStore.qml#L785-L790\r\n\r\n## The problem\r\n\r\nI found out that the `when` condition doesn't seem to work correctly here, we make a lot of `getContactDetailsAsJson` calls with `_d.activeChatType === 6`, which is a community channel.\r\n\r\nThis leads to this an error in logs:\r\n```\r\nDBG 2023-08-24 19:19:02.087+03:00 id doesn't have expected length            topics=\"contacts-service\" tid=34034906 file=service.nim:400 pubkey=0x039fe1dbdd83e6c903f00da15a36ba5279699090aac77f87859bf6da2705f149ee36639205-3654-4bd3-aaad-2ddc4522fc1e parsedChars=76 expectedLength=132\r\n```\r\n\r\n## And what?\r\n\r\nI don't think that this call is a big deal, but I'm pretty sure that this is only the top of an iceberg. There might be other problems related to this behaviour.\r\n\r\nCreating a general approach should fix this as well.\r\n\r\n__________\r\n\r\ncc @alexjba @MishkaRogachev ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1696222154/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
