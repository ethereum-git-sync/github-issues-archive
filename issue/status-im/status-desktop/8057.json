{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/8057",
  "id": 1424350153,
  "node_id": "I_kwDOD5KrTM5U5dvJ",
  "number": 8057,
  "title": "tst_wallet causes big spike in TCP TIME_WAIT sockets",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 6005635869,
      "node_id": "LA_kwDOD5KrTM8AAAABZfa7HQ",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Desktop%20CI",
      "name": "E:Desktop CI",
      "color": "46A660",
      "default": false,
      "description": ""
    },
    {
      "id": 6014763800,
      "node_id": "LA_kwDOD5KrTM8AAAABZoIDGA",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/E:Misc%20Bugfixes",
      "name": "E:Misc Bugfixes",
      "color": "61D0D9",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2022-10-26T16:36:05Z",
  "updated_at": "2023-11-06T16:08:24Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThis is an issue that sometimes shows up as the following error:\r\n```\r\nRuntimeError: Could not connect to Squish server at host localhost, port 44451:\r\nConnection refused (possible reasons: 'squishserver' process not running or listening on a different port, or firewall issue)\r\n```\r\nThe port of course changes, but the fundamental issue is that when the `tst_wallet` suite runs we can see a big spike in `TIME_WAIT` sockets:\r\n\r\n![image](https://user-images.githubusercontent.com/2212681/198082555-f81e4426-c25b-4900-977f-1a4206fac6dd.png)\r\n```\r\n2022-10-26T16:16:57Z test case tst_wallet started\r\n2022-10-26T16:22:33Z test case end\r\n```\r\nhttps://ci.status.im/job/status-desktop/job/branches/job/uitests/job/PR-7789/58/console\r\n\r\nThe biggest spike appears right before the test suite finishes.\r\n\r\nThis issue was originally identified in:\r\n\r\n* https://github.com/status-im/status-desktop/pull/8051\r\n\r\nYou can see some more examples in https://github.com/status-im/status-desktop/pull/8051#issuecomment-1292276298.\r\n\r\n## Additional Information\r\n\r\nI've managed to collect some extra information when this was happening:\r\n\r\n* [`netstat_20221026T162216Z.log`](https://github.com/status-im/status-desktop/files/9871928/netstat_20221026T162216Z.log) - Which contains 964 sockets, out of which 931 are in `TIME_WAIT` state.\r\n* [`ps_20221026T162216Z.log`](https://github.com/status-im/status-desktop/files/9871934/ps_20221026T162216Z.log) - Which contains the process tree at the time when the `tst_wallet` test suite was running.\r\n",
  "closed_by": {
    "login": "iurimatias",
    "id": 176720,
    "node_id": "MDQ6VXNlcjE3NjcyMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iurimatias",
    "html_url": "https://github.com/iurimatias",
    "followers_url": "https://api.github.com/users/iurimatias/followers",
    "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
    "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
    "organizations_url": "https://api.github.com/users/iurimatias/orgs",
    "repos_url": "https://api.github.com/users/iurimatias/repos",
    "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iurimatias/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/8057/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1292325803",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1292325803",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1292325803,
    "node_id": "IC_kwDOD5KrTM5NB1Or",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-26T16:47:33Z",
    "updated_at": "2022-10-26T16:49:19Z",
    "author_association": "MEMBER",
    "body": "The majority of the 931 waiting connections - 924 specifically - appear to go to a set of hosts on port 443:\r\n```\r\n > awk '/:443.*TIME_WAIT/{a[$5]++}END{for (i in a){ printf \"%5s\\t%s\\n\", a[i], i}}' netstat_*.log | sort -n   \r\n    1\t40.115.22.134:443                           \r\n    1\t52.86.9.69:443\r\n    2\t140.82.121.3:443\r\n    2\t2a06:98c1:3123:e000:443\r\n    2\t34.238.6.113:443\r\n    3\t54.173.154.254:443\r\n    4\t3.232.1.102:443\r\n    6\t2600:9000:2436:a200:443\r\n    6\t34.200.194.21:443\r\n    6\t54.172.96.17:443\r\n    6\t54.221.95.219:443\r\n    8\t18.214.252.96:443\r\n    8\t44.193.148.201:443\r\n    9\t34.192.34.171:443\r\n   10\t107.20.222.254:443\r\n   11\t18.209.201.173:443\r\n   11\t3.233.248.118:443\r\n   11\t35.168.85.49:443\r\n   14\t35.153.115.211:443\r\n   17\t44.205.150.96:443\r\n   20\t3.225.79.167:443\r\n   22\t3.220.87.117:443\r\n   33\t54.145.81.193:443\r\n   34\t3.214.39.19:443\r\n   36\t54.225.175.245:443\r\n   37\t52.204.65.9:443\r\n   40\t34.193.120.156:443\r\n   50\t34.198.248.229:443\r\n   62\t52.201.176.35:443\r\n   62\t52.71.227.115:443\r\n   68\t34.224.147.8:443\r\n   73\t54.146.140.238:443\r\n  109\t34.199.52.146:443\r\n  140\t35.171.65.55:443\r\n```\r\nAnd they all appear to go to Infura:\r\n```\r\n > awk '/:443.*TIME_WAIT/{a[$5]++}END{for (i in a){ printf \"%5s\\t%s\\n\", a[i], i}}' netstat_*.log \r\n      | sort -n | tail -n 8 | cut -f2 | xargs -I{} curl -svk https://{} 2>&1 | grep subject:\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n*  subject: CN=*.infura.io\r\n```\r\nBut why so many?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1292325803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1292336395",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1292336395",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1292336395,
    "node_id": "IC_kwDOD5KrTM5NB30L",
    "user": {
      "login": "alaibe",
      "id": 491074,
      "node_id": "MDQ6VXNlcjQ5MTA3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/491074?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alaibe",
      "html_url": "https://github.com/alaibe",
      "followers_url": "https://api.github.com/users/alaibe/followers",
      "following_url": "https://api.github.com/users/alaibe/following{/other_user}",
      "gists_url": "https://api.github.com/users/alaibe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alaibe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alaibe/subscriptions",
      "organizations_url": "https://api.github.com/users/alaibe/orgs",
      "repos_url": "https://api.github.com/users/alaibe/repos",
      "events_url": "https://api.github.com/users/alaibe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alaibe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-26T16:56:37Z",
    "updated_at": "2022-10-26T16:56:37Z",
    "author_association": "COLLABORATOR",
    "body": "A possible reason: we reach the max number of call we can make with this infura api key\r\n\r\nIn the wallet we are currently working on reducing the number of call we do to infura but clearly not there yet.\r\n\r\nWe have ganache in place but we need to look at why it is not working",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1292336395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1292345944",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1292345944",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1292345944,
    "node_id": "IC_kwDOD5KrTM5NB6JY",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-26T17:05:05Z",
    "updated_at": "2022-10-26T17:05:05Z",
    "author_association": "MEMBER",
    "body": "Most connections appear to be aborted via `userclosed` or `baddata` states:\r\n\r\n![image](https://user-images.githubusercontent.com/2212681/198089836-182a55e6-535a-4363-88a3-65a0d06cefb8.png)\r\n\r\nAccording to Netdata docs:\r\n\r\n* `BadData` - happens while the connection is on FIN_WAIT1 and the kernel receives a packet with a sequence number beyond the last one for this connection - the kernel responds with RST (closes the connection).\r\n* `UserClosed` - happens when the kernel receives data on an already closed connection and responds with RST.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1292345944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1316985401",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1316985401",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1316985401,
    "node_id": "IC_kwDOD5KrTM5Of5o5",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-16T13:00:23Z",
    "updated_at": "2022-11-16T13:00:23Z",
    "author_association": "MEMBER",
    "body": "Not sure if this issue is still valid, at least I have not heard about it from people in a while:\r\n\r\n![image](https://user-images.githubusercontent.com/2212681/202186920-68c2c308-b8b9-44a7-bb59-e28a3a073f44.png)\r\n\r\nClosing for now.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1316985401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1321863179",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1321863179",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1321863179,
    "node_id": "IC_kwDOD5KrTM5OyggL",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-21T10:51:16Z",
    "updated_at": "2022-11-21T10:51:16Z",
    "author_association": "MEMBER",
    "body": "Looks like this is still a problem:\r\n\r\n![image](https://user-images.githubusercontent.com/2212681/203031453-b2538f2a-99ea-4cbc-8e8a-f6902ec69e33.png)\r\n```\r\nRuntimeError: Could not connect to Squish server at host localhost, port 33651: Connection refused (possible reasons: 'squishserver' process not running or listening on a different port, or firewall issue)\r\n```\r\nhttps://ci.status.im/job/status-desktop/job/branches/job/uitests/job/PR-8322/2/squishResults_221121_080809.928/webreport_221121_080809.928_linux-01/index.html\r\n\r\nAlthough in this case the wallet case ran at `09:10:21`:\r\n```\r\n09:10:21  2022-11-21T08:10:21Z test case tst_wallet started\r\n09:10:24  2022-11-21T08:10:24Z test case ended\r\n```\r\nBu the graph shows a spike much later:\r\n\r\n![image](https://user-images.githubusercontent.com/2212681/203032158-3ca5e11f-2a07-4b5c-b7ae-754ea1e7bcde.png)\r\n\r\nSo seems unrelated in this case.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1321863179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516704078",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1516704078",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1516704078,
    "node_id": "IC_kwDOD5KrTM5aZxFO",
    "user": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-20T17:35:36Z",
    "updated_at": "2023-04-20T17:35:36Z",
    "author_association": "MEMBER",
    "body": "@jakubgs is this still an issue?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516704078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516764517",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1516764517",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1516764517,
    "node_id": "IC_kwDOD5KrTM5aZ_1l",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-20T18:26:06Z",
    "updated_at": "2023-04-20T18:26:06Z",
    "author_association": "MEMBER",
    "body": "I have not heard about it in a while. Maybe not?",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516764517/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1536507258",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1536507258",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1536507258,
    "node_id": "IC_kwDOD5KrTM5blT16",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T16:39:29Z",
    "updated_at": "2023-05-05T16:39:29Z",
    "author_association": "MEMBER",
    "body": "Apparently this is still an issue:\r\n```\r\nRuntimeError: Could not connect to Squish server at host localhost, port 33913: Connection refused (Screenshot taken from the desktop is invalid)\r\n```\r\n```\r\nRuntimeError: Could not connect to Squish server at host localhost, port 44591: Connection refused (Screenshot taken from the desktop is invalid)\r\n```\r\nhttps://ci.status.im/job/status-desktop/job/branches/job/linux/job/x86_64/job/tests-e2e/job/PR-10434/12/squishResults_230505_155319.783/webreport_230505_155319.783_linux-05/index.html\r\n\r\nWhat's worth noting in this case is that different tests suits get a different Squish server process listening on a different port.\r\nIn this case those ports are `33913` and `44591`, and the error is `Connection refused`, which suggests that the process is active, but it's actively rejecting connections, which might indicate that it's either broken, or shutting down.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1536507258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1536509838",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1536509838",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1536509838,
    "node_id": "IC_kwDOD5KrTM5blUeO",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T16:41:13Z",
    "updated_at": "2023-05-05T16:41:13Z",
    "author_association": "MEMBER",
    "body": "If we check the process limits of a `squishserver` process on a CI host while it runs we can see those are very high:\r\n```\r\nadmin@linux-05.he-eu-hel1.ci.devel:~ % cat /proc/$(pgrep squishserver)/limits | grep files\r\nMax open files            1048576              1048576              files \r\n```\r\nAnd even if we were hitting a max open files limit, we would not see a `connection refused`, but something different.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1536509838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1536511217",
    "html_url": "https://github.com/status-im/status-desktop/issues/8057#issuecomment-1536511217",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/8057",
    "id": 1536511217,
    "node_id": "IC_kwDOD5KrTM5blUzx",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T16:42:24Z",
    "updated_at": "2023-05-05T16:42:24Z",
    "author_association": "MEMBER",
    "body": "If we look at an example process of a Squish server and runner we can see the port is specified as a flag:\r\n```\r\nadmin@linux-05.he-eu-hel1.ci.devel:~ % ps faux | grep squish\r\njenkins  2405576  0.1  0.0 242036 10336 ?        Sl   16:31   0:00  |           \\_ /opt/squish-runner-7.1-20230222-1555/lib/_squishserver --local\r\njenkins  2405580  0.0  0.0 284100 15504 ?        Sl   16:31   0:00  |           \\_ /opt/squish-runner-7.1-20230222-1555/lib/_squishrunner --host localhost --port 39723 --debugLog pawl --testsuite /home/jenkins/workspace/_linux_x86_64_tests-e2e_PR-10567/test/ui-test/testSuites/suite_settings --reportgen html,/home/jenkins/workspace/_linux_x86_64_tests-e2e_PR-10567/squish_2_737/webreport_230505_162619.667_linux-05 --reportgen xml2.2,/home/jenkins/workspace/_linux_x86_64_tests-e2e_PR-10567/squish_2_737/result_230505_163154.098.xml --snoozeFactor 1.0 --retry 2 --tags ~mayfail --tags ~merge --tags ~relyon-mailserver --exitCodeOnFail 188\r\njenkins  2405587  1.5  0.0 449816 58992 ?        Sl   16:31   0:01  |           |   \\_ /opt/squish-runner-7.1-20230222-1555/lib/_squishrunner --host localhost --port 39723 --testcase tst_mainSettingsSection --reportgen raw,/tmp/squishrunner_report_2405580 --wrapper Qt --objectmap /home/jenkins/workspace/_linux_x86_64_tests-e2e_PR-10567/test/ui-test/testSuites/suite_settings/objects.map --snoozeFactor 1 --resultdir /home/jenkins/workspace/_linux_x86_64_tests-e2e_PR-10567/squish_2_737/webreport_230505_162619.667_linux-05/data --suiteVersion 3 --tags=~mayfail --tags=~merge --tags=~relyon-mailserver --retry 2\r\n```\r\nIn this case the port is `39723`, and is managed by the Squish Jenkins plugin.\r\n\r\nMy best bet is those rejected connections are either a bug in either the `squishserver` binary or the Jenkins Squish plugin.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1536511217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
