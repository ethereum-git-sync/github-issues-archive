{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/12831",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/12831",
  "id": 2006564010,
  "node_id": "I_kwDOD5KrTM53mbyq",
  "number": 12831,
  "title": "Desktop login failure",
  "user": {
    "login": "jm-clius",
    "id": 68783915,
    "node_id": "MDQ6VXNlcjY4NzgzOTE1",
    "avatar_url": "https://avatars.githubusercontent.com/u/68783915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jm-clius",
    "html_url": "https://github.com/jm-clius",
    "followers_url": "https://api.github.com/users/jm-clius/followers",
    "following_url": "https://api.github.com/users/jm-clius/following{/other_user}",
    "gists_url": "https://api.github.com/users/jm-clius/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jm-clius/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jm-clius/subscriptions",
    "organizations_url": "https://api.github.com/users/jm-clius/orgs",
    "repos_url": "https://api.github.com/users/jm-clius/repos",
    "events_url": "https://api.github.com/users/jm-clius/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jm-clius/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2036563458,
      "node_id": "MDU6TGFiZWwyMDM2NTYzNDU4",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-11-22T15:15:47Z",
  "updated_at": "2023-11-22T18:52:39Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# Bug Report\r\n\r\n## Description\r\n\r\nLogin failure using builds from https://github.com/status-im/status-desktop/pull/12765 as part of Waku team dogfooding of static sharding, although the issue was also observed in earlier builds such as https://github.com/status-im/status-desktop/pull/12344.\r\nI'm on a Windows 11 machine and used the `windows/x86_64` installer, specifying the `--datadir` parameter to specify the path to dogfooding credentials.\r\n\r\n## Steps to reproduce\r\n\r\nThis is how I produce the bug consistently:\r\n1. Install Status.exe using  `windows/x86_64` installer from https://github.com/status-im/status-desktop/pull/12765, https://github.com/status-im/status-desktop/pull/12344 or anything in between.\r\n2. Run `Status.exe` with `--datadir` config.\r\n3. Create a user using the normal procedures and close the app.\r\n4. Run `Status.exe` with `--datadir` config.\r\n5. Attempt to login\r\n\r\nIn about 9/10 cases failure to log in with behaviour as set out below under \"Actual behavior\".\r\n\r\n#### Expected behavior\r\n\r\nLogs in.\r\n\r\n#### Actual behavior\r\n\r\nLogin failure with following error message:\r\n![image](https://github.com/status-im/status-desktop/assets/68783915/574ec411-8ffc-42a1-bb57-09fc46dccbfe)\r\n\r\nIf you then proceed to close the application, the following exception is raised:\r\n![image](https://github.com/status-im/status-desktop/assets/68783915/fa6795dc-0283-4942-82d3-c953c91da1ca)\r\n\r\nLogs:\r\n```\r\nINF 2023-11-22 15:02:35.835+00:00 Version: 0.9.90                            topics=\"status-app\" tid=13920 file=nim_status_client.nim:197\r\nINF 2023-11-22 15:02:35.837+00:00 Commit: 7f00bc901                          topics=\"status-app\" tid=13920 file=nim_status_client.nim:198\r\nINF 2023-11-22 15:02:35.837+00:00 Current date:                              topics=\"status-app\" tid=13920 file=nim_status_client.nim:199 currentDateTime=2023-11-22T15:02:35+00:00\r\nINF 2023-11-22 15:02:35.837+00:00 starting application controller...         topics=\"status-app\" tid=13920 file=nim_status_client.nim:201\r\nINF 2023-11-22 15:02:38.279+00:00 starting application...                    topics=\"status-app\" tid=13920 file=nim_status_client.nim:204\r\nWRN 2023-11-22 15:02:38.279+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nERR 2023-11-22 15:02:42.616+00:00 error:                                     topics=\"accounts-service\" tid=13920 file=service.nim:669 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nWRN 2023-11-22 15:02:47.145+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nERR 2023-11-22 15:02:47.563+00:00 rpc response error                         topics=\"rpc\" tid=13920 file=core.nim:36 err=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nERR 2023-11-22 15:02:47.563+00:00 error doing rpc request                    topics=\"rpc\" tid=13920 file=core.nim:40 methodName=wakuext_startMessenger exception=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nERR 2023-11-22 15:02:47.563+00:00 error:                                     topics=\"app-controller\" tid=13920 file=app_controller.nim:465 errDescription=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nWRN 2023-11-22 15:02:50.393+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nERR 2023-11-22 15:02:58.237+00:00 error:                                     topics=\"accounts-service\" tid=13920 file=service.nim:669 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nWRN 2023-11-22 15:02:59.437+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nERR 2023-11-22 15:02:59.777+00:00 rpc response error                         topics=\"rpc\" tid=13920 file=core.nim:36 err=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nERR 2023-11-22 15:02:59.777+00:00 error doing rpc request                    topics=\"rpc\" tid=13920 file=core.nim:40 methodName=wakuext_startMessenger exception=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nERR 2023-11-22 15:02:59.778+00:00 error:                                     topics=\"app-controller\" tid=13920 file=app_controller.nim:465 errDescription=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nWRN 2023-11-22 15:03:02.647+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nERR 2023-11-22 15:13:03.337+00:00 error:                                     topics=\"accounts-service\" tid=13920 file=service.nim:669 procName=verifyDatabasePassword errDesription=\"failed to set `journal_mode` pragma: file is not a database\"\r\nWRN 2023-11-22 15:13:04.555+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nERR 2023-11-22 15:13:05.107+00:00 rpc response error                         topics=\"rpc\" tid=13920 file=core.nim:36 err=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nERR 2023-11-22 15:13:05.109+00:00 error doing rpc request                    topics=\"rpc\" tid=13920 file=core.nim:40 methodName=wakuext_startMessenger exception=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nERR 2023-11-22 15:13:05.110+00:00 error:                                     topics=\"app-controller\" tid=13920 file=app_controller.nim:465 errDescription=\"\\nstatus-go error [methodName:wakuext_startMessenger, code:-32603, message:method handler crashed ]\\n\"\r\nWRN 2023-11-22 15:13:07.988+00:00 Error decoding signal                      topics=\"signals-manager\" tid=13920 file=signals_manager.nim:43 err=\"Unknown signal received: mediaserver.started\"\r\nINF 2023-11-22 15:13:51.528+00:00 shutting down...                           topics=\"status-app\" tid=13920 file=nim_status_client.nim:173\r\nINF 2023-11-22 15:13:51.529+00:00 logging out...                             topics=\"app-controller\" tid=13920 file=app_controller.nim:288\r\n```\r\n\r\n### Additional Information\r\n\r\n- Status desktop version: https://github.com/status-im/status-desktop/pull/12765\r\n- Operating System: Windows 11\r\n\r\n[geth.log](https://github.com/status-im/status-desktop/files/13441597/geth.log)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/12831/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823032799",
    "html_url": "https://github.com/status-im/status-desktop/issues/12831#issuecomment-1823032799",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831",
    "id": 1823032799,
    "node_id": "IC_kwDOD5KrTM5sqUXf",
    "user": {
      "login": "richard-ramos",
      "id": 1106587,
      "node_id": "MDQ6VXNlcjExMDY1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1106587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richard-ramos",
      "html_url": "https://github.com/richard-ramos",
      "followers_url": "https://api.github.com/users/richard-ramos/followers",
      "following_url": "https://api.github.com/users/richard-ramos/following{/other_user}",
      "gists_url": "https://api.github.com/users/richard-ramos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richard-ramos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richard-ramos/subscriptions",
      "organizations_url": "https://api.github.com/users/richard-ramos/orgs",
      "repos_url": "https://api.github.com/users/richard-ramos/repos",
      "events_url": "https://api.github.com/users/richard-ramos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richard-ramos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-22T15:54:06Z",
    "updated_at": "2023-11-22T15:54:06Z",
    "author_association": "MEMBER",
    "body": "This seems to be the error that's causing your login issue. Looking at the code, this failure happens while trying to retrieve a free TCP and UDP port for the torrent service :thinking: \r\n\r\n```\r\nERROR[11-22|15:13:05.106|rpc/service.go:200]                                                             RPC method wakuext_startMessenger crashed: runtime error: invalid memory address or nil pointer dereference\r\ngoroutine 1898 [running]:\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call.func1()\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/service.go:199 +0x89\r\npanic({0x7ffe69e522c0, 0x7ffe698f0d80})\r\n\tC:/ProgramData/scoop/apps/go/current/src/runtime/panic.go:884 +0x213\r\ngithub.com/status-im/status-go/protocol/communities.(*Manager).getTCPandUDPport(0x1c002ad0d80, 0x1c002935248?)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/protocol/communities/manager.go:540 +0x53f\r\ngithub.com/status-im/status-go/protocol/communities.(*Manager).StartTorrentClient(0x1c002ad0d80)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/protocol/communities/manager.go:562 +0x57\r\ngithub.com/status-im/status-go/protocol/communities.(*Manager).Start(0x1c002ad0d80)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/protocol/communities/manager.go:378 +0x7f\r\ngithub.com/status-im/status-go/protocol.(*Messenger).Start(0x1c000a42900)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/protocol/messenger.go:786 +0x53a\r\ngithub.com/status-im/status-go/services/ext.(*Service).StartMessenger(0x1c0006c8300)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/services/ext/service.go:193 +0x5c\r\ngithub.com/status-im/status-go/services/ext.(*PublicAPI).StartMessenger(...)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/services/ext/api.go:789\r\nreflect.Value.call({0x1c000a906e0?, 0x1c0005ec538?, 0x137f0091ae8?}, {0x7ffe6a1b870a, 0x4}, {0x1c0005f9470, 0x1, 0x0?})\r\n\tC:/ProgramData/scoop/apps/go/current/src/reflect/value.go:586 +0xb0b\r\nreflect.Value.Call({0x1c000a906e0?, 0x1c0005ec538?, 0x1?}, {0x1c0005f9470?, 0x0?, 0x1c002929cb8?})\r\n\tC:/ProgramData/scoop/apps/go/current/src/reflect/value.go:370 +0xbc\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call(0x1c001b59bc0, {0x7ffe6a9e99a0?, 0x1c0038a66e0}, {0x1c000fdf590, 0x16}, {0x7ffe6bca8e68, 0x0, 0x7ffe67b2a777?})\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/service.go:205 +0x3c5\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).runMethod(0x1c000434788?, {0x7ffe6a9e99a0?, 0x1c0038a66e0?}, 0x1c00030b5e0, 0x0?, {0x7ffe6bca8e68?, 0x1c003be4870?, 0x90?})\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/handler.go:391 +0x45\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCall(0x1c0000d2fc0, 0x1c0005f9410, 0x1c00030b5e0)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/handler.go:336 +0x239\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg(0x1c0000d2fc0, 0x30?, 0x1c00030b5e0)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/handler.go:297 +0x237\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1(0x1c0005f9410)\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/handler.go:138 +0x35\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/handler.go:225 +0xc5\r\ncreated by github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc\r\n\tC:/Users/jenkins/workspace/_windows_x86_64_package_PR-12765/vendor/status-go/vendor/github.com/ethereum/go-ethereum/rpc/handler.go:221 +0x8d\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823032799/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823102105",
    "html_url": "https://github.com/status-im/status-desktop/issues/12831#issuecomment-1823102105",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831",
    "id": 1823102105,
    "node_id": "IC_kwDOD5KrTM5sqlSZ",
    "user": {
      "login": "jm-clius",
      "id": 68783915,
      "node_id": "MDQ6VXNlcjY4NzgzOTE1",
      "avatar_url": "https://avatars.githubusercontent.com/u/68783915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jm-clius",
      "html_url": "https://github.com/jm-clius",
      "followers_url": "https://api.github.com/users/jm-clius/followers",
      "following_url": "https://api.github.com/users/jm-clius/following{/other_user}",
      "gists_url": "https://api.github.com/users/jm-clius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jm-clius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jm-clius/subscriptions",
      "organizations_url": "https://api.github.com/users/jm-clius/orgs",
      "repos_url": "https://api.github.com/users/jm-clius/repos",
      "events_url": "https://api.github.com/users/jm-clius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jm-clius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-22T16:33:39Z",
    "updated_at": "2023-11-22T16:33:39Z",
    "author_association": "NONE",
    "body": "Thanks @richard-ramos!\r\nInterestingly I now seem able to log in and all I've done is close Telegram Desktop... Will confirm that this is the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823102105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823132369",
    "html_url": "https://github.com/status-im/status-desktop/issues/12831#issuecomment-1823132369",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831",
    "id": 1823132369,
    "node_id": "IC_kwDOD5KrTM5sqsrR",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-22T16:47:48Z",
    "updated_at": "2023-11-22T16:47:48Z",
    "author_association": "MEMBER",
    "body": "Is the torrent port dynamic like the waku port @richard-ramos ? If not, it's probably worth improving it.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823132369/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823306248",
    "html_url": "https://github.com/status-im/status-desktop/issues/12831#issuecomment-1823306248",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/12831",
    "id": 1823306248,
    "node_id": "IC_kwDOD5KrTM5srXII",
    "user": {
      "login": "richard-ramos",
      "id": 1106587,
      "node_id": "MDQ6VXNlcjExMDY1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1106587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/richard-ramos",
      "html_url": "https://github.com/richard-ramos",
      "followers_url": "https://api.github.com/users/richard-ramos/followers",
      "following_url": "https://api.github.com/users/richard-ramos/following{/other_user}",
      "gists_url": "https://api.github.com/users/richard-ramos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/richard-ramos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/richard-ramos/subscriptions",
      "organizations_url": "https://api.github.com/users/richard-ramos/orgs",
      "repos_url": "https://api.github.com/users/richard-ramos/repos",
      "events_url": "https://api.github.com/users/richard-ramos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/richard-ramos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-22T18:52:38Z",
    "updated_at": "2023-11-22T18:52:38Z",
    "author_association": "MEMBER",
    "body": "This should help: https://github.com/status-im/status-go/pull/4363",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1823306248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
