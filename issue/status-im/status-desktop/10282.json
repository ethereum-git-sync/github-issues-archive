{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/10282",
  "id": 1666076262,
  "node_id": "I_kwDOD5KrTM5jTk5m",
  "number": 10282,
  "title": "[Performance] ChatPinnedMessages and FirstUnseenMessageID RPC calls are blocking the DB for a long time",
  "user": {
    "login": "alexjba",
    "id": 47811206,
    "node_id": "MDQ6VXNlcjQ3ODExMjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexjba",
    "html_url": "https://github.com/alexjba",
    "followers_url": "https://api.github.com/users/alexjba/followers",
    "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
    "organizations_url": "https://api.github.com/users/alexjba/orgs",
    "repos_url": "https://api.github.com/users/alexjba/repos",
    "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexjba/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3166254951,
      "node_id": "MDU6TGFiZWwzMTY2MjU0OTUx",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/performance",
      "name": "performance",
      "color": "7F1B66",
      "default": false,
      "description": ""
    },
    {
      "id": 4548141040,
      "node_id": "LA_kwDOD5KrTM8AAAABDxcf8A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/messenger-team",
      "name": "messenger-team",
      "color": "232858",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/56",
    "html_url": "https://github.com/status-im/status-desktop/milestone/56",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/56/labels",
    "id": 8475714,
    "node_id": "MI_kwDOD5KrTM4AgVRC",
    "number": 56,
    "title": "0.12",
    "description": "Priorities **in priority order** for the 0.12 milestone:  \r\n\r\n**1. Improve performance**\r\n- Focus on eliminating any UI freezes when the user clicks on something and the app does not display an immediate response.  Target: the app should ideally respond to all user input within 50ms, but let's start with identifying the longest UI freezes and trying to fix the worst UI freezes first.\r\n- Speed and responsiveness of switching between community channels, and 1on1 and ad-hoc group chats is particularly important, especially for channels and chats that contains a lot of history.  We should aim for about 250ms delay in the *worst* case if possible.  Having a lot of history in a channel should not slow channel switching down.\r\n- DB perf optimisations.  \r\n- Move things to async and off main thread\r\n- See Alex's great profiling work for possible tasks (Alex to continue focusing on perf. for this release cycle)\r\n- \"user facing performance in everyday app usage\" is the top priority, but any task that improves performance is worthwhile\r\n\r\n**2. Finish development of token based functionality from 0.11**\r\n- Optimise No. queries made by owner node when checking member tokens (Pascal)\r\n- Community encryption should automatically switch on/off depending on community permissions (issue #9942)\r\n- Implement the 'Admin' role (issue #10114)\r\n- Airdrop to community members (in addition to addresses)\r\n- Optimise gas required by collectable minting smart contracts (issue #9943, GravityBlast)\r\n--- After collectable minting gas optimisation is complete, start work on Asset minting contracts (GravityBlast)\r\n- Complete token remote destruct UI\r\n- Remove 'Community Permissions Settings', 'Community Tokens' and 'Discord Import Tool' feature flags (issue #10115)\r\n- Thoroughly test, and fix all bugs found. \r\n- Anything else related to Community level token permissions, collectable minting, airdropping, and remote destructing that didn't make it into 0.11\r\n\r\n**3. Finish implementing the ability for Community Owners and Admins to drag and drop channels and categories into different orders**\r\n\r\n**4. Finish anything related to the initial pairing process for syncing that wasn't completed in 0.11** (Igor)\r\n\r\n**5. Improve Mutual Contacts functionality to improve reliability and pay off tech debt** (Mishka)\r\n\r\n**6. Complete Community Directory Curation dApp integration inc. Featured functionality** (Patryk)\r\n \r\n**7. Backend for the Profile Showcase**\r\n\r\n**8. Identity Verification** (required for 'Profile Showcase')\r\n\r\n**9. Fix bugs, bugs and more bugs!**\r\n- Esp. find the cause of and fix the longstanding bug of some 'requests to join' not arriving for hours/days after they were sent!\r\n- Many 'fit and finish' bugs for the UI team\r\n\r\n**--- For the Wallet team ---**\r\n\r\n1. Continue feature development inc. kicking off development of the activity screens\r\n2. 'All accounts' section.  The ability to return all tokens owned by the user in all accounts (excluding watch only accounts) is also required for the Showcase functionality\r\n3. Widen scope of 'backup to waku' and 'syncing' so that all relevant Wallet user state is backed up and synced between devices\r\n4. Continue to ensure Wallet functionality is performant.\r\n5. Fix wallet bugs",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 84,
    "closed_issues": 141,
    "state": "open",
    "created_at": "2022-09-28T20:32:37Z",
    "updated_at": "2023-04-29T10:33:10Z",
    "due_on": "2023-05-05T07:00:00Z",
    "closed_at": null
  },
  "comments": 13,
  "created_at": "2023-04-13T09:39:59Z",
  "updated_at": "2023-04-28T10:07:26Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nPlease have a look on this profiling data:\r\n\r\n<img width=\"1409\" alt=\"Screenshot 2023-04-07 at 15 39 29\" src=\"https://user-images.githubusercontent.com/47811206/231719064-68329bc5-8f44-4f4f-b3aa-25f7cb0cff6d.png\">\r\n\r\nThese calls are blocking the DB for a long time and we can't request additional data for a few seconds while any of them are running.",
  "closed_by": {
    "login": "jrainville",
    "id": 11926403,
    "node_id": "MDQ6VXNlcjExOTI2NDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jrainville",
    "html_url": "https://github.com/jrainville",
    "followers_url": "https://api.github.com/users/jrainville/followers",
    "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
    "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
    "organizations_url": "https://api.github.com/users/jrainville/orgs",
    "repos_url": "https://api.github.com/users/jrainville/repos",
    "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jrainville/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1506669278",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1506669278",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1506669278,
    "node_id": "IC_kwDOD5KrTM5ZzfLe",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T09:45:04Z",
    "updated_at": "2023-04-13T09:45:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jrainville I've labeled this with `messenger-team` since it's affecting the chat performance, but I'm not sure if it should be on the status-desktop board or on status-go board.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1506669278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1507039055",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1507039055",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1507039055,
    "node_id": "IC_kwDOD5KrTM5Z05dP",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T14:09:17Z",
    "updated_at": "2023-04-13T14:09:17Z",
    "author_association": "MEMBER",
    "body": "It's something that will probably need to be fixed on status-go with either an index or some sort of clean up. We've seen that raw messages are kept forever, so maybe there is a bit of clean up needed there.\r\n\r\nAnyway, all that to say, it's still ok to show it here, because we don't really use the status-go board. ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1507039055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516880758",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1516880758",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1516880758,
    "node_id": "IC_kwDOD5KrTM5aacN2",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-20T20:05:47Z",
    "updated_at": "2023-04-20T20:05:47Z",
    "author_association": "MEMBER",
    "body": "I can't reproduce those long call times on current master.\r\nI'm using the shared dev account and still, those calls resolve in less than a millisecond for me.\r\n\r\nIs this an OS thing, an account/DB thing or was it maybe fixed in the meantime?\r\n\r\nMaybe I'm calculating it badly. I just put a benchmark  `cpuTime() - time` after the call to ChatPinnedMessages and FirstUnseenMessageID on the Nim side (backend/messages.nim), and the times are this small (in seconds): \r\n```\r\nDONE firstUnseenMessageID : 0.0002839660000000001\r\nDONE fetchPinnedMessages : 0.01356774199999999\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516880758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516881755",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1516881755",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1516881755,
    "node_id": "IC_kwDOD5KrTM5aacdb",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-20T20:06:42Z",
    "updated_at": "2023-04-20T20:06:42Z",
    "author_association": "MEMBER",
    "body": "This is also before Andrea's fix + index added here https://github.com/status-im/status-go/pull/3414/files#diff-79719d4e91ccd3a2f5d16881e905800c23cc3e3054827916f24030cf052b1965, which will likely help as well",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516881755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519456013",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1519456013",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1519456013,
    "node_id": "IC_kwDOD5KrTM5akQ8N",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T06:23:31Z",
    "updated_at": "2023-04-24T06:23:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I can't reproduce those long call times on current master. I'm using the shared dev account and still, those calls resolve in less than a millisecond for me.\r\n> \r\n> Is this an OS thing, an account/DB thing or was it maybe fixed in the meantime?\r\n> \r\n> Maybe I'm calculating it badly. I just put a benchmark `cpuTime() - time` after the call to ChatPinnedMessages and FirstUnseenMessageID on the Nim side (backend/messages.nim), and the times are this small (in seconds):\r\n> \r\n> ```\r\n> DONE firstUnseenMessageID : 0.0002839660000000001\r\n> DONE fetchPinnedMessages : 0.01356774199999999\r\n> ```\r\n\r\nIt definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow `firstUnseenMessageID` and `fetchPinnedMessages`.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519456013/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519597510",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1519597510",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1519597510,
    "node_id": "IC_kwDOD5KrTM5akzfG",
    "user": {
      "login": "caybro",
      "id": 5377645,
      "node_id": "MDQ6VXNlcjUzNzc2NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377645?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caybro",
      "html_url": "https://github.com/caybro",
      "followers_url": "https://api.github.com/users/caybro/followers",
      "following_url": "https://api.github.com/users/caybro/following{/other_user}",
      "gists_url": "https://api.github.com/users/caybro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caybro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caybro/subscriptions",
      "organizations_url": "https://api.github.com/users/caybro/orgs",
      "repos_url": "https://api.github.com/users/caybro/repos",
      "events_url": "https://api.github.com/users/caybro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caybro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T08:12:34Z",
    "updated_at": "2023-04-24T08:12:34Z",
    "author_association": "MEMBER",
    "body": "> > I can't reproduce those long call times on current master. I'm using the shared dev account and still, those calls resolve in less than a millisecond for me.\r\n> > Is this an OS thing, an account/DB thing or was it maybe fixed in the meantime?\r\n> > Maybe I'm calculating it badly. I just put a benchmark `cpuTime() - time` after the call to ChatPinnedMessages and FirstUnseenMessageID on the Nim side (backend/messages.nim), and the times are this small (in seconds):\r\n> > ```\r\n> > DONE firstUnseenMessageID : 0.0002839660000000001\r\n> > DONE fetchPinnedMessages : 0.01356774199999999\r\n> > ```\r\n> \r\n> It definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow `firstUnseenMessageID` and `fetchPinnedMessages`.\r\n\r\nYup, it's very slow on large databases",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519597510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520292441",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520292441",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520292441,
    "node_id": "IC_kwDOD5KrTM5andJZ",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T14:37:52Z",
    "updated_at": "2023-04-24T14:37:52Z",
    "author_association": "MEMBER",
    "body": "This was incorrectly closed when my other PR was closed. Reopening",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520292441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520303149",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520303149",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520303149,
    "node_id": "IC_kwDOD5KrTM5anfwt",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T14:42:56Z",
    "updated_at": "2023-04-24T14:42:56Z",
    "author_association": "MEMBER",
    "body": "> It definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow firstUnseenMessageID and fetchPinnedMessages.\r\n\r\nYeah, I was using the shared dev account that has the Status community and Discord import. It is 10GB big. So not as big, but still very sizable.\r\n\r\nI was wondering if maybe the biggest problem was already fixed, since I'm no where close to 7 seconds per call.\r\n\r\nMaybe you can try again on latest master to see where you're at now with those calls @alexjba ?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520303149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520330358",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520330358",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520330358,
    "node_id": "IC_kwDOD5KrTM5anmZ2",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T14:51:58Z",
    "updated_at": "2023-04-24T14:51:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > It definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow firstUnseenMessageID and fetchPinnedMessages.\r\n> \r\n> Yeah, I was using the shared dev account that has the Status community and Discord import. It is 10GB big. So not as big, but still very sizable.\r\n> \r\n> I was wondering if maybe the biggest problem was already fixed, since I'm no where close to 7 seconds per call.\r\n> \r\n> Maybe you can try again on latest master to see where you're at now with those calls @alexjba ?\r\n\r\nYes, I'm currently testing it on master. But I have other difficulties while switching channels. Sometimes the channel is not activated when selected (channel is changed in the channels list, but the message history doesn't change) or some channels don't load at all, or sometimes the channel loading screen is not triggered.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520330358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520344827",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520344827",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520344827,
    "node_id": "IC_kwDOD5KrTM5anp77",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T15:00:26Z",
    "updated_at": "2023-04-24T15:00:26Z",
    "author_association": "MEMBER",
    "body": "> Yes, I'm currently testing it on master. But I have other difficulties while switching channels. Sometimes the channel is not activated when selected (channel is changed in the channels list, but the message history doesn't change) or some channels don't load at all, or sometimes the channel loading screen is not triggered.\r\n\r\nAh yes, sorry about that. I broke that last week, but I have a PR here: https://github.com/status-im/status-desktop/pull/10398",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520344827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1523090897",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1523090897",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1523090897,
    "node_id": "IC_kwDOD5KrTM5ayIXR",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-26T09:29:02Z",
    "updated_at": "2023-04-26T09:29:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like `FirstUnseenMessageID` is fixed by https://github.com/status-im/status-desktop/pull/10430/files",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1523090897/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1526081182",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1526081182",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1526081182,
    "node_id": "IC_kwDOD5KrTM5a9iae",
    "user": {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T17:36:58Z",
    "updated_at": "2023-04-27T17:45:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Good news! I've identified the cause of the slow channel switching.\r\n\r\nHere's our story, the sequence of events:\r\n```\r\n1. async getMessages -> locks the database for x ms\r\n2. async getPinnedMessages -> locks the database for y ms\r\n3. async getFirstUnseenMessageId -> locks the database for z ms\r\n```\r\n\r\nContrary to what the profiler suggests, `getFirstUnseenMessageId` isn't the main issue. It's actually blocked for x+y+z ms due to the database locks. I tested it in separation, `getFirstUnseenMessageId` is at max 250ms for huge channels and after this change: https://github.com/status-im/status-go/commit/a7d7609a771dda6ceaa1100a5209535570c530bb, it will be max 10ms. There will be no need to keep it async anymore.\r\n\r\nTo improve channel switching speed, it's crucial that we optimize the performance of the `getPinnedMessages` query. Since the database is single-threaded, there's no other solution. Consider a scenario where a user switches between 10 channels quickly. The last channel would only open after 10*(x+y+z) ms, as all the queries would stack up.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1526081182/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 2,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1527311919",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1527311919",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1527311919,
    "node_id": "IC_kwDOD5KrTM5bCO4v",
    "user": {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T10:02:26Z",
    "updated_at": "2023-04-28T10:07:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Improving the performance of the `getPinnedMessages` query alone may not fully resolve the issue. It appears that in some cases, we lack control over what locks the database and the duration of the lock, see: https://github.com/status-im/status-desktop/issues/10471#issuecomment-1527227333. This could also explain why switching between the same channels is sometimes fast and other times slow.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1527311919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
