{
  "url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
  "repository_url": "https://api.github.com/repos/status-im/status-desktop",
  "labels_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/labels{/name}",
  "comments_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/comments",
  "events_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/events",
  "html_url": "https://github.com/status-im/status-desktop/issues/10282",
  "id": 1666076262,
  "node_id": "I_kwDOD5KrTM5jTk5m",
  "number": 10282,
  "title": "[Performance] ChatPinnedMessages and FirstUnseenMessageID RPC calls are blocking the DB for a long time",
  "user": {
    "login": "alexjba",
    "id": 47811206,
    "node_id": "MDQ6VXNlcjQ3ODExMjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexjba",
    "html_url": "https://github.com/alexjba",
    "followers_url": "https://api.github.com/users/alexjba/followers",
    "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
    "organizations_url": "https://api.github.com/users/alexjba/orgs",
    "repos_url": "https://api.github.com/users/alexjba/repos",
    "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexjba/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3166254951,
      "node_id": "MDU6TGFiZWwzMTY2MjU0OTUx",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/performance",
      "name": "performance",
      "color": "7F1B66",
      "default": false,
      "description": ""
    },
    {
      "id": 4548141040,
      "node_id": "LA_kwDOD5KrTM8AAAABDxcf8A",
      "url": "https://api.github.com/repos/status-im/status-desktop/labels/messenger-team",
      "name": "messenger-team",
      "color": "232858",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "osmaczko",
    "id": 33099791,
    "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/osmaczko",
    "html_url": "https://github.com/osmaczko",
    "followers_url": "https://api.github.com/users/osmaczko/followers",
    "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
    "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
    "organizations_url": "https://api.github.com/users/osmaczko/orgs",
    "repos_url": "https://api.github.com/users/osmaczko/repos",
    "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/osmaczko/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/status-im/status-desktop/milestones/64",
    "html_url": "https://github.com/status-im/status-desktop/milestone/64",
    "labels_url": "https://api.github.com/repos/status-im/status-desktop/milestones/64/labels",
    "id": 9039503,
    "node_id": "MI_kwDOD5KrTM4Aie6P",
    "number": 64,
    "title": "0.13",
    "description": "Priorities **in priority order** for the 0.13 milestone:\r\n\r\n**1. Finish items started in 0.12**\r\n- Complete any outstanding issues related to pairing (for syncing) - Igor\r\n- Implement the 'Admin' role (issue #10114) - Mykhailo\r\n- Any remaining work to pay off tech. debt related to mutual contacts - Mishka\r\n- When creating/editing token based permission, ability to search for and selecting Collectables from OpenSea - MichaelC\r\n\r\n**2. Channel token permissions**\r\n- Create, edit and delete channel token permissions in the permissions admin screens\r\n- This includes the \"no tokens required to view this channel\" permission\r\n- All user facing channel token permissions functionality e.g. what happens when a user tries to access a token gated channel they don't have the required tokens to access, what happens when a user only has permissions to view a channel, etc...\r\n- If a community is an open (not token gated at the community level) community, if a channel is token gated AND if **no** \"no tokens required to view this channel\" permission for that channel exists, then the channel should be automatically encrypted.  If token gating is removed from a channel, the channel should become unencrypted.\r\n\r\n**3. DB perf improvements**\r\n- https://www.notion.so/Database-related-performance-1dbaa7ea894c461d885e55676683be07\r\n- Alex and Patryk to work on this, with help from Lukáš\r\n\r\n**4. Update app to use new 'Share URL' formats**\r\n- add functionality to status-go to generate the new 'Share URL' formats for sharing links to: User Profiles, Communities, Channel inside a Community (issue https://github.com/status-im/status-desktop/issues/10851)\r\n- Update everywhere a user can share a URL from to use the new URL format (issue https://github.com/status-im/status-desktop/issues/10852)\r\n- New/updated URL unroll designs for inside chat, including specific unrolls for the new User Profile, Community and Channel inside a Community URLs (issue https://github.com/status-im/status-desktop/issues/10585)\r\n- Ability to share a URL that points to a specific channel in a community (issue #10160)\r\n- Update all address inputs to accept a user pasting a 'share URL' into the input (in addition to being able to input the raw address).  This includes: Start new chat input, send contact request input in Settings, the import community key input, etc...\r\n- Update Status Desktops URL handler so that if Status is installed on a computer, when a user clicks on a Status 'Share URL' the app is launched (if not already running) and after signing in the user is automatically taken to the entity the Share URL represented inside the app.  e.g. if a user clicks on a URL for a Status Community, the user should be taken to the home screen for that community inside the Status App\r\n\r\n**5. Mint Assets functionality**\r\n- Also includes some small improvements to the mint Collectables functionality\r\n- Noelia, GravityBlast\r\n\r\n**6. Profile showcase backend**\r\n\r\n\r\n**--- For the Wallet team ---**\r\ntldr; continue building out Ben's wallet designs\r\n\r\n1. Complete any outstanding development related to the activity screens\r\n2. All accounts overview screens\r\n3. New settings screens\r\n4. Implement 'imported key and account' syncing and transfer between devices\r\n\r\n\r\n",
    "creator": {
      "login": "iurimatias",
      "id": 176720,
      "node_id": "MDQ6VXNlcjE3NjcyMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iurimatias",
      "html_url": "https://github.com/iurimatias",
      "followers_url": "https://api.github.com/users/iurimatias/followers",
      "following_url": "https://api.github.com/users/iurimatias/following{/other_user}",
      "gists_url": "https://api.github.com/users/iurimatias/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iurimatias/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iurimatias/subscriptions",
      "organizations_url": "https://api.github.com/users/iurimatias/orgs",
      "repos_url": "https://api.github.com/users/iurimatias/repos",
      "events_url": "https://api.github.com/users/iurimatias/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iurimatias/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 82,
    "closed_issues": 154,
    "state": "open",
    "created_at": "2023-02-13T19:04:13Z",
    "updated_at": "2023-06-01T20:18:02Z",
    "due_on": "2023-06-16T07:00:00Z",
    "closed_at": null
  },
  "comments": 15,
  "created_at": "2023-04-13T09:39:59Z",
  "updated_at": "2023-06-01T20:18:02Z",
  "closed_at": "2023-06-01T20:18:01Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nPlease have a look on this profiling data:\r\n\r\n<img width=\"1409\" alt=\"Screenshot 2023-04-07 at 15 39 29\" src=\"https://user-images.githubusercontent.com/47811206/231719064-68329bc5-8f44-4f4f-b3aa-25f7cb0cff6d.png\">\r\n\r\nThese calls are blocking the DB for a long time and we can't request additional data for a few seconds while any of them are running.",
  "closed_by": {
    "login": "osmaczko",
    "id": 33099791,
    "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/osmaczko",
    "html_url": "https://github.com/osmaczko",
    "followers_url": "https://api.github.com/users/osmaczko/followers",
    "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
    "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
    "organizations_url": "https://api.github.com/users/osmaczko/orgs",
    "repos_url": "https://api.github.com/users/osmaczko/repos",
    "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/osmaczko/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1506669278",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1506669278",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1506669278,
    "node_id": "IC_kwDOD5KrTM5ZzfLe",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T09:45:04Z",
    "updated_at": "2023-04-13T09:45:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jrainville I've labeled this with `messenger-team` since it's affecting the chat performance, but I'm not sure if it should be on the status-desktop board or on status-go board.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1506669278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1507039055",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1507039055",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1507039055,
    "node_id": "IC_kwDOD5KrTM5Z05dP",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T14:09:17Z",
    "updated_at": "2023-04-13T14:09:17Z",
    "author_association": "MEMBER",
    "body": "It's something that will probably need to be fixed on status-go with either an index or some sort of clean up. We've seen that raw messages are kept forever, so maybe there is a bit of clean up needed there.\r\n\r\nAnyway, all that to say, it's still ok to show it here, because we don't really use the status-go board. ",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1507039055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516880758",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1516880758",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1516880758,
    "node_id": "IC_kwDOD5KrTM5aacN2",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-20T20:05:47Z",
    "updated_at": "2023-04-20T20:05:47Z",
    "author_association": "MEMBER",
    "body": "I can't reproduce those long call times on current master.\r\nI'm using the shared dev account and still, those calls resolve in less than a millisecond for me.\r\n\r\nIs this an OS thing, an account/DB thing or was it maybe fixed in the meantime?\r\n\r\nMaybe I'm calculating it badly. I just put a benchmark  `cpuTime() - time` after the call to ChatPinnedMessages and FirstUnseenMessageID on the Nim side (backend/messages.nim), and the times are this small (in seconds): \r\n```\r\nDONE firstUnseenMessageID : 0.0002839660000000001\r\nDONE fetchPinnedMessages : 0.01356774199999999\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516880758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516881755",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1516881755",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1516881755,
    "node_id": "IC_kwDOD5KrTM5aacdb",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-20T20:06:42Z",
    "updated_at": "2023-04-20T20:06:42Z",
    "author_association": "MEMBER",
    "body": "This is also before Andrea's fix + index added here https://github.com/status-im/status-go/pull/3414/files#diff-79719d4e91ccd3a2f5d16881e905800c23cc3e3054827916f24030cf052b1965, which will likely help as well",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1516881755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519456013",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1519456013",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1519456013,
    "node_id": "IC_kwDOD5KrTM5akQ8N",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T06:23:31Z",
    "updated_at": "2023-04-24T06:23:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I can't reproduce those long call times on current master. I'm using the shared dev account and still, those calls resolve in less than a millisecond for me.\r\n> \r\n> Is this an OS thing, an account/DB thing or was it maybe fixed in the meantime?\r\n> \r\n> Maybe I'm calculating it badly. I just put a benchmark `cpuTime() - time` after the call to ChatPinnedMessages and FirstUnseenMessageID on the Nim side (backend/messages.nim), and the times are this small (in seconds):\r\n> \r\n> ```\r\n> DONE firstUnseenMessageID : 0.0002839660000000001\r\n> DONE fetchPinnedMessages : 0.01356774199999999\r\n> ```\r\n\r\nIt definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow `firstUnseenMessageID` and `fetchPinnedMessages`.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519456013/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519597510",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1519597510",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1519597510,
    "node_id": "IC_kwDOD5KrTM5akzfG",
    "user": {
      "login": "caybro",
      "id": 5377645,
      "node_id": "MDQ6VXNlcjUzNzc2NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377645?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caybro",
      "html_url": "https://github.com/caybro",
      "followers_url": "https://api.github.com/users/caybro/followers",
      "following_url": "https://api.github.com/users/caybro/following{/other_user}",
      "gists_url": "https://api.github.com/users/caybro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caybro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caybro/subscriptions",
      "organizations_url": "https://api.github.com/users/caybro/orgs",
      "repos_url": "https://api.github.com/users/caybro/repos",
      "events_url": "https://api.github.com/users/caybro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caybro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T08:12:34Z",
    "updated_at": "2023-04-24T08:12:34Z",
    "author_association": "MEMBER",
    "body": "> > I can't reproduce those long call times on current master. I'm using the shared dev account and still, those calls resolve in less than a millisecond for me.\r\n> > Is this an OS thing, an account/DB thing or was it maybe fixed in the meantime?\r\n> > Maybe I'm calculating it badly. I just put a benchmark `cpuTime() - time` after the call to ChatPinnedMessages and FirstUnseenMessageID on the Nim side (backend/messages.nim), and the times are this small (in seconds):\r\n> > ```\r\n> > DONE firstUnseenMessageID : 0.0002839660000000001\r\n> > DONE fetchPinnedMessages : 0.01356774199999999\r\n> > ```\r\n> \r\n> It definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow `firstUnseenMessageID` and `fetchPinnedMessages`.\r\n\r\nYup, it's very slow on large databases",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1519597510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520292441",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520292441",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520292441,
    "node_id": "IC_kwDOD5KrTM5andJZ",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T14:37:52Z",
    "updated_at": "2023-04-24T14:37:52Z",
    "author_association": "MEMBER",
    "body": "This was incorrectly closed when my other PR was closed. Reopening",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520292441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520303149",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520303149",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520303149,
    "node_id": "IC_kwDOD5KrTM5anfwt",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T14:42:56Z",
    "updated_at": "2023-04-24T14:42:56Z",
    "author_association": "MEMBER",
    "body": "> It definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow firstUnseenMessageID and fetchPinnedMessages.\r\n\r\nYeah, I was using the shared dev account that has the Status community and Discord import. It is 10GB big. So not as big, but still very sizable.\r\n\r\nI was wondering if maybe the biggest problem was already fixed, since I'm no where close to 7 seconds per call.\r\n\r\nMaybe you can try again on latest master to see where you're at now with those calls @alexjba ?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520303149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520330358",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520330358",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520330358,
    "node_id": "IC_kwDOD5KrTM5anmZ2",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T14:51:58Z",
    "updated_at": "2023-04-24T14:51:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > It definitely depends on the DB size. I'm using a DB with Status Community that has about 14GB. But I guess it can be considered an account with a reasonable size. I doubt it's dependent on the OS. Linux users are also reporting slow firstUnseenMessageID and fetchPinnedMessages.\r\n> \r\n> Yeah, I was using the shared dev account that has the Status community and Discord import. It is 10GB big. So not as big, but still very sizable.\r\n> \r\n> I was wondering if maybe the biggest problem was already fixed, since I'm no where close to 7 seconds per call.\r\n> \r\n> Maybe you can try again on latest master to see where you're at now with those calls @alexjba ?\r\n\r\nYes, I'm currently testing it on master. But I have other difficulties while switching channels. Sometimes the channel is not activated when selected (channel is changed in the channels list, but the message history doesn't change) or some channels don't load at all, or sometimes the channel loading screen is not triggered.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520330358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520344827",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1520344827",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1520344827,
    "node_id": "IC_kwDOD5KrTM5anp77",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T15:00:26Z",
    "updated_at": "2023-04-24T15:00:26Z",
    "author_association": "MEMBER",
    "body": "> Yes, I'm currently testing it on master. But I have other difficulties while switching channels. Sometimes the channel is not activated when selected (channel is changed in the channels list, but the message history doesn't change) or some channels don't load at all, or sometimes the channel loading screen is not triggered.\r\n\r\nAh yes, sorry about that. I broke that last week, but I have a PR here: https://github.com/status-im/status-desktop/pull/10398",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1520344827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1523090897",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1523090897",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1523090897,
    "node_id": "IC_kwDOD5KrTM5ayIXR",
    "user": {
      "login": "alexjba",
      "id": 47811206,
      "node_id": "MDQ6VXNlcjQ3ODExMjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47811206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexjba",
      "html_url": "https://github.com/alexjba",
      "followers_url": "https://api.github.com/users/alexjba/followers",
      "following_url": "https://api.github.com/users/alexjba/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexjba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexjba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexjba/subscriptions",
      "organizations_url": "https://api.github.com/users/alexjba/orgs",
      "repos_url": "https://api.github.com/users/alexjba/repos",
      "events_url": "https://api.github.com/users/alexjba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexjba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-26T09:29:02Z",
    "updated_at": "2023-04-26T09:29:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like `FirstUnseenMessageID` is fixed by https://github.com/status-im/status-desktop/pull/10430/files",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1523090897/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1526081182",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1526081182",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1526081182,
    "node_id": "IC_kwDOD5KrTM5a9iae",
    "user": {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T17:36:58Z",
    "updated_at": "2023-04-27T17:45:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Good news! I've identified the cause of the slow channel switching.\r\n\r\nHere's our story, the sequence of events:\r\n```\r\n1. async getMessages -> locks the database for x ms\r\n2. async getPinnedMessages -> locks the database for y ms\r\n3. async getFirstUnseenMessageId -> locks the database for z ms\r\n```\r\n\r\nContrary to what the profiler suggests, `getFirstUnseenMessageId` isn't the main issue. It's actually blocked for x+y+z ms due to the database locks. I tested it in separation, `getFirstUnseenMessageId` is at max 250ms for huge channels and after this change: https://github.com/status-im/status-go/commit/a7d7609a771dda6ceaa1100a5209535570c530bb, it will be max 10ms. There will be no need to keep it async anymore.\r\n\r\nTo improve channel switching speed, it's crucial that we optimize the performance of the `getPinnedMessages` query. Since the database is single-threaded, there's no other solution. Consider a scenario where a user switches between 10 channels quickly. The last channel would only open after 10*(x+y+z) ms, as all the queries would stack up.",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1526081182/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 2,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1527311919",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1527311919",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1527311919,
    "node_id": "IC_kwDOD5KrTM5bCO4v",
    "user": {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T10:02:26Z",
    "updated_at": "2023-04-28T10:07:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Improving the performance of the `getPinnedMessages` query alone may not fully resolve the issue. It appears that in some cases, we lack control over what locks the database and the duration of the lock, see: https://github.com/status-im/status-desktop/issues/10471#issuecomment-1527227333. This could also explain why switching between the same channels is sometimes fast and other times slow.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1527311919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1535027234",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1535027234",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1535027234,
    "node_id": "IC_kwDOD5KrTM5bfqgi",
    "user": {
      "login": "jrainville",
      "id": 11926403,
      "node_id": "MDQ6VXNlcjExOTI2NDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/11926403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jrainville",
      "html_url": "https://github.com/jrainville",
      "followers_url": "https://api.github.com/users/jrainville/followers",
      "following_url": "https://api.github.com/users/jrainville/following{/other_user}",
      "gists_url": "https://api.github.com/users/jrainville/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jrainville/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jrainville/subscriptions",
      "organizations_url": "https://api.github.com/users/jrainville/orgs",
      "repos_url": "https://api.github.com/users/jrainville/repos",
      "events_url": "https://api.github.com/users/jrainville/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jrainville/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T16:16:44Z",
    "updated_at": "2023-05-04T16:16:44Z",
    "author_association": "MEMBER",
    "body": "Dependent on https://github.com/status-im/status-desktop/issues/10558",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1535027234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1572719183",
    "html_url": "https://github.com/status-im/status-desktop/issues/10282#issuecomment-1572719183",
    "issue_url": "https://api.github.com/repos/status-im/status-desktop/issues/10282",
    "id": 1572719183,
    "node_id": "IC_kwDOD5KrTM5dvcpP",
    "user": {
      "login": "osmaczko",
      "id": 33099791,
      "node_id": "MDQ6VXNlcjMzMDk5Nzkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33099791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/osmaczko",
      "html_url": "https://github.com/osmaczko",
      "followers_url": "https://api.github.com/users/osmaczko/followers",
      "following_url": "https://api.github.com/users/osmaczko/following{/other_user}",
      "gists_url": "https://api.github.com/users/osmaczko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/osmaczko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/osmaczko/subscriptions",
      "organizations_url": "https://api.github.com/users/osmaczko/orgs",
      "repos_url": "https://api.github.com/users/osmaczko/repos",
      "events_url": "https://api.github.com/users/osmaczko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/osmaczko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-01T20:18:01Z",
    "updated_at": "2023-06-01T20:18:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Has been fixed on the way of https://github.com/status-im/status-desktop/issues/10558 - the root cause was db locks",
    "reactions": {
      "url": "https://api.github.com/repos/status-im/status-desktop/issues/comments/1572719183/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
