{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4301",
  "id": 1252222555,
  "node_id": "I_kwDOC0FsAM5Ko2Zb",
  "number": 4301,
  "title": "dev chain stuck at \"Waiting for headers...\"",
  "user": {
    "login": "mohoff",
    "id": 6060612,
    "node_id": "MDQ6VXNlcjYwNjA2MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6060612?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohoff",
    "html_url": "https://github.com/mohoff",
    "followers_url": "https://api.github.com/users/mohoff/followers",
    "following_url": "https://api.github.com/users/mohoff/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohoff/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohoff/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohoff/subscriptions",
    "organizations_url": "https://api.github.com/users/mohoff/orgs",
    "repos_url": "https://api.github.com/users/mohoff/repos",
    "events_url": "https://api.github.com/users/mohoff/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohoff/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-05-30T05:46:04Z",
  "updated_at": "2022-06-06T22:47:29Z",
  "closed_at": "2022-06-06T22:47:28Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2022.05.8-alpha-1d2551e0`\r\n\r\n\r\n#### Expected behaviour\r\n\r\nThe following command should mine a new block every few seconds:\r\n\r\n```\r\nerigon\r\n       --datadir mydatadir \\\r\n        --chain dev \\\r\n        --private.api.addr \"localhost:9090\" \\\r\n        --http=false \\\r\n        --mine \\\r\n        --dev.period 2 \\\r\n        --verbosity 5 \\\r\n        --networkid 1337 \\\r\n        --allow-insecure-unlock \\\r\n        --discovery.dns \"\"\r\n```\r\n\r\nThe combination of `--mine` and `--dev.period 2` was working in the past release `2022.04.01` without issues.\r\n\r\n#### Actual behaviour\r\n\r\nDev chain is stuck. Logs are\r\n\r\n```\r\n[INFO] [05-30|05:22:05.425] local tx propagated                      tx_hash=8a69d6e1d0b1b49039d5e5923231087fff89500990ae002a85a87e4eb0010562 announced to peers=0 broadcast to peers=0 baseFee=28272124\r\n[DBUG] [05-30|05:22:05.425] [1/5 MiningCreateBlock] Candidate txs    amount=11\r\n[INFO] [05-30|05:22:05.425] [1/5 MiningCreateBlock] Start mine       block=29 baseFee=28272124 gasLimit=11830132\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] Extraction finished      took=27.6µs\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] ETL Load done            bucket=HashedCodeHash records=4\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] Load finished            took=37.5µs\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] Extraction finished      took=24.6µs\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] ETL Load done            bucket=HashedAccount records=7\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] Load finished            took=36.3µs\r\n[TRACE] [05-30|05:22:05.427] [3/5 HashState] Extraction finished      took=176.7µs\r\n[TRACE] [05-30|05:22:05.428] [3/5 HashState] ETL Load done            bucket=HashedStorage records=60\r\n[TRACE] [05-30|05:22:05.428] [3/5 HashState] Load finished            took=131.8µs\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] Incremental state promotion of intermediate hashes from=28 to=29 csbucket=AccountChangeSet\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] Extraction finished took=25.6µs\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] ETL Load done   bucket= records=0\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] Load finished   took=27.7µs\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] Incremental state promotion of intermediate hashes from=28 to=29 csbucket=StorageChangeSet\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] Extraction finished took=240.4µs\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] ETL Load done   bucket= records=0\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] Load finished   took=64.8µs\r\n[TRACE] [05-30|05:22:05.428] [4/5 IntermediateHashes] ETL Load done   bucket=TrieAccount records=22\r\n[TRACE] [05-30|05:22:05.429] [4/5 IntermediateHashes] ETL Load done   bucket=TrieStorage records=7\r\n[INFO] [05-30|05:22:05.429] [5/5 MiningFinish] block ready for seal  blocn_num=29 transactions=11 gas_used=2281753 gas_limit=11830132 difficulty=2\r\n[TRACE] [05-30|05:22:05.429] Waiting for slot to sign and propagate   delay=1.570s\r\n[TRACE] [05-30|05:22:07.000] Link queue                               size=0\r\n[WARN] [05-30|05:22:07.000] Sealing result is not read by miner      sealhash=0x8f9288669b2491692c1f238af8ecef471b92e24e117d2d254ddf12d514de2e4d\r\n[INFO] [05-30|05:22:07.000] [1/16 Headers] Waiting for headers...    from=28\r\n[WARN] [05-30|05:22:07.000] Sealing result is not read by miner      sealhash=0xb26535e41dd29cb1b7156582bfa535c1d16f5e13fe15801d6857b8725d7509bd\r\n[WARN] [05-30|05:22:07.000] Sealing result is not read by miner      sealhash=0xb25225244582cdeb2a8c389a5001ca788b2c38609311befb4fd77cff3b0677df\r\n[WARN] [05-30|05:22:07.001] Sealing result is not read by miner      sealhash=0x73c6bbd7bfa869025227c61c4c7a2bc4bc66006702fafae97ce126b8c81f5a7d\r\n[WARN] [05-30|05:22:07.001] Sealing result is not read by miner      sealhash=0x9ed7f18a11db3a370bf8a30671ba3f7b80a4c7a13fc2e45455dca91aaf1f56d5\r\n[WARN] [05-30|05:22:07.001] Sealing result is not read by miner      sealhash=0x03975a4dfbb8a98ce405861f736168eb3dd492dabab0d34da29dfca78548893e\r\n[WARN] [05-30|05:22:07.001] Sealing result is not read by miner      sealhash=0xb42045b0808fc6eae9015e11d7b2d3d618bff9bfae5985e0554b09c3aff0245b\r\n[WARN] [05-30|05:22:07.000] Sealing result is not read by miner      sealhash=0x99f5e2c7f7dc04d557904a219a489f4b1d2e4a95f0f9501fc6eb03f070307a4f\r\n[TRACE] [05-30|05:22:07.001] Link queue                               size=0\r\n[TRACE] [05-30|05:22:07.001] Empty anchor queue\r\n[DBUG] [05-30|05:22:07.001] Request skeleton                         anchors=0 top seen height=0 highestInDb=28\r\n[TRACE] [05-30|05:22:07.001] Link queue                               size=0\r\n[INFO] [05-30|05:22:07.007] [1/16 Headers] Processed                 highest inserted=29 age=0\r\n[TRACE] [05-30|05:22:07.007] RequestQueueTime (header) ticked\r\n[TRACE] [05-30|05:22:07.007] RequestQueueTime (header) ticked\r\n[TRACE] [05-30|05:22:07.009] [3/16 BlockHashes] Extraction finished   took=26.6µs\r\n[TRACE] [05-30|05:22:07.009] [3/16 BlockHashes] ETL Load done         bucket=HeaderNumber records=4\r\n[TRACE] [05-30|05:22:07.009] [3/16 BlockHashes] Load finished         took=57.9µs\r\n[TRACE] [05-30|05:22:07.013] [5/16 Senders] Read canonical hashes     amount=1\r\n[TRACE] [05-30|05:22:07.014] [5/16 Senders] ETL Load done             bucket=TxSender records=1\r\n[TRACE] [05-30|05:22:07.017] [] ETL Load done                         bucket=PlainState records=38\r\n[TRACE] [05-30|05:22:07.017] [] ETL Load done                         bucket=SyncStage records=1\r\n[INFO] [05-30|05:22:07.019] [6/16 Execution] Completed on            block=29\r\n[TRACE] [05-30|05:22:07.019] Translation disabled. Enable by adding `tevm` to --experiments\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] Extraction finished     took=48.4µs\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] ETL Load done           bucket=HashedCodeHash records=2\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] Load finished           took=40.4µs\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] Extraction finished     took=23µs\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] ETL Load done           bucket=HashedAccount records=4\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] Load finished           took=38.2µs\r\n[TRACE] [05-30|05:22:07.019] [8/16 HashState] Extraction finished     took=103.9µs\r\n[TRACE] [05-30|05:22:07.020] [8/16 HashState] ETL Load done           bucket=HashedStorage records=34\r\n[TRACE] [05-30|05:22:07.020] [8/16 HashState] Load finished           took=85.1µs\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] Incremental state promotion of intermediate hashes from=28 to=29 csbucket=AccountChangeSet\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] Extraction finished took=33.3µs\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] ETL Load done  bucket= records=0\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] Load finished  took=36.2µs\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] Incremental state promotion of intermediate hashes from=28 to=29 csbucket=StorageChangeSet\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] Extraction finished took=85.1µs\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] ETL Load done  bucket= records=0\r\n[TRACE] [05-30|05:22:07.021] [9/16 IntermediateHashes] Load finished  took=43.8µs\r\n[TRACE] [05-30|05:22:07.022] [9/16 IntermediateHashes] ETL Load done  bucket=TrieAccount records=22\r\n[TRACE] [05-30|05:22:07.022] [9/16 IntermediateHashes] ETL Load done  bucket=TrieStorage records=5\r\n[TRACE] [05-30|05:22:07.024] [10/16 CallTraces] ETL Load done         bucket=CallFromIndex records=2\r\n[TRACE] [05-30|05:22:07.024] [10/16 CallTraces] ETL Load done         bucket=CallToIndex records=4\r\n[TRACE] [05-30|05:22:07.025] [11/16 AccountHistoryIndex] ETL Load done bucket=AccountHistory records=4\r\n[TRACE] [05-30|05:22:07.027] [12/16 StorageHistoryIndex] ETL Load done bucket=StorageHistory records=34\r\n[TRACE] [05-30|05:22:07.029] [13/16 LogIndex] ETL Load done           bucket=LogTopicIndex records=11\r\n[TRACE] [05-30|05:22:07.029] [13/16 LogIndex] ETL Load done           bucket=LogAddressIndex records=2\r\n[TRACE] [05-30|05:22:07.031] [14/16 TxLookup] Extraction finished     took=82.4µs\r\n[TRACE] [05-30|05:22:07.031] [14/16 TxLookup] ETL Load done           bucket=BlockTransactionLookup records=6\r\n[TRACE] [05-30|05:22:07.031] [14/16 TxLookup] Load finished           took=82.8µs\r\n[TRACE] [05-30|05:22:07.034] Prune...                                 stage=Finish\r\n[TRACE] [05-30|05:22:07.034] Prune...                                 stage=TxLookup\r\n[TRACE] [05-30|05:22:07.034] Prune...                                 stage=LogIndex\r\n[TRACE] [05-30|05:22:07.034] Prune...                                 stage=StorageHistoryIndex\r\n[TRACE] [05-30|05:22:07.035] Prune...                                 stage=AccountHistoryIndex\r\n[TRACE] [05-30|05:22:07.035] Prune...                                 stage=CallTraces\r\n[TRACE] [05-30|05:22:07.036] Prune...                                 stage=HashState\r\n[TRACE] [05-30|05:22:07.037] Prune...                                 stage=IntermediateHashes\r\n[TRACE] [05-30|05:22:07.038] Prune...                                 stage=Execution\r\n[TRACE] [05-30|05:22:07.040] Prune...                                 stage=Senders\r\n[TRACE] [05-30|05:22:07.040] Prune...                                 stage=Bodies\r\n[TRACE] [05-30|05:22:07.040] Prune...                                 stage=BlockHashes\r\n[TRACE] [05-30|05:22:07.040] Prune...                                 stage=Headers\r\n[INFO] [05-30|05:22:07.040] RPC Daemon notified of new headers       from=28 to=29 header sending=12.9µs log sending=4.1µs\r\n[INFO] [05-30|05:22:07.041] [1/16 Headers] Waiting for headers...    from=29\r\n[TRACE] [05-30|05:22:07.041] Empty anchor queue\r\n[DBUG] [05-30|05:22:07.041] Request skeleton                         anchors=0 top seen height=0 highestInDb=29\r\n[TRACE] [05-30|05:22:08.042] RequestQueueTime (header) ticked\r\n[TRACE] [05-30|05:22:08.042] Empty anchor queue\r\n```\r\n\r\nThe last 3 lines repeat over and over. Re-running the same command shows that the dev chain is getting stuck at block height 27-29.\r\n\r\nAny ideas? Thanks",
  "closed_by": {
    "login": "mohoff",
    "id": 6060612,
    "node_id": "MDQ6VXNlcjYwNjA2MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6060612?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohoff",
    "html_url": "https://github.com/mohoff",
    "followers_url": "https://api.github.com/users/mohoff/followers",
    "following_url": "https://api.github.com/users/mohoff/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohoff/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohoff/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohoff/subscriptions",
    "organizations_url": "https://api.github.com/users/mohoff/orgs",
    "repos_url": "https://api.github.com/users/mohoff/repos",
    "events_url": "https://api.github.com/users/mohoff/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohoff/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1143424853",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4301#issuecomment-1143424853",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301",
    "id": 1143424853,
    "node_id": "IC_kwDOC0FsAM5EJ0dV",
    "user": {
      "login": "enriavil1",
      "id": 19207637,
      "node_id": "MDQ6VXNlcjE5MjA3NjM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/enriavil1",
      "html_url": "https://github.com/enriavil1",
      "followers_url": "https://api.github.com/users/enriavil1/followers",
      "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
      "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
      "organizations_url": "https://api.github.com/users/enriavil1/orgs",
      "repos_url": "https://api.github.com/users/enriavil1/repos",
      "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/enriavil1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T10:29:59Z",
    "updated_at": "2022-06-01T10:29:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "This PR is to solve this issue but it needs some testing. #4266",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1143424853/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1148008083",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4301#issuecomment-1148008083",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4301",
    "id": 1148008083,
    "node_id": "IC_kwDOC0FsAM5EbTaT",
    "user": {
      "login": "mohoff",
      "id": 6060612,
      "node_id": "MDQ6VXNlcjYwNjA2MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6060612?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohoff",
      "html_url": "https://github.com/mohoff",
      "followers_url": "https://api.github.com/users/mohoff/followers",
      "following_url": "https://api.github.com/users/mohoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohoff/subscriptions",
      "organizations_url": "https://api.github.com/users/mohoff/orgs",
      "repos_url": "https://api.github.com/users/mohoff/repos",
      "events_url": "https://api.github.com/users/mohoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohoff/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-06T22:47:28Z",
    "updated_at": "2022-06-06T22:47:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @enriavil1 . The latest release fixed this but I'm running into a new issue. Will create a new report.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1148008083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
