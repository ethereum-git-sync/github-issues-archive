{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2309",
  "id": 938520119,
  "node_id": "MDU6SXNzdWU5Mzg1MjAxMTk=",
  "number": 2309,
  "title": "Implement eth_feeHistory API",
  "user": {
    "login": "perama-v",
    "id": 83961755,
    "node_id": "MDQ6VXNlcjgzOTYxNzU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/83961755?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/perama-v",
    "html_url": "https://github.com/perama-v",
    "followers_url": "https://api.github.com/users/perama-v/followers",
    "following_url": "https://api.github.com/users/perama-v/following{/other_user}",
    "gists_url": "https://api.github.com/users/perama-v/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/perama-v/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/perama-v/subscriptions",
    "organizations_url": "https://api.github.com/users/perama-v/orgs",
    "repos_url": "https://api.github.com/users/perama-v/repos",
    "events_url": "https://api.github.com/users/perama-v/events{/privacy}",
    "received_events_url": "https://api.github.com/users/perama-v/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-07-07T06:04:02Z",
  "updated_at": "2021-08-12T06:38:04Z",
  "closed_at": "2021-08-12T06:38:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# Rationale\r\n\r\nWhy should this feature exist?\r\n\r\nThe eth_feeHistory API was recently introduced in the [JSON-RPC spec](https://github.com/ethereum/eth1.0-specs/blob/master/json-rpc/spec.json) as a counterpart to [EIP1559](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1559.md), which is currently live on Ropsten & Goerli and is scheduled for mainnet at [block 12965000](https://github.com/ethereum/eth1.0-specs/pull/223).\r\n\r\nThe API exposes information that is useful for setting parameters for the new transaction fee mechanism. One main rationale for EIP1559 is to improve the transaction-sending user experience. Wallet designers seeking to implement a change to deliver the improved user experience will need to have access to that information. \r\n\r\nTogether, a wallet and user must select two parameters, `maxPriorityFeePerGas` and `maxFeePerGas`. If the API was implemented on Erigon it would allow for rational selection of those two parameters using an Erigon node. Otherwise, another source of information might be needed.\r\n\r\nThis API might remove the need for third party gas price oracles, increasing users autonomy and rewarding those who run an Erigon node.\r\n\r\nWhat are the use-cases?\r\n\r\n- Check the current and recent base fees to plan maximum fee (`maxFeePerGas`). For example, a wallet might choose a maximum fee that is twice the base fee.\r\n- Fetch recent priority fee distribution to plan gas premium (`maxPriorityFeePerGas`). For example, a wallet might choose the gas premium that was the lowest accepted in the last block, or the average of some percentile that matches user preference.\r\n- Convey customised fee information to users (e.g., Wallets or explorers showing a chart of base fees or recent gas premia).\r\n\r\nA range of wallet-related resources are [here](https://hackmd.io/4YVYKxxvRZGDto7aq7rVkg?view). I also made some notes on what the API could enable for a wallet UI [here](https://perama-v.github.io/cairo/ethereum/wallet-design).\r\n\r\n# Implementation\r\n\r\nI am making this issue primarily to raise awareness about the API and the ecosystem it might support. While not strictly required before the Mainnet hard fork, there might be a dependency graph:\r\n\r\n0. Erigon API implementation.\r\n1. Erigon-based wallets/services implement change using JSON-RPC API.\r\n2. Services that want to deliver UI improvement can implement on Ropsten/Goerli and test.\r\n3. Mainnet forks and end-user wallets/services transition cleanly.\r\n\r\nI will not be implementing the API, but hope to instead be useful in the process if I can. \r\n\r\n## API notes\r\n\r\nHere is a digest that I have made using the JSON-RPC spec, which outlines the key components used in the API POST method.\r\n\r\n- `blockCount`\r\n    - **Required**\r\n    - *How many blocks of fee history are wanted?*\r\n    - \"Number of blocks in the requested range. Between 1 and 1024 blocks can be requested in a\r\n    single query. Less than requested may be returned if not all blocks are available.\"\r\n    - Formatted as a hexadecimal representation of the integer as a string.\r\n        - e.g. for 25 blocks, `str(hex(25)) = \"0x19\"`.\r\n- `newestBlock`\r\n    - **Required**\r\n    - *What is the most recent block that is wanted?*\r\n    - \"Highest number block of the requested range.\"\r\n    - Formatted as either of:\r\n        - A hexadecimal representation of the integer as a string.\r\n            - e.g. for block 5093543, `str(hex(5093543)) = \"0x4db8a7\"`.\r\n            - *This is the most recent block that is wanted*.\r\n        - A descriptor string, one of:\r\n            - \"earliest\".\r\n                - *Starting from genesis*\r\n            - \"latest\".\r\n                - *The block that was just mined.*\r\n            - \"pending\".\r\n                - *The block that is about to be mined.*\r\n- `rewardPercentiles`\r\n    - **Optional**\r\n    - *Which percentiles of the gas premium are wanted?*\r\n    - \"A monotonically increasing list of percentile values to sample from each block's\r\n    effective priority fees per gas in ascending order, weighted by gas used.\"\r\n    - E.g. 0th, 25th, 50th, 75th and 90th percentiles.\r\n    - Formatted as floating point values between 0 and 100 as a string.\r\n        - E.g. For the example above:\r\n            - [\"0\", \"25\", \"50\", \"75\", \"100\"]\r\n        - Or percentiles 0-3rd with 0.5 increments, and the 80th percentile:\r\n            - [\"0\", \"0.5\", \"1\", \"1.5\", \"2\", \"2.5\", \"3\", \"80\"]\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/877769113",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2309#issuecomment-877769113",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309",
    "id": 877769113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3Nzc2OTExMw==",
    "user": {
      "login": "0xjanitor",
      "id": 82562742,
      "node_id": "MDQ6VXNlcjgyNTYyNzQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82562742?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xjanitor",
      "html_url": "https://github.com/0xjanitor",
      "followers_url": "https://api.github.com/users/0xjanitor/followers",
      "following_url": "https://api.github.com/users/0xjanitor/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xjanitor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xjanitor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xjanitor/subscriptions",
      "organizations_url": "https://api.github.com/users/0xjanitor/orgs",
      "repos_url": "https://api.github.com/users/0xjanitor/repos",
      "events_url": "https://api.github.com/users/0xjanitor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xjanitor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-11T09:28:11Z",
    "updated_at": "2021-07-11T09:28:11Z",
    "author_association": "NONE",
    "body": "The latest release of Besu includes this btw",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/877769113/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 2,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/894629395",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2309#issuecomment-894629395",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309",
    "id": 894629395,
    "node_id": "IC_kwDOC0FsAM41UvYT",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-07T09:16:08Z",
    "updated_at": "2021-08-07T09:16:08Z",
    "author_association": "COLLABORATOR",
    "body": "@banteg, yep, need somebody who will implement it (probably copy-paste from geth is enough).",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/894629395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/894741869",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2309#issuecomment-894741869",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309",
    "id": 894741869,
    "node_id": "IC_kwDOC0FsAM41VK1t",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-08T04:37:18Z",
    "updated_at": "2021-08-08T04:37:18Z",
    "author_association": "COLLABORATOR",
    "body": "https://github.com/ledgerwatch/erigon/pull/2501",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/894741869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/896956824",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2309#issuecomment-896956824",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309",
    "id": 896956824,
    "node_id": "IC_kwDOC0FsAM41dnmY",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T16:08:51Z",
    "updated_at": "2021-08-11T16:08:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "This can be closed, correct? ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/896956824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/897387201",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2309#issuecomment-897387201",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2309",
    "id": 897387201,
    "node_id": "IC_kwDOC0FsAM41fQrB",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-12T06:38:03Z",
    "updated_at": "2021-08-12T06:38:03Z",
    "author_association": "COLLABORATOR",
    "body": "Yep",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/897387201/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
