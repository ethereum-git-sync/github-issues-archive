{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5364",
  "id": 1373086877,
  "node_id": "I_kwDOC0FsAM5R16Sd",
  "number": 5364,
  "title": "BSC mainnet not syncing after being offline for ~30 days",
  "user": {
    "login": "codylittle",
    "id": 42286039,
    "node_id": "MDQ6VXNlcjQyMjg2MDM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/42286039?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/codylittle",
    "html_url": "https://github.com/codylittle",
    "followers_url": "https://api.github.com/users/codylittle/followers",
    "following_url": "https://api.github.com/users/codylittle/following{/other_user}",
    "gists_url": "https://api.github.com/users/codylittle/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/codylittle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codylittle/subscriptions",
    "organizations_url": "https://api.github.com/users/codylittle/orgs",
    "repos_url": "https://api.github.com/users/codylittle/repos",
    "events_url": "https://api.github.com/users/codylittle/events{/privacy}",
    "received_events_url": "https://api.github.com/users/codylittle/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2022-09-14T14:28:33Z",
  "updated_at": "2022-09-18T08:28:08Z",
  "closed_at": "2022-09-18T08:06:55Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2022.08.3-alpha-0c64c3f2 (on devel)\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash : 0c64c3f2c795da998c539c059edbc5544d03bb7b\r\n\r\n#### Expected behaviour\r\nBSC continues syncing\r\n\r\n#### Actual behaviour\r\nGets stuck during stage 2\r\n\r\nlogs: [https://pastebin.com/Qm0avebG](https://pastebin.com/Qm0avebG)\r\n",
  "closed_by": {
    "login": "codylittle",
    "id": 42286039,
    "node_id": "MDQ6VXNlcjQyMjg2MDM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/42286039?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/codylittle",
    "html_url": "https://github.com/codylittle",
    "followers_url": "https://api.github.com/users/codylittle/followers",
    "following_url": "https://api.github.com/users/codylittle/following{/other_user}",
    "gists_url": "https://api.github.com/users/codylittle/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/codylittle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codylittle/subscriptions",
    "organizations_url": "https://api.github.com/users/codylittle/orgs",
    "repos_url": "https://api.github.com/users/codylittle/repos",
    "events_url": "https://api.github.com/users/codylittle/events{/privacy}",
    "received_events_url": "https://api.github.com/users/codylittle/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1246874340",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1246874340",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1246874340,
    "node_id": "IC_kwDOC0FsAM5KUcrk",
    "user": {
      "login": "codylittle",
      "id": 42286039,
      "node_id": "MDQ6VXNlcjQyMjg2MDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/42286039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codylittle",
      "html_url": "https://github.com/codylittle",
      "followers_url": "https://api.github.com/users/codylittle/followers",
      "following_url": "https://api.github.com/users/codylittle/following{/other_user}",
      "gists_url": "https://api.github.com/users/codylittle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codylittle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codylittle/subscriptions",
      "organizations_url": "https://api.github.com/users/codylittle/orgs",
      "repos_url": "https://api.github.com/users/codylittle/repos",
      "events_url": "https://api.github.com/users/codylittle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codylittle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-14T14:43:00Z",
    "updated_at": "2022-09-14T14:43:00Z",
    "author_association": "NONE",
    "body": "Output of print_stages:\r\n```\r\nuser@srv1:~/erigon$ ./build/bin/integration print_stages --datadir=/home/user/zfs/bsc --chain=bsc\r\nNote: prune_at doesn't mean 'all data before were deleted' - it just mean stage.Prune function were run to this block. Because 1 stage may prune multiple data types to different prune distance.\r\n\r\n                                 stage_at        prune_at\r\nSnapshots                        20735999        0\r\nHeaders                          20635989        0\r\nBlockHashes                      20735999        0\r\nBodies                           20635989        0\r\nSenders                          20735999        0\r\nExecution                        20826803        20826803\r\nTranslation                      0               0\r\nHashState                        20826803        0\r\nIntermediateHashes               20826803        20826803\r\nAccountHistoryIndex              20826803        20826803\r\nStorageHistoryIndex              20826803        20826803\r\nLogIndex                         20826803        20826803\r\nCallTraces                       20826803        20826803\r\nTxLookup                         20826803        20736803\r\nFinish                           20826803        0\r\n--\r\nprune distance: --prune.h.older=90000 --prune.r.older=90000 --prune.t.older=90000 --prune.c.older=90000\r\n\r\nsequence: EthTx=3375274765, NonCanonicalTx=1259\r\n\r\nfirst header in db: 17500000\r\nfirst body in db: 17500000\r\n\r\n--\r\nsnapsthos: blocks=20735999, segments=20735999, indices=20735999\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1246874340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247112090",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1247112090",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1247112090,
    "node_id": "IC_kwDOC0FsAM5KVWua",
    "user": {
      "login": "enriavil1",
      "id": 19207637,
      "node_id": "MDQ6VXNlcjE5MjA3NjM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/enriavil1",
      "html_url": "https://github.com/enriavil1",
      "followers_url": "https://api.github.com/users/enriavil1/followers",
      "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
      "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
      "organizations_url": "https://api.github.com/users/enriavil1/orgs",
      "repos_url": "https://api.github.com/users/enriavil1/repos",
      "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/enriavil1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-14T17:52:20Z",
    "updated_at": "2022-09-14T17:52:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Re do snapshot stage.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247112090/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247582431",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1247582431",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1247582431,
    "node_id": "IC_kwDOC0FsAM5KXJjf",
    "user": {
      "login": "codylittle",
      "id": 42286039,
      "node_id": "MDQ6VXNlcjQyMjg2MDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/42286039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codylittle",
      "html_url": "https://github.com/codylittle",
      "followers_url": "https://api.github.com/users/codylittle/followers",
      "following_url": "https://api.github.com/users/codylittle/following{/other_user}",
      "gists_url": "https://api.github.com/users/codylittle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codylittle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codylittle/subscriptions",
      "organizations_url": "https://api.github.com/users/codylittle/orgs",
      "repos_url": "https://api.github.com/users/codylittle/repos",
      "events_url": "https://api.github.com/users/codylittle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codylittle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-15T04:57:44Z",
    "updated_at": "2022-09-15T04:57:44Z",
    "author_association": "NONE",
    "body": "> Re do snapshot stage.\r\n\r\nHey, would this be done by deleting the snapshots folder or through integrations utility?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247582431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247875594",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1247875594",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1247875594,
    "node_id": "IC_kwDOC0FsAM5KYRIK",
    "user": {
      "login": "enriavil1",
      "id": 19207637,
      "node_id": "MDQ6VXNlcjE5MjA3NjM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/enriavil1",
      "html_url": "https://github.com/enriavil1",
      "followers_url": "https://api.github.com/users/enriavil1/followers",
      "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
      "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
      "organizations_url": "https://api.github.com/users/enriavil1/orgs",
      "repos_url": "https://api.github.com/users/enriavil1/repos",
      "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/enriavil1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-15T10:00:35Z",
    "updated_at": "2022-09-15T10:00:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "you can begin erigon with snapshots verify like this `erigon snapshots --downloader.verify` if I remember correctly\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247875594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247937014",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1247937014",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1247937014,
    "node_id": "IC_kwDOC0FsAM5KYgH2",
    "user": {
      "login": "codylittle",
      "id": 42286039,
      "node_id": "MDQ6VXNlcjQyMjg2MDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/42286039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codylittle",
      "html_url": "https://github.com/codylittle",
      "followers_url": "https://api.github.com/users/codylittle/followers",
      "following_url": "https://api.github.com/users/codylittle/following{/other_user}",
      "gists_url": "https://api.github.com/users/codylittle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codylittle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codylittle/subscriptions",
      "organizations_url": "https://api.github.com/users/codylittle/orgs",
      "repos_url": "https://api.github.com/users/codylittle/repos",
      "events_url": "https://api.github.com/users/codylittle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codylittle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-15T10:56:40Z",
    "updated_at": "2022-09-15T10:56:40Z",
    "author_association": "NONE",
    "body": "`erigon snapshots` doesn't have `--downloader.verify` but appending it to my startup command does verify the snapshots.\r\n\r\nlogs (top part got cut off but it's the same): [https://pastebin.com/vXLvJEt5](https://pastebin.com/vXLvJEt5)\r\n\r\n```\r\nuser@srv1:~/erigon$ ./build/bin/integration print_stages --datadir=\"/home/user/zfs/bsc\" --chain=bsc\r\nNote: prune_at doesn't mean 'all data before were deleted' - it just mean stage.Prune function were run to this block. Because 1 stage may prune multiple data types to different prune distance.\r\n\r\n                                 stage_at        prune_at\r\nSnapshots                        20735999        0\r\nHeaders                          20635989        0\r\nBlockHashes                      20735999        0\r\nBodies                           20635989        0\r\nSenders                          20735999        0\r\nExecution                        20826803        20826803\r\nTranslation                      0               0\r\nHashState                        20826803        0\r\nIntermediateHashes               20826803        20826803\r\nAccountHistoryIndex              20826803        20826803\r\nStorageHistoryIndex              20826803        20826803\r\nLogIndex                         20826803        20826803\r\nCallTraces                       20826803        20826803\r\nTxLookup                         20826803        20736803\r\nFinish                           20826803        0\r\n--\r\nprune distance: --prune.h.older=90000 --prune.r.older=90000 --prune.t.older=90000 --prune.c.older=90000\r\n\r\nsequence: EthTx=3375274765, NonCanonicalTx=1259\r\n\r\nfirst header in db: 17500000\r\nfirst body in db: 17500000\r\n\r\n--\r\nsnapsthos: blocks=20735999, segments=20735999, indices=20735999\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1247937014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1248310289",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1248310289",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1248310289,
    "node_id": "IC_kwDOC0FsAM5KZ7QR",
    "user": {
      "login": "enriavil1",
      "id": 19207637,
      "node_id": "MDQ6VXNlcjE5MjA3NjM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/enriavil1",
      "html_url": "https://github.com/enriavil1",
      "followers_url": "https://api.github.com/users/enriavil1/followers",
      "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
      "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
      "organizations_url": "https://api.github.com/users/enriavil1/orgs",
      "repos_url": "https://api.github.com/users/enriavil1/repos",
      "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/enriavil1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-15T16:08:52Z",
    "updated_at": "2022-09-15T16:08:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Okay delete the snapshots and run erigon again.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1248310289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1250216766",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1250216766",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1250216766,
    "node_id": "IC_kwDOC0FsAM5KhMs-",
    "user": {
      "login": "codylittle",
      "id": 42286039,
      "node_id": "MDQ6VXNlcjQyMjg2MDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/42286039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codylittle",
      "html_url": "https://github.com/codylittle",
      "followers_url": "https://api.github.com/users/codylittle/followers",
      "following_url": "https://api.github.com/users/codylittle/following{/other_user}",
      "gists_url": "https://api.github.com/users/codylittle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codylittle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codylittle/subscriptions",
      "organizations_url": "https://api.github.com/users/codylittle/orgs",
      "repos_url": "https://api.github.com/users/codylittle/repos",
      "events_url": "https://api.github.com/users/codylittle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codylittle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-18T08:06:55Z",
    "updated_at": "2022-09-18T08:06:55Z",
    "author_association": "NONE",
    "body": "@enriavil1 deleting the snapshots folder and redownloading the snapshots appears to have worked (up to writing block bodies).\r\nGoing to close for the time being, but will reopen if issue persists later on.\r\nJust for future reference, what gave it away that it was the snapshots that were wrong?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1250216766/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1250220333",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5364#issuecomment-1250220333",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5364",
    "id": 1250220333,
    "node_id": "IC_kwDOC0FsAM5KhNkt",
    "user": {
      "login": "enriavil1",
      "id": 19207637,
      "node_id": "MDQ6VXNlcjE5MjA3NjM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/enriavil1",
      "html_url": "https://github.com/enriavil1",
      "followers_url": "https://api.github.com/users/enriavil1/followers",
      "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
      "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
      "organizations_url": "https://api.github.com/users/enriavil1/orgs",
      "repos_url": "https://api.github.com/users/enriavil1/repos",
      "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/enriavil1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-18T08:28:08Z",
    "updated_at": "2022-09-18T08:28:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "The problem was that I changed how snapshots work to have their own state, but bodies, headers, senders, etc stages were not synced up to the snapshots progress. The solution to that is just redoing the snapshot stage by deleting the snapshot file and re-downloading erigon snapshots.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1250220333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
