{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6817",
  "id": 1577996588,
  "node_id": "I_kwDOC0FsAM5eDlEs",
  "number": 6817,
  "title": "Missing field `withdrawals` on Zhejiang",
  "user": {
    "login": "peteriscan",
    "id": 104527020,
    "node_id": "U_kgDOBjr0rA",
    "avatar_url": "https://avatars.githubusercontent.com/u/104527020?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/peteriscan",
    "html_url": "https://github.com/peteriscan",
    "followers_url": "https://api.github.com/users/peteriscan/followers",
    "following_url": "https://api.github.com/users/peteriscan/following{/other_user}",
    "gists_url": "https://api.github.com/users/peteriscan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/peteriscan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/peteriscan/subscriptions",
    "organizations_url": "https://api.github.com/users/peteriscan/orgs",
    "repos_url": "https://api.github.com/users/peteriscan/repos",
    "events_url": "https://api.github.com/users/peteriscan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/peteriscan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4667387573,
      "node_id": "LA_kwDOC0FsAM8AAAABFjKutQ",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/shapella",
      "name": "shapella",
      "color": "bfdadc",
      "default": false,
      "description": "The Shanghai/Capella protocol upgrade"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-02-09T14:30:08Z",
  "updated_at": "2023-03-02T13:31:02Z",
  "closed_at": "2023-02-17T22:45:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2.38.0-dev-69e8ac0e\r\n\r\nOS & Version: Ubuntu Linux 22.04.1 LTS, Docker version 23.0.0\r\n\r\nCommit hash: 69e8ac0e774e5a7555ad6f1e0d431785fff712c0\r\n\r\nErigon Command (with flags/config): see below\r\n\r\nConcensus Layer: Lighthouse\r\n\r\nConcensus Layer Command (with flags/config): see below\r\n\r\nChain/Network: Zhejiang\r\n\r\n#### Expected behaviour\r\n\r\nLighthouse returns a valid response for slot 43360.\r\n\r\n#### Actual behaviour\r\n\r\nLighthouse returns an unhandled error because it can't parse the execution client payload.\r\n\r\n```\r\n$ curl http://localhost:5052/eth/v2/beacon/blocks/43360\r\n{\r\n  \"code\": 500,\r\n  \"message\": \"UNHANDLED_ERROR: ExecutionLayerErrorPayloadReconstruction(0xc3d5a8bd379f36c54e6ed0961258fc691726f4dd09cdb34839ff2b250ee1e95c, EngineError(Api { error: Json(Error(\\\"missing field `withdrawals`\\\", line: 0, column: 0)) }))\",\r\n  \"stacktraces\": []\r\n}\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nUbuntu 22.04.1 LTS\r\n\r\nInstall Docker\r\n```\r\nsudo apt-get install git curl jq\r\ncurl -fsSL get.docker.com | bash\r\n```\r\n\r\nCreate datadirs\r\n```\r\nmkdir -p erigon lighthouse\r\nsudo chown 1000 erigon lighthouse\r\necho 0xabcbeef13b8093560da4762facfd201ace798eee90b260bd941f3e904b6d4123 > jwt.hex\r\n```\r\n\r\nZhejiang testnet data\r\n```\r\ngit clone https://github.com/ethpandaops/withdrawals-testnet.git\r\n```\r\n\r\nInitialize Erigon database\r\n```\r\nsudo docker run --rm -it \\\r\n  -v $(pwd)/erigon:/data \\\r\n  -v $(pwd)/withdrawals-testnet/zhejiang-testnet/custom_config_data:/config:ro \\\r\n  thorax/erigon:devel \\\r\n  erigon init --datadir=/data /config/genesis.json\r\n```\r\n\r\nRun Erigon\r\n```\r\nsudo docker run --rm -it \\\r\n  --network host \\\r\n  -v $(pwd)/erigon:/data \\\r\n  -v $(pwd)/jwt.hex:/var/run/secrets/jwt.hex:ro \\\r\n  thorax/erigon:devel \\\r\n  erigon \\\r\n  --datadir=/data \\\r\n  --ethash.dagdir=/data/ethash \\\r\n  --clique.datadir=/data/clique \\\r\n  --authrpc.addr=0.0.0.0 \\\r\n  --authrpc.port=8551 \\\r\n  --authrpc.vhosts=* \\\r\n  --externalcl \\\r\n  --http \\\r\n  --http.addr=0.0.0.0 \\\r\n  --http.port=8545 \\\r\n  --http.api=eth,erigon,web3,net,debug,trace,txpool,db,engine \\\r\n  --http.vhosts=* \\\r\n  --http.compression \\\r\n  --authrpc.jwtsecret=/var/run/secrets/jwt.hex \\\r\n  --txpool.disable \\\r\n  --snapshots=false \\\r\n  --networkid=1337803 \\\r\n  --bootnodes=enode://691c66d0ce351633b2ef8b4e4ef7db9966915ca0937415bd2b408df22923f274873b4d4438929e029a13a680140223dcf701cabe22df7d8870044321022dfefa@64.225.78.1:30303,enode://89347b9461727ee1849256d78e84d5c86cc3b4c6c5347650093982b726d71f3d08027e280b399b7b6604ceeda863283dcfe1a01e93728b4883114e9f8c7cc8ef@146.190.238.212:30303,enode://c2892072efe247f21ed7ebea6637ade38512a0ae7c5cffa1bf0786d5e3be1e7f40ff71252a21b36aa9de54e49edbcfc6962a98032adadfa29c8524262e484ad3@165.232.84.160:30303,enode://71e862580d3177a99e9837bd9e9c13c83bde63d3dba1d5cea18e89eb2a17786bbd47a8e7ae690e4d29763b55c205af13965efcaf6105d58e118a5a8ed2b0f6d0@68.183.13.170:30303,enode://2f6cf7f774e4507e7c1b70815f9c0ccd6515ee1170c991ce3137002c6ba9c671af38920f5b8ab8a215b62b3b50388030548f1d826cb6c2b30c0f59472804a045@161.35.147.98:30303\r\n```\r\n\r\nRun Lighthouse\r\n```\r\nsudo docker run --rm -it \\\r\n  --network host \\\r\n  -v $(pwd)/lighthouse:/data \\\r\n  -v $(pwd)/withdrawals-testnet/zhejiang-testnet/custom_config_data:/config:ro \\\r\n  -v $(pwd)/jwt.hex:/var/run/secrets/jwt.hex:ro \\\r\n  sigp/lighthouse:capella \\\r\n  lighthouse \\\r\n    --testnet-dir /config \\\r\n    --datadir /data \\\r\n    beacon \\\r\n    --http-allow-sync-stalled \\\r\n    --execution-endpoint http://localhost:8551 \\\r\n    --execution-jwt /var/run/secrets/jwt.hex \\\r\n    --http \\\r\n    --http-address 0.0.0.0 \\\r\n    --reconstruct-historic-states \\\r\n    --slots-per-restore-point 256 \\\r\n    --boot-nodes enr:-Iq4QMCTfIMXnow27baRUb35Q8iiFHSIDBJh6hQM5Axohhf4b6Kr_cOCu0htQ5WvVqKvFgY28893DHAg8gnBAXsAVqmGAX53x8JggmlkgnY0gmlwhLKAlv6Jc2VjcDI1NmsxoQK6S-Cii_KmfFdUJL2TANL3ksaKUnNXvTCv1tLwXs0QgIN1ZHCCIyk,enr:-Ly4QOS00hvPDddEcCpwA1cMykWNdJUK50AjbRgbLZ9FLPyBa78i0NwsQZLSV67elpJU71L1Pt9yqVmE1C6XeSI-LV8Bh2F0dG5ldHOIAAAAAAAAAACEZXRoMpDuKNezAAAAckYFAAAAAAAAgmlkgnY0gmlwhEDhTgGJc2VjcDI1NmsxoQIgMUMFvJGlr8dI1TEQy-K78u2TJE2rWvah9nGqLQCEGohzeW5jbmV0cwCDdGNwgiMog3VkcIIjKA,enr:-MK4QMlRAwM7E8YBo6fqP7M2IWrjFHP35uC4pWIttUioZWOiaTl5zgZF2OwSxswTQwpiVCnj4n56bhy4NJVHSe682VWGAYYDHkp4h2F0dG5ldHOIAAAAAAAAAACEZXRoMpDuKNezAAAAckYFAAAAAAAAgmlkgnY0gmlwhJK-7tSJc2VjcDI1NmsxoQLDq7LlsXIXAoJXPt7rqf6CES1Q40xPw2yW0RQ-Ly5S1YhzeW5jbmV0cwCDdGNwgiMog3VkcIIjKA,enr:-MS4QCgiQisRxtzXKlBqq_LN1CRUSGIpDKO4e2hLQsffp0BrC3A7-8F6kxHYtATnzcrsVOr8gnwmBnHYTFvE9UmT-0EHh2F0dG5ldHOIAAAAAAAAAACEZXRoMpDuKNezAAAAckYFAAAAAAAAgmlkgnY0gmlwhKXoVKCJc2VjcDI1NmsxoQK6J-uvOXMf44iIlilx1uPWGRrrTntjLEFR2u-lHcHofIhzeW5jbmV0c4gAAAAAAAAAAIN0Y3CCIyiDdWRwgiMo,enr:-LK4QOQd-elgl_-dcSoUyHDbxBFNgQ687lzcKJiSBtpCyPQ0DinWSd2PKdJ4FHMkVLWD-oOquXPKSMtyoKpI0-Wo_38Bh2F0dG5ldHOIAAAAAAAAAACEZXRoMpDuKNezAAAAckYFAAAAAAAAgmlkgnY0gmlwhES3DaqJc2VjcDI1NmsxoQNIf37JZx-Lc8pnfDwURcHUqLbIEZ1RoxjZuBRtEODseYN0Y3CCIyiDdWRwgiMo,enr:-KG4QLNORYXUK76RPDI4rIVAqX__zSkc5AqMcwAketVzN9YNE8FHSu1im3qJTIeuwqI5JN5SPVsiX7L9nWXgWLRUf6sDhGV0aDKQ7ijXswAAAHJGBQAAAAAAAIJpZIJ2NIJpcIShI5NiiXNlY3AyNTZrMaECpA_KefrVAueFWiLLDZKQPPVOxMuxGogPrI474FaS-x2DdGNwgiMog3VkcIIjKA\r\n```\r\n\r\nWorks\r\n```\r\n$ curl http://localhost:5052/eth/v2/beacon/blocks/43361 -s | jq | head\r\n{\r\n  \"version\": \"capella\",\r\n  \"execution_optimistic\": false,\r\n  \"data\": {\r\n    \"message\": {\r\n      \"slot\": \"43361\",\r\n```\r\n\r\nDoesn't work\r\n```\r\n$ curl http://localhost:5052/eth/v2/beacon/blocks/43360 -s | jq | head\r\n{\r\n  \"code\": 500,\r\n  \"message\": \"UNHANDLED_ERROR: ExecutionLayerErrorPayloadReconstruction(0xc3d5a8bd379f36c54e6ed0961258fc691726f4dd09cdb34839ff2b250ee1e95c, EngineError(Api { error: Json(Error(\\\"missing field `withdrawals`\\\", line: 0, column: 0)) }))\",\r\n  \"stacktraces\": []\r\n}\r\n```\r\n\r\nOther slots that don't work: 43202, 43217, 43231",
  "closed_by": {
    "login": "peteriscan",
    "id": 104527020,
    "node_id": "U_kgDOBjr0rA",
    "avatar_url": "https://avatars.githubusercontent.com/u/104527020?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/peteriscan",
    "html_url": "https://github.com/peteriscan",
    "followers_url": "https://api.github.com/users/peteriscan/followers",
    "following_url": "https://api.github.com/users/peteriscan/following{/other_user}",
    "gists_url": "https://api.github.com/users/peteriscan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/peteriscan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/peteriscan/subscriptions",
    "organizations_url": "https://api.github.com/users/peteriscan/orgs",
    "repos_url": "https://api.github.com/users/peteriscan/repos",
    "events_url": "https://api.github.com/users/peteriscan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/peteriscan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1430332188",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6817#issuecomment-1430332188",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817",
    "id": 1430332188,
    "node_id": "IC_kwDOC0FsAM5VQSMc",
    "user": {
      "login": "fafrd",
      "id": 5905628,
      "node_id": "MDQ6VXNlcjU5MDU2Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5905628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fafrd",
      "html_url": "https://github.com/fafrd",
      "followers_url": "https://api.github.com/users/fafrd/followers",
      "following_url": "https://api.github.com/users/fafrd/following{/other_user}",
      "gists_url": "https://api.github.com/users/fafrd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fafrd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fafrd/subscriptions",
      "organizations_url": "https://api.github.com/users/fafrd/orgs",
      "repos_url": "https://api.github.com/users/fafrd/repos",
      "events_url": "https://api.github.com/users/fafrd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fafrd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T20:27:04Z",
    "updated_at": "2023-02-14T20:27:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm syncing up a node for zhejiang and then i'll take a look at this.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1430332188/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1435057952",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6817#issuecomment-1435057952",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817",
    "id": 1435057952,
    "node_id": "IC_kwDOC0FsAM5ViT8g",
    "user": {
      "login": "fafrd",
      "id": 5905628,
      "node_id": "MDQ6VXNlcjU5MDU2Mjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5905628?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fafrd",
      "html_url": "https://github.com/fafrd",
      "followers_url": "https://api.github.com/users/fafrd/followers",
      "following_url": "https://api.github.com/users/fafrd/following{/other_user}",
      "gists_url": "https://api.github.com/users/fafrd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fafrd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fafrd/subscriptions",
      "organizations_url": "https://api.github.com/users/fafrd/orgs",
      "repos_url": "https://api.github.com/users/fafrd/repos",
      "events_url": "https://api.github.com/users/fafrd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fafrd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-17T18:13:33Z",
    "updated_at": "2023-03-02T13:31:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Fixed by #6893. Requires a full resync",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1435057952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1435364344",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6817#issuecomment-1435364344",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6817",
    "id": 1435364344,
    "node_id": "IC_kwDOC0FsAM5Vjev4",
    "user": {
      "login": "peteriscan",
      "id": 104527020,
      "node_id": "U_kgDOBjr0rA",
      "avatar_url": "https://avatars.githubusercontent.com/u/104527020?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/peteriscan",
      "html_url": "https://github.com/peteriscan",
      "followers_url": "https://api.github.com/users/peteriscan/followers",
      "following_url": "https://api.github.com/users/peteriscan/following{/other_user}",
      "gists_url": "https://api.github.com/users/peteriscan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/peteriscan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/peteriscan/subscriptions",
      "organizations_url": "https://api.github.com/users/peteriscan/orgs",
      "repos_url": "https://api.github.com/users/peteriscan/repos",
      "events_url": "https://api.github.com/users/peteriscan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/peteriscan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-17T22:45:57Z",
    "updated_at": "2023-02-17T22:45:57Z",
    "author_association": "NONE",
    "body": "After resyncing with e31678f3557e8d035c1e4a8209e08e025f08ab8c Lighthouse no longer returns an error:\r\n\r\n```\r\n$ curl http://localhost:5052/eth/v2/beacon/blocks/43360 -s | jq | head                                                                                        \r\n{\r\n  \"version\": \"capella\",\r\n  \"execution_optimistic\": false,\r\n  \"data\": {\r\n    \"message\": {\r\n      \"slot\": \"43360\",\r\n```\r\n\r\nThanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1435364344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
