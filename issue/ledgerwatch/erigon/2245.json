{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2245",
  "id": 931011630,
  "node_id": "MDU6SXNzdWU5MzEwMTE2MzA=",
  "number": 2245,
  "title": "`rpcdaemon` cannot utilize all CPU cores (I/O is not the bottleneck)",
  "user": {
    "login": "zzh1996",
    "id": 10773481,
    "node_id": "MDQ6VXNlcjEwNzczNDgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zzh1996",
    "html_url": "https://github.com/zzh1996",
    "followers_url": "https://api.github.com/users/zzh1996/followers",
    "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
    "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
    "organizations_url": "https://api.github.com/users/zzh1996/orgs",
    "repos_url": "https://api.github.com/users/zzh1996/repos",
    "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zzh1996/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 20,
  "created_at": "2021-06-27T20:27:00Z",
  "updated_at": "2022-07-07T09:48:43Z",
  "closed_at": "2022-07-07T09:48:42Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2021.06.5-alpha\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: cc360ec65\r\n\r\n#### Expected behaviour\r\n\r\n`rpcdaemon` should utilize all CPU cores (if I/O is not the bottleneck) when there are enough incoming RPC calls.\r\n\r\nI have tested Go-Ethereum (geth) and it worked as expected.\r\n\r\n#### Actual behaviour\r\n\r\n`rpcdaemon` utilizes at most 800% ~ 900% of CPU on a 16C/32T Linux machine.\r\n\r\nI/O percentage is less than 1% (as shown in `iotop`).\r\n\r\nRunning more RPC clients (Python scripts in my case) won't help. Each RPC call becomes slower, while `rpcdaemon` refuses to use more CPU.\r\n\r\nRunning more `rpcdaemon` instances won't help. If I run 4 instances, each of them use 200% ~ 300% CPU.\r\n\r\nRunning `rpcdaemon` without `--private.api.addr` won't help. Performance is not limited by Erigon private API.\r\n\r\nThe state of the `rpcdaemon` process is `S` in `htop` most of the time.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. Run `rpcdaemon`.\r\n2. Make as many RPC calls as you can. You can do this by running multiple instances of the following Python script.\r\n3. Watch your CPU usage in `htop` and find that CPUs are not fully utilized.\r\n4. Run multiple instances of the following script against Go-Ethereum (geth) and find that all CPUs can be utilized.\r\n\r\n```python\r\nimport requests\r\n\r\nif __name__ == '__main__':\r\n    sess = requests.session()\r\n    while True:\r\n        sess.post('http://127.0.0.1:8545', json=[{\r\n            'method': 'eth_call',\r\n            'params': [\r\n                {\r\n                    'from': '0xbe0eb53f46cd790cd13851d5eff43d12404d33e8',\r\n                    'to': '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2',\r\n                    'gas': hex(1000000),\r\n                    'value': hex(10 ** 18),\r\n                    'data': '0xd0e30db0',\r\n                },\r\n                'latest',\r\n            ],\r\n            'id': i,\r\n            'jsonrpc': '2.0',\r\n        } for i in range(10000)])\r\n```\r\n",
  "closed_by": {
    "login": "mandrigin",
    "id": 466427,
    "node_id": "MDQ6VXNlcjQ2NjQyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mandrigin",
    "html_url": "https://github.com/mandrigin",
    "followers_url": "https://api.github.com/users/mandrigin/followers",
    "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
    "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
    "organizations_url": "https://api.github.com/users/mandrigin/orgs",
    "repos_url": "https://api.github.com/users/mandrigin/repos",
    "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mandrigin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869411795",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-869411795",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 869411795,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTQxMTc5NQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T06:57:17Z",
    "updated_at": "2021-06-28T06:57:17Z",
    "author_association": "COLLABORATOR",
    "body": "@zzh1996 , hi. Thank you for testing it. \r\nCan you please compare throughput or latency of RpcDaemon vs Geth? \r\n\r\nYou are bottlenecked by max amount of read transactions:\r\n`const ReadersLimit = 2000 // MDBX_READERS_LIMIT on 64bit system`\r\n\r\nAnother know hardcoded limiter is for batch requests: \r\n`const MaxGoroutinesPerBatchRequest = 50`\r\n\r\nYou see 1% IO because Erigon's db doesn't touch Disk if your Hot dataset fit in RAM (OS does manage eviction of cold parts of db from from it's PageCache). It means if you will call for many historical blocks - you will see more IO because all blocks do not fit in RAM (doesn't matter what data is it and how old is it - only important how Big it's Hot part).\r\n\r\nBut i wonder if in reality (under real users traffic): \r\n- executing more than 2000 parallel RPC requests (in same time) will only reduce overall throughput and latency? (because you will spend more time for context switching between goroutines). \r\n- Of course if RPC daemon run on another machine - network IO will take it's place and it make more sense to process more parallel requests in same time(because goroutines will more wait on IO). \r\n\r\nMy opinion: having system without any boundaries is bad idea (because then 100% of clients will suffer when node overload) - but if here we can increase throughput or any other useful metric (not just make CPU busy) by increasing limits we must do it. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869411795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869474143",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-869474143",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 869474143,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTQ3NDE0Mw==",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T08:15:35Z",
    "updated_at": "2021-06-28T08:20:36Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov\r\n> Can you please compare throughput or latency of RpcDaemon vs Geth?\r\n\r\nI cannot compare them fairly at this moment (but can do this later), because my Erigon and Geth node are running on seperate machines with different configuration.\r\n\r\n> * executing more than 2000 parallel RPC requests (in same time) will only reduce overall throughput and latency? (because you will spend more time for context switching between goroutines).\r\n\r\nI did not experiment with different settings. As I can see, if there are 32 clients sending batched requests simultaneously, there will be more than 1500 `rpcdaemon` Linux threads running, which I think is a bad idea anyway.\r\n\r\n> My opinion: having system without any boundaries is bad idea (because then 100% of clients will suffer when node overload) - but if here we can increase throughput or any other useful metric (not just make CPU busy) by increasing limits we must do it.\r\n\r\nThere are two kinds of scenarios where we need Ethereum RPC:\r\n\r\n1. For DApps and wallets, just like Infura, serving unspecified people.\r\n2. For programs such as Ethereum analyzing tools and arbitrage bots, all RPC requests are under our control.\r\n\r\nFor the first scenario, I think you are right. We care much about user experience and we need boundaries to make node not overloaded. (But we can still increase throughput by making CPU busy.)\r\n\r\nHowever, for the second scenario, there is no reason to limit the performance. Requests are coming in batches and are synchronous. No clients (real users) will suffer from node overload. We just want all the requests to be processed as soon as possible. I think at least we should have some options to enable this scenario.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869474143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869591710",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-869591710",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 869591710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTU5MTcxMA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T11:06:30Z",
    "updated_at": "2021-06-28T11:06:30Z",
    "author_association": "COLLABORATOR",
    "body": "Thanks for info. \r\n\r\nThreads - in Golang we have goroutines which are 100x cheaper then threads. Here we are fine. \r\n\r\nWe for sure can make limit of “threads per batch”  configurable. \r\n\r\nBut I need few days to check if we can increase limit of read transactions. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869591710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869629638",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-869629638",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 869629638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTYyOTYzOA==",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T12:09:14Z",
    "updated_at": "2021-06-28T12:09:14Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov\r\n\r\nI know that goroutines are cheaper than threads.\r\n\r\nHowever, there's something buggy or at least not working as expected in Erigon. When there are 32 clients sending batched requests simultaneously, there are more than 1500 `rpcdaemon` Linux threads running. Yes, it's OS threads.\r\n\r\n```\r\n$ ps auxH | grep rpcdaemon | wc -l\r\n1517\r\n```\r\n\r\nMaybe they are waiting for syscall or something else. I'm not an expert in Golang, but I don't think there should be so many OS threads even if there are more goroutines.\r\n\r\nThe same 32 clients against Geth:\r\n\r\n```\r\n$ ps auxH | grep geth | wc -l\r\n37\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869629638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869655560",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-869655560",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 869655560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTY1NTU2MA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T12:48:52Z",
    "updated_at": "2021-06-28T12:48:52Z",
    "author_association": "COLLABORATOR",
    "body": "Yes, i think this what happen when run rpcdaemon remote: go limit amount of working threads to CPU number and can spawn unlimited amount of threads for Network IO.  ( we have option to use limited amount of network IO threads, but i found that without limit it works better ). \r\n\r\nDo you plan run rpcdaemon on another machine from Erigon?\r\nIf no, pass —datadir option to rpcdaemon (same as of erigon). \r\n\r\nI will stress-test tomorrow. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869655560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869658679",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-869658679",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 869658679,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTY1ODY3OQ==",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T12:53:57Z",
    "updated_at": "2021-06-28T12:53:57Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov \r\n\r\nI have never run rpcdaemon remotely. Erigon, rpcdaemon and clients are always on the same machine (run directly, no Docker) and I was running rpcdaemon with `--datadir` for all the results above.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/869658679/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871229654",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-871229654",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 871229654,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTIyOTY1NA==",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-30T09:09:27Z",
    "updated_at": "2021-06-30T09:09:27Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov \r\nAre there any workarounds for now? I tried to increase `ReadersLimit` and some errors appeared. It seems that this limit is caused by some page size limit. I also tried to increase/decrease `MaxGoroutinesPerBatchRequest` but nothing changes.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871229654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871233246",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-871233246",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 871233246,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTIzMzI0Ng==",
    "user": {
      "login": "AndreaLanfranchi",
      "id": 15280851,
      "node_id": "MDQ6VXNlcjE1MjgwODUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/15280851?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AndreaLanfranchi",
      "html_url": "https://github.com/AndreaLanfranchi",
      "followers_url": "https://api.github.com/users/AndreaLanfranchi/followers",
      "following_url": "https://api.github.com/users/AndreaLanfranchi/following{/other_user}",
      "gists_url": "https://api.github.com/users/AndreaLanfranchi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AndreaLanfranchi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AndreaLanfranchi/subscriptions",
      "organizations_url": "https://api.github.com/users/AndreaLanfranchi/orgs",
      "repos_url": "https://api.github.com/users/AndreaLanfranchi/repos",
      "events_url": "https://api.github.com/users/AndreaLanfranchi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AndreaLanfranchi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-30T09:14:33Z",
    "updated_at": "2021-06-30T09:14:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @AskAlexSharov\r\n> \r\n> I have never run rpcdaemon remotely. Erigon, rpcdaemon and clients are always on the same machine (run directly, no Docker) and I was running rpcdaemon with `--datadir` for all the results above.\r\n\r\n\"Remote\" is actually a misnomer we'll try to amend.\r\nBy Remote we don't mean different processes are hosted on different machines rather the comunication amongst core and rpcdaemon are carried out exclusively by TCP sockets. The other mode is \"shared\" where rpcdaemon literally shares the access to the local db. In this latter mode unfortunately not all rpc requests can be satisfied (some info are not persisted into db eg. tx pool) hence the \"remote\" mode (or eventually the mixed one) is actually the only way to have rpcdaemon respond to all requests.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871233246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/878018234",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-878018234",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 878018234,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODAxODIzNA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-12T06:49:53Z",
    "updated_at": "2021-07-12T06:49:53Z",
    "author_association": "COLLABORATOR",
    "body": "We will increase max read transactions limit - in near future. waiting to support from DB side. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/878018234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/879844280",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-879844280",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 879844280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTg0NDI4MA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-14T12:21:09Z",
    "updated_at": "2021-07-14T12:21:09Z",
    "author_association": "COLLABORATOR",
    "body": "@zzh1996 , hi. Can you try https://github.com/ledgerwatch/erigon/pull/2366\r\n?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/879844280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/880189332",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-880189332",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 880189332,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDE4OTMzMg==",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-14T20:32:16Z",
    "updated_at": "2021-07-14T20:32:16Z",
    "author_association": "NONE",
    "body": "> @zzh1996 , hi. Can you try #2366\r\n> ?\r\n\r\n@AskAlexSharov I tried 04465e0, but there isn't any noticeable difference. CPU utilization, RPC throughput, number of OS threads are all the same as above.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/880189332/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/880383810",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-880383810",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 880383810,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg4MDM4MzgxMA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-15T04:33:56Z",
    "updated_at": "2021-07-15T04:33:56Z",
    "author_association": "COLLABORATOR",
    "body": "@zzh1996 , are you sure you re-build rpcdaemon and erigon? and restarted. \r\nI see 600% CPU utilization by your python script (on 8 core server)\r\nAnd your script became bottleneck - when I added one more python script in parallel - I see 800% ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/880383810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/881237802",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-881237802",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 881237802,
    "node_id": "IC_kwDOC0FsAM40hp8q",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-16T07:27:56Z",
    "updated_at": "2021-07-16T07:27:56Z",
    "author_association": "NONE",
    "body": "> @zzh1996 , are you sure you re-build rpcdaemon and erigon? and restarted.\r\n> I see 600% CPU utilization by your python script (on 8 core server)\r\n> And your script became bottleneck - when I added one more python script in parallel - I see 800%\r\n\r\n@AskAlexSharov I'm sure. I stopped and deleted everything, then run git clone and build.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/881237802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/881325974",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-881325974",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 881325974,
    "node_id": "IC_kwDOC0FsAM40h_eW",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-16T09:55:13Z",
    "updated_at": "2021-07-16T09:55:13Z",
    "author_association": "COLLABORATOR",
    "body": "with `--datadir` option? \r\n\r\nthen gimme some logs\r\nor results of adding --pprof (and then run `go tool pprof -http=: http://localhost:6060/debug/pprof/profile\\?seconds\\=20`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/881325974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/889972696",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-889972696",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 889972696,
    "node_id": "IC_kwDOC0FsAM41C-fY",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-30T15:33:32Z",
    "updated_at": "2021-07-30T15:33:32Z",
    "author_association": "COLLABORATOR",
    "body": "Closing, because can’t reproduce anymore. Feel free to re-open.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/889972696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/892944592",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-892944592",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 892944592,
    "node_id": "IC_kwDOC0FsAM41OUDQ",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-04T20:16:12Z",
    "updated_at": "2021-08-04T20:16:12Z",
    "author_association": "NONE",
    "body": "> with `--datadir` option?\r\n> \r\n> then gimme some logs\r\n> or results of adding --pprof (and then run `go tool pprof -http=: http://localhost:6060/debug/pprof/profile\\?seconds\\=20`\r\n\r\n[pprof.rpcdaemon.samples.cpu.001.pb.gz](https://github.com/ledgerwatch/erigon/files/6934110/pprof.rpcdaemon.samples.cpu.001.pb.gz)\r\n\r\nVersion: v2021.07.05\r\n16 Python scripts running. Each CPU% < 3%.\r\n`rpcdaemon` CPU% at ~600% on the 16C/32T Linux machine.\r\nIO% < 1%\r\n\r\nlogs\r\n```\r\n$ ./rpcdaemon --datadir /mnt/ssd/blockchain/erigon/ --http.port 8546 --private.api.addr=localhost:9090 --http.api eth,erigon,trace,debug,web3,net --pprof\r\nINFO [08-05|03:54:55.389] Starting pprof server                    cpu=\"go tool pprof -lines -http=: http://127.0.0.1:6060/debug/pprof/profile?seconds=20\" heap=\"go tool pprof -lines -http=: http://127.0.0.1:6060/debug/pprof/heap\"\r\nINFO [08-05|03:54:55.392] DB schemas compatible                    reader=3.0.0 database=3.0.0\r\nINFO [08-05|03:54:55.392] rpc filters: subscribing to Erigon events\r\nINFO [08-05|03:54:55.393] HTTP endpoint opened                     url=localhost:8546 ws=false ws.compression=false\r\nINFO [08-05|03:54:55.396] interfaces compatible                    remote_db=localhost:9090 client=3.0.0 server=3.0.0\r\nINFO [08-05|03:54:55.396] interfaces compatible                    remote_service=eth_backend client=2.1.0 server=2.1.0\r\nINFO [08-05|03:54:55.396] interfaces compatible                    remote_service=mining      client=1.0.0 server=1.0.0\r\nINFO [08-05|03:54:55.397] interfaces compatible                    remote_service=tx_pool     client=1.0.0 server=1.0.0\r\n```\r\n\r\n@AskAlexSharov \r\nPlease re-open this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/892944592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139280039",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-1139280039",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 1139280039,
    "node_id": "IC_kwDOC0FsAM5D6Ain",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T05:06:11Z",
    "updated_at": "2022-05-27T05:06:11Z",
    "author_association": "COLLABORATOR",
    "body": "Hi. We fixed it in Alpha releases. I found why RPCDaemon did create much threads. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139280039/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139284632",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-1139284632",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 1139284632,
    "node_id": "IC_kwDOC0FsAM5D6BqY",
    "user": {
      "login": "zzh1996",
      "id": 10773481,
      "node_id": "MDQ6VXNlcjEwNzczNDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10773481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zzh1996",
      "html_url": "https://github.com/zzh1996",
      "followers_url": "https://api.github.com/users/zzh1996/followers",
      "following_url": "https://api.github.com/users/zzh1996/following{/other_user}",
      "gists_url": "https://api.github.com/users/zzh1996/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zzh1996/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zzh1996/subscriptions",
      "organizations_url": "https://api.github.com/users/zzh1996/orgs",
      "repos_url": "https://api.github.com/users/zzh1996/repos",
      "events_url": "https://api.github.com/users/zzh1996/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zzh1996/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T05:17:21Z",
    "updated_at": "2022-05-27T05:17:21Z",
    "author_association": "NONE",
    "body": "> Hi. We fixed it in Alpha releases. I found why RPCDaemon did create much threads.\r\n\r\nSounds great. So what's the reason and could you please point out the commit which fixes it?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139284632/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139301541",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-1139301541",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 1139301541,
    "node_id": "IC_kwDOC0FsAM5D6Fyl",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T05:45:41Z",
    "updated_at": "2022-05-27T05:45:41Z",
    "author_association": "COLLABORATOR",
    "body": "mdbx allow open db from multiple processes. \r\nto coordinate processes used mdbx.lock file\r\nwhen you start new read transaction it does register it's ID in mdbx.lock\r\nit happening inside C code\r\nwhen inside C code happening IO/fsync, goland goes move current thread out out main thread-pool (where it running all goroutines) and creating new thread for thread-pool.\r\nif try to open too much new read transactions in same time it will cause threads amount spike\r\nI did limit amount of parallel read transactions to number of cpu's \r\nit increase throughput of rpcdaemon and amount of threads\r\nby: https://github.com/ledgerwatch/erigon-lib/pull/352\r\n\r\nif you will find new corner cases, feel free to report",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139301541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1177330129",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2245#issuecomment-1177330129",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2245",
    "id": 1177330129,
    "node_id": "IC_kwDOC0FsAM5GLKHR",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-07T09:48:42Z",
    "updated_at": "2022-07-07T09:48:42Z",
    "author_association": "COLLABORATOR",
    "body": "I assume that is fixed, especially with 2022.07.02, feel free to reopen if there are issues",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1177330129/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
