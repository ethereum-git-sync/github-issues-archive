{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/263",
  "id": 537231188,
  "node_id": "MDU6SXNzdWU1MzcyMzExODg=",
  "number": 263,
  "title": "Generate data for estimation of the complexity of STARK proofs for witnesses",
  "user": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1688665690,
      "node_id": "MDU6TGFiZWwxNjg4NjY1Njkw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/stateless",
      "name": "stateless",
      "color": "98ff70",
      "default": false,
      "description": "Related to Stateless Ethereum research"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-12-12T21:47:11Z",
  "updated_at": "2020-01-16T12:36:21Z",
  "closed_at": "2020-01-16T12:36:21Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Similar to how we collect data about the sizes of the block witnesses for each block, we need to collect metrics that will be important for estimating the viability of using STARK proofs for compressing the block witnesses.\r\nTo produce such data, block witness needs to be processed in the following way:\r\n1. Replace all `LEAF` (`LEAFHASH`) and `ACCOUNTLEAF` (`ACCOUNTLEAFHASH`) instructions with a corresponding `HASH` instruction, with the operand equal to the hash of the leaf node.\r\n\r\nAfter this step 1, all applications of `Keccak256` hash functions will be in the `EXTENSION` (`EXTENSIONHASH`) instructions (input is the RLP encoding of 2-item sequence `key`, `hash`), and in `BRANCH` (`BRANCHHASH`) instructions (input is the RLP encoding of 17-item sequence containing child hashes in corresponding places).\r\n\r\n2. For each `EXTENSION` (`EXTENSIONHASH`) instruction, record the length of the input to the `Keccak256`.\r\n3. For each `BRANCH` (`BRANCHHASH`) instruction, record the length of the input to the `Keccak256`\r\n\r\nTo start with, select a few blocks with particularly large witnesses, and compute for them:\r\n1. Number of `Keccak256` invocations required to calculate the state root\r\n2. Distribution of lengths of Keccak inputs, i.e. how many inputs of the size 10 bytes, how many inputs of the size 20 bytes.\r\n\r\n",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 1,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/572973400",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/263#issuecomment-572973400",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/263",
    "id": 572973400,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3Mjk3MzQwMA==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-10T10:13:05Z",
    "updated_at": "2020-01-10T10:13:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "I took 4 block witnesses from mainnet block for 4 different \"characteristic\" cases.\r\n\r\nThere are 4 files in the attachment, one for each case. In each file, the first line is the total number of Keccak256 invocation required to verify the witness. Following are the lines of format:\r\n\r\n<input size in bytes> <number of Keccak256 invocations with this input size>\r\n\r\nThese lines give information about the input sizes for all the Keccak256 invocations. For example, it lets you see that the maximal input size ever is 532 bytes, which corresponds to the branch node with 16 hashes in it (512 bytes) + 20 bytes of RLP structure prefixes. Even though there might be large byte codes in the witness, their hashing does not need to be proven by the STARK proof, because they are always present in the witness, and we can simply pre-process them before running the verification. The same goes for all the leaf nodes, they are all pre-processed.\r\n\r\n\r\nBlock 5790669 - small witness (3445 bytes), no bytecode (0 bytes), hashes being removed by the STARK proof - 2890 bytes\r\n\r\nBlockNumber,BlockWitnessSize,CodesSize,LeafKeysSize,LeafValuesSize,MasksSize,HashesSize\r\n\r\n5790669,3445,0,241,0,214,2890\r\n\r\n\r\nBlock 5790928 - small witness (18675 bytes), with some bytecode (1757 bytes), hashes being removed by the STARK proof - 13158 bytes\r\n\r\nBlockNumber,BlockWitnessSize,CodesSize,LeafKeysSize,LeafValuesSize,MasksSize,HashesSize\r\n\r\n5790928,18675,1757,2391,44,1058,13158\r\n\r\n\r\nBlock 5790858 - large witness (2,3 Mb) with lots of byte code (652 Kb), hashes being remove by the STARK proof - 1.12 Mb\r\n\r\nBlockNumber,BlockWitnessSize,CodesSize,LeafKeysSize,LeafValuesSize,MasksSize,HashesSize\r\n\r\n5790858,2327142,652381,378700,57507,101191,1125060\r\n\r\n\r\nBlock 5790931 - large witness (1,22 Mb) with less byte code (181 Kb), hashes being remove by the STARK proof - 753 Kb\r\n\r\nBlockNumber,BlockWitnessSize,CodesSize,LeafKeysSize,LeafValuesSize,MasksSize,HashesSize\r\n\r\n5790931,1224780,181118,196599,23067,64203,753236\r\n\r\n**stark_stats_5790669.txt**\r\n````\r\n11\r\n104 1\r\n110 1\r\n113 1\r\n115 1\r\n117 1\r\n404 1\r\n532 5\r\n````\r\n\r\n**stark_stats_5790858.txt**\r\n````\r\n5889\r\n35 161\r\n37 13\r\n38 2\r\n39 2\r\n83 376\r\n101 2\r\n102 2\r\n103 4\r\n104 470\r\n105 680\r\n106 9\r\n107 17\r\n109 7\r\n110 73\r\n111 351\r\n112 394\r\n113 131\r\n114 45\r\n115 254\r\n116 6\r\n117 5\r\n118 1\r\n147 145\r\n179 90\r\n211 55\r\n243 42\r\n276 33\r\n308 25\r\n340 32\r\n372 51\r\n404 64\r\n436 93\r\n468 161\r\n500 206\r\n532 1887\r\n````\r\n**stark_stats_5790928.txt**\r\n````\r\n64\r\n83 1\r\n104 5\r\n105 8\r\n110 1\r\n111 5\r\n112 5\r\n113 3\r\n114 1\r\n115 3\r\n116 1\r\n117 1\r\n147 2\r\n211 1\r\n404 1\r\n468 1\r\n500 3\r\n532 22\r\n````\r\n\r\n**stark_stats_5790931.txt**\r\n````\r\n3475\r\n35 147\r\n37 13\r\n38 2\r\n83 196\r\n103 1\r\n104 235\r\n105 362\r\n106 8\r\n107 7\r\n109 2\r\n110 40\r\n111 158\r\n112 225\r\n113 71\r\n114 19\r\n115 125\r\n116 11\r\n117 6\r\n118 2\r\n147 97\r\n179 57\r\n211 28\r\n243 12\r\n276 14\r\n308 6\r\n340 17\r\n372 15\r\n404 26\r\n436 50\r\n468 89\r\n500 131\r\n532 1303\r\n````",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/572973400/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
