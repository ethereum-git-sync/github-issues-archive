{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5642",
  "id": 1399300866,
  "node_id": "I_kwDOC0FsAM5TZ6MC",
  "number": 5642,
  "title": "Erigon service behind 1hour and 20 minutes + on average ",
  "user": {
    "login": "marbew",
    "id": 10949785,
    "node_id": "MDQ6VXNlcjEwOTQ5Nzg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10949785?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marbew",
    "html_url": "https://github.com/marbew",
    "followers_url": "https://api.github.com/users/marbew/followers",
    "following_url": "https://api.github.com/users/marbew/following{/other_user}",
    "gists_url": "https://api.github.com/users/marbew/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marbew/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marbew/subscriptions",
    "organizations_url": "https://api.github.com/users/marbew/orgs",
    "repos_url": "https://api.github.com/users/marbew/repos",
    "events_url": "https://api.github.com/users/marbew/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marbew/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-10-06T10:24:05Z",
  "updated_at": "2022-10-30T22:25:13Z",
  "closed_at": "2022-10-30T22:23:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "[Current options passed to Erigon binary as service + prysm on the same vm]\r\n\r\n**System information**\r\nerigon version 2022.10.1-dev-3777b613\r\n\r\n**OS & Version**\r\nUbuntu 20.04.1 LTS\r\n\r\nExecStart=/home/ubuntu/.local/bin/erigon\r\n--db.pagesize=\"64kb\" \r\n--chain=\"mainnet\" \r\n--datadir=\"/home/ubuntu/.eth-mainnet-erigon/datadir/\" \r\n--ethash.dagdir=\"/home/ubuntu/.erigon-eth-mainnet/ethash/\" \r\n--http --http.addr=\"0.0.0.0\"  \r\n--port=\"30303\" \r\n--http.port=\"8546\" \r\n--http.compression \r\n--torrent.port=\"42069\" \r\n--private.api.addr=\"0.0.0.0:9091\" \r\n--http.vhosts=\"*\" \r\n--http.corsdomain=\"*\" \r\n--http.api=\"eth,debug,net,txpool,trace,web3,erigon\" \r\n--ws \r\n--ws.compression \r\n--snapshots=\"true\" \r\n--torrent.download.rate=20mb \r\n--metrics \r\n--metrics.addr=\"0.0.0.0\" \r\n--metrics.port=6065 \r\n--authrpc.jwtsecret=/home/ubuntu/key-hex/jwt.hex\r\n\r\nHey there beautiful people. Do you spot anything that should NOT be there as flag or a missing one in this service? \r\nWhat specific part of the log should revel important behaviour related to delays? There are no Warn or Error so far.\r\nI can see constantly the Commit cycle with \"Timings (slower than 50ms)\"\r\n[erigon.log.tar.gz](https://github.com/ledgerwatch/erigon/files/9723878/erigon.log.tar.gz)\r\n\r\nThe instance has: 4vCPU 30GB of RAM Storage on Raid 0 on gp3 EBS with 4000 IOPS each disk \r\n\r\n#### Actual behaviour\r\nThe delay was already there before the latest binary 2022.10.1, but after the merge. Before this release we experienced OOM.\r\nNo errors on logs attached apparently at the moment.\r\n\r\n```\r\n0101001@ethsync:~$ free -mh\r\n               total        used        free      shared  buff/cache   available\r\nMem:            30Gi        26Gi       231Mi       1.0Mi       4.1Gi       3.9Gi\r\nSwap:             0B          0B          0B\r\n```\r\n\r\n",
  "closed_by": {
    "login": "marbew",
    "id": 10949785,
    "node_id": "MDQ6VXNlcjEwOTQ5Nzg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10949785?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marbew",
    "html_url": "https://github.com/marbew",
    "followers_url": "https://api.github.com/users/marbew/followers",
    "following_url": "https://api.github.com/users/marbew/following{/other_user}",
    "gists_url": "https://api.github.com/users/marbew/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marbew/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marbew/subscriptions",
    "organizations_url": "https://api.github.com/users/marbew/orgs",
    "repos_url": "https://api.github.com/users/marbew/repos",
    "events_url": "https://api.github.com/users/marbew/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marbew/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1271628744",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5642#issuecomment-1271628744",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642",
    "id": 1271628744,
    "node_id": "IC_kwDOC0FsAM5Ly4PI",
    "user": {
      "login": "marbew",
      "id": 10949785,
      "node_id": "MDQ6VXNlcjEwOTQ5Nzg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10949785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marbew",
      "html_url": "https://github.com/marbew",
      "followers_url": "https://api.github.com/users/marbew/followers",
      "following_url": "https://api.github.com/users/marbew/following{/other_user}",
      "gists_url": "https://api.github.com/users/marbew/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marbew/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marbew/subscriptions",
      "organizations_url": "https://api.github.com/users/marbew/orgs",
      "repos_url": "https://api.github.com/users/marbew/repos",
      "events_url": "https://api.github.com/users/marbew/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marbew/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-07T13:55:04Z",
    "updated_at": "2022-10-07T13:55:04Z",
    "author_association": "NONE",
    "body": "We updated our config to:\r\n[Current options passed to Erigon binary as service + prysm on the same vm]\r\n\r\nSystem information\r\nerigon version 2.27.0\r\n\r\nOS & Version\r\nUbuntu 20.04.1 LTS\r\n\r\nExecStart=/home/ubuntu/.local/bin/erigon\r\n\r\n--chain=\"mainnet\"\r\n--datadir=\"/home/ubuntu/.eth-mainnet-erigon/datadir/\"\r\n\r\n--http --http.addr=\"0.0.0.0\"\r\n--port=\"30303\"\r\n--http.port=\"8546\"\r\n--http.compression\r\n--torrent.port=\"42069\"\r\n--private.api.addr=\"0.0.0.0:9091\"\r\n--http.vhosts=\"\"\r\n--http.corsdomain=\"\"\r\n--http.api=\"eth,debug,net,txpool,trace,web3,erigon\"\r\n--ws\r\n--ws.compression\r\n--snapshots=\"true\"\r\n\r\n--metrics\r\n--metrics.addr=\"0.0.0.0\"\r\n--metrics.port=6065\r\n--authrpc.jwtsecret=/home/ubuntu/key-hex/jwt.hex\r\n\r\nand re-sync is happening.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1271628744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1296364609",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5642#issuecomment-1296364609",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5642",
    "id": 1296364609,
    "node_id": "IC_kwDOC0FsAM5NRPRB",
    "user": {
      "login": "marbew",
      "id": 10949785,
      "node_id": "MDQ6VXNlcjEwOTQ5Nzg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10949785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marbew",
      "html_url": "https://github.com/marbew",
      "followers_url": "https://api.github.com/users/marbew/followers",
      "following_url": "https://api.github.com/users/marbew/following{/other_user}",
      "gists_url": "https://api.github.com/users/marbew/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marbew/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marbew/subscriptions",
      "organizations_url": "https://api.github.com/users/marbew/orgs",
      "repos_url": "https://api.github.com/users/marbew/repos",
      "events_url": "https://api.github.com/users/marbew/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marbew/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-30T22:23:31Z",
    "updated_at": "2022-10-30T22:25:12Z",
    "author_association": "NONE",
    "body": "This has been solved by updating to erigon 2.28.1 and prysm 3.1.2 on aws vm with 20000 IOPS on 4 EBS volumes in RAID0.\r\nWe are now at the tip of chain constantly with about 10/12 seconds delay.\r\nThanks so much to people on Erigon discord server for the help in clarify my issues.\r\n\r\n`[Service]\r\n  Restart=on-failure\r\n  RestartSec=5s\r\n  ExecStart=/home/ubuntu/.local/bin/prysm/prysm.sh beacon-chain --execution-endpoint=http://localhost:8551 --jwt-secret=/home/ubuntu/key-hex/jwt.hex --monitoring-host=0.0.0.0 --datadir=/home/ubuntu/.prysm/ --slots-per-archive-point=64  \r\n  Environment= USE_PRYSM_VERSION=v3.1.2\r\n  Type=simple\r\n  User=ubuntu`\r\n\r\n`[Service]\r\n  Restart=on-failure\r\n  RestartSec=5s\r\n  ExecStart=/home/ubuntu/.local/bin/erigon --chain=\"mainnet\" --datadir=\"/home/ubuntu/.eth-mainnet-erigon/datadir/\" --http --http.addr=\"0.0.0.0\"  --port=\"30303\" --http.port=\"8546\" --http.compression --torrent.port=\"42069\" --private.api.addr=\"0.0.0.0:9091\" --http.vhosts=\"*\" --http.corsdomain=\"*\" --http.api=\"eth,debug,net,txpool,trace,web3,erigon\" --ws --ws.compression --snapshots=\"true\" --metrics --metrics.addr=\"0.0.0.0\" --metrics.port=6065 --authrpc.jwtsecret=/home/ubuntu/key-hex/jwt.hex --batchSize 128m --downloader.verify=false\r\n`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1296364609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
