{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/3247",
  "id": 1100622367,
  "node_id": "I_kwDOC0FsAM5Bmiof",
  "number": 3247,
  "title": "RPC Daemon Shuts Down and Closes Endpoint URL (localhost:8545) Immediately after Startup",
  "user": {
    "login": "codesport",
    "id": 5884033,
    "node_id": "MDQ6VXNlcjU4ODQwMzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5884033?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/codesport",
    "html_url": "https://github.com/codesport",
    "followers_url": "https://api.github.com/users/codesport/followers",
    "following_url": "https://api.github.com/users/codesport/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesport/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/codesport/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesport/subscriptions",
    "organizations_url": "https://api.github.com/users/codesport/orgs",
    "repos_url": "https://api.github.com/users/codesport/repos",
    "events_url": "https://api.github.com/users/codesport/events{/privacy}",
    "received_events_url": "https://api.github.com/users/codesport/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-01-12T17:45:42Z",
  "updated_at": "2022-01-13T07:03:13Z",
  "closed_at": "2022-01-13T07:03:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "This error occurrs on both v2022.01.01 and  v2021.12.03 of Erigon.  Trying without success to deploy Erigon with Lighthouse  for proof-of-stake on the Ethereum MainNet.  \r\n\r\n**The only logical explanation is that the RPC daemon is designed to shutdown automatically until Erigon is fully synched. However, we're unable confirm if this is the intended and expected behaviour with Erigon.** \r\n\r\nSince localhost:8545 remains open and available for Geth, Besu, and Nethermind during their synching processes, this error is may also be a configuration issue on our part... or maybe a bug in the Erigon RPC Daemon? \r\n\r\nOur startup config files for Erigon and its RPC Daemon are included below for reference.\r\n\r\n### System information\r\n\r\n**Erigon version:** v2022.01.01  **AND** v2021.12.03\r\n\r\n**OS & Version**: Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-94-generic x86_64)\r\n\r\n**Commit hashes** :  db7fa3d0ed0758fdca29efd337c85200a290becf  **AND** 748abd39f68b44408555dc6eb6648999f6b5a7ad\r\n\r\n### Expected behaviour\r\nRPC daemon should keep the HTTP endpoint URL (localhost:8545) open \r\n\r\n### Actual behaviour\r\nRPC server immediately exits and shuts down. HTTP endpoint URL closes permanetly. \r\n\r\nAlso these are in the logs:\r\n\r\n`Jan 12 09:20:47 codesport-server rpcdaemon[5103]: [WARN] [01-12|09:20:47.092] rpc filters: error subscribing to pending transactions err=\"rpc error: code = Unimplemented desc = unknown service txpool.Txpool\"`\r\n\r\n`Jan 12 09:20:47 hope rpcdaemon[5103]: [EROR] [01-12|09:20:47.092] getting Version                          remote_service=mining error=\"rpc error: code = Unimplemented desc = unknown service txpool.Mining\"`\r\n\r\nPlease refer to the 16 lines of RPC Daemon logs (back trace) below for more details.\r\n\r\n### Steps to reproduce the behaviour\r\nBelow are our systemd configuration scripts used to startup Erigon. **NB:** The port for the `--private.api.addr` was changed to 9089 since we have Prometheus using port 9090.\r\n\r\n**Contents of /etc/systemd/system/eth1-erigon.service:**\r\n```\r\n[Unit]\r\nDescription    = Erigon ETH1 Execution Client service\r\nWants            = network-online.target\r\nAfter              = network-online.target \r\nRequires        = erigon-rpcdaemon.service\r\n\r\n[Service]\r\nType            = simple\r\nUser            = $USER\r\nExecStart       = $HOME/erigon/build/bin/erigon --datadir /var/lib/erigon --chain mainnet --private.api.addr=localhost:9089 --metrics --pprof --prune htc --prune.r.before=11184524\r\nRestart         = on-failure\r\nRestartSec      = 3\r\nKillSignal      = SIGINT\r\nTimeoutStopSec  = 5\r\n\r\n[Install]\r\nWantedBy    = multi-user.target\r\n```\r\n\r\n**Contents of /etc/systemd/system/erigon-rpcdaemon.service:**\r\n\r\n```\r\n[Unit]\r\nDescription     = Erigon RPC Daemon Service\r\nBindsTo\t       = eth1-erigon.service\r\nAfter               = eth1-erigon.service\r\n\r\n[Service]\r\nType            = simple\r\nUser            = $USER\r\nExecStartPre\t  = /bin/sleep 3\r\nExecStart       = $HOME/erigon/build/bin/rpcdaemon --private.api.addr=localhost:9089 --datadir /var/lib/erigon --http.api=eth,erigon,web3,net,debug,trace,txpool,shh\r\nRestart         = on-failure\r\nRestartSec      = 3\r\nKillSignal      = SIGINT\r\nTimeoutStopSec  = 5\r\n\r\n[Install]\r\nWantedBy    = eth1-erigon.service\r\n```\r\n\r\n### Backtrace\r\n\r\n````\r\nJan 12 09:20:43 codesport-server systemd[1]: Starting erigon rpcdaemon service...\r\nJan 12 09:20:46 codesport-server systemd[1]: Started erigon rpcdaemon service.\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.075] DB schemas compatible                    reader=5.0.0 database=5.0.0\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.076] rpc filters: subscribing to Erigon events\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [EROR] [01-12|09:20:47.076] Unavailable modules in HTTP API list     unavailable=[shh] available=\"[eth erigon web3 net debug trace txpool]\"\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.077] HTTP endpoint opened                     url=localhost:8545 ws=false ws.compression=false grpc=false\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.080] interfaces compatible                    remote_db= client=5.0.0 server=5.0.0\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.080] interfaces compatible                    remote_service=eth_backend client=3.0.0 server=3.0.0\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [WARN] [01-12|09:20:47.092] rpc filters: error subscribing to pending transactions err=\"rpc error: code = Unimplemented desc = unknown service txpool.Txpool\"\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [EROR] [01-12|09:20:47.092] getting Version                          remote_service=mining error=\"rpc error: code = Unimplemented desc = unknown service txpool.Mining\"\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.092] Exiting...\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.092] RPC server shutting down\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [EROR] [01-12|09:20:47.093] ensure version                           remote_service=tx_pool error=\"rpc error: code = Unimplemented desc = unknown service txpool.Txpool\"\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.094] HTTP endpoint closed                     url=localhost:8545\r\nJan 12 09:20:47 codesport-server rpcdaemon[5103]: [INFO] [01-12|09:20:47.094] database closed                          label=chaindata\r\nJan 12 09:20:47 codesport-server systemd[1]: erigon-rpcdaemon.service: Succeeded.\r\n````\r\n",
  "closed_by": {
    "login": "codesport",
    "id": 5884033,
    "node_id": "MDQ6VXNlcjU4ODQwMzM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5884033?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/codesport",
    "html_url": "https://github.com/codesport",
    "followers_url": "https://api.github.com/users/codesport/followers",
    "following_url": "https://api.github.com/users/codesport/following{/other_user}",
    "gists_url": "https://api.github.com/users/codesport/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/codesport/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/codesport/subscriptions",
    "organizations_url": "https://api.github.com/users/codesport/orgs",
    "repos_url": "https://api.github.com/users/codesport/repos",
    "events_url": "https://api.github.com/users/codesport/events{/privacy}",
    "received_events_url": "https://api.github.com/users/codesport/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1011817512",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3247#issuecomment-1011817512",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247",
    "id": 1011817512,
    "node_id": "IC_kwDOC0FsAM48Txwo",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-13T05:49:50Z",
    "updated_at": "2022-01-13T05:49:50Z",
    "author_association": "COLLABORATOR",
    "body": "@codesport add to RPCDaemon: --txpool.api.addr=localhost:9089 \r\n(it has default value 127.0.0.1:9090)\r\nnow txpool can optionally be launched outside of Erigon, so we have one more cli option to configure",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1011817512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1011852955",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3247#issuecomment-1011852955",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3247",
    "id": 1011852955,
    "node_id": "IC_kwDOC0FsAM48T6ab",
    "user": {
      "login": "codesport",
      "id": 5884033,
      "node_id": "MDQ6VXNlcjU4ODQwMzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5884033?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/codesport",
      "html_url": "https://github.com/codesport",
      "followers_url": "https://api.github.com/users/codesport/followers",
      "following_url": "https://api.github.com/users/codesport/following{/other_user}",
      "gists_url": "https://api.github.com/users/codesport/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/codesport/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/codesport/subscriptions",
      "organizations_url": "https://api.github.com/users/codesport/orgs",
      "repos_url": "https://api.github.com/users/codesport/repos",
      "events_url": "https://api.github.com/users/codesport/events{/privacy}",
      "received_events_url": "https://api.github.com/users/codesport/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-13T07:03:06Z",
    "updated_at": "2022-01-13T07:03:06Z",
    "author_association": "NONE",
    "body": "> @codesport add to RPCDaemon: --txpool.api.addr=localhost:9089 (it has default value 127.0.0.1:9090) now txpool can optionally be launched outside of Erigon, so we have one more cli option to configure\r\n\r\nThanks for the feedback. \r\n\r\n As suspected, this is a config problem on our part. Will close this issue now.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1011852955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
