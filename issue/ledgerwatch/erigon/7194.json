{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7194",
  "id": 1643079186,
  "node_id": "I_kwDOC0FsAM5h72YS",
  "number": 7194,
  "title": "debug_traceCall returns a format error that is not in JSON format.",
  "user": {
    "login": "daog1",
    "id": 1438562,
    "node_id": "MDQ6VXNlcjE0Mzg1NjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1438562?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/daog1",
    "html_url": "https://github.com/daog1",
    "followers_url": "https://api.github.com/users/daog1/followers",
    "following_url": "https://api.github.com/users/daog1/following{/other_user}",
    "gists_url": "https://api.github.com/users/daog1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/daog1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/daog1/subscriptions",
    "organizations_url": "https://api.github.com/users/daog1/orgs",
    "repos_url": "https://api.github.com/users/daog1/repos",
    "events_url": "https://api.github.com/users/daog1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/daog1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-03-28T02:02:42Z",
  "updated_at": "2023-05-14T01:08:09Z",
  "closed_at": "2023-05-14T01:08:09Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `./erigon --version`\r\neth mainnet\r\nerigon version 2.39.0-stable-b5891e2c\r\nRequest:\r\n\r\n```\r\ncurl --request POST \\\r\n  --url http://127.0.0.1:21301 \\\r\n  --header 'content-type: application/json' \\\r\n  --data '{\r\n    \"id\": 1,\r\n    \"jsonrpc\": \"2.0\",\r\n    \"method\": \"debug_traceCall\",\r\n    \"params\": [\r\n        {\r\n            \"from\": \"0x9aaacbf9ee36a4d7fbe5dab1e2424c11abad39f0\",\r\n            \"to\": \"0x522d0f9f3eff479a5b256bb1c1108f47b8e1a153\",\r\n            \"data\": \"0x095ea7b30000000000000000000000003a6d8ca21d1cf76f653a67577fa0d27453350dd800000000000000000000000000000000000000000000004bc7788e1e5b3a0000\"\r\n        },\r\n        \"latest\"\r\n    ]\r\n}'\r\n```\r\nErigon response:\r\n```\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":{\"structLogs\":[]}null,\"error\":{\"code\":-32000,\"message\":\"tracing failed: fee cap less than block base fee: address 0x9AAACBF9EE36A4d7fBE5dAb1E2424c11aBaD39f0, gasFeeCap: 0 baseFee: 22186880532\"}}\r\n```\r\n\r\n",
  "closed_by": {
    "login": "daog1",
    "id": 1438562,
    "node_id": "MDQ6VXNlcjE0Mzg1NjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1438562?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/daog1",
    "html_url": "https://github.com/daog1",
    "followers_url": "https://api.github.com/users/daog1/followers",
    "following_url": "https://api.github.com/users/daog1/following{/other_user}",
    "gists_url": "https://api.github.com/users/daog1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/daog1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/daog1/subscriptions",
    "organizations_url": "https://api.github.com/users/daog1/orgs",
    "repos_url": "https://api.github.com/users/daog1/repos",
    "events_url": "https://api.github.com/users/daog1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/daog1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1486105557",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7194#issuecomment-1486105557",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194",
    "id": 1486105557,
    "node_id": "IC_kwDOC0FsAM5YlCvV",
    "user": {
      "login": "daog1",
      "id": 1438562,
      "node_id": "MDQ6VXNlcjE0Mzg1NjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1438562?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daog1",
      "html_url": "https://github.com/daog1",
      "followers_url": "https://api.github.com/users/daog1/followers",
      "following_url": "https://api.github.com/users/daog1/following{/other_user}",
      "gists_url": "https://api.github.com/users/daog1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daog1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daog1/subscriptions",
      "organizations_url": "https://api.github.com/users/daog1/orgs",
      "repos_url": "https://api.github.com/users/daog1/repos",
      "events_url": "https://api.github.com/users/daog1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daog1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T02:12:26Z",
    "updated_at": "2023-03-28T02:12:26Z",
    "author_association": "NONE",
    "body": "This way, how should we change it?\r\nTraceTx function:\r\n```\r\nvmenv := vm.NewEVM(blockCtx, txCtx, ibs, chainConfig, vm.Config{Debug: true, Tracer: tracer})\r\n\tvar refunds = true\r\n\tif config != nil && config.NoRefunds != nil && *config.NoRefunds {\r\n\t\trefunds = false\r\n\t}\r\n\t//if streaming {\r\n\t//\tstream.WriteObjectStart()\r\n\t//\tstream.WriteObjectField(\"structLogs\")\r\n\t//\tstream.WriteArrayStart()\r\n\t//}\r\n\r\n\tvar result *core.ExecutionResult\r\n\tif config != nil && config.BorTx != nil && *config.BorTx {\r\n\t\tcallmsg := prepareCallMessage(message)\r\n\t\tresult, err = statefull.ApplyBorMessage(*vmenv, callmsg)\r\n\t} else {\r\n\t\tresult, err = core.ApplyMessage(vmenv, message, new(core.GasPool).AddGas(message.Gas()), refunds, false /* gasBailout */)\r\n\t}\r\n\r\n\tif err != nil {\r\n\t\t//if streaming {\r\n\t\t//\tstream.WriteArrayEnd()\r\n\t\t//\tstream.WriteObjectEnd()\r\n\t\t//\tstream.WriteMore()\r\n\t\t//\tstream.WriteObjectField(\"resultHack\") // higher-level func will assing it to NULL\r\n\t\t//} else {\r\n\t\t//\tstream.WriteNil()\r\n\t\t//}\r\n\t\treturn fmt.Errorf(\"tracing failed: %w\", err)\r\n\t}\r\n\t// Depending on the tracer type, format and return the output\r\n\tif streaming {\r\n\t\tstream.WriteObjectStart()\r\n\t\tstream.WriteObjectField(\"structLogs\")\r\n\t\tstream.WriteArrayStart()\r\n\t\t//}\r\n\r\n\t\tstream.WriteArrayEnd()\r\n\t\tstream.WriteMore()\r\n\t\tstream.WriteObjectField(\"gas\")\r\n\t\tstream.WriteUint64(result.UsedGas)\r\n\t\tstream.WriteMore()\r\n\t\tstream.WriteObjectField(\"failed\")\r\n\t\tstream.WriteBool(result.Failed())\r\n\t\tstream.WriteMore()\r\n\t\t// If the result contains a revert reason, return it.\r\n\t\treturnVal := hex.EncodeToString(result.Return())\r\n\t\tif len(result.Revert()) > 0 {\r\n\t\t\treturnVal = hex.EncodeToString(result.Revert())\r\n\t\t}\r\n\t\tstream.WriteObjectField(\"returnValue\")\r\n\t\tstream.WriteString(returnVal)\r\n\t\tstream.WriteObjectEnd()\r\n\t}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1486105557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1486125394",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7194#issuecomment-1486125394",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194",
    "id": 1486125394,
    "node_id": "IC_kwDOC0FsAM5YlHlS",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T02:45:33Z",
    "updated_at": "2023-03-28T02:45:33Z",
    "author_association": "COLLABORATOR",
    "body": "@hexoscott hi. you did work on same last time? ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1486125394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1491929136",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7194#issuecomment-1491929136",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194",
    "id": 1491929136,
    "node_id": "IC_kwDOC0FsAM5Y7Qgw",
    "user": {
      "login": "hexoscott",
      "id": 70711990,
      "node_id": "MDQ6VXNlcjcwNzExOTkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/70711990?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hexoscott",
      "html_url": "https://github.com/hexoscott",
      "followers_url": "https://api.github.com/users/hexoscott/followers",
      "following_url": "https://api.github.com/users/hexoscott/following{/other_user}",
      "gists_url": "https://api.github.com/users/hexoscott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hexoscott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hexoscott/subscriptions",
      "organizations_url": "https://api.github.com/users/hexoscott/orgs",
      "repos_url": "https://api.github.com/users/hexoscott/repos",
      "events_url": "https://api.github.com/users/hexoscott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hexoscott/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T13:30:01Z",
    "updated_at": "2023-03-31T13:30:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @AskAlexSharov, I tackled another issue but with the same symptom.  I put in a check to see if null had already been put into the stream before writing it again, we were seeing `nullnull` in the `result` field.  This seems like a different thing but closely related",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1491929136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1493273645",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7194#issuecomment-1493273645",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194",
    "id": 1493273645,
    "node_id": "IC_kwDOC0FsAM5ZAYwt",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-02T09:08:55Z",
    "updated_at": "2023-04-02T09:08:55Z",
    "author_association": "COLLABORATOR",
    "body": "thank you",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1493273645/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1546498429",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7194#issuecomment-1546498429",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7194",
    "id": 1546498429,
    "node_id": "IC_kwDOC0FsAM5cLbF9",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-05-13T02:18:00Z",
    "updated_at": "2023-05-13T02:18:00Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1546498429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
