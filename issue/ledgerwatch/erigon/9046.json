{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/9046",
  "id": 2051718557,
  "node_id": "I_kwDOC0FsAM56Sr2d",
  "number": 9046,
  "title": "Caplin stuck at Waiting For Peers after Block 18299999 ",
  "user": {
    "login": "AndrewMohawk",
    "id": 1465995,
    "node_id": "MDQ6VXNlcjE0NjU5OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1465995?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AndrewMohawk",
    "html_url": "https://github.com/AndrewMohawk",
    "followers_url": "https://api.github.com/users/AndrewMohawk/followers",
    "following_url": "https://api.github.com/users/AndrewMohawk/following{/other_user}",
    "gists_url": "https://api.github.com/users/AndrewMohawk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AndrewMohawk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AndrewMohawk/subscriptions",
    "organizations_url": "https://api.github.com/users/AndrewMohawk/orgs",
    "repos_url": "https://api.github.com/users/AndrewMohawk/repos",
    "events_url": "https://api.github.com/users/AndrewMohawk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AndrewMohawk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-12-21T05:22:44Z",
  "updated_at": "2024-01-02T17:10:55Z",
  "closed_at": "2023-12-31T10:21:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\n\r\nI am building up my erigorn archive node and noticed that I didnt have the --internalcl flag when I got to block height 18299999. I stopped my docker container, and rebuilt it and I see caplin starting but is simply looping at\r\n\r\n`app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s`\r\n\r\nIt feels like this could have been a port forwarding or `devel` issue, but I get the same on `v2.55.1` , I'm forwarding the following ports into the docker image from the Internet on both TCP and UDP:\r\n\r\n```\r\n42069,30303,30304,4000,4001,5555,9093,9000,9100\r\n```\r\n\r\n(Some extra as I was trying to debug)\r\n\r\nIs there a port I am missing or something else I should be doing to stop this from being stuck at \"Waiting For Peers\" ?",
  "closed_by": {
    "login": "Giulio2002",
    "id": 29233688,
    "node_id": "MDQ6VXNlcjI5MjMzNjg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Giulio2002",
    "html_url": "https://github.com/Giulio2002",
    "followers_url": "https://api.github.com/users/Giulio2002/followers",
    "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
    "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
    "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
    "repos_url": "https://api.github.com/users/Giulio2002/repos",
    "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1868531604",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1868531604",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1868531604,
    "node_id": "IC_kwDOC0FsAM5vX4eU",
    "user": {
      "login": "Giulio2002",
      "id": 29233688,
      "node_id": "MDQ6VXNlcjI5MjMzNjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Giulio2002",
      "html_url": "https://github.com/Giulio2002",
      "followers_url": "https://api.github.com/users/Giulio2002/followers",
      "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
      "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
      "repos_url": "https://api.github.com/users/Giulio2002/repos",
      "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-24T14:39:16Z",
    "updated_at": "2023-12-24T14:39:16Z",
    "author_association": "COLLABORATOR",
    "body": "This usually happens when ports are not exposed to the internet, are they all exposed? check the discovery ports",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1868531604/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1872667212",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1872667212",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1872667212,
    "node_id": "IC_kwDOC0FsAM5vnqJM",
    "user": {
      "login": "AndrewMohawk",
      "id": 1465995,
      "node_id": "MDQ6VXNlcjE0NjU5OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1465995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AndrewMohawk",
      "html_url": "https://github.com/AndrewMohawk",
      "followers_url": "https://api.github.com/users/AndrewMohawk/followers",
      "following_url": "https://api.github.com/users/AndrewMohawk/following{/other_user}",
      "gists_url": "https://api.github.com/users/AndrewMohawk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AndrewMohawk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AndrewMohawk/subscriptions",
      "organizations_url": "https://api.github.com/users/AndrewMohawk/orgs",
      "repos_url": "https://api.github.com/users/AndrewMohawk/repos",
      "events_url": "https://api.github.com/users/AndrewMohawk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AndrewMohawk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-31T04:24:10Z",
    "updated_at": "2023-12-31T04:24:10Z",
    "author_association": "NONE",
    "body": "I have all of those enabled and confirmed that I can connect to them apart from 9000 and 9001, but I actually cant remember what I needed those for. can you confirm which ports are needed for discovery?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1872667212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1872756588",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1872756588",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1872756588,
    "node_id": "IC_kwDOC0FsAM5vn_9s",
    "user": {
      "login": "whidrasl",
      "id": 14200104,
      "node_id": "MDQ6VXNlcjE0MjAwMTA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/14200104?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/whidrasl",
      "html_url": "https://github.com/whidrasl",
      "followers_url": "https://api.github.com/users/whidrasl/followers",
      "following_url": "https://api.github.com/users/whidrasl/following{/other_user}",
      "gists_url": "https://api.github.com/users/whidrasl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/whidrasl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/whidrasl/subscriptions",
      "organizations_url": "https://api.github.com/users/whidrasl/orgs",
      "repos_url": "https://api.github.com/users/whidrasl/repos",
      "events_url": "https://api.github.com/users/whidrasl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/whidrasl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-31T07:16:07Z",
    "updated_at": "2023-12-31T07:32:17Z",
    "author_association": "NONE",
    "body": "Stuck at the same block (18299999). Getting logs like this for several (20) hours already:\r\n\r\n> [INFO] [12-31|07:07:36.076] [txpool] stat                            pending=0 baseFee=0 queued=30000 alloc=14.3GB sys=31.3GB\r\n> [INFO] [12-31|07:07:36.068] [p2p] GoodPeers                          eth68=100 eth67=92 eth66=8\r\n> [INFO] [12-31|07:07:06.354] Downloading History                      app=caplin stage=DownloadHistoricalBlocks slot=7671074 blockNumber=18480172 blk/sec=0.0 mbps/sec=0.0000 peers=277 snapshots=0 reconnected=false\r\n> [INFO] [12-31|07:07:05.540] P2P                                      app=caplin peers=277\r\n> [INFO] [12-31|07:06:36.354] Downloading History                      app=caplin stage=DownloadHistoricalBlocks slot=7671074 blockNumber=18480172 blk/sec=1.1 mbps/sec=0.1629 peers=277 snapshots=0 reconnected=false\r\n> [INFO] [12-31|07:06:06.355] Downloading History                      app=caplin stage=DownloadHistoricalBlocks slot=7671106 blockNumber=18480204 blk/sec=0.0 mbps/sec=0.0000 peers=278 snapshots=0 reconnected=false\r\n> [INFO] [12-31|07:06:05.540] P2P                                      app=caplin peers=278\r\n> [INFO] [12-31|07:05:36.354] Downloading History                      app=caplin stage=DownloadHistoricalBlocks slot=7671106 blockNumber=18480204 blk/sec=1.1 mbps/sec=0.1520 peers=280 snapshots=0 reconnected=false\r\n> [INFO] [12-31|07:05:06.354] Downloading History                      app=caplin stage=DownloadHistoricalBlocks slot=7671138 blockNumber=18480236 blk/sec=0.0 mbps/sec=0.0000 peers=281 snapshots=0 reconnected=false\r\n> [INFO] [12-31|07:05:05.540] P2P                                      app=caplin peers=281\r\n\r\nSyncing from 0 block, erigon v2.55.1, lightclient.discovery.port and lightclient.discovery.tcpport has the same value and externally available.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1872756588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1872913620",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1872913620",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1872913620,
    "node_id": "IC_kwDOC0FsAM5vomTU",
    "user": {
      "login": "Giulio2002",
      "id": 29233688,
      "node_id": "MDQ6VXNlcjI5MjMzNjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Giulio2002",
      "html_url": "https://github.com/Giulio2002",
      "followers_url": "https://api.github.com/users/Giulio2002/followers",
      "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
      "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
      "repos_url": "https://api.github.com/users/Giulio2002/repos",
      "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-31T10:21:54Z",
    "updated_at": "2023-12-31T10:21:54Z",
    "author_association": "COLLABORATOR",
    "body": "oh, this is fixed on latest version, some caplin snapshots prototype spilled",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1872913620/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1873367317",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1873367317",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1873367317,
    "node_id": "IC_kwDOC0FsAM5vqVEV",
    "user": {
      "login": "AndrewMohawk",
      "id": 1465995,
      "node_id": "MDQ6VXNlcjE0NjU5OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1465995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AndrewMohawk",
      "html_url": "https://github.com/AndrewMohawk",
      "followers_url": "https://api.github.com/users/AndrewMohawk/followers",
      "following_url": "https://api.github.com/users/AndrewMohawk/following{/other_user}",
      "gists_url": "https://api.github.com/users/AndrewMohawk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AndrewMohawk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AndrewMohawk/subscriptions",
      "organizations_url": "https://api.github.com/users/AndrewMohawk/orgs",
      "repos_url": "https://api.github.com/users/AndrewMohawk/repos",
      "events_url": "https://api.github.com/users/AndrewMohawk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AndrewMohawk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-01T15:17:39Z",
    "updated_at": "2024-01-01T15:17:39Z",
    "author_association": "NONE",
    "body": "Which ports are needed? I still cant find any peers:\r\n\r\n```\r\n2024-01-01 10:12:08 downloader-1  | [INFO] [01-01|15:12:08.075] [snapshots] Seeding                      up=0B/s peers=4 conns=4 files=197 alloc=392.7MB sys=474.9MB\r\n2024-01-01 10:12:10 erigon-1      | [INFO] [01-01|15:12:10.433] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:13 erigon-1      | [INFO] [01-01|15:12:13.434] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:16 erigon-1      | [INFO] [01-01|15:12:16.435] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:19 erigon-1      | [INFO] [01-01|15:12:19.435] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:22 erigon-1      | [INFO] [01-01|15:12:22.436] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:25 erigon-1      | [INFO] [01-01|15:12:25.437] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:28 downloader-1  | [INFO] [01-01|15:12:28.075] [snapshots] Seeding                      up=0B/s peers=2 conns=2 files=197 alloc=240.8MB sys=512.3MB\r\n2024-01-01 10:12:28 erigon-1      | [INFO] [01-01|15:12:28.437] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:31 erigon-1      | [INFO] [01-01|15:12:31.438] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:34 erigon-1      | [INFO] [01-01|15:12:34.439] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:37 erigon-1      | [INFO] [01-01|15:12:37.439] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:40 erigon-1      | [INFO] [01-01|15:12:40.440] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:43 erigon-1      | [INFO] [01-01|15:12:43.440] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n2024-01-01 10:12:46 erigon-1      | [INFO] [01-01|15:12:46.441] [Caplin] Waiting For Peers               app=caplin stage=WaitForPeers have=0 needed=4 retryIn=3s\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1873367317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1874196637",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1874196637",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1874196637,
    "node_id": "IC_kwDOC0FsAM5vtfid",
    "user": {
      "login": "zxzyy10",
      "id": 47973840,
      "node_id": "MDQ6VXNlcjQ3OTczODQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/47973840?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zxzyy10",
      "html_url": "https://github.com/zxzyy10",
      "followers_url": "https://api.github.com/users/zxzyy10/followers",
      "following_url": "https://api.github.com/users/zxzyy10/following{/other_user}",
      "gists_url": "https://api.github.com/users/zxzyy10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zxzyy10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zxzyy10/subscriptions",
      "organizations_url": "https://api.github.com/users/zxzyy10/orgs",
      "repos_url": "https://api.github.com/users/zxzyy10/repos",
      "events_url": "https://api.github.com/users/zxzyy10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zxzyy10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T15:47:09Z",
    "updated_at": "2024-01-02T15:47:09Z",
    "author_association": "NONE",
    "body": "> oh, this is fixed on latest version, some caplin snapshots prototype spilled\r\n\r\nwhich version should I choose to solve this problem?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1874196637/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1874304946",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9046#issuecomment-1874304946",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9046",
    "id": 1874304946,
    "node_id": "IC_kwDOC0FsAM5vt5-y",
    "user": {
      "login": "AndrewMohawk",
      "id": 1465995,
      "node_id": "MDQ6VXNlcjE0NjU5OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1465995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AndrewMohawk",
      "html_url": "https://github.com/AndrewMohawk",
      "followers_url": "https://api.github.com/users/AndrewMohawk/followers",
      "following_url": "https://api.github.com/users/AndrewMohawk/following{/other_user}",
      "gists_url": "https://api.github.com/users/AndrewMohawk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AndrewMohawk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AndrewMohawk/subscriptions",
      "organizations_url": "https://api.github.com/users/AndrewMohawk/orgs",
      "repos_url": "https://api.github.com/users/AndrewMohawk/repos",
      "events_url": "https://api.github.com/users/AndrewMohawk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AndrewMohawk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T17:10:54Z",
    "updated_at": "2024-01-02T17:10:54Z",
    "author_association": "NONE",
    "body": "For anyone who does come to this in the future (and once I have everything configured I will likely make a PR for the docker-compose), there are a few ports missing/incorrect in the compose file, currently what I am using on a windows machine with an attached NVME PCI gen 4 drive (that will move to a server after syncing) :\r\n\r\nThis seems to work with both `v2.55.1` and `devel` env set. DO NOT leave this unset or it will default to `latest` which is very old.\r\n\r\n```\r\n# Erigon by default is \"all in one binary\" solution, but it's possible start TxPool as separated processes.\r\n# Same true about: JSON RPC layer (RPCDaemon), p2p layer (Sentry), history download layer (Downloader), consensus.\r\n# Don't start services as separated processes unless you have clear reason for it: resource limiting, scale, replace by your own implementation, security.\r\n# This file is an example: how to start Erigon's services as separated processes.\r\n\r\n# Default: --datadir=E:/erigon-data\r\n# Default UID: 1000\r\n# Default GID: 1000\r\n# Ports: `9090` execution engine (private api), `9091` sentry, `9092` consensus engine, `9093` snapshot downloader, `9094` TxPool\r\n# Ports: `8545` json rpc, `8551` consensus json rpc, `30303` eth p2p protocol, `42069` bittorrent protocol,\r\n\r\n# Connections: erigon -> (sentries, downloader), rpcdaemon -> (erigon, txpool), txpool -> erigon\r\nversion: '2.2'\r\n\r\n# Basic erigon's service\r\nx-erigon-service: &default-erigon-service\r\n  image: thorax/erigon:${TAG:-latest}\r\n  pid: service:erigon # Use erigon's PID namespace. It's required to open Erigon's DB from another process (RPCDaemon local-mode)\r\n  volumes_from: [ erigon ]\r\n  restart: unless-stopped\r\n  mem_swappiness: 0\r\n  user: 1000:1000\r\nservices:\r\n  erigon:\r\n    image: thorax/erigon:${TAG:-latest}\r\n    build:\r\n      args:\r\n        UID: 1000\r\n        GID: 1000\r\n      context: .\r\n    command: |\r\n      --private.api.addr=0.0.0.0:9090 --internalcl\r\n      --sentry.api.addr=sentry:9091 --downloader.api.addr=downloader:9093 --txpool.disable\r\n      --metrics --metrics.addr=0.0.0.0 --metrics.port=6060 --pprof --pprof.addr=0.0.0.0 --pprof.port=6061\r\n      --nat \"extip:<my_external_ip>\"\r\n      --authrpc.jwtsecret=/home/erigon/.local/share/erigon/jwt.hex --datadir=/home/erigon/.local/share/erigon\r\n      --http.api \"eth,erigon,ots,web3,net,debug,trace,txpool\"\r\n      --verbosity 4\r\n      --snap.stop\r\n    ports: [ \"4000:4000/udp\", \"6060:6060\",\"6061:6061\",\"9090:9090\",\"7777:7777\",\"4001:4001\",\"8551:8551\",\"40517:40517\"]  \r\n\r\n    volumes:\r\n      # It's ok to mount sub-dirs of \"datadir\" to different drives\r\n      - \"E:/erigon-data:/home/erigon/.local/share/erigon\"\r\n    restart: unless-stopped\r\n    mem_swappiness: 0\r\n    user: 1000:1000\r\n\r\n  sentry:\r\n    <<: *default-erigon-service\r\n    entrypoint: sentry\r\n    command: --sentry.api.addr=0.0.0.0:9091 --datadir=/home/erigon/.local/share/erigon\r\n    ports: [ \"30303:30303/tcp\", \"30303:30303/udp\",\"30304:30304/tcp\", \"30304:30304/udp\", \"9091:9091\" ]\r\n\r\n  downloader:\r\n    <<: *default-erigon-service\r\n    entrypoint: downloader \r\n    command: --downloader.api.addr=0.0.0.0:9093 --datadir=/home/erigon/.local/share/erigon --torrent.download.rate=5000mb --torrent.maxpeers 300 --verbosity 4 --torrent.verbosity=4 --torrent.port 42069\r\n    ports: [ \"42069:42069/tcp\", \"42069:42069/udp\", \"9093:9093\"  ]\r\n    \r\n\r\n  txpool:\r\n    <<: *default-erigon-service\r\n    entrypoint: txpool\r\n    command: --private.api.addr=erigon:9090 --txpool.api.addr=0.0.0.0:9094 --sentry.api.addr=sentry:9091 --datadir=/home/erigon/.local/share/erigon\r\n    ports: [ \"9094:9094\"  ]\r\n\r\n  rpcdaemon:\r\n    <<: *default-erigon-service\r\n    entrypoint: rpcdaemon\r\n    command: |\r\n      --http.addr=0.0.0.0 --http.vhosts=any --http.corsdomain=* --ws\r\n      --private.api.addr=erigon:9090 --txpool.api.addr=txpool:9094 --datadir=/home/erigon/.local/share/erigon\r\n    ports: [ \"8545:8545\" ]\r\n\r\n\r\n\r\n\r\n  prometheus:\r\n    image: prom/prometheus:v2.47.2\r\n    user: 1000:1000 # Uses erigon user from Dockerfile\r\n    command: --log.level=warn --config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus --storage.tsdb.retention.time=150d --web.console.libraries=/usr/share/prometheus/console_libraries --web.console.templates=/usr/share/prometheus/consoles\r\n    \r\n    volumes:\r\n      - \"E:/erigon-data/cmd/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml\"\r\n      - \"E:/erigon-data/erigon-prometheus:/prometheus\"\r\n    restart: unless-stopped\r\n\r\n  grafana:\r\n    image: grafana/grafana:10.2.1\r\n    user: \"472:0\" # required for grafana version >= 7.3\r\n    ports: [ \"3000:3000\" ]\r\n    volumes:\r\n      - \"E:/erigon-data/cmd/prometheus/grafana.ini:/etc/grafana/grafana.ini\"\r\n      - \"E:/erigon-data/cmd/prometheus/datasources:/etc/grafana/provisioning/datasources\"\r\n      - \"E:/erigon-data/cmd/prometheus/dashboards:/etc/grafana/provisioning/dashboards\"\r\n      - \"E:/erigon-data/erigon-grafana:/var/lib/grafana\"\r\n    restart: unless-stopped\r\n```\r\n\r\nI went into each container and did `netstat -natp | grep -i listen` to see what was listening and then forwarded those ports. `40517` is likely not needed, but leaving it in since its finally moving! But this strategy should work for you as well ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1874304946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
