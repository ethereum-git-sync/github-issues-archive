{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8522",
  "id": 1951305806,
  "node_id": "I_kwDOC0FsAM50TpBO",
  "number": 8522,
  "title": "polygon mumbai: trace_block() returns \"block not found\" for 4 blocks (38809009, 38809010, 38809011, 38809012)",
  "user": {
    "login": "TeinEin",
    "id": 102388795,
    "node_id": "U_kgDOBhpUOw",
    "avatar_url": "https://avatars.githubusercontent.com/u/102388795?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TeinEin",
    "html_url": "https://github.com/TeinEin",
    "followers_url": "https://api.github.com/users/TeinEin/followers",
    "following_url": "https://api.github.com/users/TeinEin/following{/other_user}",
    "gists_url": "https://api.github.com/users/TeinEin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TeinEin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TeinEin/subscriptions",
    "organizations_url": "https://api.github.com/users/TeinEin/orgs",
    "repos_url": "https://api.github.com/users/TeinEin/repos",
    "events_url": "https://api.github.com/users/TeinEin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TeinEin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-10-19T05:37:53Z",
  "updated_at": "2023-10-19T19:59:41Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2.52.5`\r\n\r\nOS & Version: Linux\r\nUbuntu Server 22.04 LTS (HVM)\r\nArchitecture = 64-bit ARM\r\n\r\nCommit hash: 7c5e4e770f122299c34a9309a37a33a146443da8\r\n\r\nErigon Command (with flags/config):\r\n`./erigon --db.pagesize=\"16kb\" --chain=\"mumbai\" --datadir=\"~/snapshots/erigon/datadir_fresh\" --bor.heimdall=\"http://localhost:1317\" --http --http.addr=\"0.0.0.0\" --http.api=\"eth,debug,trace,erigon,net,txpool,bor,web3,admin\" --torrent.download.rate=\"4gb\" --verbosity=\"4\" --log.dir.verbosity=\"4\" --sentry.log-peer-info --db.size.limit=\"8TB\" --bootnodes=\"enode://bdcd4786a616a853b8a041f53496d853c68d99d54ff305615cd91c03cd56895e0a7f6e9f35dbf89131044e2114a9a782b792b5661e3aff07faf125a98606a071@43.200.206.40:30303,enode://209aaf7ed549cf4a5700fd833da25413f80a1248bd3aa7fe2a87203e3f7b236dd729579e5c8df61c97bf508281bae4969d6de76a7393bcbd04a0af70270333b3@54.216.248.9:30303\"`\r\n\r\nConsensus Layer:\r\nheimdalld v1.0.2\r\n\r\nConsensus Layer Command (with flags/config):\r\n`/usr/bin/heimdalld start --home \"/var/lib/heimdall\" \\\r\n    --chain=mumbai \\\r\n--seeds=\"9df7ae4bf9b996c0e3436ed4cd3050dbc5742a28@43.200.206.40:26656,d9275750bc877b0276c374307f0fd7eae1d71e35@54.216.248.9:26656,1a3258eb2b69b235d4749cf9266a94567d6c0199@52.214.83.78:26656\" \\\r\n--rest-server`\r\n\r\nChain/Network: \r\nMumbai\r\n\r\n#### Expected behaviour\r\nExpect a normal trace_block() response for blocks 38_809_009, 38_809_0010, 38_809_0011, 38_809_012\r\n\r\n#### Actual behaviour\r\nAlthough other blocks return the expected response, these 4 blocks do not.\r\n```\r\nassessing blockNumber: 38809008\r\ntraces exist: localhost\r\n\r\nassessing blockNumber: 38809009\r\n{'code': -32000, 'message': 'block 43920d0b38c1c71a4112ad391fc253114d849f8ee78417380db7e5b04755494b not found'}: localhost\r\n\r\nassessing blockNumber: 38809010\r\n{'code': -32000, 'message': 'block 9252323c9603b1c5a6a93ea5f0c0a864c93e061b328bfef3f0e61094d55d4e0c not found'}: localhost\r\n\r\nassessing blockNumber: 38809011\r\n{'code': -32000, 'message': 'block 53bc7c33b0572a6071a5b7393965536fb67d8ae144bd163cb65ea4ce0bd6cbf9 not found'}: localhost\r\n\r\nassessing blockNumber: 38809012\r\n{'code': -32000, 'message': 'block 351bfce02128f9669d34d375ad57b4fcc22e8d854639458ab2772bcae4c05610 not found'}: localhost\r\n\r\nassessing blockNumber: 38809013\r\ntraces exist: localhost\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n```\r\n# assessing blockrange 0x2502db0 to 0x2502db5\r\nimport requests\r\n\r\ndef convert_hex_to_decimal(n):\r\n    return int(n, base=16)\r\n\r\n\r\ndef convert_decimal_to_hex(n):\r\n    return hex(n)\r\n\r\n\r\ndef create_json_data(target_block):\r\n    return {'jsonrpc': '2.0', 'method': 'trace_block', 'params': [convert_decimal_to_hex(target_block)], 'id': 1}\r\n\r\n\r\ndef is_error_response(response):\r\n    output = response.json().get('error')\r\n    return 'traces exist' if not output else output\r\n\r\n\r\n# should be parameters\r\nSTARTING_BLOCK_NUMBER = convert_hex_to_decimal('0x25029C0')\r\nENDING_BLOCK_NUMBER = convert_hex_to_decimal('0x2503190')\r\n\r\nENDPOINTS_PER_NETWORK = {\r\n    \"polygon_mainnet\": {},\r\n    \"mumbai\": {\r\n        \"localhost\": \"http://localhost:8545\",\r\n    },\r\n}\r\n\r\ni_block_num = STARTING_BLOCK_NUMBER\r\nwhile i_block_num <= ENDING_BLOCK_NUMBER:\r\n    print(f\"assessing blockNumber: {i_block_num}\")\r\n    for endpoint_name, endpoint in ENDPOINTS_PER_NETWORK['mumbai'].items():\r\n        json_data = create_json_data(i_block_num)\r\n        response = requests.post(endpoint, headers={}, json=json_data)\r\n        output = is_error_response(response)\r\n        print(f\"{output}: {endpoint_name}\")\r\n    \r\n    i_block_num += 1\r\n\r\n    print(\"\")\r\n```\r\n\r\nNote: I tried again with a newly synced node from the polygon snapshot and got the same result\r\n`curl -L https://snapshot-download.polygon.technology/snapdown.sh | bash -s -- --network mumbai --client erigon --extract-dir ~/snapshots/erigon/datadir_fresh --validate-checksum true`\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1770121472",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8522#issuecomment-1770121472",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522",
    "id": 1770121472,
    "node_id": "IC_kwDOC0FsAM5pgekA",
    "user": {
      "login": "TeinEin",
      "id": 102388795,
      "node_id": "U_kgDOBhpUOw",
      "avatar_url": "https://avatars.githubusercontent.com/u/102388795?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TeinEin",
      "html_url": "https://github.com/TeinEin",
      "followers_url": "https://api.github.com/users/TeinEin/followers",
      "following_url": "https://api.github.com/users/TeinEin/following{/other_user}",
      "gists_url": "https://api.github.com/users/TeinEin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TeinEin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TeinEin/subscriptions",
      "organizations_url": "https://api.github.com/users/TeinEin/orgs",
      "repos_url": "https://api.github.com/users/TeinEin/repos",
      "events_url": "https://api.github.com/users/TeinEin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TeinEin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T06:06:05Z",
    "updated_at": "2023-10-19T06:06:05Z",
    "author_association": "NONE",
    "body": "likely related: https://github.com/ledgerwatch/erigon/issues/8523",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1770121472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1771622832",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8522#issuecomment-1771622832",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8522",
    "id": 1771622832,
    "node_id": "IC_kwDOC0FsAM5pmNGw",
    "user": {
      "login": "TeinEin",
      "id": 102388795,
      "node_id": "U_kgDOBhpUOw",
      "avatar_url": "https://avatars.githubusercontent.com/u/102388795?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TeinEin",
      "html_url": "https://github.com/TeinEin",
      "followers_url": "https://api.github.com/users/TeinEin/followers",
      "following_url": "https://api.github.com/users/TeinEin/following{/other_user}",
      "gists_url": "https://api.github.com/users/TeinEin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TeinEin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TeinEin/subscriptions",
      "organizations_url": "https://api.github.com/users/TeinEin/orgs",
      "repos_url": "https://api.github.com/users/TeinEin/repos",
      "events_url": "https://api.github.com/users/TeinEin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TeinEin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T19:59:41Z",
    "updated_at": "2023-10-19T19:59:41Z",
    "author_association": "NONE",
    "body": "using https://rpc.ankr.com/polygon_mumbai seems to return the correct response for these blocks",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1771622832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
