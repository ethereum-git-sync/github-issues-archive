{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1663",
  "id": 849529137,
  "node_id": "MDU6SXNzdWU4NDk1MjkxMzc=",
  "number": 1663,
  "title": "Panic during block execution at height 9869460",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-04-02T23:37:41Z",
  "updated_at": "2021-04-11T03:29:23Z",
  "closed_at": "2021-04-11T03:29:23Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 5b87126b4302a2794eca22651b69357122ae960e\r\nOS & Version: Linux\r\nCommit hash : 5b87126b4302a2794eca22651b69357122ae960e\r\n\r\n#### Expected behaviour\r\n\r\nBlocks to execute\r\n\r\n#### Actual behaviour\r\n\r\nClient panics and crashes\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nThis was a fresh sync from an empty database.\r\n\r\n#### Backtrace\r\n\r\n````\r\npanic: runtime error: index out of range [0] with length 0                                                                                [9/3876]\r\ngoroutine 1461 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/turbo/shards.ReadHeap.Swap(0xc8270ae000, 0x0, 0x50da00, 0x0, 0xffffffffffffffff)\r\n        github.com/ledgerwatch/turbo-geth/turbo/shards/state_cache.go:330 +0x125\r\ncontainer/heap.Pop(0x1841840, 0xc0005aa1e0, 0xc666946de0, 0x0)\r\n        container/heap/heap.go:62 +0x64\r\ngithub.com/ledgerwatch/turbo-geth/turbo/shards.(*StateCache).setWrite(0xc0005aa160, 0x184f520, 0xc666946de0, 0x183e4c0, 0xc16bf80640, 0x0)\r\n        github.com/ledgerwatch/turbo-geth/turbo/shards/state_cache.go:674 +0x1a9\r\ngithub.com/ledgerwatch/turbo-geth/turbo/shards.(*StateCache).SetCodeWrite(0xc0005aa160, 0xc2e89fc5c0, 0x14, 0x14, 0x1, 0xc2e3a1d74a, 0x16, 0x16)\r\n        github.com/ledgerwatch/turbo-geth/turbo/shards/state_cache.go:908 +0x1f6\r\ngithub.com/ledgerwatch/turbo-geth/core/state.(*CachedWriter).UpdateAccountCode(0xc171565520, 0x189db0c75da286a2, 0x954a7f80c2513aa8, 0x6a40270356e61ca4, 0x1, 0xd55739dd39d80cd8, 0xa102a2ad8007b972, 0x94eada7528fa3639, 0xd2f19e1e37636221, 0xc2e3a1d74a, ...)\r\n        github.com/ledgerwatch/turbo-geth/core/state/cached_writer.go:35 +0x157\r\ngithub.com/ledgerwatch/turbo-geth/core/state.updateAccount(0x183da40, 0xc11e5a5bf0, 0x7de17c23f008, 0xc171565520, 0x189db0c75da286a2, 0x954a7f80c2513aa8, 0x56e61ca4, 0xc11e28fce0, 0x1, 0x0, ...)\r\n        github.com/ledgerwatch/turbo-geth/core/state/intra_block_state.go:799 +0x28e\r\ngithub.com/ledgerwatch/turbo-geth/core/state.(*IntraBlockState).CommitBlock(0xc4f50e7900, 0x183da40, 0xc11e5a5bf0, 0x7de17c23f008, 0xc171565520, 0x0, 0x0)\r\n        github.com/ledgerwatch/turbo-geth/core/state/intra_block_state.go:857 +0x2a7\r\ngithub.com/ledgerwatch/turbo-geth/core.FinalizeBlockExecution(0x1850520, 0xc000498340, 0xc11d863d40, 0xc11d863680, 0x44, 0x44, 0x2193300, 0x0, 0x0, 0x1849f80, ...)\r\n        github.com/ledgerwatch/turbo-geth/core/blockchain.go:1972 +0x15e\r\ngithub.com/ledgerwatch/turbo-geth/core.ExecuteBlockEphemerally(0x20425e0, 0xc0004de3a8, 0x182c040, 0xc0004945c0, 0x1850520, 0xc000498340, 0xc048396d80, 0x18412c0, 0xc171565500, 0x1849f80, ...)\r\n        github.com/ledgerwatch/turbo-geth/core/blockchain.go:1950 +0x1114\r\ngithub.com/ledgerwatch/turbo-geth/eth/stagedsync.executeBlockWithGo(0xc048396d80, 0x18531c0, 0xc0122625c0, 0xc0005aa160, 0x18531c0, 0xc0122625c0, 0x20425e0, 0x182c040, 0xc0004945c0, 0xc0004de3a8, ...)\r\n        github.com/ledgerwatch/turbo-geth/eth/stagedsync/stage_execute.go:102 +0x2a7\r\ngithub.com/ledgerwatch/turbo-geth/eth/stagedsync.SpawnExecuteBlocksStage(0xc013dec060, 0x1853120, 0xc0004292d0, 0x20425e0, 0xc0004945c0, 0xc0004de3a8, 0xc0003ba420, 0x0, 0x1, 0xc0005aa160, ...)\r\n        github.com/ledgerwatch/turbo-geth/eth/stagedsync/stage_execute.go:200 +0x109f\r\ngithub.com/ledgerwatch/turbo-geth/eth/stagedsync.DefaultStages.func5.1(0xc013dec060, 0x181a7e0, 0xc0002edce0, 0x9, 0x1835f00)\r\n        github.com/ledgerwatch/turbo-geth/eth/stagedsync/stagebuilder.go:210 +0x125\r\ngithub.com/ledgerwatch/turbo-geth/eth/stagedsync.(*State).runStage(0xc0002edce0, 0xc0005b0370, 0x1835f00, 0xc0004292d0, 0x1835f00, 0xc0004292d0, 0x8, 0x10)\r\n        github.com/ledgerwatch/turbo-geth/eth/stagedsync/state.go:270 +0x155\r\ngithub.com/ledgerwatch/turbo-geth/eth/stagedsync.(*State).Run(0xc0002edce0, 0x7de1d8617ec8, 0xc0004292d0, 0x7de1d8617ec8, 0xc0004292d0, 0xc0004de3\r\n\r\n        github.com/ledgerwatch/turbo-geth/eth/stagedsync/state.go:201 +0x348\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).syncWithPeer(0xc0004c6200, 0xc000a2a690, 0xb5103c3ac64d3976, 0xaf57af5df8624657, 0x\r\n36, 0xc0002a4d80, 0x16cc978, 0x0, ...)\r\n        github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:608 +0xe19\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).synchronise(0xc0004c6200, 0xc0004a0d00, 0x40, 0xb5103c3ac64d3976, 0xaf57af5df862465\r\nxb94f36, 0xc000000001, 0xc0002a4d80, ...)\r\n        github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:450 +0x3a5\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).Synchronise(0xc0004c6200, 0xc0004a0d00, 0x40, 0xb5103c3ac64d3976, 0xaf57af5df862465\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).Synchronise(0xc0004c6200, 0xc0004a0d00, 0x40, 0xb5103c3ac64d3976, 0xaf57af5df8624657, 0x3fa15a272013574f, 0x517701d920567531, 0xb94f36, 0xa9c204fd00000001, 0xc0002a4d80, ...)\r\n        github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:365 +0xa6\r\ngithub.com/ledgerwatch/turbo-geth/eth.(*handler).doSync(0xc00016a000, 0xc000286680, 0x0, 0xc0004d26e0)\r\n        github.com/ledgerwatch/turbo-geth/eth/sync.go:291 +0xcb\r\ngithub.com/ledgerwatch/turbo-geth/eth.(*chainSyncer).startSync.func1(0xc000442930, 0xc000286680)\r\n        github.com/ledgerwatch/turbo-geth/eth/sync.go:284 +0x38\r\ncreated by github.com/ledgerwatch/turbo-geth/eth.(*chainSyncer).startSync\r\n        github.com/ledgerwatch/turbo-geth/eth/sync.go:284 +0x76\r\n````\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/817241075",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1663#issuecomment-817241075",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1663",
    "id": 817241075,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNzI0MTA3NQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-11T03:29:23Z",
    "updated_at": "2021-04-11T03:29:23Z",
    "author_association": "COLLABORATOR",
    "body": "Thank you! \r\nBut probably you using --cacheSize flag - which is experimental (and a bit broken now). \r\nPlease use --batchSize instead. \r\nFixed by https://github.com/ledgerwatch/turbo-geth/pull/1711\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/817241075/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
