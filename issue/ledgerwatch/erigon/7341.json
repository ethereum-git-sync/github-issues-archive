{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7341",
  "id": 1674262816,
  "node_id": "I_kwDOC0FsAM5jyzkg",
  "number": 7341,
  "title": "Confusion about the 'intersection mode' for trace_filter",
  "user": {
    "login": "rekyyang",
    "id": 22545420,
    "node_id": "MDQ6VXNlcjIyNTQ1NDIw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22545420?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rekyyang",
    "html_url": "https://github.com/rekyyang",
    "followers_url": "https://api.github.com/users/rekyyang/followers",
    "following_url": "https://api.github.com/users/rekyyang/following{/other_user}",
    "gists_url": "https://api.github.com/users/rekyyang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rekyyang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rekyyang/subscriptions",
    "organizations_url": "https://api.github.com/users/rekyyang/orgs",
    "repos_url": "https://api.github.com/users/rekyyang/repos",
    "events_url": "https://api.github.com/users/rekyyang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rekyyang/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-04-19T06:39:41Z",
  "updated_at": "2023-04-21T03:15:43Z",
  "closed_at": "2023-04-21T03:15:43Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: erigon version 2.42.0-stable-963e4607\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):\r\n\r\nConcensus Layer: lighthouse\r\n\r\nConcensus Layer Command (with flags/config):\r\n\r\nChain/Network:  eth-goerli\r\n\r\n#### Expected behaviour\r\nI test the trace_filter method with intersection mode on eth-goerli chain, the request is\r\n````\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"id\": 1,\r\n    \"method\": \"trace_filter\",\r\n    \"params\": [\r\n        {\r\n            \"fromBlock\": \"0x87172b\",\r\n            \"toBlock\": \"0x87172b\",\r\n            \"fromAddress\": [\r\n                \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\"\r\n            ],\r\n            \"toAddress\": [\r\n                \"0x695364ffaa20f205e337f9e6226e5e22525838d9\"\r\n            ],\r\n            \"mode\": \"intersection\"\r\n        }\r\n    ]\r\n}\r\n````\r\n\r\nthe response is\r\n````\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"id\": 1,\r\n    \"result\": [\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x3c960\",\r\n                \"input\": \"0xd06ca61f000000000000000000000000000000000000000000000000000000000026a194000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000020000000000000000000000009c556b18d2370d4c44f3b3153d340d9abfd8d995000000000000000000000000695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"to\": \"0x7a250d5630b4cf539739df2c5dacb4c659f2488d\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x21a4\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000026a1940000000000000000000000000000000000000000000000000511b8f5762e6498\"\r\n            },\r\n            \"subtraces\": 1,\r\n            \"traceAddress\": [\r\n                0\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x399dd\",\r\n                \"input\": \"0x23b872dd0000000000000000000000006d36143540aab8a3472c47975877e409050122af0000000000000000000000004d264e1158dee4a4150d94ad24b6e5de768e0fa9000000000000000000000000000000000000000000000000000000000026a194\",\r\n                \"to\": \"0x9c556b18d2370d4c44f3b3153d340d9abfd8d995\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x3bce\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                1\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x35c87\",\r\n                \"input\": \"0x095ea7b30000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d000000000000000000000000000000000000000000000000000000000026a194\",\r\n                \"to\": \"0x9c556b18d2370d4c44f3b3153d340d9abfd8d995\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x6048\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                2\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x2f9c9\",\r\n                \"input\": \"0x38ed1739000000000000000000000000000000000000000000000000000000000026a194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000006d36143540aab8a3472c47975877e409050122afffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000020000000000000000000000009c556b18d2370d4c44f3b3153d340d9abfd8d995000000000000000000000000695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"to\": \"0x7a250d5630b4cf539739df2c5dacb4c659f2488d\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x104fb\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000026a1940000000000000000000000000000000000000000000000000511b8f5762e6498\"\r\n            },\r\n            \"subtraces\": 3,\r\n            \"traceAddress\": [\r\n                3\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0xd40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x26856\",\r\n                \"input\": \"0xa9059cbb0000000000000000000000006d36143540aab8a3472c47975877e409050122af0000000000000000000000000000000000000000000000000511b8f5762e6498\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x3204\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                3,\r\n                2,\r\n                0\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0xd40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x234ad\",\r\n                \"input\": \"0x70a08231000000000000000000000000d40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x233\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000008a7623b67b41c7259a\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                3,\r\n                2,\r\n                1\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x1f5b3\",\r\n                \"input\": \"0xc45a0155\",\r\n                \"to\": \"0x7a250d5630b4cf539739df2c5dacb4c659f2488d\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0xfc\",\r\n                \"output\": \"0x0000000000000000000000005c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                4\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x1e793\",\r\n                \"input\": \"0xe6a43905000000000000000000000000695364ffaa20f205e337f9e6226e5e22525838d90000000000000000000000009c556b18d2370d4c44f3b3153d340d9abfd8d995\",\r\n                \"to\": \"0x5c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0xa04\",\r\n                \"output\": \"0x000000000000000000000000d40287c99072dc26349922653fd8aa2cc2c74991\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                5\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x1dc0d\",\r\n                \"input\": \"0x0902f1ac\",\r\n                \"to\": \"0xd40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x1f8\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000008a7623b67b41c7259a000000000000000000000000000000000000000000000000000000041c2950ad00000000000000000000000000000000000000000000000000000000643f4ef8\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                6\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x1d7d2\",\r\n                \"input\": \"0x0dfe1681\",\r\n                \"to\": \"0xd40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x17d\",\r\n                \"output\": \"0x000000000000000000000000695364ffaa20f205e337f9e6226e5e22525838d9\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                7\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x1d0a3\",\r\n                \"input\": \"0x18160ddd\",\r\n                \"to\": \"0xd40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x954\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000017c88cee846eda\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                8\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x1c2c3\",\r\n                \"input\": \"0x23b872dd0000000000000000000000006d36143540aab8a3472c47975877e409050122af0000000000000000000000004d264e1158dee4a4150d94ad24b6e5de768e0fa900000000000000000000000000000000000000000000000000002250ba56c1ec\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x290e\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                9\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x19762\",\r\n                \"input\": \"0x23b872dd0000000000000000000000006d36143540aab8a3472c47975877e409050122af0000000000000000000000004d264e1158dee4a4150d94ad24b6e5de768e0fa90000000000000000000000000000000000000000000000000000000000000105\",\r\n                \"to\": \"0x9c556b18d2370d4c44f3b3153d340d9abfd8d995\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x196e\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                10\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x17b96\",\r\n                \"input\": \"0x095ea7b30000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d00000000000000000000000000000000000000000000000000002250ba56c1ec\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x6048\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                11\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0x11a08\",\r\n                \"input\": \"0x095ea7b30000000000000000000000007a250d5630b4cf539739df2c5dacb4c659f2488d0000000000000000000000000000000000000000000000000000000000000105\",\r\n                \"to\": \"0x9c556b18d2370d4c44f3b3153d340d9abfd8d995\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x5814\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                12\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0xbf0d\",\r\n                \"input\": \"0xe8e33700000000000000000000000000695364ffaa20f205e337f9e6226e5e22525838d90000000000000000000000009c556b18d2370d4c44f3b3153d340d9abfd8d99500000000000000000000000000000000000000000000000000002250ba56c1ec0000000000000000000000000000000000000000000000000000000000000105000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006d36143540aab8a3472c47975877e409050122afffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\",\r\n                \"to\": \"0x7a250d5630b4cf539739df2c5dacb4c659f2488d\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0xb5b4\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000000000002250ba56c1ec00000000000000000000000000000000000000000000000000000000000001040000000000000000000000000000000000000000000000000000000005e08b45\"\r\n            },\r\n            \"subtraces\": 5,\r\n            \"traceAddress\": [\r\n                13\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0x7a250d5630b4cf539739df2c5dacb4c659f2488d\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0xa7ea\",\r\n                \"input\": \"0x23b872dd0000000000000000000000004d264e1158dee4a4150d94ad24b6e5de768e0fa9000000000000000000000000d40287c99072dc26349922653fd8aa2cc2c7499100000000000000000000000000000000000000000000000000002250ba56c1ec\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x172f\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                13,\r\n                2\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0xd40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x62f7\",\r\n                \"input\": \"0x70a08231000000000000000000000000d40287c99072dc26349922653fd8aa2cc2c74991\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x233\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000008a7623d8cbfc1de786\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                13,\r\n                4,\r\n                0\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n        {\r\n            \"action\": {\r\n                \"from\": \"0xd11ee14805642dcb5bf840845836afe3cfc16383\",\r\n                \"callType\": \"call\",\r\n                \"gas\": \"0xa049\",\r\n                \"input\": \"0xa9059cbb0000000000000000000000003329a7092369c64e5c5f5cf9b9c808013c4dd8bb0000000000000000000000000000000000000000000000000044bd8dd64630ee\",\r\n                \"to\": \"0x695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x3204\",\r\n                \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\"\r\n            },\r\n            \"subtraces\": 0,\r\n            \"traceAddress\": [\r\n                3,\r\n                0,\r\n                0\r\n            ],\r\n            \"transactionHash\": \"0x3f1206eae5d5a276e54d14adf6b28aa24621fe2c5016fe6e2df88f1bb9527d28\",\r\n            \"transactionPosition\": 27,\r\n            \"type\": \"call\"\r\n        }\r\n    ]\r\n}\r\n````\r\n\r\nbut there are some traces are only with one of the expected fromAddress or toAddress, just like this: the toAddress is not `0x695364ffaa20f205e337f9e6226e5e22525838d9` but it was also returned\r\n````\r\n{\r\n            \"action\": {\r\n                \"from\": \"0x4d264e1158dee4a4150d94ad24b6e5de768e0fa9\",\r\n                \"callType\": \"staticcall\",\r\n                \"gas\": \"0x3c960\",\r\n                \"input\": \"0xd06ca61f000000000000000000000000000000000000000000000000000000000026a194000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000020000000000000000000000009c556b18d2370d4c44f3b3153d340d9abfd8d995000000000000000000000000695364ffaa20f205e337f9e6226e5e22525838d9\",\r\n                \"to\": \"0x7a250d5630b4cf539739df2c5dacb4c659f2488d\",\r\n                \"value\": \"0x0\"\r\n            },\r\n            \"blockHash\": \"0x186e16c125e71529db0a69f38a7169b798e075f66bf2611c03def3702075d3f6\",\r\n            \"blockNumber\": 8853291,\r\n            \"result\": {\r\n                \"gasUsed\": \"0x21a4\",\r\n                \"output\": \"0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000026a1940000000000000000000000000000000000000000000000000511b8f5762e6498\"\r\n            },\r\n            \"subtraces\": 1,\r\n            \"traceAddress\": [\r\n                0\r\n            ],\r\n            \"transactionHash\": \"0xad57ef1b7dafc47f23eaa8c5cca3fe8096a18f38fb72c6d36e12e280ea16d1dc\",\r\n            \"transactionPosition\": 26,\r\n            \"type\": \"call\"\r\n        },\r\n````\r\nIs there a special reason or consideration for returning these traces?\r\n",
  "closed_by": {
    "login": "rekyyang",
    "id": 22545420,
    "node_id": "MDQ6VXNlcjIyNTQ1NDIw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22545420?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rekyyang",
    "html_url": "https://github.com/rekyyang",
    "followers_url": "https://api.github.com/users/rekyyang/followers",
    "following_url": "https://api.github.com/users/rekyyang/following{/other_user}",
    "gists_url": "https://api.github.com/users/rekyyang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rekyyang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rekyyang/subscriptions",
    "organizations_url": "https://api.github.com/users/rekyyang/orgs",
    "repos_url": "https://api.github.com/users/rekyyang/repos",
    "events_url": "https://api.github.com/users/rekyyang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rekyyang/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514226574",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7341#issuecomment-1514226574",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341",
    "id": 1514226574,
    "node_id": "IC_kwDOC0FsAM5aQUOO",
    "user": {
      "login": "rekyyang",
      "id": 22545420,
      "node_id": "MDQ6VXNlcjIyNTQ1NDIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22545420?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rekyyang",
      "html_url": "https://github.com/rekyyang",
      "followers_url": "https://api.github.com/users/rekyyang/followers",
      "following_url": "https://api.github.com/users/rekyyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/rekyyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rekyyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rekyyang/subscriptions",
      "organizations_url": "https://api.github.com/users/rekyyang/orgs",
      "repos_url": "https://api.github.com/users/rekyyang/repos",
      "events_url": "https://api.github.com/users/rekyyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rekyyang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T07:00:17Z",
    "updated_at": "2023-04-19T07:09:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "It seems that only the case of union was considered here?\r\n\r\nhttps://github.com/ledgerwatch/erigon/blob/a5b9f2d77467bdd547863122f4398e37285fdb1e/cmd/rpcdaemon/commands/trace_filtering.go#L908 \r\n\r\n````\r\nfunc filter_trace(pt *ParityTrace, fromAddresses map[common.Address]struct{}, toAddresses map[common.Address]struct{}) bool {\r\n\tswitch action := pt.Action.(type) {\r\n\tcase *CallTraceAction:\r\n\t\t_, f := fromAddresses[action.From]\r\n\t\t_, t := toAddresses[action.To]\r\n\r\n\t\tif f || t {\r\n\t\t\treturn true\r\n\t\t}\r\n\tcase *CreateTraceAction:\r\n\t\t_, f := fromAddresses[action.From]\r\n\t\tif f {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif res, ok := pt.Result.(*CreateTraceResult); ok {\r\n\t\t\tif res.Address != nil {\r\n\t\t\t\tif _, t := toAddresses[*res.Address]; t {\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\tcase *SuicideTraceAction:\r\n\t\t_, f := fromAddresses[action.Address]\r\n\t\t_, t := toAddresses[action.RefundAddress]\r\n\t\tif f || t {\r\n\t\t\treturn true\r\n\t\t}\r\n\t}\r\n\r\n\treturn false\r\n}\r\n````",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514226574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514284871",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7341#issuecomment-1514284871",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341",
    "id": 1514284871,
    "node_id": "IC_kwDOC0FsAM5aQidH",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T07:45:09Z",
    "updated_at": "2023-04-19T07:45:09Z",
    "author_association": "COLLABORATOR",
    "body": "@rekyyang i think it's a bug. and seems `filter_trace` method even doesn't receive `req.Mode` parameter",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514284871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514296917",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7341#issuecomment-1514296917",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341",
    "id": 1514296917,
    "node_id": "IC_kwDOC0FsAM5aQlZV",
    "user": {
      "login": "rekyyang",
      "id": 22545420,
      "node_id": "MDQ6VXNlcjIyNTQ1NDIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22545420?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rekyyang",
      "html_url": "https://github.com/rekyyang",
      "followers_url": "https://api.github.com/users/rekyyang/followers",
      "following_url": "https://api.github.com/users/rekyyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/rekyyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rekyyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rekyyang/subscriptions",
      "organizations_url": "https://api.github.com/users/rekyyang/orgs",
      "repos_url": "https://api.github.com/users/rekyyang/repos",
      "events_url": "https://api.github.com/users/rekyyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rekyyang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T07:55:01Z",
    "updated_at": "2023-04-19T08:08:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "@AskAlexSharov It will take effect if set it as intersection, because there are some code about the filter mode when select blocks (func traceFilterBitmapsV3 & traceFilterBitmaps)\r\n\r\nIt seems that the intersection strategy only take effect when select blocks, but when filter traces in selected blocks, the union strategy will take effect\r\n\r\nhttps://github.com/ledgerwatch/erigon/blob/a5b9f2d77467bdd547863122f4398e37285fdb1e/cmd/rpcdaemon/commands/trace_filtering.go#L1021\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514296917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514341207",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7341#issuecomment-1514341207",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7341",
    "id": 1514341207,
    "node_id": "IC_kwDOC0FsAM5aQwNX",
    "user": {
      "login": "rekyyang",
      "id": 22545420,
      "node_id": "MDQ6VXNlcjIyNTQ1NDIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22545420?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rekyyang",
      "html_url": "https://github.com/rekyyang",
      "followers_url": "https://api.github.com/users/rekyyang/followers",
      "following_url": "https://api.github.com/users/rekyyang/following{/other_user}",
      "gists_url": "https://api.github.com/users/rekyyang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rekyyang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rekyyang/subscriptions",
      "organizations_url": "https://api.github.com/users/rekyyang/orgs",
      "repos_url": "https://api.github.com/users/rekyyang/repos",
      "events_url": "https://api.github.com/users/rekyyang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rekyyang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T08:30:36Z",
    "updated_at": "2023-04-19T08:31:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "@AskAlexSharov I create a pr [https://github.com/ledgerwatch/erigon/pull/7345](https://github.com/ledgerwatch/erigon/pull/7345)",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1514341207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
