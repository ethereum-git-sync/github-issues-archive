{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4936",
  "id": 1329139190,
  "node_id": "I_kwDOC0FsAM5POQ32",
  "number": 4936,
  "title": "eth_getLogs by address missing logs on Bor",
  "user": {
    "login": "dafky2000",
    "id": 2653187,
    "node_id": "MDQ6VXNlcjI2NTMxODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2653187?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dafky2000",
    "html_url": "https://github.com/dafky2000",
    "followers_url": "https://api.github.com/users/dafky2000/followers",
    "following_url": "https://api.github.com/users/dafky2000/following{/other_user}",
    "gists_url": "https://api.github.com/users/dafky2000/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dafky2000/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dafky2000/subscriptions",
    "organizations_url": "https://api.github.com/users/dafky2000/orgs",
    "repos_url": "https://api.github.com/users/dafky2000/repos",
    "events_url": "https://api.github.com/users/dafky2000/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dafky2000/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-08-04T20:24:20Z",
  "updated_at": "2022-08-12T13:50:35Z",
  "closed_at": "2022-08-12T13:50:35Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2022.99.99-dev-12ed5048`\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash : 41f27be1402545779a7a4d01e6bee5c5f265194e\r\n\r\n#### Expected behaviour\r\nReturn 5 matching logs\r\n\r\n#### Actual behaviour\r\nReturns empty result set\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nI'm not sure if this is specific to Bor or not but I am running bor-mainnet\r\n\r\nThe following returns a result set of 0\r\n```bash\r\ncurl -X GET -H \"Content-Type: application/json\" --data '{\"jsonrpc\": \"2.0\", \"method\": \"eth_getLogs\", \"params\": [{\"fromBlock\":\"0x1df7900\",\"toBlock\":\"0x1df7900\",\"address\":[\"0x9d305a42a3975ee4c1c57555bed5919889dce63f\"]}], \"id\":1}' 'http://localhost:8545/'\r\n```\r\n\r\nBut if I query all logs in the block without the address filter, there are 5 (valid) logs for the filtered address in txhash 0x89e754038cfcb5fb9c3686d65008e8dd4044b34bf677c27258c84bb5268fcfba \r\n\r\n```bash\r\ncurl -X GET -H \"Content-Type: application/json\" --data '{\"jsonrpc\": \"2.0\", \"method\": \"eth_getLogs\", \"params\": [{\"fromBlock\":\"0x1df7900\",\"toBlock\":\"0x1df7900\"}], \"id\":1}' 'http://localhost:8545/'\r\n```",
  "closed_by": {
    "login": "enriavil1",
    "id": 19207637,
    "node_id": "MDQ6VXNlcjE5MjA3NjM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/enriavil1",
    "html_url": "https://github.com/enriavil1",
    "followers_url": "https://api.github.com/users/enriavil1/followers",
    "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
    "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
    "organizations_url": "https://api.github.com/users/enriavil1/orgs",
    "repos_url": "https://api.github.com/users/enriavil1/repos",
    "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/enriavil1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1208303481",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4936#issuecomment-1208303481",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936",
    "id": 1208303481,
    "node_id": "IC_kwDOC0FsAM5IBT95",
    "user": {
      "login": "dafky2000",
      "id": 2653187,
      "node_id": "MDQ6VXNlcjI2NTMxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2653187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dafky2000",
      "html_url": "https://github.com/dafky2000",
      "followers_url": "https://api.github.com/users/dafky2000/followers",
      "following_url": "https://api.github.com/users/dafky2000/following{/other_user}",
      "gists_url": "https://api.github.com/users/dafky2000/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dafky2000/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dafky2000/subscriptions",
      "organizations_url": "https://api.github.com/users/dafky2000/orgs",
      "repos_url": "https://api.github.com/users/dafky2000/repos",
      "events_url": "https://api.github.com/users/dafky2000/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dafky2000/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-08T15:52:30Z",
    "updated_at": "2022-08-08T15:52:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "The block number in question does not seem to be in this list `m`:\r\n\r\nhttps://github.com/ledgerwatch/erigon/blob/0d08bd096fb78a8ba4a1788583eb011ac488c1fc/cmd/rpcdaemon/commands/eth_receipts.go#L133\r\n\r\nNot sure if intended but this also returns block numbers outside of the requested (single block) range 31422720.\r\n\r\n```\r\n29533706,29874328,29901088,29901105,29935443,29945090,30090167,30102382,30104749,30106226,30106805,30106844,30107691,30108235,30109016,30109028,30109042,30109052,30109536,30110465,30110956,30110976,30111216,30113255,30113331,30113346,30113362,30113380,30113391,30113400,30113798,30114594,30114968,30114976,30115780,30115795,30115847,30115855,30117468,30118608,30118700,30118729,30118756,30119513,30119632,30121778,30121979,30125882,30125890,30127730,30128367,30131633,30131674,30132479,30133628,30133671,30133687,30133899,30133948,30134429,30134583,30134637,30134712,30134801,30135204,30135219,30135358,30135608,30135822,30135844,30135847,30135880,30135889,30135928,30135970,30136021,30136092,30136139,30136208,30136290,30136708,30136964,30137412,30137737,30138273,30139192,30139282,30139811,30140097,30140248,30143277,30143286,30143514,30143645,30145862,30146497,30146693,30152279,30153068,30155821,30155961,30156090,30158713,30158759,30159233,30159263,30173414,30175646,30176714,30181277,30182940,30183552,30183712,30184043,30184051,30184365,30185077,30185093,30185111,30185164,30185187,30185196,30185216,30185237,30185251,30185267,30185344,30188240,30188716,30190152,30193699,30198437,30198570,30198633,30199826,30202047,30202435,30203964,30204185,30204537,30204655,30204663,30204666,30204676,30204930,30207205,30207994,30210684,30210994,30211638,30212396,30214337,30215552,30215601,30215641,30216078,30216979,30219633,30221326,30221423,30221440,30221455,30221475,30221486,30221500,30221513,30221524,30221535,30222050,30222400,30223549,30228427,30231446,30237027,30237276,30237331,30237440,30238903,30238960,30238982,30243170,30244394,30244462,30244473,30245488,30246492,30246800,30248471,30250072,30250680,30250702,30255229,30257107,30257266,30257761,30259575,30259630,30259988,30265632,30267026,30267038,30269655,30273904,30275378,30280082,30285121,30286439,30287126,30287584,30288374,30289227,30289550,30290516,30292165,30295645,30297419,30298259,30298428,30299636,30301860,30304351,30306987,30306997,30307111,30307156,30307686,30309857,30312670,30314425,30316761,30317568,30317633,30317707,30317883,30317913,30317933,30317952,30317971,30318004,30318030,30318075,30318090,30318120,30318233,30318252,30318272,30318299,30319405,30321543,30321624,30321840,30323849,30327060,30331010,30333021,30333433,30335104,30338456,30339275,30342738,30342897,30342935,30345303,30345315,30345852,30351851,30358899,30360216,30360643,30360665,30360829,30362256,30363431,30364545,30364585,30365100,30366128,30371472,30373265,30377294,30377314,30377950,30380971,30381753,30383464,30392131,30392141,30394401,30396064,30396080,30396349,30396357,30400901,30401835,30401883,30403997,30404064,30405469,30405656,30405821,30406120,30406124,30406131,30406137,30406140,30406143,30406145,30406148,30406152,30406155,30406695,30409536,30409546,30412493,30415038,30419223,30419254,30432274,30432608,30436820,30437397,30446654,30448073,30448953,30448988,30449006,30449027,30449114,30452505,30453063,30454097,30454108,30454754,30455306,30455800,30456663,30456734,30456744,30457330,30463893,30464254,30471126,30471239,30471981,30481120,30485571,30485758,30485770,30488730,30495847,30495883,30496684,30496788,30501186,30501197,30503617,30509425,30510429,30510594,30511168,30511623,30512542,30513459,30513719,30520924,30521293,30521409,30522824,30522835,30527657,30528003,30528402,30528440,30528476,30528510,30529144,30535424,30538312,30550882,30550936,30553212,30554958,30555314,30558491,30561353,30562980,30569829,30570362,30572023,30575552,30586908,30594630,30598768,30598779,30600131,30604868,30612172,30612726,30617245,30617250,30619120,30619456,30619470,30625164,30625174,30629572,30634045,30636765,30637897,30637902,30651148,30665784,30666311,30674119,30678591,30685590,30692329,30699322,30708866,30710150,30710159,30713186,30714753,30716076,30719379,30719433,30720148,30722959,30728739,30731351,30731874,30750353,30753546,30753812,30761071,30778366,30779907,30779969,30779977,30782263,30785703,30797301,30797355,30799868,30802931,30803282,30804069,30804426,30811260,30819537,30819618,30819657,30819688,30819729,30819756,30819792,30819840,30819863,30819903,30819919,30819944,30819973,30819996,30820004,30820013,30820023,30820050,30820065,30820080,30820149,30820179,30820201,30820238,30820275,30820295,30820313,30820336,30820380,30820395,30820410,30820423,30820441,30820461,30820482,30820533,30820600,30824494,30830879,30835180,30838372,30841444,30844444,30857318,30860184,30860455,30865525,30865539,30873874,30874655,30877883,30881737,30881770,30881788,30881824,30881838,30881851,30881859,30881870,30881879,30881890,30881899,30883488,30884731,30893294,30894158,30898510,30899897,30916527,30918288,30918385,30920330,30922318,30922788,30923512,30934052,30934107,30934411,30936758,30941079,30942856,30957506,30960755,30967431,30967705,30969449,30972216,30973353,30973424,30977066,30977233,30980905,30982082,30983419,30992362,30992598,30994856,31000382,31000814,31006462,31007405,31007450,31007454,31008612,31011106,31014663,31034919,31035285,31035945,31035968,31038653,31039119,31040619,31041156,31046734,31047549,31048093,31053340,31059096,31059761,31067843,31068515,31079387,31081827,31090258,31091735,31095088,31129067,31131103,31137801,31137993,31142550,31147590,31152702,31152721,31153321,31153352,31153544,31153716,31153829,31153970,31153997,31154012,31154194,31154251,31156178,31157170,31159055,31167334,31167397,31167422,31167504,31167536,31167563,31167580,31167597,31167610,31167634,31167670,31167713,31167737,31167761,31167853,31167901,31167931,31167957,31167982,31168011,31168023,31168035,31168052,31168063,31168107,31168167,31168192,31168221,31168234,31168246,31168283,31168312,31168338,31168367,31168402,31168449,31168481,31168558,31168596,31168622,31168656,31168681,31168706,31168751,31168771,31168794,31169003,31174588,31177097,31178423,31179190,31179981,31180033,31182273,31186589,31189341,31192880,31192896,31196672,31196803,31199367,31200559,31200574,31200643,31200657,31200706,31200718,31200741,31200760,31201007,31201038,31202149,31202159,31202295,31202325,31203268,31203424,31210272,31211065,31211754,31211950,31214910,31214915,31217640,31220374,31221587,31223414,31225874,31231099,31265721,31267251,31269220,31279415,31281919,31286970,31293232,31295317,31310722,31310812,31319147,31321704,31332039,31332809,31341396,31350941,31357364,31357968,31358577,31360383,31362574,31362722,31369098,31372115,31386895,31394172,31408814,31413514,31417858,31420951,31443970,31446528,31454036,31456576,31458882,31460808,31461436,31462405,31464456,31464620,31464740,31464745,31464781,31464786,31465101,31465129,31465146,31466609,31472386,31473466,31473891,31473915,31474070,31475562,31482499,31494266,31496355,31497091,31499522,31504904,31506583,31508052,31510143,31512365,31512754,31523002,31530486,31531117,31537738,31546036,31546053,31546072,31546501,31546506,31551899,31552606,31567281,31573311,31578507,31581063,31582101,31587229,31588947,31591003,31606606,31616703,31628170,31629411,31629651,31631112,31631992,31635029,31638126,31659680,31663129\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1208303481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1208310733",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4936#issuecomment-1208310733",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936",
    "id": 1208310733,
    "node_id": "IC_kwDOC0FsAM5IBVvN",
    "user": {
      "login": "dafky2000",
      "id": 2653187,
      "node_id": "MDQ6VXNlcjI2NTMxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2653187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dafky2000",
      "html_url": "https://github.com/dafky2000",
      "followers_url": "https://api.github.com/users/dafky2000/followers",
      "following_url": "https://api.github.com/users/dafky2000/following{/other_user}",
      "gists_url": "https://api.github.com/users/dafky2000/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dafky2000/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dafky2000/subscriptions",
      "organizations_url": "https://api.github.com/users/dafky2000/orgs",
      "repos_url": "https://api.github.com/users/dafky2000/repos",
      "events_url": "https://api.github.com/users/dafky2000/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dafky2000/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-08T15:58:49Z",
    "updated_at": "2022-08-08T16:06:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "And, I have reset and rebuilt the `stage_log_index` stage to rule out any corruption. That's completed since reporting this issue but, hope it helps!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1208310733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1209941718",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4936#issuecomment-1209941718",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4936",
    "id": 1209941718,
    "node_id": "IC_kwDOC0FsAM5IHj7W",
    "user": {
      "login": "dafky2000",
      "id": 2653187,
      "node_id": "MDQ6VXNlcjI2NTMxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2653187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dafky2000",
      "html_url": "https://github.com/dafky2000",
      "followers_url": "https://api.github.com/users/dafky2000/followers",
      "following_url": "https://api.github.com/users/dafky2000/following{/other_user}",
      "gists_url": "https://api.github.com/users/dafky2000/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dafky2000/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dafky2000/subscriptions",
      "organizations_url": "https://api.github.com/users/dafky2000/orgs",
      "repos_url": "https://api.github.com/users/dafky2000/repos",
      "events_url": "https://api.github.com/users/dafky2000/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dafky2000/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-09T22:09:14Z",
    "updated_at": "2022-08-09T22:19:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Narrowed this down the LogAddressIndex (and LogTopicsIndex) missing block numbers for logs from Polygon's \"State Sync\" transactions - StateSync Logs are never written to the `kv.Logs` table which in-turn never populates the LogAddressIndex and LogTopicsIndex. \r\n\r\nI'm unsure about the \"correct\" approach, whether to \r\n\r\n- insert these into the existing `kv.Logs` table (within WriteBorReceipt).\r\n- or, create a new `kv.BorLogs` table (similarly to BorReceipts),\r\n\r\nThe second creates more work when reading this data but is consistent with the existing separation of the BorReceipts table. There may be other side effects I'm unaware of, I don't understand why these would be separated to begin with.\r\n\r\nRequesting feedback :)\r\n\r\nIn the meantime, I've pushed [hack-bor-log-filters](/dafky2000/erigon/tree/hack-bor-log-filters) (800a43ca5c86bbc023bda5f25671346b18fee1ae) which runs `ReadBorReceipt` for each block and adds the appropriate block numbers so they can be processed as usual.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1209941718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
