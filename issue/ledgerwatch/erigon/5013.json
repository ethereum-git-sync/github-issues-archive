{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5013",
  "id": 1336299528,
  "node_id": "I_kwDOC0FsAM5PplAI",
  "number": 5013,
  "title": "Occasional memory reference errors while handling GET_BLOCK_HEADERS_66 in latest alpha/devel branches",
  "user": {
    "login": "mconover",
    "id": 3443348,
    "node_id": "MDQ6VXNlcjM0NDMzNDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3443348?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mconover",
    "html_url": "https://github.com/mconover",
    "followers_url": "https://api.github.com/users/mconover/followers",
    "following_url": "https://api.github.com/users/mconover/following{/other_user}",
    "gists_url": "https://api.github.com/users/mconover/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mconover/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mconover/subscriptions",
    "organizations_url": "https://api.github.com/users/mconover/orgs",
    "repos_url": "https://api.github.com/users/mconover/repos",
    "events_url": "https://api.github.com/users/mconover/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mconover/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-11T18:02:15Z",
  "updated_at": "2022-10-08T03:19:53Z",
  "closed_at": "2022-10-08T03:19:53Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `./erigon --version`\r\nerigon.exe version 2022.08.1-alpha-7dabdc32\r\n(tag v2022.08.01 latest alpha branch)\r\n\r\nOS & Version: Windows/Linux/OSX\r\nWindows 11\r\n\r\nCommit hash : \r\n7dabdc3269f1e3b098fee5ab4d96ec843823a6fd\r\n\r\n#### Expected behaviour\r\nHandle GET_BLOCK_HEADERS_66 messages in RecvUploadHeadersMessage without invalid memory references\r\n\r\n#### Actual behaviour\r\n\r\nI reproduced this behavior with both the latest alpha branch and latest devel branch, so it isn't specific to alpha branch. I get this occasionally (it's happened on multiple occasions over several days, but not on every block... it seems to happen a few times per day)\r\n\r\nINFO[08-11|10:47:35.303] [6/16 Execution] Executed blocks         number=11250271 blk/s=9.1 tx/s=1743.3 Mgas/s=111.2 gasState=0.47 batch=722.6MB alloc=4.8GB sys=9.8GB\r\nWARN[08-11|10:47:42.480] Handling incoming message                stream=RecvUploadHeadersMessage err=\"runtime error: invalid memory address or nil pointer dereference, msgID=GET_BLOCK_HEADERS_66, trace: [sentry_multi_client.go:638 panic.go:838 panic.go:220 signal_windows.go:255 decompress.go:324 decompress.go:405 block_reader.go:504 block_reader.go:242 block_snapshots.go:271 block_snapshots.go:717 block_reader.go:241 handlers.go:68 sentry_multi_client.go:521 kv_mdbx.go:669 sentry_multi_client.go:520 sentry_multi_client.go:671 sentry_multi_client.go:642 sentry_multi_client.go:211 asm_amd64.s:1571]\"\r\nWARN[08-11|10:47:59.711] Handling incoming message                stream=RecvUploadHeadersMessage err=\"runtime error: invalid memory address or nil pointer dereference, msgID=GET_BLOCK_HEADERS_66, trace: [sentry_multi_client.go:638 panic.go:838 panic.go:220 signal_windows.go:255 decompress.go:324 decompress.go:405 block_reader.go:504 block_reader.go:242 block_snapshots.go:271 block_snapshots.go:717 block_reader.go:241 handlers.go:68 sentry_multi_client.go:521 kv_mdbx.go:669 sentry_multi_client.go:520 sentry_multi_client.go:671 sentry_multi_client.go:642 sentry_multi_client.go:211 asm_amd64.s:1571]\"\r\nINFO[08-11|10:48:05.543] [txpool] stat                            block=15311269 pending=9990 baseFee=28337 queued=30000 alloc=5.5GB sys=9.8GB\r\nINFO[08-11|10:48:09.665] [6/16 Execution] Executed blocks         number=11250459 blk/s=5.5 tx/s=1011.6 Mgas/s=66.6 gasState=0.48 batch=729.1MB alloc=5.5GB sys=9.8GB\r\nINFO[08-11|10:48:15.333] [6/16 Execution] Executed blocks         number=11250511 blk/s=9.2 tx/s=1827.0 Mgas/s=110.0 gasState=0.48 batch=730.9MB alloc=5.7GB sys=9.8GB\r\nWARN[08-11|10:48:21.361] Handling incoming message                stream=RecvUploadHeadersMessage err=\"runtime error: invalid memory address or nil pointer dereference, msgID=GET_BLOCK_HEADERS_66, trace: [sentry_multi_client.go:638 panic.go:838 panic.go:220 signal_windows.go:255 decompress.go:324 decompress.go:405 block_reader.go:504 block_reader.go:242 block_snapshots.go:271 block_snapshots.go:717 block_reader.go:241 handlers.go:68 sentry_multi_client.go:521 kv_mdbx.go:669 sentry_multi_client.go:520 sentry_multi_client.go:671 sentry_multi_client.go:642 sentry_multi_client.go:211 asm_amd64.s:1571]\"\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nI was syncing the full history.\r\n\r\n\r\n#### Backtrace\r\n[sentry_multi_client.go:638 panic.go:838 panic.go:220 signal_windows.go:255 decompress.go:324 decompress.go:405 block_reader.go:504 block_reader.go:242 block_snapshots.go:271 block_snapshots.go:717 block_reader.go:241 handlers.go:68 sentry_multi_client.go:521 kv_mdbx.go:669 sentry_multi_client.go:520 sentry_multi_client.go:671 sentry_multi_client.go:642 sentry_multi_client.go:211 asm_amd64.s:1571]\"\r\n````\r\n",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1212747788",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5013#issuecomment-1212747788",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013",
    "id": 1212747788,
    "node_id": "IC_kwDOC0FsAM5ISRAM",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-12T05:38:55Z",
    "updated_at": "2022-08-12T05:38:55Z",
    "author_association": "COLLABORATOR",
    "body": "Let'd do next way:\r\n1. start erigon with flag --downloader.verify, wait of verification complete\r\n2. then run `./build/bin/erigon snapshots index --rebuild --datadir=<your_datadir> --chain=<your_chain>`\r\n3. then start erigon as usually\r\n\r\nAnd also I will try to add more context info to such errors. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1212747788/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1212761891",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5013#issuecomment-1212761891",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013",
    "id": 1212761891,
    "node_id": "IC_kwDOC0FsAM5ISUcj",
    "user": {
      "login": "mconover",
      "id": 3443348,
      "node_id": "MDQ6VXNlcjM0NDMzNDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3443348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mconover",
      "html_url": "https://github.com/mconover",
      "followers_url": "https://api.github.com/users/mconover/followers",
      "following_url": "https://api.github.com/users/mconover/following{/other_user}",
      "gists_url": "https://api.github.com/users/mconover/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mconover/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mconover/subscriptions",
      "organizations_url": "https://api.github.com/users/mconover/orgs",
      "repos_url": "https://api.github.com/users/mconover/repos",
      "events_url": "https://api.github.com/users/mconover/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mconover/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-12T06:09:21Z",
    "updated_at": "2022-08-12T06:09:21Z",
    "author_association": "NONE",
    "body": "I'll give that a try and follow up. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1212761891/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1219536135",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5013#issuecomment-1219536135",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013",
    "id": 1219536135,
    "node_id": "IC_kwDOC0FsAM5IsKUH",
    "user": {
      "login": "algtm",
      "id": 22735155,
      "node_id": "MDQ6VXNlcjIyNzM1MTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/22735155?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/algtm",
      "html_url": "https://github.com/algtm",
      "followers_url": "https://api.github.com/users/algtm/followers",
      "following_url": "https://api.github.com/users/algtm/following{/other_user}",
      "gists_url": "https://api.github.com/users/algtm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/algtm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/algtm/subscriptions",
      "organizations_url": "https://api.github.com/users/algtm/orgs",
      "repos_url": "https://api.github.com/users/algtm/repos",
      "events_url": "https://api.github.com/users/algtm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/algtm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-18T14:04:53Z",
    "updated_at": "2022-08-18T14:04:53Z",
    "author_association": "NONE",
    "body": "I build two Linux machines to sync mainnet with the same cmd, and they both panic with the exact same error,and I just restart and it continues to work",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1219536135/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1260356971",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5013#issuecomment-1260356971",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013",
    "id": 1260356971,
    "node_id": "IC_kwDOC0FsAM5LH4Vr",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-09-28T04:04:14Z",
    "updated_at": "2022-09-28T04:04:14Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1260356971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1272211490",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5013#issuecomment-1272211490",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5013",
    "id": 1272211490,
    "node_id": "IC_kwDOC0FsAM5L1Ggi",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2022-10-08T03:19:53Z",
    "updated_at": "2022-10-08T03:19:53Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1272211490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
