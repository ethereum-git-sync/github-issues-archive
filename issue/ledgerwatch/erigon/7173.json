{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7173",
  "id": 1638493383,
  "node_id": "I_kwDOC0FsAM5hqWzH",
  "number": 7173,
  "title": "Fork Choice Option",
  "user": {
    "login": "keithchew",
    "id": 5557929,
    "node_id": "MDQ6VXNlcjU1NTc5Mjk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5557929?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/keithchew",
    "html_url": "https://github.com/keithchew",
    "followers_url": "https://api.github.com/users/keithchew/followers",
    "following_url": "https://api.github.com/users/keithchew/following{/other_user}",
    "gists_url": "https://api.github.com/users/keithchew/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/keithchew/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/keithchew/subscriptions",
    "organizations_url": "https://api.github.com/users/keithchew/orgs",
    "repos_url": "https://api.github.com/users/keithchew/repos",
    "events_url": "https://api.github.com/users/keithchew/events{/privacy}",
    "received_events_url": "https://api.github.com/users/keithchew/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-03-23T23:41:01Z",
  "updated_at": "2023-05-16T02:23:46Z",
  "closed_at": "2023-05-16T02:23:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi\r\n\r\nJust a question, when Erigon is sync'ed, it works beautifully, handling each new block as it comes in. But when it is slightly behind, I can see it does a batch of blocks to catch up with the latest (logs below, after block 16893073, it has to get blocks 16893074 to 16893079 to catch up). Is there an option for us to configure Erigon, so that it continues getting 1 block at a time, and only grab a batch if it is behind by a certain value, eg 100. The reason for this is: to fetch 5 blocks 16893074 to 16893079 individually might be the most efficient way from Erigon's point of view, but from the API client's point of view, it can be snappier if it can be process each block as they come in (and notify the UI) instead of waiting for the 5 blocks to finish.\r\n\r\nIf this option is remotely possible, if you can guide me to which source file I can look at, that'll be awesome.\r\n\r\n```\r\n[INFO] [03-24|11:01:18.955] [LightClient] P2P                        peers=6\r\n[INFO] [03-24|11:01:24.865] [2/15 Headers] Handling new payload      height=16893072 hash=0x4a43ecf171dec1f8fe268f6981c5c7668df65ab4a3f5896c1003f18378123c38\r\n[INFO] [03-24|11:01:26.572] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-24|11:01:27.072] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload) \r\n[INFO] [03-24|11:01:28.229] Commit cycle                             in=35.619304ms\r\n[INFO] [03-24|11:01:28.230] Timings (slower than 50ms)               Headers=671ms CallTraces=249ms AccountHistoryIndex=74ms StorageHistoryIndex=499ms LogIndex=91ms\r\n[INFO] [03-24|11:01:28.230] Tables                                   PlainState=88.0GB AccountChangeSet=184.9GB StorageChangeSet=282.1GB BlockTransaction=9.9GB TransactionLog=548.4GB FreeList=592.0MB ReclaimableSpace=592.0GB\r\n[INFO] [03-24|11:01:44.380] [p2p] GoodPeers                          eth67=92 eth66=8 eth68=96[INFO] [03-24|11:01:49.464] [2/15 Headers] Handling new payload      height=16893074 hash=0x0fd11c59aa4e07cb69f2e3e9532bff860a22942fa98480b0303d67c1b78995d8\r\n[INFO] [03-24|11:01:50.248] [2/15 Headers] Waiting for Consensus Layer...\r\n[INFO] [03-24|11:01:50.748] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\n[INFO] [03-24|11:01:51.568] Commit cycle                             in=32.860362ms\r\n[INFO] [03-24|11:01:51.568] Timings (slower than 50ms)               Headers=721ms CallTraces=106ms AccountHistoryIndex=73ms StorageHistoryIndex=149ms LogIndex=200ms\r\n[INFO] [03-24|11:01:51.569] Tables                                   PlainState=88.0GB AccountChangeSet=184.9GB StorageChangeSet=282.1GB BlockTransaction=9.9GB TransactionLog=548.4GB FreeList=592.0MB ReclaimableSpace=592.0GB\r\n[INFO] [03-24|11:01:51.569] RPC Daemon notified of new headers       from=16893073 to=16893074 hash=0x0fd11c59aa4e07cb69f2e3e9532bff860a22942fa98480b0303d67c1b78995d8 header sending=20.041µs log sending=248ns\r\n[INFO] [03-24|11:01:51.819] [2/15 Headers] Waiting for Consensus Layer...[INFO] [03-24|11:02:17.223] [txpool] stat                            pending=1068 baseFee=1394 queued=4961 alloc=4.3GB sys=6.0GB\r\n[INFO] [03-24|11:02:17.224] [LightClient] P2P                        peers=3\r\n[INFO] [03-24|11:02:49.404] [2/15 Headers] Handling new payload      height=16893079 hash=0x0b462a3385a2f9008fb5c6caae83d723fa7944cf6ee4090b6e566440b47ee433\r\n[INFO] [03-24|11:02:49.405] [2/15 Headers] Downloading PoS headers... height=16893078 hash=0x064ee8fdca0789a338e57fc7f7158e4b9586c5416f136823f4419c18cae07f56 requestId=1250\r\n[INFO] [03-24|11:02:49.980] PoS headers verified and saved           requestId=1250 fork head=0x35468accf7ffb7e8799b38834206df441b8566ed6529917be9cd899592419908\r\n[INFO] [03-24|11:02:49.983] [2/15 Headers] Waiting for Consensus Layer...\r\n[INFO] [03-24|11:02:49.983] [2/15 Headers] Handling new payload      height=16893079 hash=0x0b462a3385a2f9008fb5c6caae83d723fa7944cf6ee4090b6e566440b47ee433\r\n[INFO] [03-24|11:02:49.986] [2/15 Headers] Waiting for Consensus Layer...\r\n[INFO] [03-24|11:02:50.007] [2/15 Headers] Fork choice: chain extension from=16893074 to=16893079[INFO] [03-24|11:02:54.175] [7/15 Execution] Completed on            block=16893079\r\n[INFO] [03-24|11:03:06.874] Commit cycle                             in=185.586306ms\r\n[INFO] [03-24|11:03:06.874] Timings (slower than 50ms)               Bodies=716ms Senders=64ms Execution=3.388s HashState=5.457s IntermediateHashes=3.372s CallTraces=893ms AccountHistoryIndex=859ms StorageHistoryIndex=805ms LogIndex=905ms TxLookup=218ms\r\n[INFO] [03-24|11:03:06.874] Tables                                   PlainState=88.0GB AccountChangeSet=184.9GB StorageChangeSet=282.1GB BlockTransaction=9.9GB TransactionLog=548.4GB FreeList=592.0MB ReclaimableSpace=592.0GB\r\n[INFO] [03-24|11:03:06.874] RPC Daemon notified of new headers       from=16893074 to=16893079 hash=0x0b462a3385a2f9008fb5c6caae83d723fa7944cf6ee4090b6e566440b47ee433 header sending=18.303µs log sending=256ns\r\n```",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1488734665",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7173#issuecomment-1488734665",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173",
    "id": 1488734665,
    "node_id": "IC_kwDOC0FsAM5YvEnJ",
    "user": {
      "login": "ybstaked",
      "id": 85460995,
      "node_id": "MDQ6VXNlcjg1NDYwOTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85460995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ybstaked",
      "html_url": "https://github.com/ybstaked",
      "followers_url": "https://api.github.com/users/ybstaked/followers",
      "following_url": "https://api.github.com/users/ybstaked/following{/other_user}",
      "gists_url": "https://api.github.com/users/ybstaked/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ybstaked/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ybstaked/subscriptions",
      "organizations_url": "https://api.github.com/users/ybstaked/orgs",
      "repos_url": "https://api.github.com/users/ybstaked/repos",
      "events_url": "https://api.github.com/users/ybstaked/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ybstaked/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T14:28:32Z",
    "updated_at": "2023-03-29T14:28:32Z",
    "author_association": "NONE",
    "body": "I'm still seeing same issue even with `git_branch=HEAD git_tag=v2.42.0-dirty git_commit=beb97784d43ece5acde365a74efe8763692ebdba`\r\n\r\n```\r\n[INFO] [03-29|14:23:52.550] [2/15 Headers] Waiting for Consensus Layer...\r\n[INFO] [03-29|14:24:01.019] [2/15 Headers] Handling new payload      height=16933519 hash=0xc3e8476632bbb842e1e781e2c5823ca41ba18ec31ac977fb5f5c60368459bd92\r\n[INFO] [03-29|14:24:01.766] [2/15 Headers] Waiting for Consensus Layer...\r\n[INFO] [03-29|14:24:02.266] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\n[INFO] [03-29|14:24:02.921] Commit cycle                             in=56.565277ms\r\n[INFO] [03-29|14:24:02.921] Timings (slower than 50ms)               Headers=566ms CallTraces=121ms AccountHistoryIndex=86ms StorageHistoryIndex=142ms LogIndex=84ms TxLookup=97ms\r\n[INFO] [03-29|14:24:02.921] Tables                                   PlainState=88.8GB AccountChangeSet=185.6GB StorageChangeSet=283.3GB BlockTransaction=10.8GB TransactionLog=551.7GB FreeList=143.1MB ReclaimableSpace=143.1GB\r\n[INFO] [03-29|14:24:02.921] RPC Daemon notified of new headers       from=16933518 to=16933519 hash=0xc3e8476632bbb842e1e781e2c5823ca41ba18ec31ac977fb5f5c60368459bd92 header sending=12.998µs log sending=211ns\r\n[INFO] [03-29|14:24:04.893] [2/15 Headers] Waiting for Consensus Layer...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1488734665/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1539296237",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7173#issuecomment-1539296237",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173",
    "id": 1539296237,
    "node_id": "IC_kwDOC0FsAM5bv8vt",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-05-09T02:22:27Z",
    "updated_at": "2023-05-09T02:22:27Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1539296237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1548873890",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7173#issuecomment-1548873890",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7173",
    "id": 1548873890,
    "node_id": "IC_kwDOC0FsAM5cUfCi",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-05-16T02:23:45Z",
    "updated_at": "2023-05-16T02:23:45Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1548873890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
