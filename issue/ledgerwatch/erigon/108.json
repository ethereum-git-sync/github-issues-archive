{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/108",
  "id": 503002692,
  "node_id": "MDU6SXNzdWU1MDMwMDI2OTI=",
  "number": 108,
  "title": "Crash during sync in the trie cleaning",
  "user": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-10-05T19:04:38Z",
  "updated_at": "2019-10-21T13:48:25Z",
  "closed_at": "2019-10-21T13:48:25Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### Backtrace\r\n\r\n````\r\nINFO [10-04|12:27:59.317] Memory                                   nodes=4999974 alloc=14091714 sys=25457625 numGC=287\r\nINFO [10-04|12:27:59.317] Database                                 size=142020145152 written=570843137\r\nINFO [10-04|12:27:59.358] Imported new chain segment               blocks=31  txs=3409  mgas=173.164  elapsed=11.556s   mgasps=14.984  number=5104347 hash=c38607…61a26\r\n7 batch=584    age=1y7mo3w\r\nINFO [10-04|12:28:07.370] Imported new chain segment               blocks=130 txs=14839 mgas=804.555  elapsed=8.011s    mgasps=100.422 number=5104477 hash=224281…77f2a\r\n1 batch=84155  age=1y7mo3w\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x8c090e]\r\ngoroutine 53760 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*hasher).hashInternal(0xc2dbe44000, 0x0, 0x0, 0xc0f6d65e00, 0xc07a77fd60, 0x20, 0x20, 0x0, 0x45e491)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/hasher.go:80 +0x8e\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*hasher).hash(...)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/hasher.go:69\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*Trie).unload(0xc000ec5480, 0xc28b06e400, 0x40, 0x40, 0xc2dbe44000)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie.go:1255 +0x4bd\r\ngithub.com/ledgerwatch/turbo-geth/trie.pruneMap(0xc000ec5480, 0xc227afef70, 0xc2dbe44000, 0x41)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:160 +0x232\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*TriePruning).PruneToTimestamp(0xc000554c60, 0xc000ec5480, 0x4d1fcc)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:189 +0x266\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*TriePruning).PruneTo(0xc000554c60, 0xc000ec5480, 0x4c4b40, 0x1)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:216 +0xbf\r\ngithub.com/ledgerwatch/turbo-geth/core/state.(*TrieDbState).PruneTries(0xc0000e2a10, 0x216e7000)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/core/state/database.go:1043 +0x80\r\ngithub.com/ledgerwatch/turbo-geth/core.(*BlockChain).insertChain(0xc000170400, 0x1303da0, 0xc187943740, 0xc540418000, 0xb79, 0xb79, 0x1, 0x0, 0x0, 0x0, ...)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/core/blockchain.go:1360 +0x25c0\r\ngithub.com/ledgerwatch/turbo-geth/core.(*BlockChain).InsertChain(0xc000170400, 0xc540418000, 0xb79, 0xb79, 0x2065648, 0x0, 0x0)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/core/blockchain.go:1068 +0xe04\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).importBlockResults(0xc00025a6e0, 0xc53ff4e000, 0xb79, 0xb79, 0xb79, 0x0)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:1471 +0x538\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).processFullSyncContent(0xc00025a6e0, 0xc0001086c0, 0xc0ecee5798)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:1445 +0x79\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).spawnSync.func1(0xc00025a6e0, 0xc244e00d20, 0xc43c514a10)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:478 +0x59\r\ncreated by github.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).spawnSync\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:478 +0xaf\r\n(END)\r\n````\r\n",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/541782251",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/108#issuecomment-541782251",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108",
    "id": 541782251,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MTc4MjI1MQ==",
    "user": {
      "login": "b00ris",
      "id": 4943570,
      "node_id": "MDQ6VXNlcjQ5NDM1NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4943570?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/b00ris",
      "html_url": "https://github.com/b00ris",
      "followers_url": "https://api.github.com/users/b00ris/followers",
      "following_url": "https://api.github.com/users/b00ris/following{/other_user}",
      "gists_url": "https://api.github.com/users/b00ris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/b00ris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/b00ris/subscriptions",
      "organizations_url": "https://api.github.com/users/b00ris/orgs",
      "repos_url": "https://api.github.com/users/b00ris/repos",
      "events_url": "https://api.github.com/users/b00ris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/b00ris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-14T16:32:23Z",
    "updated_at": "2019-10-14T16:32:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "```INFO [10-14|19:15:03.019] Imported new chain segment               blocks=439  txs=1056  mgas=1654.054 elapsed=11.954s   mgasps=138.362  number=888308 hash=f2746b…e8ab51 batch=16     age=2y5mo2w\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x44b281e]\r\n\r\ngoroutine 828 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*hasher).hashInternal(0xc000598000, 0x0, 0x0, 0xc0fb81fc00, 0xc100e5aea0, 0x20, 0x20, 0x0, 0x404ae31)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/trie/hasher.go:80 +0x8e\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*hasher).hash(...)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/trie/hasher.go:69\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*Trie).unload(0xc0007ff520, 0xc06a6c2140, 0x40, 0x40, 0xc000598000)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/trie/trie.go:1255 +0x4bd\r\ngithub.com/ledgerwatch/turbo-geth/trie.pruneMap(0xc0007ff520, 0xc0d03b2f70, 0xc000598000, 0x42)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:160 +0x232\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*TriePruning).PruneToTimestamp(0xc0008994a0, 0xc0007ff520, 0x92384)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:189 +0x266\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*TriePruning).PruneTo(0xc0008994a0, 0xc0007ff520, 0x100000, 0x1)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:216 +0xbf\r\ngithub.com/ledgerwatch/turbo-geth/core/state.(*TrieDbState).PruneTries(0xc0002542a0, 0x14d90000)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/core/state/database.go:1040 +0x80\r\ngithub.com/ledgerwatch/turbo-geth/core.(*BlockChain).insertChain(0xc00018b000, 0x4f3a9e0, 0xc03a973770, 0xc019d16000, 0x2000, 0x2000, 0x1, 0x0, 0x0, 0x0, ...)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/core/blockchain.go:1382 +0x25c0\r\ngithub.com/ledgerwatch/turbo-geth/core.(*BlockChain).InsertChain(0xc00018b000, 0xc019d16000, 0x2000, 0x2000, 0x5a93230, 0x0, 0x0)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/core/blockchain.go:1090 +0xe04\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).importBlockResults(0xc0002086e0, 0xc019b86000, 0x2000, 0x2000, 0x2000, 0x0)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:1471 +0x538\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).processFullSyncContent(0xc0002086e0, 0x4f1a740, 0xc000056798)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:1445 +0x79\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).spawnSync.func1(0xc0002086e0, 0xc0009e02a0, 0xc000140130)\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:478 +0x59\r\ncreated by github.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).spawnSync\r\n        /Users/boris/go/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:478 +0xaf\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/541782251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/542139926",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/108#issuecomment-542139926",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/108",
    "id": 542139926,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjEzOTkyNg==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T10:08:29Z",
    "updated_at": "2019-10-15T10:08:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "With a bit more diagnostics\r\n```\r\nINFO [10-15|10:25:49.588] Imported new chain segment               blocks=306  txs=439   mgas=1108.633 elapsed=10.217s   mgasps=108.507 number=888386 hash=0f0cef…71166a batch=447    age=2y5mo2w\r\nINFO [10-15|10:25:58.123] Memory                                   nodes=1047500 alloc=4296647 sys=7115180 numGC=711\r\nINFO [10-15|10:25:58.123] Database                                 size=7033360384 written=368263169\r\nINFO [10-15|10:25:58.127] Imported new chain segment               blocks=288  txs=411   mgas=1098.381 elapsed=8.539s    mgasps=128.625 number=888674 hash=084831…7bf6e0 batch=24     age=2y5mo2w\r\nnd == nil, hex 01080b0208090903060a000807040c0c0c0e0e06050701020c08080c0d0a0a000a0300050b0000040d030f0d0a020904020b020b020d0c05040f01040f060101, parent node: *trie.accountNode\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x44d095e]\r\n\r\ngoroutine 50585 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*hasher).hashInternal(0xc064d94000, 0x0, 0x0, 0x0, 0xc0fb1be9e0, 0x20, 0x20, 0x0, 0x0)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/hasher.go:80 +0x8e\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*hasher).hash(...)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/hasher.go:69\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*Trie).unload(0xc000afa4c0, 0xc04ee3e8c0, 0x40, 0x40, 0xc064d94000)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie.go:1148 +0x4c8\r\ngithub.com/ledgerwatch/turbo-geth/trie.pruneMap(0xc000afa4c0, 0xc17530afa8, 0xc064d94000, 0x44)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:149 +0x216\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*TriePruning).PruneToTimestamp(0xc0001bd590, 0xc000afa4c0, 0x92574)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:176 +0x260\r\ngithub.com/ledgerwatch/turbo-geth/trie.(*TriePruning).PruneTo(0xc0001bd590, 0xc000afa4c0, 0x100000, 0x0)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/trie/trie_pruning.go:201 +0xbf\r\ngithub.com/ledgerwatch/turbo-geth/core/state.(*TrieDbState).PruneTries(0xc000510000, 0x16003000)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/core/state/database.go:1068 +0x80\r\ngithub.com/ledgerwatch/turbo-geth/core.(*BlockChain).insertChain(0xc0000a9c00, 0x4f48f60, 0xc075558b10, 0xc0c9aac000, 0x2000, 0x2000, 0x1, 0x0, 0x0, 0x0, ...)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/core/blockchain.go:1382 +0x254f\r\ngithub.com/ledgerwatch/turbo-geth/core.(*BlockChain).InsertChain(0xc0000a9c00, 0xc0c9aac000, 0x2000, 0x2000, 0x5a12f70, 0x0, 0x0)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/core/blockchain.go:1090 +0xd87\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).importBlockResults(0xc000208420, 0xc0c98ca000, 0x2000, 0x2000, 0x2000, 0x0)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:1471 +0x534\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).processFullSyncContent(0xc000208420, 0x14056af8274c47a0, 0x74aa9d68c845e9a0)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:1445 +0x79\r\ngithub.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).spawnSync.func1(0xc000208420, 0xc1049179e0, 0xc1048e2100)\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:478 +0x63\r\ncreated by github.com/ledgerwatch/turbo-geth/eth/downloader.(*Downloader).spawnSync\r\n\t/Users/alexeyakhunov/workspace/src/github.com/ledgerwatch/turbo-geth/eth/downloader/downloader.go:478 +0xaf\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/542139926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
