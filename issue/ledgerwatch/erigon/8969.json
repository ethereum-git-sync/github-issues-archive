{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8969",
  "id": 2038845424,
  "node_id": "I_kwDOC0FsAM55hk_w",
  "number": 8969,
  "title": "Polygon archive node  MDBX_MAP_FULL: Environment mapsize limit reached",
  "user": {
    "login": "zhy827827",
    "id": 15209848,
    "node_id": "MDQ6VXNlcjE1MjA5ODQ4",
    "avatar_url": "https://avatars.githubusercontent.com/u/15209848?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhy827827",
    "html_url": "https://github.com/zhy827827",
    "followers_url": "https://api.github.com/users/zhy827827/followers",
    "following_url": "https://api.github.com/users/zhy827827/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhy827827/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhy827827/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhy827827/subscriptions",
    "organizations_url": "https://api.github.com/users/zhy827827/orgs",
    "repos_url": "https://api.github.com/users/zhy827827/repos",
    "events_url": "https://api.github.com/users/zhy827827/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhy827827/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5877848882,
      "node_id": "LA_kwDOC0FsAM8AAAABXljbMg",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/polygon",
      "name": "polygon",
      "color": "0B1179",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-12-13T02:34:00Z",
  "updated_at": "2024-01-08T15:03:59Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon v2.55.1`\r\n\r\nOS & Version: Ubuntu22.02\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):\r\n\r\n/home/ubuntu/erigon/build/bin/erigon --datadir=/opt/polygondata --chain=bor-mainnet  --bor.heimdall=http://*.*.1.12:1317 --db.pagesize=16k   --maxpeers=1000 --db.size.limit=10T --no-downloader  --torrent.download.rate=500MB --torrent.upload.rate=10mb --private.api.addr=0.0.0.0:9090 --http.api eth,erigon,web3,net,debug,trace,txpool --ws --ws.compression --http.addr=0.0.0.0 --http.corsdomain '*' --http.vhosts '*'\r\n\r\nCrash logs\r\n###[13/15 LogIndex] loadIntoTable LogTopicIndex: 13/15 LogIndex: put: k=000000000000000000000000394695995c21c70ed604e120be91d52ba7561ea7ffffffff, label: chaindata, table: LogTopicIndex, err: mdbx_cursor_put: MDBX_MAP_FULL: Environment mapsize limit reached\"\r\n\r\n````\r\nDec 13 01:34:41mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:34:41.455] [txpool] stat                            pending=10000 baseFee=0 queued=30000 alloc=1.6GB sys=7.4GB\r\nDec 13 01:35:02mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:35:02.218] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=000000000000000000000000243ce28e3b534f2a820008f072115a4a3a20c558ffffffff\r\nDec 13 01:35:32mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:35:32.219] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=0000000000000000000000002791bca1f2de4661ed88a30c99a7a9449aa841740307becd\r\nDec 13 01:36:02mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:36:02.647] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=0000000000000000000000002adca840d72845d29a2d579d56a12c7a641f1931ffffffff\r\nDec 13 01:36:32mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:36:32.218] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=0000000000000000000000002e32b149b5acc2dc51c951ff62cf2fa167e2cce7ffffffff\r\nDec 13 01:37:02mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:37:02.218] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=000000000000000000000000318a410a22941ecb72391046e8a81482f14bb5daffffffff\r\nDec 13 01:37:32mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:37:32.218] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=00000000000000000000000034e149536a11bffa3d5fcce76602dbecbdcdd45fffffffff\r\nDec 13 01:37:40mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:37:40.332] [p2p] GoodPeers                          eth67=8 eth68=5\r\nDec 13 01:37:41mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:37:41.456] [txpool] stat                            pending=10000 baseFee=0 queued=30000 alloc=1001.4MB sys=7.4GB\r\nDec 13 01:38:02mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:38:02.515] [13/15 LogIndex] ETL [2/2] Loading       into=LogTopicIndex current_prefix=0000000000000000000000003831d1445e7353a1633ac54f7b0f2fd384861ffcffffffff\r\nDec 13 01:38:11mainnet-polygon-archive erigon[251233]: [EROR] [12-13|01:38:11.875] Staged Sync                              err=\"[13/15 LogIndex] loadIntoTable LogTopicIndex: 13/15 LogIndex: put: k=000000000000000000000000394695995c21c70ed604e120be91d52ba7561ea7ffffffff, label: chaindata, table: LogTopicIndex, err: mdbx_cursor_put: MDBX_MAP_FULL: Environment mapsize limit reached\"\r\nDec 13 01:38:13mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:38:13.545] [2/15 Headers] Waiting for headers...    from=50592894\r\nDec 13 01:38:43mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:38:43.546] [2/15 Headers] Wrote block headers       number=50598214 blk/second=177.333 alloc=1.4GB sys=7.4GB invalidHeaders=1 rejectedBadHeaders=0\r\nDec 13 01:39:13mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:39:13.546] [2/15 Headers] Wrote block headers       number=50603724 blk/second=183.667 alloc=1.5GB sys=7.4GB invalidHeaders=0 rejectedBadHeaders=0\r\nDec 13 01:39:43mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:39:43.547] [2/15 Headers] Wrote block headers       number=50609044 blk/second=177.333 alloc=1.4GB sys=7.4GB invalidHeaders=0 rejectedBadHeaders=0\r\nDec 13 01:40:13mainnet-polygon-archive erigon[251233]: [INFO] [12-13|01:40:13.546] [2/15 Headers] Wrote block headers       number=50614364 blk/second=177.333 alloc=1.4GB sys=7.4GB invalidHeaders=0 rejectedBadHeaders=0\r\n````\r\nThe snapshot address used is Â `https://snapshot-download.polygon.technology/erigon-mainnet-snapshot-bulk-2023-12-01`\r\nThe snapshot data is 2023-12-01\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1853174057",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8969#issuecomment-1853174057",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969",
    "id": 1853174057,
    "node_id": "IC_kwDOC0FsAM5udTEp",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-13T02:35:59Z",
    "updated_at": "2023-12-13T02:35:59Z",
    "author_association": "COLLABORATOR",
    "body": "`--db.size.limit=12T`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1853174057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1853453217",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8969#issuecomment-1853453217",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969",
    "id": 1853453217,
    "node_id": "IC_kwDOC0FsAM5ueXOh",
    "user": {
      "login": "zhy827827",
      "id": 15209848,
      "node_id": "MDQ6VXNlcjE1MjA5ODQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/15209848?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zhy827827",
      "html_url": "https://github.com/zhy827827",
      "followers_url": "https://api.github.com/users/zhy827827/followers",
      "following_url": "https://api.github.com/users/zhy827827/following{/other_user}",
      "gists_url": "https://api.github.com/users/zhy827827/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zhy827827/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zhy827827/subscriptions",
      "organizations_url": "https://api.github.com/users/zhy827827/orgs",
      "repos_url": "https://api.github.com/users/zhy827827/repos",
      "events_url": "https://api.github.com/users/zhy827827/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zhy827827/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-13T08:17:23Z",
    "updated_at": "2023-12-13T08:17:23Z",
    "author_association": "NONE",
    "body": "Thank you for suggesting",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1853453217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1881183703",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8969#issuecomment-1881183703",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8969",
    "id": 1881183703,
    "node_id": "IC_kwDOC0FsAM5wIJXX",
    "user": {
      "login": "kaelabbott",
      "id": 19564604,
      "node_id": "MDQ6VXNlcjE5NTY0NjA0",
      "avatar_url": "https://avatars.githubusercontent.com/u/19564604?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kaelabbott",
      "html_url": "https://github.com/kaelabbott",
      "followers_url": "https://api.github.com/users/kaelabbott/followers",
      "following_url": "https://api.github.com/users/kaelabbott/following{/other_user}",
      "gists_url": "https://api.github.com/users/kaelabbott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kaelabbott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kaelabbott/subscriptions",
      "organizations_url": "https://api.github.com/users/kaelabbott/orgs",
      "repos_url": "https://api.github.com/users/kaelabbott/repos",
      "events_url": "https://api.github.com/users/kaelabbott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kaelabbott/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-08T15:03:29Z",
    "updated_at": "2024-01-08T15:03:59Z",
    "author_association": "NONE",
    "body": "Hello. Having this same error in staged sync with \r\n\r\n`--db.size.limit=8T`:\r\n\r\n\r\n\r\n```\r\n[EROR] [01-08|14:56:58.483] Staged Sync                              err=\"[9/15 IntermediateHashes] loadIntoTable TrieStorage: mdbx_cursor_del: MDBX_MAP_FULL: Environment mapsize limit reached\"\r\n[EROR] [01-08|14:57:00.675] Staged Sync                              err=\"[9/15 IntermediateHashes] loadIntoTable TrieStorage: mdbx_cursor_del: MDBX_MAP_FULL: Environment mapsize limit reached\"\r\n```\r\n\r\nwhen i increased the value to `--db.size.limit=12T` I got this error:\r\n\r\n```\r\n[EROR] [01-08|14:59:58.505] Erigon startup                           err=\"mdbx_env_open: MDBX_TOO_LARGE: Database is too large for current system, e.g. could NOT be mapped into RAM, label: chaindata, trace: [kv_mdbx.go:295 node.go:365 node.go:368 backend.go:241 node.go:124 main.go:65 make_app.go:52 command.go:274 app.go:332 app.go:309 main.go:34 proc.go:250 asm_amd64.s:1598]\"\r\nerigon-matic    | mdbx_env_open: MDBX_TOO_LARGE: Database is too large for current system, e.g. could NOT be mapped into RAM, label: chaindata, trace: [kv_mdbx.go:295 node.go:365 node.go:368 backend.go:241 node.go:124 main.go:65 make_app.go:52 command.go:274 app.go:332 app.go:309 main.go:34 proc.go:250 asm_amd64.s:1598]\r\n```\r\n\r\n@AskAlexSharov ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1881183703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
