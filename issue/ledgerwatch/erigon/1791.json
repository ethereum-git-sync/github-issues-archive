{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1791",
  "id": 866322426,
  "node_id": "MDU6SXNzdWU4NjYzMjI0MjY=",
  "number": 1791,
  "title": "nil pointer in Clique (Görli sync)",
  "user": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-04-23T18:00:26Z",
  "updated_at": "2021-05-08T17:05:56Z",
  "closed_at": "2021-05-04T12:46:58Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I get some reports about this kind of error:\r\n\r\n#### Backtrace\r\n\r\n````\r\n\r\nINFO [04-23|16:33:11.468] Timings                                  Headers=62.969322ms    BlockHashes=4.691876ms  Bodies=290.90202ms  Bodies=1.323321ms   Senders=1.447224ms  Execution=8.219033ms   HashState=17.459284ms  IntermediateHashes=8.763542ms   AccountHistoryIndex=3.536657ms   StorageHistoryIndex=11.205682ms  LogIndex=7.073715ms   TxLookup=13.265516ms  TxPool=\"490.507µs\" Finish=4.003865ms\r\nsnapshotByHeader 4670469 (epoch 30000, checkpoint interval 10) d1935341e9625624291b6d68542f0853c56d73e99b8ae60d956eb9368ae9edd1 returns nil\r\nERROR[04-23|16:33:12.003] Ethereum peer removal failed             peer=fe43f085 err=\"peer not registered\"\r\nsnapshotByHeader 4670469 (epoch 30000, checkpoint interval 10) d1935341e9625624291b6d68542f0853c56d73e99b8ae60d956eb9368ae9edd1 returns nil\r\nERROR[04-23|16:33:15.406] Ethereum peer removal failed             peer=f58a097d err=\"peer not registered\"\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xed1729]\r\ngoroutine 97340 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).getAncestors(0xc00018e6e0, 0x183d418, 0xc00045cf30, 0x474406, 0x51060fb53368eef6, 0xa103eb6e54592669, 0xcb3b9137b2eaf5b2, 0x6d08c287db5ab368, 0x245662e9415393d1, 0x53082f54686d1b29, ...)\r\n        github.com/ledgerwatch/turbo-geth/consensus/clique/verifier.go:399 +0xc9\r\ngithub.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).VerifyHeaders.func3(0xc00018e6e0, 0x183d418, 0xc00045cf30, 0xc00359e8f0, 0x1, 0x1, 0xc00285f6e0, 0xc0006774a0)\r\n        github.com/ledgerwatch/turbo-geth/consensus/clique/clique.go:379 +0x14b\r\ncreated by github.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).VerifyHeaders\r\n        github.com/ledgerwatch/turbo-geth/consensus/clique/clique.go:378 +0x20a\r\n````\r\n",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/826254770",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1791#issuecomment-826254770",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791",
    "id": 826254770,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNjI1NDc3MA==",
    "user": {
      "login": "brotchie",
      "id": 987457,
      "node_id": "MDQ6VXNlcjk4NzQ1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/987457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brotchie",
      "html_url": "https://github.com/brotchie",
      "followers_url": "https://api.github.com/users/brotchie/followers",
      "following_url": "https://api.github.com/users/brotchie/following{/other_user}",
      "gists_url": "https://api.github.com/users/brotchie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brotchie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brotchie/subscriptions",
      "organizations_url": "https://api.github.com/users/brotchie/orgs",
      "repos_url": "https://api.github.com/users/brotchie/repos",
      "events_url": "https://api.github.com/users/brotchie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brotchie/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-25T05:05:25Z",
    "updated_at": "2021-04-25T05:10:18Z",
    "author_association": "NONE",
    "body": "Had a similar crash earlier today, stack trace was slightly different. Syncing on goerli.\r\n\r\nBuilt from [38bf28f](https://github.com/ledgerwatch/turbo-geth/commit/38bf28feb4b8676acd68107910d2dce2b93c1c55):\r\n```\r\n$ git rev-parse HEAD\r\n38bf28feb4b8676acd68107910d2dce2b93c1c55\r\n```\r\n\r\nRun using command line:\r\n\r\n```\r\n./build/bin/tg --datadir goerli --chain goerli --private.api.addr 127.0.0.1:9090\r\n```\r\n\r\n```\r\nINFO [04-24|20:01:49.676] [14/14 Finish] Update current block for the RPC API to=4678724\r\nINFO [04-24|20:01:49.676] Memory                                   alloc=36.88MiB sys=142.43MiB\r\nINFO [04-24|20:01:49.676] Timings                                  Headers=568.556902ms   BlockHashes=1.334818ms   Bodies=3m7.430968283s Bodies=\"484.89µs\"     Senders=1.660655ms  Execution=7.003998ms    HashState=2.672654ms   IntermediateHashes=5.385042ms   AccountHistoryIndex=1.004313ms   StorageHistoryIndex=1.460266ms   LogIndex=1.305643ms   TxLookup=1.674496ms   TxPool=2.036814ms  Finish=\"581.505µs\"\r\nINFO [04-24|20:01:49.677] snapshotByHeader returns nil             block=4678725 epoch=30000 checkpoint interval=10 hash=0x5a4812052b6e69643c636240dd7b8de2edc48cfa782ba778d2c79d5699fd1058\r\nINFO [04-24|20:01:49.677] snapshotByHeader returns nil             block=4678725 epoch=30000 checkpoint interval=10 hash=0x968d018f0ba3efe7c8c497e463052aa80b3620f9d0484e12b5dbeb7124e78727\r\nERROR[04-24|20:01:49.677] Ethereum peer removal failed             peer=2c59d393 err=\"peer not registered\"\r\nERROR[04-24|20:01:49.677] Ethereum peer removal failed             peer=2c59d393 err=\"peer not registered\"\r\nINFO [04-24|20:01:50.417] [1/14 Headers] Imported new block headers count=12   elapsed=1.061ms     number=4678736 hash=\"e2375f…5c41e3\"\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x1c0 pc=0xecfdf7]\r\n\r\ngoroutine 175070 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).snapshotFromAncestors(0xc0004c8210, 0xc001ecce18, 0x55e5916acec7565b, 0x8f1ef4c041cce8fd, 0xb6747a4e5e050768)\r\n\tgithub.com/ledgerwatch/turbo-geth/consensus/clique/verifier.go:225 +0xb7\r\ngithub.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).verifyCascadingFieldsByAncestors(0xc0004c8210, 0x183e578, 0xc002f655d8, 0xc0017cbd40, 0xc0009f4180, 0x1, 0x1, 0x7ffa21b5b818, 0xc00297f580)\r\n\tgithub.com/ledgerwatch/turbo-geth/consensus/clique/verifier.go:121 +0xa5\r\ngithub.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).verifyHeader(0xc0004c8210, 0x183e578, 0xc002f655d8, 0xc0017cbd40, 0xc00029a168, 0x0, 0x1, 0xcac441340f360f7c, 0xf69e7d5d6b2be4c5)\r\n\tgithub.com/ledgerwatch/turbo-geth/consensus/clique/verifier.go:26 +0xb5\r\ngithub.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).VerifyHeaders.func3(0xc0004c8210, 0x183e578, 0xc002f655d8, 0xc00029a168, 0x1, 0x1, 0xc0005ac8a0, 0xc001e921e0)\r\n\tgithub.com/ledgerwatch/turbo-geth/consensus/clique/clique.go:394 +0x2ce\r\ncreated by github.com/ledgerwatch/turbo-geth/consensus/clique.(*Clique).VerifyHeaders\r\n\tgithub.com/ledgerwatch/turbo-geth/consensus/clique/clique.go:380 +0x20a\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/826254770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/835431227",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1791#issuecomment-835431227",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1791",
    "id": 835431227,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNTQzMTIyNw==",
    "user": {
      "login": "brotchie",
      "id": 987457,
      "node_id": "MDQ6VXNlcjk4NzQ1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/987457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brotchie",
      "html_url": "https://github.com/brotchie",
      "followers_url": "https://api.github.com/users/brotchie/followers",
      "following_url": "https://api.github.com/users/brotchie/following{/other_user}",
      "gists_url": "https://api.github.com/users/brotchie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brotchie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brotchie/subscriptions",
      "organizations_url": "https://api.github.com/users/brotchie/orgs",
      "repos_url": "https://api.github.com/users/brotchie/repos",
      "events_url": "https://api.github.com/users/brotchie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brotchie/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-08T17:05:56Z",
    "updated_at": "2021-05-08T17:05:56Z",
    "author_association": "NONE",
    "body": "FYI, I've continued to sync Goerli from master and no further crashes, thanks for fixing.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/835431227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
