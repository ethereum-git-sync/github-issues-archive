{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4385",
  "id": 1262518801,
  "node_id": "I_kwDOC0FsAM5LQIIR",
  "number": 4385,
  "title": "DEV chain stuck: \"Wrong trie root\" leading to \"possible uncles\"",
  "user": {
    "login": "mohoff",
    "id": 6060612,
    "node_id": "MDQ6VXNlcjYwNjA2MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6060612?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohoff",
    "html_url": "https://github.com/mohoff",
    "followers_url": "https://api.github.com/users/mohoff/followers",
    "following_url": "https://api.github.com/users/mohoff/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohoff/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohoff/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohoff/subscriptions",
    "organizations_url": "https://api.github.com/users/mohoff/orgs",
    "repos_url": "https://api.github.com/users/mohoff/repos",
    "events_url": "https://api.github.com/users/mohoff/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohoff/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-06-06T22:57:40Z",
  "updated_at": "2022-06-09T18:41:48Z",
  "closed_at": "2022-06-09T18:41:48Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2022.06.1-alpha-1d3259aa`\r\n\r\nCommit hash : \r\n\r\n#### Expected behaviour\r\n\r\nDEV chain should mine txs successfully as it did under `2022.04.01`\r\n\r\n#### Actual behaviour\r\n\r\nLog snippets:\r\n\r\n```\r\n[EROR] [06-06|22:43:15.017] [9/16 IntermediateHashes] Wrong trie root of block 80: c5c2710419c57b053123b1c4fca8b38ae2b04fcbe7930819e1c8139471ab8cea, expected (from header): e54f9793979b80e1a2136c4c20c95489d0672c74fac4bb51cf4839934d765fa2. Block hash: eaee3952c30924808f5c76560fcd45f4c3dd593c451302bae09b5c6c57ff5343\r\n[WARN] [06-06|22:43:15.017] Unwinding due to incorrect root hash     to=79\r\n[INFO] [06-06|22:43:15.017] UnwindTo                                 block=79 bad_block_hash=0xeaee3952c30924808f5c76560fcd45f4c3dd593c451302bae09b5c6c57ff5343\r\n```\r\n\r\nit seems to unwind successfully to block 79. Then:\r\n\r\n```\r\n[INFO] [06-06|22:43:15.034] [1/16 Headers] Waiting for headers...    from=79\r\n[TRACE] [06-06|22:43:15.034] Empty anchor queue\r\n[DBUG] [06-06|22:43:15.034] Request skeleton                         anchors=0 top seen height=0 highestInDb=79\r\n[INFO] [06-06|22:43:15.034] local tx propagated                      tx_hash=6f1dac49a994e711b049586aa36830ca4fa17e251a88562c748a18c951718573 announced to peers=0 broadcast to peers=0 baseFee=38466\r\n[DBUG] [06-06|22:43:15.039] [1/5 MiningCreateBlock] Candidate txs    amount=1\r\n[INFO] [06-06|22:43:15.039] [1/5 MiningCreateBlock] Start mine       block=80 baseFee=38466 gasLimit=12433868\r\n[TRACE] [06-06|22:43:15.039] Possible uncle rejected                  hash=0xeaee3952c30924808f5c76560fcd45f4c3dd593c451302bae09b5c6c57ff5343 reason=\"uncle is sibling\"\r\n```\r\n\r\nand the cycle repeats, dev chain stuck at block 79.\r\n\r\nSwitched from concurrent to sequential tx broadcasting (4 txs) but the issue persists. However, first I ran into `tx failed. nonce too high` which wasn't an issue with the same code under version `2022.04.01`. Not sure if a separate issue or the same.\r\n\r\nWorth mentioning that before the first error, 4 txs were successfully mined.\r\n\r\nThis is a follow-up issue for https://github.com/ledgerwatch/erigon/issues/4301 which seems fixed in the latest release. cc @enriavil1 \r\n",
  "closed_by": {
    "login": "mohoff",
    "id": 6060612,
    "node_id": "MDQ6VXNlcjYwNjA2MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6060612?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohoff",
    "html_url": "https://github.com/mohoff",
    "followers_url": "https://api.github.com/users/mohoff/followers",
    "following_url": "https://api.github.com/users/mohoff/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohoff/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohoff/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohoff/subscriptions",
    "organizations_url": "https://api.github.com/users/mohoff/orgs",
    "repos_url": "https://api.github.com/users/mohoff/repos",
    "events_url": "https://api.github.com/users/mohoff/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohoff/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1148442259",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4385#issuecomment-1148442259",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385",
    "id": 1148442259,
    "node_id": "IC_kwDOC0FsAM5Ec9aT",
    "user": {
      "login": "Giulio2002",
      "id": 29233688,
      "node_id": "MDQ6VXNlcjI5MjMzNjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Giulio2002",
      "html_url": "https://github.com/Giulio2002",
      "followers_url": "https://api.github.com/users/Giulio2002/followers",
      "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
      "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
      "repos_url": "https://api.github.com/users/Giulio2002/repos",
      "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T09:43:49Z",
    "updated_at": "2022-06-07T09:43:49Z",
    "author_association": "COLLABORATOR",
    "body": "Can you send me what transactions are executing to get this setup? do you have a script i can reproduce this on?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1148442259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1148668561",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4385#issuecomment-1148668561",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385",
    "id": 1148668561,
    "node_id": "IC_kwDOC0FsAM5Ed0qR",
    "user": {
      "login": "Giulio2002",
      "id": 29233688,
      "node_id": "MDQ6VXNlcjI5MjMzNjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Giulio2002",
      "html_url": "https://github.com/Giulio2002",
      "followers_url": "https://api.github.com/users/Giulio2002/followers",
      "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
      "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
      "repos_url": "https://api.github.com/users/Giulio2002/repos",
      "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T13:22:55Z",
    "updated_at": "2022-06-07T13:22:55Z",
    "author_association": "COLLABORATOR",
    "body": "I reproduced it, i know what it is, fix is incoming",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1148668561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1151475466",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4385#issuecomment-1151475466",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4385",
    "id": 1151475466,
    "node_id": "IC_kwDOC0FsAM5Eoh8K",
    "user": {
      "login": "mohoff",
      "id": 6060612,
      "node_id": "MDQ6VXNlcjYwNjA2MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6060612?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohoff",
      "html_url": "https://github.com/mohoff",
      "followers_url": "https://api.github.com/users/mohoff/followers",
      "following_url": "https://api.github.com/users/mohoff/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohoff/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohoff/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohoff/subscriptions",
      "organizations_url": "https://api.github.com/users/mohoff/orgs",
      "repos_url": "https://api.github.com/users/mohoff/repos",
      "events_url": "https://api.github.com/users/mohoff/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohoff/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-09T18:41:48Z",
    "updated_at": "2022-06-09T18:41:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, the fix worked!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1151475466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
