{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8637",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8637/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8637/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8637/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8637",
  "id": 1972258237,
  "node_id": "I_kwDOC0FsAM51jkW9",
  "number": 8637,
  "title": "[Polygon Mumbai] erigon stops every hour: unable to handle whitelist milestone",
  "user": {
    "login": "DaraDoyoung",
    "id": 95335707,
    "node_id": "U_kgDOBa61Gw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95335707?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DaraDoyoung",
    "html_url": "https://github.com/DaraDoyoung",
    "followers_url": "https://api.github.com/users/DaraDoyoung/followers",
    "following_url": "https://api.github.com/users/DaraDoyoung/following{/other_user}",
    "gists_url": "https://api.github.com/users/DaraDoyoung/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DaraDoyoung/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DaraDoyoung/subscriptions",
    "organizations_url": "https://api.github.com/users/DaraDoyoung/orgs",
    "repos_url": "https://api.github.com/users/DaraDoyoung/repos",
    "events_url": "https://api.github.com/users/DaraDoyoung/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DaraDoyoung/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5877848882,
      "node_id": "LA_kwDOC0FsAM8AAAABXljbMg",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/polygon",
      "name": "polygon",
      "color": "0B1179",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-11-01T12:14:45Z",
  "updated_at": "2023-11-01T12:19:26Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2.53.4-c4843268`\r\n\r\nOS & Version: Linux Ubuntu 22.04.2 LTS\r\n\r\nErigon Command (with flags/config):\r\n```\r\nnohup erigon --datadir $DATA_DIR \\\r\n  --chain=mumbai \\\r\n  --bor.heimdall=http://localhost:1317 \\\r\n  --snapshots=false \\\r\n  --torrent.upload.rate=\"512mb\" --torrent.download.rate=\"512mb\" \\\r\n  --ws \\\r\n  --private.api.addr=localhost:9091 \\\r\n  --txpool.globalslots 131072 \\\r\n  --txpool.globalbasefeeslots 60000 \\\r\n  --txpool.globalqueue 131072 \\\r\n  --metrics \\\r\n  --http \\\r\n  --http.addr 0.0.0.0 \\\r\n  --http.api 'eth,web3,net,debug,trace,txpool,bor,admin' \\\r\n  --http.vhosts '*' \\\r\n  --http.port 8545 \\\r\n  --maxpeers 30 \\\r\n  --p2p.protocol=67 \\\r\n  --db.pagesize=16k \\\r\n  --db.size.limit 7697000000000 \\\r\n  --log.console.verbosity='debug'\\\r\n  >> ~/node/logs/bor.log \\\r\n  2>&1 &\r\n```\r\nConsensus Layer: heimdalld (v1.0.2)\r\n\r\nConsensus Layer Command (with flags/config):\r\n```\r\n# heimdalld\r\nnohup /home/ubuntu/go/bin/heimdalld start --home /home/ubuntu/.heimdalld —-chain=mumbai --rest-server \\\r\n  >> ~/node/logs/heimdalld.log \\\r\n  2>&1 &\r\n\r\n# heimdalld-rest-server\r\nnohup /home/ubuntu/go/bin/heimdalld rest-server --home /home/ubuntu/.heimdalld \\\r\n  >> ~/node/logs/heimdalld-rest-server.log \\\r\n  2>&1 &\r\n\r\n```\r\nChain/Network: \r\nPolygon Mumbai\r\n\r\n```\r\n[INFO] [11-01|11:57:32.145] RPC Daemon notified of new headers       from=41894627 to=41894628 hash=0x515cc0e99b617cff1f4cd5ae9a5f2974ffe6e18de745a704c9be83ad17327c4e header sending=18.674µs log sending=295ns\r\n[INFO] [11-01|11:57:32.145] Timings (slower than 50ms)               Headers=1.902s\r\n[INFO] [11-01|11:57:32.145] Tables                                   PlainState=73.3GB AccountChangeSet=35.5GB StorageChangeSet=111.0GB BlockTransaction=184.9GB TransactionLog=395.6GB FreeList=12.3MB ReclaimableSpace=12.3GB\r\n0\r\n[DBUG] [11-01|11:57:32.158] [1/15 Snapshots] DONE                    in=20.069µs\r\n1\r\n[INFO] [11-01|11:57:32.158] [2/15 Headers] Waiting for headers...    from=41894628\r\n[DBUG] [11-01|11:57:32.158] [downloader] Request skeleton            anchors=0 highestInDb=41894628\r\n[INFO] [11-01|11:57:32.630] Got new checkpoint from heimdall         start=41893123 end=41893634 rootHash=0x6da5ee4ecd64b5291a9c3fdd83e684292b9151d2ab0ed1e9c10d7cdc65c38e8c\r\n[DBUG] [11-01|11:57:33.160] [downloader] Request skeleton            anchors=0 highestInDb=41894628\r\n[INFO] [11-01|11:57:34.142] [2/15 Headers] Processed                 highest inserted=41894629 age=0\r\n[DBUG] [11-01|11:57:34.142] [2/15 Headers] DONE                      in=1.983300211s\r\n2\r\n[INFO] [11-01|11:57:34.142] [3/15 BorHeimdall] Processng sync events... from=41894629\r\n[INFO] [11-01|11:57:34.142] [3/15 BorHeimdall] Sync events processed progress=41894629 lastSpanId=0 lastEventId=230576 total records=0 fetch time=0s process time=42.871µs\r\n[DBUG] [11-01|11:57:34.142] [3/15 BorHeimdall] DONE                  in=89.066µs\r\n3\r\n[DBUG] [11-01|11:57:34.142] [4/15 BlockHashes] DONE                  in=442.525µs\r\n4\r\n[DBUG] [11-01|11:57:34.142] [5/15 Bodies] DONE                       in=90.699µs\r\n5\r\n[DBUG] [11-01|11:57:34.145] [6/15 Senders] DONE                      in=2.918994ms\r\n6\r\n[INFO] [11-01|11:57:34.159] [7/15 Execution] Completed on            block=41894629\r\n[DBUG] [11-01|11:57:34.159] [7/15 Execution] DONE                    in=14.033479ms\r\n7\r\n[DBUG] [11-01|11:57:34.167] [8/15 HashState] DONE                    in=7.732699ms\r\n8\r\n[DBUG] [11-01|11:57:34.186] [9/15 IntermediateHashes] DONE           in=18.998806ms\r\n9\r\n[DBUG] [11-01|11:57:34.191] [10/15 CallTraces] DONE                  in=4.377046ms\r\n10\r\n[DBUG] [11-01|11:57:34.193] [11/15 AccountHistoryIndex] DONE         in=2.10125ms\r\n11\r\n[DBUG] [11-01|11:57:34.199] [12/15 StorageHistoryIndex] DONE         in=6.021191ms\r\n12\r\n[DBUG] [11-01|11:57:34.205] [13/15 LogIndex] DONE                    in=5.703925ms\r\n13\r\n[DBUG] [11-01|11:57:34.213] [14/15 TxLookup] DONE                    in=8.225324ms\r\n14\r\n[DBUG] [11-01|11:57:34.213] [15/15 Finish] DONE                      in=13.579µs\r\nstage end\r\nno err\r\n[WARN] [11-01|11:57:40.603] an error while trying fetching from Heimdall path=/milestone/lastNoAck attempt=1 error=\"Get \\\"http://localhost:1317/milestone/lastNoAck\\\": context deadline exceeded\"\r\n[INFO] [11-01|11:57:40.603] Retrying again in 5 seconds to fetch data from Heimdall path=/milestone/lastNoAck attempt=1\r\n[DBUG] [11-01|11:57:40.603] Shutdown detected, terminating request by context.Done\r\n[EROR] [11-01|11:57:40.603] Failed to fetch latest no-ack milestone  err=\"context deadline exceeded\"\r\n[DBUG] [11-01|11:57:40.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|11:57:40.603] unable to handle no-ack-milestone service err=\"failed to fetch latest milestone\"\r\n[WARN] [11-01|11:57:40.686] Served                                   conn=127.0.0.1:44324 method=eth_getBlockByNumber reqid=4023 t=5.000408694s err=\"context canceled\"\r\n[DBUG] [11-01|11:57:40.688] Got new milestone from heimdall          start=41894576 end=41894593 hash=0x3b1819f3383a1aa18e2c0a07e29eac16ed49c31149c5e8347cd944ca18d01136\r\nconsensus/bor/finality/whitelist_helpers.go:78\r\nconsensus/bor/finality/whitelist_helpers.go:84\r\n[DBUG] [11-01|11:57:42.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:57:48.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:57:54.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:00.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\nconsensus/bor/finality/whitelist.go:180\r\nconsensus/bor/finality/whitelist.go:193 if err != nil {\r\n[DBUG] [11-01|11:58:06.602] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|11:58:06.602] unable to handle whitelist milestone     err=\"context deadline exceeded\"\r\n[DBUG] [11-01|11:58:06.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:06.604] Got new milestone from heimdall          start=41894594 end=41894612 hash=0x08549813cc243736261d8708c994514b027cf8e1625815740a29177eadd702a1\r\nconsensus/bor/finality/whitelist_helpers.go:78\r\nconsensus/bor/finality/whitelist_helpers.go:84\r\n[DBUG] [11-01|11:58:12.599] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|11:58:15.085] Served                                   conn=127.0.0.1:60146 method=eth_getBlockByNumber reqid=4024 t=5.000334667s err=\"context canceled\"\r\n[DBUG] [11-01|11:58:15.086] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:18.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:24.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:30.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\nconsensus/bor/finality/whitelist.go:180\r\nconsensus/bor/finality/whitelist.go:193 if err != nil {\r\n[DBUG] [11-01|11:58:36.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:36.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|11:58:36.603] unable to handle whitelist milestone     err=\"context deadline exceeded\"\r\n[DBUG] [11-01|11:58:36.604] Got new milestone from heimdall          start=41894613 end=41894624 hash=0x0ebed6c59ffabea597ad469305b59a85e3cc29b1f7284a1dea3ec2a474931cef\r\nconsensus/bor/finality/whitelist_helpers.go:78\r\nconsensus/bor/finality/whitelist_helpers.go:84\r\n[DBUG] [11-01|11:58:42.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:48.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:58:54.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:00.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\nconsensus/bor/finality/whitelist.go:180\r\nconsensus/bor/finality/whitelist.go:193 if err != nil {\r\n[DBUG] [11-01|11:59:06.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:06.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|11:59:06.603] unable to handle whitelist milestone     err=\"context deadline exceeded\"\r\n[DBUG] [11-01|11:59:06.604] Got new milestone from heimdall          start=41894613 end=41894624 hash=0x0ebed6c59ffabea597ad469305b59a85e3cc29b1f7284a1dea3ec2a474931cef\r\nconsensus/bor/finality/whitelist_helpers.go:78\r\nconsensus/bor/finality/whitelist_helpers.go:84\r\n[INFO] [11-01|11:59:10.710] [p2p] GoodPeers                          eth67=5\r\n[DBUG] [11-01|11:59:12.598] QuerySeeds read nodes from the node DB   count=30\r\n[DBUG] [11-01|11:59:12.599] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:12.600] Couldn't add port mapping                proto=tcp extport=30303 intport=30303 interface=\"UPnP or NAT-PMP\" err=\"no UPnP or NAT-PMP router discovered\"\r\n[DBUG] [11-01|11:59:12.600] Couldn't add port mapping                proto=udp extport=30303 intport=30303 interface=\"UPnP or NAT-PMP\" err=\"no UPnP or NAT-PMP router discovered\"\r\n[DBUG] [11-01|11:59:12.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:18.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:24.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:30.604] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:36.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\nconsensus/bor/finality/whitelist.go:180\r\nconsensus/bor/finality/whitelist.go:193 if err != nil {\r\n[DBUG] [11-01|11:59:36.604] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|11:59:36.604] unable to handle whitelist milestone     err=\"context deadline exceeded\"\r\n[DBUG] [11-01|11:59:36.605] Got new milestone from heimdall          start=41894613 end=41894624 hash=0x0ebed6c59ffabea597ad469305b59a85e3cc29b1f7284a1dea3ec2a474931cef\r\nconsensus/bor/finality/whitelist_helpers.go:78\r\nconsensus/bor/finality/whitelist_helpers.go:84\r\n[DBUG] [11-01|11:59:42.604] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:48.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|11:59:54.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|12:00:00.603] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|12:00:06.604] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\nconsensus/bor/finality/whitelist.go:180\r\nconsensus/bor/finality/whitelist.go:193 if err != nil {\r\n[DBUG] [11-01|12:00:06.605] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[WARN] [11-01|12:00:06.605] unable to handle whitelist milestone     err=\"context deadline exceeded\"\r\n[DBUG] [11-01|12:00:06.606] Got new milestone from heimdall          start=41894613 end=41894624 hash=0x0ebed6c59ffabea597ad469305b59a85e3cc29b1f7284a1dea3ec2a474931cef\r\nconsensus/bor/finality/whitelist_helpers.go:78\r\nconsensus/bor/finality/whitelist_helpers.go:84\r\n[DBUG] [11-01|12:00:12.599] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n[DBUG] [11-01|12:00:16.088] config.heimdall                          LOG15_ERROR= LOG15_ERROR= LOG15_ERROR=\"Normalized odd number of arguments by adding nil\"\r\n```\r\nadded some debugging logs to see where the problem is starting.\r\nwe've figured out that verifying part is where the problem starts. \r\n(https://github.com/ledgerwatch/erigon/blob/c4843268b788c0899cdad12d220fea4396afbb56/consensus/bor/finality/whitelist_helpers.go#L85)\r\n\r\nRestarting the erigon client solvese the problem(it syncs well and works well again). But before we manually restart the erigon client, the logs shared above will repeat and it won't sync.\r\nThis happens every hour or so, and this happened after upgrading from v2.49.1 to v2.53.0 to prepare for the Agra Hardfork.\r\nWe've reported this issue by discord(https://discord.com/channels/687972960811745322/983710221308416010/1167370610289168445, Oct.27) This has been a problem since then but no changes were made to fix this bug by v2.53.4.\r\nWe are still manually restarting the node whenever this bug happens.\r\n\r\nPlease look into the issue.\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8637/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8637/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
