{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8320",
  "id": 1917820170,
  "node_id": "I_kwDOC0FsAM5yT50K",
  "number": 8320,
  "title": "Unable to get peers on Holesky, endlessly regenerating",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-28T15:48:01Z",
  "updated_at": "2023-09-28T21:35:46Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2.49.3`\r\nOS & Version: Ubuntu 22.04\r\nErigon Command (with flags/config):\r\n```\r\n--chain=holesky\r\n--maxpeers=20\r\n--nat=extip:194.33.40.246\r\n--allow-insecure-unlock\r\n--datadir=/data\r\n--mine=true\r\n--miner.sigfile=/keys/sigfile\r\n--prune=hrtc\r\n--metrics\r\n--metrics.addr=0.0.0.0\r\n--metrics.port=6061\r\n--http\r\n--http.addr=0.0.0.0\r\n--http.port=8546\r\n--http.api=eth,net,erigon,admin,engine\r\n--authrpc.addr=0.0.0.0\r\n--authrpc.port=8552\r\n--authrpc.jwtsecret=/keys/jwtsecret\r\n--v5disc=true\r\n--nodiscover=false\r\n```\r\nConcensus Layer: Nimbus Beacon Node `23.9.1`\r\nChain/Network: `holesky`\r\n\r\n#### Expected behaviour\r\nThe node can find peers and helps with attestations.\r\n\r\n#### Actual behaviour\r\nThe node cannot find peers:\r\n```\r\n > curl -s 0:6064/debug/metrics/prometheus | grep p2p_peers\r\n# TYPE p2p_peers gauge\r\np2p_peers 0\r\n\r\n > ./rpc.sh admin_peers\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 1,\r\n  \"result\": []\r\n}\r\n```\r\nAnd peers cannot be added manually. I have tried creating `static-nodes.json`, `trusted-nodes.json`, and using the `admin_addPeer` RPC method. The files seem to be ignored, and the RPC method doesn't exist:\r\n```json\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 1,\r\n  \"error\": {\r\n    \"code\": -32601,\r\n    \"message\": \"the method admin_addPeer does not exist/is not available\"\r\n  }\r\n}\r\n```\r\nWhich makes no sense to me.\r\n\r\nThe node itself just keeps printing this in logs:\r\n```json\r\n{\"lvl\":\"info\",\"msg\":\"[5/6 IntermediateHashes] Regeneration trie hashes started\",\"t\":\"2023-09-28T15:44:21.544146331Z\"}\r\n{\"hash\":\"0x69d8c9d72f6fa4ad42d4702b433707212f90db395eb54dc20bc85de253788783\",\"lvl\":\"info\",\"msg\":\"[5/6 IntermediateHashes] Trie root\",\"t\":\"2023-09-28T15:44:21.545434523Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"[5/6 IntermediateHashes] Regeneration ended\",\"t\":\"2023-09-28T15:44:21.545558847Z\"}\r\n```\r\nAnd the logs are full of those. The p2p port is `closed` too.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1739956662",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8320#issuecomment-1739956662",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320",
    "id": 1739956662,
    "node_id": "IC_kwDOC0FsAM5ntaG2",
    "user": {
      "login": "racytech",
      "id": 82003208,
      "node_id": "MDQ6VXNlcjgyMDAzMjA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/82003208?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/racytech",
      "html_url": "https://github.com/racytech",
      "followers_url": "https://api.github.com/users/racytech/followers",
      "following_url": "https://api.github.com/users/racytech/following{/other_user}",
      "gists_url": "https://api.github.com/users/racytech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/racytech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/racytech/subscriptions",
      "organizations_url": "https://api.github.com/users/racytech/orgs",
      "repos_url": "https://api.github.com/users/racytech/repos",
      "events_url": "https://api.github.com/users/racytech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/racytech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-28T20:24:47Z",
    "updated_at": "2023-09-28T20:24:47Z",
    "author_association": "COLLABORATOR",
    "body": "what are the nimbus flags?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1739956662/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1740034579",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8320#issuecomment-1740034579",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320",
    "id": 1740034579,
    "node_id": "IC_kwDOC0FsAM5nttIT",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-28T21:33:51Z",
    "updated_at": "2023-09-28T21:34:11Z",
    "author_association": "NONE",
    "body": "Same ones that work perfectly fine with 10 Geth nodes and 10 Nethermind nodes:\r\n```\r\n--network=holesky\r\n--history=prune\r\n--jwt-secret=jwt.hex\r\n--el=http://localhost:8552\r\n--tcp-port=9001\r\n--udp-port=9001\r\n--max-peers=320\r\n--sync-light-client=false\r\n--subscribe-all-subnets=false\r\n--doppelganger-detection=true\r\n--num-threads=0\r\n--rest=true\r\n--rest-address=0.0.0.0\r\n--rest-port=9301\r\n--rest-max-body-size=16384\r\n--rest-max-headers-size=128\r\n--metrics=true\r\n--metrics-address=0.0.0.0\r\n--metrics-port=9201\r\n--validator-monitor-auto=true\r\n--validator-monitor-details=false\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1740034579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1740036373",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8320#issuecomment-1740036373",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8320",
    "id": 1740036373,
    "node_id": "IC_kwDOC0FsAM5nttkV",
    "user": {
      "login": "racytech",
      "id": 82003208,
      "node_id": "MDQ6VXNlcjgyMDAzMjA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/82003208?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/racytech",
      "html_url": "https://github.com/racytech",
      "followers_url": "https://api.github.com/users/racytech/followers",
      "following_url": "https://api.github.com/users/racytech/following{/other_user}",
      "gists_url": "https://api.github.com/users/racytech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/racytech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/racytech/subscriptions",
      "organizations_url": "https://api.github.com/users/racytech/orgs",
      "repos_url": "https://api.github.com/users/racytech/repos",
      "events_url": "https://api.github.com/users/racytech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/racytech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-28T21:35:45Z",
    "updated_at": "2023-09-28T21:35:45Z",
    "author_association": "COLLABORATOR",
    "body": "Thanks! Investigating...",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1740036373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
