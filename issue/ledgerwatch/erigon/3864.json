{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/3864",
  "id": 1199017954,
  "node_id": "I_kwDOC0FsAM5Hd4_i",
  "number": 3864,
  "title": "`debug_traceTransaction` call kills `rpcdaemon` for large gas transaction (~10m)",
  "user": {
    "login": "riordant",
    "id": 6988731,
    "node_id": "MDQ6VXNlcjY5ODg3MzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6988731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/riordant",
    "html_url": "https://github.com/riordant",
    "followers_url": "https://api.github.com/users/riordant/followers",
    "following_url": "https://api.github.com/users/riordant/following{/other_user}",
    "gists_url": "https://api.github.com/users/riordant/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/riordant/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/riordant/subscriptions",
    "organizations_url": "https://api.github.com/users/riordant/orgs",
    "repos_url": "https://api.github.com/users/riordant/repos",
    "events_url": "https://api.github.com/users/riordant/events{/privacy}",
    "received_events_url": "https://api.github.com/users/riordant/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-04-10T12:43:27Z",
  "updated_at": "2022-07-05T15:58:07Z",
  "closed_at": "2022-07-05T15:58:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `./erigon --version`\r\nerigon version 2022.02.3-beta\r\n\r\nOS & Version: Windows/Linux/OSX\r\nLinux Mint 20\r\n\r\nCommit hash : \r\n```\r\ncommit 227bb7368937ba408da82fddcacc02d27153d4fe (HEAD, tag: v2022.02.03)\r\nAuthor: Alex Sharov <AskAlexSharov@gmail.com>\r\nDate:   Thu Feb 17 14:37:26 2022 +0700\r\n\r\n    save (#3533)\r\n```\r\n\r\n#### Expected behaviour\r\ncalling the following:\r\n`curl -s --data '{\"jsonrpc\":\"2.0\",\"method\":\"debug_traceTransaction\",\"params\":[\"0x00a516e3401db12dc3d9beacf746f269290a7092e105072f27b3a852a202309e\"],\"id\":\"1\"}' -H \"Content-Type: application/json\" -X POST http://localhost:8545`\r\n\r\nCauses `rpcdaemon` to be killed with the following:\r\n`[1]    1056550 killed     ./rpcdaemon --datadir=/mnt/lv/erigon --private.api.addr=localhost:9090   \"*\"`\r\n\r\n#### Actual behaviour\r\nShould return the data for `debug_traceTransaction` without killing the daemon\r\n\r\n#### Steps to reproduce the behaviour\r\n`./erigon --datadir=/mnt/lv/erigon --private.api.addr=localhost:9090`\r\n`./rpcdaemon --datadir=/mnt/lv/erigon --private.api.addr=localhost:9090 --http.api=eth,erigon,web3,net,debug,trace,txpool --http.corsdomain \"*\" --rpc.gascap 0`\r\nthen executing the above `cURL` command.\r\n\r\nAlso, I understand from reading the docs that it is possible to 'stream' the output of this call. How is that achieved? I cannot find anything else about it in the docs.\r\n",
  "closed_by": {
    "login": "mandrigin",
    "id": 466427,
    "node_id": "MDQ6VXNlcjQ2NjQyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mandrigin",
    "html_url": "https://github.com/mandrigin",
    "followers_url": "https://api.github.com/users/mandrigin/followers",
    "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
    "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
    "organizations_url": "https://api.github.com/users/mandrigin/orgs",
    "repos_url": "https://api.github.com/users/mandrigin/repos",
    "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mandrigin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140332699",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3864#issuecomment-1140332699",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864",
    "id": 1140332699,
    "node_id": "IC_kwDOC0FsAM5D-Bib",
    "user": {
      "login": "victordeleau",
      "id": 26342960,
      "node_id": "MDQ6VXNlcjI2MzQyOTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/26342960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/victordeleau",
      "html_url": "https://github.com/victordeleau",
      "followers_url": "https://api.github.com/users/victordeleau/followers",
      "following_url": "https://api.github.com/users/victordeleau/following{/other_user}",
      "gists_url": "https://api.github.com/users/victordeleau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/victordeleau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/victordeleau/subscriptions",
      "organizations_url": "https://api.github.com/users/victordeleau/orgs",
      "repos_url": "https://api.github.com/users/victordeleau/repos",
      "events_url": "https://api.github.com/users/victordeleau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/victordeleau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-28T21:37:44Z",
    "updated_at": "2022-05-28T21:37:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Using the commit you provided I have a panic due to a segmentation violation when starting erigon with `--mine`. Will try on mainnet once my node is synced.\r\n\r\nI tried reproduce the issue on `devel` using the dev chain. `debug_traceTransaction` seems to work correctly in that case.\r\n\r\nAs for streaming the output of the call, I don't know how that works, but I would be interested to know.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140332699/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140378793",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3864#issuecomment-1140378793",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864",
    "id": 1140378793,
    "node_id": "IC_kwDOC0FsAM5D-Myp",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T05:10:22Z",
    "updated_at": "2022-05-29T05:10:22Z",
    "author_association": "COLLABORATOR",
    "body": "@victordeleau show top 20 lines of panic.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140378793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140530755",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3864#issuecomment-1140530755",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864",
    "id": 1140530755,
    "node_id": "IC_kwDOC0FsAM5D-x5D",
    "user": {
      "login": "victordeleau",
      "id": 26342960,
      "node_id": "MDQ6VXNlcjI2MzQyOTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/26342960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/victordeleau",
      "html_url": "https://github.com/victordeleau",
      "followers_url": "https://api.github.com/users/victordeleau/followers",
      "following_url": "https://api.github.com/users/victordeleau/following{/other_user}",
      "gists_url": "https://api.github.com/users/victordeleau/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/victordeleau/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/victordeleau/subscriptions",
      "organizations_url": "https://api.github.com/users/victordeleau/orgs",
      "repos_url": "https://api.github.com/users/victordeleau/repos",
      "events_url": "https://api.github.com/users/victordeleau/events{/privacy}",
      "received_events_url": "https://api.github.com/users/victordeleau/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T21:48:32Z",
    "updated_at": "2022-05-29T21:48:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is the first stacktrace\r\n\r\n```\r\nINFO[05-29|14:55:27.219] [1/5 MiningCreateBlock] Start mine       block=1 baseFee=875000000 gasLimit=11511229\r\nunexpected fault address 0x1b79a30\r\nfatal error: fault\r\n[signal SIGSEGV: segmentation violation code=0x2 addr=0x1b79a30 pc=0x43b1a3]\r\n\r\ngoroutine 60 [running, locked to thread]:\r\nruntime.throw({0x11a1734?, 0x0?})\r\n        runtime/panic.go:992 +0x71 fp=0xc00071b580 sp=0xc00071b550 pc=0x461bd1\r\nruntime.sigpanic()\r\n        runtime/signal_unix.go:825 +0x305 fp=0xc00071b5d0 sp=0xc00071b580 pc=0x477f85\r\nruntime.mapiterinit(0x400?, 0x112d160?, 0xc00017eeb0?)\r\n        runtime/map.go:821 +0x23 fp=0xc00071b5f0 sp=0xc00071b5d0 pc=0x43b1a3\r\nreflect.mapiterinit(0x0?, 0xc0000ddc00?, 0xc0000ddc00?)\r\n        runtime/map.go:1373 +0x19 fp=0xc00071b618 sp=0xc00071b5f0 pc=0x48e619\r\ngithub.com/goccy/go-json/internal/encoder/vm.Run(0xc000014d00, {0xc0000ddc00?, 0x0?, 0x400?}, 0xc00062c880?)\r\n        github.com/goccy/go-json@v0.7.4/internal/encoder/vm/vm.go:410 +0x1fb7 fp=0xc00071ea78 sp=0xc00071b618 pc=0xc72af7\r\ngithub.com/goccy/go-json.encodeRunCode(0x110f420?, {0xc0000ddc00?, 0x2659688?, 0xc00062c7c0?}, 0xc0005b4c00?)\r\n        github.com/goccy/go-json@v0.7.4/encode.go:307 +0x68 fp=0xc00071eab0 sp=0xc00071ea78 pc=0xca1ae8\r\ngithub.com/goccy/go-json.encode(0xc000014d00, {0x110f420, 0xc00017eea0})\r\n        github.com/goccy/go-json@v0.7.4/encode.go:232 +0x21c fp=0xc00071eb30 sp=0xc00071eab0 pc=0xca19dc\r\ngithub.com/goccy/go-json.marshal({0x110f420, 0xc00017eea0}, {0x0, 0x0, 0xf8007ff46a727108?})\r\n        github.com/goccy/go-json@v0.7.4/encode.go:147 +0xba fp=0xc00071eb90 sp=0xc00071eb30 pc=0xca169a\r\ngithub.com/goccy/go-json.MarshalWithOption(...)\r\n        github.com/goccy/go-json@v0.7.4/json.go:186\r\ngithub.com/goccy/go-json.Marshal({0x110f420?, 0xc00017eea0?})\r\n        github.com/goccy/go-json@v0.7.4/json.go:171 +0x2a fp=0xc00071ebc8 sp=0xc00071eb90 pc=0xca1b6a\r\ngithub.com/ledgerwatch/erigon/consensus/clique.(*Snapshot).store(0xc00017eea0, {0x1cc68b8, 0xc0001a4f80})\r\n        github.com/ledgerwatch/erigon/consensus/clique/snapshot.go:142 +0x39 fp=0xc00071ec18 sp=0xc00071ebc8 pc=0xd420d9\r\ngithub.com/ledgerwatch/erigon/consensus/clique.(*Clique).Snapshot(0xc00020e240, {0x1cc6648, 0xc0005180f0}, 0x25d32c0?, {0x50, 0x47, 0x42, 0x2d, 0xb8, 0x6d, ...}, ...)\r\n        github.com/ledgerwatch/erigon/consensus/clique/verifier.go:190 +0xb12 fp=0xc00071eeb8 sp=0xc00071ec18 pc=0xd45892\r\ngithub.com/ledgerwatch/erigon/consensus/clique.(*Clique).Prepare(0xc00020e240, {0x1cc6648, 0xc0005180f0}, 0xc000202780)\r\n        github.com/ledgerwatch/erigon/consensus/clique/clique.go:308 +0xda fp=0xc00071f0b8 sp=0xc00071eeb8 pc=0xd3ea7a\r\ngithub.com/ledgerwatch/erigon/eth/stagedsync.SpawnMiningCreateBlockStage(_, {_, _}, {{0x1cc68b8, 0xc0001a4c00}, {0x2388428, 0xc00028f500, 0xc00028f560, 0xc000364150}, {{0x0, ...}, ...}, ...}, ...)\r\n        github.com/ledgerwatch/erigon/eth/stagedsync/stage_mining_create_block.go:237 +0x1342 fp=0xc00071fbb0 sp=0xc00071f0b8 pc=0xe41582\r\ngithub.com/ledgerwatch/erigon/eth/stagedsync.MiningStages.func1(0x10?, 0x6d?, 0x11ae426?, {0x11?, 0x1cc9b78?}, {0x1ccd188, 0xc0002904b0})\r\n        github.com/ledgerwatch/erigon/eth/stagedsync/stagebuilder.go:37 +0xb3 fp=0xc00071fd38 sp=0xc00071fbb0 pc=0xe53193\r\ngithub.com/ledgerwatch/erigon/eth/stagedsync.(*Sync).runStage(0xc0000d6d10, 0xc00010eeb0, {0x0?, 0x0}, {0x1ccd188?, 0xc0002904b0}, 0x0?, 0x0?)\r\n        github.com/ledgerwatch/erigon/eth/stagedsync/sync.go:316 +0x14c fp=0xc00071fe38 sp=0xc00071fd38 pc=0xe5582c\r\ngithub.com/ledgerwatch/erigon/eth/stagedsync.(*Sync).Run(0xc0000d6d10, {0x0, 0x0}, {0x1ccd188, 0xc0002904b0}, 0x0?)\r\n        github.com/ledgerwatch/erigon/eth/stagedsync/sync.go:233 +0x2a5 fp=0xc00071fee8 sp=0xc00071fe38 pc=0xe54ae5\r\ngithub.com/ledgerwatch/erigon/turbo/stages.MiningStep({0x1cc46a0?, 0xc000036098?}, {0x1cc68b8?, 0xc0001a4c00?}, 0x0?)\r\n        github.com/ledgerwatch/erigon/turbo/stages/stageloop.go:209 +0x10c fp=0xc00071ff90 sp=0xc00071fee8 pc=0xe5f76c\r\ngithub.com/ledgerwatch/erigon/eth.(*Ethereum).StartMining.func3.1()\r\n        github.com/ledgerwatch/erigon/eth/backend.go:640 +0x36 fp=0xc00071ffe0 sp=0xc00071ff90 pc=0xe66656\r\nruntime.goexit()\r\n        runtime/asm_amd64.s:1571 +0x1 fp=0xc00071ffe8 sp=0xc00071ffe0 pc=0x494e41\r\ncreated by github.com/ledgerwatch/erigon/eth.(*Ethereum).StartMining.func3\r\n        github.com/ledgerwatch/erigon/eth/backend.go:640 +0x3d8\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140530755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1175224088",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3864#issuecomment-1175224088",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3864",
    "id": 1175224088,
    "node_id": "IC_kwDOC0FsAM5GDH8Y",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-05T15:58:06Z",
    "updated_at": "2022-07-05T15:58:06Z",
    "author_association": "COLLABORATOR",
    "body": "I assume it is a duplicate of #4637\r\n\r\nMining issue seems to be different. I will close this issue for now, but please reopen @victordeleau if it reproduces on the latest release.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1175224088/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
