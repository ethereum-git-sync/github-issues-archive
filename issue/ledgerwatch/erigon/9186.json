{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/9186",
  "id": 2073379463,
  "node_id": "I_kwDOC0FsAM57lUKH",
  "number": 9186,
  "title": "[Polygon] Erigon client returning different results for same RPC",
  "user": {
    "login": "gobblegobble1",
    "id": 152538708,
    "node_id": "U_kgDOCReOVA",
    "avatar_url": "https://avatars.githubusercontent.com/u/152538708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gobblegobble1",
    "html_url": "https://github.com/gobblegobble1",
    "followers_url": "https://api.github.com/users/gobblegobble1/followers",
    "following_url": "https://api.github.com/users/gobblegobble1/following{/other_user}",
    "gists_url": "https://api.github.com/users/gobblegobble1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gobblegobble1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gobblegobble1/subscriptions",
    "organizations_url": "https://api.github.com/users/gobblegobble1/orgs",
    "repos_url": "https://api.github.com/users/gobblegobble1/repos",
    "events_url": "https://api.github.com/users/gobblegobble1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gobblegobble1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2024-01-10T00:26:36Z",
  "updated_at": "2024-01-10T00:27:37Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2.54.0-aeec5221` and also tried `erigon version 2.55.1-12889fd0`\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: `aeec5221c93be843d282e34379d9281e68906f79`\r\n\r\nErigon Command (with flags/config):\r\n\r\n```\r\n/bin/bash -c '/opt/erigon/bin/erigon \\\r\n  --db.pagesize=16kb \\\r\n  --db.size.limit=12tb \\\r\n  --bor.heimdall=http://localhost:1317 \\\r\n  --datadir=/data/erigon/polygon/datadir \\\r\n  --private.api.addr=localhost:9090 \\\r\n  --private.api.ratelimit=64000 \\\r\n  --batchSize=512mb \\\r\n  --no-downloader \\\r\n  --snapshots=true \\\r\n  --bodies.cache=21474836480 \\\r\n  --chain=bor-mainnet \\\r\n  --metrics \\\r\n  --metrics.addr=localhost \\\r\n  --metrics.port=6060 \\\r\n  --http \\\r\n  --http.addr=0.0.0.0 \\\r\n  --http.compression \\\r\n  --http.vhosts=* \\\r\n  --http.api=web3,txpool,eth,debug,net,trace \\\r\n  --bootnodes=\"enode://b8f1cc9c5d4403703fbf377116469667d2b1823c0daf16b7250aa576bacf399e42c3930ccfcb02c5df6879565a2b8931335565f0e8d3f8e72385ecf4a4bf160a@3.36.224.80:30303,enode://8729e0c825f3d9cad382555f3e46dcff21af323e89025a0e6312df541f4a9e73abfa562d64906f5e59c51fe6f0501b3e61b07979606c56329c020ed739910759@54.194.245.5:30303\"'\r\n```\r\n\r\nConsensus Layer: Heimdall\r\n\r\nConsensus Layer Command (with flags/config):\r\n\r\n```\r\n/bin/bash -c '/opt/heimdall/bin/heimdalld start \\\r\n    --home=\"/var/lib/heimdall\" \\\r\n    --chain=\"mainnet\" \\\r\n    --rest-server'\r\n```\r\n\r\nChain/Network: Polygon Mainnet\r\n\r\n#### Expected behaviour\r\n\r\n```\r\ncurl http://127.0.0.1:8545 -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\": \"2.0\", \"method\": \"eth_getTransactionReceipt\", \"params\": [\"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\"],\"id\": 1}'  | jq .\r\n    {\r\n      \"jsonrpc\": \"2.0\",\r\n      \"id\": 1,\r\n      \"result\": {\r\n        \"blockHash\": \"0x8de4d6cf81c93b4232b91faa280e633d7ddcecbb6c6bc9c53a6cef0eb86df97f\",\r\n        \"blockNumber\": \"0x29ca15c\",\r\n        \"contractAddress\": null,\r\n        \"cumulativeGasUsed\": \"0xdfa9\",\r\n        \"effectiveGasPrice\": \"0xec79751c80\",\r\n        \"from\": \"0x84bc0b80bb981de57eb85d9ace4fb668df4ec590\",\r\n        \"gasUsed\": \"0xdfa9\",\r\n        \"logs\": [\r\n          {\r\n            \"address\": \"0x0000000000000000000000000000000000001010\",\r\n            \"topics\": [\r\n              \"0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63\",\r\n              \"0x0000000000000000000000000000000000000000000000000000000000001010\",\r\n              \"0x00000000000000000000000084bc0b80bb981de57eb85d9ace4fb668df4ec590\",\r\n              \"0x000000000000000000000000794e44d1334a56fea7f4df12633b88820d0c5888\"\r\n            ],\r\n            \"data\": \"0x00000000000000000000000000000000000000000000000000ac23d5e71616ee0000000000000000000000000000000000000000000000040bd716f828531899000000000000000000000000000000000000000000000046b4cf343b09a59a0e0000000000000000000000000000000000000000000000040b2af322413d01ab000000000000000000000000000000000000000000000046b57b5810f0bbb0fc\",\r\n            \"blockNumber\": \"0x29ca15c\",\r\n            \"transactionHash\": \"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\",\r\n            \"transactionIndex\": \"0x0\",\r\n            \"blockHash\": \"0x8de4d6cf81c93b4232b91faa280e633d7ddcecbb6c6bc9c53a6cef0eb86df97f\",\r\n            \"logIndex\": \"0x0\",\r\n            \"removed\": false\r\n          }\r\n        ],\r\n        \"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000080000000000000001000000000000000100000008000000000000000000000000000000000000000000000000000000000800000000000000000000100020000000000000000800000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000004000000000000000000001000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000020100000\",\r\n        \"status\": \"0x0\",\r\n        \"to\": \"0xe957a692c97566efc85f995162fa404091232b2e\",\r\n        \"transactionHash\": \"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\",\r\n        \"transactionIndex\": \"0x0\",\r\n        \"type\": \"0x0\"\r\n      }\r\n    }\r\n```\r\n\r\nNotice `\"from\": \"0x84bc0b80bb981de57eb85d9ace4fb668df4ec590\",`\r\n\r\n#### Actual behaviour\r\n\r\n```\r\ncurl http://127.0.0.1:8545 -s -X POST   -H \"Content-Type: application/json\"   --data '{\"method\":\"eth_getTransactionReceipt\",\"params\":[\"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\"],\"id\":1,\"jsonrpc\":\"2.0\"}' | jq\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 1,\r\n  \"result\": {\r\n    \"blockHash\": \"0x8de4d6cf81c93b4232b91faa280e633d7ddcecbb6c6bc9c53a6cef0eb86df97f\",\r\n    \"blockNumber\": \"0x29ca15c\",\r\n    \"contractAddress\": null,\r\n    \"cumulativeGasUsed\": \"0xdfa9\",\r\n    \"effectiveGasPrice\": \"0xec79751c80\",\r\n    \"from\": \"0x0000000000000000000000000000000000000000\",\r\n    \"gasUsed\": \"0xdfa9\",\r\n    \"logs\": [\r\n      {\r\n        \"address\": \"0x0000000000000000000000000000000000001010\",\r\n        \"topics\": [\r\n          \"0x4dfe1bbbcf077ddc3e01291eea2d5c70c2b422b415d95645b9adcfd678cb1d63\",\r\n          \"0x0000000000000000000000000000000000000000000000000000000000001010\",\r\n          \"0x00000000000000000000000084bc0b80bb981de57eb85d9ace4fb668df4ec590\",\r\n          \"0x000000000000000000000000794e44d1334a56fea7f4df12633b88820d0c5888\"\r\n        ],\r\n        \"data\": \"0x00000000000000000000000000000000000000000000000000ac23d5e71616ee0000000000000000000000000000000000000000000000040bd716f828531899000000000000000000000000000000000000000000000046b4cf343b09a59a0e0000000000000000000000000000000000000000000000040b2af322413d01ab000000000000000000000000000000000000000000000046b57b5810f0bbb0fc\",\r\n        \"blockNumber\": \"0x29ca15c\",\r\n        \"transactionHash\": \"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\",\r\n        \"transactionIndex\": \"0x0\",\r\n        \"blockHash\": \"0x8de4d6cf81c93b4232b91faa280e633d7ddcecbb6c6bc9c53a6cef0eb86df97f\",\r\n        \"logIndex\": \"0x0\",\r\n        \"removed\": false\r\n      }\r\n    ],\r\n    \"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000080000000000000001000000000000000100000008000000000000000000000000000000000000000000000000000000000800000000000000000000100020000000000000000800000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000004000000000000000000001000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000020100000\",\r\n    \"status\": \"0x0\",\r\n    \"to\": \"0xe957a692c97566efc85f995162fa404091232b2e\",\r\n    \"transactionHash\": \"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\",\r\n    \"transactionIndex\": \"0x0\",\r\n    \"type\": \"0x0\"\r\n  }\r\n}\r\n```\r\nNotice `\"from\": \"0x0000000000000000000000000000000000000000\",` while on [Polygonscan](https://polygonscan.com/tx/0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473) transaction `0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473` has `from` = `0x84bC0b80bb981dE57Eb85d9Ace4Fb668DF4EC590`\r\n\r\n#### Steps to reproduce the behaviour\r\nOn the same node we made the same RPC call multiple times at different times and we got differing responses. Most of the time it responds with an invalid `from` equal to `0x000...` but sometimes we get the correct `from`. This is also only observed on block numbers in the range `43819356` to `45991847` \r\n\r\nCould this be some sort of caching issue or invalid database created from a corrupted snapshot?\r\n\r\n#### Backtrace\r\nNA\r\n",
  "closed_by": {
    "login": "gobblegobble1",
    "id": 152538708,
    "node_id": "U_kgDOCReOVA",
    "avatar_url": "https://avatars.githubusercontent.com/u/152538708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gobblegobble1",
    "html_url": "https://github.com/gobblegobble1",
    "followers_url": "https://api.github.com/users/gobblegobble1/followers",
    "following_url": "https://api.github.com/users/gobblegobble1/following{/other_user}",
    "gists_url": "https://api.github.com/users/gobblegobble1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gobblegobble1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gobblegobble1/subscriptions",
    "organizations_url": "https://api.github.com/users/gobblegobble1/orgs",
    "repos_url": "https://api.github.com/users/gobblegobble1/repos",
    "events_url": "https://api.github.com/users/gobblegobble1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gobblegobble1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1884003917",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/9186#issuecomment-1884003917",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/9186",
    "id": 1884003917,
    "node_id": "IC_kwDOC0FsAM5wS55N",
    "user": {
      "login": "gobblegobble1",
      "id": 152538708,
      "node_id": "U_kgDOCReOVA",
      "avatar_url": "https://avatars.githubusercontent.com/u/152538708?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gobblegobble1",
      "html_url": "https://github.com/gobblegobble1",
      "followers_url": "https://api.github.com/users/gobblegobble1/followers",
      "following_url": "https://api.github.com/users/gobblegobble1/following{/other_user}",
      "gists_url": "https://api.github.com/users/gobblegobble1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gobblegobble1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gobblegobble1/subscriptions",
      "organizations_url": "https://api.github.com/users/gobblegobble1/orgs",
      "repos_url": "https://api.github.com/users/gobblegobble1/repos",
      "events_url": "https://api.github.com/users/gobblegobble1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gobblegobble1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-10T00:27:32Z",
    "updated_at": "2024-01-10T00:27:32Z",
    "author_association": "NONE",
    "body": "`trace_transactions` is also returning an error:\r\n\r\n```\r\ncurl http://127.0.0.1:8545 -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\": \"2.0\", \"method\": \"trace_transaction\", \"params\": [\"0x6d391995935d9fd397143128461fd8f217c45dc73e905a36c93032f8faad6473\"],\"id\": 1}'  | jq .\r\n\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 1,\r\n  \"error\": {\r\n    \"code\": -32000,\r\n    \"message\": \"first run for txIndex 0 error: nonce too high: address 0x0000000000000000000000000000000000000000, tx: 7648 state: 0\"\r\n  }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1884003917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
