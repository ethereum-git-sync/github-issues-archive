{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2482",
  "id": 958480704,
  "node_id": "MDU6SXNzdWU5NTg0ODA3MDQ=",
  "number": 2482,
  "title": "Containerizing erigon to sync multiple chains",
  "user": {
    "login": "1blockologist",
    "id": 21366360,
    "node_id": "MDQ6VXNlcjIxMzY2MzYw",
    "avatar_url": "https://avatars.githubusercontent.com/u/21366360?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/1blockologist",
    "html_url": "https://github.com/1blockologist",
    "followers_url": "https://api.github.com/users/1blockologist/followers",
    "following_url": "https://api.github.com/users/1blockologist/following{/other_user}",
    "gists_url": "https://api.github.com/users/1blockologist/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/1blockologist/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/1blockologist/subscriptions",
    "organizations_url": "https://api.github.com/users/1blockologist/orgs",
    "repos_url": "https://api.github.com/users/1blockologist/repos",
    "events_url": "https://api.github.com/users/1blockologist/events{/privacy}",
    "received_events_url": "https://api.github.com/users/1blockologist/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-02T20:23:48Z",
  "updated_at": "2021-08-04T17:19:07Z",
  "closed_at": "2021-08-04T17:19:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I see some sporadic documentation about docker, but has anybody tried using erigon to stay synced with multiple chains on the same machine? The primary issue seems to be the memory consumption as erigon will use all available. Putting in a container may have its own pros and cons such as needing to configure networking for each instance. Maybe another solution would be a flag to limit its memory consumption, does that flag exist already?\r\n\r\nCurious what others have done",
  "closed_by": {
    "login": "1blockologist",
    "id": 21366360,
    "node_id": "MDQ6VXNlcjIxMzY2MzYw",
    "avatar_url": "https://avatars.githubusercontent.com/u/21366360?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/1blockologist",
    "html_url": "https://github.com/1blockologist",
    "followers_url": "https://api.github.com/users/1blockologist/followers",
    "following_url": "https://api.github.com/users/1blockologist/following{/other_user}",
    "gists_url": "https://api.github.com/users/1blockologist/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/1blockologist/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/1blockologist/subscriptions",
    "organizations_url": "https://api.github.com/users/1blockologist/orgs",
    "repos_url": "https://api.github.com/users/1blockologist/repos",
    "events_url": "https://api.github.com/users/1blockologist/events{/privacy}",
    "received_events_url": "https://api.github.com/users/1blockologist/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/891475908",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2482#issuecomment-891475908",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482",
    "id": 891475908,
    "node_id": "IC_kwDOC0FsAM41ItfE",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-03T02:52:51Z",
    "updated_at": "2021-08-03T02:52:51Z",
    "author_association": "COLLABORATOR",
    "body": "Memory consumption: because Erigon rely on OS's PageCache - then OS own most of memory used by Erigon. It means if OS need memory in another place it easily can do - because OS own the memory. Erigon itself using 1Gb. \r\n(we have 1 issue with high RAM consumption by Erigon: https://github.com/ledgerwatch/erigon/pull/2477 - so, set `--blockDownloaderWindow=16384` to minimize RAM usage by Erigon). \r\n\r\n\r\nAbout docs: see our docker-compose.yml as example.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/891475908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/891478285",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2482#issuecomment-891478285",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482",
    "id": 891478285,
    "node_id": "IC_kwDOC0FsAM41IuEN",
    "user": {
      "login": "1blockologist",
      "id": 21366360,
      "node_id": "MDQ6VXNlcjIxMzY2MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/21366360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/1blockologist",
      "html_url": "https://github.com/1blockologist",
      "followers_url": "https://api.github.com/users/1blockologist/followers",
      "following_url": "https://api.github.com/users/1blockologist/following{/other_user}",
      "gists_url": "https://api.github.com/users/1blockologist/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/1blockologist/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/1blockologist/subscriptions",
      "organizations_url": "https://api.github.com/users/1blockologist/orgs",
      "repos_url": "https://api.github.com/users/1blockologist/repos",
      "events_url": "https://api.github.com/users/1blockologist/events{/privacy}",
      "received_events_url": "https://api.github.com/users/1blockologist/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-03T02:58:46Z",
    "updated_at": "2021-08-03T02:58:46Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov in the current default settings, it will max out at 64Gb RAM? Like if I had 128Gb it would only occupy 64?\r\n\r\nSecondly, is there some utility in setting the flag higher while doing initial sync, and then closing the process and running it again with much lower memory allocation?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/891478285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/891488309",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2482#issuecomment-891488309",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2482",
    "id": 891488309,
    "node_id": "IC_kwDOC0FsAM41Iwg1",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-03T03:21:38Z",
    "updated_at": "2021-08-03T03:21:38Z",
    "author_association": "COLLABORATOR",
    "body": "Again, 2 parts of memory:\r\n1. Owned by Erigon - in-general must be ~1Gb, but because of our bug with `--blockDownloaderWindow` default now using ~8Gb. If you set `--blockDownloaderWindow=16384` then it must ~1Gb. To limit this mem can reduce: --batchSize, --blockDownloaderWindow flags. \r\n2. Owned by OS - unlimited and it will use all RAM just because Erigon's db>ram, but you still can run 10 Erigon's - OS will manage the ram (to keep Hot data in RAM and evict Cold). This part of RAM can survive Erigon's reboot because owned by OS. If any other non-erigon application will need RAM - OS will manage to give it and evict Erigon's data. This is how MMap and PageCache work. No flags to limit this. Maybe Docker or Linux have settings to limit something but I can't advise. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/891488309/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
