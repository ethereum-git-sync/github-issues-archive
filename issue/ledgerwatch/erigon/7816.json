{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7816",
  "id": 1779283129,
  "node_id": "I_kwDOC0FsAM5qDbS5",
  "number": 7816,
  "title": "Polygon and Polygon Mumbai node failed to sync after unwind",
  "user": {
    "login": "gladcow",
    "id": 28437763,
    "node_id": "MDQ6VXNlcjI4NDM3NzYz",
    "avatar_url": "https://avatars.githubusercontent.com/u/28437763?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gladcow",
    "html_url": "https://github.com/gladcow",
    "followers_url": "https://api.github.com/users/gladcow/followers",
    "following_url": "https://api.github.com/users/gladcow/following{/other_user}",
    "gists_url": "https://api.github.com/users/gladcow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gladcow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gladcow/subscriptions",
    "organizations_url": "https://api.github.com/users/gladcow/orgs",
    "repos_url": "https://api.github.com/users/gladcow/repos",
    "events_url": "https://api.github.com/users/gladcow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gladcow/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-06-28T16:18:45Z",
  "updated_at": "2023-08-16T02:01:29Z",
  "closed_at": "2023-08-16T02:01:29Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2.47.0-stable-5536d645`\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: 5536d645942aca88b893a5cb1c9aaf16c8e66ee5\r\n\r\nErigon Command (with flags/config): `./erigon --chain=mumbai --datadir=~/chains/mumbai --prune=htc --bor.heimdall=https://heimdall-api-testnet.polygon.technology/`\r\n\r\nChain/Network: Polygon and Polygon Mumbai\r\n\r\n#### Expected behaviour\r\nCorrect sync after unwind\r\n\r\n#### Actual behaviour\r\nSync after unwind is failed with error like (block number can be different):\r\n```\r\nINFO[06-20|18:47:45.681] [txpool] stat                            pending=277 baseFee=0 queued=1330 alloc=2.8GB sys=3.3GB\r\nINFO[06-20|18:47:47.340] [9/15 IntermediateHashes] Generating intermediate hashes from=37069439 to=37078566\r\nEROR[06-20|18:47:57.860] [9/15 IntermediateHashes] Wrong trie root of block 37078566: caeaa3dcf487411a07004c5c71bef4556831aada33a815981bd8bc07940a45fa, expected (from header): 1fb0d4558752e1e308197b31f67d3e6c6baa46c3fb6ac944a1f5f7263932d45b. Block hash: 42c8e841c1f8df2e40db8da380ec62fbc569da9e9bf0523543885c5c92331c05 \r\nWARN[06-20|18:47:57.860] Unwinding due to incorrect root hash     to=37074002\r\nINFO[06-20|18:47:57.860] UnwindTo                                 block=37074002 bad_block_hash=0x42c8e841c1f8df2e40db8da380ec62fbc569da9e9bf0523543885c5c92331c05\r\nINFO[06-20|18:47:57.860] [8/15 HashState] Unwinding started       from=37078566 to=37074002 storage=false codes=true\r\nINFO[06-20|18:47:57.987] [8/15 HashState] Unwinding started       from=37078566 to=37074002 storage=false codes=false\r\nINFO[06-20|18:47:58.306] [8/15 HashState] Unwinding started       from=37078566 to=37074002 storage=true codes=false\r\nINFO[06-20|18:48:01.494] [7/15 Execution] Unwind Execution        from=37078566 to=37074002\r\n```\r\nBlock number 37078566 was processed correctly before unwind (including IntermediateHash calculation),  error occurs only in second start after integration unwind call. Error always occure in  [9/15 IntermediateHashes] stage,  but with different block numbers\r\n\r\n#### Steps to reproduce the behaviour\r\n1. Start erigon node with command like `./erigon --chain=mumbai --datadir=~/chains/mumbai --prune=htc --bor.heimdall=https://heimdall-api-testnet.polygon.technology/`\r\n2. Wait for full sync (all stages are done) and stop the node\r\n3. Call unwind with `./integration state_stages --chain=mumbai --datadir=~/chains/mumbai --unwind=2000`\r\n4. Start the node again and wait for [9/15 IntermediateHashes]  stage\r\n\r\n",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1611735226",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7816#issuecomment-1611735226",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816",
    "id": 1611735226,
    "node_id": "IC_kwDOC0FsAM5gESC6",
    "user": {
      "login": "gladcow",
      "id": 28437763,
      "node_id": "MDQ6VXNlcjI4NDM3NzYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/28437763?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gladcow",
      "html_url": "https://github.com/gladcow",
      "followers_url": "https://api.github.com/users/gladcow/followers",
      "following_url": "https://api.github.com/users/gladcow/following{/other_user}",
      "gists_url": "https://api.github.com/users/gladcow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gladcow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gladcow/subscriptions",
      "organizations_url": "https://api.github.com/users/gladcow/orgs",
      "repos_url": "https://api.github.com/users/gladcow/repos",
      "events_url": "https://api.github.com/users/gladcow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gladcow/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-28T16:24:44Z",
    "updated_at": "2023-06-28T16:24:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like some Bor-specific data are processed with error during unwind,  but I've failed to discover the root cause. I can try to fix it myself if you can help with some advice about where to search for possible reason (I've tried,  but failed).\r\n\r\nI have tried to reproduce this issue with hardcoded unwind during first 30000 blocks in Mumbai,  but looks like it works correctly for such heights,( Fuill Mumbai sync takes about 4 days on my server,  so every try takes several days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1611735226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612252079",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7816#issuecomment-1612252079",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816",
    "id": 1612252079,
    "node_id": "IC_kwDOC0FsAM5gGQOv",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-28T23:57:33Z",
    "updated_at": "2023-06-28T23:57:33Z",
    "author_association": "COLLABORATOR",
    "body": "Try: \r\n./integration stage_headers --chain=mumbai --datadir=~/chains/mumbai --reset",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612252079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1668809033",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7816#issuecomment-1668809033",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816",
    "id": 1668809033,
    "node_id": "IC_kwDOC0FsAM5jeAFJ",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-08-08T02:17:19Z",
    "updated_at": "2023-08-08T02:17:19Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1668809033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1679856871",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7816#issuecomment-1679856871",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7816",
    "id": 1679856871,
    "node_id": "IC_kwDOC0FsAM5kIJTn",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-08-16T02:01:29Z",
    "updated_at": "2023-08-16T02:01:29Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1679856871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
