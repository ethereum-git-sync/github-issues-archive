{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7131",
  "id": 1630269628,
  "node_id": "I_kwDOC0FsAM5hK_C8",
  "number": 7131,
  "title": "ERIGON LAGGING BEHIND",
  "user": {
    "login": "fernandezpaco",
    "id": 6205118,
    "node_id": "MDQ6VXNlcjYyMDUxMTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6205118?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fernandezpaco",
    "html_url": "https://github.com/fernandezpaco",
    "followers_url": "https://api.github.com/users/fernandezpaco/followers",
    "following_url": "https://api.github.com/users/fernandezpaco/following{/other_user}",
    "gists_url": "https://api.github.com/users/fernandezpaco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fernandezpaco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fernandezpaco/subscriptions",
    "organizations_url": "https://api.github.com/users/fernandezpaco/orgs",
    "repos_url": "https://api.github.com/users/fernandezpaco/repos",
    "events_url": "https://api.github.com/users/fernandezpaco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fernandezpaco/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-03-18T10:35:21Z",
  "updated_at": "2023-03-18T10:46:57Z",
  "closed_at": "2023-03-18T10:46:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2.40.1-stable-94b4cee5`\r\n\r\nOS & Version: AMAZON Linux (i3en.xlarge 2500 NVMe SSD 4CPU 32gbRAM)\r\n\r\nErigon Command (with flags/config):\r\n./build/bin/erigon \r\n--datadir /mnt/nvm/ether \r\n--private.api.addr=localhost:8546 \r\n--http.vhosts=* \r\n--prune.h.older=90000 \r\n--prune.r.older=90000 \r\n--prune.t.older=90000 \r\n--prune.c.older=90000 \r\n--http.api=eth,debug,net,trace,web3,erigon \r\n--lightclient.discovery.addr=0.0.0.0 &\r\n\r\nConsensus Layer: Embedded\r\n\r\nChain/Network:  MAINNET\r\n\r\n#### Expected behaviour\r\nStay on sync\r\n\r\n#### Actual behaviour\r\nErigon syncs but after a while lags behind, catches up and then laggs behind again, catches up and lags again...\r\n\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\n[INFO] [03-18|10:18:49.616] RPC Daemon notified of new headers       from=16853998 to=16853999 hash=0x77a2f2bcbe0044da41da4bac8d535c8774b231ea6c38641c23fa18f549ed76fc header sending=19.735µs log sending=614ns\r\n[INFO] [03-18|10:18:49.746] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:18:56.776] [p2p] GoodPeers                          eth67=16 eth66=4 eth68=5\r\n[INFO] [03-18|10:19:01.984] [2/15 Headers] Handling new payload      height=16854000 hash=0x91ff908e741eb2580e353d9e0160a586f7758b5d05327b73e3961e7f67b39275\r\n[INFO] [03-18|10:19:02.171] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:19:02.672] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload) \r\n[INFO] [03-18|10:19:02.959] Commit cycle                             in=61.911039ms\r\n[INFO] [03-18|10:19:02.959] Timings (slower than 50ms)               Headers=653ms\r\n[INFO] [03-18|10:19:02.959] Tables                                   PlainState=87.6GB AccountChangeSet=1.5GB StorageChangeSet=2.7GB BlockTransaction=9.8GB TransactionLog=7.4GB FreeList=445.8MB ReclaimableSpace=445.8GB\r\n[INFO] [03-18|10:19:02.959] RPC Daemon notified of new headers       from=16853999 to=16854000 hash=0x91ff908e741eb2580e353d9e0160a586f7758b5d05327b73e3961e7f67b39275 header sending=14.927µs log sending=199ns\r\n[INFO] [03-18|10:19:03.026] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:19:12.457] [2/15 Headers] Handling new payload      height=16854001 hash=0xd23c56fd55d2ba4be96487fef5b1cf7bfefbbd2d4f8164a37a8ddae87daea57c\r\n[INFO] [03-18|10:19:12.737] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:19:13.238] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload) \r\n[INFO] [03-18|10:19:13.616] Commit cycle                             in=92.323588ms\r\n[INFO] [03-18|10:19:13.616] Timings (slower than 50ms)               Headers=665ms\r\n[INFO] [03-18|10:19:13.616] Tables                                   PlainState=87.6GB AccountChangeSet=1.5GB StorageChangeSet=2.7GB BlockTransaction=9.8GB TransactionLog=7.4GB FreeList=445.8MB ReclaimableSpace=445.8GB\r\n[INFO] [03-18|10:19:13.616] RPC Daemon notified of new headers       from=16854000 to=16854001 hash=0xd23c56fd55d2ba4be96487fef5b1cf7bfefbbd2d4f8164a37a8ddae87daea57c header sending=16.707µs log sending=199ns\r\n[INFO] [03-18|10:19:13.772] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:19:22.365] [LightClient] P2P                        peers=6\r\n[INFO] [03-18|10:19:22.365] [txpool] stat                            block=16854001 pending=181 baseFee=106 queued=253 alloc=2.8GB sys=4.9GB\r\n[INFO] [03-18|10:19:25.176] [2/15 Headers] Handling new payload      height=16854002 hash=0x0a499a665cd40ecd1fb660e49050e9ca961883d771c14046639a5a80a3cac8c3\r\n[INFO] [03-18|10:19:25.740] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:19:26.240] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload) \r\n[INFO] [03-18|10:19:26.708] Commit cycle                             in=118.242089ms\r\n[INFO] [03-18|10:19:26.708] Timings (slower than 50ms)               Headers=677ms CallTraces=62ms StorageHistoryIndex=64ms\r\n[INFO] [03-18|10:19:26.708] Tables                                   PlainState=87.6GB AccountChangeSet=1.5GB StorageChangeSet=2.7GB BlockTransaction=9.8GB TransactionLog=7.4GB FreeList=445.8MB ReclaimableSpace=445.8GB\r\n[INFO] [03-18|10:19:26.708] RPC Daemon notified of new headers       from=16854001 to=16854002 hash=0x0a499a665cd40ecd1fb660e49050e9ca961883d771c14046639a5a80a3cac8c3 header sending=14.569µs log sending=682ns\r\n[INFO] [03-18|10:19:26.827] [2/15 Headers] Waiting for Consensus Layer... \r\n[WARN] [03-18|10:19:29.193] Served                                   conn=127.0.0.1:49948 method=trace_callMany reqid=1679134769189 t=204.725µs err=\"first run for txIndex 0 error: fee cap less than block base fee: address 0x3Ec76bA1dd47e251E62127196633f5e048d294ed, gasFeeCap: 16000000 baseFee: 13145363501\"\r\n[INFO] [03-18|10:20:10.177] [snapshots] Blocks Stat                  blocks=16764k indices=16764k alloc=3.5GB sys=4.9GB\r\n[INFO] [03-18|10:20:22.365] [txpool] stat                            block=16854002 pending=615 baseFee=235 queued=257 alloc=3.6GB sys=4.9GB\r\n[INFO] [03-18|10:20:22.365] [LightClient] P2P                        peers=2\r\n[WARN] [03-18|10:20:51.014] Served                                   conn=127.0.0.1:55404 method=trace_callMany reqid=1679134851009 t=247.922µs err=\"first run for txIndex 0 error: fee cap less than block base fee: address 0xd001C3bA9163c2992fe9561A7fB77b95cBF4B0d6, gasFeeCap: 352 baseFee: 13145363501\"\r\n[INFO] [03-18|10:20:56.776] [p2p] GoodPeers                          eth67=17 eth66=4 eth68=5\r\n[INFO] [03-18|10:21:22.365] [LightClient] P2P                        peers=3\r\n[INFO] [03-18|10:21:22.366] [txpool] stat                            block=16854002 pending=1329 baseFee=377 queued=262 alloc=2.3GB sys=4.9GB\r\n[INFO] [03-18|10:22:00.119] [2/15 Headers] Handling new payload      height=16854015 hash=0x5f40ca718354ae172e83283cee6a7832ba6b14c38e4158daf9bd571fe65f0c99\r\n[INFO] [03-18|10:22:00.127] [2/15 Headers] Downloading PoS headers... height=16854014 hash=0x5802d354e1f54239c2b86d1b4719e16cd954602a60daa471672c71dc5e624bd9 requestId=29\r\n[INFO] [03-18|10:22:19.337] PoS headers verified and saved           requestId=29 fork head=0xa739e2a217675d4c50c4b465e6d7d64c900222107113b3bb88d587b83aef5214\r\n[INFO] [03-18|10:22:21.593] [2/15 Headers] DONE                      in=2m54.766135837s\r\n[INFO] [03-18|10:22:21.739] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:22:21.884] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:22:22.240] [2/15 Headers] Fork choice: chain extension from=16854002 to=16854015\r\n[INFO] [03-18|10:22:22.717] [txpool] stat                            block=16854002 pending=2036 baseFee=465 queued=286 alloc=2.6GB sys=4.9GB\r\n[INFO] [03-18|10:22:23.163] [7/15 Execution] Completed on            block=16854015\r\n[INFO] [03-18|10:22:25.617] Commit cycle                             in=560.589348ms\r\n[INFO] [03-18|10:22:25.617] Timings (slower than 50ms)               Headers=355ms Bodies=136ms Senders=128ms Execution=657ms HashState=130ms IntermediateHashes=450ms CallTraces=297ms AccountHistoryIndex=192ms StorageHistoryIndex=455ms LogIndex=200ms TxLookup=165ms\r\n[INFO] [03-18|10:22:25.617] Tables                                   PlainState=87.6GB AccountChangeSet=1.5GB StorageChangeSet=2.7GB BlockTransaction=9.7GB TransactionLog=7.4GB FreeList=445.9MB ReclaimableSpace=445.9GB\r\n[INFO] [03-18|10:22:25.617] RPC Daemon notified of new headers       from=16854002 to=16854015 hash=0x5f40ca718354ae172e83283cee6a7832ba6b14c38e4158daf9bd571fe65f0c99 header sending=51.301µs log sending=218ns\r\n[INFO] [03-18|10:22:26.678] [LightClient] P2P                        peers=1\r\n[INFO] [03-18|10:22:26.678] [2/15 Headers] Waiting for Consensus Layer... \r\n[INFO] [03-18|10:22:56.777] [p2p] GoodPeers                          eth66=4 eth67=24 eth68=5\r\n[INFO] [03-18|10:23:22.365] [LightClient] P2P                        peers=3\r\n[INFO] [03-18|10:23:22.366] [txpool] stat                            block=16854015 pending=1130 baseFee=287 queued=275 alloc=3.3GB sys=4.9GB\r\n\r\n\r\n````\r\n",
  "closed_by": {
    "login": "fernandezpaco",
    "id": 6205118,
    "node_id": "MDQ6VXNlcjYyMDUxMTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6205118?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fernandezpaco",
    "html_url": "https://github.com/fernandezpaco",
    "followers_url": "https://api.github.com/users/fernandezpaco/followers",
    "following_url": "https://api.github.com/users/fernandezpaco/following{/other_user}",
    "gists_url": "https://api.github.com/users/fernandezpaco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fernandezpaco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fernandezpaco/subscriptions",
    "organizations_url": "https://api.github.com/users/fernandezpaco/orgs",
    "repos_url": "https://api.github.com/users/fernandezpaco/repos",
    "events_url": "https://api.github.com/users/fernandezpaco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fernandezpaco/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1474809912",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7131#issuecomment-1474809912",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7131",
    "id": 1474809912,
    "node_id": "IC_kwDOC0FsAM5X59A4",
    "user": {
      "login": "fernandezpaco",
      "id": 6205118,
      "node_id": "MDQ6VXNlcjYyMDUxMTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6205118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fernandezpaco",
      "html_url": "https://github.com/fernandezpaco",
      "followers_url": "https://api.github.com/users/fernandezpaco/followers",
      "following_url": "https://api.github.com/users/fernandezpaco/following{/other_user}",
      "gists_url": "https://api.github.com/users/fernandezpaco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fernandezpaco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fernandezpaco/subscriptions",
      "organizations_url": "https://api.github.com/users/fernandezpaco/orgs",
      "repos_url": "https://api.github.com/users/fernandezpaco/repos",
      "events_url": "https://api.github.com/users/fernandezpaco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fernandezpaco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-18T10:46:49Z",
    "updated_at": "2023-03-18T10:46:49Z",
    "author_association": "NONE",
    "body": "closing in favor of https://github.com/ledgerwatch/erigon/issues/7129",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1474809912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
