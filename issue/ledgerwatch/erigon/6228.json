{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6228",
  "id": 1481366828,
  "node_id": "I_kwDOC0FsAM5YS90s",
  "number": 6228,
  "title": "Firewall blocks Erigon CL peer discovery",
  "user": {
    "login": "stefancristianco",
    "id": 5373163,
    "node_id": "MDQ6VXNlcjUzNzMxNjM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5373163?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stefancristianco",
    "html_url": "https://github.com/stefancristianco",
    "followers_url": "https://api.github.com/users/stefancristianco/followers",
    "following_url": "https://api.github.com/users/stefancristianco/following{/other_user}",
    "gists_url": "https://api.github.com/users/stefancristianco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stefancristianco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stefancristianco/subscriptions",
    "organizations_url": "https://api.github.com/users/stefancristianco/orgs",
    "repos_url": "https://api.github.com/users/stefancristianco/repos",
    "events_url": "https://api.github.com/users/stefancristianco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stefancristianco/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2022-12-07T08:51:33Z",
  "updated_at": "2023-07-14T02:49:58Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am trying to run erigon in archive mode on a server hosted by Hetzner. They provide a free \"stateless\" firewall solution that I am trying to configure and in general all works well except CL peer discovery.\r\n\r\nSo, while firewall is active I always see in logs \"peers=0\". All works fine if I turn off the firewall and it also keeps working fine for a while, with firewall on, if trusted peers are already known.\r\n\r\nThis is how I configured the firewall rules:\r\n![Screenshot from 2022-12-07 10-39-40](https://user-images.githubusercontent.com/5373163/206130202-2ed500f5-ea89-42fe-9960-f709f80a4a78.png)\r\n\r\nAll outgoing traffic is permitted, all incoming traffic is dropped unless it matches one of the rules.\r\n\r\nCan someone please help explain what might be missing in my firewall rules?",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1340784262",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1340784262",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1340784262,
    "node_id": "IC_kwDOC0FsAM5P6r6G",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T10:56:06Z",
    "updated_at": "2022-12-07T10:56:06Z",
    "author_association": "COLLABORATOR",
    "body": "1. see our readme section about firewalls\r\n2. see https://github.com/ledgerwatch/erigon/issues/6117#issuecomment-1328949007\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1340784262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1340825407",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1340825407",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1340825407,
    "node_id": "IC_kwDOC0FsAM5P618_",
    "user": {
      "login": "stefancristianco",
      "id": 5373163,
      "node_id": "MDQ6VXNlcjUzNzMxNjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5373163?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefancristianco",
      "html_url": "https://github.com/stefancristianco",
      "followers_url": "https://api.github.com/users/stefancristianco/followers",
      "following_url": "https://api.github.com/users/stefancristianco/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefancristianco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefancristianco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefancristianco/subscriptions",
      "organizations_url": "https://api.github.com/users/stefancristianco/orgs",
      "repos_url": "https://api.github.com/users/stefancristianco/repos",
      "events_url": "https://api.github.com/users/stefancristianco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefancristianco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T11:21:58Z",
    "updated_at": "2022-12-07T11:21:58Z",
    "author_association": "NONE",
    "body": "> 1. see our readme section about firewalls\r\nI checked this already. The erigon service provides RPC API to some local running apps. So, from what I can tell so far, the only ports that need to be exposed are 30303 and 30304. Did I miss anything?\r\n\r\n> 2. see [Hetzner port scanning (:4000) - Downloader: re-write \"is ipv6 enabled\" logicÂ #6117 (comment)](https://github.com/ledgerwatch/erigon/issues/6117#issuecomment-1328949007)\r\nYes, this issue looks similar. I hope the solution worked, let's see if anyone replies.\r\n\r\nThanks\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1340825407/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1341711398",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1341711398",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1341711398,
    "node_id": "IC_kwDOC0FsAM5P-OQm",
    "user": {
      "login": "nikolinsko",
      "id": 11374421,
      "node_id": "MDQ6VXNlcjExMzc0NDIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/11374421?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikolinsko",
      "html_url": "https://github.com/nikolinsko",
      "followers_url": "https://api.github.com/users/nikolinsko/followers",
      "following_url": "https://api.github.com/users/nikolinsko/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikolinsko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikolinsko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikolinsko/subscriptions",
      "organizations_url": "https://api.github.com/users/nikolinsko/orgs",
      "repos_url": "https://api.github.com/users/nikolinsko/repos",
      "events_url": "https://api.github.com/users/nikolinsko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikolinsko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T23:00:58Z",
    "updated_at": "2022-12-07T23:01:13Z",
    "author_association": "NONE",
    "body": "is erigon picking up your public ip correctly? a had to set --nat extip to get it to work on hetzner",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1341711398/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1342253774",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1342253774",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1342253774,
    "node_id": "IC_kwDOC0FsAM5QASrO",
    "user": {
      "login": "stefancristianco",
      "id": 5373163,
      "node_id": "MDQ6VXNlcjUzNzMxNjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5373163?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefancristianco",
      "html_url": "https://github.com/stefancristianco",
      "followers_url": "https://api.github.com/users/stefancristianco/followers",
      "following_url": "https://api.github.com/users/stefancristianco/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefancristianco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefancristianco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefancristianco/subscriptions",
      "organizations_url": "https://api.github.com/users/stefancristianco/orgs",
      "repos_url": "https://api.github.com/users/stefancristianco/repos",
      "events_url": "https://api.github.com/users/stefancristianco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefancristianco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T08:20:02Z",
    "updated_at": "2022-12-08T08:20:02Z",
    "author_association": "NONE",
    "body": "> is erigon picking up your public ip correctly? a had to set --nat extip to get it to work on hetzner\r\n\r\nNot sure how to answer. Erigon is working fine without firewall, and it's also being run from within a docker container.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1342253774/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1343879441",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1343879441",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1343879441,
    "node_id": "IC_kwDOC0FsAM5QGfkR",
    "user": {
      "login": "stefancristianco",
      "id": 5373163,
      "node_id": "MDQ6VXNlcjUzNzMxNjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5373163?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefancristianco",
      "html_url": "https://github.com/stefancristianco",
      "followers_url": "https://api.github.com/users/stefancristianco/followers",
      "following_url": "https://api.github.com/users/stefancristianco/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefancristianco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefancristianco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefancristianco/subscriptions",
      "organizations_url": "https://api.github.com/users/stefancristianco/orgs",
      "repos_url": "https://api.github.com/users/stefancristianco/repos",
      "events_url": "https://api.github.com/users/stefancristianco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefancristianco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-09T05:44:39Z",
    "updated_at": "2022-12-09T05:45:58Z",
    "author_association": "NONE",
    "body": "Today I got the second message from Hetzner with title \"Network abuse\". Their software is detecting an attack from my server running erigon. All this started happening right after I upgraded to latest tag v2.30.0 (I was previously running with alpha branch) and I've changed the configuration to use erigon internal CL instead of prysm.\r\nNote, that I've been using prysm since the merge and never had any issues.\r\n\r\nThe netscan snippet I got in the e-mail is highlighting UDP port 4000:\r\n\r\nThu Dec  8 20:12:24 2022 UDP  ***.***.***.*** 4000  =>  100.74.129.239 30303\r\nThu Dec  8 20:13:36 2022 UDP  ***.***.***.*** 4000  =>  100.74.129.239 30303\r\nThu Dec  8 20:14:26 2022 UDP  ***.***.***.*** 4000  =>  100.74.129.239 30303\r\nThu Dec  8 20:14:47 2022 UDP  ***.***.***.*** 4000  =>  100.74.129.239 30303\r\nThu Dec  8 20:14:53 2022 UDP  ***.***.***.*** 4000  =>  100.74.129.239 30303\r\nThu Dec  8 20:12:36 2022 UDP  ***.***.***.*** 4000  =>  100.73.229.248 19000\r\nThu Dec  8 20:13:26 2022 UDP  ***.***.***.*** 4000  =>  100.73.229.248 19000\r\nThu Dec  8 20:14:05 2022 UDP  ***.***.***.*** 4000  =>  100.73.229.248 19000\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1343879441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1344593693",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1344593693",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1344593693,
    "node_id": "IC_kwDOC0FsAM5QJN8d",
    "user": {
      "login": "nikolinsko",
      "id": 11374421,
      "node_id": "MDQ6VXNlcjExMzc0NDIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/11374421?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikolinsko",
      "html_url": "https://github.com/nikolinsko",
      "followers_url": "https://api.github.com/users/nikolinsko/followers",
      "following_url": "https://api.github.com/users/nikolinsko/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikolinsko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikolinsko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikolinsko/subscriptions",
      "organizations_url": "https://api.github.com/users/nikolinsko/orgs",
      "repos_url": "https://api.github.com/users/nikolinsko/repos",
      "events_url": "https://api.github.com/users/nikolinsko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikolinsko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-09T17:54:01Z",
    "updated_at": "2022-12-09T17:54:01Z",
    "author_association": "NONE",
    "body": "i guess it wont help as the connection seems to be fine without the firewall settings.\r\n\r\nErigon picks up the local ip at my hetzner sever on startup without the nat extip flag, which seemed to lead to no connectivity:\r\n\r\n```\r\n[INFO] [12-09|18:47:26.211] Started P2P networking version=66 self=enode://a080614.....385a@**XX.XX.XX.XX**:30303 name=erigon/v2.30.0-dev-a8ac42f4/linux-amd64/go1.18\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1344593693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1396367099",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1396367099",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1396367099,
    "node_id": "IC_kwDOC0FsAM5TOt77",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-01-19T02:37:38Z",
    "updated_at": "2023-01-19T02:37:38Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1396367099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1405945100",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6228#issuecomment-1405945100",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6228",
    "id": 1405945100,
    "node_id": "IC_kwDOC0FsAM5TzQUM",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-01-27T02:34:47Z",
    "updated_at": "2023-01-27T02:34:47Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1405945100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
