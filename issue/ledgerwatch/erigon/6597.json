{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6597",
  "id": 1535958652,
  "node_id": "I_kwDOC0FsAM5bjN58",
  "number": 6597,
  "title": "Regression in performance (between v2.31.0 and v2.34.0)",
  "user": {
    "login": "ngotchac",
    "id": 2864519,
    "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ngotchac",
    "html_url": "https://github.com/ngotchac",
    "followers_url": "https://api.github.com/users/ngotchac/followers",
    "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
    "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
    "organizations_url": "https://api.github.com/users/ngotchac/orgs",
    "repos_url": "https://api.github.com/users/ngotchac/repos",
    "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ngotchac/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2023-01-17T08:17:35Z",
  "updated_at": "2023-02-09T04:31:27Z",
  "closed_at": "2023-02-09T04:31:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nWe are running on Linux Debian, Erigon with both v2.30.0 and v2.34.0\r\n\r\nThe v2.34.0 was built with `make erigon` on source, since the binaries were not available.\r\n\r\n#### Issue\r\n\r\nWe are seeing some performance regression between our 2 nodes' version, v2.30.0 running fine, but v2.34.0 lagging behind. This happens on both Ethereum mainnet as well as Polygon.\r\n\r\nThis is our metrics on Ethereum, the green line being v2.34.0 and yellow v2.30.0 (not shown since it's in sync)\r\n![image](https://user-images.githubusercontent.com/2864519/212841243-2cc29eb5-dcb4-4907-8ded-2fa2bfd26e52.png)\r\n\r\nSame for Polygon (colours are reversed, yellow is v2.34.0):\r\n![image](https://user-images.githubusercontent.com/2864519/212841450-28fc1800-3ce0-4631-8ccb-1db4b68e377c.png)\r\n\r\nHere are some stats on our Ethereum server running v2.34.0:\r\n- Disk is `/dev/md1        7.7T  2.5T  4.8T  34% /` (4TB NVMe in RAID 0)\r\n- Disk usage over time (the break in the middle is when we updated to v2.34.0):\r\n![image](https://user-images.githubusercontent.com/2864519/212843245-e3ad0bf1-05ee-4d6b-9a5c-456563e7d16f.png)\r\n- Erigon stats: \r\n![image](https://user-images.githubusercontent.com/2864519/212843452-86531030-8eb3-41ca-9686-e0cf171c2481.png)\r\n\r\n\r\nI'm running the Polygon node with `pprof`, and everytime it's stuck it seems to be in `github.com/torquem-ch/mdbx-go/mdbx._Cfunc_mdbxgo_cursor_put2`, eg.:\r\n```\r\n#\t0x8d9c2b\tgithub.com/torquem-ch/mdbx-go/mdbx._Cfunc_mdbxgo_cursor_put2+0x4b\t\t_cgo_gotypes.go:1064\r\n#\t0x8dbe32\tgithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).Put.func1+0xb2\t\t\tgithub.com/torquem-ch/mdbx-go@v0.28.1/mdbx/cursor.go:233\r\n#\t0x8dbbf0\tgithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).Put+0x90\t\t\t\tgithub.com/torquem-ch/mdbx-go@v0.28.1/mdbx/cursor.go:233\r\n#\t0xde367d\tgithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxCursor).append+0x39d\t\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20230113043530-7c475cb52ecc/kv/mdbx/kv_mdbx.go:1248\r\n#\t0xde3680\tgithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxCursor).Append+0x3a0\t\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20230113043530-7c475cb52ecc/kv/mdbx/kv_mdbx.go:1617\r\n#\t0xddf9e7\tgithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxTx).Append+0x87\t\t\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20230113043530-7c475cb52ecc/kv/mdbx/kv_mdbx.go:1080\r\n#\t0xff32b2\tgithub.com/ledgerwatch/erigon/core/rawdb.AppendReceipts+0x1d2\t\t\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:1077\r\n#\t0x142c377\tgithub.com/ledgerwatch/erigon/eth/stagedsync.executeBlock+0x837\t\t\tgithub.com/ledgerwatch/erigon/eth/stagedsync/stage_execute.go:185\r\n#\t0x142f12d\tgithub.com/ledgerwatch/erigon/eth/stagedsync.SpawnExecuteBlocksStage+0xf4d\tgithub.com/ledgerwatch/erigon/eth/stagedsync/stage_execute.go:450\r\n#\t0x140a719\tgithub.com/ledgerwatch/erigon/eth/stagedsync.DefaultStages.func19+0xb9\t\tgithub.com/ledgerwatch/erigon/eth/stagedsync/default_stages.go:101\r\n#\t0x147838c\tgithub.com/ledgerwatch/erigon/eth/stagedsync.(*Sync).runStage+0x16c\t\tgithub.com/ledgerwatch/erigon/eth/stagedsync/sync.go:353\r\n#\t0x14771e4\tgithub.com/ledgerwatch/erigon/eth/stagedsync.(*Sync).Run+0x284\t\t\tgithub.com/ledgerwatch/erigon/eth/stagedsync/sync.go:255\r\n#\t0x1b9106a\tgithub.com/ledgerwatch/erigon/turbo/stages.StageLoopStep+0x48a\t\t\tgithub.com/ledgerwatch/erigon/turbo/stages/stageloop.go:167\r\n#\t0x1b90704\tgithub.com/ledgerwatch/erigon/turbo/stages.StageLoop+0x164\t\t\tgithub.com/ledgerwatch/erigon/turbo/stages/stageloop.go:95\r\n```\r\n\r\nSo maybe a regression in the latest MDBX release?\r\n\r\nI can share more info/data if needed!",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385118306",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385118306",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385118306,
    "node_id": "IC_kwDOC0FsAM5Sjzpi",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T09:50:29Z",
    "updated_at": "2023-01-17T09:54:47Z",
    "author_association": "COLLABORATOR",
    "body": "Hi. \r\n1. How long v2.34.0 is running? (Maybe new version need a bit time to adopt, existing db)\r\n2. Show logs\r\n3. Show `make db-tools` `./build/bin/mdbx_stat -ef <your_datadir>/chaindata`\r\n4. Do you have chart `GC and State`?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385118306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385145090",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385145090",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385145090,
    "node_id": "IC_kwDOC0FsAM5Sj6MC",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T10:09:14Z",
    "updated_at": "2023-01-17T10:09:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "1. It's been running for ~4 days for the Ethereum chain, and ~1 day for Polygon one (I restarted a couple of times)\r\n2. You can see logs for today here: https://gist.github.com/ngotchac/a9b5960492d806f0c1f179d9e720ea07 ; it starts to be out-of-sync around 04:00\r\n3. Output\r\n```\r\n$ ./build/bin/mdbx_stat -ef /var/lib/erigon/chaindata\r\nmdbx_stat v0.12.3-0-gf1fdb889 (2023-01-07T00:11:51+03:00, T-7c6941447b4b70d0657d92e9375af0ecfb3e4c71)\r\nRunning for /var/lib/erigon/chaindata...\r\nEnvironment Info\r\n  Pagesize: 4096\r\n  Dynamic datafile: 12288..8796093022208 bytes (+2147483648/-4294967296), 3..2147483648 pages (+524288/-1048576)\r\n  Current mapsize: 8796093022208 bytes, 2147483648 pages \r\n  Current datafile: 1917702897664 bytes, 468189184 pages\r\n  Last transaction ID: 12227920\r\n  Latter reader transaction ID: 12227920 (0)\r\n  Max readers: 32114\r\n  Number of reader slots uses: 3\r\nGarbage Collection\r\n  Pagesize: 4096\r\n  Tree depth: 3\r\n  Branch pages: 5\r\n  Leaf pages: 738\r\n  Overflow pages: 75696\r\n  Entries: 79727\r\nPage Usage\r\n  Total: 2147483648 100%\r\n  Backed: 468189184 21.8%\r\n  Allocated: 467965002 21.8%\r\n  Remained: 1679518646 78.2%\r\n  Used: 390869248 18.2%\r\n  GC: 77095754 3.6%\r\n  Retained: 20 0.0%\r\n  Reclaimable: 77095734 3.6%\r\n  Available: 1756614380 81.8%\r\nStatus of Main DB\r\n  Pagesize: 4096\r\n  Tree depth: 2\r\n  Branch pages: 1\r\n  Leaf pages: 3\r\n  Overflow pages: 0\r\n  Entries: 104\r\n```\r\n4. The charts:\r\nGC Overflow\r\n![image](https://user-images.githubusercontent.com/2864519/212869897-ce031aca-c65a-4db2-8b6e-eeae79f8cd89.png)\r\nGC Leaf\r\n![image](https://user-images.githubusercontent.com/2864519/212869960-8d6b56cc-a6a8-4c98-84a8-31f38d96e096.png)\r\nExec Steps in DB is always at 0\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385145090/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385272968",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385272968",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385272968,
    "node_id": "IC_kwDOC0FsAM5SkZaI",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T11:18:44Z",
    "updated_at": "2023-01-17T11:18:44Z",
    "author_association": "COLLABORATOR",
    "body": "GC looks good and reducing (but still, maybe it does some defrag of GC records...). \r\n- Please show last 24 hours of \"commit speed\"\r\n- Can you try to get `Commit speed` chart from last `./cmd/prometheus/dashboards/erigon.json` (there maybe more metrics).\r\n- What if you warmup gc by something like `./build/bin/mdbx_stat -efff /var/lib/erigon/chaindata > /dev/null`?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385272968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385308176",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385308176",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385308176,
    "node_id": "IC_kwDOC0FsAM5SkiAQ",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T11:50:51Z",
    "updated_at": "2023-01-17T11:51:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah actually it's not \"too much\" of an issue if it's temporary. Could it be that the DB was never properly cleaned-up before this release, so now it has to clean a lot of things? If so, I can let it run and update this issue if there is any progress.\r\n\r\nThe only thing I'm wondering is what is this happening now, if that's the case?\r\n\r\nHere's the `Commit speed` graph for the last 24h\r\n![image](https://user-images.githubusercontent.com/2864519/212891529-aa43ddc5-667b-4466-ace9-cccf72126355.png)\r\n\r\nI'm running the command and will see if it improves things",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385308176/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385352144",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385352144",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385352144,
    "node_id": "IC_kwDOC0FsAM5SksvQ",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T12:28:35Z",
    "updated_at": "2023-01-17T12:28:35Z",
    "author_association": "COLLABORATOR",
    "body": "1. Commit time is worse, but not so bad: 1s it's fine - because this commit actually happening after sending notifications about new header/block. So, it happening \"between block\" when node is free. My guess - it must get to normal after some time - because I didn't see such behavior in our tests. \r\n2. You mentioned that `rawdb.AppendReceipts` is slow. I don't see it in logs: line `Timings` doesn't show any slow stage. StageHeaders may be slow/slower - but it's likely not related to MDBX.\r\n3. Do you see any other symptoms? ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385352144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385357526",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385357526",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385357526,
    "node_id": "IC_kwDOC0FsAM5SkuDW",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T12:33:12Z",
    "updated_at": "2023-01-17T12:33:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah let's see if it improves over time. I was mainly wondering if there was a change you could think of in MDBX's usage that could explain this.\r\n\r\nRegarding the `rawdb.AppendReceipts` it was just an example of where the `stages.StageLoop` go-routine was stuck at (via `pprof`) for quite some time (>10minutes). That's why I thought it was an \"issue\" with MDBX.\r\n\r\nThanks for helping debugging BTW :+1: ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385357526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385366568",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385366568",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385366568,
    "node_id": "IC_kwDOC0FsAM5SkwQo",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T12:40:32Z",
    "updated_at": "2023-01-17T12:40:32Z",
    "author_association": "COLLABORATOR",
    "body": "1. There was over 9000 changes related to GC :-) Last 6 months we didn't upgrade mdbx because all that releases has problems with GC. But seems we fixed all. We know that migration from old version may take a bit of GC defrag, but your grafana shows that `commit.sync` also increased. But maybe it's just because your node was \"slow by another reason\" and processed many blocks every cycle instead of 1-by-1 and as a result it commit many blocks at once and in grafana we can see it as \"slower\" commit, but actually it just committed 1K blocks. You may show `Commit` chart to see frequency of commits. \r\n\r\n2. pprof doesn't show \"how long it stuck in given func\" as i remember... Of-course it can be the case. But I don't see slow Execution stage in \"Timings\" in logs. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385366568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385434189",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1385434189",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1385434189,
    "node_id": "IC_kwDOC0FsAM5SlAxN",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T13:36:00Z",
    "updated_at": "2023-01-17T13:36:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "So here's the Commit graph for the past 24h\r\n![image](https://user-images.githubusercontent.com/2864519/212912679-ac662c4b-9296-4e89-b881-5b7363528f56.png)\r\n\r\nFor (2) it was just my best guess of were it was stuck, looking at the go-routines in `pprof` and via the logs ehe",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1385434189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398456889",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1398456889",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1398456889,
    "node_id": "IC_kwDOC0FsAM5TWsI5",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-20T14:17:31Z",
    "updated_at": "2023-01-20T14:17:31Z",
    "author_association": "COLLABORATOR",
    "body": "@ngotchac how is it working now?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398456889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398461767",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1398461767",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1398461767,
    "node_id": "IC_kwDOC0FsAM5TWtVH",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-20T14:21:47Z",
    "updated_at": "2023-01-20T14:21:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @AskAlexSharov :) I'll update this issue again on Monday, but basically things look perfect on Ethereum:\r\n![image](https://user-images.githubusercontent.com/2864519/213720889-ec30335e-893a-4348-9240-5177cb640ad9.png)\r\n\r\nBut still lagging a bit behind on Polygon (the green line is for a server we updated on the 17th):\r\n![image](https://user-images.githubusercontent.com/2864519/213721130-ebb5bfcd-fafb-43f7-96d4-86dfcb3ebac0.png)\r\n\r\nIt might still be doing some DB GC work on Polygon, which has much more data. \r\n\r\nI'll update we some new data in a few days, but I think we'll be able to close this issue by then :crossed_fingers: ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398461767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398468270",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1398468270",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1398468270,
    "node_id": "IC_kwDOC0FsAM5TWu6u",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-20T14:27:21Z",
    "updated_at": "2023-01-20T14:27:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "To eliminate (or confirm) the MDBX upgrade being a culprit, can you please try branch `rollback-mdbx` ?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398468270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398472139",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1398472139",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1398472139,
    "node_id": "IC_kwDOC0FsAM5TWv3L",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-20T14:30:39Z",
    "updated_at": "2023-01-20T14:30:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "> To eliminate (or confirm) the MDBX upgrade being a culprit, can you please try branch `rollback-mdbx` ?\r\n\r\nI'll try that on Monday, sure! Can you just confirm it won't break the DB (if migrations has already been applied for example)? :sweat_smile: ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398472139/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398481725",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1398481725",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1398481725,
    "node_id": "IC_kwDOC0FsAM5TWyM9",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-20T14:38:39Z",
    "updated_at": "2023-01-20T14:38:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > To eliminate (or confirm) the MDBX upgrade being a culprit, can you please try branch `rollback-mdbx` ?\r\n> \r\n> I'll try that on Monday, sure! Can you just confirm it won't break the DB (if migrations has already been applied for example)? 😅\r\n\r\nhopefully by Monday it will all be figured out and patched :) No, it should not break the DB",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1398481725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1399151485",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1399151485",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1399151485,
    "node_id": "IC_kwDOC0FsAM5TZVt9",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-21T02:15:54Z",
    "updated_at": "2023-01-21T02:15:54Z",
    "author_association": "COLLABORATOR",
    "body": "what is your —db.pagesize?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1399151485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1400026568",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6597#issuecomment-1400026568",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6597",
    "id": 1400026568,
    "node_id": "IC_kwDOC0FsAM5TcrXI",
    "user": {
      "login": "ngotchac",
      "id": 2864519,
      "node_id": "MDQ6VXNlcjI4NjQ1MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2864519?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ngotchac",
      "html_url": "https://github.com/ngotchac",
      "followers_url": "https://api.github.com/users/ngotchac/followers",
      "following_url": "https://api.github.com/users/ngotchac/following{/other_user}",
      "gists_url": "https://api.github.com/users/ngotchac/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ngotchac/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ngotchac/subscriptions",
      "organizations_url": "https://api.github.com/users/ngotchac/orgs",
      "repos_url": "https://api.github.com/users/ngotchac/repos",
      "events_url": "https://api.github.com/users/ngotchac/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ngotchac/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-23T09:23:54Z",
    "updated_at": "2023-01-23T09:23:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "> what is your —db.pagesize?\r\n\r\nI was using the default value (didn't add any special argument), so it seems it was at 4KB\r\n\r\n> can you please try branch `rollback-mdbx`\r\n\r\nI guess the branch was deleted (merged?) so I'm currently testing the latest release, v2.36.1, on Polygon. It does look much better (I upgraded around 9:10):\r\n![image](https://user-images.githubusercontent.com/2864519/214004749-9e4f7869-bbeb-4cec-9456-a7afeafe681b.png)\r\n\r\nI'll report back at the EOD",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1400026568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
