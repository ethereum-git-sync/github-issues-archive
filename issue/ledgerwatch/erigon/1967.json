{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1967",
  "id": 896249870,
  "node_id": "MDU6SXNzdWU4OTYyNDk4NzA=",
  "number": 1967,
  "title": "Some dv2 errors faced this morning",
  "user": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-20T04:11:33Z",
  "updated_at": "2021-05-20T06:51:30Z",
  "closed_at": "2021-05-20T06:51:30Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "1. \r\ninvalid memory address or nil pointer dereference \r\n```\r\nmath/big.(*Int).Cmp(0x3c00b4af6e0, 0x0, 0x0) math/big/int.go:328 +0x5d github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderInserter).FeedHeader(0x3c011a2a120, 0x62b4c40, 0xc00022c080, 0x3c00a322b40, 0x3c001, 0x0, 0x0) github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload/header_algos.go:706 +0x977 github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderInserter).FeedHeaderFunc.func1(0x3c00a322b40, 0x3c001, 0x0, 0x0) github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload/header_algos.go:673 +0x7d github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderDownload).InsertHeaders(0xc0002bc1e0, 0x3c00b4af640, 0x3c0099ab0a0, 0xc, 0x3c011a28180, 0x0, 0x0, 0x0) github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload/header_algos.go:590\r\n```\r\n\r\n2. \r\nfatal error: concurrent map read and map write: \r\n```\r\ngithub.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderDownload).getLink(0xc0002bc1e0, 0x2edccab9ab2717a2, 0x4ca90a677b0e5312, 0x36951e37029af9d6, 0x7688048b46a046f7, 0x0, 0x3c00512ec00)\r\n\tgithub.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload/header_algos.go:646 +0x8a fp=0x3c000f8ee78 sp=0x3c000f8edf8 pc=0x4d72baa\r\ngithub.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderDownload).findLink(0xc0002bc1e0, 0x3c00990f050, 0x0, 0x0, 0x0)\r\n\tgithub.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload/header_algos.go:129 +0x205 fp=0x3c000f8ef70 sp=0x3c000f8ee78 pc=0x4d6b405\r\ngithub.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderDownload).ProcessSegment(0xc0002bc1e0, 0x3c00990f050, 0x0, 0xc00315ba80, 0x40, 0x0)\r\n\tgithub.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload/header_algos.go:795 +0x34e fp=0x3c000f8f600 sp=0x3c000f8ef70 pc=0x4d7576e\r\ngithub.com/ledgerwatch/turbo-geth/cmd/headers/download.(*ControlServerImpl).blockHeaders(0xc0002bc2d0, 0x62aa8d0, 0xc0004e9100, 0xc002cf5450, 0x62b6c70, 0xc0004e4730, 0x0, 0x0)\r\n```\r\n\r\n3. On empty db - on Ctrl+c\r\n```\r\nmdbx_txn_begin: MDBX_EBADSIGN: Wrong signature of a runtime object(s), e.g. memory corruption or double-free, trace: [github.com/ledgerwatch/turbo-geth/ethdb.(*MdbxKV).BeginRo github.com/ledgerwatch/turbo-geth/ethdb.(*MdbxKV).View github.com/ledgerwatch/turbo-geth/ethdb.(*ObjectDatabase).GetOne github.com/ledgerwatch/turbo-geth/eth/stagedsync/stages.GetStageProgress github.com/ledgerwatch/turbo-geth/eth/stagedsync.(*State).StageState github.com/ledgerwatch/turbo-geth/eth/stagedsync.(*State).runStage github.com/ledgerwatch/turbo-geth/eth/stagedsync.(*State).Run github.com/ledgerwatch/turbo-geth/turbo/stages.StageLoopStep github.com/ledgerwatch/turbo-geth/turbo/stages.StageLoop github.com/ledgerwatch/turbo-geth/cmd/headers/download.Loop]\"\r\nand\r\nmdbx_txn_begin: MDBX_EBADSIGN: Wrong signature of a runtime object(s), e.g. memory corruption or double-free, trace: [github.com/ledgerwatch/turbo-geth/ethdb.(*MdbxKV).BeginRo github.com/ledgerwatch/turbo-geth/ethdb.(*MdbxKV).View github.com/ledgerwatch/turbo-geth/turbo/stages/headerdownload.(*HeaderDownload).RecoverFromDb github.com/ledgerwatch/turbo-geth/turbo/stages.StageLoop github.com/ledgerwatch/turbo-geth/cmd/headers/download.Loop runtime.goexit]\"\r\n```\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/844682172",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1967#issuecomment-844682172",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1967",
    "id": 844682172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDY4MjE3Mg==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T04:38:29Z",
    "updated_at": "2021-05-20T04:53:00Z",
    "author_association": "COLLABORATOR",
    "body": "It was: \r\n1. next branch didn't return error (didn't stop execution)\r\n```\r\n if ancestor == nil {\r\n            log.Error(\"ancestor nil\", \"height\", ancestorHeight, \"hash\", ancestorHash)\r\n ```\r\n2. RecoverFromDb (when recover error of stageloop) happening in parallel with p2p - and RecoverFromDb has no locks\r\n3.  use db after close - no proper lifecycle of stagedsync goroutines - need add propper lifecycle for all goroutines in backend.go",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/844682172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
