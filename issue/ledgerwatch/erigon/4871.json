{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4871",
  "id": 1323398287,
  "node_id": "I_kwDOC0FsAM5O4XSP",
  "number": 4871,
  "title": "Erigon start fails with \"mdbx_env_open: cannot allocate memory\" error",
  "user": {
    "login": "diglos",
    "id": 16838272,
    "node_id": "MDQ6VXNlcjE2ODM4Mjcy",
    "avatar_url": "https://avatars.githubusercontent.com/u/16838272?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/diglos",
    "html_url": "https://github.com/diglos",
    "followers_url": "https://api.github.com/users/diglos/followers",
    "following_url": "https://api.github.com/users/diglos/following{/other_user}",
    "gists_url": "https://api.github.com/users/diglos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/diglos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/diglos/subscriptions",
    "organizations_url": "https://api.github.com/users/diglos/orgs",
    "repos_url": "https://api.github.com/users/diglos/repos",
    "events_url": "https://api.github.com/users/diglos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/diglos/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-07-31T08:33:13Z",
  "updated_at": "2022-08-29T07:10:32Z",
  "closed_at": "2022-08-29T07:10:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2022.07.2-alpha-c7a94eee\r\n\r\nOS & Version: Linux ARM64 (Odroid and Rock 5B boards)\r\n\r\nCommit hash : c7a94eee\r\n\r\n#### Expected behaviour\r\n\r\nClient start\r\n\r\n#### Actual behaviour\r\n\r\nIt fails trying to open the database\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nStart the client on an Odroid M1 or Rock 5B boards\r\n\r\n#### Backtrace\r\n\r\n```\r\nINFO[07-31|08:23:08.290] Build info                               git_branch=HEAD git_tag=v2022.07.02-dirty git_commit=c7a94eeea05d7c0d569c811399642a7d108d8c82\r\nINFO[07-31|08:23:08.291] Starting Erigon on Ethereum mainnet... \r\nINFO[07-31|08:23:08.296] Maximum peer count                       ETH=100 total=100\r\nINFO[07-31|08:23:08.296] torrent verbosity                        level=2\r\nINFO[07-31|08:23:10.402] Set global gas cap                       cap=50000000\r\nINFO[07-31|08:23:10.647] Opening Database                         label=chaindata path=/home/ethereum/.local/share/erigon/chaindata\r\nEROR[07-31|08:23:10.655] Erigon startup                           err=\"mdbx_env_open: cannot allocate memory, label: chaindata, trace: [kv_mdbx.go:245 node.go:323 node.go:326 backend.go:156 node.go:121 node.go:112 main.go:41 app.go:526 app.go:286 main.go:28 proc.go:250 asm_arm64.s:1259]\"\r\n```\r\n\r\n#### Other data.\r\n\r\nThis happens starting the client in both devices, Odroid M1 and Rock 5B. Both clients running Ubuntu 20.04.4 (tried on Debian 11 as well with Rock 5B). It works on Raspberry Pi 4 with the same OS though (this is the odd thing).\r\n\r\nThe same happens with Akula, in both devices (and works fine on the Raspberry Pi 4).\r\n\r\n```\r\n2022-07-31T08:07:24.783752Z  INFO Starting Akula (akula/v0.1.0-master-8d00b15-2022-07-29/aarch64-unknown-linux-gnu/rustc1.63.0-nightly)\r\nError: failed to open database at /home/ethereum/.local/share/akula/chaindata\r\n\r\nCaused by:\r\n    Cannot allocate memory\r\n```\r\nSeems a MDBX issue. Let me know how can I give you more feedback if needed.\r\n\r\nThanks.\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200390682",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4871#issuecomment-1200390682",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
    "id": 1200390682,
    "node_id": "IC_kwDOC0FsAM5HjIIa",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-31T09:55:28Z",
    "updated_at": "2022-07-31T09:55:28Z",
    "author_association": "COLLABORATOR",
    "body": "show “uname -a” from this OS’s\r\nAnd “free -h”",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200390682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200464657",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4871#issuecomment-1200464657",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
    "id": 1200464657,
    "node_id": "IC_kwDOC0FsAM5HjaMR",
    "user": {
      "login": "diglos",
      "id": 16838272,
      "node_id": "MDQ6VXNlcjE2ODM4Mjcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16838272?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/diglos",
      "html_url": "https://github.com/diglos",
      "followers_url": "https://api.github.com/users/diglos/followers",
      "following_url": "https://api.github.com/users/diglos/following{/other_user}",
      "gists_url": "https://api.github.com/users/diglos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/diglos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/diglos/subscriptions",
      "organizations_url": "https://api.github.com/users/diglos/orgs",
      "repos_url": "https://api.github.com/users/diglos/repos",
      "events_url": "https://api.github.com/users/diglos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/diglos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-31T17:15:20Z",
    "updated_at": "2022-07-31T17:15:20Z",
    "author_association": "NONE",
    "body": "Hi,\r\n\r\n#### Rockchip 5B Debian 11\r\n\r\nuname -a\r\n```\r\nLinux rock-5b 5.10.66-3-rockchip-g62b1ff5028c4 #rockchip SMP Mon May 16 22:17:40 CST 2022 aarch64 GNU/Linux\r\n```\r\nfree -h\r\n```\r\n               total        used        free      shared  buff/cache   available\r\nMem:            15Gi       211Mi        14Gi       6.0Mi       483Mi        14Gi\r\nSwap:             0B          0B          0B\r\n```\r\n\r\n#### Odroid M1 Ubuntu Server 20.04.4\r\n\r\nuname -a\r\n```\r\nLinux ethereumonarm-odroidm1-1a40354b6 4.19.219-odroid-arm64 #1 SMP Fri, 27 May 2022 03:16:46 +0000 aarch64 aarch64 aarch64 GNU/Linux\r\n```\r\nfree -h (it is currently running a Besu sync)\r\n```\r\n              total        used        free      shared  buff/cache   available\r\nMem:          7.3Gi       3.5Gi        43Mi       1.0Mi       3.7Gi       3.7Gi\r\nSwap:         9.5Gi        88Mi       9.4Gi\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200464657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200561565",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4871#issuecomment-1200561565",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
    "id": 1200561565,
    "node_id": "IC_kwDOC0FsAM5Hjx2d",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T01:06:06Z",
    "updated_at": "2022-08-01T01:06:06Z",
    "author_association": "COLLABORATOR",
    "body": " What is your overcommit? https://stackoverflow.com/questions/13127855/what-is-the-size-limit-for-mmap#18360946\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200561565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200860182",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4871#issuecomment-1200860182",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
    "id": 1200860182,
    "node_id": "IC_kwDOC0FsAM5Hk6wW",
    "user": {
      "login": "diglos",
      "id": 16838272,
      "node_id": "MDQ6VXNlcjE2ODM4Mjcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16838272?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/diglos",
      "html_url": "https://github.com/diglos",
      "followers_url": "https://api.github.com/users/diglos/followers",
      "following_url": "https://api.github.com/users/diglos/following{/other_user}",
      "gists_url": "https://api.github.com/users/diglos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/diglos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/diglos/subscriptions",
      "organizations_url": "https://api.github.com/users/diglos/orgs",
      "repos_url": "https://api.github.com/users/diglos/repos",
      "events_url": "https://api.github.com/users/diglos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/diglos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T08:07:05Z",
    "updated_at": "2022-08-01T08:07:05Z",
    "author_association": "NONE",
    "body": "Hi, it shows `0`, and this is the value for all three devices (Raspberry works). I changed it to 1 but I get the same error.\r\n\r\nOther interesting OS limits (Odroid):\r\n\r\nulimits -a\r\n\r\n```\r\ncore file size          (blocks, -c) 0\r\ndata seg size           (kbytes, -d) unlimited\r\nscheduling priority             (-e) 0\r\nfile size               (blocks, -f) unlimited\r\npending signals                 (-i) 29759\r\nmax locked memory       (kbytes, -l) 65536\r\nmax memory size         (kbytes, -m) unlimited\r\nopen files                      (-n) 1024\r\npipe size            (512 bytes, -p) 8\r\nPOSIX message queues     (bytes, -q) 819200\r\nreal-time priority              (-r) 0\r\nstack size              (kbytes, -s) 8192\r\ncpu time               (seconds, -t) unlimited\r\nmax user processes              (-u) 29759\r\nvirtual memory          (kbytes, -v) unlimited\r\nfile locks                      (-x) unlimited\r\n```\r\nThey are pretty much the same that the Rpi ones:\r\n\r\n```\r\ncore file size          (blocks, -c) 0\r\ndata seg size           (kbytes, -d) unlimited\r\nscheduling priority             (-e) 0\r\nfile size               (blocks, -f) unlimited\r\npending signals                 (-i) 30858\r\nmax locked memory       (kbytes, -l) 65536\r\nmax memory size         (kbytes, -m) unlimited\r\nopen files                      (-n) 1024\r\npipe size            (512 bytes, -p) 8\r\nPOSIX message queues     (bytes, -q) 819200\r\nreal-time priority              (-r) 0\r\nstack size              (kbytes, -s) 8192\r\ncpu time               (seconds, -t) unlimited\r\nmax user processes              (-u) 30858\r\nvirtual memory          (kbytes, -v) unlimited\r\nfile locks                      (-x) unlimited\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1200860182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229174098",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4871#issuecomment-1229174098",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
    "id": 1229174098,
    "node_id": "IC_kwDOC0FsAM5JQ7VS",
    "user": {
      "login": "diglos",
      "id": 16838272,
      "node_id": "MDQ6VXNlcjE2ODM4Mjcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16838272?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/diglos",
      "html_url": "https://github.com/diglos",
      "followers_url": "https://api.github.com/users/diglos/followers",
      "following_url": "https://api.github.com/users/diglos/following{/other_user}",
      "gists_url": "https://api.github.com/users/diglos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/diglos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/diglos/subscriptions",
      "organizations_url": "https://api.github.com/users/diglos/orgs",
      "repos_url": "https://api.github.com/users/diglos/repos",
      "events_url": "https://api.github.com/users/diglos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/diglos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-27T11:21:21Z",
    "updated_at": "2022-08-27T11:21:21Z",
    "author_association": "NONE",
    "body": "Hi, guys.\r\n\r\nAs this works on the Raspberry Pi it may be an issue with the Rockchip kernel (both Odroid and Rock 5B use this chip). Is there any way I can trace the error and get back to you or the Rockchip team?\r\n\r\nThanks in advance.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229174098/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229275707",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4871#issuecomment-1229275707",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4871",
    "id": 1229275707,
    "node_id": "IC_kwDOC0FsAM5JRUI7",
    "user": {
      "login": "Marjgus",
      "id": 37046908,
      "node_id": "MDQ6VXNlcjM3MDQ2OTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37046908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marjgus",
      "html_url": "https://github.com/Marjgus",
      "followers_url": "https://api.github.com/users/Marjgus/followers",
      "following_url": "https://api.github.com/users/Marjgus/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marjgus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marjgus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marjgus/subscriptions",
      "organizations_url": "https://api.github.com/users/Marjgus/orgs",
      "repos_url": "https://api.github.com/users/Marjgus/repos",
      "events_url": "https://api.github.com/users/Marjgus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marjgus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-27T21:59:11Z",
    "updated_at": "2022-08-28T22:44:19Z",
    "author_association": "NONE",
    "body": "Hi,\r\nI run into the same issue as you. After some hours of code studying, it seems to be a problem of the kernel config. Especially the options for the memory addressing are different on Odroid/Rockchip and Raspberry.\r\n\r\nCONFIG_ARM64_VA_BITS=39 on Rockchip\r\nCONFIG_ARM64_VA_BITS=48 on Raspberry\r\n\r\nwith 39bits it is only possible to address 512Gb, which seems to be the problem because erigon wants to address 8TB for the chain database.\r\n\r\nhttps://stackoverflow.com/a/4924789\r\n\r\nI will try to recompile the kernel and keep you in touch.\r\n\r\nUPDATE:\r\n\r\nAfter compiling a new kernel 4.19.219 from https://github.com/hardkernel/linux odroidm1-4.19.y with Pagesize 64kb and Virtual Address Bits 48 erigon starts as expected. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229275707/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
