{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2552",
  "id": 974362834,
  "node_id": "MDU6SXNzdWU5NzQzNjI4MzQ=",
  "number": 2552,
  "title": "The documentation should warn about the `autodefrag` option on Btrfs",
  "user": {
    "login": "andrejpodzimek",
    "id": 947737,
    "node_id": "MDQ6VXNlcjk0NzczNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/947737?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/andrejpodzimek",
    "html_url": "https://github.com/andrejpodzimek",
    "followers_url": "https://api.github.com/users/andrejpodzimek/followers",
    "following_url": "https://api.github.com/users/andrejpodzimek/following{/other_user}",
    "gists_url": "https://api.github.com/users/andrejpodzimek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/andrejpodzimek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andrejpodzimek/subscriptions",
    "organizations_url": "https://api.github.com/users/andrejpodzimek/orgs",
    "repos_url": "https://api.github.com/users/andrejpodzimek/repos",
    "events_url": "https://api.github.com/users/andrejpodzimek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/andrejpodzimek/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-08-19T07:32:11Z",
  "updated_at": "2021-08-26T01:49:48Z",
  "closed_at": "2021-08-26T01:49:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# Rationale\r\n\r\nThis is a documentation “feature” request. It has nothing to do with the implementation.\r\n\r\n**`erigon`’s write rates on Btrfs are ~200&times; higher with `autodefrag` than without it.**\r\n\r\nI learned this the hard way when I found out that 15% (!) of my SSDs’ lifespan was consumed in just a few days, due to ~300 TB of writes altogether.\r\n\r\nThe write rate had been exceeding 300 MB/s the whole time, but this was hard to notice with PCIe 4.0 SSDs capable of >4 GB/s. (Admittedly, `iostat`’s faithful fans would have spotted the problem much sooner than I did.)\r\n\r\nDisabling `autodefrag` reduced the write rate from ~300 MB/s to ~1.5 MB/s on my system.\r\n\r\nFor the record (just in case if it matters), the configuration is a Btrfs RAID1 (on both data and metadata) across two Seagate `ZP2000GM30002` SSDs.\r\n\r\n# Implementation\r\n\r\nThe documentation should strongly advice users to switch `autodefrag` **off** on Btrfs filesystems that store `erigon` databases. (Because per-subvolume options (including `autodefrag`) haven’t been implemented, this requires `autodefrag` to be disabled for the entire filesystem.)\r\n\r\nAlthough `autodefrag` is considered beneficial, even on SSDs, for use cases such as web browser caches, it appears to cause a severe performance (and SSD lifespan) problem with `erigon`.",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/901704585",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2552#issuecomment-901704585",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552",
    "id": 901704585,
    "node_id": "IC_kwDOC0FsAM41vuuJ",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-19T08:11:24Z",
    "updated_at": "2021-08-19T08:11:24Z",
    "author_association": "COLLABORATOR",
    "body": "is it https://github.com/ledgerwatch/erigon/pull/2554 ?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/901704585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/906010903",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2552#issuecomment-906010903",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2552",
    "id": 906010903,
    "node_id": "IC_kwDOC0FsAM42AKEX",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-26T01:49:48Z",
    "updated_at": "2021-08-26T01:49:48Z",
    "author_association": "COLLABORATOR",
    "body": "done",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/906010903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
