{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7364",
  "id": 1678609774,
  "node_id": "I_kwDOC0FsAM5kDY1u",
  "number": 7364,
  "title": "Goerli sync problem",
  "user": {
    "login": "xivanc",
    "id": 91614446,
    "node_id": "U_kgDOBXXs7g",
    "avatar_url": "https://avatars.githubusercontent.com/u/91614446?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/xivanc",
    "html_url": "https://github.com/xivanc",
    "followers_url": "https://api.github.com/users/xivanc/followers",
    "following_url": "https://api.github.com/users/xivanc/following{/other_user}",
    "gists_url": "https://api.github.com/users/xivanc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/xivanc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xivanc/subscriptions",
    "organizations_url": "https://api.github.com/users/xivanc/orgs",
    "repos_url": "https://api.github.com/users/xivanc/repos",
    "events_url": "https://api.github.com/users/xivanc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/xivanc/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-04-21T14:21:12Z",
  "updated_at": "2023-06-22T02:33:18Z",
  "closed_at": "2023-06-22T02:33:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: erigon version 2.43.0-dev-ef71909c\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):\r\n./build/bin/erigon --config config.yaml\r\n\r\nconfig.yaml:\r\n````\r\ndatadir : 'xxx'\r\ninternalcl: true\r\nport: xxx\r\np2p.allowed-ports: xxx\r\nchain: \"goerli\"\r\nhttp: true\r\nhttp.addr: \"0.0.0.0\"\r\nhttp.port: xxxx\r\nhttp.compression: true\r\nhttp.vhosts: \"*\"\r\nhttp.corsdomain: \"*\"\r\nprivate.api.addr: \"localhost:xxx\"\r\nauthrpc.addr: \"0.0.0.0\"\r\nauthrpc.port: \"xxxx\"\r\ntorrent.port: \"xxxx\"\r\nprune: true\r\nprune: htc\r\nmetrics.port: xxxxx\r\nhttp.api : [\"eth\",\"debug\",\"net\",\"erigon\",\"web3\",\"trace\",\"txpool\"]\r\n````\r\n\r\nConcensus Layer: using internal cl\r\n\r\nChain/Network: Goerli\r\n\r\n#### Expected behaviour\r\nwhen trying to fetch latest block using  `eth_getBlockByNumber` I expect to get the current latest block\r\n\r\n#### Actual behaviour\r\nwhen trying to fetch latest block using  `eth_getBlockByNumber` I get 8499999 , which is not correct\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO[04-21|16:15:01.857] [2/15 Headers] Downloading PoS headers... height=8867113 hash=0xef1c1ce5282a8712d91e6f907a688bb7788c17b5ad834b252654f439748a6ca8 requestId=20\r\nINFO[04-21|16:15:17.482] [2/15 Headers] Handling new payload      height=8866954 hash=0xe696c7af9d1b325811c95d4b476a644d4e024a2381054314e559c43ea03a2308\r\nINFO[04-21|16:15:18.179] [2/15 Headers] Handling new payload      height=8866955 hash=0x0d4cd588ba4265c5e74511d0bf9f727b56e44b2f35a083fb7c8ff32963f14297\r\nINFO[04-21|16:15:18.876] [2/15 Headers] Handling new payload      height=8866956 hash=0x6060f7adad29ce431e5437f4428ed966c4f8d48af6a06a27abd71f606088c3d8\r\nINFO[04-21|16:15:37.006] [downloader] Downloaded PoS Headers      now=8867113 blk/sec=0.000\r\nINFO[04-21|16:15:37.007] [txpool] stat                            pending=3 baseFee=0 queued=0 alloc=1.7GB sys=2.0GB\r\nINFO[04-21|16:15:37.754] [Caplin] P2P                             peers=10\r\nINFO[04-21|16:16:07.006] [downloader] Downloaded PoS Headers      now=8867113 blk/sec=0.000\r\nWARN[04-21|16:16:31.869] [downloader] Timeout                     requestId=20 peerID=00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r\nINFO[04-21|16:16:34.978] [p2p] GoodPeers                          eth67=1 eth68=2\r\nINFO[04-21|16:16:37.007] [txpool] stat                            pending=3 baseFee=0 queued=0 alloc=1.1GB sys=2.0GB\r\nINFO[04-21|16:16:37.754] [Caplin] P2P                             peers=8\r\nINFO[04-21|16:16:37.887] [2/15 Headers] Handling new payload      height=8867120 hash=0xfe443c18da028bd566eda2abc8b13d8fe91d566843561d9554d0c8fd27793754\r\nINFO[04-21|16:16:37.888] [2/15 Headers] Downloading PoS headers... height=8867119 hash=0x51bfcb4144ea108af22658797675e0942330240845207c049a6b079cc33532d8 requestId=24\r\nINFO[04-21|16:16:37.888] [2/15 Headers] DONE                      in=1m18.02689495s\r\nINFO[04-21|16:17:37.007] [downloader] Downloaded PoS Headers      now=8867119 blk/sec=0.000\r\nINFO[04-21|16:17:37.007] [txpool] stat                            pending=3 baseFee=0 queued=1 alloc=1.6GB sys=2.0GB\r\nINFO[04-21|16:17:37.754] [Caplin] P2P                             peers=18\r\nINFO[04-21|16:18:07.006] [downloader] Downloaded PoS Headers      now=8867119 blk/sec=0.000\r\nWARN[04-21|16:18:07.890] [downloader] Timeout                     requestId=24 peerID=00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r\nINFO[04-21|16:18:34.978] [p2p] GoodPeers                          eth67=2 eth68=2\r\nINFO[04-21|16:18:37.007] [txpool] stat                            pending=3 baseFee=0 queued=1 alloc=1.1GB sys=2.0GB\r\nINFO[04-21|16:18:37.755] [Caplin] P2P                             peers=31\r\nINFO[04-21|16:18:37.958] [2/15 Headers] Handling new payload      height=8867126 hash=0xfd44e0e5593365150a1987b7d07277d0f995f48ce81936e717aea40fe6e8abe2\r\nINFO[04-21|16:18:37.959] [2/15 Headers] Downloading PoS headers... height=8867125 hash=0xfe96602352764d566293f41b9b376402a3c0afe65f2617022d0e88a9b1b86a0f requestId=25\r\nINFO[04-21|16:18:37.960] [2/15 Headers] DONE                      in=1m59.736747402s\r\nINFO[04-21|16:18:53.933] [2/15 Headers] Handling new payload      height=8866957 hash=0x78ba1a8b2471163f3058f456cfb2f0b5d368007acb6c8abea1c23819783e58c3\r\nINFO[04-21|16:18:55.425] [2/15 Headers] Handling new payload      height=8866958 hash=0x1250f185f9f49366205a48cc1e35375aaadad3cf70656c64e115cfb6e50e0a64\r\nINFO[04-21|16:18:56.061] [2/15 Headers] Handling new payload      height=8866959 hash=0x9a69e387cb34c3a0a5977524f1be7a8d034629689131ef759dd8f2d85afac69e\r\n````\r\n\r\n\r\n\r\n\r\nas well when I run ./build/bin/integration print_stages --datadir '/datadir' --chain goerli\r\n\r\ni get\r\n\r\n````\r\n\r\n\r\n \t\t\t\t stage_at \t prune_at\r\nSnapshots \t\t\t 8499999 \t 0\r\nHeaders \t\t\t 8499999 \t 0\r\nBlockHashes \t\t\t 8499999 \t 0\r\nBodies \t\t\t\t 8499999 \t 0\r\nSenders \t\t\t 8499999 \t 0\r\nExecution \t\t\t 8499999 \t 8499999\r\nTranslation \t\t\t 0 \t\t 0\r\nHashState \t\t\t 8499999 \t 0\r\nIntermediateHashes \t\t 8499999 \t 8499999\r\nAccountHistoryIndex \t\t 8499999 \t 8499999\r\nStorageHistoryIndex \t\t 8499999 \t 8499999\r\nLogIndex \t\t\t 8499999 \t 0\r\nCallTraces \t\t\t 8499999 \t 8499999\r\nTxLookup \t\t\t 8499999 \t 8499999\r\nFinish \t\t\t\t 8499999 \t 0\r\n--\r\nprune distance: --prune.h.older=90000 --prune.t.older=90000 --prune.c.older=90000\r\n\r\nblocks.v2: blocks=8499999, segments=8499999, indices=8499999\r\n\r\nhistory.v3: false, idx steps: 0.00, lastMaxTxNum=0->1, lastBlockInSnap=0\r\n\r\nsequence: EthTx=169531842, NonCanonicalTx=0\r\n\r\nin db: first header 8500000, last header 8867134, first body 0, last body 0\r\n\r\n````",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1536892438",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7364#issuecomment-1536892438",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364",
    "id": 1536892438,
    "node_id": "IC_kwDOC0FsAM5bmx4W",
    "user": {
      "login": "amusingaxl",
      "id": 112016538,
      "node_id": "U_kgDOBq08mg",
      "avatar_url": "https://avatars.githubusercontent.com/u/112016538?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/amusingaxl",
      "html_url": "https://github.com/amusingaxl",
      "followers_url": "https://api.github.com/users/amusingaxl/followers",
      "following_url": "https://api.github.com/users/amusingaxl/following{/other_user}",
      "gists_url": "https://api.github.com/users/amusingaxl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/amusingaxl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/amusingaxl/subscriptions",
      "organizations_url": "https://api.github.com/users/amusingaxl/orgs",
      "repos_url": "https://api.github.com/users/amusingaxl/repos",
      "events_url": "https://api.github.com/users/amusingaxl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/amusingaxl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-05T23:16:52Z",
    "updated_at": "2023-05-05T23:18:20Z",
    "author_association": "NONE",
    "body": "I have similar configs and the same error.\r\n\r\n```\r\nprint_stages --datadir '/data/ethereum-testnet/execution/erigon/.data' --chain goerli\r\n```\r\n\r\nOutputs:\r\n\r\n```\r\nINFO[05-05|20:17:22.281] logging to file system                   log dir=/data/ethereum-testnet/execution/erigon/.data/logs file prefix=erigon log level=info json=false\r\nINFO[05-05|20:17:23.295] [snapshots] Blocks Stat                  blocks=8500k indices=8500k alloc=586.7MB sys=683.9MB\r\nNote: prune_at doesn't mean 'all data before were deleted' - it just mean stage.Prune function were run to this block. Because 1 stage may prune multiple data types to different prune distance.\r\n\r\n \t\t\t\tstage_at \tprune_at\r\nSnapshots \t\t\t8499999 \t0\r\nHeaders \t\t\t8499999 \t0\r\nBlockHashes \t\t\t8499999 \t0\r\nBodies \t\t\t\t8499999 \t0\r\nSenders \t\t\t8499999 \t0\r\nExecution \t\t\t8499999 \t8499999\r\nTranslation \t\t\t0 \t\t0\r\nHashState \t\t\t8499999 \t0\r\nIntermediateHashes \t\t8499999 \t8499999\r\nAccountHistoryIndex \t\t8499999 \t8499999\r\nStorageHistoryIndex \t\t8499999 \t8499999\r\nLogIndex \t\t\t8499999 \t8499999\r\nCallTraces \t\t\t8499999 \t8499999\r\nTxLookup \t\t\t8499999 \t8499999\r\nFinish \t\t\t\t8499999 \t0\r\n--\r\nprune distance: --prune.h.older=90000 --prune.t.older=90000 --prune.c.older=90000 --prune.r.before=4367322\r\n\r\nblocks.v2: blocks=8499999, segments=8499999, indices=8499999\r\n\r\nhistory.v3: false, idx steps: 0.00, lastMaxTxNum=0->0, lastBlockInSnap=0\r\n\r\nsequence: EthTx=169531842, NonCanonicalTx=0\r\n\r\nin db: first header 8500000, last header 8948902, first body 0, last body 0\r\n--\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1536892438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1592248220",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7364#issuecomment-1592248220",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364",
    "id": 1592248220,
    "node_id": "IC_kwDOC0FsAM5e58ec",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-06-15T02:31:07Z",
    "updated_at": "2023-06-15T02:31:07Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1592248220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1601933973",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7364#issuecomment-1601933973",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7364",
    "id": 1601933973,
    "node_id": "IC_kwDOC0FsAM5fe5KV",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-06-22T02:33:18Z",
    "updated_at": "2023-06-22T02:33:18Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1601933973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
