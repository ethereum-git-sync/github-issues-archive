{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8160",
  "id": 1887620954,
  "node_id": "I_kwDOC0FsAM5wgs9a",
  "number": 8160,
  "title": "fresh sync stop at #16999999 no more progress",
  "user": {
    "login": "vaioco",
    "id": 15950901,
    "node_id": "MDQ6VXNlcjE1OTUwOTAx",
    "avatar_url": "https://avatars.githubusercontent.com/u/15950901?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vaioco",
    "html_url": "https://github.com/vaioco",
    "followers_url": "https://api.github.com/users/vaioco/followers",
    "following_url": "https://api.github.com/users/vaioco/following{/other_user}",
    "gists_url": "https://api.github.com/users/vaioco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vaioco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vaioco/subscriptions",
    "organizations_url": "https://api.github.com/users/vaioco/orgs",
    "repos_url": "https://api.github.com/users/vaioco/repos",
    "events_url": "https://api.github.com/users/vaioco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vaioco/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-09-08T12:47:43Z",
  "updated_at": "2023-10-02T05:20:35Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `./erigon --version`\r\ngit_branch=devel git_tag=v2.46.0-191-g83d767c86 git_commit=83d767c861154c51fc912284cff4ebbb675c76e3\r\n\r\nOS & Version: Windows/Linux/OSX\r\nubuntu\r\n\r\nCommit hash: \r\n83d767c861154c51fc912284cff4ebbb675c76e3\r\n\r\nErigon Command (with flags/config):\r\n./build/bin/erigon \\\r\n\t--datadir /media/ethnode/\r\n\r\nConcensus Layer:\r\n\r\nConcensus Layer Command (with flags/config):\r\n\r\nChain/Network: mainnet\r\n\r\n#### Expected behaviour\r\nterminate the sync to current date\r\n\r\n#### Actual behaviour\r\nsyncd till block #16999999\r\n\r\n#### Steps to reproduce the behaviour\r\nstart a fresh full sync, check the log file for the progress.\r\nThe sync process seems stopping at stage 10, as shown below.\r\nAfter the stage `LogIndex` I only get dbug messages and the RPC API `eth_blockNumber` returns #16999999 (Sat Apr  8 01:57:59 2023)\r\n\r\n#### Backtrace\r\n\r\n````\r\n[08-24|04:33:07.242] [4/12 Execution] Blocks execution        from=0 to=16999999\r\n....\r\n [09-07|17:07:51.577] [10/12 LogIndex] ETL [2/2] Loading       into=LogAddressIndex current_prefix=fd017478\r\n [09-07|17:08:13.118] [10/12 LogIndex] DONE                    in=9h58m25.006204639s\r\n [09-07|17:08:41.630] [p2p] GoodPeers                          eth66=4 eth68=100 eth67=29\r\n [09-07|17:08:41.647] [txpool] stat                            pending=129 baseFee=0 queued=6411 alloc=3.3GB sys=13.2GB\r\n [09-07|17:09:41.648] [txpool] stat                            pending=129 baseFee=0 queued=9541 alloc=5.2GB sys=13.2GB\r\n [09-07|17:10:41.630] [p2p] GoodPeers                          eth68=100 eth66=4 eth67=29\r\n....\r\nDBUG[09-08|14:40:58.237] [txpool] Commit                          written_kb=1444 in=16.250178ms\r\nDBUG[09-08|14:41:05.890] [downloader] Collecting...               from=18091760 to=18091760 len=1\r\nDBUG[09-08|14:41:05.890] [downloader] posAnchor is nil \r\nDBUG[09-08|14:41:13.935] [txpool] Commit                          written_kb=1400 in=62.409503ms\r\nDBUG[09-08|14:41:27.251] [downloader] Collecting...               from=18091762 to=18091762 len=1\r\nDBUG[09-08|14:41:27.251] [downloader] posAnchor is nil \r\nDBUG[09-08|14:41:29.543] [txpool] Commit                          written_kb=1616 in=18.29337ms\r\n\r\n````\r\n\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" --data '{\"jsonrpc\": \"2.0\", \"method\": \"eth_blockNumber\", \"params\": [], \"id\":1}' localhost:8545\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x103663f\"}\r\n\r\n```\r\n\r\nit does not seem to progress any further, at least no meaningful dbug messages in the last 6h.\r\ndid I miss something to erigon's arguments?\r\nthanks",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1711626830",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8160#issuecomment-1711626830",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160",
    "id": 1711626830,
    "node_id": "IC_kwDOC0FsAM5mBVpO",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T12:53:58Z",
    "updated_at": "2023-09-08T12:53:58Z",
    "author_association": "COLLABORATOR",
    "body": "probably you don't have ConsensusLayer (consensus client). Or install some external one, or add --internalcl (this flag is experimental yet).",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1711626830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1711641153",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8160#issuecomment-1711641153",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160",
    "id": 1711641153,
    "node_id": "IC_kwDOC0FsAM5mBZJB",
    "user": {
      "login": "vaioco",
      "id": 15950901,
      "node_id": "MDQ6VXNlcjE1OTUwOTAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/15950901?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vaioco",
      "html_url": "https://github.com/vaioco",
      "followers_url": "https://api.github.com/users/vaioco/followers",
      "following_url": "https://api.github.com/users/vaioco/following{/other_user}",
      "gists_url": "https://api.github.com/users/vaioco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vaioco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vaioco/subscriptions",
      "organizations_url": "https://api.github.com/users/vaioco/orgs",
      "repos_url": "https://api.github.com/users/vaioco/repos",
      "events_url": "https://api.github.com/users/vaioco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vaioco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:05:03Z",
    "updated_at": "2023-09-08T13:25:19Z",
    "author_association": "NONE",
    "body": "Hi @AskAlexSharov thanks for replying.\r\ncorrect, I wrongly thought it was enabled by default. \r\nCan I just restart erigon with that flag, `--internalcl`, and keep going?\r\n\r\nthe following is what I get by restart:\r\n\r\n```\r\nDBUG[09-08|14:56:18.476] [1/12 Snapshots] DONE                    in=3.647674424s\r\nDBUG[09-08|14:56:18.476] [2/12 BlockHashes] DONE                  in=9.032µs\r\nDBUG[09-08|14:56:18.476] [3/12 Senders] DONE                      in=80.28µs\r\nDBUG[09-08|14:56:18.476] [4/12 Execution] DONE                    in=12.684µs\r\nDBUG[09-08|14:56:18.476] [5/12 HashState] DONE                    in=9.151µs\r\nDBUG[09-08|14:56:18.476] [6/12 IntermediateHashes] DONE           in=8.721µs\r\nDBUG[09-08|14:56:18.476] [7/12 CallTraces] DONE                   in=2.977µs\r\nDBUG[09-08|14:56:18.476] [8/12 AccountHistoryIndex] DONE          in=3.025µs\r\nDBUG[09-08|14:56:18.476] [9/12 StorageHistoryIndex] DONE          in=2.625µs\r\nDBUG[09-08|14:56:18.476] [10/12 LogIndex] DONE                    in=2.612µs\r\nDBUG[09-08|14:56:18.476] [11/12 TxLookup] DONE                    in=32.441µs\r\nDBUG[09-08|14:56:18.476] [12/12 Finish] DONE                      in=3.019µs\r\n...\r\nDBUG[09-08|15:00:52.798] [txpool] Commit                          written_kb=1252 in=2.672019ms\r\nINFO[09-08|15:00:53.882] [txpool] stat                            pending=88 baseFee=679 queued=1719 alloc=6.6GB sys=7.7GB\r\nINFO[09-08|15:00:55.546] [SpawnStageHistoryDownload] Flushed buffer file name=/media/ethnode/blockchaindata/ethereum/mainnet/temp/erigon-sortable-buf-2137778322\r\nDBUG[09-08|15:01:00.722] Received block via gossip                peers=5 slot=7279503 alloc/sys=7.4GB/7.7GB numGC=22\r\nINFO[09-08|15:01:03.001] Downloading History                      app=caplin stage=DownloadHistoricalBlocks progress=7273975 blk/sec=30.6 peers=5\r\n```\r\nhow erigon is started:\r\n```\r\n./build/bin/erigon \\\r\n        --datadir /media/ethnode \\\r\n        --internalcl \\\r\n        --http \\\r\n        --http.corsdomain=\"*\" \\\r\n        --txpool.api.addr=localhost:9090 \\\r\n        --private.api.addr=localhost:9090 \\\r\n        --http.api=eth,erigon,ots,web3,net,debug,trace,txpool \\\r\n        --ws \\\r\n        --http.vhosts=\"*\" \\\r\n        --http.addr=\"0.0.0.0\" \\\r\n        --ws.compression \\\r\n        --log.console.verbosity=dbug\r\n\r\n```\r\n\r\nthanks",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1711641153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1742381235",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8160#issuecomment-1742381235",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160",
    "id": 1742381235,
    "node_id": "IC_kwDOC0FsAM5n2qCz",
    "user": {
      "login": "bbminhtri",
      "id": 8351724,
      "node_id": "MDQ6VXNlcjgzNTE3MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8351724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bbminhtri",
      "html_url": "https://github.com/bbminhtri",
      "followers_url": "https://api.github.com/users/bbminhtri/followers",
      "following_url": "https://api.github.com/users/bbminhtri/following{/other_user}",
      "gists_url": "https://api.github.com/users/bbminhtri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bbminhtri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bbminhtri/subscriptions",
      "organizations_url": "https://api.github.com/users/bbminhtri/orgs",
      "repos_url": "https://api.github.com/users/bbminhtri/repos",
      "events_url": "https://api.github.com/users/bbminhtri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bbminhtri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-02T04:22:29Z",
    "updated_at": "2023-10-02T04:24:25Z",
    "author_association": "NONE",
    "body": "Hi @vaioco , did you manage to find a solution? My fresh sync also got stuck at block 16,999,999 when `eth_blockNumber` is called, even though from logs it seems like Erigon is fetching the latest blocks.\r\n\r\n```\r\nroot@eth-erigon ~ # journalctl -u erigon.service -f\r\nOct 02 06:00:50 eth-erigon erigon[39702]: [INFO] [10-02|06:00:50.050] [txpool] stat                            pending=0 baseFee=0 queued=30000 alloc=6.6GB sys=31.8GB\r\nOct 02 06:01:00 eth-erigon erigon[39702]: [INFO] [10-02|06:01:00.248] [NewPayload] Handling new payload        height=18260324 hash=0xf5fe5a28de6d36a7c2746a09df84ac420874d1572863eabbbfb35a61dda3cbed\r\nOct 02 06:01:10 eth-erigon erigon[39702]: [INFO] [10-02|06:01:10.519] [EngineBlockDownloader] Downloading block bodies block_num=18095492 delivery/sec=7.8MB wasted/sec=0B remaining=161715 delivered=2409152 cache=233.4MB alloc=7.4GB sys=31.8GB\r\nOct 02 06:01:12 eth-erigon erigon[39702]: [INFO] [10-02|06:01:12.695] [NewPayload] Handling new payload        height=18260325 hash=0x784be9e87afe519b39eae55ffddde3521589a6be7a83f0068eb2dcd11a3fedcf\r\nOct 02 06:01:24 eth-erigon erigon[39702]: [INFO] [10-02|06:01:24.493] [NewPayload] Handling new payload        height=18260326 hash=0x2b6433d9417f78d3dc3395e51b0921885ba46df4e3afb364547b46c23bc5e1a1\r\nOct 02 06:01:36 eth-erigon erigon[39702]: [INFO] [10-02|06:01:36.479] [NewPayload] Handling new payload        height=18260327 hash=0xa8e30bf64ef2b36153f581682c44f0ea45ee712f1b1baaa13eca6e78e1e45f38\r\nOct 02 06:01:40 eth-erigon erigon[39702]: [INFO] [10-02|06:01:40.519] [EngineBlockDownloader] Downloading block bodies block_num=18096420 delivery/sec=7.6MB wasted/sec=0B remaining=160787 delivered=2410720 cache=255.9MB alloc=8.9GB sys=31.8GB\r\nOct 02 06:01:48 eth-erigon erigon[39702]: [INFO] [10-02|06:01:48.706] [NewPayload] Handling new payload        height=18260328 hash=0x3c46a815b39c000992b5c2e389bf22d0635b186da8ec56ce00c6acedcc8a8174\r\nOct 02 06:01:50 eth-erigon erigon[39702]: [INFO] [10-02|06:01:50.051] [txpool] stat                            pending=0 baseFee=0 queued=30000 alloc=4.7GB sys=31.8GB\r\nOct 02 06:02:00 eth-erigon erigon[39702]: [INFO] [10-02|06:02:00.300] [NewPayload] Handling new payload        height=18260329 hash=0x99c58d76c81e16f7fe1be8b24079cb7b2aed4480b8a142d784e54741aa5a70f5\r\nOct 02 06:02:10 eth-erigon erigon[39702]: [INFO] [10-02|06:02:10.519] [EngineBlockDownloader] Downloading block bodies block_num=18096420 delivery/sec=6.5MB wasted/sec=0B remaining=160787 delivered=2411788 cache=255.8MB alloc=5.6GB sys=31.8GB\r\n^C\r\nroot@eth-erigon ~ # curl -X POST -H \"Content-Type: application/json\" --data '{\"jsonrpc\": \"2.0\", \"method\":\"eth_blockNumber\", \"params\": [], \"id\":1}' localhost:8545 | jq -r \".result\" | mawk '{ printf \"%d\\n\", $1 }'\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100   114  100    46  100    68  58524  86513 --:--:-- --:--:-- --:--:--  111k\r\n16999999\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1742381235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1742413946",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8160#issuecomment-1742413946",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8160",
    "id": 1742413946,
    "node_id": "IC_kwDOC0FsAM5n2yB6",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-02T05:20:35Z",
    "updated_at": "2023-10-02T05:20:35Z",
    "author_association": "COLLABORATOR",
    "body": "`Downloading block bodies block_num=18096420 delivery/sec=6.5MB` - it's in-progress, give it a time ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1742413946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
