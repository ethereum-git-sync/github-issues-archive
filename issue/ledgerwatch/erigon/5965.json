{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5965",
  "id": 1436680455,
  "node_id": "I_kwDOC0FsAM5VogEH",
  "number": 5965,
  "title": "Erigon-CL tracking",
  "user": {
    "login": "Giulio2002",
    "id": 29233688,
    "node_id": "MDQ6VXNlcjI5MjMzNjg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Giulio2002",
    "html_url": "https://github.com/Giulio2002",
    "followers_url": "https://api.github.com/users/Giulio2002/followers",
    "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
    "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
    "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
    "repos_url": "https://api.github.com/users/Giulio2002/repos",
    "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "Giulio2002",
    "id": 29233688,
    "node_id": "MDQ6VXNlcjI5MjMzNjg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Giulio2002",
    "html_url": "https://github.com/Giulio2002",
    "followers_url": "https://api.github.com/users/Giulio2002/followers",
    "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
    "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
    "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
    "repos_url": "https://api.github.com/users/Giulio2002/repos",
    "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Giulio2002",
      "id": 29233688,
      "node_id": "MDQ6VXNlcjI5MjMzNjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Giulio2002",
      "html_url": "https://github.com/Giulio2002",
      "followers_url": "https://api.github.com/users/Giulio2002/followers",
      "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
      "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
      "repos_url": "https://api.github.com/users/Giulio2002/repos",
      "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-11-04T21:55:37Z",
  "updated_at": "2023-10-03T21:16:34Z",
  "closed_at": null,
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "# Erigon embedded validator client\r\n\r\nObjective: Embedd a Eth2 Consensus Layer into Erigon and enabling embedded validators without having to run any validator client and consensus client alongside it.\r\n\r\nMain Milestones:\r\n\r\n- [x] Embedded consensus full client  security.\r\n- [ ] Embedded validator client within the former.\r\n\r\n## Full-Client Sync Protocol\r\n\r\n### 1) Checkpoint sync\r\n\r\nErigon already uses checkpoint sync by default from the lightclient, the only difference is that the state is not discarded it is stored in the Database.\r\n\r\n### 2) First sync download\r\n\r\nFirst Sync is going to be exactly lightclient sync, this is to allow us to immediately verify the block before the head. once that is done we can use the ParentRoot of that block to reverse-sync download the missing blocks that separates the fetched state from the head of the chain. This allows us to sync up any number of blocks by doing only 1 BLS verification (which is the main bottleneck). Basically by having a block verified that close to the head, will allow us to to just download all blocks by just checking that the parent root of the successive block is equal to the root of the current block and so on, until we reconnect with the state.\r\n\r\n### 3) First sync processing\r\n\r\nprocess each block in order by slot against our state once we reconnected it to the state we have.\r\n\r\n### 4) Sync\r\nIf we are close enough we can just sync each block one by one, by just requesting future slots and process them against our state.\r\n\r\n\r\nThen rinse and repeat.\r\n\r\nHere is a schematic on how to do the Sync:\r\n\r\n![](https://i.imgur.com/d3TYSUf.jpg)\r\n\r\n***Validator section TBD.***\r\n\r\n\r\n## Progress tracking\r\n   - [x]  Full Request protocol implemented.\r\n   - [x] Full Gossip subscription and propagation implemented.\r\n   - [ ] Full Response protocol implemented.\r\n   - [x] BLS utilities.\r\n   - [x] Automatic Checkpoint Sync.\r\n   - [x] Sync up algorithm to current slot.\r\n   - [x] State transition function\r\n       - [x] Process functions.\r\n       - [x] BLS Signature verification.\r\n       - [x] Block collector during gossiping/requesting.\r\n   - [ ] Database model (mostly unsure about most of it)\r\n       - [ ] States stored at finalized checkpoints.\r\n       - [ ] Store signed block for Resp protocol but discard when db gets too large.\r\n   - [ ] Keystore for validators (Still too unsure)\r\n   - [ ] Embedded Validator (Still too unsure)\r\n   - [ ] Extra: Separation of DiscV5\r\n   ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1307822754",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5965#issuecomment-1307822754",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5965",
    "id": 1307822754,
    "node_id": "IC_kwDOC0FsAM5N88qi",
    "user": {
      "login": "michaelneuder",
      "id": 24661810,
      "node_id": "MDQ6VXNlcjI0NjYxODEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/24661810?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelneuder",
      "html_url": "https://github.com/michaelneuder",
      "followers_url": "https://api.github.com/users/michaelneuder/followers",
      "following_url": "https://api.github.com/users/michaelneuder/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelneuder/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelneuder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelneuder/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelneuder/orgs",
      "repos_url": "https://api.github.com/users/michaelneuder/repos",
      "events_url": "https://api.github.com/users/michaelneuder/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelneuder/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-08T21:04:09Z",
    "updated_at": "2022-11-08T21:04:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "https://github.com/ledgerwatch/erigon/pull/5934 from Guillio implements the Checkpoint Sync, I am working on the catching up to head from current checkpoint logic. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1307822754/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
