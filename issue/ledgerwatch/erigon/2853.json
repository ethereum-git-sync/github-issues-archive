{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2853",
  "id": 1031644024,
  "node_id": "I_kwDOC0FsAM49faN4",
  "number": 2853,
  "title": "--maxpeers argument not honored",
  "user": {
    "login": "AndreaLanfranchi",
    "id": 15280851,
    "node_id": "MDQ6VXNlcjE1MjgwODUx",
    "avatar_url": "https://avatars.githubusercontent.com/u/15280851?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AndreaLanfranchi",
    "html_url": "https://github.com/AndreaLanfranchi",
    "followers_url": "https://api.github.com/users/AndreaLanfranchi/followers",
    "following_url": "https://api.github.com/users/AndreaLanfranchi/following{/other_user}",
    "gists_url": "https://api.github.com/users/AndreaLanfranchi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AndreaLanfranchi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AndreaLanfranchi/subscriptions",
    "organizations_url": "https://api.github.com/users/AndreaLanfranchi/orgs",
    "repos_url": "https://api.github.com/users/AndreaLanfranchi/repos",
    "events_url": "https://api.github.com/users/AndreaLanfranchi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AndreaLanfranchi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-10-20T17:13:26Z",
  "updated_at": "2022-04-25T14:40:10Z",
  "closed_at": "2022-04-25T14:40:10Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\ngit_branch=devel git_tag=v2021.09.03-125-g96ea5438d git_commit=96ea5438d9a4fb72637937ca5e79a545b9a2cc20\r\n\r\nOS & Version: Windows And Linux\r\n\r\nCommit hash : 96ea5438d9a4fb72637937ca5e79a545b9a2cc20\r\n\r\n#### Expected behaviour\r\n\r\nThe total number of connected clients (regardless the protocol) should not exceed the value of `--maxpeers` cli argument (which defaults to 100)\r\n\r\n#### Actual behaviour\r\n\r\nThe limitation is actually applied per protocol.\r\n```\r\nINFO[10-20|18:44:12.319] [p2p] GoodPeers                          eth66=100 eth65=79\r\n```\r\n",
  "closed_by": {
    "login": "battlmonstr",
    "id": 11477595,
    "node_id": "MDQ6VXNlcjExNDc3NTk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/11477595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/battlmonstr",
    "html_url": "https://github.com/battlmonstr",
    "followers_url": "https://api.github.com/users/battlmonstr/followers",
    "following_url": "https://api.github.com/users/battlmonstr/following{/other_user}",
    "gists_url": "https://api.github.com/users/battlmonstr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/battlmonstr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/battlmonstr/subscriptions",
    "organizations_url": "https://api.github.com/users/battlmonstr/orgs",
    "repos_url": "https://api.github.com/users/battlmonstr/repos",
    "events_url": "https://api.github.com/users/battlmonstr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/battlmonstr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948095118",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2853#issuecomment-948095118",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
    "id": 948095118,
    "node_id": "IC_kwDOC0FsAM44gsiO",
    "user": {
      "login": "DanielAtCosmicDNA",
      "id": 92752640,
      "node_id": "U_kgDOBYdLAA",
      "avatar_url": "https://avatars.githubusercontent.com/u/92752640?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielAtCosmicDNA",
      "html_url": "https://github.com/DanielAtCosmicDNA",
      "followers_url": "https://api.github.com/users/DanielAtCosmicDNA/followers",
      "following_url": "https://api.github.com/users/DanielAtCosmicDNA/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielAtCosmicDNA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielAtCosmicDNA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielAtCosmicDNA/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielAtCosmicDNA/orgs",
      "repos_url": "https://api.github.com/users/DanielAtCosmicDNA/repos",
      "events_url": "https://api.github.com/users/DanielAtCosmicDNA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielAtCosmicDNA/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T22:52:21Z",
    "updated_at": "2021-10-20T22:52:21Z",
    "author_association": "NONE",
    "body": "## The problem\r\nThe question that arises from this is:\r\n- How to balance each protocol in order to guarantee the overall sum will be no more than `MaxPeers`?\r\n\r\nIn terms of control it becomes more complex to manage which protocol is to be favoured in order to max out the number of peers. That means deciding which peers to drop and which peers to add in such a way to respect `MaxPeers` single boundary.\r\n\r\n## Improvement Proposal\r\n`MaxPeers` can rather be an array of values symbolizing each protocol limit rather than one single value.\r\nIn this improvement proposal, the user is supposed to pass an array of comma separated values as follows:\r\n- erigon --maxpeers 100,100\r\n\r\nErigon can then safely use default 100 and 100 values if no `MaxPeers` is provided",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948095118/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948192905",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2853#issuecomment-948192905",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
    "id": 948192905,
    "node_id": "IC_kwDOC0FsAM44hEaJ",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T02:13:58Z",
    "updated_at": "2021-10-21T02:13:58Z",
    "author_association": "COLLABORATOR",
    "body": "Using arrays is very unsafe. Imagine that I will add new eth67 protocol support or drop eth65 or both. In this cases flags of user will get invalid. We already have ` --p2p.eth65.port` parameter. I think we can add more params to ` --p2p.eth65.*` namespace. One of them also to disable eth65 :-)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948192905/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948508006",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2853#issuecomment-948508006",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
    "id": 948508006,
    "node_id": "IC_kwDOC0FsAM44iRVm",
    "user": {
      "login": "DanielAtCosmicDNA",
      "id": 92752640,
      "node_id": "U_kgDOBYdLAA",
      "avatar_url": "https://avatars.githubusercontent.com/u/92752640?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielAtCosmicDNA",
      "html_url": "https://github.com/DanielAtCosmicDNA",
      "followers_url": "https://api.github.com/users/DanielAtCosmicDNA/followers",
      "following_url": "https://api.github.com/users/DanielAtCosmicDNA/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielAtCosmicDNA/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielAtCosmicDNA/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielAtCosmicDNA/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielAtCosmicDNA/orgs",
      "repos_url": "https://api.github.com/users/DanielAtCosmicDNA/repos",
      "events_url": "https://api.github.com/users/DanielAtCosmicDNA/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielAtCosmicDNA/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T11:15:17Z",
    "updated_at": "2021-10-21T11:15:17Z",
    "author_association": "NONE",
    "body": "> Using arrays is very unsafe. Imagine that I will add new eth67 protocol support or drop eth65 or both. In this cases flags of user will get invalid. We already have ` --p2p.eth65.port` parameter. I think we can add more params to ` --p2p.eth65.*` namespace. One of them also to disable eth65 :-)\r\n\r\nI think that's yet another way to deal with this matter.\r\n\r\nWhat is clear though is that each protocol is a different dimension when parametrizing and should not be handled as the same as currently implemented.\r\n\r\nI still don't see why using arrays parameters is unsafe. If the enabled protocols selection feature is missing, that is an independet problem on its own. I believe once that is implemented one could simply write either:\r\n- erigon --enabled-protocols 65,66 --maxpeers 100,100\r\n- erigon --p2p.eth65.enabled true --p2p.eth66.enabled true --p2p.eth65.maxpeers 100 --p2p.eth66.maxpeers 100",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948508006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948515922",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2853#issuecomment-948515922",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
    "id": 948515922,
    "node_id": "IC_kwDOC0FsAM44iTRS",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-21T11:25:43Z",
    "updated_at": "2021-10-21T11:25:43Z",
    "author_association": "COLLABORATOR",
    "body": "with explicit `--enabled-protocols 65,66` looks fine\r\nonly need to check that there will not be array of arrays (like if each protocol can have own list of load balancers)",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/948515922/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/989073513",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2853#issuecomment-989073513",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
    "id": 989073513,
    "node_id": "IC_kwDOC0FsAM469BBp",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-08T18:27:35Z",
    "updated_at": "2021-12-08T18:27:35Z",
    "author_association": "COLLABORATOR",
    "body": "so, didn't we drop eth65?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/989073513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/989424953",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2853#issuecomment-989424953",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2853",
    "id": 989424953,
    "node_id": "IC_kwDOC0FsAM46-W05",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-09T01:48:44Z",
    "updated_at": "2021-12-09T01:48:44Z",
    "author_association": "COLLABORATOR",
    "body": "@mandrigin we did. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/989424953/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
