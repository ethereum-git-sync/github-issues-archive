{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1504",
  "id": 812577116,
  "node_id": "MDU6SXNzdWU4MTI1NzcxMTY=",
  "number": 1504,
  "title": "RPCDaemon is consistently behind the mainnet",
  "user": {
    "login": "valitovsen",
    "id": 31155294,
    "node_id": "MDQ6VXNlcjMxMTU1Mjk0",
    "avatar_url": "https://avatars.githubusercontent.com/u/31155294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/valitovsen",
    "html_url": "https://github.com/valitovsen",
    "followers_url": "https://api.github.com/users/valitovsen/followers",
    "following_url": "https://api.github.com/users/valitovsen/following{/other_user}",
    "gists_url": "https://api.github.com/users/valitovsen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/valitovsen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/valitovsen/subscriptions",
    "organizations_url": "https://api.github.com/users/valitovsen/orgs",
    "repos_url": "https://api.github.com/users/valitovsen/repos",
    "events_url": "https://api.github.com/users/valitovsen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/valitovsen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-02-20T10:42:30Z",
  "updated_at": "2021-03-03T08:18:02Z",
  "closed_at": "2021-03-03T08:18:02Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Geth version: 2021.02.03-alpha\r\nOS & Version: Ubuntu 20.04, SSD zfs lz4\r\n\r\nTG is synced, yet it catches up by chunks:\r\n```\r\nINFO [02-20|13:19:02.784] [1/14 Headers] Imported new block headers count=31 elapsed=4.654ms     number=11893274 hash=\"4bf98d…5c4668\"\r\nINFO [02-20|13:19:02.939] [3/14 Bodies] Imported new chain segment blocks=1  txs=175   elapsed=\"830.119µs\" number=11893244 hash=\"115262…12e546\" age=8m29s\r\nINFO [02-20|13:19:02.949] [3/14 Bodies] Imported new chain segment blocks=1  txs=255   elapsed=\"441.609µs\" number=11893245 hash=\"a5c5d0…8f6c23\" age=8m14s\r\nINFO [02-20|13:19:02.973] [3/14 Bodies] Imported new chain segment blocks=1  txs=211   elapsed=\"827.003µs\" number=11893246 hash=\"41d953…d6d7b7\" age=7m35s\r\nINFO [02-20|13:19:02.997] [3/14 Bodies] Imported new chain segment blocks=1  txs=219   elapsed=\"977.255µs\" number=11893247 hash=\"aa7fae…c17ef3\" age=7m\r\nINFO [02-20|13:19:03.024] [3/14 Bodies] Imported new chain segment blocks=1  txs=191   elapsed=\"907.935µs\" number=11893248 hash=\"e2e3c5…104740\" age=6m45s\r\nINFO [02-20|13:19:03.049] [3/14 Bodies] Imported new chain segment blocks=1  txs=193   elapsed=\"678.335µs\" number=11893249 hash=\"d7c0ce…68ae5d\" age=6m39s\r\nINFO [02-20|13:19:03.074] [3/14 Bodies] Imported new chain segment blocks=1  txs=236   elapsed=\"893.328µs\" number=11893250 hash=\"c00878…a70a31\" age=6m33s\r\nINFO [02-20|13:19:03.084] [3/14 Bodies] Imported new chain segment blocks=1  txs=365   elapsed=1.440ms     number=11893251 hash=\"a3c65a…d003ff\" age=5m55s\r\nINFO [02-20|13:19:03.108] [3/14 Bodies] Imported new chain segment blocks=1  txs=220   elapsed=1.014ms     number=11893252 hash=\"d76446…4697c0\" age=5m38s\r\nINFO [02-20|13:19:03.132] [3/14 Bodies] Downloading block bodies   count=22\r\nINFO [02-20|13:19:03.233] [3/14 Bodies] Downloader queue stats     receiptTasks=0 blockTasks=0 itemSize=48.47KiB throttle=1352\r\nINFO [02-20|13:19:03.235] [3/14 Bodies] Imported new chain segment blocks=2  txs=423   elapsed=1.939ms     number=11893254 hash=\"7956a9…2e65db\" age=5m15s\r\nINFO [02-20|13:19:03.492] [3/14 Bodies] Imported new chain segment blocks=2  txs=411   elapsed=1.261ms     number=11893256 hash=\"9ea835…1b5a2c\" age=3m55s\r\nINFO [02-20|13:19:03.900] [3/14 Bodies] Imported new chain segment blocks=4  txs=843   elapsed=3.155ms     number=11893260 hash=\"750ca4…0def1a\" age=2m26s\r\nINFO [02-20|13:19:07.384] [3/14 Bodies] Imported new chain segment blocks=4  txs=767   elapsed=2.315ms     number=11893264 hash=\"8e9b44…accee8\" age=2m9s\r\nINFO [02-20|13:19:20.917] [3/14 Bodies] Imported new chain segment blocks=10 txs=2001  elapsed=4.529ms     number=11893274 hash=\"4bf98d…5c4668\"\r\nINFO [02-20|13:19:20.981] [4/14 Senders] Started                   from=11893243 to=11893274\r\nINFO [02-20|13:19:20.981] [4/14 Senders] Read canonical hashes     amount=31\r\nINFO [02-20|13:19:21.053] [5/14 Execution] Blocks execution        from=11893243 to=11893274\r\nINFO [02-20|13:19:32.511] [5/14 Execution] Completed on            block=11893274\r\nINFO [02-20|13:19:32.511] [6/14 HashState] Promoting plain state   from=11893243 to=11893274\r\nINFO [02-20|13:19:32.511] [6/14 HashState] Incremental promotion started from=11893243 to=11893274 codes=true  csbucket=PLAIN-ACS\r\nINFO [02-20|13:19:33.704] [6/14 HashState] Incremental promotion started from=11893243 to=11893274 codes=false csbucket=PLAIN-ACS\r\nINFO [02-20|13:19:39.920] [6/14 HashState] Incremental promotion started from=11893243 to=11893274 codes=false csbucket=PLAIN-SCS\r\nINFO [02-20|13:19:48.970] [7/14 IntermediateHashes] Generating intermediate hashes from=11893243 to=11893274\r\nINFO [02-20|13:20:17.605] [7/14 IntermediateHashes] Collection finished root hash=0x66e4956e908a77bbdb2dc587205ac7fd96e411aa1b4ebfa96e4991a15ec53e65 gen IH=28.570370314s\r\nINFO [02-20|13:20:52.941] [11/14 CallTraces] disabled. Work In Progress \r\nINFO [02-20|13:21:22.981] [12/14 TxLookup] ETL [2/2] Loading       into=l                 current key=f52593d7... alloc=364.47MiB sys=888.24MiB numGC=2369\r\nINFO [02-20|13:21:30.799] [12/14 TxLookup] DONE                    in=37.857971564s\r\nINFO [02-20|13:21:32.319] [13/14 TxPool] Read canonical hashes     hashes=31\r\nINFO [02-20|13:21:32.954] [13/14 TxPool] Transaction stats         pending=1602 queued=480\r\nINFO [02-20|13:21:32.954] [14/14 Finish] Update current block for the RPC API to=11893274\r\nINFO [02-20|13:21:32.955] Memory                                   alloc=585.38MiB sys=888.24MiB\r\nINFO [02-20|13:21:32.955] Timings                                  Headers=370.632462ms  BlockHashes=57.444474ms  Bodies=193.344846ms  Bodies=17.849180796s Bodies=\"318.639µs\"   Senders=72.411796ms  Execution=11.457430946s HashState=16.459478752s IntermediateHashes=28.743443458s AccountHistoryIndex=5.551045639s  StorageHistoryIndex=17.723860605s   LogIndex=11.952478644s TxLookup=37.858007322s  TxPool=2.154835714s Finish=1.06481ms\r\nINFO [02-20|13:21:32.955] Tables                                   PLAIN-CST2=10.40GiB PLAIN-SCS=96.37GiB eth_tx=219.21GiB hAT=20.74GiB hST=58.55GiB l=62.95GiB log=215.82GiB log_topic_index=11.87GiB txSenders=28.42GiB freelist=31.04MiB\r\nINFO [02-20|13:23:56.451] Batch                                    commit=2m23.495231183s\r\nINFO [02-20|13:23:56.451] Commit cycle                             in=2m23.495301355s\r\n```\r\nAfter that it gets another chunk and processes it, and it goes on and on. \r\n\r\nAs a result, I'm consistently _variable-chunk-size_ (up to 50) blocks behind the mainnet. \r\n\r\nHow can I fix this behaviour and stay synced? Am I missing something? \r\n\r\n\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782607094",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1504#issuecomment-782607094",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
    "id": 782607094,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjYwNzA5NA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T11:03:33Z",
    "updated_at": "2021-02-20T11:03:33Z",
    "author_association": "COLLABORATOR",
    "body": "@valitovsen , are you on HDD?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782607094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782607366",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1504#issuecomment-782607366",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
    "id": 782607366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjYwNzM2Ng==",
    "user": {
      "login": "valitovsen",
      "id": 31155294,
      "node_id": "MDQ6VXNlcjMxMTU1Mjk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/31155294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/valitovsen",
      "html_url": "https://github.com/valitovsen",
      "followers_url": "https://api.github.com/users/valitovsen/followers",
      "following_url": "https://api.github.com/users/valitovsen/following{/other_user}",
      "gists_url": "https://api.github.com/users/valitovsen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/valitovsen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/valitovsen/subscriptions",
      "organizations_url": "https://api.github.com/users/valitovsen/orgs",
      "repos_url": "https://api.github.com/users/valitovsen/repos",
      "events_url": "https://api.github.com/users/valitovsen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/valitovsen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T11:05:30Z",
    "updated_at": "2021-02-20T11:06:11Z",
    "author_association": "NONE",
    "body": "> @valitovsen , are you on HDD?\r\n\r\nSSD, using zfs with lz4 compression",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782607366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782608341",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1504#issuecomment-782608341",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
    "id": 782608341,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjYwODM0MQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T11:13:34Z",
    "updated_at": "2021-02-20T11:14:43Z",
    "author_association": "COLLABORATOR",
    "body": "By some reason your commit - most likely it’s fsync part - is slow. Maybe because of lz4+compression+smallRAM. What is your RAM?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782608341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782612926",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1504#issuecomment-782612926",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
    "id": 782612926,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjYxMjkyNg==",
    "user": {
      "login": "valitovsen",
      "id": 31155294,
      "node_id": "MDQ6VXNlcjMxMTU1Mjk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/31155294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/valitovsen",
      "html_url": "https://github.com/valitovsen",
      "followers_url": "https://api.github.com/users/valitovsen/followers",
      "following_url": "https://api.github.com/users/valitovsen/following{/other_user}",
      "gists_url": "https://api.github.com/users/valitovsen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/valitovsen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/valitovsen/subscriptions",
      "organizations_url": "https://api.github.com/users/valitovsen/orgs",
      "repos_url": "https://api.github.com/users/valitovsen/repos",
      "events_url": "https://api.github.com/users/valitovsen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/valitovsen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T11:48:01Z",
    "updated_at": "2021-02-20T11:48:01Z",
    "author_association": "NONE",
    "body": "32GB of RAM\r\n\r\nI am new to zfs, may be there are settings I can adjust to improve the performance of TG? ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782612926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782613664",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1504#issuecomment-782613664",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
    "id": 782613664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjYxMzY2NA==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T11:53:17Z",
    "updated_at": "2021-02-20T11:53:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like slow disk to me. We normally see this behaviour with HDDs. Execution stage is slower due to slow reads, and cycle commit is slower due to slow writes. Perhaps compression is killing it. If you want better performance I would suggest using disks without compression",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782613664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782690007",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1504#issuecomment-782690007",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1504",
    "id": 782690007,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjY5MDAwNw==",
    "user": {
      "login": "valitovsen",
      "id": 31155294,
      "node_id": "MDQ6VXNlcjMxMTU1Mjk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/31155294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/valitovsen",
      "html_url": "https://github.com/valitovsen",
      "followers_url": "https://api.github.com/users/valitovsen/followers",
      "following_url": "https://api.github.com/users/valitovsen/following{/other_user}",
      "gists_url": "https://api.github.com/users/valitovsen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/valitovsen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/valitovsen/subscriptions",
      "organizations_url": "https://api.github.com/users/valitovsen/orgs",
      "repos_url": "https://api.github.com/users/valitovsen/repos",
      "events_url": "https://api.github.com/users/valitovsen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/valitovsen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T14:31:01Z",
    "updated_at": "2021-02-20T14:31:01Z",
    "author_association": "NONE",
    "body": "Thank you for your help. I’ll try turning off lz4 compression and see whether write speed improves. If it doesn’t, I’ll have to switch back to ext4. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/782690007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
