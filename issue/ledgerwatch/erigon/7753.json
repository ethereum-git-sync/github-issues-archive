{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7753",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7753/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7753/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7753/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7753",
  "id": 1761672646,
  "node_id": "I_kwDOC0FsAM5pAP3G",
  "number": 7753,
  "title": "Erigon stalls randomly during snapshot sync with custom p2p and torrent ports. Working connection / port forwarding.",
  "user": {
    "login": "sekuba",
    "id": 29250140,
    "node_id": "MDQ6VXNlcjI5MjUwMTQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/29250140?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sekuba",
    "html_url": "https://github.com/sekuba",
    "followers_url": "https://api.github.com/users/sekuba/followers",
    "following_url": "https://api.github.com/users/sekuba/following{/other_user}",
    "gists_url": "https://api.github.com/users/sekuba/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sekuba/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sekuba/subscriptions",
    "organizations_url": "https://api.github.com/users/sekuba/orgs",
    "repos_url": "https://api.github.com/users/sekuba/repos",
    "events_url": "https://api.github.com/users/sekuba/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sekuba/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-06-17T06:29:12Z",
  "updated_at": "2023-06-17T06:29:12Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2.45.1-stable-048fe49e`\r\n\r\nOS & Version: Docker with WSL2 backend on Windows\r\n\r\nCommit hash: `048fe49e4f379829e92116326ed8fcec3c9c8c9a`\r\n\r\nErigon Command (with flags/config): `erigon --private.api.addr 0.0.0.0:9090 --datadir /var/lib/erigon --port 59359 --p2p.allowed-ports 59359,61614,60305 --torrent.port 35781 --nat any --chain mainnet --log.console.verbosity info --metrics --metrics.addr 0.0.0.0 --http --http.addr 0.0.0.0 --http.port 8545 --http.vhosts=* --http.corsdomain=* --http.api web3,eth,net,engine,erigon,ots --ws --authrpc.addr 0.0.0.0 --authrpc.port 8551 --authrpc.vhosts=* --authrpc.jwtsecret /var/lib/erigon/ee-secret/jwtsecret --maxpeers 100`\r\n\r\nConcensus Layer: Nimbus\r\n\r\nConcensus Layer Command (with flags/config): `nimbus_beacon_node --data-dir=/var/lib/nimbus --non-interactive --status-bar=false --tcp-port=60698 --udp-port=60698 --max-peers=160 --network=mainnet --el=http://172.18.0.33:8551 --jwt-secret=/var/lib/nimbus/ee-secret/jwtsecret --rest --rest-address=0.0.0.0 --rest-port=5052 --enr-auto-update=true --metrics --metrics-port=8008 --metrics-address=0.0.0.0 --keymanager --keymanager-port=7500 --keymanager-address=0.0.0.0 --keymanager-allow-origin=* --keymanager-token-file=/var/lib/nimbus/api-token.txt --suggested-fee-recipient=XX --graffiti=XX --payload-builder=true --payload-builder-url=http://172.18.0.36:18550 --log-level=INFO --doppelganger-detection=false --history=prune`\r\n\r\nChain/Network: mainnet\r\n\r\n#### Expected behaviour\r\nErigon syncs\r\n\r\n#### Actual behaviour\r\nErigon starts snapshot sync and stalls randomly (after 10 minutes to 1 hour) while keeping its peer count.\r\nIt reports 0B/s and full peer count, CPU/Mem usage low.\r\nPorts (all funny erigon ports) are forwarded and reachable from the outside. I did customize all ports as you can see in the command and cannot try with default ports as my port-forwarding is limited.\r\n\r\n#### Steps to reproduce the behaviour\r\nInstall eth-docker with erigon and nimbus as clients, try to sync to mainnet.\r\n\r\n#### Backtrace\r\n\r\n````\r\neth-docker-execution-1  | Erigon archive node without pruning\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.096] logging to file system                   log dir=/var/lib/erigon/logs file prefix=erigon log level=info json=false\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.096] Starting metrics server                  addr=http://0.0.0.0:6060/debug/metrics/prometheus\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.096] Build info                               git_branch=stable git_tag=v2.45.2-dirty git_commit=048fe49e4f379829e92116326ed8fcec3c9c8c9a\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.096] Starting Erigon on Ethereum mainnet...\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.097] Maximum peer count                       ETH=100 total=100\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.097] starting HTTP APIs                       APIs=web3,eth,net,engine,erigon,ots\r\neth-docker-execution-1  | [INFO] [06-17|08:14:51.097] torrent verbosity                        level=WRN\r\neth-docker-execution-1  | [INFO] [06-17|08:14:52.099] Set global gas cap                       cap=50000000\r\neth-docker-execution-1  | [INFO] [06-17|08:14:52.134] [Downloader] Runnning with               ipv6-enabled=true ipv4-enabled=true download.rate=16mb upload.rate=4mb\r\neth-docker-execution-1  | [INFO] [06-17|08:14:52.135] Opening Database                         label=chaindata path=/var/lib/erigon/chaindata\r\neth-docker-execution-1  | mdbx_setup_dxb:15946 filesize mismatch (expect 2244608b/137p, have 2147483648b/131072p)\r\neth-docker-execution-1  | [INFO] [06-17|08:14:52.154] Initialised chain configuration          config=\"{ChainID: 1, Homestead: 1150000, DAO: 1920000, Tangerine Whistle: 2463000, Spurious Dragon: 2675000, Byzantium: 4370000, Constantinople: 7280000, Petersburg: 7280000, Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, London: 12965000, Arrow Glacier: 13773000, Gray Glacier: 15050000, Terminal Total Difficulty: 58750000000000000000000, Merge Netsplit: <nil>, Shanghai: 1681338455, Cancun: <nil>, Prague: <nil>, Engine: ethash}\" genesis=0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.964] Initialising Ethereum protocol           network=1\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.964] Disk storage enabled for ethash DAGs     dir=/var/lib/erigon/ethash-dags count=2\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.975] Starting private RPC server              on=0.0.0.0:9090\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.975] new subscription to logs established\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.976] rpc filters: subscribing to Erigon events\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.976] new subscription to newHeaders established\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.976] New txs subscriber joined\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.976] Reading JWT secret                       path=/var/lib/erigon/ee-secret/jwtsecret\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.977] HTTP endpoint opened for Engine API      url=[::]:8551 ws=true ws.compression=true\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.978] HTTP endpoint opened                     url=[::]:8545 ws=true ws.compression=true grpc=false\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.986] [1/15 Snapshots] Fetching torrent files metadata\r\neth-docker-execution-1  | [INFO] [06-17|08:14:54.987] [txpool] Started\r\neth-docker-execution-1  | [INFO] [06-17|08:14:55.002] Started P2P networking                   version=67 self=enode://0f3c4e77db408b88e929be0d4eb8a26874ab631d6fa2e5ede2864c39faf1a69eb7a38f29801c5ed28f33d02f4f30495a80bcf7e6e20aaa58882935e62fb1ac77@127.0.0.1:0 name=erigon/v2.45.1-stable-048fe49e/linux-amd64/go1.20.5\r\neth-docker-execution-1  | [INFO] [06-17|08:14:55.007] Started P2P networking                   version=68 self=enode://0f3c4e77db408b88e929be0d4eb8a26874ab631d6fa2e5ede2864c39faf1a69eb7a38f29801c5ed28f33d02f4f30495a80bcf7e6e20aaa58882935e62fb1ac77@127.0.0.1:0 name=erigon/v2.45.1-stable-048fe49e/linux-amd64/go1.20.5\r\neth-docker-execution-1  | [INFO] [06-17|08:15:15.000] [1/15 Snapshots] download                progress=\"49.60% 159.0GB/320.6GB\" download-time-left=262hrs:40m total-download-time=20s download=179.2KB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:15:15.000] [1/15 Snapshots] download                peers=41 connections=43 files=102 alloc=255.0MB sys=305.5MB\r\neth-docker-execution-1  | [INFO] [06-17|08:15:35.000] [1/15 Snapshots] download                progress=\"49.62% 159.1GB/320.6GB\" download-time-left=13hrs:36m total-download-time=40s download=3.4MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:15:35.000] [1/15 Snapshots] download                peers=71 connections=75 files=102 alloc=232.0MB sys=325.6MB\r\neth-docker-execution-1  | [INFO] [06-17|08:15:54.977] [txpool] stat                            pending=9 baseFee=0 queued=19 alloc=219.9MB sys=362.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:15:54.999] [1/15 Snapshots] download                progress=\"49.64% 159.2GB/320.6GB\" download-time-left=12hrs:5m total-download-time=1m0s download=3.8MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:15:54.999] [1/15 Snapshots] download                peers=95 connections=103 files=102 alloc=220.1MB sys=362.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:16:14.999] [1/15 Snapshots] download                progress=\"49.66% 159.2GB/320.6GB\" download-time-left=12hrs:29m total-download-time=1m20s download=3.7MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:16:14.999] [1/15 Snapshots] download                peers=111 connections=119 files=102 alloc=193.3MB sys=366.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:16:35.000] [1/15 Snapshots] download                progress=\"49.69% 159.3GB/320.6GB\" download-time-left=12hrs:44m total-download-time=1m40s download=3.6MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:16:35.000] [1/15 Snapshots] download                peers=119 connections=125 files=102 alloc=166.0MB sys=374.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:16:54.964] [p2p] GoodPeers                          eth68=1\r\neth-docker-execution-1  | [INFO] [06-17|08:16:54.977] [txpool] stat                            pending=9 baseFee=0 queued=19 alloc=297.8MB sys=374.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:16:55.000] [1/15 Snapshots] download                progress=\"49.71% 159.4GB/320.6GB\" download-time-left=11hrs:15m total-download-time=2m0s download=4.1MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:16:55.000] [1/15 Snapshots] download                peers=131 connections=141 files=102 alloc=297.9MB sys=374.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:17:15.000] [1/15 Snapshots] download                progress=\"49.73% 159.5GB/320.6GB\" download-time-left=11hrs:49m total-download-time=2m20s download=3.9MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:17:15.000] [1/15 Snapshots] download                peers=134 connections=143 files=102 alloc=270.8MB sys=378.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:17:34.999] [1/15 Snapshots] download                progress=\"49.76% 159.5GB/320.6GB\" download-time-left=11hrs:36m total-download-time=2m40s download=3.9MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:17:34.999] [1/15 Snapshots] download                peers=129 connections=137 files=102 alloc=238.3MB sys=386.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:17:54.976] [txpool] stat                            pending=9 baseFee=0 queued=19 alloc=211.5MB sys=386.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:17:54.999] [1/15 Snapshots] download                progress=\"49.78% 159.6GB/320.6GB\" download-time-left=11hrs:49m total-download-time=3m0s download=3.9MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:17:55.000] [1/15 Snapshots] download                peers=133 connections=139 files=102 alloc=211.5MB sys=386.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:18:14.999] [1/15 Snapshots] download                progress=\"49.80% 159.7GB/320.6GB\" download-time-left=12hrs:22m total-download-time=3m20s download=3.7MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:18:15.000] [1/15 Snapshots] download                peers=131 connections=137 files=102 alloc=336.2MB sys=386.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:18:35.000] [1/15 Snapshots] download                progress=\"49.83% 159.8GB/320.6GB\" download-time-left=11hrs:48m total-download-time=3m40s download=3.9MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:18:35.000] [1/15 Snapshots] download                peers=136 connections=140 files=102 alloc=294.7MB sys=390.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:18:54.965] [p2p] GoodPeers                          eth68=1 eth67=1\r\neth-docker-execution-1  | [INFO] [06-17|08:18:54.977] [txpool] stat                            pending=9 baseFee=0 queued=19 alloc=258.8MB sys=390.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:18:55.000] [1/15 Snapshots] download                progress=\"49.85% 159.8GB/320.6GB\" download-time-left=12hrs:2m total-download-time=4m0s download=3.8MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:18:55.000] [1/15 Snapshots] download                peers=134 connections=137 files=102 alloc=259.0MB sys=390.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:19:14.999] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=20hrs:47m total-download-time=4m20s download=2.2MB/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:19:14.999] [1/15 Snapshots] download                peers=137 connections=138 files=102 alloc=208.8MB sys=390.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:19:34.999] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=4m40s download=0B/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:19:35.000] [1/15 Snapshots] download                peers=134 connections=138 files=102 alloc=290.2MB sys=390.7MB\r\neth-docker-execution-1  | [INFO] [06-17|08:19:54.976] [txpool] stat                            pending=9 baseFee=0 queued=19 alloc=210.7MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:19:55.000] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=5m0s download=0B/s upload=819B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:19:55.000] [1/15 Snapshots] download                peers=135 connections=139 files=102 alloc=210.8MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:20:15.000] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=5m20s download=0B/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:20:15.000] [1/15 Snapshots] download                peers=133 connections=140 files=102 alloc=310.0MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:20:35.000] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=5m40s download=0B/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:20:35.000] [1/15 Snapshots] download                peers=138 connections=142 files=102 alloc=228.3MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:20:54.965] [p2p] GoodPeers                          eth67=3 eth68=2\r\neth-docker-execution-1  | [INFO] [06-17|08:20:54.976] [txpool] stat                            pending=9 baseFee=0 queued=19 alloc=317.3MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:20:55.000] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=6m0s download=0B/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:20:55.000] [1/15 Snapshots] download                peers=133 connections=137 files=102 alloc=317.8MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:21:15.000] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=6m20s download=0B/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:21:15.000] [1/15 Snapshots] download                peers=141 connections=143 files=102 alloc=251.0MB sys=390.9MB\r\neth-docker-execution-1  | [INFO] [06-17|08:21:34.999] [1/15 Snapshots] download                progress=\"49.86% 159.9GB/320.6GB\" download-time-left=999hrs:99m total-download-time=6m40s download=0B/s upload=0B/s\r\neth-docker-execution-1  | [INFO] [06-17|08:21:35.000] [1/15 Snapshots] download                peers=134 connections=140 files=102 alloc=176.0MB sys=390.9MB\r\n````\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7753/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7753/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
