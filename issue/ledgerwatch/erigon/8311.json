{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8311",
  "id": 1916591259,
  "node_id": "I_kwDOC0FsAM5yPNyb",
  "number": 8311,
  "title": "Caplin: use tx which been committed or rolled back",
  "user": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-09-28T02:09:13Z",
  "updated_at": "2023-10-27T07:49:03Z",
  "closed_at": null,
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "Error happened at my branch: \r\n```\r\n[WARN] [09-28|02:24:43.402] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"invalid state version\"\r\n```\r\n\r\nBut after this error - we seems get into invalid state and print many similar errors:  \r\n```\r\n[INFO] [09-27|14:59:26.388] [Caplin] Epoch downloaded                app=caplin stage=CatchUpEpochs epoch=104409\r\n[WARN] [09-27|22:54:04.557] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-27|23:09:00.000] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-27|23:09:04.965] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-27|23:12:12.000] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-27|23:12:16.247] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-27|23:36:36.000] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-27|23:49:48.000] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:08:16.122] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:11:52.188] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:38:00.001] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:45:48.001] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:53:12.002] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:54:24.001] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:54:28.563] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|00:58:28.502] extra block failed validation            app=caplin stage=ListenForForks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|01:00:00.001] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n[WARN] [09-28|01:04:36.001] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"sql: transaction has already been committed or rolled back\"\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751528269",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8311#issuecomment-1751528269",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311",
    "id": 1751528269,
    "node_id": "IC_kwDOC0FsAM5oZjNN",
    "user": {
      "login": "Texnomic",
      "id": 1648586,
      "node_id": "MDQ6VXNlcjE2NDg1ODY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1648586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Texnomic",
      "html_url": "https://github.com/Texnomic",
      "followers_url": "https://api.github.com/users/Texnomic/followers",
      "following_url": "https://api.github.com/users/Texnomic/following{/other_user}",
      "gists_url": "https://api.github.com/users/Texnomic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Texnomic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Texnomic/subscriptions",
      "organizations_url": "https://api.github.com/users/Texnomic/orgs",
      "repos_url": "https://api.github.com/users/Texnomic/repos",
      "events_url": "https://api.github.com/users/Texnomic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Texnomic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-07T00:33:25Z",
    "updated_at": "2023-10-07T00:33:25Z",
    "author_association": "NONE",
    "body": "Same here since versions `2.50+`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751528269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1762961114",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8311#issuecomment-1762961114",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311",
    "id": 1762961114,
    "node_id": "IC_kwDOC0FsAM5pFKba",
    "user": {
      "login": "Giulio2002",
      "id": 29233688,
      "node_id": "MDQ6VXNlcjI5MjMzNjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/29233688?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Giulio2002",
      "html_url": "https://github.com/Giulio2002",
      "followers_url": "https://api.github.com/users/Giulio2002/followers",
      "following_url": "https://api.github.com/users/Giulio2002/following{/other_user}",
      "gists_url": "https://api.github.com/users/Giulio2002/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Giulio2002/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Giulio2002/subscriptions",
      "organizations_url": "https://api.github.com/users/Giulio2002/orgs",
      "repos_url": "https://api.github.com/users/Giulio2002/repos",
      "events_url": "https://api.github.com/users/Giulio2002/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Giulio2002/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-14T15:02:56Z",
    "updated_at": "2023-10-14T15:03:19Z",
    "author_association": "COLLABORATOR",
    "body": "Hopefully it will be soon be fixed by switching to mdbx, the warning is innocuous by the way",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1762961114/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1774842602",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8311#issuecomment-1774842602",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311",
    "id": 1774842602,
    "node_id": "IC_kwDOC0FsAM5pyfLq",
    "user": {
      "login": "D0pal",
      "id": 142103954,
      "node_id": "U_kgDOCHhVkg",
      "avatar_url": "https://avatars.githubusercontent.com/u/142103954?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/D0pal",
      "html_url": "https://github.com/D0pal",
      "followers_url": "https://api.github.com/users/D0pal/followers",
      "following_url": "https://api.github.com/users/D0pal/following{/other_user}",
      "gists_url": "https://api.github.com/users/D0pal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/D0pal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/D0pal/subscriptions",
      "organizations_url": "https://api.github.com/users/D0pal/orgs",
      "repos_url": "https://api.github.com/users/D0pal/repos",
      "events_url": "https://api.github.com/users/D0pal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/D0pal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-23T10:00:54Z",
    "updated_at": "2023-10-23T10:00:54Z",
    "author_association": "NONE",
    "body": "Yes, I got the same issue too. Maybe run seprate txpool by suing this [https://github.com/ledgerwatch/erigon/blob/devel/cmd/txpool/readme.md](url) could be help. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1774842602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1782459316",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8311#issuecomment-1782459316",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8311",
    "id": 1782459316,
    "node_id": "IC_kwDOC0FsAM5qPiu0",
    "user": {
      "login": "academe-01",
      "id": 95714796,
      "node_id": "U_kgDOBbR97A",
      "avatar_url": "https://avatars.githubusercontent.com/u/95714796?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/academe-01",
      "html_url": "https://github.com/academe-01",
      "followers_url": "https://api.github.com/users/academe-01/followers",
      "following_url": "https://api.github.com/users/academe-01/following{/other_user}",
      "gists_url": "https://api.github.com/users/academe-01/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/academe-01/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/academe-01/subscriptions",
      "organizations_url": "https://api.github.com/users/academe-01/orgs",
      "repos_url": "https://api.github.com/users/academe-01/repos",
      "events_url": "https://api.github.com/users/academe-01/events{/privacy}",
      "received_events_url": "https://api.github.com/users/academe-01/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-27T07:49:03Z",
    "updated_at": "2023-10-27T07:49:03Z",
    "author_association": "NONE",
    "body": "No ```app=caplin stage=CatchUpBlocks err=\"invalid state version\"``` in my logs\r\n\r\n```\r\n[INFO] [10-27|09:26:25.429] [Caplin] Epoch downloaded                app=caplin stage=CatchUpEpochs epoch=238454\r\n[INFO] [10-27|09:26:30.300] [Caplin] Epoch downloaded                app=caplin stage=CatchUpEpochs epoch=238455\r\n[INFO] [10-27|09:26:34.046] [Caplin] Epoch downloaded                app=caplin stage=CatchUpEpochs epoch=238456\r\n[INFO] [10-27|09:26:43.711] [Caplin] Epoch downloaded                app=caplin stage=CatchUpEpochs epoch=238457\r\n[INFO] [10-27|09:26:51.059] P2P                                      app=caplin peers=11\r\n[WARN] [10-27|09:27:20.591] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:27:50.814] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:27:51.060] P2P                                      app=caplin peers=8\r\n[WARN] [10-27|09:28:38.160] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:28:51.061] P2P                                      app=caplin peers=8\r\n[WARN] [10-27|09:29:02.304] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:29:27.347] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:29:51.061] P2P                                      app=caplin peers=5\r\n[WARN] [10-27|09:30:40.661] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:30:51.530] P2P                                      app=caplin peers=12\r\n[WARN] [10-27|09:31:04.842] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:31:51.063] P2P                                      app=caplin peers=11\r\n[WARN] [10-27|09:31:53.529] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:32:49.607] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:32:52.611] P2P                                      app=caplin peers=17\r\n[WARN] [10-27|09:33:13.625] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:33:37.574] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:33:51.065] P2P                                      app=caplin peers=12\r\n[WARN] [10-27|09:34:01.134] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:34:51.203] P2P                                      app=caplin peers=19\r\n[WARN] [10-27|09:35:37.344] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:35:51.066] P2P                                      app=caplin peers=16\r\n[WARN] [10-27|09:36:01.194] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:36:54.333] P2P                                      app=caplin peers=11\r\n[WARN] [10-27|09:36:54.821] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:37:25.327] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:37:51.079] P2P                                      app=caplin peers=13\r\n[WARN] [10-27|09:38:38.471] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:38:52.015] P2P                                      app=caplin peers=12\r\n[WARN] [10-27|09:39:03.562] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:39:27.403] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:39:51.081] P2P                                      app=caplin peers=12\r\n[WARN] [10-27|09:40:15.483] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:40:51.082] P2P                                      app=caplin peers=12\r\n[WARN] [10-27|09:41:03.598] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:41:27.776] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:41:51.083] P2P                                      app=caplin peers=6\r\n[WARN] [10-27|09:41:51.956] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:42:16.119] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:42:40.077] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:42:51.084] P2P                                      app=caplin peers=8\r\n[WARN] [10-27|09:43:04.236] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:43:28.062] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:43:51.085] P2P                                      app=caplin peers=11\r\n[WARN] [10-27|09:43:52.846] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:44:27.464] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:44:51.085] P2P                                      app=caplin peers=10\r\n[WARN] [10-27|09:45:25.822] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[WARN] [10-27|09:45:50.296] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n[INFO] [10-27|09:45:51.087] P2P                                      app=caplin peers=20\r\n[WARN] [10-27|09:46:14.936] error executing clstage                  app=caplin stage=CatchUpBlocks err=\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\"\r\n```\r\n\r\nCan provide full log if needed",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1782459316/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
