{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7892",
  "id": 1804072689,
  "node_id": "I_kwDOC0FsAM5rh_bx",
  "number": 7892,
  "title": "Execution failed block=17687644 nonce too high",
  "user": {
    "login": "gwtp",
    "id": 4351603,
    "node_id": "MDQ6VXNlcjQzNTE2MDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4351603?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gwtp",
    "html_url": "https://github.com/gwtp",
    "followers_url": "https://api.github.com/users/gwtp/followers",
    "following_url": "https://api.github.com/users/gwtp/following{/other_user}",
    "gists_url": "https://api.github.com/users/gwtp/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gwtp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gwtp/subscriptions",
    "organizations_url": "https://api.github.com/users/gwtp/orgs",
    "repos_url": "https://api.github.com/users/gwtp/repos",
    "events_url": "https://api.github.com/users/gwtp/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gwtp/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-07-14T03:00:01Z",
  "updated_at": "2023-07-15T00:43:15Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `$ ./erigon --version\r\nerigon version 2.48.0-stable-084acc1a`\r\n\r\nOS & Version: Windows/Linux/OSX\r\n\r\n`$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID:\tUbuntu\r\nDescription:\tUbuntu 20.04.6 LTS\r\nRelease:\t20.04\r\nCodename:\tfocal\r\n`\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):\r\n`/usr/local/bin/erigon --datadir /var/lib/erigon  --chain mainnet  --metrics --pprof  --prune htc  --prune.r.before=11052984 --authrpc.jwtsecret=/secrets/jwtsecret\r\n`\r\nConcensus Layer:\r\n`teku --version\r\nteku/v23.6.1/linux-x86_64/-privatebuild-openjdk64bitservervm-java-17`\r\n\r\nConcensus Layer Command (with flags/config):\r\n\r\n`/usr/local/bin/teku/bin/teku -c /etc/teku/teku.yaml`\r\n\r\n```# network\r\nnetwork: \"mainnet\"\r\ninitial-state: \"https://2ELeBcG9SHjE7mAOryNPxYGiGAj:c672ee768e02dbec29343bb088e315c3@eth2-beacon-mainnet.infura.io\"\r\n\r\n# validators\r\nvalidator-keys: \"/var/lib/teku/validator_keys:/var/lib/teku/validator_keys\"\r\n#validators-graffiti: \"<MY_GRAFFITI>\"\r\n\r\n# execution engine\r\nee-endpoint: http://localhost:8551\r\nee-jwt-secret-file: \"/secrets/jwtsecret\"\r\n\r\n# fee recipient\r\nvalidators-proposer-default-fee-recipient: <REMOVED>\r\n\r\n# metrics\r\nmetrics-enabled: true\r\nmetrics-port: 8008\r\n\r\n# database\r\ndata-path: \"/var/lib/teku\"\r\ndata-storage-mode: \"prune\"\r\n\r\n# mev-boost\r\nvalidators-builder-registration-default-enabled: true\r\nbuilder-endpoint: http://127.0.0.1:18550\r\n\r\n# get_validator_duties.py\r\nrest-api-enabled: true\r\n```\r\n\r\nChain/Network: Mainnet\r\n\r\n\r\n#### Actual behaviour\r\n\r\n```Jul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.396] [2/15 Headers] Fork choice: chain extension from=17687643 to=0xc04efc1350\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.401] [5/15 Bodies] Processing bodies...       from=17687643 to=17688849\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.789] [5/15 Bodies] Processed                  highest=17688849\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.789] [6/15 Senders] Started                   from=17687643 to=17688849\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.798] [7/15 Execution] Blocks execution        from=17687643 to=17688849\r\nJul 14 12:51:02 erigon[5088]: [WARN] [07-14|12:51:02.799] [7/15 Execution] Execution failed        block=17687644 hash=0x8cc219f272ce8609d4644acbbcc2a859cba4f565d4e37301b76875d92fcb976a err=\"could not apply tx 3 from block 17687644 [0x4f43f0f0dbf7653f2521641f7b54f9d213ebf6ab0a4d5e9e473076eb0766880c]: nonce too high: address 0xE634668Ed6e4bFEeC5E9eA850eA795d675CAE0C4, tx: 150 state: 0\"\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.799] UnwindTo                                 block=17687643 bad_block_hash=0x8cc219f272ce8609d4644acbbcc2a859cba4f565d4e37301b76875d92fcb976a\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.799] [7/15 Execution] Completed on            block=17687643\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.817] Timings (slower than 50ms)               Headers=82ms Bodies=387ms\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.817] Tables                                   PlainState=97.0GB AccountChangeSet=1.4GB StorageChangeSet=2.5GB BlockTransaction=11.9GB TransactionLog=438.2GB FreeList=91.6MB ReclaimableSpace=91.6GB\r\nJul 14 12:51:02 erigon[5088]: [INFO] [07-14|12:51:02.817] [2/15 Headers] Waiting for Consensus Layer...\r\n```\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1635695156",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7892#issuecomment-1635695156",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892",
    "id": 1635695156,
    "node_id": "IC_kwDOC0FsAM5hfro0",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-14T11:02:50Z",
    "updated_at": "2023-07-14T11:02:50Z",
    "author_association": "COLLABORATOR",
    "body": "Try\r\nintegration state_stages —unwind=100\r\nintegration stage_headers —unwind=100\r\nstart erigon ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1635695156/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1635761646",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7892#issuecomment-1635761646",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892",
    "id": 1635761646,
    "node_id": "IC_kwDOC0FsAM5hf73u",
    "user": {
      "login": "gwtp",
      "id": 4351603,
      "node_id": "MDQ6VXNlcjQzNTE2MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4351603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwtp",
      "html_url": "https://github.com/gwtp",
      "followers_url": "https://api.github.com/users/gwtp/followers",
      "following_url": "https://api.github.com/users/gwtp/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwtp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwtp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwtp/subscriptions",
      "organizations_url": "https://api.github.com/users/gwtp/orgs",
      "repos_url": "https://api.github.com/users/gwtp/repos",
      "events_url": "https://api.github.com/users/gwtp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwtp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-14T12:00:59Z",
    "updated_at": "2023-07-14T12:00:59Z",
    "author_association": "NONE",
    "body": "I tried this but seems to be stuck on the same block still, any other suggestions?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1635761646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1635871778",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7892#issuecomment-1635871778",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892",
    "id": 1635871778,
    "node_id": "IC_kwDOC0FsAM5hgWwi",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-14T13:31:56Z",
    "updated_at": "2023-07-14T13:31:56Z",
    "author_association": "COLLABORATOR",
    "body": "try 1000 (but don't go for more)",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1635871778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1636590531",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7892#issuecomment-1636590531",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7892",
    "id": 1636590531,
    "node_id": "IC_kwDOC0FsAM5hjGPD",
    "user": {
      "login": "gwtp",
      "id": 4351603,
      "node_id": "MDQ6VXNlcjQzNTE2MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4351603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gwtp",
      "html_url": "https://github.com/gwtp",
      "followers_url": "https://api.github.com/users/gwtp/followers",
      "following_url": "https://api.github.com/users/gwtp/following{/other_user}",
      "gists_url": "https://api.github.com/users/gwtp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gwtp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gwtp/subscriptions",
      "organizations_url": "https://api.github.com/users/gwtp/orgs",
      "repos_url": "https://api.github.com/users/gwtp/repos",
      "events_url": "https://api.github.com/users/gwtp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gwtp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-15T00:42:39Z",
    "updated_at": "2023-07-15T00:43:15Z",
    "author_association": "NONE",
    "body": "Did 1000 then hit this error:\r\n\r\n```\r\n$ ./integration state_stages --unwind=1000 --datadir=/var/lib/erigon --chain=mainnet\r\nINFO[07-15|09:03:01.891] logging to file system                   log dir=/var/lib/erigon/logs file prefix=integration log level=info json=false\r\nINFO[07-15|09:03:03.649] [snapshots] Blocks Stat                  blocks=17597k indices=17597k alloc=2.1GB sys=2.4GB\r\nINFO[07-15|09:03:03.777] Disk storage enabled for ethash DAGs     dir=/root/.local/share/erigon-ethash count=2\r\nINFO[07-15|09:03:04.156] UnwindTo                                 block=17686643 bad_block_hash=0x0000000000000000000000000000000000000000000000000000000000000000\r\nINFO[07-15|09:05:38.954] [10/15 CallTraces] Unwind                from=17687643 to=17686643\r\n\r\n\r\nINFO[07-15|09:06:29.247] [8/15 HashState] Unwinding started       from=17687643 to=17686643 storage=false codes=true\r\nINFO[07-15|09:06:36.589] [8/15 HashState] Unwinding started       from=17687643 to=17686643 storage=false codes=false\r\nINFO[07-15|09:07:07.002] [8/15 HashState] ETL [2/2] Loading       into=HashedAccount progress=92\r\nINFO[07-15|09:07:13.208] [8/15 HashState] Unwinding started       from=17687643 to=17686643 storage=true codes=false\r\nINFO[07-15|09:07:43.770] [8/15 HashState] ETL [2/2] Loading       into=HashedStorage progress=79\r\nINFO[07-15|09:08:01.609] [8/15 HashState] Unwind done             in=1m32.362539943s\r\nINFO[07-15|09:08:01.610] [9/15 IntermediateHashes] Unwinding      from=17687643 to=17686643 csbucket=AccountChangeSet\r\nEROR[07-15|09:08:23.130] [9/15 IntermediateHashes] mdbx_cursor_get: MDBX_CORRUPTED: Maybe free space is over on disk. Otherwise it's hardware failure. Before creating issue please use tools like https://www.memtest86.com to test RAM and tools like https://www.smartmontools.org to test Disk. To handle hardware risks: use ECC RAM, use RAID of disks, run multiple application instances (or do backups). If hardware checks passed - check FS settings - 'fsync' and 'flock' must be enabled.  Otherwise - please create issue in Application repo. On default DURABLE mode, power outage can't cause this error. On other modes - power outage may break last transaction and mdbx_chk can recover db in this case, see '-t' and '-0|1|2' options. \r\n```\r\n\r\nCurrently running:\r\n\r\n`$ sudo ./mdbx_chk -vv -w /var/lib/erigon/chaindata/`\r\n\r\nSay if there is a certain section that is corrupted, is it possible just to delete that and resync or need to resync from scratch? I suspect the corruption is caused by bad NVME. New one is on the way. I would like to know if I can recover though without fully resyncing. Will provide output once complete. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1636590531/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
