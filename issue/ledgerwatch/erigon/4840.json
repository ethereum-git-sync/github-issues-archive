{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4840",
  "id": 1319246619,
  "node_id": "I_kwDOC0FsAM5Oohsb",
  "number": 4840,
  "title": "Very slow TruncateBlocks issue during migration with latest Erigon",
  "user": {
    "login": "krunkosaurus",
    "id": 20738,
    "node_id": "MDQ6VXNlcjIwNzM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/20738?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/krunkosaurus",
    "html_url": "https://github.com/krunkosaurus",
    "followers_url": "https://api.github.com/users/krunkosaurus/followers",
    "following_url": "https://api.github.com/users/krunkosaurus/following{/other_user}",
    "gists_url": "https://api.github.com/users/krunkosaurus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/krunkosaurus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krunkosaurus/subscriptions",
    "organizations_url": "https://api.github.com/users/krunkosaurus/orgs",
    "repos_url": "https://api.github.com/users/krunkosaurus/repos",
    "events_url": "https://api.github.com/users/krunkosaurus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/krunkosaurus/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-07-27T09:02:58Z",
  "updated_at": "2022-07-29T11:40:15Z",
  "closed_at": "2022-07-29T11:40:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2022.99.99-dev-329d5864`\r\n\r\nOS & Version: OSX, latest M1 Mac Mini + 4TB SSD\r\n\r\n#### Actual behaviour\r\n\r\nUpgraded to latest Erigon build. Ran Erigon and it needs to migrate data and redownlaod last 400k blocks. They have been processing at around 3 blocks a minute. It's going to take 106 days at this rate. I tried restarting computer, ensuring all proper ports are unblocked, tested my download speeds and all is fine. Please advise if I should just start from scratch or any other info you need.\r\n\r\n#### Expected behaviour\r\n\r\nBe able to finish sync within a few days.\r\n\r\n\r\n<img width=\"1307\" alt=\"Screen Shot 2022-07-27 at 4 58 22 PM\" src=\"https://user-images.githubusercontent.com/20738/181206917-a1bf852e-a3ad-442e-8ae2-80add8e9fe06.png\">\r\n<img width=\"415\" alt=\"Screen Shot 2022-07-27 at 10 47 17 AM\" src=\"https://user-images.githubusercontent.com/20738/181207348-4b044214-700f-4231-8305-356d697795f2.png\">\r\n\r\n",
  "closed_by": {
    "login": "krunkosaurus",
    "id": 20738,
    "node_id": "MDQ6VXNlcjIwNzM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/20738?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/krunkosaurus",
    "html_url": "https://github.com/krunkosaurus",
    "followers_url": "https://api.github.com/users/krunkosaurus/followers",
    "following_url": "https://api.github.com/users/krunkosaurus/following{/other_user}",
    "gists_url": "https://api.github.com/users/krunkosaurus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/krunkosaurus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krunkosaurus/subscriptions",
    "organizations_url": "https://api.github.com/users/krunkosaurus/orgs",
    "repos_url": "https://api.github.com/users/krunkosaurus/repos",
    "events_url": "https://api.github.com/users/krunkosaurus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/krunkosaurus/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1196851771",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4840#issuecomment-1196851771",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840",
    "id": 1196851771,
    "node_id": "IC_kwDOC0FsAM5HVoI7",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-27T14:41:51Z",
    "updated_at": "2022-07-27T14:41:51Z",
    "author_association": "COLLABORATOR",
    "body": "Stop and update erigon version again ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1196851771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1197739477",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4840#issuecomment-1197739477",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840",
    "id": 1197739477,
    "node_id": "IC_kwDOC0FsAM5HZA3V",
    "user": {
      "login": "krunkosaurus",
      "id": 20738,
      "node_id": "MDQ6VXNlcjIwNzM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/20738?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krunkosaurus",
      "html_url": "https://github.com/krunkosaurus",
      "followers_url": "https://api.github.com/users/krunkosaurus/followers",
      "following_url": "https://api.github.com/users/krunkosaurus/following{/other_user}",
      "gists_url": "https://api.github.com/users/krunkosaurus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krunkosaurus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krunkosaurus/subscriptions",
      "organizations_url": "https://api.github.com/users/krunkosaurus/orgs",
      "repos_url": "https://api.github.com/users/krunkosaurus/repos",
      "events_url": "https://api.github.com/users/krunkosaurus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krunkosaurus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T06:54:35Z",
    "updated_at": "2022-07-28T06:54:35Z",
    "author_association": "NONE",
    "body": "Will do and let it run for a few hours and report back. Thanks @AskAlexSharov ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1197739477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1197771070",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4840#issuecomment-1197771070",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840",
    "id": 1197771070,
    "node_id": "IC_kwDOC0FsAM5HZIk-",
    "user": {
      "login": "krunkosaurus",
      "id": 20738,
      "node_id": "MDQ6VXNlcjIwNzM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/20738?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krunkosaurus",
      "html_url": "https://github.com/krunkosaurus",
      "followers_url": "https://api.github.com/users/krunkosaurus/followers",
      "following_url": "https://api.github.com/users/krunkosaurus/following{/other_user}",
      "gists_url": "https://api.github.com/users/krunkosaurus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krunkosaurus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krunkosaurus/subscriptions",
      "organizations_url": "https://api.github.com/users/krunkosaurus/orgs",
      "repos_url": "https://api.github.com/users/krunkosaurus/repos",
      "events_url": "https://api.github.com/users/krunkosaurus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krunkosaurus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T07:29:42Z",
    "updated_at": "2022-07-28T07:29:42Z",
    "author_association": "NONE",
    "body": "Updated to latest (620d65ef10318677d1739d3c849b7d0f8a8c4424) and still processing (truncating) at about 3 blocks per minute: \r\n\r\n```\r\nINFO[07-27|23:53:47.099] Build info                               git_branch=devel git_tag=v2021.10.03-1547-g620d65ef1-dirty git_commit=620d65ef10318677d1739d3c849b7d0f8a8c4424\r\nINFO[07-27|23:53:47.101] Starting Erigon on Ethereum mainnet...\r\nINFO[07-27|23:53:47.106] Maximum peer count                       ETH=100 total=100\r\nINFO[07-27|23:53:47.107] torrent verbosity                        level=2\r\nINFO[07-27|23:53:49.474] [torrent] Public IP                      ip=172.221.8.25\r\nINFO[07-27|23:53:49.477] Set global gas cap                       cap=50000000\r\nINFO[07-27|23:53:49.550] Opening Database                         label=chaindata path=/Volumes/crucial/eth-mainnet/chaindata\r\nINFO[07-27|23:54:38.181] Re-Opening DB in exclusive mode to apply migrations\r\nINFO[07-27|23:55:40.770] Apply migration                          name=reset_blocks_3\r\nWARN[07-27|23:55:41.925] NOTE: this migration will remove recent blocks (and senders) to fix several recent bugs. Your node will re-download last ~400K blocks, should not take very long\r\nINFO[07-27|23:57:14.542] TruncateBlocks                           block=14947315\r\nINFO[07-27|23:57:33.001] TruncateBlocks                           block=14947309\r\nINFO[07-27|23:57:41.941] TruncateBlocks                           block=14947147\r\n```\r\n\r\nI have about 1TB of data downloaded. Let me know if its just best to blow it all away and redownload from scratch.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1197771070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1197776389",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4840#issuecomment-1197776389",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840",
    "id": 1197776389,
    "node_id": "IC_kwDOC0FsAM5HZJ4F",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T07:35:31Z",
    "updated_at": "2022-07-28T07:35:31Z",
    "author_association": "COLLABORATOR",
    "body": "then Erigon does think you need this db migration. \r\nplease try branch `faster_truncate` - maybe it will help your speed",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1197776389/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1199179557",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4840#issuecomment-1199179557",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4840",
    "id": 1199179557,
    "node_id": "IC_kwDOC0FsAM5Hegcl",
    "user": {
      "login": "krunkosaurus",
      "id": 20738,
      "node_id": "MDQ6VXNlcjIwNzM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/20738?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krunkosaurus",
      "html_url": "https://github.com/krunkosaurus",
      "followers_url": "https://api.github.com/users/krunkosaurus/followers",
      "following_url": "https://api.github.com/users/krunkosaurus/following{/other_user}",
      "gists_url": "https://api.github.com/users/krunkosaurus/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krunkosaurus/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krunkosaurus/subscriptions",
      "organizations_url": "https://api.github.com/users/krunkosaurus/orgs",
      "repos_url": "https://api.github.com/users/krunkosaurus/repos",
      "events_url": "https://api.github.com/users/krunkosaurus/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krunkosaurus/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-29T11:40:15Z",
    "updated_at": "2022-07-29T11:40:15Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov I found I wasn't properly updating the bin file and still loading the version from Oct 2021. My bad. Closing this ticket now.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1199179557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
