{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4037",
  "id": 1221831310,
  "node_id": "I_kwDOC0FsAM5I06qO",
  "number": 4037,
  "title": "Execution failure on block 14500001",
  "user": {
    "login": "convexman",
    "id": 83774390,
    "node_id": "MDQ6VXNlcjgzNzc0Mzkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/83774390?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/convexman",
    "html_url": "https://github.com/convexman",
    "followers_url": "https://api.github.com/users/convexman/followers",
    "following_url": "https://api.github.com/users/convexman/following{/other_user}",
    "gists_url": "https://api.github.com/users/convexman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/convexman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/convexman/subscriptions",
    "organizations_url": "https://api.github.com/users/convexman/orgs",
    "repos_url": "https://api.github.com/users/convexman/repos",
    "events_url": "https://api.github.com/users/convexman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/convexman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-04-30T13:24:31Z",
  "updated_at": "2022-05-08T03:19:06Z",
  "closed_at": "2022-05-01T14:22:54Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2022.04.3-alpha-04f3e900`\r\n\r\nOS & Version: Ubuntu 20.04\r\n\r\nCommit hash : `04f3e9004ca540aaad46d9dc45ca1c0bd442f758`\r\n\r\n#### Expected behaviour\r\n\r\nEverything works :)\r\n\r\n#### Actual behaviour\r\n\r\nExecution failed on block 14500001\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nI synced erigon on ethereum mainnet via snap sync. \r\nSnapshot was downloaded via torrent, everything went smooth.\r\nFirst few stages completed, but on execution I got folowing error\r\n```\r\nINFO[04-30|07:26:09.688] [6/16 Execution] Executed blocks         number=14499254 blk/s=23.974 tx/s=4392.028 Mgas/s=367.639 gasState=0.823 batch=\"964.86 MiB\" alloc=\"10.06 GiB\" sys=\"20.46 GiB\"                                              \r\nINFO[04-30|07:26:29.649] [6/16 Execution] Executed blocks         number=14499728 blk/s=23.746 tx/s=4205.423 Mgas/s=367.345 gasState=0.836 batch=\"981.07 MiB\" alloc=\"12.88 GiB\" sys=\"20.46 GiB\"                                              \r\nEROR[04-30|07:26:41.204] [6/16 Execution] Execution failed        block=14500001 hash=0x560eb8b9176b94a5d3f78d846920da76de8f4666b310e570b54df1231601cb15 err=\"could not apply tx 0 from block 14500001 [0x2687dd6df6c27ff40d62619927f429a23838ad18fb00e968cee5074ad5ead579]: fee cap less than block base fee: address 0x5AA17fC7F2950ECa85376C3A8CB1509e8e4B39dF, gasFeeCap: 24877446677 baseFee: 27172298596\"                                                                           \r\nINFO[04-30|07:26:41.205] UnwindTo                                 block=14500000 bad_block_hash=0x560eb8b9176b94a5d3f78d846920da76de8f4666b310e570b54df1231601cb15                                                                           \r\n```\r\nAfter that it began to build indices, but I interrupted this to see how could it happen.\r\n\r\nIntegration tools tells me that I'm in this state\r\n\r\n```\r\nmdbx_setup_dxb:15406 filesize mismatch (expect 1362600042496b/332666026p, have 1363652116480b/332922880p)\r\nNote: prune_at doesn't mean 'all data before were deleted' - it just mean stage.Prune function were run to this block. Because 1 stage may prune multiple data types to different prune distance.\r\n                                                                                                                                                                                                                                             \r\n                         stage_at        prune_at\r\nHeaders                  14500000        0                                                                                                                                                   \r\nBlockHashes              14500000        0                                                                                                                                                          \r\nBodies                   14500000        0                                                                                                                                                          \r\nSenders                  14500000        0                                                                                                                                                          \r\nExecution                14500000        0                                                                                                                                                          \r\nTranslation              0               0                                                                                                                                                          \r\nHashState                14500000        0                                                                                                                                                          \r\nIntermediateHashes       14500000        0                                                                                                                                                          \r\nAccountHistoryIndex      0               0                                                                                                                                                          \r\nStorageHistoryIndex      0               0                                                                                                                                                          \r\nLogIndex                 0               0                                                                                                                                                          \r\nCallTraces               0               0                                                                                                                                                          \r\nTxLookup                 0               0                                                                                                                                                          \r\nFinish                   0               0                                                                                                                                                          \r\n--                                                                                                                                                                                                                                           \r\nprune distance: --prune=                                                                                                                                                                                                                     \r\n                                                                                                                                                                                                                                             \r\nsequence: EthTx=1553325656, NonCanonicalTx=33153535\r\n```\r\n\r\nI launched rpcdaemon to double check if I have cannonical chain and stuff like this.\r\n```\r\nâžœ  ~ curl -H \"Content-Type: application/json\" -X POST -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xdd40a0\",false],\"id\":83}' http://localhost:8545\r\n{\"jsonrpc\":\"2.0\",\"id\":83,\"result\":{\"baseFeePerGas\":\"0x73af74872\",\"difficulty\":\"0x2e032d1caff8d9\",\"extraData\":\"0x617369612d65617374312d34\",\"gasLimit\":\"0x1ca35d2\",\"gasUsed\":\"0x0\",\"hash\":\"0xfeed3e175e482268db83d4fd87a43c708f40983343f4b039e582c6f6a95e0e78\",\"logsBloom\":\"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\"miner\":\"0xea674fdde714fd979de3edf0f56aa9716b898ec8\",\"mixHash\":\"0xbd7063d27079586ab3fdae7de0472f93f96f81a0f6c5b3abe903a9c6f62cab06\",\"nonce\":\"0xc5f9ce09d63baf71\",\"number\":\"0xdd40a0\",\"parentHash\":\"0xe311161a7462068919abe2ac2cd42e5806898b3f42ec597699ce764c067c416a\",\"receiptsRoot\":\"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\"sha3Uncles\":\"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\"size\":\"0x219\",\"stateRoot\":\"0xbbf4fe65498447568abe945ea8f926791e491873a367c82ae847aeadf0c7e17f\",\"timestamp\":\"0x6246dd9c\",\"totalDifficulty\":\"0x994af3a04b379bb8b42\",\"transactions\":[],\"transactionsRoot\":\"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\"uncles\":[]}}\r\n```\r\n\r\nSo both blocks seems cannonical to me (https://etherscan.io/block/14500000, https://etherscan.io/block/14500001). Since base fee essentially is calculated from header and it's value 27172298596 is correct it's something wrong with transaction. Indeed tx hash of transaction 0 is not correct it should be https://etherscan.io/tx/0x087e02cde758cd7d1c4c42d3b3222c1bc9f4e1cda92d0cad77a5c0f84c94a1ba and mentioned hash refers to another block https://etherscan.io/tx/0x2687dd6df6c27ff40d62619927f429a23838ad18fb00e968cee5074ad5ead579\r\n\r\nSo somehow I got block with correct hash but with incorrect transactions inside.\r\n\r\nThe issue is persistent: when I launch erigon again it downloads fresh headers/blocks and still fails on block 14500001 with same error.\r\n\r\nAny help how to fix/debug this would be appreciated.",
  "closed_by": {
    "login": "convexman",
    "id": 83774390,
    "node_id": "MDQ6VXNlcjgzNzc0Mzkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/83774390?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/convexman",
    "html_url": "https://github.com/convexman",
    "followers_url": "https://api.github.com/users/convexman/followers",
    "following_url": "https://api.github.com/users/convexman/following{/other_user}",
    "gists_url": "https://api.github.com/users/convexman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/convexman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/convexman/subscriptions",
    "organizations_url": "https://api.github.com/users/convexman/orgs",
    "repos_url": "https://api.github.com/users/convexman/repos",
    "events_url": "https://api.github.com/users/convexman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/convexman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1114110615",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4037#issuecomment-1114110615",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037",
    "id": 1114110615,
    "node_id": "IC_kwDOC0FsAM5CZ_qX",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-01T02:52:26Z",
    "updated_at": "2022-05-01T02:52:26Z",
    "author_association": "COLLABORATOR",
    "body": "Try `2022.04.04-alpha` ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1114110615/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1114131161",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4037#issuecomment-1114131161",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037",
    "id": 1114131161,
    "node_id": "IC_kwDOC0FsAM5CaErZ",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-01T04:44:18Z",
    "updated_at": "2022-05-01T04:44:18Z",
    "author_association": "COLLABORATOR",
    "body": "Hi. My advise: \r\n- switch to latest `devel` branch\r\n- run `make integration` and `./build/bin/integration stage_headers --reset --datadir=<DATADIR> --chain=mainnet`\r\n- start erigon as usually",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1114131161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1114251948",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4037#issuecomment-1114251948",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037",
    "id": 1114251948,
    "node_id": "IC_kwDOC0FsAM5CaiKs",
    "user": {
      "login": "convexman",
      "id": 83774390,
      "node_id": "MDQ6VXNlcjgzNzc0Mzkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/83774390?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/convexman",
      "html_url": "https://github.com/convexman",
      "followers_url": "https://api.github.com/users/convexman/followers",
      "following_url": "https://api.github.com/users/convexman/following{/other_user}",
      "gists_url": "https://api.github.com/users/convexman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/convexman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/convexman/subscriptions",
      "organizations_url": "https://api.github.com/users/convexman/orgs",
      "repos_url": "https://api.github.com/users/convexman/repos",
      "events_url": "https://api.github.com/users/convexman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/convexman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-01T14:22:54Z",
    "updated_at": "2022-05-01T14:22:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "I updated to `git_branch=devel git_tag=v2022.04.04 git_commit=f9d7cb5ca9e8a135a76ddcb6fa4ee526ea383554`\r\nAfter reinsertion of headers and bodies execution continued fine, so I guess it was fixed.\r\nThanks for your time!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1114251948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1120341414",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4037#issuecomment-1120341414",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4037",
    "id": 1120341414,
    "node_id": "IC_kwDOC0FsAM5Cxw2m",
    "user": {
      "login": "garyrob",
      "id": 1130621,
      "node_id": "MDQ6VXNlcjExMzA2MjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1130621?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/garyrob",
      "html_url": "https://github.com/garyrob",
      "followers_url": "https://api.github.com/users/garyrob/followers",
      "following_url": "https://api.github.com/users/garyrob/following{/other_user}",
      "gists_url": "https://api.github.com/users/garyrob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/garyrob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/garyrob/subscriptions",
      "organizations_url": "https://api.github.com/users/garyrob/orgs",
      "repos_url": "https://api.github.com/users/garyrob/repos",
      "events_url": "https://api.github.com/users/garyrob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/garyrob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-08T03:19:06Z",
    "updated_at": "2022-05-08T03:19:06Z",
    "author_association": "NONE",
    "body": "Yes, it appears to be fixed! Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1120341414/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
