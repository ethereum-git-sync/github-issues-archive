{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/241",
  "id": 534604263,
  "node_id": "MDU6SXNzdWU1MzQ2MDQyNjM=",
  "number": 241,
  "title": "State Analytics: client-side error while running stateGrowth",
  "user": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-12-08T21:25:15Z",
  "updated_at": "2019-12-17T05:52:32Z",
  "closed_at": "2019-12-17T05:52:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Have been running the command\r\n````\r\n./build/bin/state stateGrowth --remote-db-addr localhost:9999\r\n````\r\n\r\nfor a while, it went through the account records OK, and then started to get some errors while processing storage records (I realised this was before the server processed got killed, most probably because of the memory pressure, since I was running client and server on the same machine):\r\n````\r\nProcessed 296800000 storage records\r\nProcessed 296900000 storage records\r\nProcessed 297000000 storage records\r\nERROR[12-08|21:14:54.222] could not decode key in response         error=\"cbor decode error [pos 24791039420]: read tcp 127.0.0.1:44984->127.0.0.1:9999: read: connection \r\nreset by peer\" command=8\r\nERROR[12-08|21:14:54.274] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nERROR[12-08|21:14:54.275] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nERROR[12-08|21:14:54.275] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nERROR[12-08|21:14:54.275] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nERROR[12-08|21:14:54.275] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\n\r\n````\r\n\r\nBut it looks like processing still went on with all the errors:\r\n````\r\nERROR[12-08|21:14:55.210] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nProcessed 297100000 storage records\r\nERROR[12-08|21:14:55.210] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\n````\r\n\r\nwhen I sent SIGTERM signal, I got this in the log:\r\n````\r\nERROR[12-08|21:17:03.583] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nERROR[12-08|21:17:03.583] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\nINFO [12-08|21:17:03.536] Got interrupt, shutting down... \r\nERROR[12-08|21:17:03.583] Could not encode command                 error=\"cbor encode error: write tcp 127.0.0.1:44984->127.0.0.1:9999: write: broken pipe\" command=8\r\npanic: can't encode CmdEndTx: {{%!w(string=cbor) %!w(*net.OpError=&{write tcp 0xc00009c210 0xc00009cb10 0xc37b7ea060})}}\r\ngoroutine 1 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/cmd/state/stateless.check(...)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/cmd/state/stateless/state.go:44\r\ngithub.com/ledgerwatch/turbo-geth/cmd/state/stateless.(*Reporter).StateGrowth2(0xc000153ac0, 0xdfd320, 0xc000156380)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/cmd/state/stateless/state.go:274 +0xd7a\r\ngithub.com/ledgerwatch/turbo-geth/cmd/state/commands.init.2.func1(0xc00019a280, 0xc000153a40, 0x0, 0x2, 0x0, 0x0)\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/cmd/state/commands/state_growth.go:29 +0x125\r\ngithub.com/spf13/cobra.(*Command).execute(0xc00019a280, 0xc000153a00, 0x2, 0x2, 0xc00019a280, 0xc000153a00)\r\n        /home/akhounov/workspace/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:826 +0x465\r\ngithub.com/spf13/cobra.(*Command).ExecuteC(0x150a840, 0xc000066548, 0xc00014ea60, 0xc000153901)\r\n        /home/akhounov/workspace/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:914 +0x2fc\r\ngithub.com/spf13/cobra.(*Command).Execute(...)\r\n        /home/akhounov/workspace/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:864\r\ngithub.com/ledgerwatch/turbo-geth/cmd/state/commands.Execute()\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/cmd/state/commands/root.go:40 +0x32\r\nmain.main()\r\n        /home/akhounov/workspace/src/github.com/ledgerwatch/turbo-geth/cmd/state/main.go:29 +0x137\r\n````",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/566392841",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/241#issuecomment-566392841",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/241",
    "id": 566392841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NjM5Mjg0MQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-17T05:52:31Z",
    "updated_at": "2019-12-17T05:52:31Z",
    "author_association": "COLLABORATOR",
    "body": "fixed",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/566392841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
