{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8833",
  "id": 2011120045,
  "node_id": "I_kwDOC0FsAM5330Gt",
  "number": 8833,
  "title": "Upgrading from erigon 2.48.1 to 2.5x (currently trying 2.54.0) causes node to stop syncing",
  "user": {
    "login": "wwhchung",
    "id": 13840097,
    "node_id": "MDQ6VXNlcjEzODQwMDk3",
    "avatar_url": "https://avatars.githubusercontent.com/u/13840097?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wwhchung",
    "html_url": "https://github.com/wwhchung",
    "followers_url": "https://api.github.com/users/wwhchung/followers",
    "following_url": "https://api.github.com/users/wwhchung/following{/other_user}",
    "gists_url": "https://api.github.com/users/wwhchung/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wwhchung/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wwhchung/subscriptions",
    "organizations_url": "https://api.github.com/users/wwhchung/orgs",
    "repos_url": "https://api.github.com/users/wwhchung/repos",
    "events_url": "https://api.github.com/users/wwhchung/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wwhchung/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-11-26T17:06:43Z",
  "updated_at": "2023-11-28T22:05:39Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nerigon version 2.54.0-aeec5221\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: \r\ntag - v2.54.0\r\n\r\nErigon Command (with flags/config):\r\n/usr/bin/erigon --config=/data/erigon/erigon.yaml\r\n\r\nConsensus Layer:\r\nlighthouse\r\nLighthouse v4.5.0-441fc16\r\n\r\nConsensus Layer Command (with flags/config):\r\n/usr/bin/lighthouse bn --datadir /data/lighthouse --network mainnet --http --execution-endpoint http://127.0.0.1:8551 --execution-jwt /data/erigon/jwtsecret\r\n\r\nChain/Network: \r\nmainnet\r\n\r\n#### Expected behaviour\r\nNode properly syncs after version upgrarde\r\n\r\n#### Actual behaviour\r\nNode is no longer syncing, with messages:\r\n[WARN] [11-26|17:06:15.372] Served                                   conn=127.0.0.1:26722 method=engine_forkchoiceUpdatedV2 reqid=1 t=68.793491ms err=\"unexpected chain cap: 18657009\"\r\n\r\n#### Steps to reproduce the behaviour\r\nFull sync on v2.48.1, then upgrade to v2.54.0\r\n\r\n#### Backtrace\r\nN/A\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1827202902",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8833#issuecomment-1827202902",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833",
    "id": 1827202902,
    "node_id": "IC_kwDOC0FsAM5s6OdW",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-27T06:32:55Z",
    "updated_at": "2023-11-27T06:32:55Z",
    "author_association": "COLLABORATOR",
    "body": "show \"integration print_stages\"",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1827202902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1830834622",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8833#issuecomment-1830834622",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8833",
    "id": 1830834622,
    "node_id": "IC_kwDOC0FsAM5tIFG-",
    "user": {
      "login": "bretep",
      "id": 787344,
      "node_id": "MDQ6VXNlcjc4NzM0NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/787344?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bretep",
      "html_url": "https://github.com/bretep",
      "followers_url": "https://api.github.com/users/bretep/followers",
      "following_url": "https://api.github.com/users/bretep/following{/other_user}",
      "gists_url": "https://api.github.com/users/bretep/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bretep/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bretep/subscriptions",
      "organizations_url": "https://api.github.com/users/bretep/orgs",
      "repos_url": "https://api.github.com/users/bretep/repos",
      "events_url": "https://api.github.com/users/bretep/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bretep/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-28T22:05:38Z",
    "updated_at": "2023-11-28T22:05:38Z",
    "author_association": "NONE",
    "body": "We're seeing the same issue on our nodes.\r\n\r\nSomething I noticed on startup of erigon:\r\n```\r\n[INFO] [11-28|21:56:55.656] [db] chaindata                           sizeLimit=3TB pageSize=4096\r\n```\r\n\r\nWhen running `integration print_stages`:\r\n```\r\nINFO[11-28|22:00:48.990] logging to file system                   log dir=/blockchain/logs file prefix=integration log level=info json=false\r\nINFO[11-28|22:00:48.992] [db] chaindata                           sizeLimit=2TB pageSize=4096\r\nNote: prune_at doesn't mean 'all data before were deleted' - it just mean stage.Prune function were run to this block. Because 1 stage may prune multiple data types to different prune distance.\r\n\r\n \t\t\t\t stage_at \t prune_at\r\nSnapshots \t\t\t 18846895 \t 0\r\nHeaders \t\t\t 18846895 \t 0\r\nBorHeimdall \t\t\t 0 \t\t 0\r\nBlockHashes \t\t\t 18846895 \t 0\r\nBodies \t\t\t\t 18846895 \t 0\r\nSenders \t\t\t 18846895 \t 0\r\nExecution \t\t\t 18846895 \t 18846895\r\nTranslation \t\t\t 0 \t\t 0\r\nHashState \t\t\t 18846895 \t 0\r\nIntermediateHashes \t\t 18846895 \t 18846895\r\nAccountHistoryIndex \t\t 18846895 \t 0\r\nStorageHistoryIndex \t\t 18846895 \t 0\r\nLogIndex \t\t\t 18846895 \t 0\r\nCallTraces \t\t\t 18846895 \t 18846895\r\nTxLookup \t\t\t 18846895 \t 0\r\nFinish \t\t\t\t 18846895 \t 0\r\n--\r\nprune distance:\r\n\r\nblocks.v2: blocks=0, segments=0, indices=0\r\n\r\nhistory.v3: false,  idx steps: 0.00, lastMaxTxNum=0->1, lastBlockInSnap=0\r\n\r\nsequence: EthTx=2063258825, NonCanonicalTx=63761\r\n\r\nin db: first header 1, last header 18952054, first body 1, last body 18952054\r\n--\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1830834622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
