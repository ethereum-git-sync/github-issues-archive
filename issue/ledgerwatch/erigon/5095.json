{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5095",
  "id": 1342284413,
  "node_id": "I_kwDOC0FsAM5QAaJ9",
  "number": 5095,
  "title": "crash during DB migration",
  "user": {
    "login": "SCBuergel",
    "id": 11379673,
    "node_id": "MDQ6VXNlcjExMzc5Njcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/11379673?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SCBuergel",
    "html_url": "https://github.com/SCBuergel",
    "followers_url": "https://api.github.com/users/SCBuergel/followers",
    "following_url": "https://api.github.com/users/SCBuergel/following{/other_user}",
    "gists_url": "https://api.github.com/users/SCBuergel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SCBuergel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SCBuergel/subscriptions",
    "organizations_url": "https://api.github.com/users/SCBuergel/orgs",
    "repos_url": "https://api.github.com/users/SCBuergel/repos",
    "events_url": "https://api.github.com/users/SCBuergel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SCBuergel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-08-17T20:56:08Z",
  "updated_at": "2022-08-26T03:19:59Z",
  "closed_at": "2022-08-26T03:19:59Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2022.08.02-alpha (unzipped from GitHub release and `make erigon` following instructions)\r\n\r\nOS & Version: Ubuntu20.04\r\n\r\n#### Expected behaviour\r\nWhen starting my erigon node with `./erigon` I expect it to sync my DB to the new format and start operating normally.\r\n\r\n#### Actual behaviour\r\nIt crashed at 59%:\r\n![Screenshot from 2022-08-17 22-49-23](https://user-images.githubusercontent.com/11379673/185241260-57f74eba-63bf-43f9-b1b3-7358d59b5c3f.png)\r\n\r\nEvery time I start it again, it crashes immediately:\r\n```\r\n$ /home/seb/erigon-2022.08.02/build/bin/erigon\r\nINFO[08-17|22:49:37.885] Build info                               git_branch= git_tag= git_commit=\r\nINFO[08-17|22:49:37.886] Starting Erigon on Ethereum mainnet... \r\nINFO[08-17|22:49:37.887] Maximum peer count                       ETH=100 total=100\r\nINFO[08-17|22:49:37.888] starting HTTP APIs                       APIs=eth,erigon,engine\r\nINFO[08-17|22:49:37.888] torrent verbosity                        level=WRN\r\nINFO[08-17|22:49:40.261] [torrent] Public IP                      ip=178.195.164.159\r\nINFO[08-17|22:49:40.261] Set global gas cap                       cap=50000000\r\nINFO[08-17|22:49:40.307] Opening Database                         label=chaindata path=/home/seb/.local/share/erigon/chaindata\r\nINFO[08-17|22:49:40.309] Re-Opening DB in exclusive mode to apply migrations \r\nINFO[08-17|22:49:40.310] Apply migration                          name=txs_begin_end\r\nINFO[08-17|22:49:40.310] [database version migration] Continue migration from_block=6020000\r\nfatal error: unexpected signal during runtime execution\r\n[signal SIGBUS: bus error code=0x2 addr=0x7721ebaeb010 pc=0x424b6c]\r\n\r\nruntime stack:\r\nruntime.throw({0x19e4b63?, 0x7f1258003c50?})\r\n\truntime/panic.go:992 +0x71\r\nruntime.sigpanic()\r\n\truntime/signal_unix.go:802 +0x3a9\r\n\r\ngoroutine 1 [syscall, locked to thread]:\r\nruntime.cgocall(0x15a9790, 0xc001b75fb0)\r\n\truntime/cgocall.go:157 +0x5c fp=0xc001b75f88 sp=0xc001b75f50 pc=0x4293bc\r\ngithub.com/torquem-ch/mdbx-go/mdbx._Cfunc_mdbx_cursor_get(0x7f125bfff6c0, 0x7f1258003c50, 0x7f1258003c70, 0x8)\r\n\t_cgo_gotypes.go:447 +0x4c fp=0xc001b75fb0 sp=0xc001b75f88 pc=0x8b09cc\r\ngithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).getVal0.func1(0xc001b76078?, 0x8)\r\n\tgithub.com/torquem-ch/mdbx-go@v0.25.2/mdbx/cursor.go:184 +0xb0 fp=0xc001b76000 sp=0xc001b75fb0 pc=0x8b4950\r\ngithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).getVal0(0xc00003f000?, 0xc0020d4000?)\r\n\tgithub.com/torquem-ch/mdbx-go@v0.25.2/mdbx/cursor.go:184 +0x1d fp=0xc001b76030 sp=0xc001b76000 pc=0x8b477d\r\ngithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).Get(0xc00088e190, {0x0, 0x0, 0x0}, {0x0?, 0xaa?, 0xc00088e190?}, 0x8)\r\n\tgithub.com/torquem-ch/mdbx-go@v0.25.2/mdbx/cursor.go:140 +0x65 fp=0xc001b760a0 sp=0xc001b76030 pc=0x8b44a5\r\ngithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxCursor).next(...)\r\n\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20220814135647-e160c1ad9ca1/kv/mdbx/kv_mdbx.go:1123\r\ngithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxCursor).Next(0xc0005f2960)\r\n\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20220814135647-e160c1ad9ca1/kv/mdbx/kv_mdbx.go:1272 +0x50 fp=0xc001b76178 sp=0xc001b760a0 pc=0xa9b550\r\ngithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxTx).ForAmount(0xc00088a680?, {0x19ab43d?, 0xc0005b0180?}, {0xc00097e6a8, 0x8, 0x8}, 0x5e, 0xc0005b01b0)\r\n\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20220814135647-e160c1ad9ca1/kv/mdbx/kv_mdbx.go:557 +0x176 fp=0xc001b76210 sp=0xc001b76178 pc=0xa96ff6\r\ngithub.com/ledgerwatch/erigon/core/rawdb.CanonicalTransactions({0x7f12782a9e68, 0xc00071a0f0}, 0x10664f44, 0x5e)\r\n\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:409 +0x1f0 fp=0xc001b76290 sp=0xc001b76210 pc=0x110ebd0\r\ngithub.com/ledgerwatch/erigon/migrations.glob..func3({0x2026c90, 0xc000906160}, {{0xc0001169a0, 0x1d}, {0xc0001169a0, 0x1d}, {0xc0005abaa0, 0x27}, {0xc0008924c0, 0x36}, ...}, ...)\r\n\tgithub.com/ledgerwatch/erigon/migrations/txs_begin_end.go:91 +0x7ee fp=0xc001b77bb8 sp=0xc001b76290 pc=0x129e04e\r\ngithub.com/ledgerwatch/erigon/migrations.(*Migrator).Apply(0xc0004183a8, {0x2026c90, 0xc000906160}, {0xc0001169a0?, 0x0?})\r\n\tgithub.com/ledgerwatch/erigon/migrations/migrations.go:205 +0x772 fp=0xc001b77ef8 sp=0xc001b77bb8 pc=0x129c392\r\ngithub.com/ledgerwatch/erigon/node.OpenDatabase(0xc0002a8000, {0x20291c0, 0xc0000c7b00}, 0x0)\r\n\tgithub.com/ledgerwatch/erigon/node/node.go:354 +0x3b3 fp=0xc001b78020 sp=0xc001b77ef8 pc=0x12a49f3\r\ngithub.com/ledgerwatch/erigon/eth.New(0xc00088a000, 0x2b74e20, {0x20291c0?, 0xc0000c7b00})\r\n\tgithub.com/ledgerwatch/erigon/eth/backend.go:158 +0x43c fp=0xc001b797d8 sp=0xc001b78020 pc=0x155575c\r\ngithub.com/ledgerwatch/erigon/turbo/node.New(0x200234a?, 0x199a4df?, {0x20291c0, 0xc0000c7b00})\r\n\tgithub.com/ledgerwatch/erigon/turbo/node/node.go:115 +0x85 fp=0xc001b79838 sp=0xc001b797d8 pc=0x1562145\r\nmain.runErigon(0xc000386580?)\r\n\tgithub.com/ledgerwatch/erigon/cmd/erigon/main.go:58 +0x28e fp=0xc001b79908 sp=0xc001b79838 pc=0x15a812e\r\ngithub.com/urfave/cli.HandleAction({0x16cd080?, 0x1e008a0?}, 0xc00075a000?)\r\n\tgithub.com/urfave/cli@v1.22.9/app.go:526 +0x50 fp=0xc001b79920 sp=0xc001b79908 pc=0x5f3c70\r\ngithub.com/urfave/cli.(*App).Run(0xc00075a000, {0xc0001981e0, 0x1, 0x1})\r\n\tgithub.com/urfave/cli@v1.22.9/app.go:286 +0x7c5 fp=0xc001b79ef8 sp=0xc001b79920 pc=0x5f1245\r\nmain.main()\r\n\tgithub.com/ledgerwatch/erigon/cmd/erigon/main.go:34 +0x75 fp=0xc001b79f80 sp=0xc001b79ef8 pc=0x15a7db5\r\nruntime.main()\r\n\truntime/proc.go:250 +0x212 fp=0xc001b79fe0 sp=0xc001b79f80 pc=0x45e032\r\nruntime.goexit()\r\n\truntime/asm_amd64.s:1571 +0x1 fp=0xc001b79fe8 sp=0xc001b79fe0 pc=0x48ec01\r\n\r\ngoroutine 19 [sleep]:\r\ntime.Sleep(0x22ecb25c00)\r\n\truntime/time.go:194 +0x12e\r\ngithub.com/VictoriaMetrics/metrics.summariesSwapCron(0x45d964b800)\r\n\tgithub.com/VictoriaMetrics/metrics@v1.22.1/summary.go:237 +0x36\r\ncreated by github.com/VictoriaMetrics/metrics.registerSummaryLocked\r\n\tgithub.com/VictoriaMetrics/metrics@v1.22.1/summary.go:211 +0x125\r\n```\r\n#### Steps to reproduce the behaviour\r\nStart erigon with the last release of 2021, then install latest version and wait for DB migration to crash\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1219284208",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5095#issuecomment-1219284208",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5095",
    "id": 1219284208,
    "node_id": "IC_kwDOC0FsAM5IrMzw",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-18T09:49:20Z",
    "updated_at": "2022-08-18T09:49:20Z",
    "author_association": "COLLABORATOR",
    "body": "SIGBUS on MMAP may be because of hardware failure: Please use tools like https://www.memtest86.com to test RAM and tools like https://www.smartmontools.org to test Disk",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1219284208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
