{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8511",
  "id": 1949120579,
  "node_id": "I_kwDOC0FsAM50LThD",
  "number": 8511,
  "title": "Running ETH often causes crashes",
  "user": {
    "login": "git-ljm",
    "id": 88469127,
    "node_id": "MDQ6VXNlcjg4NDY5MTI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/88469127?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/git-ljm",
    "html_url": "https://github.com/git-ljm",
    "followers_url": "https://api.github.com/users/git-ljm/followers",
    "following_url": "https://api.github.com/users/git-ljm/following{/other_user}",
    "gists_url": "https://api.github.com/users/git-ljm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/git-ljm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/git-ljm/subscriptions",
    "organizations_url": "https://api.github.com/users/git-ljm/orgs",
    "repos_url": "https://api.github.com/users/git-ljm/repos",
    "events_url": "https://api.github.com/users/git-ljm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/git-ljm/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-10-18T08:02:27Z",
  "updated_at": "2023-10-18T11:43:11Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2.51.0-a0160bee`\r\n\r\nOS & Version: Linux\r\n\r\nCommit hash: a0160beee4032491501d89c5347bb1c4710ee6cc\r\n\r\nErigon Command (with flags/config):  erigon --datadir=/data --private.api.addr=0.0.0.0:9090 --http.api=eth,erigon,engine,debug,net,trace,web3 --http=true --http.addr=0.0.0.0 --http.port=8545 --http.vhosts=* --http.corsdomain=* --ws=true --log.console.json --internalcl --prune=htc --prune.r.before=11052984\r\n\r\nConsensus Layer:  internalcl\r\n\r\nConsensus Layer Command (with flags/config): --internalcl\r\n\r\nChain/Network:  eth mainnet\r\n\r\n\r\n\r\n####tail  log\r\n\r\n````\r\n{\"from\":18285782,\"lvl\":\"info\",\"msg\":\"[7/12 CallTraces] Pruned call trace intermediate table\",\"t\":\"2023-10-18T07:42:16.640621466Z\",\"to\":18285820}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":38,\"t\":\"2023-10-18T07:42:44.688808578Z\"}\r\n{\"from\":18375782,\"hash\":\"0xc7b8d8b90cf42913670a193dc15624560e328d0418212cd1ca186c474cf12a2c\",\"header sending\":\"3.639889ms\",\"log sending\":\"313ns\",\"lvl\":\"info\",\"msg\":\"RPC Daemon notified of new headers\",\"t\":\"2023-10-18T07:43:40.242519204Z\",\"to\":18375821}\r\n{\"hash\":\"0xc7b8d8b90cf42913670a193dc15624560e328d0418212cd1ca186c474cf12a2c\",\"lvl\":\"info\",\"msg\":\"head updated\",\"number\":18375821,\"t\":\"2023-10-18T07:43:40.287488664Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":29,\"t\":\"2023-10-18T07:43:44.69076023Z\"}\r\n{\"eth67\":\"32\",\"eth68\":\"33\",\"lvl\":\"info\",\"msg\":\"[p2p] GoodPeers\",\"t\":\"2023-10-18T07:44:09.393479846Z\"}\r\n{\"app\":\"caplin\",\"err\":\"failed to write block root to beacon_indicies: sql: transaction has already been committed or rolled back\",\"lvl\":\"warn\",\"msg\":\"error executing clstage\",\"stage\":\"CatchUpBlocks\",\"t\":\"2023-10-18T07:44:15.460250193Z\"}\r\n{\"alloc\":\"15.6GB\",\"baseFee\":0,\"lvl\":\"info\",\"msg\":\"[txpool] stat\",\"pending\":10000,\"queued\":29940,\"sys\":\"23.7GB\",\"t\":\"2023-10-18T07:44:16.911593878Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":22,\"t\":\"2023-10-18T07:44:44.690738466Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":35,\"t\":\"2023-10-18T07:45:44.690478217Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":30,\"t\":\"2023-10-18T07:46:54.172866931Z\"}\r\n{\"eth67\":\"32\",\"eth68\":\"33\",\"lvl\":\"info\",\"msg\":\"[p2p] GoodPeers\",\"t\":\"2023-10-18T07:47:13.298709367Z\"}\r\n{\"current key\":\"3d3c6e6f\",\"lvl\":\"info\",\"msg\":\"[7/7 IntermediateHashes] Calculating Merkle root\",\"t\":\"2023-10-18T07:47:26.075116887Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":29,\"t\":\"2023-10-18T07:47:45.304256169Z\"}\r\n{\"current key\":\"3dfbb126\",\"lvl\":\"info\",\"msg\":\"[7/7 IntermediateHashes] Calculating Merkle root\",\"t\":\"2023-10-18T07:47:47.474298136Z\"}\r\n{\"alloc\":\"17.2GB\",\"baseFee\":0,\"lvl\":\"info\",\"msg\":\"[txpool] stat\",\"pending\":10000,\"queued\":30000,\"sys\":\"23.7GB\",\"t\":\"2023-10-18T07:48:03.101014742Z\"}\r\n{\"current key\":\"43acef30\",\"lvl\":\"info\",\"msg\":\"[7/7 IntermediateHashes] Calculating Merkle root\",\"t\":\"2023-10-18T07:48:20.843264193Z\"}\r\n{\"current key\":\"a0a5031a\",\"lvl\":\"info\",\"msg\":\"[7/7 IntermediateHashes] Calculating Merkle root\",\"t\":\"2023-10-18T07:48:43.601593448Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"P2P\",\"peers\":5,\"t\":\"2023-10-18T07:48:45.502506176Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"Got interrupt, shutting down...\",\"t\":\"2023-10-18T07:48:53.725077208Z\"}\r\n{\"err\":\"[7/7 IntermediateHashes] stopped\",\"lvl\":\"warn\",\"msg\":\"Could not validate block\",\"t\":\"2023-10-18T07:48:53.729394122Z\"}\r\n{\"err\":\"context canceled\",\"lvl\":\"eror\",\"msg\":\"[txpool] collect info to propagate\",\"t\":\"2023-10-18T07:48:53.743203139Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"Exiting Engine...\",\"t\":\"2023-10-18T07:48:53.810275537Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"RPC server shutting down\",\"t\":\"2023-10-18T07:48:53.810373593Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"RPC server shutting down\",\"t\":\"2023-10-18T07:48:53.813402984Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"Engine HTTP endpoint close\",\"t\":\"2023-10-18T07:48:53.821144361Z\",\"url\":\"[127.0.0.1:8551](http://127.0.0.1:8551/)\"}\r\n{\"lvl\":\"info\",\"msg\":\"Exiting...\",\"t\":\"2023-10-18T07:48:53.824399157Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"RPC server shutting down\",\"t\":\"2023-10-18T07:48:53.861214762Z\"}\r\n{\"err\":\"EOF\",\"lvl\":\"warn\",\"msg\":\"[Beacon Gossip] Fatal error receiving gossip\",\"t\":\"2023-10-18T07:48:53.836687215Z\"}\r\n{\"lvl\":\"info\",\"msg\":\"HTTP endpoint closed\",\"t\":\"2023-10-18T07:48:53.88128076Z\",\"url\":\"[::]:8545\"}\r\n{\"err\":\"[7/7 IntermediateHashes] stopped\",\"lvl\":\"warn\",\"msg\":\"newPayload failed\",\"t\":\"2023-10-18T07:48:53.800131987Z\"}\r\n{\"lvl\":\"warn\",\"msg\":\"fail to process block\",\"reason\":\"[7/7 IntermediateHashes] stopped\",\"slot\":7565910,\"t\":\"2023-10-18T07:48:53.903789994Z\"}\r\n{\"app\":\"caplin\",\"lvl\":\"info\",\"msg\":\"[Caplin] exiting clstages loop\",\"t\":\"2023-10-18T07:48:53.906063167Z\"}\r\n{\"err\":\"db closed\",\"lvl\":\"warn\",\"method\":\"trace_transaction\",\"msg\":\"Served\",\"reqid\":\"11523015\",\"t\":\"104.897µs\"}\r\n{\"err\":\"db closed\",\"lvl\":\"warn\",\"method\":\"eth_getTransactionReceipt\",\"msg\":\"Served\",\"reqid\":\"11523014\",\"t\":\"99.742µs\"}\r\n{\"err\":\"db closed\",\"lvl\":\"warn\",\"method\":\"eth_getTransactionReceipt\",\"msg\":\"Served\",\"reqid\":\"11523016\",\"t\":\"114.408µs\"}\r\n````\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1768156932",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8511#issuecomment-1768156932",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511",
    "id": 1768156932,
    "node_id": "IC_kwDOC0FsAM5pY-8E",
    "user": {
      "login": "xjhweb",
      "id": 5699409,
      "node_id": "MDQ6VXNlcjU2OTk0MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5699409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xjhweb",
      "html_url": "https://github.com/xjhweb",
      "followers_url": "https://api.github.com/users/xjhweb/followers",
      "following_url": "https://api.github.com/users/xjhweb/following{/other_user}",
      "gists_url": "https://api.github.com/users/xjhweb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xjhweb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xjhweb/subscriptions",
      "organizations_url": "https://api.github.com/users/xjhweb/orgs",
      "repos_url": "https://api.github.com/users/xjhweb/repos",
      "events_url": "https://api.github.com/users/xjhweb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xjhweb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-18T10:31:22Z",
    "updated_at": "2023-10-18T10:31:22Z",
    "author_association": "NONE",
    "body": "same p.b +1\r\n\r\nnew archive node sync with internalcl .\r\n\r\nbuild from newest commit.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1768156932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1768273160",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8511#issuecomment-1768273160",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8511",
    "id": 1768273160,
    "node_id": "IC_kwDOC0FsAM5pZbUI",
    "user": {
      "login": "xjhweb",
      "id": 5699409,
      "node_id": "MDQ6VXNlcjU2OTk0MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5699409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xjhweb",
      "html_url": "https://github.com/xjhweb",
      "followers_url": "https://api.github.com/users/xjhweb/followers",
      "following_url": "https://api.github.com/users/xjhweb/following{/other_user}",
      "gists_url": "https://api.github.com/users/xjhweb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xjhweb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xjhweb/subscriptions",
      "organizations_url": "https://api.github.com/users/xjhweb/orgs",
      "repos_url": "https://api.github.com/users/xjhweb/repos",
      "events_url": "https://api.github.com/users/xjhweb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xjhweb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-18T11:43:11Z",
    "updated_at": "2023-10-18T11:43:11Z",
    "author_association": "NONE",
    "body": "more detail:\r\n\r\n\r\n`\r\n\u001B[32mINFO\u001B[0m[10-18|19:38:51.677] [Caplin] Epoch downloaded                \u001B[32mapp\u001B[0m=caplin \u001B[32mstage\u001B[0m=CatchUpEpochs \u001B[32mepoch\u001B[0m=236469\r\n\u001B[32mINFO\u001B[0m[10-18|19:39:03.295] [Caplin] Epoch downloaded                \u001B[32mapp\u001B[0m=caplin \u001B[32mstage\u001B[0m=CatchUpEpochs \u001B[32mepoch\u001B[0m=236470\r\n\u001B[32mINFO\u001B[0m[10-18|19:39:08.244] [snapshots] Dumping txs                  \u001B[32mblock num\u001B[0m=18021922 \u001B[32malloc\u001B[0m=7.2GB \u001B[32msys\u001B[0m=8.4GB\r\n\u001B[32mINFO\u001B[0m[10-18|19:39:13.675] [Caplin] Epoch downloaded                \u001B[32mapp\u001B[0m=caplin \u001B[32mstage\u001B[0m=CatchUpEpochs \u001B[32mepoch\u001B[0m=236471\r\nruntime: g4818432: frame.sp=0xc03d51c680 top=0xc03d51dfe0\r\n        stack=[0xc03d51a000-0xc03d51e000\r\nfatal error: traceback did not unwind completely\r\n\r\nruntime stack:\r\nruntime.throw({0x290091a?, 0x0?})\r\n        runtime/panic.go:1077 +0x5c fp=0x7a575562a910 sp=0x7a575562a8e0 pc=0x46377c\r\nruntime.(*unwinder).finishInternal(0x0?)\r\n        runtime/traceback.go:561 +0x12a fp=0x7a575562a950 sp=0x7a575562a910 pc=0x48a3ea\r\nruntime.(*unwinder).next(0x7a575562ab50?)\r\n        runtime/traceback.go:442 +0x232 fp=0x7a575562a9c8 sp=0x7a575562a950 pc=0x48a1f2\r\nruntime.copystack(0xc0f1c00d00, 0x800000002?)\r\n        runtime/stack.go:934 +0x2d2 fp=0x7a575562acc0 sp=0x7a575562a9c8 pc=0x47d9f2\r\nruntime.newstack()\r\n        runtime/stack.go:1116 +0x47f fp=0x7a575562ae70 sp=0x7a575562acc0 pc=0x47df9f\r\nruntime.morestack()\r\n        runtime/asm_amd64.s:593 +0x8f fp=0x7a575562ae78 sp=0x7a575562ae70 pc=0x49812f\r\n\r\ngoroutine 4818432 [copystack]:\r\ngithub.com/prysmaticlabs/gohashtree._hash(0xc0d0fc0000, 0xc0d0fc0000, 0x2)\r\n        github.com/prysmaticlabs/gohashtree@v0.0.3-alpha.0.20230510131438-bf992328364a/hash_amd64.s:775 +0x18fd5 fp=0xc03d51c688 sp=0xc03d51c680 pc=0x128cb55\r\ncreated by github.com/ledgerwatch/erigon/cl/clstages.(*StageGraph[...]).StartWithStage in goroutine 15803\r\n        github.com/ledgerwatch/erigon/cl/clstages/clstages.go:34 +0x3c9\r\n\r\ngoroutine 1 [chan receive, 8 minutes]:\r\nruntime.gopark(0xc05d0a3768?, 0x46e96b?, 0x48?, 0x37?, 0x46e9a0?)\r\n        runtime/proc.go:398 +0xce fp=0xc0972db730 sp=0xc0972db710 pc=0x46666e\r\nruntime.chanrecv(0xc000b5e060, 0x0, 0x1)\r\n        runtime/chan.go:583 +0x3cd fp=0xc0972db7a8 sp=0xc0972db730 pc=0x431b0d\r\nruntime.chanrecv1(0xc000692000?, 0x303a800?)\r\n        runtime/chan.go:442 +0x12 fp=0xc0972db7d0 sp=0xc0972db7a8 pc=0x431712\r\ngithub.com/ledgerwatch/erigon/node.(*Node).Wait(...)\r\n        github.com/ledgerwatch/erigon/node/node.go:271\r\ngithub.com/ledgerwatch/erigon/turbo/node.(*ErigonNode).Serve(0xc0e0da6a60)\r\n        github.com/ledgerwatch/erigon/turbo/node/node.go:34 +0x6e fp=0xc0972db820 sp=0xc0972db7d0 pc=0x209056e\r\nmain.runErigon(0xc000ce71c0)\r\n        github.com/ledgerwatch/erigon/cmd/erigon/main.go:90 +0x505 fp=0xc0972dbac0 sp=0xc0972db820 pc=0x20a58e5\r\ngithub.com/ledgerwatch/erigon/turbo/app.MakeApp.func1(0xc000ce71c0)\r\n        github.com/ledgerwatch/erigon/turbo/app/make_app.go:43 +0xb7 fp=0xc0972dbbc0 sp=0xc0972dbac0 pc=0x209a7b7\r\ngithub.com/urfave/cli/v2.(*Command).Run(0xc000053e40, 0xc000ce71c0, {0xc0001c6000, 0x16, 0x16})\r\n        github.com/urfave/cli/v2@v2.25.7/command.go:274 +0x998 fp=0xc0972dbe50 sp=0xc0972dbbc0 pc=0x8f6778\r\ngithub.com/urfave/cli/v2.(*App).RunContext(0xc0000550e0, {0x3027968?, 0x4ad24a0}, {0xc0001c6000, 0x16, 0x16})\r\n        github.com/urfave/cli/v2@v2.25.7/app.go:332 +0x5b7 fp=0xc0972dbeb8 sp=0xc0972dbe50 pc=0x8f30f7\r\ngithub.com/urfave/cli/v2.(*App).Run(...)\r\n        github.com/urfave/cli/v2@v2.25.7/app.go:309\r\nmain.main()\r\n        github.com/ledgerwatch/erigon/cmd/erigon/main.go:41 +0x85 fp=0xc0972dbf40 sp=0xc0972dbeb8 pc=0x20a5305\r\nruntime.main()\r\n        runtime/proc.go:267 +0x2bb fp=0xc0972dbfe0 sp=0xc0972dbf40 pc=0x4661fb\r\nruntime.goexit()\r\n        runtime/asm_amd64.s:1650 +0x1 fp=0xc0972dbfe8 sp=0xc0972dbfe0 pc=0x499fc1\r\n`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1768273160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
