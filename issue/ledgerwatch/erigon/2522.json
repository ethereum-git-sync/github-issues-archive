{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2522",
  "id": 970205193,
  "node_id": "MDU6SXNzdWU5NzAyMDUxOTM=",
  "number": 2522,
  "title": "RPC method trace_filter crashed on block 7111822",
  "user": {
    "login": "culmore2015",
    "id": 12622153,
    "node_id": "MDQ6VXNlcjEyNjIyMTUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/12622153?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/culmore2015",
    "html_url": "https://github.com/culmore2015",
    "followers_url": "https://api.github.com/users/culmore2015/followers",
    "following_url": "https://api.github.com/users/culmore2015/following{/other_user}",
    "gists_url": "https://api.github.com/users/culmore2015/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/culmore2015/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/culmore2015/subscriptions",
    "organizations_url": "https://api.github.com/users/culmore2015/orgs",
    "repos_url": "https://api.github.com/users/culmore2015/repos",
    "events_url": "https://api.github.com/users/culmore2015/events{/privacy}",
    "received_events_url": "https://api.github.com/users/culmore2015/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-08-13T09:01:51Z",
  "updated_at": "2021-08-13T09:52:56Z",
  "closed_at": "2021-08-13T09:52:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2021.08.2-alpha\r\n\r\nOS & Version: Ubuntu 20.10\r\n\r\nCommit hash : 155186ad3e5d1c08ca947b354a9cd0907fb83308\r\n\r\n#### Expected behaviour\r\n\r\n```\r\n{\"jsonrpc\":\"2.0\",\"result\":[{\"action\":{\"callType\":\"call\",\"from\":\"0x14972f2e4cfb2c1b254d0adfc2b14c144b94d8d2\",\"gas\":\"0x6f7c\",\"input\":\"0xa9059cbb000000000000000000000000d4683486536f0baef318967dc1dd4fe669052a33000000000000000000000000000000000000000000000000000000007bcc8140\",\"to\":\"0xe251524df2bc0b83716749dc71975f173a5ef35c\",\"value\":\"0x0\"},\"blockHash\":\"0x660b581d9d2dab57abfa7a5dbe8bf9c2c4e50ffdaacc4faa4a0ee8deb272c8a7\",\"blockNumber\":7111822,\"result\":{\"gasUsed\":\"0x6f2a\",\"output\": ...\r\n```\r\n\r\n#### Actual behaviour\r\n\r\n```\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":[{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32000,\"message\":\"method handler crashed\"}}\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n```\r\ncurl --data '{\"method\":\"trace_filter\",\"params\":[{\"fromBlock\":\"0x6c848e\",\"toBlock\":\"0x6c848e\"}],\"id\":1,\"jsonrpc\":\"2.0\"}' -H \"Content-Type: application/json\" -X POST localhost:8545\r\n```\r\n\r\n#### Backtrace\r\n\r\n````\r\nRPC method trace_filter crashed: runtime error: index out of range [-1]\r\ngoroutine 26200 [running]:\r\ngithub.com/ledgerwatch/erigon/rpc.(*callback).call.func1(0xc00047d724, 0xc, 0xc000655cd8)\r\n        github.com/ledgerwatch/erigon/rpc/service.go:219 +0xbd\r\npanic(0x112c0e0, 0xc000ca78a8)\r\n        runtime/panic.go:965 +0x1b9\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*OeTracer).CaptureEnd(0xc000cf2000, 0x0, 0xc000ccda00, 0x20, 0x20, 0x10d88, 0x10b30, 0x1d3c, 0x0, 0x0, ...)\r\n        github.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/trace_adhoc.go:338 +0xd05\r\ngithub.com/ledgerwatch/erigon/core/vm.(*EVM).Call.func1(0xc000ce91e0, 0xc0006540b0, 0xc000654098, 0xc0006540d0, 0x10d88, 0xc03da93b836c4b3a, 0x131a7b712ae, 0x1992f60)\r\n        github.com/ledgerwatch/erigon/core/vm/evm.go:234 +0xd4\r\ngithub.com/ledgerwatch/erigon/core/vm.(*EVM).Call(0xc000ce91e0, 0x1316240, 0xc000ca7800, 0x0, 0x0, 0x3000000, 0x19cc1f8, 0x0, 0x0, 0x10b30, ...)\r\n        github.com/ledgerwatch/erigon/core/vm/evm.go:286 +0x439\r\ngithub.com/ledgerwatch/erigon/core.(*StateTransition).TransitionDb(0xc001ff0480, 0x1330001, 0xc000cece10, 0xc005f30db8, 0xc001ff0480)\r\n        github.com/ledgerwatch/erigon/core/state_transition.go:338 +0x52a\r\ngithub.com/ledgerwatch/erigon/core.ApplyMessage(0xc000ce91e0, 0x13346d8, 0xc000cece10, 0xc005f30db8, 0xaa4fccaafd0f0001, 0xa7c872b2dee80e4a, 0xf5cf0605, 0x7a1200)\r\n        github.com/ledgerwatch/erigon/core/state_transition.go:189 +0x6d\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*TraceAPIImpl).doCallMany(0xc000112690, 0x1328ed8, 0xc00549eac0, 0x1334128, 0xc000598510, 0xc0005ec000, 0xdc, 0xdc, 0xc000c00a80, 0xdc, ...)\r\n        github.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/trace_adhoc.go:1152 +0xdb3\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*TraceAPIImpl).callManyTransactions(0xc000112690, 0x1328ed8, 0xc00549eac0, 0x1334128, 0xc000598510, 0xc000577000, 0xdc, 0xdc, 0xc0010e2c90, 0x1, ...)\r\n        github.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/trace_filtering.go:433 +0x53a\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*TraceAPIImpl).Filter(0xc000112690, 0x1328ed8, 0xc00549eac0, 0xc00047d760, 0xc00047d768, 0x0, 0x0, 0x0, 0xc000769f20, 0x1, ...)\r\n        github.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/trace_filtering.go:296 +0x1e35\r\nreflect.Value.call(0xc00078a180, 0xc000110c10, 0x13, 0x11b5df0, 0x4, 0xc002926e10, 0x4, 0x6, 0x6, 0x48, ...)\r\n        reflect/value.go:476 +0x8e7\r\nreflect.Value.Call(0xc00078a180, 0xc000110c10, 0x13, 0xc002926e10, 0x4, 0x6, 0x3, 0x6, 0x0)\r\n        reflect/value.go:337 +0xb9\r\ngithub.com/ledgerwatch/erigon/rpc.(*callback).call(0xc0004f9080, 0x1328ed8, 0xc00549eac0, 0xc00047d724, 0xc, 0xc002224cf0, 0x1, 0x1, 0xc00072aae0, 0x0, ...)\r\n        github.com/ledgerwatch/erigon/rpc/service.go:226 +0x392\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).runMethod(0xc003dd86e0, 0x1328ed8, 0xc00549eac0, 0xc0001a64d0, 0xc0004f9080, 0xc002224cf0, 0x1, 0x1, 0xc00072aae0, 0x0)\r\n        github.com/ledgerwatch/erigon/rpc/handler.go:488 +0x54f\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleCall(0xc003dd86e0, 0xc000598390, 0xc0001a64d0, 0xc00072aae0, 0xc002926d88)\r\n        github.com/ledgerwatch/erigon/rpc/handler.go:428 +0x25f\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleCallMsg(0xc003dd86e0, 0xc000598390, 0xc0001a64d0, 0xc00072aae0, 0x18)\r\n        github.com/ledgerwatch/erigon/rpc/handler.go:382 +0x1cb\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleMsg.func1(0xc000598390)\r\n        github.com/ledgerwatch/erigon/rpc/handler.go:217 +0x7b\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).startCallProc.func1(0xc003dd86e0, 0xc000769ee0)\r\n        github.com/ledgerwatch/erigon/rpc/handler.go:310 +0xd2\r\ncreated by github.com/ledgerwatch/erigon/rpc.(*handler).startCallProc\r\n        github.com/ledgerwatch/erigon/rpc/handler.go:306 +0x66\r\n````\r\n",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898306495",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2522#issuecomment-898306495",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522",
    "id": 898306495,
    "node_id": "IC_kwDOC0FsAM41ixG_",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-13T09:09:15Z",
    "updated_at": "2021-08-13T09:09:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks for the report, fixing",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898306495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898309714",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2522#issuecomment-898309714",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522",
    "id": 898309714,
    "node_id": "IC_kwDOC0FsAM41ix5S",
    "user": {
      "login": "culmore2015",
      "id": 12622153,
      "node_id": "MDQ6VXNlcjEyNjIyMTUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/12622153?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/culmore2015",
      "html_url": "https://github.com/culmore2015",
      "followers_url": "https://api.github.com/users/culmore2015/followers",
      "following_url": "https://api.github.com/users/culmore2015/following{/other_user}",
      "gists_url": "https://api.github.com/users/culmore2015/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/culmore2015/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/culmore2015/subscriptions",
      "organizations_url": "https://api.github.com/users/culmore2015/orgs",
      "repos_url": "https://api.github.com/users/culmore2015/repos",
      "events_url": "https://api.github.com/users/culmore2015/events{/privacy}",
      "received_events_url": "https://api.github.com/users/culmore2015/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-13T09:14:33Z",
    "updated_at": "2021-08-13T09:14:33Z",
    "author_association": "NONE",
    "body": "I just resync the block by adding ```--bad.block 7111822``` to sloved the problem. But it will takes another couple of days to sync.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898309714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898313286",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2522#issuecomment-898313286",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522",
    "id": 898313286,
    "node_id": "IC_kwDOC0FsAM41iyxG",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-13T09:20:33Z",
    "updated_at": "2021-08-13T09:20:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't think you needed to do resync, the problem was just in RPC daemon, regression introduced when I was adding `vmTrace` support this week",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898313286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898326835",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2522#issuecomment-898326835",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2522",
    "id": 898326835,
    "node_id": "IC_kwDOC0FsAM41i2Ez",
    "user": {
      "login": "culmore2015",
      "id": 12622153,
      "node_id": "MDQ6VXNlcjEyNjIyMTUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/12622153?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/culmore2015",
      "html_url": "https://github.com/culmore2015",
      "followers_url": "https://api.github.com/users/culmore2015/followers",
      "following_url": "https://api.github.com/users/culmore2015/following{/other_user}",
      "gists_url": "https://api.github.com/users/culmore2015/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/culmore2015/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/culmore2015/subscriptions",
      "organizations_url": "https://api.github.com/users/culmore2015/orgs",
      "repos_url": "https://api.github.com/users/culmore2015/repos",
      "events_url": "https://api.github.com/users/culmore2015/events{/privacy}",
      "received_events_url": "https://api.github.com/users/culmore2015/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-13T09:31:49Z",
    "updated_at": "2021-08-13T09:31:49Z",
    "author_association": "NONE",
    "body": "Great help,  thanks !",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/898326835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
