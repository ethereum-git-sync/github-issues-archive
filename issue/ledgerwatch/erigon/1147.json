{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1147",
  "id": 709827534,
  "node_id": "MDU6SXNzdWU3MDk4Mjc1MzQ=",
  "number": 1147,
  "title": "Assertion 'IS_LEAF(mp)' failed in mdb_cursor_next()",
  "user": {
    "login": "poma",
    "id": 2109710,
    "node_id": "MDQ6VXNlcjIxMDk3MTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2109710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/poma",
    "html_url": "https://github.com/poma",
    "followers_url": "https://api.github.com/users/poma/followers",
    "following_url": "https://api.github.com/users/poma/following{/other_user}",
    "gists_url": "https://api.github.com/users/poma/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/poma/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/poma/subscriptions",
    "organizations_url": "https://api.github.com/users/poma/orgs",
    "repos_url": "https://api.github.com/users/poma/repos",
    "events_url": "https://api.github.com/users/poma/events{/privacy}",
    "received_events_url": "https://api.github.com/users/poma/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2020-09-27T22:19:45Z",
  "updated_at": "2021-02-10T10:45:14Z",
  "closed_at": "2020-10-20T07:38:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: commit `47f59e8fc` (also tested on latest `14288b8cd`, and with docker mounted to the same db, same issue)\r\nOS & Version: OSX 10.5.6\r\n\r\n#### Expected behaviour\r\n\r\nSync in successful\r\n\r\n#### Actual behaviour\r\n\r\nNode fails at sync stage 7\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [09-28|01:09:35.646] Calculating Merkle root                  current key=06030505...\r\nmdb.c:5940: Assertion 'IS_LEAF(mp)' failed in mdb_cursor_next()\r\nSIGABRT: abort\r\nPC=0x7fff71e5433a m=15 sigcode=0\r\nsignal arrived during cgo execution\r\n````\r\n\r\nFull trace https://gist.github.com/poma/0ca617ab1743f650751658935ce2bd56\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699763386",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-699763386",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 699763386,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTc2MzM4Ng==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T04:31:34Z",
    "updated_at": "2020-09-28T04:54:13Z",
    "author_association": "COLLABORATOR",
    "body": "Hello. Thank you for report, we will investigate why it happened. \r\n\r\n@poma , how much space left on the device? I had same error when no space left on device. \r\n\r\nHere is hack to fix it for you: \r\n`go run -trimpath ./cmd/integration stage_hash_state --chaindata=/path/to/your/tg/chaindata --reset`\r\nThen just start TG. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699763386/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699882750",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-699882750",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 699882750,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTg4Mjc1MA==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T09:09:22Z",
    "updated_at": "2020-09-28T09:09:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Another question - how was the node shut down before you restarted it that time?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699882750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700387069",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-700387069",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 700387069,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDM4NzA2OQ==",
    "user": {
      "login": "koen84",
      "id": 8461454,
      "node_id": "MDQ6VXNlcjg0NjE0NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8461454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/koen84",
      "html_url": "https://github.com/koen84",
      "followers_url": "https://api.github.com/users/koen84/followers",
      "following_url": "https://api.github.com/users/koen84/following{/other_user}",
      "gists_url": "https://api.github.com/users/koen84/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/koen84/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/koen84/subscriptions",
      "organizations_url": "https://api.github.com/users/koen84/orgs",
      "repos_url": "https://api.github.com/users/koen84/repos",
      "events_url": "https://api.github.com/users/koen84/events{/privacy}",
      "received_events_url": "https://api.github.com/users/koen84/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T02:24:25Z",
    "updated_at": "2020-09-29T02:24:25Z",
    "author_association": "NONE",
    "body": "I have the same error.  TG catching up sync after i had to reset server (when trying to find me details on an other issue), so in all likelihood no clean shutdown.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700387069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700671111",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-700671111",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 700671111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDY3MTExMQ==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T12:32:15Z",
    "updated_at": "2020-09-29T12:32:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "More context from @poma . The error started happening when he restarted after another error:\r\n```\r\nINFO [09-27|18:59:24.885] Sync stage 10/12. Generate tx lookup index...\r\nINFO [09-27|18:59:31.963] Looking for peers                        peercount=0  tried=4  static=0\r\nINFO [09-27|18:59:41.967] Looking for peers                        peercount=0  tried=4  static=0\r\nINFO [09-27|18:59:51.967] Looking for peers                        peercount=0  tried=4  static=0\r\nINFO [09-27|18:59:54.889] ETL [1/2] Extracting                     from=h                  block=804436   alloc=578.51MiB  sys=6.53GiB numGC=89362\r\n...\r\nINFO [09-27|19:42:43.221] Flushed buffer file                      name=/Users/poma/Library/TurboGeth/etl-temp/tg-sync-sortable-buf319161155 alloc=1.09GiB    sys=6.53GiB numGC=90311\r\nINFO [09-27|19:42:43.242] ETL [1/2] Extracting                     from=h                  block=5698071  alloc=1.09GiB    sys=6.53GiB numGC=90311\r\nINFO [09-27|19:42:54.792] ETL [1/2] Extracting                     from=h                  block=5708204  alloc=797.55MiB  sys=6.53GiB numGC=90318\r\nINFO [09-27|19:43:24.794] ETL [1/2] Extracting                     from=h                  block=5736651  alloc=1.39GiB    sys=6.53GiB numGC=90333\r\nINFO [09-27|19:44:05.441] Flushed buffer file                      name=/Users/poma/Library/TurboGeth/etl-temp/tg-sync-sortable-buf309654982 alloc=1.14GiB    sys=6.53GiB numGC=90342\r\nINFO [09-27|19:44:05.465] ETL [1/2] Extracting                     from=h                  block=5752799  alloc=1.14GiB    sys=6.53GiB numGC=90342\r\nERROR[09-27|19:44:08.606] Invalid block body RLP                   hash=\"dd3622â€¦d9fa8a\" err=\"rlp: non-canonical integer (leading zero bytes) for *uint256.Int, decoding into (types.Body).Transactions[72](types.txdata).V\"\r\nINFO [09-27|19:44:08.641] etl: temp files removed successfully     total size=\"8.9 GB\"\r\nWARN [09-27|19:44:08.641] Synchronisation failed, retrying         err=\"tx lookup generation, empty block body 5755737, hash dd3622a9c4cd8bac3b19b7f1f14533bbc15b5f0765518716564f3641a3d9fa8a\"\r\nINFO [09-27|19:44:09.863] Sync stage 1/12. Download headers...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700671111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/712658543",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-712658543",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 712658543,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjY1ODU0Mw==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-20T07:38:58Z",
    "updated_at": "2020-10-20T07:38:58Z",
    "author_association": "COLLABORATOR",
    "body": "So, this error happening when using same cursor for Delete and Iterate operations - because LMDB stores some state inside cursor and it allows do only few deletes in the row. MDBX also has this problem and will fixed by https://github.com/erthink/libmdbx/issues/121\r\n\r\nProblem solved manually, but to solve it fully - we must use ETL abstraction everywhere (interhashes stage doesn't use it, It will possible after https://github.com/ledgerwatch/turbo-geth/issues/1267 done). \r\n\r\nSo, I closing this issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/712658543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/713210647",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-713210647",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 713210647,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMzIxMDY0Nw==",
    "user": {
      "login": "erthink",
      "id": 6241554,
      "node_id": "MDQ6VXNlcjYyNDE1NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6241554?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erthink",
      "html_url": "https://github.com/erthink",
      "followers_url": "https://api.github.com/users/erthink/followers",
      "following_url": "https://api.github.com/users/erthink/following{/other_user}",
      "gists_url": "https://api.github.com/users/erthink/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erthink/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erthink/subscriptions",
      "organizations_url": "https://api.github.com/users/erthink/orgs",
      "repos_url": "https://api.github.com/users/erthink/repos",
      "events_url": "https://api.github.com/users/erthink/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erthink/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-21T00:09:54Z",
    "updated_at": "2020-10-21T00:09:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "@hyc, I think you should look at this bug.\r\nI fixed this recently in (my nook) `libmdbx`, but all versions of `LMDB` for now could (at least on assertions) crash by a valid sequence of operations.\r\n\r\nP.S.\r\nAs far as I remember, I fixed several other similar errors, i.e. there are definitely more in LMDB.\r\nNonetheless I do not always correctly solved your puzzles in the code, so some of my corrections were repeated ;)",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/713210647/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/713864031",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-713864031",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 713864031,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMzg2NDAzMQ==",
    "user": {
      "login": "hyc",
      "id": 306354,
      "node_id": "MDQ6VXNlcjMwNjM1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/306354?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hyc",
      "html_url": "https://github.com/hyc",
      "followers_url": "https://api.github.com/users/hyc/followers",
      "following_url": "https://api.github.com/users/hyc/following{/other_user}",
      "gists_url": "https://api.github.com/users/hyc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hyc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hyc/subscriptions",
      "organizations_url": "https://api.github.com/users/hyc/orgs",
      "repos_url": "https://api.github.com/users/hyc/repos",
      "events_url": "https://api.github.com/users/hyc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hyc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-21T20:39:06Z",
    "updated_at": "2020-10-21T20:39:06Z",
    "author_association": "NONE",
    "body": "Thanks for the ping, corresponding LMDB patch is in https://git.openldap.org/openldap/openldap/-/merge_requests/194 but still needs a test case.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/713864031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/714849312",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-714849312",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 714849312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNDg0OTMxMg==",
    "user": {
      "login": "erthink",
      "id": 6241554,
      "node_id": "MDQ6VXNlcjYyNDE1NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6241554?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erthink",
      "html_url": "https://github.com/erthink",
      "followers_url": "https://api.github.com/users/erthink/followers",
      "following_url": "https://api.github.com/users/erthink/following{/other_user}",
      "gists_url": "https://api.github.com/users/erthink/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erthink/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erthink/subscriptions",
      "organizations_url": "https://api.github.com/users/erthink/orgs",
      "repos_url": "https://api.github.com/users/erthink/repos",
      "events_url": "https://api.github.com/users/erthink/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erthink/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-23T01:24:49Z",
    "updated_at": "2020-10-23T01:24:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "@hyc, I used this method of reproduction:\r\n  - according to @AskAlexSharov, I sketched a [simple test](https://gist.github.com/erthink/1e53304762dd2e0146abf31cd09cdfc5) with several deletion options.\r\n  - using a suitable database created on some (I don't know exactly) iteration of the [test script](https://github.com/erthink/libmdbx/blob/master/test/long_stochastic.sh) script.\r\n  - the problem is reproduced when deleting from the `TBL0001` sub-database, about which `mdbx_chk` gives such information:\r\n        Processing 'TBL0001'...\r\n         - key-value kind: usual-key => multi-value, flags: dupsort (0x04)\r\n         - last modification txn#621\r\n         - page size 256, entries 31445\r\n         - b-tree depth 5, pages: branch 3549, leaf 11503, overflow 0\r\n         - summary: 31445 records, 27350 dups, 303226 key's bytes, 1056307 data's bytes, 0 problems\r\n\r\nIf necessary, I can send a dump of this database.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/714849312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776514949",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-776514949",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 776514949,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjUxNDk0OQ==",
    "user": {
      "login": "mariuspod",
      "id": 14898268,
      "node_id": "MDQ6VXNlcjE0ODk4MjY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/14898268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mariuspod",
      "html_url": "https://github.com/mariuspod",
      "followers_url": "https://api.github.com/users/mariuspod/followers",
      "following_url": "https://api.github.com/users/mariuspod/following{/other_user}",
      "gists_url": "https://api.github.com/users/mariuspod/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mariuspod/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mariuspod/subscriptions",
      "organizations_url": "https://api.github.com/users/mariuspod/orgs",
      "repos_url": "https://api.github.com/users/mariuspod/repos",
      "events_url": "https://api.github.com/users/mariuspod/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mariuspod/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-10T07:50:33Z",
    "updated_at": "2021-02-10T07:50:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Here is hack to fix it for you:\r\n> `go run -trimpath ./cmd/integration stage_hash_state --chaindata=/path/to/your/tg/chaindata --reset`\r\n> Then just start TG.\r\n\r\nThat worked for me perfectly after having an unclean shutdown of the host due to power outage. Thanks a lot! :+1: \r\nI had to build version `2021.02.2-alpha` (123710adcd22da970aad810694dd236822ae1f18) to run the command successfully before that I got many mdbx linking errors.\r\n\r\nNow my node is synced again! :rocket:\r\n\r\n@AskAlexSharov is there some list of useful commands that could restore the node once bad things happen so you don't have to start syncing from scratch ? Last time I had another mdb issue not being able to open the db anymore and I had to start from 0 so I'm really glad this time I could fix the db with your command.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776514949/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776571858",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-776571858",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 776571858,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjU3MTg1OA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-10T09:30:25Z",
    "updated_at": "2021-02-10T09:30:25Z",
    "author_association": "COLLABORATOR",
    "body": "@mariuspod , we have, but self-diagnostic of problem is hard for user.\r\n- `./build/bin/integration stage_*` is the list of commands to manage stages - each command has `--reset` option to reset stage (and all data produced by this stage to 0). \r\n- We also have several commands to check db integrity and I plan to consolidate them into 1 command: https://github.com/ledgerwatch/turbo-geth/issues/1474\r\n- LMDB: `make db-tools` producing `./build/bin/mdb_*` commands to dump/load/defragment/etc... database - but unlikely it's useful for non-developer.\r\n- MDBX: `make db-tools` producing `./build/bin/mdbx_*` commands to dump/load/defragment/etc... database - and also has mdbx_check for corruption diagnostic.\r\n\r\nIn general, to discover what we have, you can try to read Readme files in folders: `./cmd/*/Readme.md` \r\nFor example: https://github.com/ledgerwatch/turbo-geth/tree/master/cmd/integration",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776571858/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776604799",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-776604799",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 776604799,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjYwNDc5OQ==",
    "user": {
      "login": "mariuspod",
      "id": 14898268,
      "node_id": "MDQ6VXNlcjE0ODk4MjY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/14898268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mariuspod",
      "html_url": "https://github.com/mariuspod",
      "followers_url": "https://api.github.com/users/mariuspod/followers",
      "following_url": "https://api.github.com/users/mariuspod/following{/other_user}",
      "gists_url": "https://api.github.com/users/mariuspod/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mariuspod/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mariuspod/subscriptions",
      "organizations_url": "https://api.github.com/users/mariuspod/orgs",
      "repos_url": "https://api.github.com/users/mariuspod/repos",
      "events_url": "https://api.github.com/users/mariuspod/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mariuspod/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-10T10:21:36Z",
    "updated_at": "2021-02-10T10:21:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "@AskAlexSharov Thanks for pointing me to the docs!\r\nSo basically you could reset at any stage where tg is stuck with an error/exception ?\r\nI'll have to test it a bit with a smaller dataset.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776604799/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776619307",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1147#issuecomment-776619307",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1147",
    "id": 776619307,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjYxOTMwNw==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-10T10:45:14Z",
    "updated_at": "2021-02-10T10:45:14Z",
    "author_association": "COLLABORATOR",
    "body": "@mariuspod , can't recommend it, because \"destroying evidence does not help investigate a crime\". But if no other solution - then yes.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/776619307/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
