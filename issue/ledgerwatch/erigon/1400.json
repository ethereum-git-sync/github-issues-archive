{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1400",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1400/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1400/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1400/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1400",
  "id": 761674193,
  "node_id": "MDU6SXNzdWU3NjE2NzQxOTM=",
  "number": 1400,
  "title": "tg stuck after failing to remove peer",
  "user": {
    "login": "LefterisJP",
    "id": 1658405,
    "node_id": "MDQ6VXNlcjE2NTg0MDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1658405?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LefterisJP",
    "html_url": "https://github.com/LefterisJP",
    "followers_url": "https://api.github.com/users/LefterisJP/followers",
    "following_url": "https://api.github.com/users/LefterisJP/following{/other_user}",
    "gists_url": "https://api.github.com/users/LefterisJP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LefterisJP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LefterisJP/subscriptions",
    "organizations_url": "https://api.github.com/users/LefterisJP/orgs",
    "repos_url": "https://api.github.com/users/LefterisJP/repos",
    "events_url": "https://api.github.com/users/LefterisJP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LefterisJP/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-12-10T22:35:45Z",
  "updated_at": "2020-12-11T12:30:57Z",
  "closed_at": "2020-12-11T12:30:57Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nOS & Version: `Linux rotkinuc 5.9.10-arch1-1 #1 SMP PREEMPT Sun, 22 Nov 2020 14:16:59 +0000 x86_64 GNU/Linux`\r\nCommit hash : (if `develop`) 6dc0f8e8409888e6ce73ecb6a5b18a72af797213 - think it's 2020-12-1\r\n\r\n### Problem\r\n\r\nTg is getting stuck. I noticed it after quite a few hours:\r\n\r\n```\r\nDec 10 12:59:33 rotkinuc tg[1965977]: INFO [12-10|12:59:33.654] Commit cycle                             in=63.911771ms\r\nDec 10 12:59:40 rotkinuc tg[1965977]: INFO [12-10|12:59:40.839] [1/14 Headers] Imported new block headers count=2   elapsed=11.366ms    number=11425060 hash=\"e72c6d…c3c5c5\"\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.631] [3/14 Bodies] Imported new chain segment blocks=1   txs=147   elapsed=1.466ms     number=11425059 hash=\"26ddca…fbf7f0\"\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.636] [3/14 Bodies] Imported new chain segment blocks=1   txs=136   elapsed=1.485ms     number=11425060 hash=\"e72c6d…c3c5c5\"\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.639] [4/14 Senders] Started                   from=11425058 to=11425060\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.639] [4/14 Senders] Read canonical hashes     amount=2\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.649] [5/14 Execution] Blocks execution        from=11425058 to=11425060\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.735] [5/14 Execution] Completed on            block=11425060\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.735] [6/14 HashState] Promoting plain state   from=11425058 to=11425060\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.735] [6/14 HashState] Incremental promotion started from=11425058 to=11425060 codes=true  csbucket=PLAIN-ACS\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.741] [6/14 HashState] Incremental promotion started from=11425058 to=11425060 codes=false csbucket=PLAIN-ACS\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.753] [6/14 HashState] Incremental promotion started from=11425058 to=11425060 codes=false csbucket=PLAIN-SCS\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.770] [7/14 IntermediateHashes] Generating intermediate hashes from=11425058 to=11425060\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.904] [7/14 IntermediateHashes] Collection finished root hash=0xdf0dba3266f2d47eb3b6bded5001165a98ce61dad9c2fdd57afed6fd2feeb45c gen IH=129.093082ms\r\nDec 10 12:59:41 rotkinuc tg[1965977]: INFO [12-10|12:59:41.966] [11/14 CallTraces] disabled. Work In Progress\r\nDec 10 12:59:42 rotkinuc tg[1965977]: INFO [12-10|12:59:42.014] [13/14 TxPool] Read canonical hashes     hashes=2\r\nDec 10 12:59:42 rotkinuc tg[1965977]: INFO [12-10|12:59:42.017] [13/14 TxPool] Transaction stats         pending=3829 queued=975\r\nDec 10 12:59:42 rotkinuc tg[1965977]: INFO [12-10|12:59:42.017] [14/14 Finish] Update current block for the RPC API to=11425060\r\nDec 10 12:59:42 rotkinuc tg[1965977]: INFO [12-10|12:59:42.017] Memory                                   alloc=750.97MiB  sys=1.47GiB\r\nDec 10 12:59:42 rotkinuc tg[1965977]: INFO [12-10|12:59:42.017] Timings                                  Headers=3.300678838s  BlockHashes=4.892285ms  Bodies=8.895937ms     Bodies=\"319.264µs\"    Senders=9.943568ms   Execution=86.190889ms   HashState=35.623987ms  Intermedi>\r\nDec 10 12:59:42 rotkinuc tg[1965977]: INFO [12-10|12:59:42.191] Commit cycle                             in=173.830573ms\r\nDec 10 13:01:27 rotkinuc tg[1965977]: ERROR[12-10|13:01:27.608] Failed to unregister sync peer           peer=62fa912e97d19fea err=\"peer is not registered\"\r\nDec 10 13:01:27 rotkinuc tg[1965977]: ERROR[12-10|13:01:27.608] Peer unregister failed                   peer=62fa912e97d19fea err=\"peer is not registered\"\r\nDec 10 13:01:27 rotkinuc tg[1965977]: ERROR[12-10|13:01:27.608] Peer removal failed                      peer=62fa912e97d19fea err=\"peer is not registered\"\r\nDec 10 13:13:08 rotkinuc tg[1965977]: INFO [12-10|13:13:08.163] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 14:13:08 rotkinuc tg[1965977]: INFO [12-10|14:13:08.163] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 15:13:08 rotkinuc tg[1965977]: INFO [12-10|15:13:08.163] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 16:13:08 rotkinuc tg[1965977]: INFO [12-10|16:13:08.163] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 17:13:08 rotkinuc tg[1965977]: INFO [12-10|17:13:08.163] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 18:13:08 rotkinuc tg[1965977]: INFO [12-10|18:13:08.164] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 19:13:08 rotkinuc tg[1965977]: INFO [12-10|19:13:08.164] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 20:13:08 rotkinuc tg[1965977]: INFO [12-10|20:13:08.164] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 10 21:13:08 rotkinuc tg[1965977]: INFO [12-10|21:13:08.163] Regenerated local transaction journal    transactions=0 accounts=0\r\n```\r\n\r\nThen I killed with `kill -6` and got the following trace: https://gist.github.com/LefterisJP/42e87de9ad051cf94f5196095b7348a7\r\n\r\n",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1400/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1400/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
