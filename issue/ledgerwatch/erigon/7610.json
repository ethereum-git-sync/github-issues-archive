{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7610",
  "id": 1734812419,
  "node_id": "I_kwDOC0FsAM5nZyMD",
  "number": 7610,
  "title": " [2/15 Headers] Waiting for Consensus Layer... stuck forever",
  "user": {
    "login": "0x366",
    "id": 4774606,
    "node_id": "MDQ6VXNlcjQ3NzQ2MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4774606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x366",
    "html_url": "https://github.com/0x366",
    "followers_url": "https://api.github.com/users/0x366/followers",
    "following_url": "https://api.github.com/users/0x366/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x366/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x366/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x366/subscriptions",
    "organizations_url": "https://api.github.com/users/0x366/orgs",
    "repos_url": "https://api.github.com/users/0x366/repos",
    "events_url": "https://api.github.com/users/0x366/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x366/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-05-31T18:55:46Z",
  "updated_at": "2023-06-02T05:23:30Z",
  "closed_at": "2023-06-02T05:23:29Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2.43\r\n\r\nOS & Version: Linux\r\n```\r\nauthrpc.jwtsecret: '/keystore/jwtsecret'\r\nws: true\r\nprune: \"h\"\r\nchain : \"mainnet\"\r\nhttp : true\r\nprivate.api.addr : \"localhost:9090\"\r\nhttp.api : [\"eth\",\"debug\",\"net\", \"admin\", \"trace\", \"web3\", \"txpool\", \"parity\"]\r\np2p.allowed-ports:  11333, 11334, 11335, 11336, 11337\r\nnat: any\r\nhttp.port: 8545\r\nhttp.addr: 0.0.0.0\r\npprof: true\r\npprof.addr: 0.0.0.0\r\npprof.port: 8545\r\n```\r\n\r\nConcensus Layer:\r\nTried Prysm, Teku and Lighthouse with same result\r\n\r\n#### Expected behaviour\r\nNode sync\r\n\r\n#### Actual behaviour\r\nNode not synced. Im geting [2/15] for the last 48 hours.\r\n\r\n#### Steps to reproduce the behaviour\r\nI interrupted the node sync 2 times, but it was catching the sync fine after interruption \r\n\r\n#### Backtrace\r\n```\r\n                                 stage_at        prune_at\r\nSnapshots                        17372092        0\r\nHeaders                          17372093        0\r\nBlockHashes                      17372093        0\r\nBodies                           17372093        0\r\nSenders                          17372093        0\r\nExecution                        17372093        17372093\r\nTranslation                      0               0\r\nHashState                        17372093        0\r\nIntermediateHashes               17372093        17372093\r\nAccountHistoryIndex              17372093        17372093\r\nStorageHistoryIndex              17372093        17372093\r\nLogIndex                         17372093        0\r\nCallTraces                       17372093        17372093\r\nTxLookup                         17372093        17282000\r\nFinish                           17372093        0\r\n--\r\nprune distance: --prune.h.older=90000\r\n\r\nblocks.v2: blocks=17281999, segments=17281999, indices=17281999\r\n\r\nhistory.v3: false, idx steps: 0.00, lastMaxTxNum=0->1, lastBlockInSnap=0\r\n\r\nsequence: EthTx=2018373792, NonCanonicalTx=4629\r\n\r\nin db: first header 17282000, last header 17372093, first body 17282000, last body 17372093\r\n```\r\n\r\n\r\n```\r\nINFO[05-30|15:37:13.587] RPC Daemon notified of new headers       from=17372084 to=17372085 hash=0x7052f2163213ddb65272a41caeafe3957325e577b64abc8df8749d9961b65b4c header sending=7.174µs log sending=310ns\r\nINFO[05-30|15:37:13.610] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:37:24.470] [2/15 Headers] Handling new payload      height=17372086 hash=0x2e949d758ee6f30c47d94c44593411af6cc8b213662f92ab6b18123c5e929760\r\nINFO[05-30|15:37:24.558] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:37:24.639] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\nINFO[05-30|15:37:24.714] Commit cycle                             in=18.67506ms\r\nINFO[05-30|15:37:24.714] Timings (slower than 50ms)               Headers=94ms\r\nINFO[05-30|15:37:24.714] Tables                                   PlainState=94.1GB AccountChangeSet=1.5GB StorageChangeSet=2.6GB BlockTransaction=11.3GB TransactionLog=584.8GB FreeList=281.0MB ReclaimableSpace=281.0GB\r\nINFO[05-30|15:37:24.714] RPC Daemon notified of new headers       from=17372085 to=17372086 hash=0x2e949d758ee6f30c47d94c44593411af6cc8b213662f92ab6b18123c5e929760 header sending=7.595µs log sending=170ns\r\nINFO[05-30|15:37:24.730] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:37:33.255] [txpool] stat                            pending=274 baseFee=30000 queued=30000 alloc=3.7GB sys=7.2GB\r\nINFO[05-30|15:37:36.695] [2/15 Headers] Handling new payload      height=17372087 hash=0xe281f0849036e2e558103b269eb3634fd1942ee20d195999edd461168a091758\r\nINFO[05-30|15:37:36.834] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:37:36.911] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\nINFO[05-30|15:37:37.033] Commit cycle                             in=31.918727ms\r\nINFO[05-30|15:37:37.033] Timings (slower than 50ms)               Headers=95ms\r\nINFO[05-30|15:37:37.033] Tables                                   PlainState=94.1GB AccountChangeSet=1.5GB StorageChangeSet=2.6GB BlockTransaction=11.3GB TransactionLog=584.8GB FreeList=281.0MB ReclaimableSpace=281.0GB\r\nINFO[05-30|15:37:37.033] RPC Daemon notified of new headers       from=17372086 to=17372087 hash=0xe281f0849036e2e558103b269eb3634fd1942ee20d195999edd461168a091758 header sending=8.436µs log sending=170ns\r\nINFO[05-30|15:37:37.056] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:37:48.031] [2/15 Headers] Handling new payload      height=17372088 hash=0x3aee2310eaffd58b159d9e653e1aa1878a7671757013dcdbea2b502d1d6a79a1\r\nINFO[05-30|15:37:48.163] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:37:48.229] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\nINFO[05-30|15:37:48.342] Commit cycle                             in=32.055373ms\r\nINFO[05-30|15:37:48.342] Timings (slower than 50ms)               Headers=86ms\r\nINFO[05-30|15:37:48.342] Tables                                   PlainState=94.1GB AccountChangeSet=1.5GB StorageChangeSet=2.6GB BlockTransaction=11.3GB TransactionLog=584.8GB FreeList=281.0MB ReclaimableSpace=281.0GB\r\nINFO[05-30|15:37:48.343] RPC Daemon notified of new headers       from=17372087 to=17372088 hash=0x3aee2310eaffd58b159d9e653e1aa1878a7671757013dcdbea2b502d1d6a79a1 header sending=6.943µs log sending=170ns\r\nINFO[05-30|15:37:48.366] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:38:00.087] [2/15 Headers] Handling new payload      height=17372089 hash=0x840f4cb525cddbb55381a5fffa7b40aa17881a8d86af5559f07160ec14b8c0d3\r\nINFO[05-30|15:38:00.191] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:38:00.271] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\nINFO[05-30|15:38:00.369] Commit cycle                             in=30.043432ms\r\nINFO[05-30|15:38:00.369] Timings (slower than 50ms)               Headers=96ms\r\nINFO[05-30|15:38:00.369] Tables                                   PlainState=94.1GB AccountChangeSet=1.5GB StorageChangeSet=2.6GB BlockTransaction=11.3GB TransactionLog=584.8GB FreeList=281.0MB ReclaimableSpace=281.0GB\r\nINFO[05-30|15:38:00.369] RPC Daemon notified of new headers       from=17372088 to=17372089 hash=0x840f4cb525cddbb55381a5fffa7b40aa17881a8d86af5559f07160ec14b8c0d3 header sending=5.681µs log sending=170ns\r\nINFO[05-30|15:38:00.389] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:38:12.041] [2/15 Headers] Handling new payload      height=17372090 hash=0x70d306b51f492a0876fb64ab56bb53abe2d90bf089717ce61888dae4e61dcf6a\r\nINFO[05-30|15:38:12.159] [2/15 Headers] Waiting for Consensus Layer...\r\nINFO[05-30|15:38:12.236] [2/15 Headers] Fork choice update: flushing in-memory state (built by previous newPayload)\r\nINFO[05-30|15:38:12.333] Commit cycle                             in=26.569589ms\r\nINFO[05-30|15:38:12.333] Timings (slower than 50ms)               Headers=93ms\r\nINFO[05-30|15:38:12.333] Tables                                   PlainState=94.1GB AccountChangeSet=1.5GB StorageChangeSet=2.6GB BlockTransaction=11.3GB TransactionLog=584.8GB FreeList=281.0MB ReclaimableSpace=281.0GB\r\nINFO[05-30|15:38:12.333] RPC Daemon notified of new headers       from=17372089 to=17372090 hash=0x70d306b51f492a0876fb64ab56bb53abe2d90bf089717ce61888dae4e61dcf6a header sending=6.272µs log sending=160ns\r\nINFO[05-30|15:38:12.352] [2/15 Headers] Waiting for Consensus Layer...\r\n```\r\n\r\n\r\n\r\n### LH\r\n./lighthouse bn --metrics --network mainnet --execution-endpoint http://localhost:8551 --execution-jwt /keystore/jwtsecret  --checkpoint-sync-url https://mainnet.checkpoint.sigp.io \r\n\r\n```\r\nMay 30 13:36:37.202 INFO New block received                      root: 0x10e57e5c45e9608660e394a8c1c812824d81f2c6ec3cef32e13336f46f742665, slot: 6552481\r\nMay 30 13:36:41.001 INFO Synced                                  slot: 6552481, block: 0x10e5…2665, epoch: 204765, finalized_epoch: 204763, finalized_root: 0xbb0c…ca89, exec_hash: 0x5703…8f46 (verified), peers: 84, service: slot_notifier\r\nMay 30 13:36:47.852 INFO New block received                      root: 0xd26cae5258d63ad65259db9a19fcc597064af1f21934af379c23f7f1a8d5d798, slot: 6552482\r\nMay 30 13:36:53.000 INFO Synced                                  slot: 6552482, block: 0xd26c…d798, epoch: 204765, finalized_epoch: 204763, finalized_root: 0xbb0c…ca89, exec_hash: 0xd697…f987 (verified), peers: 84, service: slot_notifier\r\nMay 30 13:37:01.536 INFO New block received                      root: 0x44c99e5dbd1aa24eefefc1cd4b1634c3c13f497cc3f51d33478c795dd612f107, slot: 6552483\r\nMay 30 13:37:05.001 INFO Synced                                  slot: 6552483, block: 0x44c9…f107, epoch: 204765, finalized_epoch: 204763, finalized_root: 0xbb0c…ca89, exec_hash: 0xd3d9…11b1 (verified), peers: 85, service: slot_notifier\r\nMay 30 13:37:09.012 INFO Sending metrics to remote endpoint      endpoint: https://beaconcha.in/, service: monitoring_client\r\nMay 30 13:37:13.187 INFO New block received                      root: 0x2ae3a6bea7be49e6a1ce180e5604e987445fb0c3c2167d146e8b2e18892ec42e, slot: 6552484\r\nMay 30 13:37:17.000 INFO Downloading historical blocks           est_time: --, speed: 16.02 slots/sec, distance: 0 slots (--), service: slot_notifier\r\nMay 30 13:37:17.000 INFO Synced                                  slot: 6552484, block: 0x2ae3…c42e, epoch: 204765, finalized_epoch: 204763, finalized_root: 0xbb0c…ca89, exec_hash: 0x7052…5b4c (verified), peers: 84, service: slot_notifier\r\nMay 30 13:37:24.407 INFO New block received                      root: 0xa6bdc4d7abc940aa4d26b6f200c62f61eea1f278fe525d193791861c72e8ad9e, slot: 6552485\r\nMay 30 13:37:29.001 INFO Synced                                  slot: 6552485, block: 0xa6bd…ad9e, epoch: 204765, finalized_epoch: 204763, finalized_root: 0xbb0c…ca89, exec_hash: 0x2e94…9760 (verified), peers: 82, service: slot_notifier\r\nMay 30 13:37:36.634 INFO New block received                      root: 0xdbf65676b064c7db3f853ea25c6bda0b97b2420ddce5856c5c764bc81b21cb33, slot: 6552486\r\nMay 30 13:37:41.001 INFO Synced                                  slot: 6552486, block: 0xdbf6…cb33, epoch: 204765, finalized_epoch: 204763, finalized_root: 0xbb0c…ca89, exec_hash: 0xe281…1758 (verified), peers: 84, service: slot_notifier\r\nMay 30 13:37:47.957 INFO New block received                      root: 0xcb771b3809bc806ece6513a619920abb7de9d9b933fe804ed3f2535530bc93e8, slot: 6552487\r\nMay 30 13:37:53.000 INFO Synced\r\n```\r\n\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "0x366",
    "id": 4774606,
    "node_id": "MDQ6VXNlcjQ3NzQ2MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4774606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x366",
    "html_url": "https://github.com/0x366",
    "followers_url": "https://api.github.com/users/0x366/followers",
    "following_url": "https://api.github.com/users/0x366/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x366/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x366/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x366/subscriptions",
    "organizations_url": "https://api.github.com/users/0x366/orgs",
    "repos_url": "https://api.github.com/users/0x366/repos",
    "events_url": "https://api.github.com/users/0x366/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x366/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1572970881",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7610#issuecomment-1572970881",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610",
    "id": 1572970881,
    "node_id": "IC_kwDOC0FsAM5dwaGB",
    "user": {
      "login": "keithchew",
      "id": 5557929,
      "node_id": "MDQ6VXNlcjU1NTc5Mjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5557929?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/keithchew",
      "html_url": "https://github.com/keithchew",
      "followers_url": "https://api.github.com/users/keithchew/followers",
      "following_url": "https://api.github.com/users/keithchew/following{/other_user}",
      "gists_url": "https://api.github.com/users/keithchew/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/keithchew/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/keithchew/subscriptions",
      "organizations_url": "https://api.github.com/users/keithchew/orgs",
      "repos_url": "https://api.github.com/users/keithchew/repos",
      "events_url": "https://api.github.com/users/keithchew/events{/privacy}",
      "received_events_url": "https://api.github.com/users/keithchew/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-02T00:54:43Z",
    "updated_at": "2023-06-02T00:55:07Z",
    "author_association": "NONE",
    "body": "Hi @0x366 I cannot see anything wrong with your logs, ie it is sync'ing fine. Observe the lines:\r\n```\r\nINFO[05-30|15:37:37.033] RPC Daemon notified of new headers       from=17372086 to=17372087 \r\nINFO[05-30|15:37:48.343] RPC Daemon notified of new headers       from=17372087 to=17372088 \r\nINFO[05-30|15:38:00.369] RPC Daemon notified of new headers       from=17372088 to=17372089\r\nINFO[05-30|15:38:12.333] RPC Daemon notified of new headers       from=17372089 to=17372090 \r\n```\r\nThis shows it is processing and notifying each block as the appear from the CL. Steps 3 - 15 are used when it needs to perform more processing, usually when it is not at the tip of the chain, eg sync'ing a batch of blocks.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1572970881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1573171930",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7610#issuecomment-1573171930",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7610",
    "id": 1573171930,
    "node_id": "IC_kwDOC0FsAM5dxLLa",
    "user": {
      "login": "0x366",
      "id": 4774606,
      "node_id": "MDQ6VXNlcjQ3NzQ2MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4774606?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x366",
      "html_url": "https://github.com/0x366",
      "followers_url": "https://api.github.com/users/0x366/followers",
      "following_url": "https://api.github.com/users/0x366/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x366/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x366/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x366/subscriptions",
      "organizations_url": "https://api.github.com/users/0x366/orgs",
      "repos_url": "https://api.github.com/users/0x366/repos",
      "events_url": "https://api.github.com/users/0x366/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x366/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-02T05:23:29Z",
    "updated_at": "2023-06-02T05:23:29Z",
    "author_association": "NONE",
    "body": "Got it, thank you ) ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1573171930/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
