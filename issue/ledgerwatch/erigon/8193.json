{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8193",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8193/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8193/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8193/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8193",
  "id": 1895862580,
  "node_id": "I_kwDOC0FsAM5xAJE0",
  "number": 8193,
  "title": "Recurring out of memory kills",
  "user": {
    "login": "zzif",
    "id": 6803266,
    "node_id": "MDQ6VXNlcjY4MDMyNjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6803266?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zzif",
    "html_url": "https://github.com/zzif",
    "followers_url": "https://api.github.com/users/zzif/followers",
    "following_url": "https://api.github.com/users/zzif/following{/other_user}",
    "gists_url": "https://api.github.com/users/zzif/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zzif/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zzif/subscriptions",
    "organizations_url": "https://api.github.com/users/zzif/orgs",
    "repos_url": "https://api.github.com/users/zzif/repos",
    "events_url": "https://api.github.com/users/zzif/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zzif/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-09-14T07:00:25Z",
  "updated_at": "2023-09-14T07:00:25Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\n2 x Xeon Gold 6142, 256GB RAM, 12.8TB NVMe\r\n\r\nErigon version: erigon version 2.49.0-stable\r\n\r\nOS & Version: Debian 12 Linux, 6.1.0-10-amd64 kernel\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):\r\n\r\n/usr/local/bin/erigon \\\r\n  --chain=mainnet \\\r\n  --datadir=/var/lib/erigon \\\r\n  --authrpc.jwtsecret=/var/lib/jwtsecret/jwt.hex \\\r\n  --authrpc.port=8551 \\\r\n  --http.port=8545 \\\r\n  --http.addr=0.0.0.0 \\\r\n  --http.api=eth,erigon,web3,net,debug,trace,txpool \\\r\n  --ws \\\r\n  --txpool.api.addr=0.0.0.0:9090 \\\r\n  --private.api.addr=0.0.0.0:9090 \\\r\n  --prune.r.before=11052984 \\\r\n  --prune htc\r\n\r\nConcensus Layer: Teku\r\n\r\nConcensus Layer Command (with flags/config):\r\n\r\n/opt/teku/bin/teku \\\r\n  --network=mainnet \\\r\n  --data-path=/storage/teku \\\r\n  --rest-api-enabled=true \\\r\n  --rest-api-host-allowlist=* \\\r\n  --rest-api-interface=0.0.0.0 \\\r\n  --rest-api-port=5051 \\\r\n  --p2p-port=9000 \\\r\n  --ee-endpoint=http://127.0.0.1:8551 \\\r\n  --ee-jwt-secret-file=/var/lib/jwtsecret/jwt.hex \\\r\n  --metrics-enabled=true \\\r\n  --metrics-host-allowlist=* \\\r\n  --metrics-interface=0.0.0.0 \\\r\n  --p2p-peer-lower-bound=256 \\\r\n  --p2p-peer-upper-bound=512 \\\r\n  --beacon-liveness-tracking-enabled=true \\\r\n  --reconstruct-historic-states=true \\\r\n  --data-storage-archive-frequency=64 \\\r\n  --data-storage-mode=archive \\\r\n  --builder-endpoint=http://127.0.0.1:18550\r\n\r\nChain/Network: Mainnet Ethereum\r\n\r\n#### Expected behaviour\r\n\r\nSync to the height.\r\n\r\n#### Actual behaviour\r\n\r\nEats all the memory and crashes every 2-3 days.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nStart sync with a clean datadir and wait.\r\n\r\n#### Backtrace\r\n\r\n[2943436.638780] nioEventLoopGro invoked oom-killer: gfp_mask=0x140cca(GFP_HIGHUSER_MOVABLE|__GFP_COMP), order=0, oom_score_adj=0\r\n[2943436.638790] CPU: 59 PID: 765090 Comm: nioEventLoopGro Not tainted 6.1.0-10-amd64 #1  Debian 6.1.38-2\r\n[2943436.638795] Hardware name: HPE ProLiant DL360 Gen10/ProLiant DL360 Gen10, BIOS U32 03/08/2022\r\n[2943436.638797] Call Trace:\r\n[2943436.638801]  <TASK>\r\n[2943436.638805]  dump_stack_lvl+0x44/0x5c\r\n[2943436.638816]  dump_header+0x4a/0x211\r\n[2943436.638824]  oom_kill_process.cold+0xb/0x10\r\n[2943436.638828]  out_of_memory+0x1fd/0x4c0\r\n[2943436.638837]  __alloc_pages_slowpath.constprop.0+0xc73/0xdc0\r\n[2943436.638846]  __alloc_pages+0x305/0x330\r\n[2943436.638849]  folio_alloc+0x17/0x50\r\n[2943436.638856]  __filemap_get_folio+0x155/0x340\r\n[2943436.638862]  filemap_fault+0x139/0x910\r\n[2943436.638865]  ? filemap_map_pages+0x150/0x6e0\r\n[2943436.638870]  __do_fault+0x30/0x110\r\n[2943436.638876]  do_fault+0x1b9/0x410\r\n[2943436.638880]  __handle_mm_fault+0x660/0xfa0\r\n[2943436.638886]  handle_mm_fault+0xdb/0x2d0\r\n[2943436.638890]  do_user_addr_fault+0x19c/0x570\r\n[2943436.638898]  exc_page_fault+0x70/0x170\r\n[2943436.638904]  asm_exc_page_fault+0x22/0x30\r\n[2943436.638909] RIP: 0033:0x7fbbb42353f8\r\n[2943436.638916] Code: Unable to access opcode bytes at 0x7fbbb42353ce.\r\n[2943436.638917] RSP: 002b:00007fa8d37fd1b0 EFLAGS: 00010202\r\n[2943436.638920] RAX: 0000000000000001 RBX: 00007fa620028218 RCX: 0000000000000007\r\n[2943436.638923] RDX: 00007fbb9ee2b514 RSI: 00007fbb9ee2b084 RDI: 00007fbb9d152d10\r\n[2943436.638924] RBP: 00007fa8d37fe590 R08: 00007fbb9ee2ad90 R09: 00007fbb9ee2ad80\r\n[2943436.638926] R10: 00007fbbb3430000 R11: 0000003fdb4519b7 R12: 0000000000000000\r\n[2943436.638928] R13: 00007fa620027bc0 R14: 0000000000000000 R15: 00007fbb9d152d10\r\n[2943436.638933]  </TASK>\r\n[2943436.638936] Mem-Info:\r\n[2943436.638940] active_anon:13902718 inactive_anon:50608716 isolated_anon:0\r\n                  active_file:0 inactive_file:423 isolated_file:274\r\n                  unevictable:768 dirty:0 writeback:0\r\n                  slab_reclaimable:475222 slab_unreclaimable:189575\r\n                  mapped:42762 shmem:47127 pagetables:424254\r\n                  sec_pagetables:0 bounce:0\r\n                  kernel_misc_reclaimable:0\r\n                  free:169494 free_pcp:156 free_cma:0\r\n[2943436.638947] Node 0 active_anon:39934104kB inactive_anon:89083716kB active_file:0kB inactive_file:0kB unevictable:3072kB isolated(anon):0kB isolated(file):0kB mapped:170500kB dirty:4kB writeback:0kB shmem:187532kB shmem_thp: 0kB shmem_pmdmapped: 0kB anon_thp: 29597696kB writeback_tmp:0kB kernel_stack:9448kB pagetables:576540kB sec_pagetables:0kB all_unreclaimable? no\r\n[2943436.638953] Node 1 active_anon:15676768kB inactive_anon:113351148kB active_file:0kB inactive_file:3640kB unevictable:0kB isolated(anon):0kB isolated(file):1216kB mapped:548kB dirty:0kB writeback:332kB shmem:976kB shmem_thp: 0kB shmem_pmdmapped: 0kB anon_thp: 17448960kB writeback_tmp:0kB kernel_stack:10776kB pagetables:1120476kB sec_pagetables:0kB all_unreclaimable? no\r\n[2943436.638959] Node 0 DMA free:11264kB boost:0kB min:4kB low:16kB high:28kB reserved_highatomic:0KB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB writepending:0kB present:15988kB managed:15360kB mlocked:0kB bounce:0kB free_pcp:0kB local_pcp:0kB free_cma:0kB\r\n[2943436.638966] lowmem_reserve[]: 0 2619 128515 128515 128515\r\n[2943436.638972] Node 0 DMA32 free:504100kB boost:0kB min:916kB low:3596kB high:6276kB reserved_highatomic:0KB active_anon:770184kB inactive_anon:1411440kB active_file:84kB inactive_file:0kB unevictable:0kB writepending:4kB present:2778712kB managed:2712976kB mlocked:0kB bounce:0kB free_pcp:496kB local_pcp:0kB free_cma:0kB\r\n[2943436.638979] lowmem_reserve[]: 0 0 125896 125896 125896\r\n[2943436.638985] Node 0 Normal free:92500kB boost:71680kB min:115728kB low:244644kB high:373560kB reserved_highatomic:2048KB active_anon:39163920kB inactive_anon:87672276kB active_file:0kB inactive_file:276kB unevictable:3072kB writepending:0kB present:131072000kB managed:128925936kB mlocked:0kB bounce:0kB free_pcp:128kB local_pcp:0kB free_cma:0kB\r\n[2943436.638992] lowmem_reserve[]: 0 0 0 0 0\r\n[2943436.638997] Node 1 Normal free:70112kB boost:24576kB min:69716kB low:201824kB high:333932kB reserved_highatomic:2048KB active_anon:15676768kB inactive_anon:113351148kB active_file:0kB inactive_file:3080kB unevictable:0kB writepending:164kB present:134217724kB managed:132109348kB mlocked:0kB bounce:0kB free_pcp:0kB local_pcp:0kB free_cma:0kB\r\n[2943436.639003] lowmem_reserve[]: 0 0 0 0 0\r\n[2943436.639007] Node 0 DMA: 0*4kB 0*8kB 0*16kB 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 1*1024kB (U) 1*2048kB (M) 2*4096kB (M) = 11264kB\r\n[2943436.639023] Node 0 DMA32: 5954*4kB (UME) 4185*8kB (UME) 1954*16kB (UME) 1401*32kB (UME) 733*64kB (UME) 476*128kB (UME) 297*256kB (UME) 103*512kB (UME) 31*1024kB (UME) 2*2048kB (M) 24*4096kB (M) = 504144kB\r\n[2943436.639045] Node 0 Normal: 44*4kB (UME) 619*8kB (UME) 2199*16kB (UMEH) 1518*32kB (UMEH) 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 88888kB\r\n[2943436.639062] Node 1 Normal: 1432*4kB (UMEH) 1030*8kB (UMEH) 515*16kB (UMEH) 1174*32kB (UMEH) 78*64kB (UME) 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 64768kB\r\n[2943436.639079] Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=1048576kB\r\n[2943436.639082] Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=2048kB\r\n[2943436.639084] Node 1 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=1048576kB\r\n[2943436.639085] Node 1 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=2048kB\r\n[2943436.639087] 62119 total pagecache pages\r\n[2943436.639088] 12322 pages in swap cache\r\n[2943436.639090] Free swap  = 0kB\r\n[2943436.639091] Total swap = 1000444kB\r\n[2943436.639093] 67021106 pages RAM\r\n[2943436.639094] 0 pages HighMem/MovableOnly\r\n[2943436.639095] 1080201 pages reserved\r\n[2943436.639096] 0 pages hwpoisoned\r\n[2943436.639097] Tasks state (memory values in pages):\r\n[2943436.639098] [  pid  ]   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name\r\n[2943436.639120] [    856]     0   856    70858      252   532480      244          -250 systemd-journal\r\n[2943436.639125] [    877]     0   877     6462      326    77824       76         -1000 systemd-udevd\r\n[2943436.639130] [   1182]   104  1182    22511      224    77824       10             0 systemd-timesyn\r\n[2943436.639134] [   1212]     0  1212     1652       62    49152        0             0 cron\r\n[2943436.639137] [   1213]   103  1213     2312      167    53248        0          -900 dbus-daemon\r\n[2943436.639140] [   1215]     0  1215    55444      359    77824      582             0 rsyslogd\r\n[2943436.639144] [   1217]     0  1217     8453      373    77824        7             0 systemd-logind\r\n[2943436.639147] [   1222]     0  1222     1529      134    53248        0             0 login\r\n[2943436.639150] [   1263]  1000  1263     4735      438    77824        7           100 systemd\r\n[2943436.639153] [   1264]  1000  1264    42175      320    90112      457           100 (sd-pam)\r\n[2943436.639156] [   1271]  1000  1271     1993      183    53248      162             0 bash\r\n[2943436.639159] [   1275]  1000  1275     2534       91    57344       39             0 sudo\r\n[2943436.639162] [   1276]  1000  1276     2534       75    53248       55             0 sudo\r\n[2943436.639165] [   1277]     0  1277     1799       55    49152       79             0 bash\r\n[2943436.639167] [   1281]     0  1281     1884       33    49152       10             0 ping\r\n[2943436.639171] [   1294]     0  1294     4426        4    73728      397             0 sshd\r\n[2943436.639174] [   1300]  1000  1300     4491       92    73728      376             0 sshd\r\n[2943436.639177] [   1301]  1000  1301     1997      194    57344      151             0 bash\r\n[2943436.639180] [   1306]  1000  1306     2534       76    57344       41             0 sudo\r\n[2943436.639183] [   1307]  1000  1307     2534       80    53248       48             0 sudo\r\n[2943436.639185] [   1308]     0  1308     1799      139    61440        0             0 bash\r\n[2943436.639188] [   1323]     0  1323     3851       66    65536      267         -1000 sshd\r\n[2943436.639191] [   1367]  1000  1367     2551      872    61440       87             0 screen\r\n[2943436.639194] [   1368]  1000  1368     2100        1    61440      157             0 zsh\r\n[2943436.639197] [   1370]  1000  1370     2534       41    57344      101             0 sudo\r\n[2943436.639200] [   1371]  1000  1371     2534       18    57344      109             0 sudo\r\n[2943436.639203] [   1372]     0  1372     2127      136    57344       54             0 zsh\r\n[2943436.639206] [   1376]     0  1376     4425      171    77824      228             0 sshd\r\n[2943436.639209] [   1382]  1000  1382     4490      263    73728      208             0 sshd\r\n[2943436.639212] [   1383]  1000  1383     2100      157    57344        0             0 zsh\r\n[2943436.639215] [  13520]  1000 13520     2100       85    53248       82             0 zsh\r\n[2943436.639218] [  13695]  1000 13695     2119       19    57344      168             0 zsh\r\n[2943436.639221] [  16853]  1000 16853     2100        1    53248      167             0 zsh\r\n[2943436.639223] [  16855]  1000 16855     2534        5    57344      133             0 sudo\r\n[2943436.639226] [  16857]  1000 16857     2534        0    57344      133             0 sudo\r\n[2943436.639228] [  16858]     0 16858     2127      121    57344       65             0 zsh\r\n[2943436.639231] [  18320]     0 18320     4425      400    69632        0             0 sshd\r\n[2943436.639234] [  18326]  1000 18326     4490      486    69632        0             0 sshd\r\n[2943436.639237] [  18327]  1000 18327     2101      171    57344        0             0 zsh\r\n[2943436.639240] [  25988]  1000 25988     2144       37    53248      154             0 zsh\r\n[2943436.639243] [  40704]   106 40704  4311780    42637   864256      507          -900 postgres\r\n[2943436.639246] [  40705]   106 40705  4311813    31908   421888      551             0 postgres\r\n[2943436.639249] [  40706]   106 40706  4311817    31861   413696      548             0 postgres\r\n[2943436.639251] [  40708]   106 40708  4311780      914   167936      546             0 postgres\r\n[2943436.639254] [  40709]   106 40709  4312179      356   184320      579             0 postgres\r\n[2943436.639257] [  40710]   106 40710  4312174      283   151552      535             0 postgres\r\n[2943436.639261] [ 110273]  1004 110273   183828     5086   172032      403             0 mev-boost\r\n[2943436.639265] [ 239719]  1000 239719     2501       30    61440       97             0 sudo\r\n[2943436.639268] [ 239721]  1000 239721     2501       18    57344      108             0 sudo\r\n[2943436.639270] [ 239722]     0 239722     2127       91    57344       79             0 zsh\r\n[2943436.639275] [ 564236]  1000 564236     2501       69    57344       73             0 sudo\r\n[2943436.639278] [ 564237]  1000 564237     2501       45    57344       82             0 sudo\r\n[2943436.639280] [ 564238]     0 564238     2127      165    61440       10             0 zsh\r\n[2943436.639286] [ 759780]  1000 759780     1682       64    57344        0             0 screen\r\n[2943436.639288] [ 759796]     0 759796   149953      266  1015808        0             0 journalctl\r\n[2943436.639291] [ 764437]  1003 764437 30618680 14553298 152178688    99484             0 java\r\n[2943436.639294] [ 785862]     0 785862   147905      269  1028096        0             0 journalctl\r\n[2943436.639297] [ 800643]  1001 800643 1589799139 49884171 1578307584   103395             0 erigon\r\n[2943436.639301] oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0-1,global_oom,task_memcg=/system.slice/erigon.service,task=erigon,pid=800643,uid=1001\r\n[2943436.639418] Out of memory: Killed process 800643 (erigon) total-vm:6359196556kB, anon-rss:199536684kB, file-rss:0kB, shmem-rss:0kB, UID:1001 pgtables:1541316kB oom_score_adj:0\r\n[2943453.576182] oom_reaper: reaped process 800643 (erigon), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB\r\n[2955143.116183] systemd-journald[856]: Data hash table of /var/log/journal/467b231306f94b4aa52c24e299a1978d/user-1001.journal has a fill level at 75.0 (174763 of 233016 items, 100663296 file size, 575 bytes per hash table item), suggesting rotation.\r\n[2955143.116190] systemd-journald[856]: /var/log/journal/467b231306f94b4aa52c24e299a1978d/user-1001.journal: Journal header limits reached or header out-of-date, rotating.\r\n[3073713.778306] systemd-journald[856]: Data hash table of /var/log/journal/467b231306f94b4aa52c24e299a1978d/user-1001.journal has a fill level at 75.0 (174763 of 233016 items, 100663296 file size, 575 bytes per hash table item), suggesting rotation.\r\n[3073713.778313] systemd-journald[856]: /var/log/journal/467b231306f94b4aa52c24e299a1978d/user-1001.journal: Journal header limits reached or header out-of-date, rotating.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8193/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8193/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
