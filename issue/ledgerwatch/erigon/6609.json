{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6609",
  "id": 1537022968,
  "node_id": "I_kwDOC0FsAM5bnRv4",
  "number": 6609,
  "title": "Getting Timeout in request from Consensu Client TEKU",
  "user": {
    "login": "PacoBits",
    "id": 38920606,
    "node_id": "MDQ6VXNlcjM4OTIwNjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/38920606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PacoBits",
    "html_url": "https://github.com/PacoBits",
    "followers_url": "https://api.github.com/users/PacoBits/followers",
    "following_url": "https://api.github.com/users/PacoBits/following{/other_user}",
    "gists_url": "https://api.github.com/users/PacoBits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PacoBits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PacoBits/subscriptions",
    "organizations_url": "https://api.github.com/users/PacoBits/orgs",
    "repos_url": "https://api.github.com/users/PacoBits/repos",
    "events_url": "https://api.github.com/users/PacoBits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PacoBits/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-01-17T20:54:50Z",
  "updated_at": "2023-02-19T11:52:24Z",
  "closed_at": "2023-02-19T11:52:23Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "We have 3 CL-EC Teku-Erigon servers. After upgrading Erigon to the latest v2.34.0 from v2.33.0 and working fine several hours, one of the teku nodes started to crash. Erigon shows no errors, only teku shows errors, but we tried a status sync on teku and the same error again. We restarted and it is not possible to recover the service, we regressed to erigon v2.33.0 and it is not solved. After several hours a second teku node shows the same error. It is a backup node and 3 hours later it is recovered without any action from our side. \r\nWe have checked with the teku team and it seems that erigon does not respond within 8 seconds and a timeout exception is raised in teku. \r\n\r\n\r\nAbout our setup,it has been working well for several months.\r\n\r\nWe have a 3-layer configuration with the validator client, the Beacon node and the execution client running separately.\r\nWe are using Mev-boost\r\n\r\nValidator setup and version: Lighthouse/v3.4.0-38514c0\r\nlighthouse vc\r\n```\r\n--beacon-nodes http://TEKU_IP,http://ip2,http://ip3\r\n--network mainnet\r\n--metrics\r\n--metrics-allow-origin *\r\n--graffiti \"Block by xxxxxxx\"\r\n--suggested-fee-recipient 0x388Cxxxxxxxxxxxx\r\n--init-slashing-protection\r\n--metrics-port xxx\r\n--http\r\n--builder-proposals\r\n```\r\n\r\nTeku setup and version: teku/v22.12.0/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\n```\r\n command: [\"--network=mainnet\",\r\n              \"--data-base-path=*************\",\r\n              \"--p2p-port=9000\",\r\n              \"--rest-api-enabled=true\",\r\n              \"--rest-api-host-allowlist=*\",\r\n              \"--initial-state=https://mainnet-checkpoint-sync.stakely.io/eth/v2/debug/beacon/states/finalized\",\r\n              \"--metrics-enabled=true\",\r\n              \"--p2p-subscribe-all-subnets-enabled=true\",\r\n              \"--ee-endpoint=http://ERIGON_IP:8551\",\r\n              \"--ee-jwt-secret-file=/*********\",\r\n              \"--validators-graffiti='Block by ******'\",\r\n              \"--validators-proposer-default-fee-recipient=*****************\",\r\n              \"--validators-builder-registration-default-enabled=true\",\r\n              \"--validators-proposer-blinded-blocks-enabled=true\",\r\n              \"--builder-endpoint=http://localhost:18550\",\r\n              \"--log-destination=CONSOLE\",\r\n              \"--logging=INFO\"\r\n              ]\r\n```\r\n\r\nErigon Setup and version:  v2.34.0-dirty git_commit=937fb2c4d95b0640904b7dd715c1736e7d0a5ede\r\n```\r\n\r\n     --prune htc\r\n     --prune.r.before=11184524\r\n     --private.api.addr=localhost:9091\r\n     --maxpeers 100\r\n     --nat any\r\n     --http\r\n     --http.addr --------\r\n     --http.port 8545\r\n     --http.api=eth,debug,net,trace,web3,erigon,engine,txpool\r\n     --authrpc.port 8551\r\n     --authrpc.addr 0.0.0.0\r\n     --authrpc.jwtsecret ************\r\n     --private.api.addr=localhost:9091\r\n     --chain mainnet\r\n     --metrics\r\n     --port 30303\r\n     --torrent.port 42070\r\n     --datadir=**************\r\n     --authrpc.vhosts \"*\"\r\n     --externalcl\r\n     --port 30302\r\n```\r\n\r\n\r\nI attached logs from Erigon and teku. \r\n\r\n[erigo-teku-17012023.log](https://github.com/ledgerwatch/erigon/files/10439280/erigo-teku-17012023.log)\r\n",
  "closed_by": {
    "login": "PacoBits",
    "id": 38920606,
    "node_id": "MDQ6VXNlcjM4OTIwNjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/38920606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PacoBits",
    "html_url": "https://github.com/PacoBits",
    "followers_url": "https://api.github.com/users/PacoBits/followers",
    "following_url": "https://api.github.com/users/PacoBits/following{/other_user}",
    "gists_url": "https://api.github.com/users/PacoBits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PacoBits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PacoBits/subscriptions",
    "organizations_url": "https://api.github.com/users/PacoBits/orgs",
    "repos_url": "https://api.github.com/users/PacoBits/repos",
    "events_url": "https://api.github.com/users/PacoBits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PacoBits/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1386231410",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6609#issuecomment-1386231410",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609",
    "id": 1386231410,
    "node_id": "IC_kwDOC0FsAM5SoDZy",
    "user": {
      "login": "TateB",
      "id": 11844316,
      "node_id": "MDQ6VXNlcjExODQ0MzE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/11844316?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TateB",
      "html_url": "https://github.com/TateB",
      "followers_url": "https://api.github.com/users/TateB/followers",
      "following_url": "https://api.github.com/users/TateB/following{/other_user}",
      "gists_url": "https://api.github.com/users/TateB/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TateB/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TateB/subscriptions",
      "organizations_url": "https://api.github.com/users/TateB/orgs",
      "repos_url": "https://api.github.com/users/TateB/repos",
      "events_url": "https://api.github.com/users/TateB/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TateB/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T23:27:55Z",
    "updated_at": "2023-01-17T23:27:55Z",
    "author_association": "NONE",
    "body": "i'm experiencing similar problems running the same setup",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1386231410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1386402923",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6609#issuecomment-1386402923",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609",
    "id": 1386402923,
    "node_id": "IC_kwDOC0FsAM5SotRr",
    "user": {
      "login": "adamgall",
      "id": 706929,
      "node_id": "MDQ6VXNlcjcwNjkyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/706929?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamgall",
      "html_url": "https://github.com/adamgall",
      "followers_url": "https://api.github.com/users/adamgall/followers",
      "following_url": "https://api.github.com/users/adamgall/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamgall/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamgall/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamgall/subscriptions",
      "organizations_url": "https://api.github.com/users/adamgall/orgs",
      "repos_url": "https://api.github.com/users/adamgall/repos",
      "events_url": "https://api.github.com/users/adamgall/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamgall/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-18T02:55:02Z",
    "updated_at": "2023-01-18T02:55:40Z",
    "author_association": "NONE",
    "body": "I'm experiencing similar timeout problems with Erigon, but I'm running Lighthouse as the CL. No errors being show in Erigon logs, but errors being shown in Lighthouse logs:\r\n\r\n```\r\nERRO Execution engine call failed            error: Reqwest(reqwest::Error { kind: Request, url: Url { scheme: \"http\", cannot_be_a_base: false, username: \"\", password: None, host: Some(Ipv4(127.0.0.1)), port: Some(8551), path: \"/\", query: None, fragment: None }, source: TimedOut }), service: exec\r\n\r\nWARN Error whilst processing payload status  error: Api { error: Reqwest(reqwest::Error { kind: Request, url: Url { scheme: \"http\", cannot_be_a_base: false, username: \"\", password: None, host: Some(Ipv4(127.0.0.1)), port: Some(8551), path: \"/\", query: None, fragment: None }, source: TimedOut }) }, service: exec\r\n\r\nCRIT Failed to update execution head         error: ExecutionForkChoiceUpdateFailed(EngineError(Api { error: Reqwest(reqwest::Error { kind: Request, url: Url { scheme: \"http\", cannot_be_a_base: false, username: \"\", password: None, host: Some(Ipv4(127.0.0.1)), port: Some(8551), path: \"/\", query: None, fragment: None }, source: TimedOut }) })), service: beacon\r\n```\r\n\r\nPreviously, the Lighthouse / Erigon setup was working flawlessly on my setup, but have been missing 3-4% of attestations per day for the last ~week since upgrading to the 2.33.x and 2.34 Erigon versions.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1386402923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1386628741",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6609#issuecomment-1386628741",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609",
    "id": 1386628741,
    "node_id": "IC_kwDOC0FsAM5SpkaF",
    "user": {
      "login": "PacoBits",
      "id": 38920606,
      "node_id": "MDQ6VXNlcjM4OTIwNjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/38920606?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PacoBits",
      "html_url": "https://github.com/PacoBits",
      "followers_url": "https://api.github.com/users/PacoBits/followers",
      "following_url": "https://api.github.com/users/PacoBits/following{/other_user}",
      "gists_url": "https://api.github.com/users/PacoBits/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PacoBits/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PacoBits/subscriptions",
      "organizations_url": "https://api.github.com/users/PacoBits/orgs",
      "repos_url": "https://api.github.com/users/PacoBits/repos",
      "events_url": "https://api.github.com/users/PacoBits/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PacoBits/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-18T07:54:38Z",
    "updated_at": "2023-01-18T07:54:38Z",
    "author_association": "NONE",
    "body": "After 24 hours, the first EC-CL recovers, but now the second server shows the same error. \r\n\r\n```\r\nteku_node_1  | 2023-01-18 07:52:00.190 INFO  - Execution Client is responding to requests again after a previous failure\r\nteku_node_1  | 2023-01-18 07:52:08.200 WARN  - Execution Client request timed out. Make sure the Execution Client is online and in sync.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1386628741/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1435967494",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6609#issuecomment-1435967494",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6609",
    "id": 1435967494,
    "node_id": "IC_kwDOC0FsAM5VlyAG",
    "user": {
      "login": "PacoBits",
      "id": 38920606,
      "node_id": "MDQ6VXNlcjM4OTIwNjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/38920606?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PacoBits",
      "html_url": "https://github.com/PacoBits",
      "followers_url": "https://api.github.com/users/PacoBits/followers",
      "following_url": "https://api.github.com/users/PacoBits/following{/other_user}",
      "gists_url": "https://api.github.com/users/PacoBits/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PacoBits/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PacoBits/subscriptions",
      "organizations_url": "https://api.github.com/users/PacoBits/orgs",
      "repos_url": "https://api.github.com/users/PacoBits/repos",
      "events_url": "https://api.github.com/users/PacoBits/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PacoBits/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-19T11:52:23Z",
    "updated_at": "2023-02-19T11:52:23Z",
    "author_association": "NONE",
    "body": "version 2.38.1 is working well.\r\nClosed.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1435967494/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
