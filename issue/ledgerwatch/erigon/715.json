{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/715",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/715/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/715/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/715/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/715",
  "id": 651143048,
  "node_id": "MDU6SXNzdWU2NTExNDMwNDg=",
  "number": 715,
  "title": "Crash in lmdb while constructing history index",
  "user": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-07-05T20:48:11Z",
  "updated_at": "2020-07-29T06:22:23Z",
  "closed_at": "2020-07-29T06:22:23Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version`\r\nOS & Version: Ubuntu\r\nCommit hash : f05e213eb15e5985b7cf4253b3a5b592b2cd9528\r\n\r\n#### Expected behaviour\r\n\r\n\r\n#### Actual behaviour\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [07-05|20:33:44.017] Flushed buffer file                      current key=8050345d... name=/tmp/tg-sync-sortable-buf234986931 alloc=1.97GiB   sys=5.46GiB numGC=476\r\nINFO [07-05|20:34:04.118] Flushed buffer file                      current key=8050e34c... name=/tmp/tg-sync-sortable-buf632581494 alloc=1.32GiB   sys=5.46GiB numGC=479\r\nINFO [07-05|20:34:22.928] Flushed buffer file                      current key=8051b93f... name=/tmp/tg-sync-sortable-buf046419037 alloc=1.17GiB   sys=5.46GiB numGC=482\r\nmdb.c:5837: Assertion 'IS_BRANCH(mc->mc_pg[mc->mc_top])' failed in mdb_cursor_sibling()\r\nSIGABRT: abort\r\nPC=0x7f2484e60e97 m=5 sigcode=18446744073709551610\r\n\r\ngoroutine 0 [idle]:\r\nruntime: unknown pc 0x7f2484e60e97\r\nstack: frame={sp:0x7f245d30d970, fp:0x0} stack=[0x7f245cb0e288,0x7f245d30de88)\r\n00007f245d30d870:  000000000047ae01 <runtime.memhash32+17>  00007f245d30d940 \r\n00007f245d30d880:  0000100000000000  00000000003fa000 \r\n00007f245d30d890:  0000000001200000  0000000000000139 \r\n00007f245d30d8a0:  2525252525252525  2525252525252525 \r\n00007f245d30d8b0:  00ff000000000000  0000ffff00000000 \r\n00007f245d30d8c0:  00ff000000000000  000000ff00000000 \r\n00007f245d30d8d0:  434e4152425f5349  636d3e2d636d2848 \r\n00007f245d30d8e0:  86b414d672190968  f57a40aa1097827a \r\n00007f245d30d8f0:  172fe4dd95dbb649  98b7a4587f8d2ec5 \r\n00007f245d30d900:  4048943d738908db  c63733bca6ca5e09 \r\n00007f245d30d910:  4f0da57d5ba1491c  c1b86a100643b044 \r\n00007f245d30d920:  6d002e34332e362e  0a732500632e6264 \r\n00007f245d30d930:  0000000000000000  0000000000000000 \r\n00007f245d30d940:  0000000000005fd4  00000000006bd451 <github.com/dgraph-io/badger/v2/pb.(*BlockOffset).Unmarshal+1505> \r\n00007f245d30d950:  000000006ed45100  0000006fd4510000 \r\n00007f245d30d960:  000074d451000000  0075d45100000000 \r\n00007f245d30d970: <0000000000000000  0000000000bed151 <github.com/peterh/liner.(*State).PromptWithSuggestion+721> \r\n00007f245d30d980:  0000000090d25100  0000009fd2510000 \r\n00007f245d30d990:  0000e1d251000000  00e2d25100000000 \r\n00007f245d30d9a0:  00007f245d30dbc0  00007f245d30dbc0 \r\n00007f245d30d9b0:  00007f245d30dbc0  00007f245d30dc17 \r\n00007f245d30d9c0:  00007f245d30dd4f  00007f245d30dbc0 \r\n00007f245d30d9d0:  00007f245d30dd4f  0000000000000000 \r\n00007f245d30d9e0:  0000000000000000  0000000000000000 \r\n00007f245d30d9f0:  fffffffe7fffffff  ffffffffffffffff \r\n00007f245d30da00:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da10:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da20:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da30:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da40:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da50:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da60:  ffffffffffffffff  ffffffffffffffff \r\nruntime: unknown pc 0x7f2484e60e97\r\nstack: frame={sp:0x7f245d30d970, fp:0x0} stack=[0x7f245cb0e288,0x7f245d30de88)\r\n00007f245d30d870:  000000000047ae01 <runtime.memhash32+17>  00007f245d30d940 \r\n00007f245d30d880:  0000100000000000  00000000003fa000 \r\n00007f245d30d890:  0000000001200000  0000000000000139 \r\n00007f245d30d8a0:  2525252525252525  2525252525252525 \r\n00007f245d30d8b0:  00ff000000000000  0000ffff00000000 \r\n00007f245d30d8c0:  00ff000000000000  000000ff00000000 \r\n00007f245d30d8d0:  434e4152425f5349  636d3e2d636d2848 \r\n00007f245d30d8e0:  86b414d672190968  f57a40aa1097827a \r\n00007f245d30d8f0:  172fe4dd95dbb649  98b7a4587f8d2ec5 \r\n00007f245d30d900:  4048943d738908db  c63733bca6ca5e09 \r\n00007f245d30d910:  4f0da57d5ba1491c  c1b86a100643b044 \r\n00007f245d30d920:  6d002e34332e362e  0a732500632e6264 \r\n00007f245d30d930:  0000000000000000  0000000000000000 \r\n00007f245d30d940:  0000000000005fd4  00000000006bd451 <github.com/dgraph-io/badger/v2/pb.(*BlockOffset).Unmarshal+1505> \r\n00007f245d30d950:  000000006ed45100  0000006fd4510000 \r\n00007f245d30d960:  000074d451000000  0075d45100000000 \r\n00007f245d30d970: <0000000000000000  0000000000bed151 <github.com/peterh/liner.(*State).PromptWithSuggestion+721> \r\n00007f245d30d980:  0000000090d25100  0000009fd2510000 \r\n00007f245d30d990:  0000e1d251000000  00e2d25100000000 \r\n00007f245d30d9a0:  00007f245d30dbc0  00007f245d30dbc0 \r\n00007f245d30d9b0:  00007f245d30dbc0  00007f245d30dc17 \r\n00007f245d30d9c0:  00007f245d30dd4f  00007f245d30dbc0 \r\n00007f245d30d9d0:  00007f245d30dd4f  0000000000000000 \r\n00007f245d30d9e0:  0000000000000000  0000000000000000 \r\n00007f245d30d9f0:  fffffffe7fffffff  ffffffffffffffff \r\n00007f245d30da00:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da10:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da20:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da30:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da40:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da50:  ffffffffffffffff  ffffffffffffffff \r\n00007f245d30da60:  ffffffffffffffff  ffffffffffffffff \r\n\r\ngoroutine 1 [syscall]:\r\nruntime.cgocall(0xccf2f0, 0xc046a79160, 0x0)\r\n        /usr/lib/go-1.14/src/runtime/cgocall.go:133 +0x5b fp=0xc046a79130 sp=0xc046a790f8 pc=0x41622b\r\ngithub.com/AskAlexSharov/lmdb-go/lmdb._Cfunc_mdb_cursor_get(0x7f243c000c70, 0xc090d1a040, 0xc090d1a050, 0x8, 0x0)\r\n        _cgo_gotypes.go:451 +0x4d fp=0xc046a79160 sp=0xc046a79130 pc=0x578b9d\r\ngithub.com/AskAlexSharov/lmdb-go/lmdb.(*Cursor).getVal0.func1(0xc090d1a1d0, 0x8, 0xc046a791e8)\r\n        /home/alexey/go/pkg/mod/github.com/!ask!alex!sharov/lmdb-go@v1.9.0/lmdb/cursor.go:191 +0xd0 fp=0xc046a791b0 sp=0xc046a79160 pc=0x581530\r\ngithub.com/AskAlexSharov/lmdb-go/lmdb.(*Cursor).getVal0(0xc090d1a1d0, 0x8, 0xc046a79150, 0x0)\r\n        /home/alexey/go/pkg/mod/github.com/!ask!alex!sharov/lmdb-go@v1.9.0/lmdb/cursor.go:191 +0x39 fp=0xc046a791e8 sp=0xc046a791b0 pc=0x57ace9\r\ngithub.com/AskAlexSharov/lmdb-go/lmdb.(*Cursor).Get(0xc090d1a1d0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x8, 0x51d478, 0x11af8e0, ...)\r\n        /home/alexey/go/pkg/mod/github.com/!ask!alex!sharov/lmdb-go@v1.9.0/lmdb/cursor.go:149 +0x420 fp=0xc046a79268 sp=0xc046a791e8 pc=0x57ac80\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*LmdbCursor).Next(0xc0255de980, 0x4, 0x4, 0x5f57cd8615ce, 0x368, 0x368, 0x301, 0x0, 0x0)\r\n        /home/alexey/turbo-geth/ethdb/kv_lmdb.go:557 +0x9d fp=0xc046a79348 sp=0xc046a79268 pc=0x9c061d\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*ObjectDatabase).Walk.func1(0x11c1d80, 0xc090d0e000, 0x0, 0x7f2450002400)\r\n        /home/alexey/turbo-geth/ethdb/object_db.go:265 +0x219 fp=0xc046a79428 sp=0xc046a79348 pc=0x9cc139\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*LmdbKV).View.func1(0xc0973f8080, 0x0, 0x0)\r\n        /home/alexey/turbo-geth/ethdb/kv_lmdb.go:327 +0x81 fp=0xc046a79470 sp=0xc046a79428 pc=0x9cace1\r\ngithub.com/AskAlexSharov/lmdb-go/lmdb.(*Txn).runOp(0xc0973f8080, 0xc00c5b5560, 0x0, 0x0)\r\n        /home/alexey/go/pkg/mod/github.com/!ask!alex!sharov/lmdb-go@v1.9.0/lmdb/txn.go:176 +0x55 fp=0xc046a794b0 sp=0xc046a79470 pc=0x57f245\r\ngithub.com/AskAlexSharov/lmdb-go/lmdb.(*Txn).RunOp(0xc0973f8080, 0xc00c5b5560, 0x0, 0x0, 0x1)\r\n        /home/alexey/go/pkg/mod/github.com/!ask!alex!sharov/lmdb-go@v1.9.0/lmdb/txn.go:144 +0x78 fp=0xc046a794e0 sp=0xc046a794b0 pc=0x57f0a8\r\ngithub.com/AskAlexSharov/lmdb-go/exp/lmdbpool.(*TxnPool).View(0xc0000325a0, 0xc00c5b5560, 0x0, 0x0)\r\n        /home/alexey/go/pkg/mod/github.com/!ask!alex!sharov/lmdb-go@v1.9.0/exp/lmdbpool/txnpool.go:334 +0xa9 fp=0xc046a79538 sp=0xc046a794e0 pc=0x905829\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*LmdbKV).View(0xc0000b0500, 0x11c6b80, 0xc00003c070, 0xc00027fb60, 0x0, 0x0)\r\n        /home/alexey/turbo-geth/ethdb/kv_lmdb.go:323 +0x100 fp=0xc046a795a8 sp=0xc046a79538 pc=0x9beb10\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*ObjectDatabase).Walk(0xc0004a5440, 0x1a57938, 0x9, 0x9, 0xc02693c558, 0x1, 0x1, 0x0, 0xc0255dea80, 0xc036d4073e, ...)\r\n        /home/alexey/turbo-geth/ethdb/object_db.go:247 +0x155 fp=0xc046a79600 sp=0xc046a795a8 pc=0x9c5e25\r\ngithub.com/ledgerwatch/turbo-geth/common/etl.extractBucketIntoFiles(0x11d5640, 0xc0004a5440, 0x1a57938, 0x9, 0x9, 0xc02693c558, 0x1, 0x1, 0xc02693c55c, 0x4, ...)\r\n        /home/alexey/turbo-geth/common/etl/etl.go:110 +0x116 fp=0xc046a79668 sp=0xc046a79600 pc=0x9d56c6\r\ngithub.com/ledgerwatch/turbo-geth/common/etl.Transform(0x11d5640, 0xc0004a5440, 0x1a57938, 0x9, 0x9, 0x1a572c8, 0x3, 0x3, 0xf9fe81, 0x4, ...)\r\n        /home/alexey/turbo-geth/common/etl/etl.go:87 +0x1a2 fp=0xc046a797b0 sp=0xc046a79668 pc=0x9d52f2\r\ngithub.com/ledgerwatch/turbo-geth/core.(*IndexGenerator).GenerateIndex(0xc0255c27b0, 0x0, 0x9ea8eb, 0x1a57938, 0x9, 0x9, 0x0, 0x0)\r\n        /home/alexey/turbo-geth/core/generate_index.go:75 +0x530 fp=0xc046a79ae0 sp=0xc046a797b0 pc=0xafe930\r\ngithub.com/ledgerwatch/turbo-geth/eth/stagedsync.SpawnStorageHistoryIndex(0xc046a79c30, 0x11d5640, 0xc0004a5440, 0x0, 0x0, 0xc00007e120, 0x0, 0x0)\r\n        /home/alexey/turbo-geth/eth/stagedsync/stage_indexes.go:51 +0x1d2 fp=0xc046a79b58 sp=0xc046a79ae0 pc=0xb1ebc2\r\nmain.testStage78(0x7fffbeb75769, 0x20, 0x1, 0x0, 0x0)\r\n        /home/alexey/turbo-geth/cmd/hack/hack.go:1799 +0x4a2 fp=0xc046a79ce0 sp=0xc046a79b58 pc=0xcc3bd2\r\nmain.main()\r\n        /home/alexey/turbo-geth/cmd/hack/hack.go:2489 +0xffd fp=0xc046a79f88 sp=0xc046a79ce0 pc=0xcc78ad\r\nruntime.main()\r\n        /usr/lib/go-1.14/src/runtime/proc.go:203 +0x212 fp=0xc046a79fe0 sp=0xc046a79f88 pc=0x44a372\r\nruntime.goexit()\r\n        /usr/lib/go-1.14/src/runtime/asm_amd64.s:1373 +0x1 fp=0xc046a79fe8 sp=0xc046a79fe0 pc=0x47aee1\r\n\r\ngoroutine 19 [chan receive]:\r\ngithub.com/ledgerwatch/turbo-geth/metrics.(*meterArbiter).tick(0x1b83e60)\r\n        /home/alexey/turbo-geth/metrics/meter.go:289 +0x78\r\ncreated by github.com/ledgerwatch/turbo-geth/metrics.NewMeterForced\r\n        /home/alexey/turbo-geth/metrics/meter.go:70 +0x105\r\n\r\ngoroutine 20 [select]:\r\ngithub.com/ledgerwatch/turbo-geth/consensus/ethash.(*remoteSealer).loop(0xc00049e000)\r\n        /home/alexey/turbo-geth/consensus/ethash/sealer.go:280 +0x258\r\ncreated by github.com/ledgerwatch/turbo-geth/consensus/ethash.startRemoteSealer\r\n        /home/alexey/turbo-geth/consensus/ethash/sealer.go:264 +0x2ae\r\n\r\ngoroutine 12 [select]:\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*LmdbKV).staleReadsCheckLoop(0xc0000b0500, 0x11c6b40, 0xc0000a4c00, 0xc0002080a0)\r\n        /home/alexey/turbo-geth/ethdb/kv_lmdb.go:179 +0x19f\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.lmdbOpts.Open.func3(0xc0000b0500, 0x11c6b40, 0xc0000a4c00)\r\n        /home/alexey/turbo-geth/ethdb/kv_lmdb.go:135 +0xa7\r\ncreated by github.com/ledgerwatch/turbo-geth/ethdb.lmdbOpts.Open\r\n        /home/alexey/turbo-geth/ethdb/kv_lmdb.go:131 +0x65c\r\n\r\nrax    0x0\r\nrbx    0x7f245d30dbc0\r\nrcx    0x7f2484e60e97\r\nrdx    0x0\r\nrdi    0x2\r\nrsi    0x7f245d30d970\r\nrbp    0x364e7e0\r\nrsp    0x7f245d30d970\r\nr8     0x0\r\nr9     0x7f245d30d970\r\nr10    0x8\r\nr11    0x246\r\nr12    0xc090d1a040\r\nr13    0xc090d1a050\r\nr14    0x8\r\nr15    0x368\r\nrip    0x7f2484e60e97\r\nrflags 0x246\r\ncs     0x33\r\nfs     0x0\r\ngs     0x0\r\n````\r\n",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/715/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/715/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
