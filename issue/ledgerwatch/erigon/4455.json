{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4455",
  "id": 1271505513,
  "node_id": "I_kwDOC0FsAM5LyaJp",
  "number": 4455,
  "title": "Erigon cannot change to a full syncmode node from a snapshot syncmode node",
  "user": {
    "login": "eval-exec",
    "id": 46400566,
    "node_id": "MDQ6VXNlcjQ2NDAwNTY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46400566?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eval-exec",
    "html_url": "https://github.com/eval-exec",
    "followers_url": "https://api.github.com/users/eval-exec/followers",
    "following_url": "https://api.github.com/users/eval-exec/following{/other_user}",
    "gists_url": "https://api.github.com/users/eval-exec/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eval-exec/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eval-exec/subscriptions",
    "organizations_url": "https://api.github.com/users/eval-exec/orgs",
    "repos_url": "https://api.github.com/users/eval-exec/repos",
    "events_url": "https://api.github.com/users/eval-exec/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eval-exec/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-06-15T00:26:10Z",
  "updated_at": "2022-07-05T15:54:32Z",
  "closed_at": "2022-07-05T15:54:32Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: \r\n\r\n```\r\n$ ./erigon.2022.06-02-fd0837d9 --version\r\nerigon.2022.06-02-fd0837d9 version 2022.06.2-alpha-fd0837d9\r\n```\r\nOS & Version: \r\n```\r\n uname -a\r\nLinux tokyo 5.4.0-86-generic #97-Ubuntu SMP Fri Sep 17 19:19:40 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\nCommit hash : fd0837d9\r\n\r\n#### Expected behaviour\r\n\r\nI started a erigon ethereum mainnet snapshot node, and it has sync to mainnet latest height.\r\nBut I want to change it to a full syncmode node. so I execute this:\r\n\r\n```\r\n./erigon.2022.06-02-fd0837d9 --datadir /mnt/data/erigon-ethereum-data --snapshots=false\r\n```\r\nI expect it should change to a full syncmode node.\r\n#### Actual behaviour\r\nAs the `WARN` log describe, it still is `--snapshots=true` node.\r\n```\r\n$ ./erigon.2022.06-02-fd0837d9 --datadir /mnt/data/erigon-ethereum-data --snapshots=false\r\nINFO[06-15|08:11:49.675] Build info                               git_branch=HEAD git_tag=v2022.06.02 git_commit=fd0837d962987636649b5a2a5090601f3410d632\r\nINFO[06-15|08:11:49.675] Starting Erigon on Ethereum mainnet...\r\nINFO[06-15|08:11:49.676] Maximum peer count                       ETH=100 total=100\r\nINFO[06-15|08:11:51.778] Set global gas cap                       cap=50000000\r\nINFO[06-15|08:11:51.834] Opening Database                         label=chaindata path=/mnt/data/erigon-ethereum-data/chaindata\r\nINFO[06-15|08:11:51.837] Initialised chain configuration          config=\"{ChainID: 1, Homestead: 1150000, DAO: 1920000, DAO Support: true, Tangerine Whistle: 2463000, Spurious Dragon: 2675000, Byzantium: 4370000, Constantinople: 7280000, Petersburg: 7280000, Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, London: 12965000, Arrow Glacier: 13773000, Terminal Total Difficulty: <nil>, Engine: ethash}\" genesis=0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3\r\nINFO[06-15|08:11:51.837] Initialising Ethereum protocol           network=1\r\nINFO[06-15|08:11:51.837] Using snapshots                          on=false\r\nWARN[06-15|08:11:51.837] Incorrect snapshot enablement            got=false change_to=true\r\nINFO[06-15|08:11:51.837] Effective                                prune_flags= snapshot_flags=\"--snapshots=true\"\r\nINFO[06-15|08:11:57.772] Disk storage enabled for ethash DAGs     dir=/mnt/data/erigon-ethereum-data/ethash-dags count=2\r\nINFO[06-15|08:11:58.299] Starting private RPC server              on=127.0.0.1:9090\r\nINFO[06-15|08:11:58.299] new subscription to logs established\r\nINFO[06-15|08:11:58.305] Started P2P networking                   version=66 self=enode://924380cb3d2cc3504018d3b88fa8f48a9b62bd82d0d8ce8bfd96a1f960a7822fd44bed26f96b346bd28def43abcb64cbbbdaac8ad22dc63d10111a159bab7cf1@127.0.0.1:30303 name=erigon/v2022.06.2-alpha-fd0837d9/linux-amd64/go1.18.2\r\nINFO[06-15|08:11:58.310] [Snapshots] Fetching torrent files metadata\r\nINFO[06-15|08:12:01.637] [Snapshots] Stat                         blocks=14819999 segments=14819999 indices=14819999 alloc=2.4Gb sys=3.1Gb\r\nINFO[06-15|08:12:01.637] [1/16 Headers] Waiting for headers...    from=14964588\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n1. start `erigon.2022.06-02-fd0837d9` by:\r\n`./erigon.2022.06-02-fd0837d9 --datadir /mnt/data/erigon-ethereum-data `\r\n2. wait it get to latest height\r\n3. change it to a full syncmode node by:\r\n`./erigon.2022.06-02-fd0837d9 --datadir /mnt/data/erigon-ethereum-data --snapshots=false`\r\n4. watch it's log, it still is a snapshot syncmode node.\r\n",
  "closed_by": {
    "login": "mandrigin",
    "id": 466427,
    "node_id": "MDQ6VXNlcjQ2NjQyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mandrigin",
    "html_url": "https://github.com/mandrigin",
    "followers_url": "https://api.github.com/users/mandrigin/followers",
    "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
    "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
    "organizations_url": "https://api.github.com/users/mandrigin/orgs",
    "repos_url": "https://api.github.com/users/mandrigin/repos",
    "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mandrigin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1158583150",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4455#issuecomment-1158583150",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455",
    "id": 1158583150,
    "node_id": "IC_kwDOC0FsAM5FDpNu",
    "user": {
      "login": "enriavil1",
      "id": 19207637,
      "node_id": "MDQ6VXNlcjE5MjA3NjM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19207637?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/enriavil1",
      "html_url": "https://github.com/enriavil1",
      "followers_url": "https://api.github.com/users/enriavil1/followers",
      "following_url": "https://api.github.com/users/enriavil1/following{/other_user}",
      "gists_url": "https://api.github.com/users/enriavil1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/enriavil1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/enriavil1/subscriptions",
      "organizations_url": "https://api.github.com/users/enriavil1/orgs",
      "repos_url": "https://api.github.com/users/enriavil1/repos",
      "events_url": "https://api.github.com/users/enriavil1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/enriavil1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-17T07:33:40Z",
    "updated_at": "2022-06-17T07:33:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Currently if you run erigon for the first time with snapshots on then you cannot switch to using full.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1158583150/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1175220712",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4455#issuecomment-1175220712",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4455",
    "id": 1175220712,
    "node_id": "IC_kwDOC0FsAM5GDHHo",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-05T15:54:32Z",
    "updated_at": "2022-07-05T15:54:32Z",
    "author_association": "COLLABORATOR",
    "body": "this is not supported at the moment, if you want to change sync mode, you need to resync",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1175220712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
