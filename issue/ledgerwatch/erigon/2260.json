{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2260",
  "id": 934093424,
  "node_id": "MDU6SXNzdWU5MzQwOTM0MjQ=",
  "number": 2260,
  "title": "rpc daemon panics pretty often under heavy load",
  "user": {
    "login": "wizzard0",
    "id": 424619,
    "node_id": "MDQ6VXNlcjQyNDYxOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/424619?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wizzard0",
    "html_url": "https://github.com/wizzard0",
    "followers_url": "https://api.github.com/users/wizzard0/followers",
    "following_url": "https://api.github.com/users/wizzard0/following{/other_user}",
    "gists_url": "https://api.github.com/users/wizzard0/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wizzard0/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wizzard0/subscriptions",
    "organizations_url": "https://api.github.com/users/wizzard0/orgs",
    "repos_url": "https://api.github.com/users/wizzard0/repos",
    "events_url": "https://api.github.com/users/wizzard0/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wizzard0/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-06-30T20:18:18Z",
  "updated_at": "2021-07-02T05:11:49Z",
  "closed_at": "2021-07-02T05:11:49Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\nErigon version: `erigon version 2021.06.5-alpha`\r\n\r\nOS & Version: Ubuntu 20.04\r\n\r\nCommit hash: cc360ec65854d724873bb5907d239adff1b10559\r\n\r\n#### Expected behaviour\r\nrpc calls are served\r\n\r\n#### Actual behaviour\r\ndaemon randomly crashes, serves the same requests OK after restart\r\n```\r\n./build/bin/rpcdaemon --private.api.addr=127.0.0.1:9090 --http.api=eth,erigon,debug,net,web3 --ws --http.corsdomain '*' --http.vhosts '*'\r\nINFO [06-30|21:14:37.325] rpc filters: subscribing to Erigon events\r\nINFO [06-30|21:14:37.325] HTTP endpoint opened                     url=****:8545 ws=true ws.compression=false\r\nINFO [06-30|21:14:37.326] interfaces compatible                    remote_db=127.0.0.1:9090 client=3.0.0 server=3.0.0\r\nINFO [06-30|21:14:37.326] interfaces compatible                    remote_service=eth_backend client=2.1.0 server=2.1.0\r\nINFO [06-30|21:14:37.326] interfaces compatible                    remote_service=mining      client=1.0.0 server=1.0.0\r\nINFO [06-30|21:14:37.327] interfaces compatible                    remote_service=tx_pool     client=1.0.0 server=1.0.0\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xb9906e]\r\n\r\ngoroutine 612 [running]:\r\ngithub.com/json-iterator/go.(*Stream).WriteObjectStart(...)\r\n\tgithub.com/json-iterator/go@v1.1.11/stream.go:148\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).runMethod(0xc003767440, 0x13c0a70, 0xc005eaca00, 0xc000286620, 0xc0033fa900, 0xc0060a0f90, 0x2, 0x2, 0x0, 0x0)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:445 +0x4e\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleCall(0xc003767440, 0xc0060a0f30, 0xc000286620, 0x0, 0x203001)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:392 +0x25f\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleCallMsg(0xc003767440, 0xc0060a0f30, 0xc000286620, 0x0, 0xc005080000)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:346 +0x1cb\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleMsg.func1(0xc0060a0f30)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:187 +0x4f\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).startCallProc.func1(0xc003767440, 0xc006418040)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:274 +0xd2\r\ncreated by github.com/ledgerwatch/erigon/rpc.(*handler).startCallProc\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:270 +0x66\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\nBatch query all receipts/logs sequentially + do batch eth_call/debug_traceTransaction. May crash after the first 2-3 requests, may run for as long as tens of minutes. debug_traceTransaction crashes most often.",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871908045",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2260#issuecomment-871908045",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
    "id": 871908045,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTkwODA0NQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T04:29:10Z",
    "updated_at": "2021-07-01T04:29:10Z",
    "author_association": "COLLABORATOR",
    "body": "Can't reproduce. Do you have bigger stack trace? Can you reproduce if add `--datadir` option to rpcdaemon?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871908045/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871916501",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2260#issuecomment-871916501",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
    "id": 871916501,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTkxNjUwMQ==",
    "user": {
      "login": "wizzard0",
      "id": 424619,
      "node_id": "MDQ6VXNlcjQyNDYxOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424619?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wizzard0",
      "html_url": "https://github.com/wizzard0",
      "followers_url": "https://api.github.com/users/wizzard0/followers",
      "following_url": "https://api.github.com/users/wizzard0/following{/other_user}",
      "gists_url": "https://api.github.com/users/wizzard0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wizzard0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wizzard0/subscriptions",
      "organizations_url": "https://api.github.com/users/wizzard0/orgs",
      "repos_url": "https://api.github.com/users/wizzard0/repos",
      "events_url": "https://api.github.com/users/wizzard0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wizzard0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T04:53:14Z",
    "updated_at": "2021-07-01T04:53:27Z",
    "author_association": "NONE",
    "body": "This is the entire stack trace, it’s the same on every crash. Will check with —datadir today",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/871916501/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872062545",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2260#issuecomment-872062545",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
    "id": 872062545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjA2MjU0NQ==",
    "user": {
      "login": "wizzard0",
      "id": 424619,
      "node_id": "MDQ6VXNlcjQyNDYxOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424619?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wizzard0",
      "html_url": "https://github.com/wizzard0",
      "followers_url": "https://api.github.com/users/wizzard0/followers",
      "following_url": "https://api.github.com/users/wizzard0/following{/other_user}",
      "gists_url": "https://api.github.com/users/wizzard0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wizzard0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wizzard0/subscriptions",
      "organizations_url": "https://api.github.com/users/wizzard0/orgs",
      "repos_url": "https://api.github.com/users/wizzard0/repos",
      "events_url": "https://api.github.com/users/wizzard0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wizzard0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T09:00:03Z",
    "updated_at": "2021-07-01T09:01:03Z",
    "author_association": "NONE",
    "body": "Same crash with --datadir + --private.api.addr and with just --datadir. Note this is with ws, havent checked http.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872062545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872098144",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2260#issuecomment-872098144",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
    "id": 872098144,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjA5ODE0NA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T09:49:51Z",
    "updated_at": "2021-07-01T09:49:51Z",
    "author_association": "COLLABORATOR",
    "body": "@wizzard0 take a look into folder `<datadir>/crashreports` and upload here some files from there. thank.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872098144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872107871",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2260#issuecomment-872107871",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
    "id": 872107871,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjEwNzg3MQ==",
    "user": {
      "login": "wizzard0",
      "id": 424619,
      "node_id": "MDQ6VXNlcjQyNDYxOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424619?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wizzard0",
      "html_url": "https://github.com/wizzard0",
      "followers_url": "https://api.github.com/users/wizzard0/followers",
      "following_url": "https://api.github.com/users/wizzard0/following{/other_user}",
      "gists_url": "https://api.github.com/users/wizzard0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wizzard0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wizzard0/subscriptions",
      "organizations_url": "https://api.github.com/users/wizzard0/orgs",
      "repos_url": "https://api.github.com/users/wizzard0/repos",
      "events_url": "https://api.github.com/users/wizzard0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wizzard0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T10:05:28Z",
    "updated_at": "2021-07-01T10:05:28Z",
    "author_association": "NONE",
    "body": "Um, it's empty. Permissions on the folder look fine.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872107871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872719365",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2260#issuecomment-872719365",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2260",
    "id": 872719365,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjcxOTM2NQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-02T05:11:49Z",
    "updated_at": "2021-07-02T05:11:49Z",
    "author_association": "COLLABORATOR",
    "body": "It's not easy to support streamable methods on WS because of WS nature and 100 layers of abstractions. I added good error message for now: https://github.com/ledgerwatch/erigon/pull/2268\r\nthank you",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/872719365/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
