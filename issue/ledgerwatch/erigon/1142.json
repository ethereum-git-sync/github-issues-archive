{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1142",
  "id": 709602675,
  "node_id": "MDU6SXNzdWU3MDk2MDI2NzU=",
  "number": 1142,
  "title": "RPC returns incorrect data for pre-Byzantium errored transactions",
  "user": {
    "login": "tjayrush",
    "id": 5417918,
    "node_id": "MDQ6VXNlcjU0MTc5MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tjayrush",
    "html_url": "https://github.com/tjayrush",
    "followers_url": "https://api.github.com/users/tjayrush/followers",
    "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
    "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
    "organizations_url": "https://api.github.com/users/tjayrush/orgs",
    "repos_url": "https://api.github.com/users/tjayrush/repos",
    "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tjayrush/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-09-26T20:07:46Z",
  "updated_at": "2020-09-27T00:51:06Z",
  "closed_at": "2020-09-27T00:51:06Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Sorry for the long issue, but it's easier to reproduce.\r\n\r\nPrior to the Byzantium hard fork, there was no `status` field in a transaction's receipt. Because of this, the only way (using Parity) to figure out if a transaction ended in error was to extract a `trace_transaction` and look for a non-empty `error` field. The current behavior of TurboGeth is different and will break existing code that consumes pre-Byzantium receipts.\r\n\r\nThe difference appears in two places:\r\n\r\n1. `trace_transaction` does not return an `error` field as in this example:\r\n\r\n```\r\ncurl --data '{\"method\":\"trace_transaction\",\"params\":[\"0x9c34ba45c523f75009d279553fe2a7e9a99a991a297439226321bea26ab62bbb\"],\"id\":1,\"jsonrpc\":\"2.0\"}' -H \"Content-Type: application/json\" -X POST localhost:8545\r\n```\r\n\r\nreturns\r\n\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 1,\r\n  \"result\": [\r\n    {\r\n      \"action\": {\r\n        \"callType\": \"call\",\r\n        \"from\": \"0x02fcf30912b6fe2b6452ee19721c6068fe4c7b61\",\r\n        \"gas\": \"0xee768\",\r\n        \"input\": \"0xa9059cbb0000000000000000000000009e9d1613f966936f74534ba71614350d1d87c4b100000000000000000000000000000000000000000000002d9614d1e3f1f00000\",\r\n        \"to\": \"0x37a9679c41e99db270bda88de8ff50c0cd23f326\",\r\n        \"value\": \"0x0\"\r\n      },\r\n      \"blockHash\": \"0xc65ac7164218ff90ca8101c360f717c465da10bd63007b071c26dd7dedd41324\",\r\n      \"blockNumber\": 2222222,\r\n      \"result\": {\r\n        \"gasUsed\": \"0xee768\"\r\n      },\r\n      \"subtraces\": 0,\r\n      \"traceAddress\": [],\r\n      \"transactionHash\": \"0x9c34ba45c523f75009d279553fe2a7e9a99a991a297439226321bea26ab62bbb\",\r\n      \"transactionPosition\": 0,\r\n      \"type\": \"call\"\r\n    }\r\n  ]\r\n}\r\n```\r\nwhile Parity returns the following using the same command:\r\n\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"result\": [\r\n    {\r\n      \"action\": {\r\n        \"callType\": \"call\",\r\n        \"from\": \"0x02fcf30912b6fe2b6452ee19721c6068fe4c7b61\",\r\n        \"gas\": \"0xee768\",\r\n        \"input\": \"0xa9059cbb0000000000000000000000009e9d1613f966936f74534ba71614350d1d87c4b100000000000000000000000000000000000000000000002d9614d1e3f1f00000\",\r\n        \"to\": \"0x37a9679c41e99db270bda88de8ff50c0cd23f326\",\r\n        \"value\": \"0x0\"\r\n      },\r\n      \"blockHash\": \"0xc65ac7164218ff90ca8101c360f717c465da10bd63007b071c26dd7dedd41324\",\r\n      \"blockNumber\": 2222222,\r\n      \"error\": \"Bad jump destination\",\r\n      \"subtraces\": 0,\r\n      \"traceAddress\": [],\r\n      \"transactionHash\": \"0x9c34ba45c523f75009d279553fe2a7e9a99a991a297439226321bea26ab62bbb\",\r\n      \"transactionPosition\": 0,\r\n      \"type\": \"call\"\r\n    }\r\n  ],\r\n  \"id\": 1\r\n}\r\n```\r\n\r\nNotice the `error` field with `bad jump desitination` which is not returned by TurboGeth. Using Parity, this is the only way to determine if a pre-Byzantium transaction ended in error.\r\n\r\n2. The second place this difference appears is `eth_getTransactionReceipt` which differs in that Parity (properly) does not return a `status` field in the receipt prior to Byzantium, while TurboGeth does. I haven't tested it, but it appears that TurboGeth properly returns `0x0` on error and `0x1` on success (not tested) even thought the field doesn't belong.\r\n\r\n**This difference will break existing code** that depends on the `error` field in pre-Byzantium `trace_transaction` traces and ignores (properly) the non-existent pre-Byzantium `status` field.\r\n\r\n**Suggestion:** We should fix the trace routines to return error messages for pre-Byzantium blocks, but we could continue to include the `status` field if we can determine that it's always correct. This would be backwards compatible and give code for new applications an easier way to get the error status of a transaction.\r\n\r\nIn the short term, we can tell people who experience this bug to use Turbo's pre-Byzantium `status` field, I suppose.",
  "closed_by": {
    "login": "tjayrush",
    "id": 5417918,
    "node_id": "MDQ6VXNlcjU0MTc5MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tjayrush",
    "html_url": "https://github.com/tjayrush",
    "followers_url": "https://api.github.com/users/tjayrush/followers",
    "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
    "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
    "organizations_url": "https://api.github.com/users/tjayrush/orgs",
    "repos_url": "https://api.github.com/users/tjayrush/repos",
    "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tjayrush/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699566759",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1142#issuecomment-699566759",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1142",
    "id": 699566759,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTU2Njc1OQ==",
    "user": {
      "login": "tjayrush",
      "id": 5417918,
      "node_id": "MDQ6VXNlcjU0MTc5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tjayrush",
      "html_url": "https://github.com/tjayrush",
      "followers_url": "https://api.github.com/users/tjayrush/followers",
      "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
      "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
      "organizations_url": "https://api.github.com/users/tjayrush/orgs",
      "repos_url": "https://api.github.com/users/tjayrush/repos",
      "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tjayrush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-27T00:51:05Z",
    "updated_at": "2020-09-27T00:51:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Turned out to be a simple error of not copying error string to Parity trace. Closing...",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699566759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
