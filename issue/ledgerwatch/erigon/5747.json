{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5747",
  "id": 1409441850,
  "node_id": "I_kwDOC0FsAM5UAmA6",
  "number": 5747,
  "title": "BSC: Still getting Runtime Error: Index out of Range on eth_getTransactionByHash",
  "user": {
    "login": "tpalaz",
    "id": 25038010,
    "node_id": "MDQ6VXNlcjI1MDM4MDEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/25038010?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tpalaz",
    "html_url": "https://github.com/tpalaz",
    "followers_url": "https://api.github.com/users/tpalaz/followers",
    "following_url": "https://api.github.com/users/tpalaz/following{/other_user}",
    "gists_url": "https://api.github.com/users/tpalaz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tpalaz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tpalaz/subscriptions",
    "organizations_url": "https://api.github.com/users/tpalaz/orgs",
    "repos_url": "https://api.github.com/users/tpalaz/repos",
    "events_url": "https://api.github.com/users/tpalaz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tpalaz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-10-14T14:28:22Z",
  "updated_at": "2022-10-18T15:15:37Z",
  "closed_at": "2022-10-18T15:15:37Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2.28.0-dev-497d414b` (Latest Devel commit)\r\n\r\nOS & Version: Linux/Ubuntu 20.04.4 \r\n\r\nCommit hash : `497d414b36fa7ddc73baaf25fa183b0bba0c1e63`\r\n\r\n**Running BSC Archival Node** \r\n\r\n#### Expected behaviour\r\n\r\nWhen calling \"getTransactionByHash\" on pending transactions in the mempool, the node should respond with the appropriate body and deliver it to the client.  This is an important feature to get hash details from pending TX's, such as the sender/receiver. \r\n\r\nThis was working as expected in version [2022.08.01-alpha](https://github.com/ledgerwatch/erigon/releases/tag/v2022.08.01)\r\n\r\nThis #5739 does not seem to fix it sadly.\r\n\r\n#### Actual behaviour\r\n\r\nWhen calling \"getTransactionByHash\" on pending transactions in the mempool, the node responds with the following error message:\r\n`RPC method eth_getTransactionByHash crashed: runtime error: slice bounds out of range [32:26]` this happens on most transactions, but oddly enough the occassional one is able to resolve. \r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n- Create a websocket connection to the node via web3 library (Ethers, Web3, etc).\r\n- Subscribe to \"pendingTransactions\" to receive mempool TX's\r\n- On tx received, call \"getTransaction\" (Vanilla web3js), which invokes \"getTransactionByHash\" on the node\r\n- The node will respond with the runtime error: slice bounds out of range exception\r\n \r\n#### Backtrace\r\n\r\n````\r\nEROR[10-14|16:16:18.104] RPC method eth_getTransactionByHash crashed: runtime error: slice bounds out of range [32:26]\r\n[service.go:217 panic.go:838 panic.go:117 decompress.go:541 block_reader.go:667 block_reader.go:768 block_snapshots.go:312 block_reader.go:767 eth_api.go:141 eth_txs.go:33 value.go:556 value.go:339 service.go:222 handler.go:494 handler.go:444 handler.go:392 handler.go:223 handler.go:316 asm_amd64.s:1571]\r\nWARN[10-14|16:16:18.104] Served method=eth_getTransactionByHash reqid=177 t=1.21199ms err=\"method handler crashed\"  \r\n````",
  "closed_by": {
    "login": "tpalaz",
    "id": 25038010,
    "node_id": "MDQ6VXNlcjI1MDM4MDEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/25038010?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tpalaz",
    "html_url": "https://github.com/tpalaz",
    "followers_url": "https://api.github.com/users/tpalaz/followers",
    "following_url": "https://api.github.com/users/tpalaz/following{/other_user}",
    "gists_url": "https://api.github.com/users/tpalaz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tpalaz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tpalaz/subscriptions",
    "organizations_url": "https://api.github.com/users/tpalaz/orgs",
    "repos_url": "https://api.github.com/users/tpalaz/repos",
    "events_url": "https://api.github.com/users/tpalaz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tpalaz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1279135237",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1279135237",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1279135237,
    "node_id": "IC_kwDOC0FsAM5MPg4F",
    "user": {
      "login": "Zorato",
      "id": 2941327,
      "node_id": "MDQ6VXNlcjI5NDEzMjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2941327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Zorato",
      "html_url": "https://github.com/Zorato",
      "followers_url": "https://api.github.com/users/Zorato/followers",
      "following_url": "https://api.github.com/users/Zorato/following{/other_user}",
      "gists_url": "https://api.github.com/users/Zorato/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Zorato/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Zorato/subscriptions",
      "organizations_url": "https://api.github.com/users/Zorato/orgs",
      "repos_url": "https://api.github.com/users/Zorato/repos",
      "events_url": "https://api.github.com/users/Zorato/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Zorato/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-14T15:09:46Z",
    "updated_at": "2022-10-14T15:09:46Z",
    "author_association": "NONE",
    "body": "Confirm, we are still getting this error when calling `api.getReceipts` which uses `rawdb.ReadReceipts`:\r\n```\r\nruntime error: index out of range [62] with length 62\r\n[service.go:217 panic.go:884 panic.go:113 accessors_chain.go:950 kv_mdbx.go:553 accessors_chain.go:944 accessors_chain.go:972 eth_receipts.go:36 ...] \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1279135237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1280806481",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1280806481",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1280806481,
    "node_id": "IC_kwDOC0FsAM5MV45R",
    "user": {
      "login": "atdefinative",
      "id": 111536595,
      "node_id": "U_kgDOBqXp0w",
      "avatar_url": "https://avatars.githubusercontent.com/u/111536595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atdefinative",
      "html_url": "https://github.com/atdefinative",
      "followers_url": "https://api.github.com/users/atdefinative/followers",
      "following_url": "https://api.github.com/users/atdefinative/following{/other_user}",
      "gists_url": "https://api.github.com/users/atdefinative/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atdefinative/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atdefinative/subscriptions",
      "organizations_url": "https://api.github.com/users/atdefinative/orgs",
      "repos_url": "https://api.github.com/users/atdefinative/repos",
      "events_url": "https://api.github.com/users/atdefinative/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atdefinative/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T12:48:43Z",
    "updated_at": "2022-10-17T12:48:43Z",
    "author_association": "NONE",
    "body": "Having the same issue",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1280806481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281088573",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1281088573",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1281088573,
    "node_id": "IC_kwDOC0FsAM5MW9w9",
    "user": {
      "login": "tpalaz",
      "id": 25038010,
      "node_id": "MDQ6VXNlcjI1MDM4MDEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/25038010?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tpalaz",
      "html_url": "https://github.com/tpalaz",
      "followers_url": "https://api.github.com/users/tpalaz/followers",
      "following_url": "https://api.github.com/users/tpalaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/tpalaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tpalaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tpalaz/subscriptions",
      "organizations_url": "https://api.github.com/users/tpalaz/orgs",
      "repos_url": "https://api.github.com/users/tpalaz/repos",
      "events_url": "https://api.github.com/users/tpalaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tpalaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T15:50:06Z",
    "updated_at": "2022-10-17T15:58:49Z",
    "author_association": "NONE",
    "body": "@Zorato @atdefinative \r\n\r\nI followed https://github.com/ledgerwatch/erigon/issues/5698#issuecomment-1279693934\r\nAnd was able to fix it. \r\n\r\n\r\nThe steps specific steps I took to resolve this:\r\n\r\n1. Stop the erigon node\r\n2. Navigate to your data-directory/snapshots folder and fully delete all snapshot files\r\n3. Unwind the node 1 million blocks (not sure if this step is necessary)\r\n4. Restart erigon (make sure to change the torrentDownload flags to speed up the download)\r\n5. Let erigon rebuild the snapshots indexes \r\n\r\nI am also on the latest version (2.28.1)",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281088573/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281092693",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1281092693",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1281092693,
    "node_id": "IC_kwDOC0FsAM5MW-xV",
    "user": {
      "login": "atdefinative",
      "id": 111536595,
      "node_id": "U_kgDOBqXp0w",
      "avatar_url": "https://avatars.githubusercontent.com/u/111536595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atdefinative",
      "html_url": "https://github.com/atdefinative",
      "followers_url": "https://api.github.com/users/atdefinative/followers",
      "following_url": "https://api.github.com/users/atdefinative/following{/other_user}",
      "gists_url": "https://api.github.com/users/atdefinative/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atdefinative/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atdefinative/subscriptions",
      "organizations_url": "https://api.github.com/users/atdefinative/orgs",
      "repos_url": "https://api.github.com/users/atdefinative/repos",
      "events_url": "https://api.github.com/users/atdefinative/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atdefinative/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T15:53:12Z",
    "updated_at": "2022-10-17T15:53:12Z",
    "author_association": "NONE",
    "body": "Thanks,\r\nCan you please elaborate on how to unwind and what torrentDownload flags did you use?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281092693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281096552",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1281096552",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1281096552,
    "node_id": "IC_kwDOC0FsAM5MW_to",
    "user": {
      "login": "a26nine",
      "id": 103454930,
      "node_id": "U_kgDOBiqY0g",
      "avatar_url": "https://avatars.githubusercontent.com/u/103454930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/a26nine",
      "html_url": "https://github.com/a26nine",
      "followers_url": "https://api.github.com/users/a26nine/followers",
      "following_url": "https://api.github.com/users/a26nine/following{/other_user}",
      "gists_url": "https://api.github.com/users/a26nine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/a26nine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/a26nine/subscriptions",
      "organizations_url": "https://api.github.com/users/a26nine/orgs",
      "repos_url": "https://api.github.com/users/a26nine/repos",
      "events_url": "https://api.github.com/users/a26nine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/a26nine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T15:56:10Z",
    "updated_at": "2022-10-17T15:56:37Z",
    "author_association": "NONE",
    "body": "`--torrent.download.rate=[YOUR_MAX_SPEED]` a start-up flag (on in the service file).",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281096552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281098448",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1281098448",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1281098448,
    "node_id": "IC_kwDOC0FsAM5MXALQ",
    "user": {
      "login": "tpalaz",
      "id": 25038010,
      "node_id": "MDQ6VXNlcjI1MDM4MDEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/25038010?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tpalaz",
      "html_url": "https://github.com/tpalaz",
      "followers_url": "https://api.github.com/users/tpalaz/followers",
      "following_url": "https://api.github.com/users/tpalaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/tpalaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tpalaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tpalaz/subscriptions",
      "organizations_url": "https://api.github.com/users/tpalaz/orgs",
      "repos_url": "https://api.github.com/users/tpalaz/repos",
      "events_url": "https://api.github.com/users/tpalaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tpalaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T15:57:33Z",
    "updated_at": "2022-10-17T15:57:33Z",
    "author_association": "NONE",
    "body": "> Thanks, Can you please elaborate on how to unwind and what torrentDownload flags did you use?\r\n\r\nTorrent download flags are:\r\n`--torrent.download.rate=1000mb` && `-torrent.download.slots=6` \r\n\r\nTo unwind the node you need to cd erigon && make integration then run:\r\n`/build/bin/integration stage_exec --datadir=YourDataDir unwind AmountOfBlocksToUnwind --chain=bsc`\r\n\r\nNot entirely sure if the unwind stage is necessary. A few people claimed to have success without it. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281098448/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281101173",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5747#issuecomment-1281101173",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5747",
    "id": 1281101173,
    "node_id": "IC_kwDOC0FsAM5MXA11",
    "user": {
      "login": "a26nine",
      "id": 103454930,
      "node_id": "U_kgDOBiqY0g",
      "avatar_url": "https://avatars.githubusercontent.com/u/103454930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/a26nine",
      "html_url": "https://github.com/a26nine",
      "followers_url": "https://api.github.com/users/a26nine/followers",
      "following_url": "https://api.github.com/users/a26nine/following{/other_user}",
      "gists_url": "https://api.github.com/users/a26nine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/a26nine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/a26nine/subscriptions",
      "organizations_url": "https://api.github.com/users/a26nine/orgs",
      "repos_url": "https://api.github.com/users/a26nine/repos",
      "events_url": "https://api.github.com/users/a26nine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/a26nine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T15:59:37Z",
    "updated_at": "2022-10-17T15:59:37Z",
    "author_association": "NONE",
    "body": "> > Thanks, Can you please elaborate on how to unwind and what torrentDownload flags did you use?\r\n> \r\n> Torrent download flags are: `--torrent.download.rate=1000mb` && `-torrent.download.slots=6`\r\n> \r\n> To unwind the node you need to cd erigon && make integration then run: `/build/bin/integration stage_exec --datadir=YourDataDir unwind AmountOfBlocksToUnwind --chain=bsc`\r\n> \r\n> Not entirely sure if the unwind stage is necessary. A few people claimed to have success without it.\r\n\r\nI can confirm â€” it works without unwinding.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1281101173/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
