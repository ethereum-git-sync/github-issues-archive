{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5651",
  "id": 1400535985,
  "node_id": "I_kwDOC0FsAM5Tenux",
  "number": 5651,
  "title": "Finished unwinding with panic",
  "user": {
    "login": "DaraDoyoung",
    "id": 95335707,
    "node_id": "U_kgDOBa61Gw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95335707?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DaraDoyoung",
    "html_url": "https://github.com/DaraDoyoung",
    "followers_url": "https://api.github.com/users/DaraDoyoung/followers",
    "following_url": "https://api.github.com/users/DaraDoyoung/following{/other_user}",
    "gists_url": "https://api.github.com/users/DaraDoyoung/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DaraDoyoung/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DaraDoyoung/subscriptions",
    "organizations_url": "https://api.github.com/users/DaraDoyoung/orgs",
    "repos_url": "https://api.github.com/users/DaraDoyoung/repos",
    "events_url": "https://api.github.com/users/DaraDoyoung/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DaraDoyoung/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-10-07T02:27:27Z",
  "updated_at": "2022-10-20T14:07:39Z",
  "closed_at": "2022-10-20T14:07:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `erigon version 2022.10.1-dev-d566d4af`\r\n\r\nOS & Version: Ubuntu 22.04 LTS\r\n\r\nI unwinded my erigon node with this scirpt:\r\n`build/bin/integration state_stages --unwind=10 --datadir ~/data --chain mainnet`\r\nbut got error and ended with panic.\r\n\r\n````\r\nINFO[10-07|02:20:59.005] [Snapshot Txs] Replacement preprocessing processed=87.15% ch=0\r\nINFO[10-07|02:21:14.678] [14/16 TxLookup Prune] ETL [1/2] Extracting from=CanonicalHeader block=15563320 alloc=4.6GB sys=6.5GB\r\nINFO[10-07|02:21:29.008] [Snapshot Txs] Replacement preprocessing processed=99.00% ch=0\r\nINFO[10-07|02:21:32.046] [Snapshot Txs] Replacement preprocessing took=4m2.937666862s\r\nINFO[10-07|02:21:32.051] [Snapshot Txs] Effective dictionary      patternList.Len=7150 patternsSize=248.0KB 5=191 6=154 7=119 8=168 9=134 10=118 11=127 12=113 13=261 14=341 15=230 16=152 17=147 18=86 19=87 20=848 32=1713 64=2152 128=9\r\nINFO[10-07|02:21:32.062] [Snapshot Txs] Positional dictionary     positionList.len=9480 posSize=30.3KB\r\nINFO[10-07|02:21:35.568] [Snapshot Txs] Compress                  took=4m6.565225789s ratio=1.90 file=v1-015460-015470-transactions.seg\r\nINFO[10-07|02:21:35.568] [snapshots] Compression                  ratio=1.90 file=v1-015460-015470-transactions\r\nINFO[10-07|02:21:43.956] [index] calculating                      file=v1-015460-015470-transactions.idx\r\nINFO[10-07|02:21:44.659] [14/16 TxLookup Prune] ETL [1/2] Extracting from=CanonicalHeader block=15565634 alloc=4.4GB sys=6.5GB\r\nINFO[10-07|02:21:55.128] [index] write                            file=v1-015460-015470-transactions.idx\r\nINFO[10-07|02:22:06.511] [Snapshots] Blocks Stat                  blocks=15470k indices=15470k alloc=5.4GB sys=6.5GB\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xdf2222]\r\n\r\ngoroutine 24 [running]:\r\ngithub.com/ledgerwatch/erigon/turbo/shards.(*Events).OnNewSnapshot(0x0)\r\n\tgithub.com/ledgerwatch/erigon/turbo/shards/events.go:108 +0x42\r\ngithub.com/ledgerwatch/erigon/turbo/snapshotsync.retireBlocks({0x1be7e20, 0xc000044078}, 0xebe6a0, 0xec0db0, {0x1, 0x0, 0x0, 0x0}, {0xc0021e0bc0, 0x1a}, ...)\r\n\tgithub.com/ledgerwatch/erigon/turbo/snapshotsync/block_snapshots.go:1149 +0x2e4\r\ngithub.com/ledgerwatch/erigon/turbo/snapshotsync.(*BlockRetire).RetireBlocks(0xc0004e9380, {0x1be7e20, 0xc000044078}, 0x0?, 0x0?, 0x0?)\r\n\tgithub.com/ledgerwatch/erigon/turbo/snapshotsync/block_snapshots.go:1085 +0x125\r\ngithub.com/ledgerwatch/erigon/turbo/snapshotsync.(*BlockRetire).RetireBlocksInBackground.func1()\r\n\tgithub.com/ledgerwatch/erigon/turbo/snapshotsync/block_snapshots.go:1125 +0xc7\r\ncreated by github.com/ledgerwatch/erigon/turbo/snapshotsync.(*BlockRetire).RetireBlocksInBackground\r\n\tgithub.com/ledgerwatch/erigon/turbo/snapshotsync/block_snapshots.go:1117 +0xd6\r\n````\r\n",
  "closed_by": {
    "login": "revitteth",
    "id": 693995,
    "node_id": "MDQ6VXNlcjY5Mzk5NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/693995?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/revitteth",
    "html_url": "https://github.com/revitteth",
    "followers_url": "https://api.github.com/users/revitteth/followers",
    "following_url": "https://api.github.com/users/revitteth/following{/other_user}",
    "gists_url": "https://api.github.com/users/revitteth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/revitteth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/revitteth/subscriptions",
    "organizations_url": "https://api.github.com/users/revitteth/orgs",
    "repos_url": "https://api.github.com/users/revitteth/repos",
    "events_url": "https://api.github.com/users/revitteth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/revitteth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1271169390",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5651#issuecomment-1271169390",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651",
    "id": 1271169390,
    "node_id": "IC_kwDOC0FsAM5LxIFu",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-07T06:33:36Z",
    "updated_at": "2022-10-07T06:33:36Z",
    "author_association": "COLLABORATOR",
    "body": "fixed by https://github.com/ledgerwatch/erigon/pull/5656",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1271169390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1285613474",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5651#issuecomment-1285613474",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5651",
    "id": 1285613474,
    "node_id": "IC_kwDOC0FsAM5MoOei",
    "user": {
      "login": "revitteth",
      "id": 693995,
      "node_id": "MDQ6VXNlcjY5Mzk5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/693995?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/revitteth",
      "html_url": "https://github.com/revitteth",
      "followers_url": "https://api.github.com/users/revitteth/followers",
      "following_url": "https://api.github.com/users/revitteth/following{/other_user}",
      "gists_url": "https://api.github.com/users/revitteth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/revitteth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/revitteth/subscriptions",
      "organizations_url": "https://api.github.com/users/revitteth/orgs",
      "repos_url": "https://api.github.com/users/revitteth/repos",
      "events_url": "https://api.github.com/users/revitteth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/revitteth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-20T14:07:39Z",
    "updated_at": "2022-10-20T14:07:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing as fixed.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1285613474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
