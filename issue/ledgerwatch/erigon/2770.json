{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2770",
  "id": 1015008718,
  "node_id": "I_kwDOC0FsAM48f83O",
  "number": 2770,
  "title": "eth_getLogs and eth_getBlockByNumber failing on pruned DB",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-10-04T10:35:51Z",
  "updated_at": "2021-10-05T01:15:13Z",
  "closed_at": "2021-10-04T15:13:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: v2021.10.01\r\n\r\nOS & Version: Ubuntu 20.04\r\n\r\nCommit hash : ef80fd54b1c6c82aae92f5fa24cbd381e8577b50\r\n\r\nPrune: prune=\"--prune=htc --prune.r.before=11184524\"\r\n\r\n#### Behaviour\r\n\r\neth_getLogs call returns on error on block 11185311; eth_getBlockByNumber returns \"null\" for it and its parent and child block.\r\n\r\n```\r\ncurl http://localhost:8547 -X POST -H \"Content-Type: application/json\" -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getLogs\",\"params\":[{\"address\": \"0x00000000219ab540356cBB839Cbe05303d7705Fa\", \"fromBlock\": \"0xAAA98C\", \"toBlock\": \"0xAAACA0\"}],\"id\":1}'\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32000,\"message\":\"block not found 11185311\"}}\r\n```\r\n\r\n```\r\ncurl http://localhost:8547 -X POST -H \"Content-Type: application/json\" -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xAAAC9E\", false],\"id\":1}'\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":null}\r\n```\r\n\r\n```\r\ncurl http://localhost:8547 -X POST -H \"Content-Type: application/json\" -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xAAAC9F\", false],\"id\":1}'\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":null}\r\n```\r\n\r\n```\r\ncurl http://localhost:8547 -X POST -H \"Content-Type: application/json\" -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xAAACA0\", false],\"id\":1}'\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":null}\r\n```\r\n\r\nThis pattern of not returning data for eth_getBlockByNumber is  broader, I have not determined the edges. \"latest\" works and \"0x1\" works, both return data.\r\n",
  "closed_by": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933461207",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2770#issuecomment-933461207",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770",
    "id": 933461207,
    "node_id": "IC_kwDOC0FsAM43o3zX",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-04T13:03:09Z",
    "updated_at": "2021-10-04T13:03:09Z",
    "author_association": "COLLABORATOR",
    "body": "I understand what is reason: \r\n- we recently added pruning of Senders - it's inside `h` \r\n- and if no senders we do return \"no block\", but I think it's fine that no senders - senders can be recovered on the fly - just you will pay CPU\r\n- so, if you will see high CPU usage at this block numbers - then also increase \"pruning distance\" of character `h`\r\n\r\nPlease try branch: `no_senders_is_fine` ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933461207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933584546",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2770#issuecomment-933584546",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770",
    "id": 933584546,
    "node_id": "IC_kwDOC0FsAM43pV6i",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-04T15:13:08Z",
    "updated_at": "2021-10-04T15:13:35Z",
    "author_association": "NONE",
    "body": "Perfect, `no_senders_is_fine` does exactly what I need. Thank you! I am looking forward to seeing that feature in a future release. Closing issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933584546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933979325",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2770#issuecomment-933979325",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770",
    "id": 933979325,
    "node_id": "IC_kwDOC0FsAM43q2S9",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-05T01:13:23Z",
    "updated_at": "2021-10-05T01:13:31Z",
    "author_association": "COLLABORATOR",
    "body": "I said wrong, senders belong to “t”, not “h”.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933979325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933980913",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2770#issuecomment-933980913",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2770",
    "id": 933980913,
    "node_id": "IC_kwDOC0FsAM43q2rx",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-05T01:15:13Z",
    "updated_at": "2021-10-05T01:15:13Z",
    "author_association": "NONE",
    "body": "Thank you for clarifying. The No Senders branch worked, and since the consensus client (“beacon”) gets the data only once, when it is syncing deposits, the additional CPU load doesn’t hurt.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/933980913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
