{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1532",
  "id": 820259778,
  "node_id": "MDU6SXNzdWU4MjAyNTk3Nzg=",
  "number": 1532,
  "title": "database migration to v2021.02.04-13-gb7996c66d (b7996c66d9e949f35ad12a70ded9f014e0b77aff) failed",
  "user": {
    "login": "sdumpling",
    "id": 7397952,
    "node_id": "MDQ6VXNlcjczOTc5NTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7397952?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sdumpling",
    "html_url": "https://github.com/sdumpling",
    "followers_url": "https://api.github.com/users/sdumpling/followers",
    "following_url": "https://api.github.com/users/sdumpling/following{/other_user}",
    "gists_url": "https://api.github.com/users/sdumpling/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sdumpling/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sdumpling/subscriptions",
    "organizations_url": "https://api.github.com/users/sdumpling/orgs",
    "repos_url": "https://api.github.com/users/sdumpling/repos",
    "events_url": "https://api.github.com/users/sdumpling/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sdumpling/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-03-02T18:08:26Z",
  "updated_at": "2021-03-12T06:37:17Z",
  "closed_at": "2021-03-12T06:37:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\nI previously had a turbo geth (v2021.02.01-8-g583418901(583418901927416b7ea93eec85294ec62e7578ce) partially synced. It's done with downloading and execution, and doing the hash state phase for several days so I tried to update to the latest revision.\r\n\r\nAfter starting the new tg (2021.02.04), it started migrating and eventually failed with\r\nFatal: Failed to register the Ethereum service: db_migration: split_ih_bucket: wrong trie root: 83eb6ad9ad87ff468eb\r\n225a486e88a30f69a8273396af06b73e1338251ebfb7c, expected (from header): a319e5bf9184a4cd3710645ddaf2f21bc9e258af3307\r\ne9d8aa8d1da217a5aebc\r\n\r\nCould you take a look? Thanks.\r\n\r\nThe full logs are\r\nINFO [03-02|09:01:43.438] Starting Turbo-Geth on Ethereum mainnet...                                               \r\nINFO [03-02|09:01:43.438] Bumping default cache on mainnet         provided=0 updated=4096                         \r\nINFO [03-02|09:01:43.439] Dropping default light client cache      provided=0 updated=128                          \r\nINFO [03-02|09:01:43.451] Maximum peer count                       ETH=50 LES=0 total=50                           \r\nINFO [03-02|09:01:43.470] Set global gas cap                       cap=25000000                                    \r\nINFO [03-02|09:01:43.470] Opening Database (LMDB)                  mapSize=\"2.0 TB\" maxFreelistReuse=1000          \r\nINFO [03-02|09:01:43.597] Re-Opening DB in exclusive mode to apply migrations                                      \r\nINFO [03-02|09:01:43.597] database closed (LMDB)                   lmdb=chaindata                                  \r\nINFO [03-02|09:01:43.613] Apply migration                          name=split_hash_state_bucket                    \r\nINFO [03-02|09:02:13.613] [split_hash_state_bucket] Progress2      current key=02dd0b9dd4f3726c1aa920986b61e2d43147\r\nc4ac1a52af26ad45f3c03a304bdb                                                                                      \r\nINFO [03-02|09:02:43.614] [split_hash_state_bucket] Progress2      current key=099ff50d70718884ea3a0778a6ca997944e6\r\nf979e2234c4f42f150505cd2c4f9                                                                                      \r\nINFO [03-02|09:03:13.614] [split_hash_state_bucket] Progress2      current key=0f6f8e29f84afdf19ebeec4e2ad0aa50451d\r\n598494014bc690d6f19235c65461                                                  \r\nINFO [03-02|09:03:43.613] [split_hash_state_bucket] Progress2      current key=1421db90cf469aa466c53229e0c8119b1566\r\n5977577e53697de4638c438d7f2a                                                                                      \r\nINFO [03-02|09:04:13.613] [split_hash_state_bucket] Progress2      current key=18f7349a97ec21c8a90753561fc566c1c5e5\r\nd6f006a1c3e22c93c8b0957230a9      \r\nINFO [03-02|09:04:43.614] [split_hash_state_bucket] Progress2      current key=1d0721cd1f2e0e480d5337cb4499030f9799\r\naf293d66c2c4a129fe205736853a                                             \r\nINFO [03-02|09:05:13.614] [split_hash_state_bucket] Progress2      current key=230a7b4b629afb1aca3be60e285d132a218b\r\nc20fe5470787d373b5b5d6ea266f                                                              \r\nINFO [03-02|09:05:43.614] [split_hash_state_bucket] Progress2      current key=28b63abfa1f1b72c44bbfd1d6c47ada03a2d\r\necf1a9b191fca8f8149f31423493000000000000000118f89d593ae753d6a42cf3c0f4156f6e3d63e545c6369d654971fa631f25463a      \r\nINFO [03-02|09:05:58.590] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket1/tg-sync-sortable-buf560822764 alloc=7.28GiB sys=8.05GiB numGC=24     \r\nINFO [03-02|09:06:13.614] [split_hash_state_bucket] Progress2      current key=2c1d80fab044a471f192e610b145ec2f0baf\r\ncbf071fd028ac082feee5b7af9140000000000000001036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db0       \r\nINFO [03-02|09:06:43.614] [split_hash_state_bucket] Progress2      current key=31ceacc8e103e92c79d86706b2eb0ab7743f\r\nb1a4a6078f9e68eecc5d4fc12eef0000000000000001290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563      \r\nINFO [03-02|09:07:05.142] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket2/tg-sync-sortable-buf181834843 alloc=4.84GiB sys=8.14GiB numGC=26\r\nINFO [03-02|09:07:13.614] [split_hash_state_bucket] Progress2      current key=35e03712e57bd3a34ca7275dabde5a22f004\r\n3e21f620d59c6921d64d50713d87                             \r\nINFO [03-02|09:07:43.614] [split_hash_state_bucket] Progress2      current key=3cbd9dff8bc985801962aa3ac81268281e93\r\n6fa33c5c96312f8e69afa5505d8e                                       \r\nINFO [03-02|09:08:13.614] [split_hash_state_bucket] Progress2      current key=4417b2914553d53fc0c8ac3be657cbc9c554\r\n275ea123ec163a45d836fd55f9060000000000000001265778db1bd2ef38eaab5cdd7a7d25eb53304eff02e76fae9f96d7f26529b3ca      \r\nINFO [03-02|09:08:43.613] [split_hash_state_bucket] Progress2      current key=4b48a6e2c50427ed84d1c88fbb10318d758a\r\ndee0eb47f02c057c4b4ce6e60c8f                                                                                      \r\nINFO [03-02|09:09:13.614] [split_hash_state_bucket] Progress2      current key=51f9a87596143ed1c074d6f276b6802701f0\r\n2bbbf40b4ef1341c69ca930dc826                                                                                      \r\nINFO [03-02|09:09:43.614] [split_hash_state_bucket] Progress2      current key=56f39e8344ffece3835fb9c4e4f0248b79b2\r\n5f73001826819fc173ce28b9fecb                                                                                      \r\nINFO [03-02|09:10:13.613] [split_hash_state_bucket] Progress2      current key=5da7aa2c81dc699e1d2b0ac3f75b8b0f828e\r\n7a55abcba566468c2324865dd985                                                                                      \r\nINFO [03-02|09:10:43.614] [split_hash_state_bucket] Progress2      current key=666e6ab6a1c26cf1cbf4db18b563c9853f61\r\ne2dbc671544784b93c03e3ec8ebd                                                                                      \r\nINFO [03-02|09:11:02.537] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket2/tg-sync-sortable-buf224166910 alloc=4.28GiB sys=9.32GiB numGC=34                            \r\nINFO [03-02|09:11:13.614] [split_hash_state_bucket] Progress2      current key=6ae7af6a784724f308f734ae31cea5ee27dd\r\n1bc8024ac868158c2891ed743566                                                                                       \r\nINFO [03-02|09:11:45.928] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket1/tg-sync-sortable-buf860964677 alloc=7.79GiB sys=9.33GiB numGC=34                            \r\nINFO [03-02|09:11:48.136] [split_hash_state_bucket] Progress2      current key=71fe2579f4a5be157546549260f5539cc944\r\n5fa20674a8bb637049f43fc1eac200000000000000014c441453a9b5f8c1e6490d589adf35fb28d3416f7b8001261688fdfd6edab80f      \r\nINFO [03-02|09:12:13.614] [split_hash_state_bucket] Progress2      current key=745b33af49ad7da17e0918bc913aa53656b6\r\n340c54b07741493ade9a56b08fd30000000000000001290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563       \r\nINFO [03-02|09:12:43.614] [split_hash_state_bucket] Progress2      current key=77ec436139a03866b1bdf8f99b7bf1ad9865\r\n8f2ebbb248760b883b430a3e66f2                                                                                      \r\nINFO [03-02|09:13:13.613] [split_hash_state_bucket] Progress2      current key=7be72766fff70bc915cf45415b134d7ec149\r\n0a9fb3be093e8fef30e8dfaff00100000000000000017621e00c3886cc536668c94a5a3ae2dd0a46ec4391bcd72c131218fc462a7cdb       \r\nINFO [03-02|09:13:43.614] [split_hash_state_bucket] Progress2      current key=805a47a06b350376c8f6fd297511aca5655d\r\n5516c9511ce9bb654762ab94447f                                                                                       \r\nINFO [03-02|09:14:13.614] [split_hash_state_bucket] Progress2      current key=8679e8eda65bd257638cf8cf09b823888894\r\n7cc3c0bea2aa2cc3f1c4ac7a300200000000000000017d10a0e58ecbabd5f6c2c4acf8f8c6478e93ee67b50eb76d7f1d833562c3c849       \r\nINFO [03-02|09:14:43.615] [split_hash_state_bucket] Progress2      current key=8bf32a54f04cf8d0596e196d575e8d6f6acc\r\n973258880213dd86cdf33b7395af                                                                                      \r\nINFO [03-02|09:15:13.614] [split_hash_state_bucket] Progress2      current key=916936ba7d6f79093003c9b3a7eae4b3a237\r\nec60d7706ecefdeb36b593f6ceb9                                                                                       \r\nINFO [03-02|09:15:43.613] [split_hash_state_bucket] Progress2      current key=97ae01a7c549f3b9f03493104c923b58f9ec\r\n772f1c62becc9a932c8add667bc1                                                                                       \r\nINFO [03-02|09:16:13.613] [split_hash_state_bucket] Progress2      current key=9d407ed16a63973d4e417f6aa79daff4908e\r\ned4f47fe67bfe8f9796f4c2b8d1d                                                                                       \r\nINFO [03-02|09:16:24.192] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket2/tg-sync-sortable-buf174232544 alloc=7.76GiB sys=11.91GiB numGC=40                           \r\nINFO [03-02|09:16:43.613] [split_hash_state_bucket] Progress2      current key=a017143645379a5fec83115e2888b84f36c0\r\n04955d80ccb771ac8956788fa5f9                                                                                       \r\nINFO [03-02|09:17:13.614] [split_hash_state_bucket] Progress2      current key=a77d83ccfe62c36af303bf941266561c5eb3\r\nfc3269098a89ce35f3cfd0a52ba70000000000000001115a81fddcbdd58f6988ccd8252e5351a4873d881f89955813273a2b36869089      \r\nINFO [03-02|09:17:45.911] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket1/tg-sync-sortable-buf067510719 alloc=4.95GiB sys=11.91GiB numGC=42                           \r\nINFO [03-02|09:17:48.011] [split_hash_state_bucket] Progress2      current key=ad87a3d604f33fc0b0029e14db220b978a49\r\n065c8055393b099c47dc794d352f000000000000000195aade889823459bb266bd31449e31b5edd9f17a037495dbc944183143e1fde9\r\nINFO [03-02|09:18:13.614] [split_hash_state_bucket] Progress2      current key=b55f557723e68691759601b9f465a7901c0b\r\n79007fcd94d0ed1d59f368a52ddd                           \r\nINFO [03-02|09:18:43.613] [split_hash_state_bucket] Progress2      current key=be6bd5234605682658e2ccba3824e89fbb07\r\n80c749ad853e6d3e6ed2c45f1ff70000000000000001d9a5f072f9dc43135e680b49cd35f05142eef64d580380d767b478d7b1cfee7c\r\nINFO [03-02|09:19:13.614] [split_hash_state_bucket] Progress2      current key=c6c09802a2480a737c9b9c9dcdf59baa1aa4\r\n6feec695a0ec8e62f1f1c4862693                                                                                       \r\nINFO [03-02|09:19:43.614] [split_hash_state_bucket] Progress2      current key=cf1666d2fa5d3d5ce2ff50e246ab10338c58\r\n16fdbb60f995329edf8b9e49ccbc0000000000000001efb9bfadbc1840aeaf7c59be2c9d2bd6f2c3ec41cb93d929b87130b9f0af2ebb       \r\nINFO [03-02|09:20:07.905] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket2/tg-sync-sortable-buf143149074 alloc=6.67GiB sys=11.91GiB numGC=47\r\nINFO [03-02|09:20:13.614] [split_hash_state_bucket] Progress2      current key=d2e1aa083aa2a0f630aa62bae0fff818a658\r\n0ed85d778d3ae27281f76d4037a0                                                                                       \r\nINFO [03-02|09:20:43.613] [split_hash_state_bucket] Progress2      current key=da9135476a9cff6b757e2ad77e7cb74fbb23\r\ne0c4b82119e8c58a5eb1592d8cd10000000000000001add783b6d9ffe844efb82a27d85543294cd2f7a32fbd4edca3e3e4eaeaa6a51b       \r\nINFO [03-02|09:21:13.614] [split_hash_state_bucket] Progress2      current key=e2380e5978a8bcc1afae20cd5ad33df44931\r\na30d35cb8913d324f2ce497c674a                                                                                       \r\nINFO [03-02|09:21:43.614] [split_hash_state_bucket] Progress2      current key=eb54bb11b6a6035e26dbfb90dd1e4ae5f255\r\nb68624d73d5229ba955e11046e5d00000000000000010175b7a638427703f0dbe7bb9bbf987a2551717b34e79f33b5b1008d1fa01db9       \r\nINFO [03-02|09:22:11.329] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket1/tg-sync-sortable-buf030656585 alloc=5.67GiB sys=11.91GiB numGC=50                          \r\nINFO [03-02|09:22:13.614] [split_hash_state_bucket] Progress2      current key=f0edb4ca2bc2dbe29c45f155d7f1d0fa2a70\r\na7f17885fb3b497b80cd1f94acc200000000000000010216d8f1bda4446b414a90c017180eac572a0ca464c6beece0d633ba709c3dd4      \r\nINFO [03-02|09:22:43.847] [split_hash_state_bucket] Progress2      current key=fa984aa2d462df49e896df405051c8c9e3d5\r\ne44bfd4eae7b8d5c6f50356be9e4                                                  \r\nINFO [03-02|09:23:02.210] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket1/tg-sync-sortable-buf159607572 alloc=2.63GiB sys=11.91GiB numGC=52                          \r\nINFO [03-02|09:23:32.517] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_storage current key=26318850... a\r\nlloc=2.63GiB sys=11.91GiB numGC=54\r\nINFO [03-02|09:24:02.516] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_storage current key=72e28e74... a\r\nlloc=4.03GiB sys=11.91GiB numGC=56                                       \r\nINFO [03-02|09:24:32.517] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_storage current key=bf5fd985... a\r\nlloc=3.32GiB sys=11.91GiB numGC=59                                                        \r\nINFO [03-02|09:25:13.121] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_hash_state_bucket2/tg-sync-sortable-buf145126755 alloc=3.28GiB sys=11.91GiB numGC=62                          \r\nINFO [03-02|09:25:45.155] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_accounts current key=1d101ef4... \r\nalloc=7.05MiB sys=11.91GiB numGC=593                                                        \r\nINFO [03-02|09:26:15.156] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_accounts current key=46da7ddb... \r\nalloc=6.44MiB sys=11.91GiB numGC=1614                                                                              \r\nINFO [03-02|09:26:45.155] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_accounts current key=692b958e... \r\nalloc=8.27MiB sys=11.91GiB numGC=2453                                                                             \r\nINFO [03-02|09:27:15.156] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_accounts current key=956aa5ba... \r\nalloc=7.91MiB sys=11.91GiB numGC=3532                                                  \r\nINFO [03-02|09:27:45.156] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_accounts current key=c0cc23ee... \r\nalloc=7.07MiB sys=11.91GiB numGC=4589                    \r\nINFO [03-02|09:28:15.156] [split_hash_state_bucket] ETL [2/2] Loading into=hashed_accounts current key=ecc1f05d... \r\nalloc=5.98MiB sys=11.91GiB numGC=5660                              \r\nINFO [03-02|09:28:34.589] [split_hash_state_bucket] etl: temp files removed successfully total size=\"4.3 GB\"       \r\nINFO [03-02|09:28:35.178] [split_hash_state_bucket] etl: temp files removed successfully total size=\"5.3 GB\"      \r\nINFO [03-02|09:28:35.178] Applied migration                        name=split_hash_state_bucket                    \r\nINFO [03-02|09:28:35.178] Apply migration                          name=split_ih_bucket                           \r\nINFO [03-02|09:28:35.202] [db_migration: split_ih_bucket] Regeneration intermediate hashes started                 \r\nINFO [03-02|09:29:05.375] [db_migration: split_ih_bucket] Calculating Merkle root current key=0dace0c3...         \r\nINFO [03-02|09:29:36.570] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf733242214 alloc=1.23GiB sys=11.91GiB numGC=6151                                 \r\nINFO [03-02|09:29:39.581] [db_migration: split_ih_bucket] Calculating Merkle root current key=1a4fa162...          \r\nINFO [03-02|09:30:05.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=26fdd62b...         \r\nINFO [03-02|09:30:22.624] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf153658253 alloc=1.60GiB sys=11.91GiB numGC=6154                                 \r\nINFO [03-02|09:30:35.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=3399bd0b...          \r\nINFO [03-02|09:31:05.253] [db_migration: split_ih_bucket] Calculating Merkle root current key=44ce349d...          \r\nINFO [03-02|09:31:35.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=54c1eaa1...          \r\nINFO [03-02|09:31:50.582] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf715002248 alloc=2.03GiB sys=11.91GiB numGC=6162                                  \r\nINFO [03-02|09:32:08.546] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf606602055 alloc=963.16MiB sys=11.91GiB numGC=6163                                \r\nINFO [03-02|09:32:09.093] [db_migration: split_ih_bucket] Calculating Merkle root current key=59e7ca29...         \r\nINFO [03-02|09:32:35.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=6112dbfe...          \r\nINFO [03-02|09:33:05.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=69bfc450...          \r\nINFO [03-02|09:33:35.253] [db_migration: split_ih_bucket] Calculating Merkle root current key=7171b60e...          \r\nINFO [03-02|09:34:05.253] [db_migration: split_ih_bucket] Calculating Merkle root current key=76a8edb2...         \r\nINFO [03-02|09:34:27.949] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf272387066 alloc=1.37GiB   sys=11.91GiB numGC=6172                                \r\nINFO [03-02|09:34:35.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=7ff65d30...          \r\nINFO [03-02|09:34:51.467] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf375837457 alloc=1.80GiB   sys=11.91GiB numGC=6173                                \r\nINFO [03-02|09:35:05.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=8debaa9a...          \r\nINFO [03-02|09:35:35.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=9eecf736...          \r\nINFO [03-02|09:36:05.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=af70336d...         \r\nINFO [03-02|09:36:16.518] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf014118204 alloc=1.40GiB   sys=11.91GiB numGC=6185                                \r\nINFO [03-02|09:36:26.085] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf890874219 alloc=623.81MiB sys=11.91GiB numGC=6186                                \r\nINFO [03-02|09:36:35.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=bc3e3926...          \r\nINFO [03-02|09:37:05.252] [db_migration: split_ih_bucket] Calculating Merkle root current key=cd138779...          \r\nINFO [03-02|09:37:35.253] [db_migration: split_ih_bucket] Calculating Merkle root current key=dd210fd2...          \r\nINFO [03-02|09:37:47.218] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf014668238 alloc=1.15GiB   sys=11.91GiB numGC=6196                                \r\nINFO [03-02|09:38:06.361] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/sp\r\nlit_ih_bucket/tg-sync-sortable-buf982217941 alloc=720.84MiB sys=11.91GiB numGC=6197                                \r\nINFO [03-02|09:38:06.896] [db_migration: split_ih_bucket] Calculating Merkle root current key=e9b4def4...         \r\nINFO [03-02|09:38:35.254] [db_migration: split_ih_bucket] Calculating Merkle root current key=faadbbdd...          \r\nFatal: Failed to register the Ethereum service: db_migration: split_ih_bucket: wrong trie root: 83eb6ad9ad87ff468eb\r\n225a486e88a30f69a8273396af06b73e1338251ebfb7c, expected (from header): a319e5bf9184a4cd3710645ddaf2f21bc9e258af3307\r\ne9d8aa8d1da217a5aebc                                          \r\n\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789163267",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789163267",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789163267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTE2MzI2Nw==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-02T19:40:11Z",
    "updated_at": "2021-03-02T19:40:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting! I suspect the hashed state got corrupted, because we did not actually envisage someone starting data migration before completing a previous sync cycle (I am also surprise it was taking you days to complete hashed state, it normally takes no more than couple of hours). What you can do now is the following (while turbo-geth is down):\r\n1. Build integration tool `make integration`\r\n2. Reset and rebuild your hashed state using command `./build/bin/integration stage_hash_state --chaindata <datadir>/tg/chaindata`\r\n3. Reset and rebuild trie records using command `./build/bin/integration stage_trie --chaindata <datadir>/tg/chaindata`\r\n\r\nAfter that you can restart Turbo-geth and it should continue the remaining stages",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789163267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789262666",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789262666",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789262666,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTI2MjY2Ng==",
    "user": {
      "login": "sdumpling",
      "id": 7397952,
      "node_id": "MDQ6VXNlcjczOTc5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7397952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdumpling",
      "html_url": "https://github.com/sdumpling",
      "followers_url": "https://api.github.com/users/sdumpling/followers",
      "following_url": "https://api.github.com/users/sdumpling/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdumpling/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdumpling/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdumpling/subscriptions",
      "organizations_url": "https://api.github.com/users/sdumpling/orgs",
      "repos_url": "https://api.github.com/users/sdumpling/repos",
      "events_url": "https://api.github.com/users/sdumpling/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdumpling/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-02T22:21:55Z",
    "updated_at": "2021-03-02T22:21:55Z",
    "author_association": "NONE",
    "body": "Thanks AlexeyAkhunov for your quick response.\r\nI'm not sure whether you suggested rebuild the state using new version or old version, so I tried both.\r\n./build/bin/integration stage_hash_state \r\n\r\nWith the 2021.02.04, it's fast but I got the same error as seen during the migration:\r\n...\r\nINFO [03-02|13:52:02.707] [db_migration: split_ih_bucket] Calculating Merkle root current key=ffa04c71...\r\npanic: db_migration: split_ih_bucket: wrong trie root: 83eb6ad9ad87ff468eb225a486e88a30f69a8273396af06b73e1338251ebfb7c, expected (from header): a319e5bf9184a4cd3710645ddaf2f21bc9e258af3307e9d8aa8d1da217a5aebc\r\n\r\ngoroutine 1 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/cmd/integration/commands.openDatabase(0x7ffc99084d48, 0x22, 0xc00028fd01, 0x9c5105)\r\n        github.com/ledgerwatch/turbo-geth/cmd/integration/commands/root.go:43 +0x333\r\ngithub.com/ledgerwatch/turbo-geth/cmd/integration/commands.glob..func15(0x1ae57a0, 0xc0002ba900, 0x0, 0x2, 0x0, 0x0)\r\n        github.com/ledgerwatch/turbo-geth/cmd/integration/commands/stages.go:87 +0x85\r\ngithub.com/spf13/cobra.(*Command).execute(0x1ae57a0, 0xc0002ba8e0, 0x2, 0x2, 0x1ae57a0, 0xc0002ba8e0)\r\n        github.com/spf13/cobra@v1.1.1/command.go:850 +0x47c\r\ngithub.com/spf13/cobra.(*Command).ExecuteC(0x1ae4a80, 0xc00011ee40, 0xf, 0x16)\r\n        github.com/spf13/cobra@v1.1.1/command.go:958 +0x375\r\ngithub.com/spf13/cobra.(*Command).Execute(...)\r\n        github.com/spf13/cobra@v1.1.1/command.go:895\r\ngithub.com/spf13/cobra.(*Command).ExecuteContext(...)\r\n        github.com/spf13/cobra@v1.1.1/command.go:888\r\nmain.main()\r\n        github.com/ledgerwatch/turbo-geth/cmd/integration/main.go:13 +0x129\r\n\r\nwith the old version, 2021.02.01, it's extremely slow as before. looking at the progress, it won't be done anytime soon.\r\n\r\n71.83MiB numGC=147\r\nINFO [03-02|14:12:02.585] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000501f3c alloc=8.68MiB sys=71.83MiB numGC=159\r\nINFO [03-02|14:12:32.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000502334 alloc=7.77MiB sys=71.83MiB numGC=174\r\nINFO [03-02|14:13:02.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=000000000050263d alloc=7.42MiB sys=71.83MiB numGC=185\r\nINFO [03-02|14:13:32.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=000000000050297b alloc=15.14MiB sys=72.02MiB numGC=193\r\nINFO [03-02|14:14:02.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000502cc3 alloc=9.59MiB  sys=72.02MiB numGC=203\r\nINFO [03-02|14:14:32.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000503072 alloc=8.00MiB  sys=72.02MiB numGC=214\r\nINFO [03-02|14:15:02.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000503506 alloc=11.00MiB sys=72.02MiB numGC=224\r\nINFO [03-02|14:15:32.585] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000503996 alloc=14.72MiB sys=72.02MiB numGC=234\r\nINFO [03-02|14:16:02.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000503de7 alloc=10.39MiB sys=72.02MiB numGC=245\r\nINFO [03-02|14:16:32.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000504203 alloc=14.21MiB sys=72.02MiB numGC=254\r\nINFO [03-02|14:17:02.585] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=000000000050466c alloc=16.47MiB sys=72.20MiB numGC=261\r\nINFO [03-02|14:17:32.585] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000504b02 alloc=15.22MiB sys=72.20MiB numGC=266\r\nINFO [03-02|14:18:02.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=000000000050503d alloc=22.81MiB sys=72.20MiB numGC=272\r\nINFO [03-02|14:18:32.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000505564 alloc=13.34MiB sys=72.20MiB numGC=280\r\nINFO [03-02|14:19:02.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=0000000000505a68 alloc=16.09MiB sys=72.20MiB numGC=287\r\nINFO [03-02|14:19:32.584] [1/14 Headers] ETL [1/2] Extracting      from=PLAIN-ACS current key=000000000050611d alloc=17.73MiB sys=72.20MiB numGC=295\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789262666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789278580",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789278580",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789278580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTI3ODU4MA==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-02T22:45:53Z",
    "updated_at": "2021-03-02T22:45:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, I forgot something. You need to add `--reset` option to these commands:\r\n\r\n1. Build integration tool make integration\r\n2. Reset and rebuild your hashed state using command `./build/bin/integration stage_hash_state --reset --chaindata <datadir>/tg/chaindata`\r\n3. Reset and rebuild trie records using command `./build/bin/integration stage_trie --reset --chaindata <datadir>/tg/chaindata`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789278580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789280584",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789280584",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789280584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTI4MDU4NA==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-02T22:50:07Z",
    "updated_at": "2021-03-02T22:50:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "And to add, you should try the suggested steps with the old version (pre-migration), and once complete, restart turbo-geth with the new version to hopefully perform the migration",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789280584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789408335",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789408335",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789408335,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTQwODMzNQ==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T03:54:38Z",
    "updated_at": "2021-03-03T03:54:38Z",
    "author_association": "COLLABORATOR",
    "body": "I'm trying to reproduce, but can't yet.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789408335/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789446957",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789446957",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789446957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTQ0Njk1Nw==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T05:36:35Z",
    "updated_at": "2021-03-03T05:36:35Z",
    "author_association": "COLLABORATOR",
    "body": "found miss-mach at next scenario: go to 2595154, unwind to 2595145, go again to 2595154",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789446957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789479680",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789479680",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789479680,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTQ3OTY4MA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T06:43:51Z",
    "updated_at": "2021-03-03T06:43:51Z",
    "author_association": "COLLABORATOR",
    "body": "Here is the fix: https://github.com/ledgerwatch/turbo-geth/pull/1535/files\r\nBut I will try to reproduce more",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789479680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789924999",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-789924999",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 789924999,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTkyNDk5OQ==",
    "user": {
      "login": "sdumpling",
      "id": 7397952,
      "node_id": "MDQ6VXNlcjczOTc5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7397952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdumpling",
      "html_url": "https://github.com/sdumpling",
      "followers_url": "https://api.github.com/users/sdumpling/followers",
      "following_url": "https://api.github.com/users/sdumpling/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdumpling/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdumpling/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdumpling/subscriptions",
      "organizations_url": "https://api.github.com/users/sdumpling/orgs",
      "repos_url": "https://api.github.com/users/sdumpling/repos",
      "events_url": "https://api.github.com/users/sdumpling/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdumpling/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T17:41:09Z",
    "updated_at": "2021-03-03T17:41:09Z",
    "author_association": "NONE",
    "body": "Thanks for the fix. I updated to include the fix above. While the problem still exists. I understand it's challenging to reproduce without seeing the database on my side. FWIW, I did kill and restart tg couple of times while syncing due to system reboot, etc.\r\n\r\nI did ./build/bin/integration stage_hash_state --reset in the old version, but didn't do stage_trie since that stage isn't available in the old version:\r\n\r\n~/turbo-geth$ ./build/bin/integration stage_hash_state --reset --chaindata /mnt/disks/ssd/ether/tg/chaindata\r\nINFO [03-03|08:42:25.294] database closed (LMDB)                   lmdb=chaindata\r\nINFO [03-03|08:42:25.394] Most recent local header                 number=11956487 hash=\"1b799c…0cc523\" td=21598745227955161977413 age=1d12h50m\r\nINFO [03-03|08:42:25.401] Most recent local block                  number=11956487 hash=\"1b799c…0cc523\" td=21598745227955161977413 age=1d12h50m\r\nINFO [03-03|08:55:48.155] Blockchain stopped\r\nINFO [03-03|08:55:48.683] database closed (LMDB)                   lmdb=chaindata\r\n\r\nThen switched to the new version (including the fix) and restarted tg:\r\n\r\n~/turbo-geth$ cd ..\r\n~$ cd turbo-geth-update/\r\n~/turbo-geth-update$ cd turbo-geth/\r\n~/turbo-geth-update/turbo-geth$ build/bin/tg --datadir /mnt/disks/ssd/ether/ --private.api.addr=127.0.0.1:9090\r\nINFO [03-03|09:17:33.010] Build info                               git_branch= git_commit=59ea525eb610d2b9d6ba916492b582c41bc4adfa\r\nINFO [03-03|09:17:33.011] Starting Turbo-Geth on Ethereum mainnet...\r\nINFO [03-03|09:17:33.011] Bumping default cache on mainnet         provided=0 updated=4096\r\nINFO [03-03|09:17:33.011] Dropping default light client cache      provided=0 updated=128\r\nINFO [03-03|09:17:33.013] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [03-03|09:17:33.017] Set global gas cap                       cap=25000000\r\nINFO [03-03|09:17:33.017] Opening Database (LMDB)                  mapSize=\"2.0 TB\" maxFreelistReuse=1000\r\nINFO [03-03|09:17:33.018] Re-Opening DB in exclusive mode to apply migrations\r\nINFO [03-03|09:17:33.019] database closed (LMDB)                   lmdb=chaindata\r\nINFO [03-03|09:17:33.019] Apply migration                          name=split_ih_bucket\r\nINFO [03-03|09:17:33.027] [db_migration: split_ih_bucket] Regeneration intermediate hashes started\r\nINFO [03-03|09:18:03.076] [db_migration: split_ih_bucket] Calculating Merkle root current key=0b6e44c9...\r\nINFO [03-03|09:18:41.084] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf345691059 alloc=1.23GiB sys=1.65GiB numGC=25\r\nINFO [03-03|09:18:52.692] [db_migration: split_ih_bucket] Calculating Merkle root current key=1a4fa162...\r\nINFO [03-03|09:19:03.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=1c5d4c14...\r\nINFO [03-03|09:19:33.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=21c0659b...\r\nINFO [03-03|09:20:03.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=271a2f83...\r\nINFO [03-03|09:20:34.708] [db_migration: split_ih_bucket] Calculating Merkle root current key=2b2c851b...\r\nINFO [03-03|09:21:04.097] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf309872502 alloc=966.35MiB sys=2.11GiB numGC=29\r\nINFO [03-03|09:21:04.667] [db_migration: split_ih_bucket] Calculating Merkle root current key=2cf3753a...\r\nINFO [03-03|09:21:33.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=30e033e7...\r\nINFO [03-03|09:22:06.701] [db_migration: split_ih_bucket] Calculating Merkle root current key=35b15950...\r\nINFO [03-03|09:22:33.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=39d1d56b...\r\nINFO [03-03|09:23:03.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=3f6d0452...\r\nINFO [03-03|09:23:33.249] [db_migration: split_ih_bucket] Calculating Merkle root current key=44af1402...\r\nINFO [03-03|09:24:03.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=498b42c0...\r\nINFO [03-03|09:24:33.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=4ec847ff...\r\nINFO [03-03|09:25:03.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=540f5c70...\r\nINFO [03-03|09:25:29.999] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf327784541 alloc=2.03GiB   sys=3.14GiB numGC=35\r\nINFO [03-03|09:25:33.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=577c00a5...\r\nINFO [03-03|09:25:42.199] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf996499480 alloc=962.64MiB sys=3.16GiB numGC=36\r\nINFO [03-03|09:26:03.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=6463b6ac...\r\nINFO [03-03|09:26:33.156] [db_migration: split_ih_bucket] Calculating Merkle root current key=71fe2579...\r\nINFO [03-03|09:27:00.244] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf329539735 alloc=1.37GiB   sys=3.16GiB numGC=45\r\nINFO [03-03|09:27:03.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=7d75e6eb...\r\nINFO [03-03|09:27:23.670] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf522564362 alloc=1.80GiB   sys=3.16GiB numGC=46\r\nINFO [03-03|09:27:33.066] [db_migration: split_ih_bucket] Calculating Merkle root current key=8b26a831...\r\nINFO [03-03|09:28:03.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=9bace93e...\r\nINFO [03-03|09:28:33.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=ac5287ce...\r\nINFO [03-03|09:28:49.680] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf760842977 alloc=1.40GiB   sys=3.55GiB numGC=59\r\nINFO [03-03|09:28:59.441] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf343492812 alloc=616.26MiB sys=3.55GiB numGC=60\r\nINFO [03-03|09:29:03.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=b848a003...\r\nINFO [03-03|09:29:33.028] [db_migration: split_ih_bucket] Calculating Merkle root current key=c5584d89...\r\nINFO [03-03|09:30:03.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=d4e01c9c...\r\nINFO [03-03|09:30:38.009] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf253922235 alloc=1.15GiB   sys=3.55GiB numGC=70\r\nINFO [03-03|09:30:38.567] [db_migration: split_ih_bucket] Calculating Merkle root current key=e0bc9af8...\r\nINFO [03-03|09:31:01.150] Flushed buffer file                      name=/mnt/disks/ssd/ether/etl-temp/migrations/split_ih_bucket/tg-sync-sortable-buf528520670 alloc=706.57MiB sys=3.55GiB numGC=71\r\nINFO [03-03|09:31:03.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=ea7dfe2b...\r\nINFO [03-03|09:31:33.027] [db_migration: split_ih_bucket] Calculating Merkle root current key=f94cc536...\r\nFatal: Failed to register the Ethereum service: db_migration: split_ih_bucket: wrong trie root: 83eb6ad9ad87ff468eb225a486e88a30f69a8273396af06b73e1338251ebfb7c, expected (from header): a319e5bf9184a4cd3710645ddaf2f21bc9e258af3307e9d8aa8d1da217a5aebc\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/789924999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/790018447",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-790018447",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 790018447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDAxODQ0Nw==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T20:03:10Z",
    "updated_at": "2021-03-03T20:03:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, sorry, in the old version `stage_trie` was called `stage_ih` I think",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/790018447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/790243904",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-790243904",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 790243904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDI0MzkwNA==",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-04T02:43:55Z",
    "updated_at": "2021-03-04T02:43:55Z",
    "author_association": "COLLABORATOR",
    "body": "@AlexeyAkhunov I added this receipt into docs section: https://github.com/ledgerwatch/turbo-geth/tree/master/cmd/integration#wrong-trie-root-problem---temporary-solution",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/790243904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/791166305",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1532#issuecomment-791166305",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1532",
    "id": 791166305,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTE2NjMwNQ==",
    "user": {
      "login": "sdumpling",
      "id": 7397952,
      "node_id": "MDQ6VXNlcjczOTc5NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7397952?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdumpling",
      "html_url": "https://github.com/sdumpling",
      "followers_url": "https://api.github.com/users/sdumpling/followers",
      "following_url": "https://api.github.com/users/sdumpling/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdumpling/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdumpling/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdumpling/subscriptions",
      "organizations_url": "https://api.github.com/users/sdumpling/orgs",
      "repos_url": "https://api.github.com/users/sdumpling/repos",
      "events_url": "https://api.github.com/users/sdumpling/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdumpling/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T05:31:20Z",
    "updated_at": "2021-03-05T05:31:20Z",
    "author_association": "NONE",
    "body": "Thanks, that solved my problem!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/791166305/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
