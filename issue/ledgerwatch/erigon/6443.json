{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6443",
  "id": 1511069528,
  "node_id": "I_kwDOC0FsAM5aERdY",
  "number": 6443,
  "title": "Increase thread & db read throughput?",
  "user": {
    "login": "plvnts",
    "id": 51814841,
    "node_id": "MDQ6VXNlcjUxODE0ODQx",
    "avatar_url": "https://avatars.githubusercontent.com/u/51814841?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/plvnts",
    "html_url": "https://github.com/plvnts",
    "followers_url": "https://api.github.com/users/plvnts/followers",
    "following_url": "https://api.github.com/users/plvnts/following{/other_user}",
    "gists_url": "https://api.github.com/users/plvnts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/plvnts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/plvnts/subscriptions",
    "organizations_url": "https://api.github.com/users/plvnts/orgs",
    "repos_url": "https://api.github.com/users/plvnts/repos",
    "events_url": "https://api.github.com/users/plvnts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/plvnts/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-12-26T16:20:09Z",
  "updated_at": "2023-02-14T02:39:35Z",
  "closed_at": "2023-02-14T02:39:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Follow up to https://github.com/ledgerwatch/erigon/issues/2245\r\nWe are looking to increase throughput on a node. Currently, the max number of threads created by Erigon equals the number of CPU cores. We would like to increase the number of threads as well as max. DB connections, which seem to be another hard limit.\r\n\r\nLaunching Erigon with flags --rpc.batch.concurrency=1000 --db.read.concurrency=1000 doesn't affect speed in any way which seems strange, considering that the defaults are much lower. What is the recommended way to increase # of threads and read concurrency? Thanks",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1366170461",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6443#issuecomment-1366170461",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443",
    "id": 1366170461,
    "node_id": "IC_kwDOC0FsAM5Rbhtd",
    "user": {
      "login": "J-A-M-E-5",
      "id": 26421539,
      "node_id": "MDQ6VXNlcjI2NDIxNTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/26421539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/J-A-M-E-5",
      "html_url": "https://github.com/J-A-M-E-5",
      "followers_url": "https://api.github.com/users/J-A-M-E-5/followers",
      "following_url": "https://api.github.com/users/J-A-M-E-5/following{/other_user}",
      "gists_url": "https://api.github.com/users/J-A-M-E-5/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/J-A-M-E-5/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/J-A-M-E-5/subscriptions",
      "organizations_url": "https://api.github.com/users/J-A-M-E-5/orgs",
      "repos_url": "https://api.github.com/users/J-A-M-E-5/repos",
      "events_url": "https://api.github.com/users/J-A-M-E-5/events{/privacy}",
      "received_events_url": "https://api.github.com/users/J-A-M-E-5/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-27T20:42:51Z",
    "updated_at": "2022-12-27T20:42:51Z",
    "author_association": "NONE",
    "body": "I doubt there's a recommended way other than faster storage (maybe some efficient but higher-data-loss-risk RAID0 arrays with a dedicated controller?), faster CPU, more memory. I've done all these things albeit on old hardware, e.g. SATA SSD instead of NVMe.\r\n\r\nPresuming your goal is simply faster performance one thing I did for a noticeable performance boost was to turn off CPU mitigations.\r\n\r\nDon't do this if your server is used by anybody untrusting, if you run other services connected to internet, or if you run any virtual machines on it used by others, as it opens a wide and well documented security holes on your machine. But as a last resort if you can control access to your machine and do sensible things such as firewall the heck out of it, it does provide a very notable performance boost (I saw around 15% quicker for the entire sync).\r\n\r\nhttps://leochavez.org/index.php/2020/11/16/disabling-intel-and-amd-cpu-vulnerability-mitigations/",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1366170461/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1366325073",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6443#issuecomment-1366325073",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443",
    "id": 1366325073,
    "node_id": "IC_kwDOC0FsAM5RcHdR",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-28T02:40:39Z",
    "updated_at": "2022-12-28T02:43:41Z",
    "author_association": "COLLABORATOR",
    "body": "1. What doing your test? What RPC calls? Do you need serve much historical data or mostly recent data? In simple requests or in batch requests? What is more important - latency of 1 batch request or throughput of parallel users requests? Is it erigon’s built-in rpcdaemon or dedicated (with —datadir or without?)? Your Erigon has no —prune flags?\r\n2. About disk and ram - look at OS PageCache hard-misses / sec - if your test does increase it a then increasing RAM amount or Disk read latency or —db.read.concurrency may help. If not increasing - then all your hot data fit in RAM and scale CPU make more sense, or reduce —db.read.concurrency. \r\n3. To optimize Erigon you can show us next 2 pics:\r\n```\r\nadd —pprof flag \r\n\r\ngo tool pprof -alloc_objects -png  'http://127.0.0.1:6060/debug/pprof/heap?seconds=20' > mem.png\r\n\r\ngo tool pprof -png 'http://0.0.0.0:6001/debug/pprof/profile?seconds=20' > cpu.png\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1366325073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1420108051",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6443#issuecomment-1420108051",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443",
    "id": 1420108051,
    "node_id": "IC_kwDOC0FsAM5UpSET",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-02-07T02:30:46Z",
    "updated_at": "2023-02-07T02:30:46Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1420108051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429025428",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6443#issuecomment-1429025428",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6443",
    "id": 1429025428,
    "node_id": "IC_kwDOC0FsAM5VLTKU",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-02-14T02:39:34Z",
    "updated_at": "2023-02-14T02:39:34Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429025428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
