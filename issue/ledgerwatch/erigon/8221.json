{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8221",
  "id": 1899738744,
  "node_id": "I_kwDOC0FsAM5xO7Z4",
  "number": 8221,
  "title": "mdbx_env_open: cannot allocate memory",
  "user": {
    "login": "c29r3",
    "id": 52304443,
    "node_id": "MDQ6VXNlcjUyMzA0NDQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/52304443?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/c29r3",
    "html_url": "https://github.com/c29r3",
    "followers_url": "https://api.github.com/users/c29r3/followers",
    "following_url": "https://api.github.com/users/c29r3/following{/other_user}",
    "gists_url": "https://api.github.com/users/c29r3/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/c29r3/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/c29r3/subscriptions",
    "organizations_url": "https://api.github.com/users/c29r3/orgs",
    "repos_url": "https://api.github.com/users/c29r3/repos",
    "events_url": "https://api.github.com/users/c29r3/events{/privacy}",
    "received_events_url": "https://api.github.com/users/c29r3/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-17T10:41:59Z",
  "updated_at": "2023-09-19T08:25:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `./erigon --version`  \r\n`erigon version 2.49.0-stable`  \r\n\r\nOS & Version: Windows/Linux/OSX  \r\n```\r\nProcessor  : AMD Ryzen 9 7950X3D 16-Core Processor\r\nCPU cores  : 32 @ 4200.000 MHz\r\nAES-NI     : ✔ Enabled\r\nVM-x/AMD-V : ✔ Enabled\r\nRAM        : 125.5 GiB\r\nSwap       : 50.0 GiB\r\nDisk       : 10.4 TiB\r\nDistro     : Ubuntu 22.04.3 LTS\r\nKernel     : 5.15.0-83-generic\r\nVM Type    : NONE\r\nIPv4/IPv6  : ✔ Online / ✔ Online\r\n\r\n\r\nfree -h\r\n               total        used        free      shared  buff/cache   available\r\nMem:           125Gi        51Gi       1.0Gi        13Mi        73Gi        73Gi\r\nSwap:           49Gi       2.1Gi        47Gi\r\n\r\nulimit -a\r\nreal-time non-blocking time  (microseconds, -R) unlimited\r\ncore file size              (blocks, -c) 0\r\ndata seg size               (kbytes, -d) unlimited\r\nscheduling priority                 (-e) 0\r\nfile size                   (blocks, -f) unlimited\r\npending signals                     (-i) 513516\r\nmax locked memory           (kbytes, -l) 64\r\nmax memory size             (kbytes, -m) unlimited\r\nopen files                          (-n) 1048576\r\npipe size                (512 bytes, -p) 8\r\nPOSIX message queues         (bytes, -q) 819200\r\nreal-time priority                  (-r) 0\r\nstack size                  (kbytes, -s) 8192\r\ncpu time                   (seconds, -t) unlimited\r\nmax user processes                  (-u) 513516\r\nvirtual memory              (kbytes, -v) unlimited\r\nfile locks                          (-x) unlimited\r\n```\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):  \r\n```\r\nerigon \\\r\n  --datadir mainnet \\\r\n  --private.api.addr=127.0.0.1:9090 \\\r\n  --chain=mainnet \\\r\n  --port=30303 \\\r\n  --http.port=8545 \\\r\n  --torrent.port=42069 \\\r\n  --http --http.addr=127.0.0.1 \\\r\n  --ws --http.api=eth,debug,net,trace,web3,txpool,erigon \\\r\n  --metrics --metrics.addr=\"0.0.0.0\" \\\r\n  --metrics.port=\"44451\" \\\r\n  --prune htc \\\r\n  --prune.r.before=11052984 \\\r\n  --authrpc.jwtsecret=\"$HOME/erigon/mainnet/jwt.hex\"\r\n```\r\n\r\nConcensus Layer:   \r\n`Lighthouse v4.4.1-2841f60`\r\n\r\nConcensus Layer Command (with flags/config):  \r\n```\r\nlighthouse beacon_node \\\r\n--suggested-fee-recipient <ADDR> \\\r\n--datadir=\"$HOME/lighthouse\" \\\r\n--network=\"mainnet\" \\\r\n--staking \\\r\n--execution-jwt=\"$HOME/erigon/mainnet/jwt.hex\" \\\r\n--execution-endpoint=\"http://127.0.0.1:8551\" \\\r\n--http --http-address=\"127.0.0.1\" \\\r\n--http-allow-origin=\"*\" \\\r\n--metrics --metrics-address=\"0.0.0.0\" --metrics-port=\"44450\" \\\r\n--metrics-allow-origin=\"*\" \\\r\n--subscribe-all-subnets \\\r\n--import-all-attestations \\\r\n--validator-monitor-auto \\\r\n--checkpoint-sync-url=https://beaconstate.info \\\r\n--private \\\r\n--disable-upnp\r\n```\r\n\r\nChain/Network: \r\n`mainnet`\r\n\r\n#### Expected behaviour\r\n\r\n\r\n#### Actual behaviour  \r\nerigon service was restarted\r\n\r\n#### Steps to reproduce the behaviour\r\nI don't know how to reproduce this. I have a similar configuration on another server, but there were no such problems\r\n\r\n#### Backtrace\r\n\r\n````\r\nSep 17 11:27:36 erigon[66564]: [WARN] [09-17|11:27:36.515] [EngineBlockDownloader] Could create temporary mdbx err=\"mdbx_env_open: cannot allocate memory, label: inMem, trace: [kv_mdbx.go:263 util.go:49 kv_mdbx_temporary.go:38 core.go:41 asm_amd64.s:1598]\"\r\nSep 17 11:27:37 erigon[66564]: [INFO] [09-17|11:27:37.614] [EngineBlockDownloader] Downloading PoS headers... height=unknown hash=0x21e91669ace88a0539b62bdb633c68674e9cec225751a4e233304c3519896414 requestId=0\r\nSep 17 11:27:37 erigon[66564]: [WARN] [09-17|11:27:37.662] [EngineBlockDownloader] Could create temporary mdbx err=\"mdbx_env_open: cannot allocate memory, label: inMem, trace: [kv_mdbx.go:263 util.go:49 kv_mdbx_temporary.go:38 core.go:41 asm_amd64.s:1598]\"\r\nSep 17 11:27:40 erigon[66564]: [INFO] [09-17|11:27:40.671] [p2p] GoodPeers                          eth68=98 eth67=32\r\nSep 17 11:27:41 erigon[66564]: [INFO] [09-17|11:27:41.540] [txpool] stat                            pending=10000 baseFee=3515 queued=30000 alloc=6.3GB sys=10.6GB\r\nSep 17 11:27:49 erigon[66564]: [INFO] [09-17|11:27:49.824] [NewPayload] Handling new payload        height=18154578 hash=0x64ab350e777b2346119ee687b3e437826d6ed9f165552d895d22b42b87cc62f1\r\nSep 17 11:27:49 erigon[66564]: [INFO] [09-17|11:27:49.824] [EngineBlockDownloader] Downloading PoS headers... height=unknown hash=0x21e91669ace88a0539b62bdb633c68674e9cec225751a4e233304c3519896414 requestId=0\r\nSep 17 11:27:49 erigon[66564]: [WARN] [09-17|11:27:49.861] [EngineBlockDownloader] Could create temporary mdbx err=\"mdbx_env_open: cannot allocate memory, label: inMem, trace: [kv_mdbx.go:263 util.go:49 kv_mdbx_temporary.go:38 core.go:41 asm_amd64.s:1598]\"\r\nSep 17 11:27:50 erigon[66564]: [INFO] [09-17|11:27:50.936] [EngineBlockDownloader] Downloading PoS headers... height=unknown hash=0x64ab350e777b2346119ee687b3e437826d6ed9f165552d895d22b42b87cc62f1 requestId=0\r\nSep 17 11:27:50 erigon[66564]: [WARN] [09-17|11:27:50.978] [EngineBlockDownloader] Could create temporary mdbx err=\"mdbx_env_open: cannot allocate memory, label: inMem, trace: [kv_mdbx.go:263 util.go:49 kv_mdbx_temporary.go:38 core.go:41 asm_amd64.s:1598]\"\r\nSep 17 11:27:59 erigon[66564]: [INFO] [09-17|11:27:59.733] [NewPayload] Handling new payload        height=18154579 hash=0x30ebf63bcdae766bd0cba274a2d78c00eaf669124897b4fb234081c9dffab0fa\r\nSep 17 11:27:59 erigon[66564]: [INFO] [09-17|11:27:59.733] [EngineBlockDownloader] Downloading PoS headers... height=unknown hash=0x64ab350e777b2346119ee687b3e437826d6ed9f165552d895d22b42b87cc62f1 requestId=0\r\nSep 17 11:27:59 erigon[66564]: [WARN] [09-17|11:27:59.760] [EngineBlockDownloader] Could create temporary mdbx err=\"mdbx_env_open: cannot allocate memory, label: inMem, trace: [kv_mdbx.go:263 util.go:49 kv_mdbx_temporary.go:38 core.go:41 asm_amd64.s:1598]\"\r\nSep 17 11:28:00 erigon[66564]: [INFO] [09-17|11:28:00.851] [EngineBlockDownloader] Downloading PoS headers... height=unknown hash=0x30ebf63bcdae766bd0cba274a2d78c00eaf669124897b4fb234081c9dffab0fa requestId=0\r\nSep 17 11:28:00 erigon[66564]: [INFO] [09-17|11:28:00.903] [EngineBlockDownloader] Processing bodies... from=18154467 to=18154579\r\nSep 17 11:28:12 erigon[66564]: [INFO] [09-17|11:28:12.498] [EngineBlockDownloader] Processed        highest=18154579\r\nSep 17 11:28:12 erigon[66564]: [INFO] [09-17|11:28:12.498] Beginning downloaded blocks insertion\r\nSep 17 11:28:12 erigon[66564]: [INFO] [09-17|11:28:12.599] [EngineBlockDownloader] Finished downloading blocks from=18154467 to=18154579\r\nSep 17 11:28:13 erigon[66564]: [INFO] [09-17|11:28:13.212] [NewPayload] Handling new payload        height=18154580 hash=0x5739d012b112dddcb80c4e216916ca6ed9d8d9d657fed5b598d9c1532fef5a6d\r\nSep 17 11:28:13 erigon[66564]: [INFO] [09-17|11:28:13.345] [3/12 Senders] Started                   from=18154466 to=18154580\r\nSep 17 11:28:13 erigon[66564]: [INFO] [09-17|11:28:13.397] [4/12 Execution] Blocks execution        from=18154466 to=18154580\r\nSep 17 11:28:24 erigon[66564]: [INFO] [09-17|11:28:24.081] [NewPayload] Handling new payload        height=18154581 hash=0x108066c2a7dee666e5ef9614ef906cc1dacbb4b79fa116cb85795fac25041f71\r\nSep 17 11:28:24 erigon[66564]: [INFO] [09-17|11:28:24.195] [3/12 Senders] Started                   from=18154466 to=18154581\r\nSep 17 11:28:24 erigon[66564]: [INFO] [09-17|11:28:24.242] [4/12 Execution] Blocks execution        from=18154466 to=18154581\r\nSep 17 11:28:24 erigon[66564]: runtime/cgo: pthread_create failed: \t\r\nSep 17 11:28:24 erigon[66564]: SIGABRT: abort\r\nSep 17 11:28:24 erigon[66564]: PC=0x1f765e1 m=2 sigcode=18446744073709551610\r\nSep 17 11:28:24 erigon[66564]: goroutine 0 [idle]:\r\nSep 17 11:28:24 erigon[66564]: runtime: g 0: unknown pc 0x1f765e1\r\nSep 17 11:28:24 erigon[66564]: stack: frame={sp:0x7f8c44326bb0, fp:0x0} stack=[0x7f8c43b27680,0x7f8c44327280)\r\nSep 17 11:28:24 erigon[66564]: 0x00007f8c44326ab0:  0x0000000000000000  0x0000000000000000\r\n...\r\n*super long traceback*\r\n````\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1722651516",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8221#issuecomment-1722651516",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221",
    "id": 1722651516,
    "node_id": "IC_kwDOC0FsAM5mrZN8",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-18T01:40:59Z",
    "updated_at": "2023-09-18T01:40:59Z",
    "author_association": "COLLABORATOR",
    "body": "- please upgrade to 2.49.2\r\n- how much space left in datadir/tmp? \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1722651516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1722999544",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8221#issuecomment-1722999544",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221",
    "id": 1722999544,
    "node_id": "IC_kwDOC0FsAM5msuL4",
    "user": {
      "login": "c29r3",
      "id": 52304443,
      "node_id": "MDQ6VXNlcjUyMzA0NDQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/52304443?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/c29r3",
      "html_url": "https://github.com/c29r3",
      "followers_url": "https://api.github.com/users/c29r3/followers",
      "following_url": "https://api.github.com/users/c29r3/following{/other_user}",
      "gists_url": "https://api.github.com/users/c29r3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/c29r3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/c29r3/subscriptions",
      "organizations_url": "https://api.github.com/users/c29r3/orgs",
      "repos_url": "https://api.github.com/users/c29r3/repos",
      "events_url": "https://api.github.com/users/c29r3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/c29r3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-18T08:53:27Z",
    "updated_at": "2023-09-18T08:53:27Z",
    "author_association": "NONE",
    "body": "> * please upgrade to 2.49.2\r\n> * how much space left in datadir/tmp?\r\n\r\nAlready upgraded\r\n3 TB ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1722999544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1725049080",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8221#issuecomment-1725049080",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8221",
    "id": 1725049080,
    "node_id": "IC_kwDOC0FsAM5m0ij4",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-19T08:25:20Z",
    "updated_at": "2023-09-19T08:25:20Z",
    "author_association": "COLLABORATOR",
    "body": "Try set explicit —db.size.limit",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1725049080/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
