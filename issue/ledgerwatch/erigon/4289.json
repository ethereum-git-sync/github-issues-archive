{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4289",
  "id": 1251534126,
  "node_id": "I_kwDOC0FsAM5KmOUu",
  "number": 4289,
  "title": "StageSenders: to support partial progress",
  "user": {
    "login": "anonqoder",
    "id": 76815541,
    "node_id": "MDQ6VXNlcjc2ODE1NTQx",
    "avatar_url": "https://avatars.githubusercontent.com/u/76815541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/anonqoder",
    "html_url": "https://github.com/anonqoder",
    "followers_url": "https://api.github.com/users/anonqoder/followers",
    "following_url": "https://api.github.com/users/anonqoder/following{/other_user}",
    "gists_url": "https://api.github.com/users/anonqoder/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/anonqoder/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/anonqoder/subscriptions",
    "organizations_url": "https://api.github.com/users/anonqoder/orgs",
    "repos_url": "https://api.github.com/users/anonqoder/repos",
    "events_url": "https://api.github.com/users/anonqoder/events{/privacy}",
    "received_events_url": "https://api.github.com/users/anonqoder/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-05-28T08:13:18Z",
  "updated_at": "2022-07-11T15:37:21Z",
  "closed_at": "2022-07-11T15:37:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "```Build info                               git_branch=HEAD git_tag=v2022.05.08 git_commit=1d2551e0216587c213e4ca69896bbc85c3330cbb```\r\n\r\nWas running the stage ```[5/16 Senders] Recovery``` for about two hours. CPU was being heavily used, but processing speed was very slow, going at a rate of mere 60 blocks per second\r\n\r\n```\r\nMay 28 08:57:27 erigon[1665866]: [INFO] [05-28|08:57:27.370] [5/16 Senders] Recovery                 block_number=4769902\r\nMay 28 08:57:57 erigon[1665866]: [INFO] [05-28|08:57:57.371] [5/16 Senders] Recovery                  block_number=4771662\r\n```\r\n\r\nSo I tried restarting Erigon (I have a systemd service) and to my surprise it discarded everything and started again:\r\n\r\n```\r\nMay 28 09:01:41 erigon[1765905]: [INFO] [05-28|09:01:41.973] [5/16 Senders] Started                   from=0 to=14859130\r\nMay 28 09:02:11 erigon[1765905]: [INFO] [05-28|09:02:11.974] [5/16 Senders] Preload headers           block_number=8174448\r\nMay 28 09:02:41 erigon[1765905]: [INFO] [05-28|09:02:41.974] [5/16 Senders] Recovery                  block_number=170596\r\nMay 28 09:03:11 erigon[1765905]: [INFO] [05-28|09:03:11.974] [5/16 Senders] Recovery                  block_number=464895\r\nMay 28 09:03:41 erigon[1765905]: [INFO] [05-28|09:03:41.974] [5/16 Senders] Recovery                  block_number=695022\r\n```\r\n\r\nOn a side note, my server is an Intel® Core™ i7-8559U Quad Core with 32 GB RAM, NVMe 3GB/s SSD. Why am I getting such an abysmally bad performance?\r\n\r\n",
  "closed_by": {
    "login": "mandrigin",
    "id": 466427,
    "node_id": "MDQ6VXNlcjQ2NjQyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mandrigin",
    "html_url": "https://github.com/mandrigin",
    "followers_url": "https://api.github.com/users/mandrigin/followers",
    "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
    "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
    "organizations_url": "https://api.github.com/users/mandrigin/orgs",
    "repos_url": "https://api.github.com/users/mandrigin/repos",
    "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mandrigin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140379424",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4289#issuecomment-1140379424",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
    "id": 1140379424,
    "node_id": "IC_kwDOC0FsAM5D-M8g",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T05:16:51Z",
    "updated_at": "2022-05-29T05:16:51Z",
    "author_association": "COLLABORATOR",
    "body": "1. `[5/16 Senders] Recovery` is CPU bounded. Only amount of cores matters\r\n2. if you still think your speed is small you can add --pprof flag (it will print in logs how to see the profiling)\r\n3. use --syncmode=snap then you will download snapshots with already executed `[5/16 Senders] Recovery` - means this stage will not calc senders of historical blocks.\r\n4. save partial progress of this stage - maybe it can be implemented. (Problem there is: we writing to DB only sorted data, but hard to get sorted data when you work with highly-parallel processing. Maybe can handle by in-mem heap.). ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140379424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140502958",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4289#issuecomment-1140502958",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
    "id": 1140502958,
    "node_id": "IC_kwDOC0FsAM5D-rGu",
    "user": {
      "login": "anonqoder",
      "id": 76815541,
      "node_id": "MDQ6VXNlcjc2ODE1NTQx",
      "avatar_url": "https://avatars.githubusercontent.com/u/76815541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/anonqoder",
      "html_url": "https://github.com/anonqoder",
      "followers_url": "https://api.github.com/users/anonqoder/followers",
      "following_url": "https://api.github.com/users/anonqoder/following{/other_user}",
      "gists_url": "https://api.github.com/users/anonqoder/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/anonqoder/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/anonqoder/subscriptions",
      "organizations_url": "https://api.github.com/users/anonqoder/orgs",
      "repos_url": "https://api.github.com/users/anonqoder/repos",
      "events_url": "https://api.github.com/users/anonqoder/events{/privacy}",
      "received_events_url": "https://api.github.com/users/anonqoder/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T18:38:28Z",
    "updated_at": "2022-05-29T18:38:28Z",
    "author_association": "NONE",
    "body": "Thanks, what about the other stages, specially the execution one, do they support stopping and starting later?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140502958/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140595072",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4289#issuecomment-1140595072",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
    "id": 1140595072,
    "node_id": "IC_kwDOC0FsAM5D_BmA",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-30T01:44:52Z",
    "updated_at": "2022-05-30T01:44:52Z",
    "author_association": "COLLABORATOR",
    "body": "General rule: feel free to stop erigon at any time\r\nmost of them do support",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1140595072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1180109297",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4289#issuecomment-1180109297",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
    "id": 1180109297,
    "node_id": "IC_kwDOC0FsAM5GVwnx",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T08:25:19Z",
    "updated_at": "2022-07-11T08:25:19Z",
    "author_association": "COLLABORATOR",
    "body": "I think the only thing we can do here easily to support partial progress is to write in sorted batches, say every 1M of txs. But the question is, do we need that for the stage that is (A) not very long and (B) is already even shorter with BitTorrent sync.\r\n\r\nFor me it sounds like extra complexity for not a lot of gain.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1180109297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1180356090",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4289#issuecomment-1180356090",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
    "id": 1180356090,
    "node_id": "IC_kwDOC0FsAM5GWs36",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T12:35:17Z",
    "updated_at": "2022-07-11T12:35:17Z",
    "author_association": "COLLABORATOR",
    "body": "@mandrigin agree",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1180356090/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1180564420",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4289#issuecomment-1180564420",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4289",
    "id": 1180564420,
    "node_id": "IC_kwDOC0FsAM5GXfvE",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T15:37:21Z",
    "updated_at": "2022-07-11T15:37:21Z",
    "author_association": "COLLABORATOR",
    "body": "closing it then, if anything changes, we will revisit",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1180564420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
