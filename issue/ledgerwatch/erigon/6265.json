{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6265",
  "id": 1487241681,
  "node_id": "I_kwDOC0FsAM5YpYHR",
  "number": 6265,
  "title": "Memory Hog",
  "user": {
    "login": "gus4rs",
    "id": 110654587,
    "node_id": "U_kgDOBph0ew",
    "avatar_url": "https://avatars.githubusercontent.com/u/110654587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gus4rs",
    "html_url": "https://github.com/gus4rs",
    "followers_url": "https://api.github.com/users/gus4rs/followers",
    "following_url": "https://api.github.com/users/gus4rs/following{/other_user}",
    "gists_url": "https://api.github.com/users/gus4rs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gus4rs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gus4rs/subscriptions",
    "organizations_url": "https://api.github.com/users/gus4rs/orgs",
    "repos_url": "https://api.github.com/users/gus4rs/repos",
    "events_url": "https://api.github.com/users/gus4rs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gus4rs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-12-09T18:36:48Z",
  "updated_at": "2022-12-24T14:35:06Z",
  "closed_at": "2022-12-24T14:35:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Erigon version: 2.31.0-stable-a53e8a3e\r\n\r\nErigon has been eating a lot of memory since the last two releases:\r\n\r\n```\r\n PID       USER    RES   RSan   SHR   SWAP  %CPU  %MEM     TIME+         COMMAND\r\n261960 erigon   11.1g   7.0g   4.0g      0         61.2      35.4       401:12.23   /usr/local/bin/erigon \r\n```\r\n\r\nThe top command shows It is eating ```7g``` of resident anonymous memory and ```4g``` of shareable memory (can be freed if needed)\r\n\r\nIs there any configuration to limit this? The memory keeps growing and eventually the process is killed by the Linux OOM killer  \r\n\r\n \r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1344915892",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6265#issuecomment-1344915892",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265",
    "id": 1344915892,
    "node_id": "IC_kwDOC0FsAM5QKcm0",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-10T00:07:00Z",
    "updated_at": "2022-12-10T00:07:00Z",
    "author_association": "COLLABORATOR",
    "body": "no total limit, but can try reduce some defaults\r\n1. --batchSize=8mb\r\n2. `--torrent.conns.perfile=4`\r\n3. GOGC=50 GOMEMLIMIT=6000MiB https://tip.golang.org/doc/gc-guide\r\n\r\nAlso you can: \r\nadd flag `--pprof`\r\n`go tool pprof -inuse_space -png http://127.0.0.1:6060/debug/pprof/heap > mem.png`\r\n\r\nOptionally: \r\n--txpool.disable",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1344915892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1345156816",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6265#issuecomment-1345156816",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265",
    "id": 1345156816,
    "node_id": "IC_kwDOC0FsAM5QLXbQ",
    "user": {
      "login": "gus4rs",
      "id": 110654587,
      "node_id": "U_kgDOBph0ew",
      "avatar_url": "https://avatars.githubusercontent.com/u/110654587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gus4rs",
      "html_url": "https://github.com/gus4rs",
      "followers_url": "https://api.github.com/users/gus4rs/followers",
      "following_url": "https://api.github.com/users/gus4rs/following{/other_user}",
      "gists_url": "https://api.github.com/users/gus4rs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gus4rs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gus4rs/subscriptions",
      "organizations_url": "https://api.github.com/users/gus4rs/orgs",
      "repos_url": "https://api.github.com/users/gus4rs/repos",
      "events_url": "https://api.github.com/users/gus4rs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gus4rs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-10T06:43:51Z",
    "updated_at": "2022-12-10T06:43:51Z",
    "author_association": "NONE",
    "body": "Thanks, will git it a try. But\r\n```\r\n--txpool.disable\r\n```\r\n\r\nIs a no go for staking, correct?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1345156816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1345248875",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6265#issuecomment-1345248875",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265",
    "id": 1345248875,
    "node_id": "IC_kwDOC0FsAM5QLt5r",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-10T11:59:37Z",
    "updated_at": "2022-12-10T11:59:37Z",
    "author_association": "COLLABORATOR",
    "body": "Correct",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1345248875/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1348688880",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6265#issuecomment-1348688880",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6265",
    "id": 1348688880,
    "node_id": "IC_kwDOC0FsAM5QY1vw",
    "user": {
      "login": "alysak6075",
      "id": 9685425,
      "node_id": "MDQ6VXNlcjk2ODU0MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9685425?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alysak6075",
      "html_url": "https://github.com/alysak6075",
      "followers_url": "https://api.github.com/users/alysak6075/followers",
      "following_url": "https://api.github.com/users/alysak6075/following{/other_user}",
      "gists_url": "https://api.github.com/users/alysak6075/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alysak6075/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alysak6075/subscriptions",
      "organizations_url": "https://api.github.com/users/alysak6075/orgs",
      "repos_url": "https://api.github.com/users/alysak6075/repos",
      "events_url": "https://api.github.com/users/alysak6075/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alysak6075/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-13T14:30:51Z",
    "updated_at": "2022-12-13T14:30:51Z",
    "author_association": "NONE",
    "body": "Steps 1 & 3 stopped the node from crashing/being unresponsive during initial sync. Thank You!",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1348688880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
