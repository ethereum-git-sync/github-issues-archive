{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/3173",
  "id": 1088823693,
  "node_id": "I_kwDOC0FsAM5A5iGN",
  "number": 3173,
  "title": "RPC Daemon panic on eth_getBlockByNumber",
  "user": {
    "login": "splix",
    "id": 48364,
    "node_id": "MDQ6VXNlcjQ4MzY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/48364?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/splix",
    "html_url": "https://github.com/splix",
    "followers_url": "https://api.github.com/users/splix/followers",
    "following_url": "https://api.github.com/users/splix/following{/other_user}",
    "gists_url": "https://api.github.com/users/splix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/splix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/splix/subscriptions",
    "organizations_url": "https://api.github.com/users/splix/orgs",
    "repos_url": "https://api.github.com/users/splix/repos",
    "events_url": "https://api.github.com/users/splix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/splix/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-12-26T18:38:31Z",
  "updated_at": "2022-05-27T04:46:13Z",
  "closed_at": "2022-05-27T04:46:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "RPC Daemon stopped to work for _some block numbers_. May be caused by db corruption, though no other evidences of db corruption.\r\n\r\n#### System information\r\n\r\nerigon version 2021.12.3-beta\r\nDebian\r\n\r\n#### Expected behaviour\r\n\r\nReturn JSON for block or error\r\n\r\n#### Actual behaviour\r\n\r\nRPC Daemon panic\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRequest `{\"jsonrpc\":\"2.0\", \"method\":\"eth_getBlockByNumber\", \"id\":1, \"params\":[\"0xc9ef50\", false]}`\r\nOnce the daemon receives the request it immediately panics.\r\n\r\nNOTE: happens only for some blocks, for other block numbers it works fine\r\n\r\n#### Backtrace\r\n\r\n````\r\nfatal error: unexpected signal during runtime execution\r\n[signal SIGBUS: bus error code=0x2 addr=0x7d73e752e010 pc=0x440e57]\r\n\r\nruntime stack:\r\nruntime.throw(0x11e1a0c, 0x2a)\r\n\truntime/panic.go:1117 +0x72\r\nruntime.sigpanic()\r\n\truntime/signal_unix.go:718 +0x2e5\r\n\r\ngoroutine 117 [syscall]:\r\nruntime.cgocall(0xe0f840, 0xc00054ee80, 0xe0f700)\r\n\truntime/cgocall.go:154 +0x5b fp=0xc00054ee50 sp=0xc00054ee18 pc=0x44d37b\r\ngithub.com/torquem-ch/mdbx-go/mdbx._Cfunc_mdbxgo_cursor_get1(0x7f1e50002870, 0xc000678090, 0x28, 0xc000073f90, 0xc000073fb0, 0xf, 0x7f1e00000000)\r\n\t_cgo_gotypes.go:966 +0x48 fp=0xc00054ee80 sp=0xc00054ee50 pc=0x991608\r\ngithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).getVal1.func1(0xc000073ff0, 0xc000678090, 0x28, 0x28, 0xf, 0xc00054efb8)\r\n\tgithub.com/torquem-ch/mdbx-go@v0.22.2/mdbx/cursor.go:195 +0xf9 fp=0xc00054eee0 sp=0xc00054ee80 pc=0x999db9\r\ngithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).getVal1(0xc000073ff0, 0xc000678090, 0x28, 0x28, 0xf, 0x0, 0x5)\r\n\tgithub.com/torquem-ch/mdbx-go@v0.22.2/mdbx/cursor.go:195 +0x57 fp=0xc00054ef30 sp=0xc00054eee0 pc=0x992cf7\r\ngithub.com/torquem-ch/mdbx-go/mdbx.(*Cursor).Get(0xc000073ff0, 0xc000678090, 0x28, 0x28, 0x0, 0x0, 0x0, 0xf, 0x202fb2087676eb58, 0x0, ...)\r\n\tgithub.com/torquem-ch/mdbx-go@v0.22.2/mdbx/cursor.go:142 +0x86 fp=0xc00054efb0 sp=0xc00054ef30 pc=0x992766\r\ngithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxCursor).set(...)\r\n\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20211217093552-7d82c6ac76e6/kv/mdbx/kv_mdbx.go:1017\r\ngithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxCursor).SeekExact(0xc000638540, 0xc000678090, 0x28, 0x28, 0xc000638540, 0x0, 0x0, 0xc000678098, 0xc00054f130, 0x20, ...)\r\n\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20211217093552-7d82c6ac76e6/kv/mdbx/kv_mdbx.go:1381 +0x3b6 fp=0xc00054f0b8 sp=0xc00054efb0 pc=0x9a6a36\r\ngithub.com/ledgerwatch/erigon-lib/kv/mdbx.(*MdbxTx).GetOne(0xc000597a10, 0x11bd3a8, 0x9, 0xc000678090, 0x28, 0x28, 0x28, 0x28, 0xc00054f258, 0xa66a2a, ...)\r\n\tgithub.com/ledgerwatch/erigon-lib@v0.0.0-20211217093552-7d82c6ac76e6/kv/mdbx/kv_mdbx.go:873 +0xc4 fp=0xc00054f128 sp=0xc00054f0b8 pc=0x9a1a84\r\ngithub.com/ledgerwatch/erigon/core/rawdb.ReadStorageBodyRLP(0x7f1e5c255238, 0xc000597a10, 0x1bd8238282b002b6, 0x23f6a883888dfb5f, 0xb1f79ac13432b687, 0x81223da7a0f8561c, 0xc9ef50, 0x121d0c8, 0xc00054f290, 0x4c6625)\r\n\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:255 +0xa7 fp=0xc00054f1c8 sp=0xc00054f128 pc=0xc08087\r\ngithub.com/ledgerwatch/erigon/core/rawdb.ReadBody(0x7f1e5c255238, 0xc000597a10, 0x1bd8238282b002b6, 0x23f6a883888dfb5f, 0xb1f79ac13432b687, 0x81223da7a0f8561c, 0xc9ef50, 0x0, 0x0, 0xc9ef50)\r\n\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:416 +0x74 fp=0xc00054f2b8 sp=0xc00054f1c8 pc=0xc08b34\r\ngithub.com/ledgerwatch/erigon/core/rawdb.ReadBodyWithTransactions(0x7f1e5c255238, 0xc000597a10, 0x1bd8238282b002b6, 0x23f6a883888dfb5f, 0xb1f79ac13432b687, 0x81223da7a0f8561c, 0xc9ef50, 0xc00051a780)\r\n\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:364 +0x74 fp=0xc00054f3c0 sp=0xc00054f2b8 pc=0xc08814\r\ngithub.com/ledgerwatch/erigon/core/rawdb.ReadBlock(0x7f1e5c255238, 0xc000597a10, 0x1bd8238282b002b6, 0x23f6a883888dfb5f, 0xb1f79ac13432b687, 0x81223da7a0f8561c, 0xc9ef50, 0x112f140)\r\n\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:757 +0xba fp=0xc00054f438 sp=0xc00054f3c0 pc=0xc0a09a\r\ngithub.com/ledgerwatch/erigon/core/rawdb.ReadBlockWithSenders(0x133a638, 0xc000597a10, 0x1bd8238282b002b6, 0x23f6a883888dfb5f, 0xb1f79ac13432b687, 0x81223da7a0f8561c, 0xc9ef50, 0xc000696250, 0x8, 0x8, ...)\r\n\tgithub.com/ledgerwatch/erigon/core/rawdb/accessors_chain.go:773 +0x98 fp=0xc00054f4c8 sp=0xc00054f438 pc=0xc0a1f8\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*BaseAPI).blockWithSenders(0xc00010e820, 0x133a638, 0xc000597a10, 0x1bd8238282b002b6, 0x23f6a883888dfb5f, 0xb1f79ac13432b687, 0x81223da7a0f8561c, 0xc9ef50, 0x0, 0x0, ...)\r\n\tgithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/eth_api.go:163 +0x8b fp=0xc00054f590 sp=0xc00054f4c8 pc=0xddf96b\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*BaseAPI).blockByNumberWithSenders(0xc00010e820, 0x133a638, 0xc000597a10, 0xc9ef50, 0x0, 0x0, 0x121c8a8)\r\n\tgithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/eth_api.go:143 +0x136 fp=0xc00054f638 sp=0xc00054f590 pc=0xddf696\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*BaseAPI).blockByRPCNumber(0xc00010e820, 0xc9ef50, 0x133a638, 0xc000597a10, 0xc000597a10, 0x0, 0x0)\r\n\tgithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/eth_api.go:215 +0x9e fp=0xc00054f680 sp=0xc00054f638 pc=0xddff7e\r\ngithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands.(*APIImpl).GetBlockByNumber(0xc00010e8c0, 0x132ec98, 0xc0006741c0, 0xc9ef50, 0x0, 0x0, 0x0, 0x0)\r\n\tgithub.com/ledgerwatch/erigon/cmd/rpcdaemon/commands/eth_block.go:181 +0x108 fp=0xc00054f8d0 sp=0xc00054f680 pc=0xde3048\r\nruntime.call64(0xc000597950, 0xc000110340, 0xc000674200, 0x2800000040)\r\n\truntime/asm_amd64.s:552 +0x3e fp=0xc00054f920 sp=0xc00054f8d0 pc=0x4ba47e\r\nreflect.Value.call(0xc00011e900, 0xc000110340, 0x13, 0x11b818d, 0x4, 0xc000638420, 0x4, 0x4, 0xc000638450, 0xc0005978f0, ...)\r\n\treflect/value.go:476 +0x8e7 fp=0xc00054fb28 sp=0xc00054f920 pc=0x528c07\r\nreflect.Value.Call(0xc00011e900, 0xc000110340, 0x13, 0xc000638420, 0x4, 0x4, 0x1038340, 0x13003b0, 0x0)\r\n\treflect/value.go:337 +0xb9 fp=0xc00054fba8 sp=0xc00054fb28 pc=0x5280d9\r\ngithub.com/ledgerwatch/erigon/rpc.(*callback).call(0xc000505080, 0x132ec98, 0xc0006741c0, 0xc00003a3c0, 0x14, 0xc0005978f0, 0x2, 0x2, 0xc0006383c0, 0x0, ...)\r\n\tgithub.com/ledgerwatch/erigon/rpc/service.go:226 +0x392 fp=0xc00054fcd8 sp=0xc00054fba8 pc=0xa41bb2\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).runMethod(0xc0001245a0, 0x132ec98, 0xc0006741c0, 0xc0000ec2a0, 0xc000505080, 0xc0005978f0, 0x2, 0x2, 0xc0006383c0, 0x0)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:484 +0xb2c fp=0xc00054fd90 sp=0xc00054fcd8 pc=0xa3b72c\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleCall(0xc0001245a0, 0xc000597890, 0xc0000ec2a0, 0xc0006383c0, 0x60)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:389 +0x25f fp=0xc00054fe48 sp=0xc00054fd90 pc=0xa3a05f\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleCallMsg(0xc0001245a0, 0xc000597890, 0xc0000ec2a0, 0xc0006383c0, 0x28)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:343 +0x1a5 fp=0xc00054fed0 sp=0xc00054fe48 pc=0xa39305\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).handleMsg.func1(0xc000597890)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:181 +0x132 fp=0xc00054ff68 sp=0xc00054fed0 pc=0xa46fd2\r\ngithub.com/ledgerwatch/erigon/rpc.(*handler).startCallProc.func1(0xc0001245a0, 0xc000634360)\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:271 +0xd2 fp=0xc00054ffd0 sp=0xc00054ff68 pc=0xa47272\r\nruntime.goexit()\r\n\truntime/asm_amd64.s:1371 +0x1 fp=0xc00054ffd8 sp=0xc00054ffd0 pc=0x4bbda1\r\ncreated by github.com/ledgerwatch/erigon/rpc.(*handler).startCallProc\r\n\tgithub.com/ledgerwatch/erigon/rpc/handler.go:267 +0x66\r\n````\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139272482",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/3173#issuecomment-1139272482",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/3173",
    "id": 1139272482,
    "node_id": "IC_kwDOC0FsAM5D5-si",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T04:46:13Z",
    "updated_at": "2022-05-27T04:46:13Z",
    "author_association": "COLLABORATOR",
    "body": "optimistically closing. if it's still an issue - feel free to reopen",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1139272482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
