{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8406",
  "id": 1932195058,
  "node_id": "I_kwDOC0FsAM5zKvTy",
  "number": 8406,
  "title": "polygon bor-mainnet panic: runtime error: invalid memory address or nil pointer dereference v2.51.0",
  "user": {
    "login": "cheneyweb",
    "id": 24515746,
    "node_id": "MDQ6VXNlcjI0NTE1NzQ2",
    "avatar_url": "https://avatars.githubusercontent.com/u/24515746?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cheneyweb",
    "html_url": "https://github.com/cheneyweb",
    "followers_url": "https://api.github.com/users/cheneyweb/followers",
    "following_url": "https://api.github.com/users/cheneyweb/following{/other_user}",
    "gists_url": "https://api.github.com/users/cheneyweb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cheneyweb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cheneyweb/subscriptions",
    "organizations_url": "https://api.github.com/users/cheneyweb/orgs",
    "repos_url": "https://api.github.com/users/cheneyweb/repos",
    "events_url": "https://api.github.com/users/cheneyweb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cheneyweb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-10-09T02:16:59Z",
  "updated_at": "2023-10-11T02:07:59Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2.51.0-a0160bee\r\n\r\nOS & Version: AlmaLinux v9.2\r\n\r\nCommit hash: \r\n\r\nErigon Command (with flags/config):\r\n\r\n/root/erigon-stable/build/bin/erigon --datadir=/mnt/backup/polygon \\\r\n--ethash.dagdir=/mnt/backup/polygon/ethash \\\r\n--chain=bor-mainnet \\\r\n--port=20303 \\\r\n--http.addr=0.0.0.0 \\\r\n--http.port=28545 \\\r\n--authrpc.port=28551 \\\r\n--torrent.port=22069 \\\r\n--p2p.allowed-ports=20303,20304,20305,20306,20307 \\\r\n--private.api.addr=127.0.0.1:29090 \\\r\n--bor.heimdall=https://heimdall-api.polygon.technology \\\r\n--http \\\r\n--http.api=eth,debug,net,trace,web3,erigon,bor,txpool \\\r\n--db.size.limit=10TB \\\r\n--db.pagesize=16KB\r\n\r\nConcensus Layer:\r\nhttps://heimdall-api.polygon.technology\r\n\r\nConcensus Layer Command (with flags/config):\r\n\r\nChain/Network: \r\nbor-mainnet\r\n\r\n#### Expected behaviour\r\nnormal startup\r\n\r\n#### Actual behaviour\r\n\r\nWhen I upgraded from 2.49.3 to 2.51.0 it wouldn't start up!\r\n\r\nI've tried deleting the txpool folder, but it doesn't work\r\n\r\nWhat should I do for it?\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\n3|erigon-polygon  | [INFO] [10-09|10:08:18.518] logging to file system                   log dir=/mnt/backup/polygon/logs file prefix=erigon log level=info json=false\r\n3|erigon-polygon  | [INFO] [10-09|10:08:18.518] Build info                               git_branch=release/2.51 git_tag=v2.51.0 git_commit=a0160beee4032491501d89c5347bb1c4710ee6cc\r\n3|erigon-polygon  | [INFO] [10-09|10:08:18.518] Starting Erigon on Bor Mainnet...\r\n3|erigon-polygon  | [INFO] [10-09|10:08:18.518] Maximum peer count                       ETH=100 total=100\r\n3|erigon-polygon  | [INFO] [10-09|10:08:18.518] starting HTTP APIs                       APIs=eth,debug,net,trace,web3,erigon,bor,txpool\r\n3|erigon-polygon  | [INFO] [10-09|10:08:18.519] torrent verbosity                        level=WRN\r\n3|erigon-polygon  | [INFO] [10-09|10:08:20.621] Set global gas cap                       cap=50000000\r\n3|erigon-polygon  | [INFO] [10-09|10:08:20.622] [Downloader] Runnning with               ipv6-enabled=true ipv4-enabled=true download.rate=16mb upload.rate=4mb\r\n3|erigon-polygon  | [INFO] [10-09|10:08:20.622] Opening Database                         label=chaindata path=/mnt/backup/polygon/chaindata\r\n3|erigon-polygon  | [INFO] [10-09|10:08:21.972] Initialised chain configuration          config=\"{ChainID: 137, Homestead: 0, DAO: <nil>, Tangerine Whistle: 0, Spurious Dragon: 0, Byzantium: 0, Constantinople: 0, Petersburg: 0, Istanbul: 3395000, Muir Glacier: 3395000, Berlin: 14750000, London: 23850000, Arrow Glacier: <nil>, Gray Glacier: <nil>, Terminal Total Difficulty: <nil>, Merge Netsplit: <nil>, Shanghai: <nil>, Cancun: <nil>, Prague: <nil>, Engine: bor}\" genesis=0xa9c28ce2141b56c474f1dc504bee9b01eb1bd7d1a507580d5519d4437a97de1b\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.416] Initialising Ethereum protocol           network=137\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.416] Opening Database                         label=bor path=/mnt/backup/polygon/bor\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.615] Starting private RPC server              on=127.0.0.1:29090\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.615] new subscription to logs established\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.615] rpc filters: subscribing to Erigon events\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.615] New txs subscriber joined\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.615] new subscription to newHeaders established\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.615] Reading JWT secret                       path=/mnt/backup/polygon/jwt.hex\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.616] HTTP endpoint opened for Engine API      url=127.0.0.1:28551 ws=true ws.compression=true\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.616] HTTP endpoint opened                     url=[::]:28545 ws=false ws.compression=true grpc=false\r\n3|erigon-polygon  | [WARN] [10-09|10:08:43.616] NAT ExternalIP resolution has failed, try to pass a different --nat option err=\"no UPnP or NAT-PMP router discovered\"\r\n3|erigon-polygon  | [WARN] [10-09|10:08:43.616] NAT ExternalIP resolution has failed, try to pass a different --nat option err=\"no UPnP or NAT-PMP router discovered\"\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.619] Started P2P networking                   version=67 self=enode://ea701a505e25af0929d42bf4fea1a37fd88333ab9c55dce3ca53bfa78fe3121f5e01b618321a01d17456a409c99b142124c81fc58e6e87e341006bc0f9039e69@127.0.0.1:0 name=erigon/v2.51.0-a0160bee/linux-amd64/go1.20.6\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.619] Started P2P networking                   version=68 self=enode://ea701a505e25af0929d42bf4fea1a37fd88333ab9c55dce3ca53bfa78fe3121f5e01b618321a01d17456a409c99b142124c81fc58e6e87e341006bc0f9039e69@127.0.0.1:0 name=erigon/v2.51.0-a0160bee/linux-amd64/go1.20.6\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.626] [txpool] Started\r\n3|erigon-polygon  | [INFO] [10-09|10:08:43.635] [1/15 Snapshots] Fetching torrent files metadata\r\n3|erigon-polygon  | [INFO] [10-09|10:08:44.659] Got new checkpoint from heimdall         start=48492198 end=48493477 rootHash=0xe7de6c2be7326f5a60d64fe7d15bceaf978fd05dbf71a8746989f6c5e0bc323f\r\n3|erigon-polygon  | panic: runtime error: invalid memory address or nil pointer dereference\r\n3|erigon-polygon  | [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xf57a78]\r\n3|erigon-polygon  | goroutine 9480 [running]:\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/core/types.(*Block).Hash(0xc0a215e120?)\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/core/types/block.go:1669 +0x38\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/eth/borfinality.borVerify({0x2f922f0?, 0xc0e33628d0?}, 0xc0e463a380, 0x2e3eea6, 0x2e3f3a5, {0xc0064ca0f2, 0x40}, 0x1)\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/bor_checkpoint_verifier.go:143 +0xb38\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/eth/borfinality.fetchWhitelistCheckpoint({0x2f922f0, 0xc0e33628d0}, {0x2fa4948?, 0xc0d82eb4a0?}, 0xc0064c9e48, 0xc0e463a380)\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/whitelist_helpers.go:45 +0x57c\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/eth/borfinality.handleWhitelistCheckpoint({0x2f922f0?, 0xc0e33628d0?}, {0x2fa4948?, 0xc0d82eb4a0?}, 0x0?)\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/whitelist.go:152 +0x75\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/eth/borfinality.retryHeimdallHandler(0x2c71e00, 0xc0e463a380, 0x0?, 0x0?, {0x285fd81, 0x14})\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/whitelist.go:118 +0xdb\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/eth/borfinality.RetryHeimdallHandler(...)\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/whitelist.go:100\r\n3|erigon-polygon  | github.com/ledgerwatch/erigon/eth/borfinality.startCheckpointWhitelistService(0x0?)\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/whitelist.go:65 +0x45\r\n3|erigon-polygon  | created by github.com/ledgerwatch/erigon/eth/borfinality.Whitelist\r\n3|erigon-polygon  | \tgithub.com/ledgerwatch/erigon/eth/borfinality/whitelist.go:46 +0x225\r\n````\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1756619949",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8406#issuecomment-1756619949",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8406",
    "id": 1756619949,
    "node_id": "IC_kwDOC0FsAM5os-St",
    "user": {
      "login": "cheneyweb",
      "id": 24515746,
      "node_id": "MDQ6VXNlcjI0NTE1NzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/24515746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cheneyweb",
      "html_url": "https://github.com/cheneyweb",
      "followers_url": "https://api.github.com/users/cheneyweb/followers",
      "following_url": "https://api.github.com/users/cheneyweb/following{/other_user}",
      "gists_url": "https://api.github.com/users/cheneyweb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cheneyweb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cheneyweb/subscriptions",
      "organizations_url": "https://api.github.com/users/cheneyweb/orgs",
      "repos_url": "https://api.github.com/users/cheneyweb/repos",
      "events_url": "https://api.github.com/users/cheneyweb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cheneyweb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T02:05:28Z",
    "updated_at": "2023-10-11T02:05:28Z",
    "author_association": "NONE",
    "body": "When I updated to 2.52.0, the error message changed to the following (and the last version that worked was 2.49.3):\r\n\r\n13|erigon- | [INFO] [10-11|09:49:03.330] logging to file system                   log dir=/mnt/backup/polygon/logs file prefix=erigon log level=info json=false\r\n13|erigon- | [INFO] [10-11|09:49:03.330] Build info                               git_branch=release/2.52 git_tag=v2.52.0 git_commit=761af94b2296d6fd4a5cd6f11666837d5841a2b6\r\n13|erigon- | [INFO] [10-11|09:49:03.330] Starting Erigon on Bor Mainnet...\r\n13|erigon- | [INFO] [10-11|09:49:03.331] Maximum peer count                       ETH=100 total=100\r\n13|erigon- | [INFO] [10-11|09:49:03.331] starting HTTP APIs                       APIs=eth,debug,net,trace,web3,erigon,bor,txpool\r\n13|erigon- | [INFO] [10-11|09:49:03.331] torrent verbosity                        level=WRN\r\n13|erigon- | [INFO] [10-11|09:49:05.433] Set global gas cap                       cap=50000000\r\n13|erigon- | [INFO] [10-11|09:49:05.434] [Downloader] Runnning with               ipv6-enabled=true ipv4-enabled=true download.rate=16mb upload.rate=4mb\r\n13|erigon- | [INFO] [10-11|09:49:05.434] Opening Database                         label=chaindata path=/mnt/backup/polygon/chaindata\r\n13|erigon- | [INFO] [10-11|09:49:06.776] Initialised chain configuration          config=\"{ChainID: 137, Homestead: 0, DAO: <nil>, Tangerine Whistle: 0, Spurious Dragon: 0, Byzantium: 0, Constantinople: 0, Petersburg: 0, Istanbul: 3395000, Muir Glacier: 3395000, Berlin: 14750000, London: 23850000, Arrow Glacier: <nil>, Gray Glacier: <nil>, Terminal Total Difficulty: <nil>, Merge Netsplit: <nil>, Shanghai: <nil>, Cancun: <nil>, Prague: <nil>, Engine: bor}\" genesis=0xa9c28ce2141b56c474f1dc504bee9b01eb1bd7d1a507580d5519d4437a97de1b\r\n13|erigon- | [EROR] [10-11|09:49:06.778] Erigon startup                           err=\"openClient: torrentcfg.openClient: mdbx_env_open: MDBX_CORRUPTED: Maybe free space is over on disk. Otherwise it's hardware failure. Before creating issue please use tools like https://www.memtest86.com to test RAM and tools like https://www.smartmontools.org to test Disk. To handle hardware risks: use ECC RAM, use RAID of disks, run multiple application instances (or do backups). If hardware checks passed - check FS settings - 'fsync' and 'flock' must be enabled.  Otherwise - please create issue in Application repo. On default DURABLE mode, power outage can't cause this error. On other modes - power outage may break last transaction and mdbx_chk can recover db in this case, see '-t' and '-0|1|2' options., label: downloader, trace: [kv_mdbx.go:267 downloader.go:640 downloader.go:94 backend.go:1119 backend.go:323 node.go:122 main.go:80 make_app.go:43 command.go:274 app.go:332 app.go:309 main.go:41 proc.go:250 asm_amd64.s:1598]\"\r\n13|erigon- | openClient: torrentcfg.openClient: mdbx_env_open: MDBX_CORRUPTED: Maybe free space is over on disk. Otherwise it's hardware failure. Before creating issue please use tools like https://www.memtest86.com to test RAM and tools like https://www.smartmontools.org to test Disk. To handle hardware risks: use ECC RAM, use RAID of disks, run multiple application instances (or do backups). If hardware checks passed - check FS settings - 'fsync' and 'flock' must be enabled.  Otherwise - please create issue in Application repo. On default DURABLE mode, power outage can't cause this error. On other modes - power outage may break last transaction and mdbx_chk can recover db in this case, see '-t' and '-0|1|2' options., label: downloader, trace: [kv_mdbx.go:267 downloader.go:640 downloader.go:94 backend.go:1119 backend.go:323 node.go:122 main.go:80 make_app.go:43 command.go:274 app.go:332 app.go:309 main.go:41 proc.go:250 asm_amd64.s:1598] ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1756619949/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
