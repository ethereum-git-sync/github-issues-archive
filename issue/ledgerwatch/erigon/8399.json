{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/8399",
  "id": 1931243310,
  "node_id": "I_kwDOC0FsAM5zHG8u",
  "number": 8399,
  "title": "Synchronization issues when upgrading polygon to v2.51.0",
  "user": {
    "login": "rayn316",
    "id": 24621599,
    "node_id": "MDQ6VXNlcjI0NjIxNTk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/24621599?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rayn316",
    "html_url": "https://github.com/rayn316",
    "followers_url": "https://api.github.com/users/rayn316/followers",
    "following_url": "https://api.github.com/users/rayn316/following{/other_user}",
    "gists_url": "https://api.github.com/users/rayn316/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rayn316/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rayn316/subscriptions",
    "organizations_url": "https://api.github.com/users/rayn316/orgs",
    "repos_url": "https://api.github.com/users/rayn316/repos",
    "events_url": "https://api.github.com/users/rayn316/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rayn316/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-10-07T07:49:00Z",
  "updated_at": "2023-10-07T08:20:44Z",
  "closed_at": "2023-10-07T08:20:44Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\nErigon version:v2.51.0\r\nOS & Version: Linux\r\nCommit hash: \r\nErigon Command (with flags/config):\r\nConcensus Layer:\r\nConcensus Layer Command (with flags/config):\r\nChain/Network: \r\n\r\n#### Expected behaviour\r\nSynchronize as before, step 2 -> step 5 -> step 7 after reboot\r\n\r\n#### Actual behaviour\r\nStart synchronization step 3 and display block height from the beginning\r\n\r\n#### Steps to reproduce the behaviour\r\nUpgrade from version 2.48.1 to version 2.51.0, then restart the node (regardless of whether heimdall is upgraded or not)\r\n\r\n#### Backtrace\r\n\r\n````\r\nOct 07 15:36:56 erigon[3817428]: [INFO] [10-07|15:36:56.287] Got new checkpoint from heimdall         start=48424870 end=48425381 rootHash=0xc3fe80c31165303eb475a84c363d12264bbcdb31faa4fe0b7728ada7b5a6d41c\r\nOct 07 15:36:56 erigon[3817428]: [WARN] [10-07|15:36:56.287] Failed to whitelist checkpoint           err=\"missing blocks\"\r\nOct 07 15:36:56 erigon[3817428]: [WARN] [10-07|15:36:56.287] unable to start the whitelist checkpoint service - first run err=\"missing blocks\"\r\nOct 07 15:36:56 erigon[3817428]: [WARN] [10-07|15:36:56.289] an error while trying fetching from Heimdall path=/milestone/latest attempt=1 error=\"error while fetching data from Heimdall: http://de-heimdall.blockpi.me:2086/milestone/latest:response code 404\"\r\nOct 07 15:36:56 erigon[3817428]: [INFO] [10-07|15:36:56.289] Retrying again in 5 seconds to fetch data from Heimdall path=/milestone/latest attempt=1\r\nOct 07 15:36:56 erigon[3817428]: [WARN] [10-07|15:36:56.290] an error while trying fetching from Heimdall path=/milestone/lastNoAck attempt=1 error=\"error while fetching data from Heimdall: http://de-heimdall.blockpi.me:2086/milestone/lastNoAck:response code 404\"\r\nOct 07 15:36:56 erigon[3817428]: [INFO] [10-07|15:36:56.290] Retrying again in 5 seconds to fetch data from Heimdall path=/milestone/lastNoAck attempt=1\r\nOct 07 15:36:56 erigon[3817428]: [INFO] [10-07|15:36:56.892] Span with given block number is not loaded fetching span=7567\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.273] Stored proposer snapshot to disk         number=48427008 hash=0x948faf4a1e00c99fdfae2aa511b92f1a5caf4f842080b68cd97b01dfe9ac7c15\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.319] [2/15 Headers] Processed                 highest inserted=48427135 age=6s\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.320] [3/15 BorHeimdall] Fetching span         id=0\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.357] [3/15 BorHeimdall] Fetching state updates from Heimdall fromID=1 to=2020-05-30T15:47:16+08:00\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.402] [3/15 BorHeimdall] StateSyncData         number=64 lastEventID=0 total records=0 fetch time=45.258499ms process time=349ns\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.403] [3/15 BorHeimdall] Fetching state updates from Heimdall fromID=1 to=2020-05-31T00:32:10+08:00\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.461] [3/15 BorHeimdall] StateSyncData         number=128 lastEventID=0 total records=0 fetch time=58.33968ms process time=237ns\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.462] [3/15 BorHeimdall] Fetching state updates from Heimdall fromID=1 to=2020-05-31T00:34:22+08:00\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.502] [3/15 BorHeimdall] StateSyncData         number=192 lastEventID=0 total records=0 fetch time=39.965024ms process time=309ns\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.503] [3/15 BorHeimdall] Fetching state updates from Heimdall fromID=1 to=2020-05-31T00:36:34+08:00\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.548] [3/15 BorHeimdall] StateSyncData         number=256 lastEventID=0 total records=0 fetch time=45.030996ms process time=283ns\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.548] [3/15 BorHeimdall] Fetching span         id=1\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.584] [3/15 BorHeimdall] Fetching state updates from Heimdall fromID=1 to=2020-05-31T00:38:46+08:00\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.627] [3/15 BorHeimdall] StateSyncData         number=320 lastEventID=0 total records=0 fetch time=42.823274ms process time=276ns\r\nOct 07 15:36:57 erigon[3817428]: [INFO] [10-07|15:36:57.628] [3/15 BorHeimdall] Fetching state updates from Heimdall fromID=1 to=2020-05-31T00:40:58+08:00\r\n````\r\n",
  "closed_by": {
    "login": "rayn316",
    "id": 24621599,
    "node_id": "MDQ6VXNlcjI0NjIxNTk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/24621599?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rayn316",
    "html_url": "https://github.com/rayn316",
    "followers_url": "https://api.github.com/users/rayn316/followers",
    "following_url": "https://api.github.com/users/rayn316/following{/other_user}",
    "gists_url": "https://api.github.com/users/rayn316/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rayn316/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rayn316/subscriptions",
    "organizations_url": "https://api.github.com/users/rayn316/orgs",
    "repos_url": "https://api.github.com/users/rayn316/repos",
    "events_url": "https://api.github.com/users/rayn316/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rayn316/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751645173",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8399#issuecomment-1751645173",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399",
    "id": 1751645173,
    "node_id": "IC_kwDOC0FsAM5oZ_v1",
    "user": {
      "login": "zekchan",
      "id": 3997978,
      "node_id": "MDQ6VXNlcjM5OTc5Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3997978?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zekchan",
      "html_url": "https://github.com/zekchan",
      "followers_url": "https://api.github.com/users/zekchan/followers",
      "following_url": "https://api.github.com/users/zekchan/following{/other_user}",
      "gists_url": "https://api.github.com/users/zekchan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zekchan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zekchan/subscriptions",
      "organizations_url": "https://api.github.com/users/zekchan/orgs",
      "repos_url": "https://api.github.com/users/zekchan/repos",
      "events_url": "https://api.github.com/users/zekchan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zekchan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-07T08:07:39Z",
    "updated_at": "2023-10-07T08:07:39Z",
    "author_association": "NONE",
    "body": "Looks fine for me, I think there is a new stage `BorHeimdall` that erigon introduced around 2.49 release. It imports sync transactions from heimdall to erigon, starting from block 0. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751645173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751646120",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8399#issuecomment-1751646120",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399",
    "id": 1751646120,
    "node_id": "IC_kwDOC0FsAM5oZ_-o",
    "user": {
      "login": "rayn316",
      "id": 24621599,
      "node_id": "MDQ6VXNlcjI0NjIxNTk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/24621599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rayn316",
      "html_url": "https://github.com/rayn316",
      "followers_url": "https://api.github.com/users/rayn316/followers",
      "following_url": "https://api.github.com/users/rayn316/following{/other_user}",
      "gists_url": "https://api.github.com/users/rayn316/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rayn316/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rayn316/subscriptions",
      "organizations_url": "https://api.github.com/users/rayn316/orgs",
      "repos_url": "https://api.github.com/users/rayn316/repos",
      "events_url": "https://api.github.com/users/rayn316/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rayn316/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-07T08:11:28Z",
    "updated_at": "2023-10-07T08:11:28Z",
    "author_association": "NONE",
    "body": "@zekchan So you only need to wait for erigon synchronization to complete this stage and it will be ok, and the data in subsequent stages will not be reset?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751646120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751646982",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8399#issuecomment-1751646982",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399",
    "id": 1751646982,
    "node_id": "IC_kwDOC0FsAM5oaAMG",
    "user": {
      "login": "zekchan",
      "id": 3997978,
      "node_id": "MDQ6VXNlcjM5OTc5Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3997978?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zekchan",
      "html_url": "https://github.com/zekchan",
      "followers_url": "https://api.github.com/users/zekchan/followers",
      "following_url": "https://api.github.com/users/zekchan/following{/other_user}",
      "gists_url": "https://api.github.com/users/zekchan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zekchan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zekchan/subscriptions",
      "organizations_url": "https://api.github.com/users/zekchan/orgs",
      "repos_url": "https://api.github.com/users/zekchan/repos",
      "events_url": "https://api.github.com/users/zekchan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zekchan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-07T08:14:55Z",
    "updated_at": "2023-10-07T08:14:55Z",
    "author_association": "NONE",
    "body": "@rayn316 in my experience - yes. Just check the logs  to ensure that some progress is happening. That stage shouldn't take very long if you have fast heimdall close to yours node.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751646982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751648435",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/8399#issuecomment-1751648435",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/8399",
    "id": 1751648435,
    "node_id": "IC_kwDOC0FsAM5oaAiz",
    "user": {
      "login": "rayn316",
      "id": 24621599,
      "node_id": "MDQ6VXNlcjI0NjIxNTk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/24621599?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rayn316",
      "html_url": "https://github.com/rayn316",
      "followers_url": "https://api.github.com/users/rayn316/followers",
      "following_url": "https://api.github.com/users/rayn316/following{/other_user}",
      "gists_url": "https://api.github.com/users/rayn316/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rayn316/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rayn316/subscriptions",
      "organizations_url": "https://api.github.com/users/rayn316/orgs",
      "repos_url": "https://api.github.com/users/rayn316/repos",
      "events_url": "https://api.github.com/users/rayn316/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rayn316/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-07T08:20:44Z",
    "updated_at": "2023-10-07T08:20:44Z",
    "author_association": "NONE",
    "body": "@zekchan Thank you",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1751648435/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
