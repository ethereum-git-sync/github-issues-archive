{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/5184",
  "id": 1350901286,
  "node_id": "I_kwDOC0FsAM5QhR4m",
  "number": 5184,
  "title": "erigon stops synching after block number 0xe5a51a",
  "user": {
    "login": "TimDaub",
    "id": 2758453,
    "node_id": "MDQ6VXNlcjI3NTg0NTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2758453?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TimDaub",
    "html_url": "https://github.com/TimDaub",
    "followers_url": "https://api.github.com/users/TimDaub/followers",
    "following_url": "https://api.github.com/users/TimDaub/following{/other_user}",
    "gists_url": "https://api.github.com/users/TimDaub/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TimDaub/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TimDaub/subscriptions",
    "organizations_url": "https://api.github.com/users/TimDaub/orgs",
    "repos_url": "https://api.github.com/users/TimDaub/repos",
    "events_url": "https://api.github.com/users/TimDaub/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TimDaub/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-08-25T13:27:30Z",
  "updated_at": "2022-08-28T19:33:41Z",
  "closed_at": "2022-08-28T19:09:08Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\n./erigon/build/bin/erigon --version\r\nerigon version 2021.11.3-alpha\r\n\r\nOS & Version: \r\n\r\nuname -a\r\nLinux ethnode 5.4.0-90-generic #101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nCommit hash : 0bb6478d3df64c130db407a783e5174deb78655f\r\n\r\n#### Behaviour\r\n\r\n- we have been running since a long time\r\n- I usually check if the node is still synching by using the JSON rpc endpoint. And I interpret `result: false` as \"the node is not synching because it is up to date with mainnet\"\r\n\r\n```\r\nps ax | grep erigon\r\n  13392 ?        Sl   86165:09 ./erigon/build/bin/erigon --private.api.addr=localhost:9090 --datadir=/root/.local/share/erigon/\r\n  14367 ?        Sl   1402:20 ./erigon/build/bin/rpcdaemon --private.api.addr=localhost:9090 --datadir=/root/.local/share/erigon/ --http.api=eth,web3,net,txpool\r\n3696602 pts/1    S+     0:00 grep --color=auto erigon\r\n```\r\n\r\nas you can see the service is running and here are it's last logs with timestamps\r\n\r\n```\r\ntail node.out\r\n[INFO] [08-25|15:22:30.244] [1/15 Headers] Wrote block headers       number=15050010 blk/second=0.000 alloc=\"4.84 GiB\" sys=\"22.43 GiB\"\r\n[INFO] [08-25|15:22:51.883] [p2p] GoodPeers                          eth66=100\r\n[INFO] [08-25|15:22:51.913] [txpool] stat                            block=15050010 pending=10000 baseFee=30000 queued=30000 alloc_mb=5055 sys_mb=22964\r\n[INFO] [08-25|15:23:00.244] [1/15 Headers] Wrote block headers       number=15050010 blk/second=0.000 alloc=\"4.99 GiB\" sys=\"22.43 GiB\"\r\n[INFO] [08-25|15:23:30.244] [1/15 Headers] Wrote block headers       number=15050010 blk/second=0.000 alloc=\"5.09 GiB\" sys=\"22.43 GiB\"\r\n[INFO] [08-25|15:23:51.913] [txpool] stat                            block=15050010 pending=10000 baseFee=30000 queued=30000 alloc_mb=5315 sys_mb=22964\r\n[INFO] [08-25|15:24:00.244] [1/15 Headers] Wrote block headers       number=15050010 blk/second=0.000 alloc=\"4.70 GiB\" sys=\"22.43 GiB\"\r\n[INFO] [08-25|15:24:30.244] [1/15 Headers] Wrote block headers       number=15050010 blk/second=0.000 alloc=\"4.83 GiB\" sys=\"22.43 GiB\"\r\n[INFO] [08-25|15:24:51.883] [p2p] GoodPeers                          eth66=100\r\n[INFO] [08-25|15:24:51.913] [txpool] stat                            block=15050010 pending=10000 baseFee=30000 queued=30000 alloc_mb=5036 sys_mb=22964\r\n```\r\n\r\nhowever, what is odd is that synching is false but clearly the node is 56 days behind mainnet https://etherscan.io/block/15050010\r\n\r\n```\r\nroot@ethnode ~ # curl -s -X POST  -H \"Content-Type: application/json\"   --data '{\"jsonrpc\": \"2.0\",\"method\": \"eth_blockNumber\",\"params\": [],\"id\": 0}'   http://localhost:8545\r\n{\"jsonrpc\":\"2.0\",\"id\":0,\"result\":\"0xe5a51a\"}\r\nroot@ethnode ~ # curl -s -X POST  -H \"Content-Type: application/json\"   --data '{\"jsonrpc\": \"2.0\",\"method\": \"eth_syncing\",\"params\": [],\"id\": 0}'   http://localhost:8545\r\n{\"jsonrpc\":\"2.0\",\"id\":0,\"result\":false}\r\n```\r\n\r\n```\r\ndf -h\r\nFilesystem      Size  Used Avail Use% Mounted on\r\nudev             63G     0   63G   0% /dev\r\ntmpfs            13G  1.0M   13G   1% /run\r\n/dev/nvme0n1p3  3.5T  2.7T  643G  81% /   <==== erigon disk\r\ntmpfs            63G     0   63G   0% /dev/shm\r\ntmpfs           5.0M     0  5.0M   0% /run/lock\r\ntmpfs            63G     0   63G   0% /sys/fs/cgroup\r\n/dev/nvme0n1p2  975M   83M  841M   9% /boot\r\ntmpfs            13G     0   13G   0% /run/user/0\r\n```\r\n\r\n\r\n#### Expected behaviour\r\n\r\n- there is two things\r\n  - for once, I'd like the node to crash completely in case it isn't able to sync for 50 days\r\n  - I'd like synching or some other json rpc to inform me that the node has become unsynched with the network\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n- no idea; Run erigon for a super long time?\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n",
  "closed_by": {
    "login": "TimDaub",
    "id": 2758453,
    "node_id": "MDQ6VXNlcjI3NTg0NTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2758453?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TimDaub",
    "html_url": "https://github.com/TimDaub",
    "followers_url": "https://api.github.com/users/TimDaub/followers",
    "following_url": "https://api.github.com/users/TimDaub/following{/other_user}",
    "gists_url": "https://api.github.com/users/TimDaub/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TimDaub/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TimDaub/subscriptions",
    "organizations_url": "https://api.github.com/users/TimDaub/orgs",
    "repos_url": "https://api.github.com/users/TimDaub/repos",
    "events_url": "https://api.github.com/users/TimDaub/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TimDaub/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1227285105",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5184#issuecomment-1227285105",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184",
    "id": 1227285105,
    "node_id": "IC_kwDOC0FsAM5JJuJx",
    "user": {
      "login": "TimDaub",
      "id": 2758453,
      "node_id": "MDQ6VXNlcjI3NTg0NTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2758453?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TimDaub",
      "html_url": "https://github.com/TimDaub",
      "followers_url": "https://api.github.com/users/TimDaub/followers",
      "following_url": "https://api.github.com/users/TimDaub/following{/other_user}",
      "gists_url": "https://api.github.com/users/TimDaub/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TimDaub/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TimDaub/subscriptions",
      "organizations_url": "https://api.github.com/users/TimDaub/orgs",
      "repos_url": "https://api.github.com/users/TimDaub/repos",
      "events_url": "https://api.github.com/users/TimDaub/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TimDaub/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-25T13:46:24Z",
    "updated_at": "2022-08-25T13:46:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sent a related issue to the execution API specs: https://github.com/ethereum/execution-apis/issues/296",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1227285105/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229531234",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5184#issuecomment-1229531234",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184",
    "id": 1229531234,
    "node_id": "IC_kwDOC0FsAM5JSShi",
    "user": {
      "login": "Anish-Agnihotri",
      "id": 4398624,
      "node_id": "MDQ6VXNlcjQzOTg2MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4398624?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Anish-Agnihotri",
      "html_url": "https://github.com/Anish-Agnihotri",
      "followers_url": "https://api.github.com/users/Anish-Agnihotri/followers",
      "following_url": "https://api.github.com/users/Anish-Agnihotri/following{/other_user}",
      "gists_url": "https://api.github.com/users/Anish-Agnihotri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Anish-Agnihotri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Anish-Agnihotri/subscriptions",
      "organizations_url": "https://api.github.com/users/Anish-Agnihotri/orgs",
      "repos_url": "https://api.github.com/users/Anish-Agnihotri/repos",
      "events_url": "https://api.github.com/users/Anish-Agnihotri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Anish-Agnihotri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-28T18:58:31Z",
    "updated_at": "2022-08-28T19:00:16Z",
    "author_association": "NONE",
    "body": "Any luck figuring this out? Seem to have stopped sync at `0xe5a51a` on an old Erigon instance too.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229531234/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229533101",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5184#issuecomment-1229533101",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184",
    "id": 1229533101,
    "node_id": "IC_kwDOC0FsAM5JSS-t",
    "user": {
      "login": "TimDaub",
      "id": 2758453,
      "node_id": "MDQ6VXNlcjI3NTg0NTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2758453?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TimDaub",
      "html_url": "https://github.com/TimDaub",
      "followers_url": "https://api.github.com/users/TimDaub/followers",
      "following_url": "https://api.github.com/users/TimDaub/following{/other_user}",
      "gists_url": "https://api.github.com/users/TimDaub/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TimDaub/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TimDaub/subscriptions",
      "organizations_url": "https://api.github.com/users/TimDaub/orgs",
      "repos_url": "https://api.github.com/users/TimDaub/repos",
      "events_url": "https://api.github.com/users/TimDaub/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TimDaub/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-28T19:09:07Z",
    "updated_at": "2022-08-28T19:10:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here's what I did:\r\n\r\n- Erigon main git repository: Checked out to https://github.com/ledgerwatch/erigon/releases/tag/v2022.08.02\r\n- Then, you'll find that some git submodules also need updates. Update them too\r\n- For libmdbx you'll have to switch the remote https://gitflic.ru/project/erthink/libmdbx/ (context can be found on Twitter. Apparently GH is once again YOLO-deleting state-enemy code America fuck yeah)\r\n- You'll have to remake erigon and rpcdaemon\r\n- Once I restarted erigon, it started rebuilding the database, and this took a while (maybe a day or so). Seems like there was a migration or corruption issue.\r\n- Now, everything seemed to have gone back to normal. My node has been running and syncing non stop since I've done these changes\r\n- Sorry for the anti America snark but I am a bit cynical about this code shouldn't be deleted\r\n\r\nWill close because this issue is essentially resolved for me.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229533101/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229537447",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/5184#issuecomment-1229537447",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/5184",
    "id": 1229537447,
    "node_id": "IC_kwDOC0FsAM5JSUCn",
    "user": {
      "login": "Anish-Agnihotri",
      "id": 4398624,
      "node_id": "MDQ6VXNlcjQzOTg2MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4398624?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Anish-Agnihotri",
      "html_url": "https://github.com/Anish-Agnihotri",
      "followers_url": "https://api.github.com/users/Anish-Agnihotri/followers",
      "following_url": "https://api.github.com/users/Anish-Agnihotri/following{/other_user}",
      "gists_url": "https://api.github.com/users/Anish-Agnihotri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Anish-Agnihotri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Anish-Agnihotri/subscriptions",
      "organizations_url": "https://api.github.com/users/Anish-Agnihotri/orgs",
      "repos_url": "https://api.github.com/users/Anish-Agnihotri/repos",
      "events_url": "https://api.github.com/users/Anish-Agnihotri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Anish-Agnihotri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-28T19:33:41Z",
    "updated_at": "2022-08-28T19:33:41Z",
    "author_association": "NONE",
    "body": "You're good on the snark; we're in agreement.\r\n\r\nThank you for the prompt reply; the node is back up and rebuilding the database. Much appreciated.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1229537447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
