{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/1146",
  "id": 709787240,
  "node_id": "MDU6SXNzdWU3MDk3ODcyNDA=",
  "number": 1146,
  "title": "trace_filter crashed - invalid memory address or nil pointer dereference",
  "user": {
    "login": "koen84",
    "id": 8461454,
    "node_id": "MDQ6VXNlcjg0NjE0NTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8461454?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/koen84",
    "html_url": "https://github.com/koen84",
    "followers_url": "https://api.github.com/users/koen84/followers",
    "following_url": "https://api.github.com/users/koen84/following{/other_user}",
    "gists_url": "https://api.github.com/users/koen84/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/koen84/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/koen84/subscriptions",
    "organizations_url": "https://api.github.com/users/koen84/orgs",
    "repos_url": "https://api.github.com/users/koen84/repos",
    "events_url": "https://api.github.com/users/koen84/events{/privacy}",
    "received_events_url": "https://api.github.com/users/koen84/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-09-27T18:07:59Z",
  "updated_at": "2020-10-24T05:52:18Z",
  "closed_at": "2020-10-24T05:52:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm running on ubuntu 18.04 LTS with commit 64e1a8f\r\n\r\n```\r\nERROR[09-27|20:03:13.021] RPC method trace_filter crashed: runtime error: invalid memory address or nil pointer dereference\r\ngoroutine 1144408214 [running]:\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*callback).call.func1(0xc0007159e4, 0xc, 0xc00014fd28)\r\n        github.com/ledgerwatch/turbo-geth/rpc/service.go:200 +0xba\r\npanic(0xec78e0, 0x1909590)\r\n        runtime/panic.go:969 +0x175\r\ngithub.com/ledgerwatch/turbo-geth/core/types.(*Block).Transactions(...)\r\n        github.com/ledgerwatch/turbo-geth/core/types/block.go:336\r\ngithub.com/ledgerwatch/turbo-geth/cmd/rpcdaemon/commands.(*TraceAPIImpl).Filter.func3(0x118aca0, 0xc0004713b0, 0x427af8, 0x90)\r\n        github.com/ledgerwatch/turbo-geth/cmd/rpcdaemon/commands/trace_api.go:211 +0x2eb\r\ngithub.com/ledgerwatch/turbo-geth/ethdb.(*RemoteKV).View(0xc00030e540, 0x117dfc0, 0xc000550b80, 0xc000280c60, 0x0, 0x0)\r\n        github.com/ledgerwatch/turbo-geth/ethdb/kv_remote.go:219 +0x9e\r\ngithub.com/ledgerwatch/turbo-geth/cmd/rpcdaemon/commands.(*TraceAPIImpl).Filter(0xc0000ab440, 0x117dfc0, 0xc000550b80, 0xc000715a18, 0xc000715a20, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n        github.com/ledgerwatch/turbo-geth/cmd/rpcdaemon/commands/trace_api.go:152 +0x377\r\nreflect.Value.call(0xc000235300, 0xc000316ab8, 0x13, 0x10026ac, 0x4, 0xc000618910, 0x3, 0x3, 0xc000618940, 0xc0002ad5a0, ...)\r\n        reflect/value.go:475 +0x8c7\r\nreflect.Value.Call(0xc000235300, 0xc000316ab8, 0x13, 0xc000618910, 0x3, 0x3, 0x16, 0x0, 0x0)\r\n        reflect/value.go:336 +0xb9\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*callback).call(0xc00030fe60, 0x117dfc0, 0xc000550b80, 0xc0007159e4, 0xc, 0xc0002ad5a0, 0x1, 0x1, 0x0, 0x0, ...)\r\n        github.com/ledgerwatch/turbo-geth/rpc/service.go:206 +0x2c5\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*handler).runMethod(0xc000280990, 0x117dfc0, 0xc000550b80, 0xc0002fea10, 0xc00030fe60, 0xc0002ad5a0, 0x1, 0x1, 0x1)\r\n        github.com/ledgerwatch/turbo-geth/rpc/handler.go:388 +0x8a\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*handler).handleCall(0xc000280990, 0xc000471350, 0xc0002fea10, 0xf7e140)\r\n        github.com/ledgerwatch/turbo-geth/rpc/handler.go:336 +0x294\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*handler).handleCallMsg(0xc000280990, 0xc000471350, 0xc0002fea10, 0xc000316240)\r\n        github.com/ledgerwatch/turbo-geth/rpc/handler.go:298 +0x1be\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*handler).handleBatch.func2(0xc000471350)\r\n        github.com/ledgerwatch/turbo-geth/rpc/handler.go:119 +0xf3\r\ngithub.com/ledgerwatch/turbo-geth/rpc.(*handler).startCallProc.func1(0xc000280990, 0xc000550b40)\r\n        github.com/ledgerwatch/turbo-geth/rpc/handler.go:226 +0xd2\r\ncreated by github.com/ledgerwatch/turbo-geth/rpc.(*handler).startCallProc\r\n        github.com/ledgerwatch/turbo-geth/rpc/handler.go:222 +0x66\r\n\r\nWARN [09-27|20:03:13.021] Served                                   conn=127.0.0.1:41198      method=trace_filter              reqid=12898647 t=\"309.496Âµs\"  err=\"method handler crashed\"\r\n```\r\n\r\nCan i restart turbogeth or do i need to extra more info beforehand ?",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699687524",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1146#issuecomment-699687524",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146",
    "id": 699687524,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTY4NzUyNA==",
    "user": {
      "login": "tjayrush",
      "id": 5417918,
      "node_id": "MDQ6VXNlcjU0MTc5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tjayrush",
      "html_url": "https://github.com/tjayrush",
      "followers_url": "https://api.github.com/users/tjayrush/followers",
      "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
      "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
      "organizations_url": "https://api.github.com/users/tjayrush/orgs",
      "repos_url": "https://api.github.com/users/tjayrush/repos",
      "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tjayrush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-27T21:00:21Z",
    "updated_at": "2020-09-27T21:00:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can you provide a `curl` command to reproduce?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/699687524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700392217",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1146#issuecomment-700392217",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146",
    "id": 700392217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDM5MjIxNw==",
    "user": {
      "login": "koen84",
      "id": 8461454,
      "node_id": "MDQ6VXNlcjg0NjE0NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8461454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/koen84",
      "html_url": "https://github.com/koen84",
      "followers_url": "https://api.github.com/users/koen84/followers",
      "following_url": "https://api.github.com/users/koen84/following{/other_user}",
      "gists_url": "https://api.github.com/users/koen84/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/koen84/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/koen84/subscriptions",
      "organizations_url": "https://api.github.com/users/koen84/orgs",
      "repos_url": "https://api.github.com/users/koen84/repos",
      "events_url": "https://api.github.com/users/koen84/events{/privacy}",
      "received_events_url": "https://api.github.com/users/koen84/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T02:43:54Z",
    "updated_at": "2020-09-29T02:45:03Z",
    "author_association": "NONE",
    "body": "Looks like this was the request that made it crash\r\n`DBG Request: {\"jsonrpc\":\"2.0\",\"method\":\"trace_filter\",\"params\":[{\"fromBlock\":\"0x8d196b\",\"toBlock\":\"0x8d196b\"}],\"id\":677484}`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700392217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700623210",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1146#issuecomment-700623210",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146",
    "id": 700623210,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDYyMzIxMA==",
    "user": {
      "login": "tjayrush",
      "id": 5417918,
      "node_id": "MDQ6VXNlcjU0MTc5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tjayrush",
      "html_url": "https://github.com/tjayrush",
      "followers_url": "https://api.github.com/users/tjayrush/followers",
      "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
      "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
      "organizations_url": "https://api.github.com/users/tjayrush/orgs",
      "repos_url": "https://api.github.com/users/tjayrush/repos",
      "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tjayrush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T10:48:10Z",
    "updated_at": "2020-09-29T10:55:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for that. I tried this `curl` command against the latest build\r\n\r\n```\r\ncurl --data '{\"jsonrpc\":\"2.0\",\"method\":\"trace_filter\",\"params\":[{\"fromBlock\":\"0x8d196b\",\"toBlock\":\"0x8d196b\"}],\"id\":677484}' -H \"Content-Type: application/json\" -X POST localhost:8545\r\n```\r\nI'm not seeing a crash on my Mac.\r\n\r\n(Two things that would help: What operating system are you on? What command line do you use to start `TurboGeth` and the `rpcdaemon`?)\r\n\r\nOne thing I do see in the stack trace is this:\r\n\r\n```\r\ngithub.com/ledgerwatch/turbo-geth/cmd/rpcdaemon/commands/trace_api.go:211\r\n```\r\n\r\nWhen I look at [that file on the latest master branch](https://github.com/ledgerwatch/turbo-geth/blob/master/cmd/rpcdaemon/commands/trace_api.go), I see that the file doesn't have 211 lines.\r\n\r\nThe first thing to do is `git pull` the latest code, rebuild, rerun TurboGeth and the rpcdaemon and then re-run the above `curl` command.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/700623210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/701561492",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1146#issuecomment-701561492",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146",
    "id": 701561492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTU2MTQ5Mg==",
    "user": {
      "login": "tjayrush",
      "id": 5417918,
      "node_id": "MDQ6VXNlcjU0MTc5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tjayrush",
      "html_url": "https://github.com/tjayrush",
      "followers_url": "https://api.github.com/users/tjayrush/followers",
      "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
      "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
      "organizations_url": "https://api.github.com/users/tjayrush/orgs",
      "repos_url": "https://api.github.com/users/tjayrush/repos",
      "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tjayrush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-30T18:21:57Z",
    "updated_at": "2020-09-30T18:21:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "@koen84 Did you have a chance to try this on the latest master branch?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/701561492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/708372227",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/1146#issuecomment-708372227",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/1146",
    "id": 708372227,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwODM3MjIyNw==",
    "user": {
      "login": "tjayrush",
      "id": 5417918,
      "node_id": "MDQ6VXNlcjU0MTc5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tjayrush",
      "html_url": "https://github.com/tjayrush",
      "followers_url": "https://api.github.com/users/tjayrush/followers",
      "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
      "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
      "organizations_url": "https://api.github.com/users/tjayrush/orgs",
      "repos_url": "https://api.github.com/users/tjayrush/repos",
      "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tjayrush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-14T12:35:43Z",
    "updated_at": "2020-10-14T12:35:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "I spent some time looking at this issue. It no longer crashes, but the example is VERY slow. We have the performance issue documented here #1128.\r\n\r\nUnless I hear otherwise, I will close this issue shortly.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/708372227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
