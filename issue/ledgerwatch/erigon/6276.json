{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6276",
  "id": 1489346156,
  "node_id": "I_kwDOC0FsAM5YxZ5s",
  "number": 6276,
  "title": "Polygon Mainnet: \"block has less receipts than expected\"",
  "user": {
    "login": "kcy1019",
    "id": 4436335,
    "node_id": "MDQ6VXNlcjQ0MzYzMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4436335?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kcy1019",
    "html_url": "https://github.com/kcy1019",
    "followers_url": "https://api.github.com/users/kcy1019/followers",
    "following_url": "https://api.github.com/users/kcy1019/following{/other_user}",
    "gists_url": "https://api.github.com/users/kcy1019/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kcy1019/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kcy1019/subscriptions",
    "organizations_url": "https://api.github.com/users/kcy1019/orgs",
    "repos_url": "https://api.github.com/users/kcy1019/repos",
    "events_url": "https://api.github.com/users/kcy1019/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kcy1019/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-12-11T03:18:03Z",
  "updated_at": "2022-12-12T15:21:32Z",
  "closed_at": "2022-12-12T15:21:32Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: [`maticnetwork/v0.0.4`][b](based on [`v2.31.0`][a])\r\n\r\n[a]: https://github.com/ledgerwatch/erigon/releases/tag/v2.31.0\r\n[b]: https://github.com/maticnetwork/erigon/releases/tag/v0.0.4\r\n[c]: https://github.com/maticnetwork/erigon/releases/tag/v0.0.3\r\n\r\nOS & Version: `Linux`\r\n\r\nCommit hash : [`de5391602c810c28e8c71b86efbc6c04e61b39d3`](https://github.com/maticnetwork/erigon/tree/de5391602c810c28e8c71b86efbc6c04e61b39d3)\r\n\r\n#### Expected behaviour\r\n\r\nWe can retrieve transaction reciepts using jsonrpc API:\r\n\r\n```shell\r\ncurl -XPOST 'http://localhost:8545' \\\r\n     -H 'Content-Type: application/json' \\\r\n     --data '{\"method\":\"eth_getTransactionReceipt\",\"params\":[\"0x31ce15ce9a1ff347f4204a1ed3625861165c53ae08743c1f36a32865c62744c6\"],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n```\r\n\r\n#### Actual behaviour\r\n\r\n```json\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32000,\"message\":\"block has less receipts than expected: 0 \\u003c= 0, block: 36635776\"}}\r\n```\r\n\r\nNote that we haven't encountered this kind of errors in [`maticnetwork/v0.0.3`][c](which seems to be based on somewhere around [`v2022.08.01`](https://github.com/ledgerwatch/erigon/releases/tag/v2022.08.01)).\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. Sync Erigon [`maticnetwork/v0.0.3`][c] for Polygon Mainnet\r\n2. Upgrade binary to [`maticnetwork/v0.0.4`][b]\r\n3. Request API:\r\n     ```shell\r\n     curl -XPOST 'http://localhost:8545' \\\r\n          -H 'Content-Type: application/json' \\\r\n          --data '{\"method\":\"eth_getTransactionReceipt\",\"params\": \r\n   [\"0x31ce15ce9a1ff347f4204a1ed3625861165c53ae08743c1f36a32865c62744c6\"],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n     ```\r\n\r\nWe tried the above steps twice and it consistently reproduced the problem.\r\n\r\n\r\n#### NOTES\r\n\r\n- `eth_getBlockReceipts` works fine for the block number, so at least we have a workaround.\r\n\r\n[r]: https://github.com/ledgerwatch/erigon/blob/devel/cmd/rpcdaemon/commands/eth_receipts.go#L546\r\n\r\n#### Backtrace\r\n\r\nN/A",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1345928834",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6276#issuecomment-1345928834",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6276",
    "id": 1345928834,
    "node_id": "IC_kwDOC0FsAM5QOT6C",
    "user": {
      "login": "kcy1019",
      "id": 4436335,
      "node_id": "MDQ6VXNlcjQ0MzYzMzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4436335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kcy1019",
      "html_url": "https://github.com/kcy1019",
      "followers_url": "https://api.github.com/users/kcy1019/followers",
      "following_url": "https://api.github.com/users/kcy1019/following{/other_user}",
      "gists_url": "https://api.github.com/users/kcy1019/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kcy1019/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kcy1019/subscriptions",
      "organizations_url": "https://api.github.com/users/kcy1019/orgs",
      "repos_url": "https://api.github.com/users/kcy1019/repos",
      "events_url": "https://api.github.com/users/kcy1019/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kcy1019/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-12T05:55:03Z",
    "updated_at": "2022-12-12T11:58:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Weâ€™ve also found that `eth_getTransactionByHash` is also having trouble retrieving some Polygon State Sync transactions such as [`0xd5f4f8c3cd85cf65e8df23a2c1ae02aefda1e6293db0c3a9ddcc08cee8ca1131`][a], and `eth_getBlockByNumber` can be a workaround.\r\n\r\nPossible fix: https://github.com/ledgerwatch/erigon/pull/6286\r\n\r\n**Failure**\r\n```shell\r\n$ curl -XPOST 'http://localhost:8545' \\\r\n     -H 'Content-Type: application/json' \\\r\n     --data '{\"method\":\"eth_getTransactionByHash\",\"params\":[\"0xd5f4f8c3cd85cf65e8df23a2c1ae02aefda1e6293db0c3a9ddcc08cee8ca1131\"],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":null}\r\n```\r\n\r\n**Workaround: `eth_getBlockByNumber`**\r\n```shell\r\n$ curl -XPOST 'http://localhost:8545' \\\r\n     -H 'Content-Type: application/json' \\\r\n     --data '{\"method\":\"eth_getBlockByNumber\",\"params\":[\"36647936\",true],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n# (works fine, returns correct information about the transaction)\r\n```\r\n\r\n[a]: https://polygonscan.com/tx/0xd5f4f8c3cd85cf65e8df23a2c1ae02aefda1e6293db0c3a9ddcc08cee8ca1131",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1345928834/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
