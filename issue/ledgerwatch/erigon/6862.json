{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6862",
  "id": 1582932766,
  "node_id": "I_kwDOC0FsAM5eWaMe",
  "number": 6862,
  "title": "docker image thorax/erigon: stat --datadir=/data: no such file or directory: unknown",
  "user": {
    "login": "thorstenhirsch",
    "id": 619741,
    "node_id": "MDQ6VXNlcjYxOTc0MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/619741?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thorstenhirsch",
    "html_url": "https://github.com/thorstenhirsch",
    "followers_url": "https://api.github.com/users/thorstenhirsch/followers",
    "following_url": "https://api.github.com/users/thorstenhirsch/following{/other_user}",
    "gists_url": "https://api.github.com/users/thorstenhirsch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thorstenhirsch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thorstenhirsch/subscriptions",
    "organizations_url": "https://api.github.com/users/thorstenhirsch/orgs",
    "repos_url": "https://api.github.com/users/thorstenhirsch/repos",
    "events_url": "https://api.github.com/users/thorstenhirsch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thorstenhirsch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4566396003,
      "node_id": "LA_kwDOC0FsAM8AAAABEC2sYw",
      "url": "https://api.github.com/repos/ledgerwatch/erigon/labels/Stale",
      "name": "Stale",
      "color": "ededed",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-02-13T19:28:53Z",
  "updated_at": "2023-04-05T02:04:03Z",
  "closed_at": "2023-04-05T02:04:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Erigon v2.32.0 was running fine with my docker settings, but v2.38.1 is giving me an error upon start:\r\n\r\n````\r\n./run-erigon-pol.sh    \r\ncec931f91ffac4ce0321c3a639726bf04b77b3e9073849c8db402333985ff5a3\r\ndocker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: \"--datadir=/data\": stat --datadir=/data: no such file or directory: unknown.\r\nERRO[0001] error waiting for container:\r\n````\r\nHere's my run command:\r\n````\r\ndocker run --name erigon-pol -d \\\r\n    -p 8545:8545 \\\r\n    -v /home/me/docker/erigon-pol-data:/data \\\r\n    thorax/erigon:v2.38.1 \\\r\n    --datadir=/data \\\r\n    --chain=bor-mainnet\r\n````\r\nThe chain doesn't matter, it happens for mainnet as well. So it comes down to how the volume mount is being handled. The directory `/home/me/docker/erigon-pol-data` exists, there's no typo. I also tried mounting it under a different directory like `/mnt`, but the error remains the same. The error is also reproducible on other Linux machines with other distributions and other filesystems.\r\n\r\nThe only way to resolve the error I've found so far is to go back to v2.32.0.\r\n",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429141231",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1429141231",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1429141231,
    "node_id": "IC_kwDOC0FsAM5VLvbv",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T05:25:07Z",
    "updated_at": "2023-02-14T05:25:07Z",
    "author_association": "COLLABORATOR",
    "body": "what if you add binary name? `thorax/erigon:v2.38.1 erigon --datadir=/data`?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429141231/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429263138",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1429263138",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1429263138,
    "node_id": "IC_kwDOC0FsAM5VMNMi",
    "user": {
      "login": "thorstenhirsch",
      "id": 619741,
      "node_id": "MDQ6VXNlcjYxOTc0MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/619741?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thorstenhirsch",
      "html_url": "https://github.com/thorstenhirsch",
      "followers_url": "https://api.github.com/users/thorstenhirsch/followers",
      "following_url": "https://api.github.com/users/thorstenhirsch/following{/other_user}",
      "gists_url": "https://api.github.com/users/thorstenhirsch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thorstenhirsch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thorstenhirsch/subscriptions",
      "organizations_url": "https://api.github.com/users/thorstenhirsch/orgs",
      "repos_url": "https://api.github.com/users/thorstenhirsch/repos",
      "events_url": "https://api.github.com/users/thorstenhirsch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thorstenhirsch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T07:37:52Z",
    "updated_at": "2023-02-14T07:37:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Solves the problem. But then the next error during start is:\r\n```\r\nFatal: failed to load node key from /data/nodekey: open /data/nodekey: permission denied\r\n```\r\nThe file is there and has the same permissions as with v2.32.0:\r\n```\r\n-rw------- 1 root  root     64 Feb 11 17:55 nodekey\r\n```\r\nHas the uid in the Dockerfile changed?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429263138/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429324433",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1429324433",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1429324433,
    "node_id": "IC_kwDOC0FsAM5VMcKR",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T08:30:44Z",
    "updated_at": "2023-02-14T08:30:44Z",
    "author_association": "COLLABORATOR",
    "body": "I see in dockerfile: \r\n```\r\n# Setup user and group\r\n#\r\n# from the perspective of the container, uid=1000, gid=1000 is a sensible choice\r\n# (mimicking Ubuntu Server), but if caller creates a .env (example in repo root),\r\n# these defaults will get overridden when make calls docker-compose\r\nARG UID=1000\r\nARG GID=1000\r\nRUN adduser -D -u $UID -g $GID erigon\r\nUSER erigon\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1429324433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1430236974",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1430236974",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1430236974,
    "node_id": "IC_kwDOC0FsAM5VP68u",
    "user": {
      "login": "thorstenhirsch",
      "id": 619741,
      "node_id": "MDQ6VXNlcjYxOTc0MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/619741?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thorstenhirsch",
      "html_url": "https://github.com/thorstenhirsch",
      "followers_url": "https://api.github.com/users/thorstenhirsch/followers",
      "following_url": "https://api.github.com/users/thorstenhirsch/following{/other_user}",
      "gists_url": "https://api.github.com/users/thorstenhirsch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thorstenhirsch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thorstenhirsch/subscriptions",
      "organizations_url": "https://api.github.com/users/thorstenhirsch/orgs",
      "repos_url": "https://api.github.com/users/thorstenhirsch/repos",
      "events_url": "https://api.github.com/users/thorstenhirsch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thorstenhirsch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T19:01:38Z",
    "updated_at": "2023-02-14T19:01:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Alright, now it works. So in order to upgrade an existing datadir from v2.32.0 to a newer version, one needs to...\r\n\r\n1. update `docker run` with `--user $(id -u):$(id -g)`\r\n2. change ownership of files: `chown -R $(id -u):$(id -g) datadir`\r\n3. add `erigon` to the run command after the image name or `--entrypoint erigon`\r\n\r\nWell, I think 1. and 2. are probably not required for most people, because most distributions use uid=1000 for the 1st user account. But for me it was necessary, because I'm using a cloud environment, in which my uid looks like a random number.\r\n\r\nAnd for 3. I suggest to add an entrypoint to the Dockerfile. I could do the update and create a PR... if that's okay...?",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1430236974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1430675773",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1430675773",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1430675773,
    "node_id": "IC_kwDOC0FsAM5VRmE9",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T02:48:58Z",
    "updated_at": "2023-02-15T02:48:58Z",
    "author_association": "COLLABORATOR",
    "body": "Thank you. Feel free to PR code or readme. Just make sure that docker has many binaries and need posibility to run them also (lazy to release 15 docker images * 2 architectures for each binary). ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1430675773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1486113927",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1486113927",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1486113927,
    "node_id": "IC_kwDOC0FsAM5YlEyH",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-03-28T02:25:44Z",
    "updated_at": "2023-03-28T02:25:44Z",
    "author_association": "NONE",
    "body": "This issue is stale because it has been open for 40 days with no activity. Remove stale label or comment, or this will be closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1486113927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1496821530",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6862#issuecomment-1496821530",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6862",
    "id": 1496821530,
    "node_id": "IC_kwDOC0FsAM5ZN68a",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-04-05T02:04:02Z",
    "updated_at": "2023-04-05T02:04:02Z",
    "author_association": "NONE",
    "body": "This issue was closed because it has been stalled for 7 days with no activity.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1496821530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
