{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/6084",
  "id": 1456628812,
  "node_id": "I_kwDOC0FsAM5W0mRM",
  "number": 6084,
  "title": "During initial sync after data download, Eirgon consumes all available ram and starts swapping to disk (128GB)",
  "user": {
    "login": "b1f00d78",
    "id": 116952836,
    "node_id": "U_kgDOBviPBA",
    "avatar_url": "https://avatars.githubusercontent.com/u/116952836?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/b1f00d78",
    "html_url": "https://github.com/b1f00d78",
    "followers_url": "https://api.github.com/users/b1f00d78/followers",
    "following_url": "https://api.github.com/users/b1f00d78/following{/other_user}",
    "gists_url": "https://api.github.com/users/b1f00d78/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/b1f00d78/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/b1f00d78/subscriptions",
    "organizations_url": "https://api.github.com/users/b1f00d78/orgs",
    "repos_url": "https://api.github.com/users/b1f00d78/repos",
    "events_url": "https://api.github.com/users/b1f00d78/events{/privacy}",
    "received_events_url": "https://api.github.com/users/b1f00d78/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-11-19T19:22:46Z",
  "updated_at": "2022-11-20T10:43:52Z",
  "closed_at": "2022-11-20T10:43:52Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: 2.30.0-stable-35f493c5\r\n\r\nOS & Version: Windows 11\r\n\r\n#### Expected behaviour\r\n\r\nErigon should be free to consume RAM, but not exceed what is available.\r\nProvide an ability to cap the memory available to Erigon.\r\n\r\n#### Actual behaviour\r\n\r\nErigon continues to absorb RAM until there is non available on the machine, at this point it starts swapping to disk, but does not increase further (maybe 100-200MB on disk swap file).\r\nI cannot sync this node, as it always starts swapping memory to disk.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n`.\\build\\bin\\erigon.exe --datadir ..\\ErigonArchiveData\\`\r\nAfter it downloads the data to begin sync, during the Verify process and afterwards, Eirgon reports it is consuming about 24GB of RAM, but actually holds about 115GB in it's working set. No other processes can access this ram, and eventually the system crashes.\r\n\r\nBuilt with Go go1.19.3 windows/amd64\r\n",
  "closed_by": {
    "login": "b1f00d78",
    "id": 116952836,
    "node_id": "U_kgDOBviPBA",
    "avatar_url": "https://avatars.githubusercontent.com/u/116952836?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/b1f00d78",
    "html_url": "https://github.com/b1f00d78",
    "followers_url": "https://api.github.com/users/b1f00d78/followers",
    "following_url": "https://api.github.com/users/b1f00d78/following{/other_user}",
    "gists_url": "https://api.github.com/users/b1f00d78/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/b1f00d78/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/b1f00d78/subscriptions",
    "organizations_url": "https://api.github.com/users/b1f00d78/orgs",
    "repos_url": "https://api.github.com/users/b1f00d78/repos",
    "events_url": "https://api.github.com/users/b1f00d78/events{/privacy}",
    "received_events_url": "https://api.github.com/users/b1f00d78/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1320954802",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6084#issuecomment-1320954802",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084",
    "id": 1320954802,
    "node_id": "IC_kwDOC0FsAM5OvCuy",
    "user": {
      "login": "b1f00d78",
      "id": 116952836,
      "node_id": "U_kgDOBviPBA",
      "avatar_url": "https://avatars.githubusercontent.com/u/116952836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/b1f00d78",
      "html_url": "https://github.com/b1f00d78",
      "followers_url": "https://api.github.com/users/b1f00d78/followers",
      "following_url": "https://api.github.com/users/b1f00d78/following{/other_user}",
      "gists_url": "https://api.github.com/users/b1f00d78/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/b1f00d78/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/b1f00d78/subscriptions",
      "organizations_url": "https://api.github.com/users/b1f00d78/orgs",
      "repos_url": "https://api.github.com/users/b1f00d78/repos",
      "events_url": "https://api.github.com/users/b1f00d78/events{/privacy}",
      "received_events_url": "https://api.github.com/users/b1f00d78/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-19T19:38:16Z",
    "updated_at": "2022-11-19T19:38:16Z",
    "author_association": "NONE",
    "body": "Building this in WSL and running in WSL, creates the same behaviour, except WSL is limited to 64GB of RAM.\r\n\r\nIt consumes all available RAM, starts thrashing the swap file, then crashes the WSL instance.\r\n\r\n![image](https://user-images.githubusercontent.com/116952836/202868434-69d13aec-3ce6-417e-bfe5-68a7fefa5209.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1320954802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1321028238",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6084#issuecomment-1321028238",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084",
    "id": 1321028238,
    "node_id": "IC_kwDOC0FsAM5OvUqO",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-20T03:51:13Z",
    "updated_at": "2022-11-20T03:51:13Z",
    "author_association": "COLLABORATOR",
    "body": "1. provide logs\r\n2. if you can reproduce it - you can provide for us memory usage picture by: add `--pprof` flag, when you see high RAM usage do `go tool pprof -inuse_space -png http://127.0.0.1:6060/debug/pprof/heap > mem.png`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1321028238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1321096262",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/6084#issuecomment-1321096262",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/6084",
    "id": 1321096262,
    "node_id": "IC_kwDOC0FsAM5OvlRG",
    "user": {
      "login": "b1f00d78",
      "id": 116952836,
      "node_id": "U_kgDOBviPBA",
      "avatar_url": "https://avatars.githubusercontent.com/u/116952836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/b1f00d78",
      "html_url": "https://github.com/b1f00d78",
      "followers_url": "https://api.github.com/users/b1f00d78/followers",
      "following_url": "https://api.github.com/users/b1f00d78/following{/other_user}",
      "gists_url": "https://api.github.com/users/b1f00d78/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/b1f00d78/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/b1f00d78/subscriptions",
      "organizations_url": "https://api.github.com/users/b1f00d78/orgs",
      "repos_url": "https://api.github.com/users/b1f00d78/repos",
      "events_url": "https://api.github.com/users/b1f00d78/events{/privacy}",
      "received_events_url": "https://api.github.com/users/b1f00d78/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-20T10:43:52Z",
    "updated_at": "2022-11-20T10:43:52Z",
    "author_association": "NONE",
    "body": "I'm not pursuing this any further just wanted to provide a bug report - I've dumped all logs and data apologies.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1321096262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
