{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/4199",
  "id": 1241087228,
  "node_id": "I_kwDOC0FsAM5J-Xz8",
  "number": 4199,
  "title": "`eth_getTransactionReceipt` failing on some transaction hashes for Ethereum mainnet",
  "user": {
    "login": "mturnshek",
    "id": 867278,
    "node_id": "MDQ6VXNlcjg2NzI3OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/867278?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mturnshek",
    "html_url": "https://github.com/mturnshek",
    "followers_url": "https://api.github.com/users/mturnshek/followers",
    "following_url": "https://api.github.com/users/mturnshek/following{/other_user}",
    "gists_url": "https://api.github.com/users/mturnshek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mturnshek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mturnshek/subscriptions",
    "organizations_url": "https://api.github.com/users/mturnshek/orgs",
    "repos_url": "https://api.github.com/users/mturnshek/repos",
    "events_url": "https://api.github.com/users/mturnshek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mturnshek/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-05-19T02:59:13Z",
  "updated_at": "2022-05-19T03:23:16Z",
  "closed_at": "2022-05-19T03:23:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\n```\r\n$ ./erigon/build/bin/erigon --version\r\nerigon version 2022.04.4-alpha-f3065a11\r\n\r\n$ uname -a\r\nLinux archive 5.13.0-41-generic #46~20.04.1-Ubuntu SMP Wed Apr 20 13:16:21 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\nCommit hash : f3065a1149b5a15b6bc450adea842ce9762ef85e\r\n\r\n#### Expected behaviour\r\n\r\nCalling eth_getTransactionReceipt with a valid Ethereum mainnet transaction hash, for an Ethereum mainnet erigon node, does not cause the RPC client to throw an internal run-time error, and accurately returns a transaction receipt.\r\n\r\n#### Actual behaviour\r\n\r\nCalling eth_getTransactionReceipt with a significant percentage of valid transaction hashes results in an error. Here are several valid transaction hashes that cause the internal error:\r\n\r\n```\r\n['0x2d4763faa40fc2d6cdf7f8afeab5448c755ce327908546ce019ded583fab068f',\r\n'0x22ddba6cc2ec54322db54132340e7b73bf30807e1692fbdbd8c09cab380e792b',\r\n'0x2373639eff317b767f33930724ab010ee5af82d4b11d7d74d1f652e65286a86d',\r\n'0x2dbd0bf10fde0cdb2d656e5b2437788fd145187a667e3fd572b0cdce78423a59',\r\n'0x6664a993c3dc500f6343d155adbd713c8e9ed67b9ebb1cceea8ddb78863a3362',\r\n'0xff1994d1359043433603adb22f671816bbc2133ec6aee725689ef32003557a9a',\r\n'0x40c7ffb053eb6d39a82c51a9171c6b1b25d878e5cd9111533252dc0b2caa3aa8',\r\n'0x73c837fdc0550335567b508d9d764b5cf66bcc8880578ac952c2842a32ecd3cc',\r\n'0xc6b93eb5105ca3ff01d67cee09c399ac39a4f3765fe5e4312524f8316d084d93',\r\n'0xb669d06e9d950718937754ad68a9f3ab5806f6df17bca061d9b87fe4fb0b2996',\r\n'0x2050527de95cb082c6eed56f4e31dd37d1241124a331178586b3e31edead16f5']\r\n```\r\n\r\nThe same transaction hashes deterministically cause the internal error to occur. I can easily collect more hashes if necessary. From what I can tell it's about 5% of the transactions I'm attempting to analyze which throw the error.\r\n\r\n\r\nThe internal error message is always one of the following two:\r\n\r\n```\r\nWARN[05-18|22:46:03.190] Served                                   \r\nconn=127.0.0.1:44342 method=eth_getTransactionReceipt reqid=376 t=2.044028ms \r\nerr=\"rpc error: code = Internal desc = runtime error: slice bounds out of range \r\n[:21] with capacity 0\"\r\n```\r\n\r\n```\r\nWARN[05-18|22:46:05.000] Served                                   \r\nconn=127.0.0.1:44342 method=eth_getTransactionReceipt reqid=443 t=3.814767ms \r\nerr=\"rpc error: code = Internal desc = runtime error: slice bounds out of range \r\n[21:0]\"\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. Run an erigon node with no CLI flags\r\n```\r\n./build/bin/erigon\r\n```\r\n2. Run an RPC daemon. Exact command:\r\n```\r\n./erigon/build/bin/rpcdaemon --http.port=8545 --private.api.addr=127.0.0.1:9090 --http.api=eth,erigon,web3,net,debug,trace,txpool\r\n```\r\n3. Call eth_getTransactionReceipt with one of the previously listed hashes.\r\n\r\n\r\n#### Comments\r\n\r\nIf there's some additional information I can help provide from my system, please let me know.",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1131140589",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/4199#issuecomment-1131140589",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/4199",
    "id": 1131140589,
    "node_id": "IC_kwDOC0FsAM5Da9Xt",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-19T03:23:16Z",
    "updated_at": "2022-05-19T03:23:16Z",
    "author_association": "COLLABORATOR",
    "body": "fixed in later versions",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1131140589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
