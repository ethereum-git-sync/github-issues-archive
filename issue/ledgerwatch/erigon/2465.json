{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/2465",
  "id": 955546200,
  "node_id": "MDU6SXNzdWU5NTU1NDYyMDA=",
  "number": 2465,
  "title": "Erigon crashed: mdbx_page_touch: Assertion `mp->mp_pgno != pgno' failed.",
  "user": {
    "login": "Wiezzel",
    "id": 9394821,
    "node_id": "MDQ6VXNlcjkzOTQ4MjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9394821?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Wiezzel",
    "html_url": "https://github.com/Wiezzel",
    "followers_url": "https://api.github.com/users/Wiezzel/followers",
    "following_url": "https://api.github.com/users/Wiezzel/following{/other_user}",
    "gists_url": "https://api.github.com/users/Wiezzel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Wiezzel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Wiezzel/subscriptions",
    "organizations_url": "https://api.github.com/users/Wiezzel/orgs",
    "repos_url": "https://api.github.com/users/Wiezzel/repos",
    "events_url": "https://api.github.com/users/Wiezzel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Wiezzel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-07-29T07:28:50Z",
  "updated_at": "2021-07-30T15:30:43Z",
  "closed_at": "2021-07-30T15:30:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nErigon version: `2021.07.4-alpha`\r\n\r\nOS & Version: Ubuntu 18.04.5 LTS (Bionic Beaver)\r\n\r\nCommit hash: ???\r\n\r\n#### Expected behaviour\r\n\r\nErigon *not* crashing.\r\n\r\n#### Actual behaviour\r\n\r\nErigon crashed with the following message:\r\n```\r\nerigon: mdbx:10227: mdbx_page_touch: Assertion `mp->mp_pgno != pgno' failed.\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\nI was running Erigon with `--prune=htrc` option, using a database from previous version (2021.07.3). After several blocks it suddenly crashed.\r\n\r\n#### Backtrace\r\n\r\n[backtrace.txt](https://github.com/ledgerwatch/erigon/files/6898686/erigon-stacktrace.txt)\r\n\r\n\r\n",
  "closed_by": {
    "login": "AskAlexSharov",
    "id": 46885206,
    "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AskAlexSharov",
    "html_url": "https://github.com/AskAlexSharov",
    "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
    "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
    "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
    "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
    "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888873390",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2465#issuecomment-888873390",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465",
    "id": 888873390,
    "node_id": "IC_kwDOC0FsAM40-yGu",
    "user": {
      "login": "Wiezzel",
      "id": 9394821,
      "node_id": "MDQ6VXNlcjkzOTQ4MjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9394821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Wiezzel",
      "html_url": "https://github.com/Wiezzel",
      "followers_url": "https://api.github.com/users/Wiezzel/followers",
      "following_url": "https://api.github.com/users/Wiezzel/following{/other_user}",
      "gists_url": "https://api.github.com/users/Wiezzel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Wiezzel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Wiezzel/subscriptions",
      "organizations_url": "https://api.github.com/users/Wiezzel/orgs",
      "repos_url": "https://api.github.com/users/Wiezzel/repos",
      "events_url": "https://api.github.com/users/Wiezzel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Wiezzel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T07:32:39Z",
    "updated_at": "2021-07-29T07:32:39Z",
    "author_association": "NONE",
    "body": "Seems like the database got corrupted because the next run crashes immediately with a similar error:\r\n```\r\n$ ./erigon --prune=htrc --datadir=/media/adam/data/erigon/\r\nINFO [07-29|09:28:53.519] Build info                               git_branch= git_tag= git_commit=\r\nINFO [07-29|09:28:53.519] Starting Erigon on Ethereum mainnet... \r\nINFO [07-29|09:28:53.520] Maximum peer count                       ETH=100 total=100\r\nINFO [07-29|09:28:53.520] Set global gas cap                       cap=50000000\r\nINFO [07-29|09:28:53.568] Opening Database                         label=chaindata\r\nINFO [07-29|09:28:53.576] database closed (MDBX)                   mdbx=chaindata exclusive=false\r\nINFO [07-29|09:28:53.576] Opening Database                         label=chaindata\r\nINFO [07-29|09:28:53.580] Initialised chain configuration          config=\"{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, London: 12965000, Engine: ethash}\"\r\nINFO [07-29|09:28:53.581] Disk storage enabled for ethash DAGs     dir=/media/adam/data/erigon/erigon/ethash-dags count=2\r\nINFO [07-29|09:28:53.582] Initialising Ethereum protocol           network=1\r\nINFO [07-29|09:28:53.582] Effective                                prune=\"history=90000,receipt=90000,txindex=90000,calltrace=90000,experiments.tevm=disabled\"\r\nINFO [07-29|09:28:53.582] Starting private RPC server              on=127.0.0.1:9090\r\nINFO [07-29|09:28:55.725] [1/18 Headers] Waiting for headers...    from=12915896\r\nWARN [07-29|09:28:55.746] nodeDB.QuerySeeds failed                 err=\"failed MdbxKV cursor.Next(): mdbx_cursor_get: MDBX_PAGE_NOTFOUND: Requested page not found\"\r\nINFO [07-29|09:28:55.749] Started P2P networking                   version=66 self=enode://f6448ebd0267fe201c09fcc1e2de6b246da04f7000166fdacf04962ce2a764d0f6d48c176a706a49d57ef781ef9a0b47272b1d505c0d92f71245bb9aa915df30@127.0.0.1:30303 name=erigon/v2021.07.4/linux-amd64/go1.16.6\r\nWARN [07-29|09:28:55.762] nodeDB.QuerySeeds failed                 err=\"failed MdbxKV cursor.Next(): mdbx_cursor_get: MDBX_PAGE_NOTFOUND: Requested page not found\"\r\nWARN [07-29|09:28:55.804] nodeDB.QuerySeeds failed                 err=\"failed MdbxKV cursor.Next(): mdbx_cursor_get: MDBX_PAGE_NOTFOUND: Requested page not found\"\r\nINFO [07-29|09:28:55.807] Started P2P networking                   version=65 self=enode://f6448ebd0267fe201c09fcc1e2de6b246da04f7000166fdacf04962ce2a764d0f6d48c176a706a49d57ef781ef9a0b47272b1d505c0d92f71245bb9aa915df30@127.0.0.1:30304 name=erigon/v2021.07.4/linux-amd64/go1.16.6\r\nerigon: mdbx:10227: mdbx_page_touch: Assertion `mp->mp_pgno != pgno' failed.\r\nSIGABRT: abort\r\nPC=0x7f82391e3fb7 m=14 sigcode=18446744073709551610\r\nsignal arrived during cgo execution\r\n...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888873390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888985130",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2465#issuecomment-888985130",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465",
    "id": 888985130,
    "node_id": "IC_kwDOC0FsAM40_NYq",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T10:05:38Z",
    "updated_at": "2021-07-29T10:09:09Z",
    "author_association": "COLLABORATOR",
    "body": "@Wiezzel please do next 2 steps:\r\n1. Add `--database.verbosity=5` when you run Erigon and post output here. \r\n\r\n2.  \r\n```\r\nmake db-tools\r\n./build/bin/mdbx_chk <your_datadir>/erigon/nodes\r\n```\r\nand post output here.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888985130/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888991082",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2465#issuecomment-888991082",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465",
    "id": 888991082,
    "node_id": "IC_kwDOC0FsAM40_O1q",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T10:13:58Z",
    "updated_at": "2021-07-29T10:13:58Z",
    "author_association": "COLLABORATOR",
    "body": "Oh, actually it's very small node database (not the big one). \r\nPlease send it to us: `<your_datadir>/erigon/nodes/mdbx.dat`",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888991082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888991909",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2465#issuecomment-888991909",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465",
    "id": 888991909,
    "node_id": "IC_kwDOC0FsAM40_PCl",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T10:15:10Z",
    "updated_at": "2021-07-29T10:15:10Z",
    "author_association": "COLLABORATOR",
    "body": "Then, if you need restore node fast:\r\nyou can move `<your_datadir>/erigon/nodes` folder somewhere for backup and Erigon will start work. ",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888991909/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888993353",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/2465#issuecomment-888993353",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/2465",
    "id": 888993353,
    "node_id": "IC_kwDOC0FsAM40_PZJ",
    "user": {
      "login": "Wiezzel",
      "id": 9394821,
      "node_id": "MDQ6VXNlcjkzOTQ4MjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9394821?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Wiezzel",
      "html_url": "https://github.com/Wiezzel",
      "followers_url": "https://api.github.com/users/Wiezzel/followers",
      "following_url": "https://api.github.com/users/Wiezzel/following{/other_user}",
      "gists_url": "https://api.github.com/users/Wiezzel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Wiezzel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Wiezzel/subscriptions",
      "organizations_url": "https://api.github.com/users/Wiezzel/orgs",
      "repos_url": "https://api.github.com/users/Wiezzel/repos",
      "events_url": "https://api.github.com/users/Wiezzel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Wiezzel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-29T10:17:08Z",
    "updated_at": "2021-07-29T10:17:08Z",
    "author_association": "NONE",
    "body": "@AskAlexSharov Ooops, I have already overwritten my data directory when restoring from backup. I'm sorry. Next time when I notice this error I will upload my nodes DB here.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/888993353/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
