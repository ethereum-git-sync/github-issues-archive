{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/7817",
  "id": 1779285358,
  "node_id": "I_kwDOC0FsAM5qDb1u",
  "number": 7817,
  "title": "No apparent activity after snapshots verification + crash",
  "user": {
    "login": "wmitsuda",
    "id": 28685,
    "node_id": "MDQ6VXNlcjI4Njg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/28685?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wmitsuda",
    "html_url": "https://github.com/wmitsuda",
    "followers_url": "https://api.github.com/users/wmitsuda/followers",
    "following_url": "https://api.github.com/users/wmitsuda/following{/other_user}",
    "gists_url": "https://api.github.com/users/wmitsuda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wmitsuda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wmitsuda/subscriptions",
    "organizations_url": "https://api.github.com/users/wmitsuda/orgs",
    "repos_url": "https://api.github.com/users/wmitsuda/repos",
    "events_url": "https://api.github.com/users/wmitsuda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wmitsuda/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-06-28T16:19:55Z",
  "updated_at": "2023-06-28T23:53:00Z",
  "closed_at": null,
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "v2.47.0, syncing a brand new mainnet node + caplin\r\n\r\nAfter finishing torrent download + verification, there was no more logs, only caplin idle logs, but IIRC at that time there should be torrent indexing.\r\n\r\nif that's the case, I think a possible improvement is to have a ticker log so we know what is happening:\r\n\r\n```\r\nINFO[06-28|02:28:21.362] [snapshots] Verify                       progress=91.85%\r\nINFO[06-28|02:28:41.364] [snapshots] Verify                       progress=95.21%\r\nINFO[06-28|02:28:41.844] [Caplin] P2P                             peers=33\r\nINFO[06-28|02:29:01.362] [snapshots] Verify                       progress=97.52%\r\nINFO[06-28|02:29:16.811] [snapshots] Verify done\r\nINFO[06-28|02:29:16.812] [1/15 Snapshots] download finished       time=6h6m55.450290656s\r\nINFO[06-28|02:29:21.344] [txpool] stat                            pending=0 baseFee=0 queued=2587 alloc=3.0GB sys=5.2G\r\nB\r\nINFO[06-28|02:29:26.896] [snapshots] Blocks Stat                  blocks=0k indices=0k alloc=4.8GB sys=5.3GB\r\nINFO[06-28|02:29:41.843] [Caplin] P2P                             peers=33\r\nINFO[06-28|02:30:19.682] [p2p] GoodPeers                          eth68=100 eth67=29 eth66=4\r\nINFO[06-28|02:30:21.345] [txpool] stat                            pending=0 baseFee=0 queued=2587 alloc=5.0GB sys=9.5G\r\nB\r\nINFO[06-28|02:30:41.843] [Caplin] P2P                             peers=33\r\nINFO[06-28|02:31:21.345] [txpool] stat                            pending=0 baseFee=0 queued=2587 alloc=7.1GB sys=10.3\r\nGB\r\nINFO[06-28|02:31:41.843] [Caplin] P2P                             peers=33\r\nINFO[06-28|02:32:19.683] [p2p] GoodPeers                          eth68=100 eth66=4 eth67=29\r\nINFO[06-28|02:32:21.348] [txpool] stat                            pending=0 baseFee=0 queued=2587 alloc=9.3GB sys=12.8\r\nGB\r\n```\r\n\r\nAfter a few minutes, the node crashed:\r\n\r\n```\r\nINFO[06-28|02:48:21.347] [txpool] stat                            pending=0 baseFee=0 queued=2587 alloc=7.2GB sys=13.8\r\nGB\r\nINFO[06-28|02:48:41.854] [Caplin] P2P                             peers=33\r\n./run-erigon2-gcloud.sh: line 14: 36362 Killed                  ~/erigon/build/bin/erigon --datadir /mnt/erigon --http\r\n --http.api \"eth,net,web3,erigon,debug,txpool,trace,ots\" --ws --http.corsdomain \"*\" --http.addr \"0.0.0.0\" --http.vhost\r\ns '*' --authrpc.addr \"0.0.0.0\" --authrpc.vhosts '*' --internalcl --rpc.batch.limit 500\r\n```\r\n\r\nnot sure why, but I guess out of memory maybe? Using a 16GB machine (c2-standard-4 on gcloud).\r\n\r\nI restarted the process and there are no logs again, but I can see on htop CPUs are all busy, so I guess the ticker log suggestion holds + should the 16GB memory requirement be revisited in docs maybe?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612163267",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7817#issuecomment-1612163267",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817",
    "id": 1612163267,
    "node_id": "IC_kwDOC0FsAM5gF6jD",
    "user": {
      "login": "wmitsuda",
      "id": 28685,
      "node_id": "MDQ6VXNlcjI4Njg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/28685?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wmitsuda",
      "html_url": "https://github.com/wmitsuda",
      "followers_url": "https://api.github.com/users/wmitsuda/followers",
      "following_url": "https://api.github.com/users/wmitsuda/following{/other_user}",
      "gists_url": "https://api.github.com/users/wmitsuda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wmitsuda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wmitsuda/subscriptions",
      "organizations_url": "https://api.github.com/users/wmitsuda/orgs",
      "repos_url": "https://api.github.com/users/wmitsuda/repos",
      "events_url": "https://api.github.com/users/wmitsuda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wmitsuda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-28T22:01:45Z",
    "updated_at": "2023-06-28T22:01:45Z",
    "author_association": "COLLABORATOR",
    "body": "update: it took a few hours for the indexing to start, also in the meantime there was a period the machine got completely unresponsive, had to restart it.\r\n\r\n```\r\nINFO[06-28|21:45:18.290] [Caplin] P2P                             peers=33\r\nINFO[06-28|21:45:49.489] [p2p] GoodPeers                          eth68=44 eth67=28 eth66=4\r\nINFO[06-28|21:45:52.015] [txpool] stat                            pending=207 baseFee=0 queued=2589 alloc=5.8GB sys=15\r\n.6GB\r\nINFO[06-28|21:46:18.288] [Caplin] P2P                             peers=33\r\nINFO[06-28|21:46:47.270] [1/15 Snapshots] Indexing                progress=\"v1-015500-016000-transactions.seg=12%, v1-\r\n016000-016500-transactions.seg=7%, v1-016500-017000-transactions.seg=1%\" total-indexing-time=1h12m43s alloc=9.3GB sys=\r\n15.6GB\r\nINFO[06-28|21:46:52.013] [txpool] stat                            pending=207 baseFee=0 queued=2589 alloc=9.4GB sys=15\r\n.6GB\r\nINFO[06-28|21:47:07.270] [1/15 Snapshots] Indexing                progress=\"v1-015500-016000-transactions.seg=13%, v1-\r\n016000-016500-transactions.seg=8%, v1-016500-017000-transactions.seg=2%\" total-indexing-time=1h13m3s alloc=10.0GB sys=\r\n15.6GB\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612163267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612166658",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7817#issuecomment-1612166658",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817",
    "id": 1612166658,
    "node_id": "IC_kwDOC0FsAM5gF7YC",
    "user": {
      "login": "wmitsuda",
      "id": 28685,
      "node_id": "MDQ6VXNlcjI4Njg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/28685?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wmitsuda",
      "html_url": "https://github.com/wmitsuda",
      "followers_url": "https://api.github.com/users/wmitsuda/followers",
      "following_url": "https://api.github.com/users/wmitsuda/following{/other_user}",
      "gists_url": "https://api.github.com/users/wmitsuda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wmitsuda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wmitsuda/subscriptions",
      "organizations_url": "https://api.github.com/users/wmitsuda/orgs",
      "repos_url": "https://api.github.com/users/wmitsuda/repos",
      "events_url": "https://api.github.com/users/wmitsuda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wmitsuda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-28T22:03:19Z",
    "updated_at": "2023-06-28T22:03:19Z",
    "author_association": "COLLABORATOR",
    "body": "my suggestion is to have at least a ticker log inside such process between finish torrent download - torrent indexing start, otherwise users have no idea what the sync process is doing.",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612166658/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612249635",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/7817#issuecomment-1612249635",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/7817",
    "id": 1612249635,
    "node_id": "IC_kwDOC0FsAM5gGPoj",
    "user": {
      "login": "AskAlexSharov",
      "id": 46885206,
      "node_id": "MDQ6VXNlcjQ2ODg1MjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/46885206?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AskAlexSharov",
      "html_url": "https://github.com/AskAlexSharov",
      "followers_url": "https://api.github.com/users/AskAlexSharov/followers",
      "following_url": "https://api.github.com/users/AskAlexSharov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AskAlexSharov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AskAlexSharov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AskAlexSharov/subscriptions",
      "organizations_url": "https://api.github.com/users/AskAlexSharov/orgs",
      "repos_url": "https://api.github.com/users/AskAlexSharov/repos",
      "events_url": "https://api.github.com/users/AskAlexSharov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AskAlexSharov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-28T23:53:00Z",
    "updated_at": "2023-06-28T23:53:00Z",
    "author_association": "COLLABORATOR",
    "body": "Try reduce GOMAXPROCS",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/1612249635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
