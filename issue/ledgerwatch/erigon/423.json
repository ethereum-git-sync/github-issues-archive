{
  "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423",
  "repository_url": "https://api.github.com/repos/ledgerwatch/erigon",
  "labels_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423/labels{/name}",
  "comments_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423/comments",
  "events_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423/events",
  "html_url": "https://github.com/ledgerwatch/erigon/issues/423",
  "id": 591135891,
  "node_id": "MDU6SXNzdWU1OTExMzU4OTE=",
  "number": 423,
  "title": "De-hash Change Sets",
  "user": {
    "login": "yperbasis",
    "id": 34320705,
    "node_id": "MDQ6VXNlcjM0MzIwNzA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/34320705?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yperbasis",
    "html_url": "https://github.com/yperbasis",
    "followers_url": "https://api.github.com/users/yperbasis/followers",
    "following_url": "https://api.github.com/users/yperbasis/following{/other_user}",
    "gists_url": "https://api.github.com/users/yperbasis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yperbasis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yperbasis/subscriptions",
    "organizations_url": "https://api.github.com/users/yperbasis/orgs",
    "repos_url": "https://api.github.com/users/yperbasis/repos",
    "events_url": "https://api.github.com/users/yperbasis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yperbasis/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "b00ris",
    "id": 4943570,
    "node_id": "MDQ6VXNlcjQ5NDM1NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4943570?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/b00ris",
    "html_url": "https://github.com/b00ris",
    "followers_url": "https://api.github.com/users/b00ris/followers",
    "following_url": "https://api.github.com/users/b00ris/following{/other_user}",
    "gists_url": "https://api.github.com/users/b00ris/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/b00ris/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/b00ris/subscriptions",
    "organizations_url": "https://api.github.com/users/b00ris/orgs",
    "repos_url": "https://api.github.com/users/b00ris/repos",
    "events_url": "https://api.github.com/users/b00ris/events{/privacy}",
    "received_events_url": "https://api.github.com/users/b00ris/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "b00ris",
      "id": 4943570,
      "node_id": "MDQ6VXNlcjQ5NDM1NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4943570?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/b00ris",
      "html_url": "https://github.com/b00ris",
      "followers_url": "https://api.github.com/users/b00ris/followers",
      "following_url": "https://api.github.com/users/b00ris/following{/other_user}",
      "gists_url": "https://api.github.com/users/b00ris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/b00ris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/b00ris/subscriptions",
      "organizations_url": "https://api.github.com/users/b00ris/orgs",
      "repos_url": "https://api.github.com/users/b00ris/repos",
      "events_url": "https://api.github.com/users/b00ris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/b00ris/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-03-31T14:02:07Z",
  "updated_at": "2020-04-15T09:57:55Z",
  "closed_at": "2020-04-15T09:57:55Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "in our ChangeSet buckets, we currently have address hashes and storage key hashes + corresponding values\r\nand they are sorted by those values, so we can find an item by binary search easily\r\nthere was another potential use case for the ChangeSets. When (and if) we get to support of LES protocol (light clients), we will need to produce merkle proofs of some accounts and storage items which are not current, but slightly in the past\r\nso what we will do is to extract the proof as if it was for the current state\r\nand then try to apply ChangeSets backwards until we get to the required point in history\r\nI initially thought that we might be able to avoid applying the entire ChangeSets, and instead apply only the bits around the accounts and storage items we need. But this thinking is flawed, as i understand now\r\nso we will need to apply entire ChangeSets backwards\r\nSo, now is the idea\r\nI wonder if we can use addresses (instead of address Hashes) and storage keys (instead of storage key hashes) in the ChangeSets\r\nthe reason it would be attractive is that you can split out preimage generation as a separate step, which does not have to happen at the same time as the block execution (currently it does)\r\nMeaning we can have following stages of sync:\r\n1. Download headers\r\n2. Download block bodies\r\n3. Execute blocks (generate ChangeSets and final state and receipts).\r\nAnd then optional stages\r\n4. Generate preimages\r\n5. Generate tx lookups\r\n\r\nAnd, by extension, the indices can also be based on addresses and storage keys rather than on address hashes and storage key hashes\r\nit will speed up the tx tracing tiny bit, at the expense of slower reorgs",
  "closed_by": {
    "login": "AlexeyAkhunov",
    "id": 13686139,
    "node_id": "MDQ6VXNlcjEzNjg2MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexeyAkhunov",
    "html_url": "https://github.com/AlexeyAkhunov",
    "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
    "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
    "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
    "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/612495584",
    "html_url": "https://github.com/ledgerwatch/erigon/issues/423#issuecomment-612495584",
    "issue_url": "https://api.github.com/repos/ledgerwatch/erigon/issues/423",
    "id": 612495584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjQ5NTU4NA==",
    "user": {
      "login": "AlexeyAkhunov",
      "id": 13686139,
      "node_id": "MDQ6VXNlcjEzNjg2MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13686139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexeyAkhunov",
      "html_url": "https://github.com/AlexeyAkhunov",
      "followers_url": "https://api.github.com/users/AlexeyAkhunov/followers",
      "following_url": "https://api.github.com/users/AlexeyAkhunov/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexeyAkhunov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexeyAkhunov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexeyAkhunov/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexeyAkhunov/orgs",
      "repos_url": "https://api.github.com/users/AlexeyAkhunov/repos",
      "events_url": "https://api.github.com/users/AlexeyAkhunov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexeyAkhunov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-11T19:22:14Z",
    "updated_at": "2020-04-11T19:22:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "While writing WalkAsOf implementation for THIN_HISTORY, I realised that we won't be able to support WalkAsOf in the current way if we do the De-Hashing.\r\n\r\nBecause the way we do WalkAsOf relies on walking simultaneously over the current state (which uses hashes) and the history (which also uses hashes, but would use preimages if we do De-hashing)\r\nso I think we won't do it for the Release1. The way to make it work is to also maintain the De-hashed version of the current state. this might be interesting direction to explore, but it is definitely much more work than we want to do for the first release",
    "reactions": {
      "url": "https://api.github.com/repos/ledgerwatch/erigon/issues/comments/612495584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
