{
  "url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
  "repository_url": "https://api.github.com/repos/matter-labs/zksync",
  "labels_url": "https://api.github.com/repos/matter-labs/zksync/issues/270/labels{/name}",
  "comments_url": "https://api.github.com/repos/matter-labs/zksync/issues/270/comments",
  "events_url": "https://api.github.com/repos/matter-labs/zksync/issues/270/events",
  "html_url": "https://github.com/matter-labs/zksync/issues/270",
  "id": 770086750,
  "node_id": "MDU6SXNzdWU3NzAwODY3NTA=",
  "number": 270,
  "title": "EIP1271 signature recovery support for Gnosis safe",
  "user": {
    "login": "junaidev",
    "id": 36687850,
    "node_id": "MDQ6VXNlcjM2Njg3ODUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/36687850?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/junaidev",
    "html_url": "https://github.com/junaidev",
    "followers_url": "https://api.github.com/users/junaidev/followers",
    "following_url": "https://api.github.com/users/junaidev/following{/other_user}",
    "gists_url": "https://api.github.com/users/junaidev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/junaidev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/junaidev/subscriptions",
    "organizations_url": "https://api.github.com/users/junaidev/orgs",
    "repos_url": "https://api.github.com/users/junaidev/repos",
    "events_url": "https://api.github.com/users/junaidev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/junaidev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-12-17T14:20:06Z",
  "updated_at": "2023-04-28T17:02:17Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\nCurrently zk sync server is unable to recover EIP 1271 signature via gnosis safe implementation of `isValidSignature(...)` . \r\n\r\n`isValidSignature()` of Gnosis safe supports following: \r\n\r\n-     it hash message using format according to its `getMessageHash()` and then adds message prefix and then hash it again before applying ecrecover.\r\n\r\n-     it apply ecrecover on message hash ( original message with out prefix is hashed using `getMessageHash()` )\r\n\r\n\r\nin Zk sync the message is passed along with prefix and its length, so it doesn't work.\r\n\r\nPurposed Change: For supporting EIP 1271 for gnosis safe, need to remove prefix before message.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/270/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/matter-labs/zksync/issues/270/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/747500400",
    "html_url": "https://github.com/matter-labs/zksync/issues/270#issuecomment-747500400",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
    "id": 747500400,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NzUwMDQwMA==",
    "user": {
      "login": "popzxc",
      "id": 12111581,
      "node_id": "MDQ6VXNlcjEyMTExNTgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/popzxc",
      "html_url": "https://github.com/popzxc",
      "followers_url": "https://api.github.com/users/popzxc/followers",
      "following_url": "https://api.github.com/users/popzxc/following{/other_user}",
      "gists_url": "https://api.github.com/users/popzxc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/popzxc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/popzxc/subscriptions",
      "organizations_url": "https://api.github.com/users/popzxc/orgs",
      "repos_url": "https://api.github.com/users/popzxc/repos",
      "events_url": "https://api.github.com/users/popzxc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/popzxc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-17T15:15:14Z",
    "updated_at": "2020-12-17T15:15:14Z",
    "author_association": "MEMBER",
    "body": "Actually, this is done intentionally, since some signers always add this prefix.\r\nIn case of the wallet not adding the prefix, it is always possible to add the prefix, but not vise versa.\r\n\r\nFor example, in `zksync.js` you can provide an `EthSignerType` argument in which you can describe whether the signer is adding prefixes to messages or not. [It is described in docs](https://zksync.io/sdk/js/accounts.html#creating-wallet-from-eth-signer).\r\n\r\nIf this argument is omitted, `zksync.js` will try to deduce whether the signer adds prefixes automatically, but for EIP1271 it's not as easy as for ECDSA signatures.\r\n\r\nAnyway, no matter which kind of signer and/or SDK is used, it is always possible to sign the expected messages.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/747500400/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/753965886",
    "html_url": "https://github.com/matter-labs/zksync/issues/270#issuecomment-753965886",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
    "id": 753965886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1Mzk2NTg4Ng==",
    "user": {
      "login": "junaidev",
      "id": 36687850,
      "node_id": "MDQ6VXNlcjM2Njg3ODUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/36687850?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/junaidev",
      "html_url": "https://github.com/junaidev",
      "followers_url": "https://api.github.com/users/junaidev/followers",
      "following_url": "https://api.github.com/users/junaidev/following{/other_user}",
      "gists_url": "https://api.github.com/users/junaidev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/junaidev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/junaidev/subscriptions",
      "organizations_url": "https://api.github.com/users/junaidev/orgs",
      "repos_url": "https://api.github.com/users/junaidev/repos",
      "events_url": "https://api.github.com/users/junaidev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/junaidev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-04T13:10:14Z",
    "updated_at": "2021-01-04T13:10:14Z",
    "author_association": "NONE",
    "body": "Some signers but not all might, depends on requirement.\r\n\r\nIn case of EIP1271 recovery `is_eip1271_signature_correct(...)`  https://github.com/matter-labs/zksync/blob/47bb16fe233d2695c50ccf291dc77dd9f0036dd0/core/bin/zksync_api/src/eth_checker.rs#L55  you are \"**always**\" adding prefix via get_sign_message(...) https://github.com/matter-labs/zksync/blob/47bb16fe233d2695c50ccf291dc77dd9f0036dd0/core/bin/zksync_api/src/eth_checker.rs#L46 \r\nbefore passing to `isValidSignature` which doent work with gnosis safe https://github.com/gnosis/safe-contracts/blob/development/contracts/GnosisSafe.sol#L325 . Reason explained in above issue opened. so for supporting zksync wallet with L1 n of k style multisig ( Gnosis safe multisig ) this needs to be fixed.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/753965886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1504755549",
    "html_url": "https://github.com/matter-labs/zksync/issues/270#issuecomment-1504755549",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
    "id": 1504755549,
    "node_id": "IC_kwDOC0aUls5ZsL9d",
    "user": {
      "login": "Kuzirashi",
      "id": 4950658,
      "node_id": "MDQ6VXNlcjQ5NTA2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4950658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kuzirashi",
      "html_url": "https://github.com/Kuzirashi",
      "followers_url": "https://api.github.com/users/Kuzirashi/followers",
      "following_url": "https://api.github.com/users/Kuzirashi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kuzirashi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kuzirashi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kuzirashi/subscriptions",
      "organizations_url": "https://api.github.com/users/Kuzirashi/orgs",
      "repos_url": "https://api.github.com/users/Kuzirashi/repos",
      "events_url": "https://api.github.com/users/Kuzirashi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kuzirashi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-12T06:51:15Z",
    "updated_at": "2023-04-12T06:51:15Z",
    "author_association": "NONE",
    "body": "Is this issue a blocker for deploying Safe on current zksync testnet or should it work despite this?",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1504755549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1504966100",
    "html_url": "https://github.com/matter-labs/zksync/issues/270#issuecomment-1504966100",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
    "id": 1504966100,
    "node_id": "IC_kwDOC0aUls5Zs_XU",
    "user": {
      "login": "YoleYu",
      "id": 1829003,
      "node_id": "MDQ6VXNlcjE4MjkwMDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1829003?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YoleYu",
      "html_url": "https://github.com/YoleYu",
      "followers_url": "https://api.github.com/users/YoleYu/followers",
      "following_url": "https://api.github.com/users/YoleYu/following{/other_user}",
      "gists_url": "https://api.github.com/users/YoleYu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YoleYu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YoleYu/subscriptions",
      "organizations_url": "https://api.github.com/users/YoleYu/orgs",
      "repos_url": "https://api.github.com/users/YoleYu/repos",
      "events_url": "https://api.github.com/users/YoleYu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YoleYu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-12T09:35:34Z",
    "updated_at": "2023-04-12T09:35:34Z",
    "author_association": "NONE",
    "body": " any update on Era ?",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1504966100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1527838403",
    "html_url": "https://github.com/matter-labs/zksync/issues/270#issuecomment-1527838403",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
    "id": 1527838403,
    "node_id": "IC_kwDOC0aUls5bEPbD",
    "user": {
      "login": "bxpana",
      "id": 42230936,
      "node_id": "MDQ6VXNlcjQyMjMwOTM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/42230936?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bxpana",
      "html_url": "https://github.com/bxpana",
      "followers_url": "https://api.github.com/users/bxpana/followers",
      "following_url": "https://api.github.com/users/bxpana/following{/other_user}",
      "gists_url": "https://api.github.com/users/bxpana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bxpana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bxpana/subscriptions",
      "organizations_url": "https://api.github.com/users/bxpana/orgs",
      "repos_url": "https://api.github.com/users/bxpana/repos",
      "events_url": "https://api.github.com/users/bxpana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bxpana/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T17:01:50Z",
    "updated_at": "2023-04-28T17:01:50Z",
    "author_association": "NONE",
    "body": "> Is this issue a blocker for deploying Safe on current zksync testnet or should it work despite this?\r\n\r\nTo my understanding Safe won't be available on zkSync Lite, but will be deployed on zkSync Era. ",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1527838403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1527838945",
    "html_url": "https://github.com/matter-labs/zksync/issues/270#issuecomment-1527838945",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/270",
    "id": 1527838945,
    "node_id": "IC_kwDOC0aUls5bEPjh",
    "user": {
      "login": "bxpana",
      "id": 42230936,
      "node_id": "MDQ6VXNlcjQyMjMwOTM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/42230936?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bxpana",
      "html_url": "https://github.com/bxpana",
      "followers_url": "https://api.github.com/users/bxpana/followers",
      "following_url": "https://api.github.com/users/bxpana/following{/other_user}",
      "gists_url": "https://api.github.com/users/bxpana/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bxpana/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bxpana/subscriptions",
      "organizations_url": "https://api.github.com/users/bxpana/orgs",
      "repos_url": "https://api.github.com/users/bxpana/repos",
      "events_url": "https://api.github.com/users/bxpana/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bxpana/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T17:02:16Z",
    "updated_at": "2023-04-28T17:02:16Z",
    "author_association": "NONE",
    "body": "> any update on Era ?\r\n\r\nhttps://blog.matter-labs.io/gm-zkevm-171b12a26b36",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/1527838945/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
