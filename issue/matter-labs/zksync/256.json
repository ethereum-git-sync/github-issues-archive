{
  "url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
  "repository_url": "https://api.github.com/repos/matter-labs/zksync",
  "labels_url": "https://api.github.com/repos/matter-labs/zksync/issues/256/labels{/name}",
  "comments_url": "https://api.github.com/repos/matter-labs/zksync/issues/256/comments",
  "events_url": "https://api.github.com/repos/matter-labs/zksync/issues/256/events",
  "html_url": "https://github.com/matter-labs/zksync/issues/256",
  "id": 743770239,
  "node_id": "MDU6SXNzdWU3NDM3NzAyMzk=",
  "number": 256,
  "title": "Supporting Contract Signatures for undeployed contracts",
  "user": {
    "login": "simon-jentzsch",
    "id": 10868622,
    "node_id": "MDQ6VXNlcjEwODY4NjIy",
    "avatar_url": "https://avatars.githubusercontent.com/u/10868622?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simon-jentzsch",
    "html_url": "https://github.com/simon-jentzsch",
    "followers_url": "https://api.github.com/users/simon-jentzsch/followers",
    "following_url": "https://api.github.com/users/simon-jentzsch/following{/other_user}",
    "gists_url": "https://api.github.com/users/simon-jentzsch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simon-jentzsch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simon-jentzsch/subscriptions",
    "organizations_url": "https://api.github.com/users/simon-jentzsch/orgs",
    "repos_url": "https://api.github.com/users/simon-jentzsch/repos",
    "events_url": "https://api.github.com/users/simon-jentzsch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simon-jentzsch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-11-16T11:45:39Z",
  "updated_at": "2021-01-21T13:27:31Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Currently L1-Accounts as Multisig are supported by checking the Contract Signature with EIP-1271 on the server and an L1 authorization when setting the pub key using `setAuthPubkeyHash`.\r\n\r\nBut this requires a Contract to be deployed on L1 first. As a feature request, we would love to support signature verification without deploying the contract.\r\nThis means as part of the contract signature we could pass the code of the deployment-transaction for L1. In order to verify we need to \r\n- create a EVM\r\n- deploy the tx-code\r\n- call `isValidSignature` for the account.\r\n\r\nTo optimize we may cache the code or even better offer precompiled modules handling the logic directly based on the tx-data. ( For most Multisigs this could easily be implemented as Rust-Code)\r\nBut since there are 2 places we need to verify signatures (the Rust-Code and in the SolidityContract), this would also need to implemented this check in the `verifyChangePubkeySignature`function  in the smart contract.\r\n\r\nWe would love to support you, since this is an important feature, which would bring down deployment costs and would allow us to use multisigs in zksync without deploying them.\r\n\r\n\r\n\r\n  ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/256/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/matter-labs/zksync/issues/256/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/729389304",
    "html_url": "https://github.com/matter-labs/zksync/issues/256#issuecomment-729389304",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
    "id": 729389304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyOTM4OTMwNA==",
    "user": {
      "login": "dvush",
      "id": 21145096,
      "node_id": "MDQ6VXNlcjIxMTQ1MDk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/21145096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dvush",
      "html_url": "https://github.com/dvush",
      "followers_url": "https://api.github.com/users/dvush/followers",
      "following_url": "https://api.github.com/users/dvush/following{/other_user}",
      "gists_url": "https://api.github.com/users/dvush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dvush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dvush/subscriptions",
      "organizations_url": "https://api.github.com/users/dvush/orgs",
      "repos_url": "https://api.github.com/users/dvush/repos",
      "events_url": "https://api.github.com/users/dvush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dvush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-18T03:59:00Z",
    "updated_at": "2020-11-18T03:59:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "> As a feature request, we would love to support signature verification without deploying the contract.\r\n\r\nGreat! We are implementing this feature right now.\r\n\r\nHere how it would work:\r\n\r\nYou generate zkSync private key and compute your account address using `CREATE2` spec where `salt` is hashed zkSync pubkey_hash. Then you can set this pubkey_hash as signing key.\r\n\r\nPrototype https://github.com/matter-labs/create2-example",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/729389304/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/730211043",
    "html_url": "https://github.com/matter-labs/zksync/issues/256#issuecomment-730211043",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
    "id": 730211043,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMDIxMTA0Mw==",
    "user": {
      "login": "simon-jentzsch",
      "id": 10868622,
      "node_id": "MDQ6VXNlcjEwODY4NjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/10868622?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/simon-jentzsch",
      "html_url": "https://github.com/simon-jentzsch",
      "followers_url": "https://api.github.com/users/simon-jentzsch/followers",
      "following_url": "https://api.github.com/users/simon-jentzsch/following{/other_user}",
      "gists_url": "https://api.github.com/users/simon-jentzsch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/simon-jentzsch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/simon-jentzsch/subscriptions",
      "organizations_url": "https://api.github.com/users/simon-jentzsch/orgs",
      "repos_url": "https://api.github.com/users/simon-jentzsch/repos",
      "events_url": "https://api.github.com/users/simon-jentzsch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/simon-jentzsch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-19T08:24:39Z",
    "updated_at": "2020-11-19T08:24:39Z",
    "author_association": "NONE",
    "body": "This is awesome! I will test it out and let you know in case of any issues!",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/730211043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/731289380",
    "html_url": "https://github.com/matter-labs/zksync/issues/256#issuecomment-731289380",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
    "id": 731289380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTI4OTM4MA==",
    "user": {
      "login": "simon-jentzsch",
      "id": 10868622,
      "node_id": "MDQ6VXNlcjEwODY4NjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/10868622?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/simon-jentzsch",
      "html_url": "https://github.com/simon-jentzsch",
      "followers_url": "https://api.github.com/users/simon-jentzsch/followers",
      "following_url": "https://api.github.com/users/simon-jentzsch/following{/other_user}",
      "gists_url": "https://api.github.com/users/simon-jentzsch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/simon-jentzsch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/simon-jentzsch/subscriptions",
      "organizations_url": "https://api.github.com/users/simon-jentzsch/orgs",
      "repos_url": "https://api.github.com/users/simon-jentzsch/repos",
      "events_url": "https://api.github.com/users/simon-jentzsch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/simon-jentzsch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-20T17:05:58Z",
    "updated_at": "2020-11-20T18:43:13Z",
    "author_association": "NONE",
    "body": "Yes, just tested it and this would indeed work for us! Tanks a lot.\r\nThere is only one issue:\r\nCurrently the salt is calculated from the signer key and the used to calc the address of the account.\r\n\r\nSince we are deploying the gnosis safe, this would not work, because the safe will hash the initiator-data to the salt, which means in order to verify, we have to also add this as well.\r\nI assume this is what the `saltArg` does. But at the moment the gnosis safe simply uses exactly the opposite order. \r\n\r\n\r\n```js\r\n// gnosis safe\r\nbytes32 salt = keccak256(abi.encodePacked(keccak256(initializer), saltNonce));\r\n```\r\n\r\nhttps://github.com/gnosis/safe-contracts/blob/development/contracts/proxies/GnosisSafeProxyFactory.sol#L47\r\n\r\nSo If we could have the saltArg as first argument, this would work with the gnosis safe.\r\nDo you see a chance switching the order here:\r\n\r\n\r\n```js\r\n// zksync\r\nbytes32 salt = keccak256(abi.encodePacked(_newPkHash,saltArg)); \r\n```\r\nhttps://github.com/matter-labs/zksync/blob/create2-deployment/contracts/contracts/ZkSync.sol#L613\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/731289380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/734455194",
    "html_url": "https://github.com/matter-labs/zksync/issues/256#issuecomment-734455194",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
    "id": 734455194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDQ1NTE5NA==",
    "user": {
      "login": "simon-jentzsch",
      "id": 10868622,
      "node_id": "MDQ6VXNlcjEwODY4NjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/10868622?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/simon-jentzsch",
      "html_url": "https://github.com/simon-jentzsch",
      "followers_url": "https://api.github.com/users/simon-jentzsch/followers",
      "following_url": "https://api.github.com/users/simon-jentzsch/following{/other_user}",
      "gists_url": "https://api.github.com/users/simon-jentzsch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/simon-jentzsch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/simon-jentzsch/subscriptions",
      "organizations_url": "https://api.github.com/users/simon-jentzsch/orgs",
      "repos_url": "https://api.github.com/users/simon-jentzsch/repos",
      "events_url": "https://api.github.com/users/simon-jentzsch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/simon-jentzsch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-26T19:38:14Z",
    "updated_at": "2020-11-26T19:38:14Z",
    "author_association": "NONE",
    "body": "I just created a small PR to simply switch the order: https://github.com/matter-labs/zksync/pull/259",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/734455194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/736342560",
    "html_url": "https://github.com/matter-labs/zksync/issues/256#issuecomment-736342560",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
    "id": 736342560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNjM0MjU2MA==",
    "user": {
      "login": "dvush",
      "id": 21145096,
      "node_id": "MDQ6VXNlcjIxMTQ1MDk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/21145096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dvush",
      "html_url": "https://github.com/dvush",
      "followers_url": "https://api.github.com/users/dvush/followers",
      "following_url": "https://api.github.com/users/dvush/following{/other_user}",
      "gists_url": "https://api.github.com/users/dvush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dvush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dvush/subscriptions",
      "organizations_url": "https://api.github.com/users/dvush/orgs",
      "repos_url": "https://api.github.com/users/dvush/repos",
      "events_url": "https://api.github.com/users/dvush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dvush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-01T09:29:56Z",
    "updated_at": "2020-12-01T09:29:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, great that you reported it now, since we did not upgrade our contracts yet.",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/736342560/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/764641568",
    "html_url": "https://github.com/matter-labs/zksync/issues/256#issuecomment-764641568",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/256",
    "id": 764641568,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NDY0MTU2OA==",
    "user": {
      "login": "simon-jentzsch",
      "id": 10868622,
      "node_id": "MDQ6VXNlcjEwODY4NjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/10868622?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/simon-jentzsch",
      "html_url": "https://github.com/simon-jentzsch",
      "followers_url": "https://api.github.com/users/simon-jentzsch/followers",
      "following_url": "https://api.github.com/users/simon-jentzsch/following{/other_user}",
      "gists_url": "https://api.github.com/users/simon-jentzsch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/simon-jentzsch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/simon-jentzsch/subscriptions",
      "organizations_url": "https://api.github.com/users/simon-jentzsch/orgs",
      "repos_url": "https://api.github.com/users/simon-jentzsch/repos",
      "events_url": "https://api.github.com/users/simon-jentzsch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/simon-jentzsch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-21T13:26:56Z",
    "updated_at": "2021-01-21T13:27:31Z",
    "author_association": "NONE",
    "body": "By the way I made a small change in the pull-request and actually tested it with the gnosis safe. (I added padding to 32bytes for the pub_key_hash when hashing, because this is how all the gnosis safes are deployed) Now It works! \r\nI generated a seed and from this the pub_key_hash. Deployed the GnosisSafeFactory, (which is the creatorAddress in this case) and used the codehas of the Proxy. Based on this I calculated the my account-address. and submitted a ChnagePubKey-tx, which was successfully executed and verified.\r\nAlso transfer- and withdraw worked great.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/764641568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
