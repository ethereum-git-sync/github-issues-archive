{
  "url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
  "repository_url": "https://api.github.com/repos/matter-labs/zksync",
  "labels_url": "https://api.github.com/repos/matter-labs/zksync/issues/310/labels{/name}",
  "comments_url": "https://api.github.com/repos/matter-labs/zksync/issues/310/comments",
  "events_url": "https://api.github.com/repos/matter-labs/zksync/issues/310/events",
  "html_url": "https://github.com/matter-labs/zksync/issues/310",
  "id": 868512535,
  "node_id": "MDU6SXNzdWU4Njg1MTI1MzU=",
  "number": 310,
  "title": "data_restore will fail when the length of Verified event is longer than Committed event",
  "user": {
    "login": "yaanhyy",
    "id": 5064036,
    "node_id": "MDQ6VXNlcjUwNjQwMzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5064036?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yaanhyy",
    "html_url": "https://github.com/yaanhyy",
    "followers_url": "https://api.github.com/users/yaanhyy/followers",
    "following_url": "https://api.github.com/users/yaanhyy/following{/other_user}",
    "gists_url": "https://api.github.com/users/yaanhyy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yaanhyy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yaanhyy/subscriptions",
    "organizations_url": "https://api.github.com/users/yaanhyy/orgs",
    "repos_url": "https://api.github.com/users/yaanhyy/repos",
    "events_url": "https://api.github.com/users/yaanhyy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yaanhyy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Deniallugo",
    "id": 8031374,
    "node_id": "MDQ6VXNlcjgwMzEzNzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8031374?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Deniallugo",
    "html_url": "https://github.com/Deniallugo",
    "followers_url": "https://api.github.com/users/Deniallugo/followers",
    "following_url": "https://api.github.com/users/Deniallugo/following{/other_user}",
    "gists_url": "https://api.github.com/users/Deniallugo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Deniallugo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Deniallugo/subscriptions",
    "organizations_url": "https://api.github.com/users/Deniallugo/orgs",
    "repos_url": "https://api.github.com/users/Deniallugo/repos",
    "events_url": "https://api.github.com/users/Deniallugo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Deniallugo/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Deniallugo",
      "id": 8031374,
      "node_id": "MDQ6VXNlcjgwMzEzNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8031374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Deniallugo",
      "html_url": "https://github.com/Deniallugo",
      "followers_url": "https://api.github.com/users/Deniallugo/followers",
      "following_url": "https://api.github.com/users/Deniallugo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Deniallugo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Deniallugo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Deniallugo/subscriptions",
      "organizations_url": "https://api.github.com/users/Deniallugo/orgs",
      "repos_url": "https://api.github.com/users/Deniallugo/repos",
      "events_url": "https://api.github.com/users/Deniallugo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Deniallugo/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-04-27T06:41:04Z",
  "updated_at": "2022-03-30T16:15:44Z",
  "closed_at": "2022-03-30T16:15:44Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "https://github.com/matter-labs/zksync/blob/59e6def837099021169c35b7db7d7641f1a03b3b/core/bin/data_restore/src/events_state.rs#L364-L374\r\n\r\nwhen   self.verified_events.len() >   self.committed_events.len()\r\n        self.committed_events[0..count_to_get].to_vec() will overflow.\r\n\r\nI meet this condition when restore databae.\r\n\r\nI will give a bug fix.\r\n\r\n",
  "closed_by": {
    "login": "Deniallugo",
    "id": 8031374,
    "node_id": "MDQ6VXNlcjgwMzEzNzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8031374?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Deniallugo",
    "html_url": "https://github.com/Deniallugo",
    "followers_url": "https://api.github.com/users/Deniallugo/followers",
    "following_url": "https://api.github.com/users/Deniallugo/following{/other_user}",
    "gists_url": "https://api.github.com/users/Deniallugo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Deniallugo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Deniallugo/subscriptions",
    "organizations_url": "https://api.github.com/users/Deniallugo/orgs",
    "repos_url": "https://api.github.com/users/Deniallugo/repos",
    "events_url": "https://api.github.com/users/Deniallugo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Deniallugo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/310/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/matter-labs/zksync/issues/310/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827460529",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-827460529",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 827460529,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzQ2MDUyOQ==",
    "user": {
      "login": "Deniallugo",
      "id": 8031374,
      "node_id": "MDQ6VXNlcjgwMzEzNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8031374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Deniallugo",
      "html_url": "https://github.com/Deniallugo",
      "followers_url": "https://api.github.com/users/Deniallugo/followers",
      "following_url": "https://api.github.com/users/Deniallugo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Deniallugo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Deniallugo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Deniallugo/subscriptions",
      "organizations_url": "https://api.github.com/users/Deniallugo/orgs",
      "repos_url": "https://api.github.com/users/Deniallugo/repos",
      "events_url": "https://api.github.com/users/Deniallugo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Deniallugo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T09:26:39Z",
    "updated_at": "2021-04-27T09:26:39Z",
    "author_association": "COLLABORATOR",
    "body": "Hello! \r\nThanks for your issue.\r\nCould you provide more information about the situation when you met this problem? \r\nWhat was the environment? \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827460529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827471017",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-827471017",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 827471017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzQ3MTAxNw==",
    "user": {
      "login": "yaanhyy",
      "id": 5064036,
      "node_id": "MDQ6VXNlcjUwNjQwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5064036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yaanhyy",
      "html_url": "https://github.com/yaanhyy",
      "followers_url": "https://api.github.com/users/yaanhyy/followers",
      "following_url": "https://api.github.com/users/yaanhyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/yaanhyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yaanhyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yaanhyy/subscriptions",
      "organizations_url": "https://api.github.com/users/yaanhyy/orgs",
      "repos_url": "https://api.github.com/users/yaanhyy/repos",
      "events_url": "https://api.github.com/users/yaanhyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yaanhyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T09:43:32Z",
    "updated_at": "2021-04-27T10:26:20Z",
    "author_association": "NONE",
    "body": "Sometimes,  http request is timeout. sometimes,  My mac is powerdown unexpected.",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827471017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827475304",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-827475304",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 827475304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzQ3NTMwNA==",
    "user": {
      "login": "Deniallugo",
      "id": 8031374,
      "node_id": "MDQ6VXNlcjgwMzEzNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8031374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Deniallugo",
      "html_url": "https://github.com/Deniallugo",
      "followers_url": "https://api.github.com/users/Deniallugo/followers",
      "following_url": "https://api.github.com/users/Deniallugo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Deniallugo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Deniallugo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Deniallugo/subscriptions",
      "organizations_url": "https://api.github.com/users/Deniallugo/orgs",
      "repos_url": "https://api.github.com/users/Deniallugo/repos",
      "events_url": "https://api.github.com/users/Deniallugo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Deniallugo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T09:50:24Z",
    "updated_at": "2021-04-27T09:50:24Z",
    "author_association": "COLLABORATOR",
    "body": "After that failings, you tried to continue restoring with data-restorer flag `--continue`, am I right?\r\nAnd it looks like the `continue` mode in the data restorer does not work correctly. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827475304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827496154",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-827496154",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 827496154,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzQ5NjE1NA==",
    "user": {
      "login": "yaanhyy",
      "id": 5064036,
      "node_id": "MDQ6VXNlcjUwNjQwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5064036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yaanhyy",
      "html_url": "https://github.com/yaanhyy",
      "followers_url": "https://api.github.com/users/yaanhyy/followers",
      "following_url": "https://api.github.com/users/yaanhyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/yaanhyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yaanhyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yaanhyy/subscriptions",
      "organizations_url": "https://api.github.com/users/yaanhyy/orgs",
      "repos_url": "https://api.github.com/users/yaanhyy/repos",
      "events_url": "https://api.github.com/users/yaanhyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yaanhyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T10:24:40Z",
    "updated_at": "2021-04-27T10:24:40Z",
    "author_association": "NONE",
    "body": "yes, I use continue, I commit a fix on pull request and test it works. Please review:)",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827496154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827695217",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-827695217",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 827695217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzY5NTIxNw==",
    "user": {
      "login": "StanislavBreadless",
      "id": 52464764,
      "node_id": "MDQ6VXNlcjUyNDY0NzY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/52464764?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StanislavBreadless",
      "html_url": "https://github.com/StanislavBreadless",
      "followers_url": "https://api.github.com/users/StanislavBreadless/followers",
      "following_url": "https://api.github.com/users/StanislavBreadless/following{/other_user}",
      "gists_url": "https://api.github.com/users/StanislavBreadless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StanislavBreadless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StanislavBreadless/subscriptions",
      "organizations_url": "https://api.github.com/users/StanislavBreadless/orgs",
      "repos_url": "https://api.github.com/users/StanislavBreadless/repos",
      "events_url": "https://api.github.com/users/StanislavBreadless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StanislavBreadless/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T15:22:37Z",
    "updated_at": "2021-04-27T15:22:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @yaanhyy!\r\n\r\nWe are very glad for your vigilance and support. But there can not be more verification events than commit events. Before each block verification, there is a corresponding block commit.\r\n\r\nCould you please elaborate more on the steps to reproduce the issues? There are likely other problems that are the reason",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827695217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827717907",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-827717907",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 827717907,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzcxNzkwNw==",
    "user": {
      "login": "yaanhyy",
      "id": 5064036,
      "node_id": "MDQ6VXNlcjUwNjQwMzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5064036?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yaanhyy",
      "html_url": "https://github.com/yaanhyy",
      "followers_url": "https://api.github.com/users/yaanhyy/followers",
      "following_url": "https://api.github.com/users/yaanhyy/following{/other_user}",
      "gists_url": "https://api.github.com/users/yaanhyy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yaanhyy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yaanhyy/subscriptions",
      "organizations_url": "https://api.github.com/users/yaanhyy/orgs",
      "repos_url": "https://api.github.com/users/yaanhyy/repos",
      "events_url": "https://api.github.com/users/yaanhyy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yaanhyy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T15:53:54Z",
    "updated_at": "2021-04-27T15:57:22Z",
    "author_association": "NONE",
    "body": "Sure I can reproduce the issues on follow steps:\r\n1.  I run the data_restore service.\r\n2. the  service  run update_operations_state and change data_restore_storage_state_update to operations\r\n3. then service run update_tree_state , use the operations to produce blocks. when service produce some blocks but not finish. the service be shutdown for some unexpected reason(for example the computer is poweroff or  kill -9 the data_restore). \r\n4. then restart the data_restore service with --continue, the data_restore load  the storage_state_update in  operations state.\r\n5. the service will load all  operations by function update_operations_state but some operations have been used to produce blocks already. then data_restore service will fail on update_tree_state because reusing operations. ",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/827717907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/828176121",
    "html_url": "https://github.com/matter-labs/zksync/issues/310#issuecomment-828176121",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/310",
    "id": 828176121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyODE3NjEyMQ==",
    "user": {
      "login": "StanislavBreadless",
      "id": 52464764,
      "node_id": "MDQ6VXNlcjUyNDY0NzY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/52464764?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StanislavBreadless",
      "html_url": "https://github.com/StanislavBreadless",
      "followers_url": "https://api.github.com/users/StanislavBreadless/followers",
      "following_url": "https://api.github.com/users/StanislavBreadless/following{/other_user}",
      "gists_url": "https://api.github.com/users/StanislavBreadless/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StanislavBreadless/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StanislavBreadless/subscriptions",
      "organizations_url": "https://api.github.com/users/StanislavBreadless/orgs",
      "repos_url": "https://api.github.com/users/StanislavBreadless/repos",
      "events_url": "https://api.github.com/users/StanislavBreadless/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StanislavBreadless/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-28T06:16:13Z",
    "updated_at": "2021-04-28T06:16:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@yaanhyy \r\n\r\nWe appreciate so many details. It seems that your PR has not resolved the issue because the reason for the error is that the program is trying to work with an inconsistent state. We have to look into our code and find where we are forgetting about a database transaction.",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/828176121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
