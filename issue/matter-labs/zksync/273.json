{
  "url": "https://api.github.com/repos/matter-labs/zksync/issues/273",
  "repository_url": "https://api.github.com/repos/matter-labs/zksync",
  "labels_url": "https://api.github.com/repos/matter-labs/zksync/issues/273/labels{/name}",
  "comments_url": "https://api.github.com/repos/matter-labs/zksync/issues/273/comments",
  "events_url": "https://api.github.com/repos/matter-labs/zksync/issues/273/events",
  "html_url": "https://github.com/matter-labs/zksync/issues/273",
  "id": 776912039,
  "node_id": "MDU6SXNzdWU3NzY5MTIwMzk=",
  "number": 273,
  "title": "Integration Test Failure",
  "user": {
    "login": "ashWhiteHat",
    "id": 39494661,
    "node_id": "MDQ6VXNlcjM5NDk0NjYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/39494661?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ashWhiteHat",
    "html_url": "https://github.com/ashWhiteHat",
    "followers_url": "https://api.github.com/users/ashWhiteHat/followers",
    "following_url": "https://api.github.com/users/ashWhiteHat/following{/other_user}",
    "gists_url": "https://api.github.com/users/ashWhiteHat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ashWhiteHat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ashWhiteHat/subscriptions",
    "organizations_url": "https://api.github.com/users/ashWhiteHat/orgs",
    "repos_url": "https://api.github.com/users/ashWhiteHat/repos",
    "events_url": "https://api.github.com/users/ashWhiteHat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ashWhiteHat/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-12-31T10:35:30Z",
  "updated_at": "2021-01-24T06:11:34Z",
  "closed_at": "2021-01-24T06:11:34Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am trying the integration test but some errors happened.\r\nIt says `should execute a withdrawal` and `should execute a ForcedExit` failed to resolve the promise so it can't be finished.\r\nDo you know how to fix this error?\r\n```\r\nubuntu@ip-x-x-x-x:~/zksync$ zk test i server\r\nyarn run v1.22.5\r\n$ yarn workspace ts-tests test\r\n$ zk f mocha tests/main.test.ts\r\n\r\n\r\n  ZkSync integration tests (token: ETH, transport: HTTP)\r\n    ✓ should execute an auto-approved deposit (2344ms)\r\n    ✓ should execute a normal deposit (1984ms)\r\n    ✓ should change pubkey onchain (2142ms)\r\n    ✓ should execute a transfer to new account (610ms)\r\n    ✓ should execute a transfer to existing account (619ms)\r\n    ✓ should execute a transfer to self (630ms)\r\n    ✓ should change pubkey offchain (639ms)\r\n    ✓ should test multi-transfers (1428ms)\r\n    1) should execute a withdrawal\r\n    2) should execute a ForcedExit\r\n    ✓ should check collected fees (7ms)\r\n    ✓ should fail trying to send tx with wrong signature (124ms)\r\n    Full Exit tests\r\nnetwork block skew detected; skipping block events\r\n      ✓ should execute full-exit on random wallet (2514ms)\r\n      ✓ should fail full-exit with wrong eth-signer (3939ms)\r\n      ✓ should execute a normal full-exit (2071ms)\r\n      ✓ should execute full-exit on an empty wallet (1963ms)\r\n\r\n  ZkSync integration tests (token: wBTC, transport: WS)\r\n    ✓ should execute an auto-approved deposit (1954ms)\r\n    ✓ should execute a normal deposit (5869ms)\r\n    ✓ should change pubkey onchain (2153ms)\r\n    ✓ should execute a transfer to new account (183ms)\r\n    ✓ should execute a transfer to existing account (200ms)\r\n    ✓ should execute a transfer to self (201ms)\r\n    ✓ should change pubkey offchain (204ms)\r\n    ✓ should test multi-transfers (998ms)\r\n    3) should execute a withdrawal\r\n    4) should execute a ForcedExit\r\n    ✓ should check collected fees (10ms)\r\n    ✓ should fail trying to send tx with wrong signature (200ms)\r\n    Full Exit tests\r\nnetwork block skew detected; skipping block events\r\n      ✓ should execute full-exit on random wallet (2130ms)\r\n      ✓ should fail full-exit with wrong eth-signer (4043ms)\r\n      ✓ should execute a normal full-exit (1995ms)\r\n      ✓ should execute full-exit on an empty wallet (2166ms)\r\n\r\n\r\n  28 passing (49m)\r\n  4 failing\r\n\r\n  1) ZkSync integration tests (token: ETH, transport: HTTP)\r\n       should execute a withdrawal:\r\n     Error: Timeout of 720000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/ubuntu/zksync/core/tests/ts-tests/tests/main.test.ts)\r\n      at listOnTimeout (internal/timers.js:554:17)\r\n      at processTimers (internal/timers.js:497:7)\r\n\r\n  2) ZkSync integration tests (token: ETH, transport: HTTP)\r\n       should execute a ForcedExit:\r\n     Error: Timeout of 720000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/ubuntu/zksync/core/tests/ts-tests/tests/main.test.ts)\r\n      at listOnTimeout (internal/timers.js:554:17)\r\n      at processTimers (internal/timers.js:497:7)\r\n\r\n  3) ZkSync integration tests (token: wBTC, transport: WS)\r\n       should execute a withdrawal:\r\n     Error: Timeout of 720000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/ubuntu/zksync/core/tests/ts-tests/tests/main.test.ts)\r\n      at listOnTimeout (internal/timers.js:554:17)\r\n      at processTimers (internal/timers.js:497:7)\r\n\r\n  4) ZkSync integration tests (token: wBTC, transport: WS)\r\n       should execute a ForcedExit:\r\n     Error: Timeout of 720000ms exceeded. For async tests and hooks, ensure \"done()\" is called; if returning a Promise, ensure it resolves. (/home/ubuntu/zksync/core/tests/ts-tests/tests/main.test.ts)\r\n      at listOnTimeout (internal/timers.js:554:17)\r\n      at processTimers (internal/timers.js:497:7)\r\n\r\n\r\n\r\nerror Command failed with exit code 4.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nerror Command failed.\r\nExit code: 4\r\nCommand: /usr/bin/node\r\nArguments: /usr/share/yarn/lib/cli.js test\r\nDirectory: /home/ubuntu/zksync/core/tests/ts-tests\r\nOutput:\r\n\r\ninfo Visit https://yarnpkg.com/en/docs/cli/workspace for documentation about this command.\r\nerror Command failed with exit code 4.\r\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\nError: Child process exited with code 4\r\n```",
  "closed_by": {
    "login": "ashWhiteHat",
    "id": 39494661,
    "node_id": "MDQ6VXNlcjM5NDk0NjYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/39494661?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ashWhiteHat",
    "html_url": "https://github.com/ashWhiteHat",
    "followers_url": "https://api.github.com/users/ashWhiteHat/followers",
    "following_url": "https://api.github.com/users/ashWhiteHat/following{/other_user}",
    "gists_url": "https://api.github.com/users/ashWhiteHat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ashWhiteHat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ashWhiteHat/subscriptions",
    "organizations_url": "https://api.github.com/users/ashWhiteHat/orgs",
    "repos_url": "https://api.github.com/users/ashWhiteHat/repos",
    "events_url": "https://api.github.com/users/ashWhiteHat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ashWhiteHat/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/273/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/matter-labs/zksync/issues/273/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/765916762",
    "html_url": "https://github.com/matter-labs/zksync/issues/273#issuecomment-765916762",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/273",
    "id": 765916762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTkxNjc2Mg==",
    "user": {
      "login": "popzxc",
      "id": 12111581,
      "node_id": "MDQ6VXNlcjEyMTExNTgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/popzxc",
      "html_url": "https://github.com/popzxc",
      "followers_url": "https://api.github.com/users/popzxc/followers",
      "following_url": "https://api.github.com/users/popzxc/following{/other_user}",
      "gists_url": "https://api.github.com/users/popzxc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/popzxc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/popzxc/subscriptions",
      "organizations_url": "https://api.github.com/users/popzxc/orgs",
      "repos_url": "https://api.github.com/users/popzxc/repos",
      "events_url": "https://api.github.com/users/popzxc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/popzxc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-23T12:01:50Z",
    "updated_at": "2021-01-23T12:01:50Z",
    "author_association": "MEMBER",
    "body": "I guess you are using real prover (`zk prover`). It requires a powerful machine to compute zero knowledge proofs, and even on a powerful machine this operation consumes a decent amount of time.\r\n\r\nIntegration tests were written to test the server logic, thus they expect one to use \"dummy prover\" which doesn't perform actual computations.\r\n\r\nInfo on how to use dummy prover could be found [here](https://github.com/matter-labs/zksync/blob/master/docs/development.md#using-dummy-prover).",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/765916762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/766298642",
    "html_url": "https://github.com/matter-labs/zksync/issues/273#issuecomment-766298642",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync/issues/273",
    "id": 766298642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NjI5ODY0Mg==",
    "user": {
      "login": "ashWhiteHat",
      "id": 39494661,
      "node_id": "MDQ6VXNlcjM5NDk0NjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/39494661?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ashWhiteHat",
      "html_url": "https://github.com/ashWhiteHat",
      "followers_url": "https://api.github.com/users/ashWhiteHat/followers",
      "following_url": "https://api.github.com/users/ashWhiteHat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ashWhiteHat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ashWhiteHat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ashWhiteHat/subscriptions",
      "organizations_url": "https://api.github.com/users/ashWhiteHat/orgs",
      "repos_url": "https://api.github.com/users/ashWhiteHat/repos",
      "events_url": "https://api.github.com/users/ashWhiteHat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ashWhiteHat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-24T06:11:34Z",
    "updated_at": "2021-01-24T06:11:34Z",
    "author_association": "NONE",
    "body": "Exactly.\r\nThank you.\r\nIt was my fault.",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync/issues/comments/766298642/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
