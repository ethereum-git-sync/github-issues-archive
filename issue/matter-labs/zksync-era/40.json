{
  "url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40",
  "repository_url": "https://api.github.com/repos/matter-labs/zksync-era",
  "labels_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40/labels{/name}",
  "comments_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40/comments",
  "events_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40/events",
  "html_url": "https://github.com/matter-labs/zksync-era/issues/40",
  "id": 1736525371,
  "node_id": "I_kwDOI-FneM5ngUY7",
  "number": 40,
  "title": "insert or update on table \"factory_deps\" violates foreign key constraint error",
  "user": {
    "login": "dubuqingfeng",
    "id": 6101854,
    "node_id": "MDQ6VXNlcjYxMDE4NTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6101854?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dubuqingfeng",
    "html_url": "https://github.com/dubuqingfeng",
    "followers_url": "https://api.github.com/users/dubuqingfeng/followers",
    "following_url": "https://api.github.com/users/dubuqingfeng/following{/other_user}",
    "gists_url": "https://api.github.com/users/dubuqingfeng/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dubuqingfeng/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dubuqingfeng/subscriptions",
    "organizations_url": "https://api.github.com/users/dubuqingfeng/orgs",
    "repos_url": "https://api.github.com/users/dubuqingfeng/repos",
    "events_url": "https://api.github.com/users/dubuqingfeng/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dubuqingfeng/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-06-01T15:02:24Z",
  "updated_at": "2023-06-02T00:53:14Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "when run external node, it show below errors:\r\n\r\n```\r\n2023-06-01T14:58:27.060483Z  INFO zksync_external_node: Started the external node\r\n2023-06-01T14:58:27.060500Z  INFO zksync_external_node: Main node URL is: https://zksync2-mainnet.zksync.io:443\r\n2023-06-01T14:58:27.078888Z  INFO zksync_core::genesis: running regenesis\r\n2023-06-01T14:58:28.689813Z  INFO zksync_core::genesis: chain_schema_genesis is complete\r\n2023-06-01T14:58:28.743148Z  INFO zksync_core::genesis: operations_schema_genesis is complete\r\nCONTRACTS_GENESIS_ROOT=0xbc59c242d551e3939b9b2939b8b686efa77ba3833183045d548aa5f53357ba95\r\nCONTRACTS_GENESIS_BLOCK_COMMITMENT=0x37d58c849a0eaf7c8b842ec04a5cfeb854f547e0a040d6717cfeb778bfc072fa\r\nCONTRACTS_GENESIS_ROLLUP_LEAF_INDEX=21\r\nCHAIN_STATE_KEEPER_BOOTLOADER_HASH=0x010007794e73f682ad6d27e86b6f71bbee875fc26f5708d1713e7cfd476098d3\r\nCHAIN_STATE_KEEPER_DEFAULT_AA_HASH=0x0100067d861e2f5717a12c3e869cfb657793b86bbb0caa05cc1421f16c5217bc\r\n2023-06-01T14:58:29.028072Z  INFO zksync_core::sync_layer::external_io: Initialized the ExternalIO: current L1 batch number 1, current miniblock number 1\r\n2023-06-01T14:58:29.109201Z  INFO zksync_core::sync_layer::fetcher: Starting the fetcher routine. Initial miniblock: 1, initial l1 batch: 0\r\n2023-06-01T14:58:29.109554Z  INFO zksync_core::state_keeper::keeper: Starting state keeper. Next l1 batch to seal: 1, Next miniblock to seal: 1\r\n2023-06-01T14:58:29.111344Z  INFO zksync_core::consistency_checker: Starting consistency checker from batch 1\r\n2023-06-01T14:58:29.114647Z  INFO zksync_core::metadata_calculator::updater: Initialized metadata calculator with new tree implementation. Current RocksDB block: 1. Current Postgres block: 1\r\n2023-06-01T14:58:29.114906Z  INFO zksync_core::state_keeper::keeper: There is no open pending batch, starting a new empty batch\r\n2023-06-01T14:58:29.114918Z DEBUG zksync_core::sync_layer::external_io: Waiting for the new batch params\r\n2023-06-01T14:58:29.172915Z  WARN zksync_core::data_fetchers::error: [TokenListFetcher] Parse data error: error decoding response body: expected value at line 1 column 1 file=\"core/bin/zksync_core/src/data_fetchers/error.rs\" line=70 column=17\r\n2023-06-01T14:58:30.115570Z DEBUG zksync_core::sync_layer::external_io: Waiting for the new batch params\r\n2023-06-01T14:58:30.681705Z  INFO zksync_core::sync_layer::fetcher: New batch: 1. Timestamp: 1676384542\r\n2023-06-01T14:58:30.681747Z  INFO zksync_core::sync_layer::fetcher: New miniblock: 1\r\n2023-06-01T14:58:30.715982Z  INFO zksync_core::sync_layer::external_io: Getting previous block hash\r\n2023-06-01T14:58:30.716785Z  INFO zksync_core::sync_layer::external_io: Previous l1_batch_hash: 85193405663032319915008731881807224107828471675661128689794724912223424592533\r\n2023-06-01T14:58:30.716808Z  INFO zksync_core::sync_layer::external_io: Previous l1_batch_hash: 85193405663032319915008731881807224107828471675661128689794724912223424592533\r\n2023-06-01T14:58:30.717425Z  INFO zksync_core::sync_layer::external_io: Fetching base system contract bytecode from the main node\r\n2023-06-01T14:58:30.887785Z  INFO zksync_core::sync_layer::fetcher: Batch 1: committed\r\n2023-06-01T14:58:30.887802Z  INFO zksync_core::sync_layer::fetcher: Batch 1: proven\r\n2023-06-01T14:58:30.887812Z  INFO zksync_core::sync_layer::fetcher: Batch 1: executed\r\n2023-06-01T14:58:31.094588Z  INFO zksync_core::sync_layer::fetcher: New miniblock: 2\r\n\r\nthread 'tokio-runtime-worker' panicked at 'called `Result::unwrap()` on an `Err` value: Database(PgDatabaseError { severity: Error, code: \"23503\", message: \"insert or update on table \\\"factory_deps\\\" violates foreign key constraint \\\"factory_deps_miniblock_number_fkey\\\"\", detail: Some(\"Key (miniblock_number)=(1) is not present in table \\\"miniblocks\\\".\"), hint: None, position: None, where: None, schema: Some(\"public\"), table: Some(\"factory_deps\"), column: None, data_type: None, constraint: Some(\"factory_deps_miniblock_number_fkey\"), file: Some(\"ri_triggers.c\"), line: Some(2463), routine: Some(\"ri_ReportViolation\") })', core/lib/dal/src/storage_dal.rs:44:14\r\nstack backtrace:\r\n   0:     0x565371e00a7a - std::backtrace_rs::backtrace::libunwind::trace::h79937bc171ada62c\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/../../backtrace/src/backtrace/libunwind.rs:93:5\r\n   1:     0x565371e00a7a - std::backtrace_rs::backtrace::trace_unsynchronized::h2292bca8571cb919\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x565371e00a7a - std::sys_common::backtrace::_print_fmt::h9c461f248e4ae90d\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/sys_common/backtrace.rs:65:5\r\n   3:     0x565371e00a7a - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::he9fe6bf1a39182e1\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/sys_common/backtrace.rs:44:22\r\n   4:     0x565371e2685e - core::fmt::write::h032658c119c720d7\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/core/src/fmt/mod.rs:1208:17\r\n   5:     0x565371dfab45 - std::io::Write::write_fmt::h299fc90dfae41c0d\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/io/mod.rs:1682:15\r\n   6:     0x565371e00845 - std::sys_common::backtrace::_print::heb70d25df9937e3f\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/sys_common/backtrace.rs:47:5\r\n   7:     0x565371e00845 - std::sys_common::backtrace::print::had745c0a76b8b521\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/sys_common/backtrace.rs:34:9\r\n   8:     0x565371e0249f - std::panicking::default_hook::{{closure}}::h1ea782cdfa2fd097\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/panicking.rs:267:22\r\n   9:     0x565371e021db - std::panicking::default_hook::h1cc3af63455a163c\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/panicking.rs:286:9\r\n  10:     0x565371e02bac - std::panicking::rust_panic_with_hook::h5cafdc4b3bfd5528\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/panicking.rs:688:13\r\n  11:     0x565371e02949 - std::panicking::begin_panic_handler::{{closure}}::hf31c60f40775892c\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/panicking.rs:579:13\r\n  12:     0x565371e00f2c - std::sys_common::backtrace::__rust_end_short_backtrace::h28a5c7be595826cd\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/sys_common/backtrace.rs:137:18\r\n  13:     0x565371e02652 - rust_begin_unwind\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/panicking.rs:575:5\r\n  14:     0x565370660f63 - core::panicking::panic_fmt::h8fa27a0b37dd98b7\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/core/src/panicking.rs:64:14\r\n  15:     0x5653706613f3 - core::result::unwrap_failed::h62abf61e411aaa08\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/core/src/result.rs:1791:5\r\n  16:     0x565370ef4aaa - std::thread::local::LocalKey<T>::with::h2a526c24981b6747\r\n  17:     0x56537104cfef - <futures_lite::future::Or<F1,F2> as core::future::future::Future>::poll::h77a06b9c829f316d\r\n  18:     0x565370fc9434 - async_io::driver::block_on::h1a408de39a017c65\r\n  19:     0x565370f11dfa - std::thread::local::LocalKey<T>::with::h8144249a518c0073\r\n  20:     0x565370f2c493 - std::thread::local::LocalKey<T>::with::ha8e97e6d878940b3\r\n  21:     0x565370f075e5 - std::thread::local::LocalKey<T>::with::h5e3a59a8ba023484\r\n  22:     0x565370ecb6e1 - async_std::task::builder::Builder::blocking::h6236099b77627694\r\n  23:     0x565370e67eb0 - zksync_dal::storage_dal::StorageDal::insert_factory_deps::h15f5e7df06276d96\r\n  24:     0x565370bbb167 - zksync_core::sync_layer::external_io::ExternalIO::get_base_system_contract::hf62a7e0dd594674f\r\n  25:     0x565370a75526 - zksync_core::state_keeper::io::common::poll_until::h7945bc51736b5aff\r\n  26:     0x565370bbb7f5 - <zksync_core::sync_layer::external_io::ExternalIO as zksync_core::state_keeper::io::StateKeeperIO>::wait_for_new_batch_params::hf02a6e287b428399\r\n  27:     0x565370adb7a7 - zksync_core::state_keeper::keeper::ZkSyncStateKeeper::wait_for_new_batch_params::h0a4be13bd0090479\r\n  28:     0x565370ad6a50 - zksync_core::state_keeper::keeper::ZkSyncStateKeeper::run_inner::h6d161ab9ba4d6690\r\n  29:     0x565370ad5829 - zksync_core::state_keeper::keeper::ZkSyncStateKeeper::run::hf84973cb78dcd70d\r\n  30:     0x565370760060 - tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut::ha31b58a84527b4cc\r\n  31:     0x565370852617 - tokio::runtime::task::core::Core<T,S>::poll::h2e858048874d2431\r\n  32:     0x5653707d7802 - tokio::runtime::task::harness::Harness<T,S>::poll::hed4245f88475a679\r\n  33:     0x565371da71e8 - tokio::runtime::blocking::pool::Inner::run::h5e955592e87dac7b\r\n  34:     0x565371da873a - std::sys_common::backtrace::__rust_begin_short_backtrace::hfab7d4e1fe9df520\r\n  35:     0x565371dba47b - core::ops::function::FnOnce::call_once{{vtable.shim}}::h923b5256cb5f2ded\r\n  36:     0x565371e05f83 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hb77d8d72ebcf79c4\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/alloc/src/boxed.rs:2000:9\r\n  37:     0x565371e05f83 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hc08c3353e1568487\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/alloc/src/boxed.rs:2000:9\r\n  38:     0x565371e05f83 - std::sys::unix::thread::Thread::new::thread_start::h7168e596cd5e5ce6\r\n                               at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/sys/unix/thread.rs:108:17\r\n  39:     0x7fdc42c1bfa3 - start_thread\r\n  40:     0x7fdc429c306f - clone\r\n  41:                0x0 - <unknown>\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/matter-labs/zksync-era/issues/comments/1572455022",
    "html_url": "https://github.com/matter-labs/zksync-era/issues/40#issuecomment-1572455022",
    "issue_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/40",
    "id": 1572455022,
    "node_id": "IC_kwDOI-FneM5ducJu",
    "user": {
      "login": "masayil",
      "id": 65291464,
      "node_id": "MDQ6VXNlcjY1MjkxNDY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/65291464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/masayil",
      "html_url": "https://github.com/masayil",
      "followers_url": "https://api.github.com/users/masayil/followers",
      "following_url": "https://api.github.com/users/masayil/following{/other_user}",
      "gists_url": "https://api.github.com/users/masayil/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/masayil/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/masayil/subscriptions",
      "organizations_url": "https://api.github.com/users/masayil/orgs",
      "repos_url": "https://api.github.com/users/masayil/repos",
      "events_url": "https://api.github.com/users/masayil/events{/privacy}",
      "received_events_url": "https://api.github.com/users/masayil/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-01T17:09:12Z",
    "updated_at": "2023-06-02T00:53:14Z",
    "author_association": "NONE",
    "body": "![image](https://github.com/matter-labs/zksync-era/assets/65291464/9326c77d-447e-4908-8e02-15f2aeafd511)\r\n\r\n1. zk\r\n2. zk env mainnet-config\r\n3. zk db setup\r\n4. zk external-node\r\nMaybe I miss some steps",
    "reactions": {
      "url": "https://api.github.com/repos/matter-labs/zksync-era/issues/comments/1572455022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
