{
  "url": "https://api.github.com/repos/matter-labs/zksync-era/issues/239",
  "repository_url": "https://api.github.com/repos/matter-labs/zksync-era",
  "labels_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/239/labels{/name}",
  "comments_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/239/comments",
  "events_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/239/events",
  "html_url": "https://github.com/matter-labs/zksync-era/issues/239",
  "id": 1946576172,
  "node_id": "I_kwDOI-FneM50BmUs",
  "number": 239,
  "title": "Server json-rpc `eth_estimateGas` fails with metamask",
  "user": {
    "login": "thomas-nguy",
    "id": 81727899,
    "node_id": "MDQ6VXNlcjgxNzI3ODk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/81727899?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thomas-nguy",
    "html_url": "https://github.com/thomas-nguy",
    "followers_url": "https://api.github.com/users/thomas-nguy/followers",
    "following_url": "https://api.github.com/users/thomas-nguy/following{/other_user}",
    "gists_url": "https://api.github.com/users/thomas-nguy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thomas-nguy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thomas-nguy/subscriptions",
    "organizations_url": "https://api.github.com/users/thomas-nguy/orgs",
    "repos_url": "https://api.github.com/users/thomas-nguy/repos",
    "events_url": "https://api.github.com/users/thomas-nguy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thomas-nguy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5157016638,
      "node_id": "LA_kwDOI-FneM8AAAABM2HUPg",
      "url": "https://api.github.com/repos/matter-labs/zksync-era/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-10-17T05:30:11Z",
  "updated_at": "2023-10-17T05:30:53Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "After intializing the network with \r\n\r\n```\r\nzk init\r\nzk server\r\n```\r\n\r\nand performing a simple transfer with metamask, the server panic with the following error\r\n\r\n\r\n```\r\n\r\nthread 'jsonrpsee-http-worker' panicked at 'called `Result::unwrap()` on an `Err` value: JoinError::Panic(Id(1791), ...)', /xxx/zksync-era-matter/core/lib/zksync_core/src/api_server/execution_sandbox/execute.rs:182:6\r\nstack backtrace:\r\n   0:        0x10bd4d153 - std::backtrace_rs::backtrace::libunwind::trace::h211824fb0870b7d7\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/../../backtrace/src/backtrace/libunwind.rs:93:5\r\n   1:        0x10bd4d153 - std::backtrace_rs::backtrace::trace_unsynchronized::h0e69993850353c73\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:        0x10bd4d153 - std::sys_common::backtrace::_print_fmt::hee91bd3b61c5fec7\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/sys_common/backtrace.rs:65:5\r\n   3:        0x10bd4d153 - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h9b8c7d4986eea143\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/sys_common/backtrace.rs:44:22\r\n   4:        0x10bd7259b - core::fmt::rt::Argument::fmt::hea92c31b43c9e564\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/core/src/fmt/rt.rs:138:9\r\n   5:        0x10bd7259b - core::fmt::write::h745c6d87d2702197\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/core/src/fmt/mod.rs:1094:21\r\n   6:        0x10bd48c4e - std::io::Write::write_fmt::h9bc75e1a1578f329\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/io/mod.rs:1714:15\r\n   7:        0x10bd4cf4a - std::sys_common::backtrace::_print::h98bb00e155d79a89\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/sys_common/backtrace.rs:47:5\r\n   8:        0x10bd4cf4a - std::sys_common::backtrace::print::hb5816525719dec2d\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/sys_common/backtrace.rs:34:9\r\n   9:        0x10bd4e725 - std::panicking::default_hook::{{closure}}::hfc88b82ae9ab0222\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/panicking.rs:269:22\r\n  10:        0x10bd4e4cf - std::panicking::default_hook::h2cb72824a505d11d\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/panicking.rs:288:9\r\n  11:        0x10bd4ec80 - std::panicking::rust_panic_with_hook::hc7199b95a24a631d\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/panicking.rs:705:13\r\n  12:        0x10bd4eba3 - std::panicking::begin_panic_handler::{{closure}}::h29c0dd87214757f4\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/panicking.rs:597:13\r\n  13:        0x10bd4d559 - std::sys_common::backtrace::__rust_end_short_backtrace::hd299ff4177db45a7\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/sys_common/backtrace.rs:151:18\r\n  14:        0x10bd4e8dd - rust_begin_unwind\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/panicking.rs:593:5\r\n  15:        0x10be6de63 - core::panicking::panic_fmt::h8b25e6b7bc9d8aa4\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/core/src/panicking.rs:67:14\r\n  16:        0x10be6e2f5 - core::result::unwrap_failed::h3575be054108b8be\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/core/src/result.rs:1651:5\r\n  17:        0x109be9987 - zksync_core::api_server::execution_sandbox::execute::execute_tx_in_sandbox::{{closure}}::{{closure}}::hd16719fa1dd6129f\r\n  18:        0x109cac706 - <tracing::instrument::Instrumented<T> as core::future::future::Future>::poll::h72f37da4278dc565\r\n  19:        0x109be9422 - zksync_core::api_server::execution_sandbox::execute::execute_tx_in_sandbox::{{closure}}::h3ff358fcf5336c4b\r\n  20:        0x109bea4c4 - zksync_core::api_server::execution_sandbox::execute::execute_tx_with_pending_state::{{closure}}::{{closure}}::h815713e654973d1a\r\n  21:        0x109caffd6 - <tracing::instrument::Instrumented<T> as core::future::future::Future>::poll::ha015cd6a63489a86\r\n  22:        0x109be9e3b - zksync_core::api_server::execution_sandbox::execute::execute_tx_with_pending_state::{{closure}}::h328ea3b200671311\r\n  23:        0x109c2382d - zksync_core::api_server::tx_sender::TxSender<G>::estimate_gas_step::{{closure}}::h890dd3f67fa6b29c\r\n  24:        0x109c25ecd - zksync_core::api_server::tx_sender::TxSender<G>::get_txs_fee_in_wei::{{closure}}::he65b72eb28a699bc\r\n  25:        0x109bfbf1d - zksync_core::api_server::web3::namespaces::eth::EthNamespace<G>::estimate_gas_impl::{{closure}}::{{closure}}::h685135723f5d8384\r\n  26:        0x109bfb6d4 - zksync_core::api_server::web3::namespaces::eth::EthNamespace<G>::estimate_gas_impl::{{closure}}::h8893f4608681f58e\r\n  27:        0x109c167a8 - zksync_core::api_server::web3::backend_jsonrpsee::namespaces::eth::<impl zksync_web3_decl::namespaces::eth::EthNamespaceServer for zksync_core::api_server::web3::namespaces::eth::EthNamespace<G>>::estimate_gas::{{closure}}::h0b3882e8123ce72f\r\n  28:        0x10a2f889a - jsonrpsee_core::server::rpc_module::RpcModule<Context>::register_async_method::{{closure}}::{{closure}}::h8dd55c249dc8e567\r\n  29:        0x109f13eb1 - jsonrpsee_server::transport::http::process_validated_request::{{closure}}::hc9a80cec96677bb9\r\n  30:        0x109ef64ac - <futures_util::future::future::map::Map<Fut,F> as core::future::future::Future>::poll::h5d9ae480141d316c\r\n  31:        0x10a16a32e - <futures_util::future::future::Map<Fut,F> as core::future::future::Future>::poll::h4e92e0656bb8f427\r\n  32:        0x109d504ad - <tower_http::cors::ResponseFuture<F> as core::future::future::Future>::poll::h99fdc6bae6d0b930\r\n  33:        0x10a34acfa - <tower::util::either::Either<A,B> as core::future::future::Future>::poll::h6b4cd45532df6533\r\n  34:        0x109963d5b - hyper::proto::h1::dispatch::Dispatcher<D,Bs,I,T>::poll_catch::haf7b689d35ce4b10\r\n  35:        0x10a0f6a83 - <hyper::server::conn::upgrades::UpgradeableConnection<I,S,E> as core::future::future::Future>::poll::hf32bf6c1507d0afd\r\n  36:        0x10a16a909 - <futures_util::future::select::Select<A,B> as core::future::future::Future>::poll::h135dfda97417f0f1\r\n  37:        0x109cb38f3 - <tracing::instrument::Instrumented<T> as core::future::future::Future>::poll::hcd0e6d1b186c90f3\r\n  38:        0x109e9b9b5 - jsonrpsee_server::server::process_connection::{{closure}}::h99deb0168ac5cc75\r\n  39:        0x109ed7a62 - tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut::h7917f01709a8dbd5\r\n  40:        0x109e101f7 - tokio::runtime::task::core::Core<T,S>::poll::hfb2345a67c509eb8\r\n  41:        0x10a1bcefe - tokio::runtime::task::harness::Harness<T,S>::poll::hf8b1650c17027521\r\n  42:        0x10bbad342 - tokio::runtime::scheduler::multi_thread::worker::Context::run_task::ha9a0164df935722a\r\n  43:        0x10bbacba3 - tokio::runtime::scheduler::multi_thread::worker::Context::run::hbb75920f97a9312a\r\n  44:        0x10bba17ef - tokio::macros::scoped_tls::ScopedKey<T>::set::h8be5bf1d7de5b4a3\r\n  45:        0x10bbac678 - tokio::runtime::scheduler::multi_thread::worker::run::h0f7c70ec99bda465\r\n  46:        0x10bb91e90 - tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut::he88ba1978a6445de\r\n  47:        0x10bb89b3b - tokio::runtime::task::core::Core<T,S>::poll::h574798cb16448013\r\n  48:        0x10bb820eb - tokio::runtime::task::harness::Harness<T,S>::poll::h5e87e3dd772691df\r\n  49:        0x10bb8d391 - tokio::runtime::blocking::pool::Inner::run::h2dd2e10a31aabe8b\r\n  50:        0x10bb83b02 - std::sys_common::backtrace::__rust_begin_short_backtrace::h58e7ff091a322615\r\n  51:        0x10bb9ffed - core::ops::function::FnOnce::call_once{{vtable.shim}}::h49ed5137c391bb8d\r\n  52:        0x10bd51569 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hca8143ed631fc926\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/alloc/src/boxed.rs:1993:9\r\n  53:        0x10bd51569 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hd13430e010863438\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/alloc/src/boxed.rs:1993:9\r\n  54:        0x10bd51569 - std::sys::unix::thread::Thread::new::thread_start::hfb011cb6d478f7b1\r\n                               at /rustc/d5c2e9c342b358556da91d61ed4133f6f50fc0c3/library/std/src/sys/unix/thread.rs:108:17\r\n  55:     0x7ff804be11d3 - __pthread_start\r\n  ```\r\n\r\n\r\nThis is most likely due to a bug in the json rpc endpoint `eth_estimateGas`\r\n\r\n\r\nEnv:\r\nMacOS 13.6\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/matter-labs/zksync-era/issues/239/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/matter-labs/zksync-era/issues/239/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
