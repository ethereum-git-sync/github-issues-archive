{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/2507",
  "id": 1034013399,
  "node_id": "I_kwDOBGDvrM49ocrX",
  "number": 2507,
  "title": "VIP: Simplify+generalize conversion rules",
  "user": {
    "login": "charles-cooper",
    "id": 3867501,
    "node_id": "MDQ6VXNlcjM4Njc1MDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charles-cooper",
    "html_url": "https://github.com/charles-cooper",
    "followers_url": "https://api.github.com/users/charles-cooper/followers",
    "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
    "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
    "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
    "repos_url": "https://api.github.com/users/charles-cooper/repos",
    "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 757250644,
      "node_id": "MDU6TGFiZWw3NTcyNTA2NDQ=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/VIP:%20Approved",
      "name": "VIP: Approved",
      "color": "98f765",
      "default": false,
      "description": "VIP Approved"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-10-22T23:40:23Z",
  "updated_at": "2022-04-05T21:21:10Z",
  "closed_at": "2022-03-18T18:46:28Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "## Simple Summary\r\nSimplify and generalize type conversion rules.\r\n\r\n## Motivation\r\nhttps://github.com/vyperlang/vyper/issues/1093 introduced type conversion rules between all the types in vyper that existed at the time. Now that the number of numeric types is growing, we can't just add more rules for every type that gets added. This will result in N^2 rules which is hard to code, and hard to reason about.\r\n\r\nThis VIP is basically a distillation of #1093 into rules that will generalize to more types. It modifies the rules for address, making it harder to convert address into other types (however - it can be converted via intermediate conversion to `bytes32`, which means \"I really want to do this\").\r\n\r\n## Specification\r\nTerminology:\r\n- `bitcast`: leave the input byte-for-byte unchanged\r\n- `padconvert`: convert left- or right-padding to the other one. (integers are left-padded with zeroes; bytestrings are right-padded).\r\n- `top`: leftmost (in the big-endian sense)\r\n- `bottom`: rightmost (in the big-endian sense)\r\n- `signextend`: fill the top bits with 1's if the sign bit is set (e.g. signextend for int8 will look at the 8th bit from the right)\r\n\r\nThe general principles are:\r\n- `padconvert` is applied for conversions between left-padded (bytes) and right-padded (other types)\r\n- converting integers to decimals involves truncation\r\n- conversion from a smaller-width to larger-width type is otherwise a no-op\r\n- conversion from a larger-width to smaller-width type requires a clamp\r\n- conversions involving bytes-like types are legal for `Bytes[N<=32]` and `String[N<=32]`\r\n- conversion from a numeric type to a bytes-like type is legal so long as the output type is at-least-as-wide as the input type.\r\n  - For instance, `int128` could be converted to `Bytes[N>=16]`.\r\n- conversion from a bytes-like type to a numeric type requires a clamp.\r\n- conversion between unsigned and signed requires a clamp.\r\n  - For instance, `uint256` to `int128` requires a check that the input is less than `INT128_MAX`.\r\n  - For instance, `int128` to `uint256` requires a check that the input is greater than `0`.\r\n\r\nThe following (WIP) table summarizes each case:\r\n\r\n| from | to | behavior | clamps |\r\n|---|---|---|---|\r\n| `numeric` | `bytesM` | padconvert to `M` bytes | input must have fewer than `M` bytes set |\r\n| `bool` | `bytesM` | padconvert to `M` bytes | input must have fewer than `M` bytes set |\r\n| `address` | `bytesM` | padconvert to `M` bytes | input must have fewer than `M` bytes set |\r\n| `integer` | `bytesM` | padconvert to `M` bytes | input must have fewer than `M` bytes set |\r\n| `bytesN` | `bytesM` | bitcast the input | input must have fewer than `M` bytes set |\r\n| `*` | `bool` | returns `iszero(iszero(input))` | (none) |\r\n| `bool` | `decimal` | `1.0 if True else 0.0` | (none) |\r\n| `bool` | `*` (except decimal) | bitcast the input | (none) |\r\n| `bytesM` | `intN` | padconvert the input with sign extension | input must have fewer than N bits set |\r\n| `decimal` | `uintN` | truncate the input, e.g. `1.0` -> `1` | output must be in bounds for the type, and be >=0 |\r\n| `decimal` | `intN` | truncate the input, e.g. `1.0` -> `1` | output must be in bounds for the type |\r\n| `address` | `uintN` | bitcast the input | input must have fewer than N bits set. signed integers not allowed |\r\n| `bytesM` | `address` | padconvert the input | input must have fewer than 20 bytes set |\r\n| `uintN` | `address` | bitcast the input | input must have fewer than 160 bits set. signed integers not allowed |\r\n| `bytesM` | `decimal` | padconvert the input | input must have fewer than 168 bits set |\r\n| `intN` | `decimal` | promote the input, e.g. `1` -> `1.0` | output must be in bounds |\r\n| `uintN` | `decimal` | promote the input, e.g. `1` -> `1.0` | output must be in bounds, and be <decimal::max_value |\r\n| `udecimal` (hypothetical) | `uintN` | truncate the input | output must be in bounds for the type, and be >=0 |\r\n| `udecimal` (hypothetical) | `intN` | truncate the input | output must be in bounds for the type, and be <intN::max_value |\r\n\r\n\r\n## Backwards Compatibility\r\nShould stay backwards compatible EXCEPT for address and possibly decimal conversions. `address` is no longer convertible with as many types, and `decimal` now has bitcasting semantics instead of truncation when converting with bytes types.\r\n\r\n## Dependencies\r\n\r\n## References\r\nhttps://github.com/vyperlang/vyper/issues/967\r\nhttps://github.com/vyperlang/vyper/issues/1093\r\nhttps://github.com/vyperlang/vyper/issues/1901\r\nhttps://github.com/vyperlang/vyper/issues/2317\r\n\r\n## Copyright\r\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/)\r\n",
  "closed_by": {
    "login": "charles-cooper",
    "id": 3867501,
    "node_id": "MDQ6VXNlcjM4Njc1MDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charles-cooper",
    "html_url": "https://github.com/charles-cooper",
    "followers_url": "https://api.github.com/users/charles-cooper/followers",
    "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
    "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
    "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
    "repos_url": "https://api.github.com/users/charles-cooper/repos",
    "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/2507/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 1,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/950016310",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-950016310",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 950016310,
    "node_id": "IC_kwDOBGDvrM44oBk2",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T23:43:51Z",
    "updated_at": "2021-10-22T23:43:51Z",
    "author_association": "COLLABORATOR",
    "body": "Open questions: does conversion between bytes32 and Bytes[N<=32] require a `padconvert`? My intuition yes, but maybe there are dissenting opinions.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/950016310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/952926006",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-952926006",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 952926006,
    "node_id": "IC_kwDOBGDvrM44zH82",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-27T13:23:59Z",
    "updated_at": "2021-10-27T13:23:59Z",
    "author_association": "COLLABORATOR",
    "body": "relevant: https://github.com/vyperlang/vyper/pull/2518",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/952926006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/956536319",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-956536319",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 956536319,
    "node_id": "IC_kwDOBGDvrM45A5X_",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-01T19:47:07Z",
    "updated_at": "2021-11-01T19:47:07Z",
    "author_association": "COLLABORATOR",
    "body": "meeting notes: get rid of address=>int128 conversion.\r\n\r\nimportant: conversion from bytes to numeric is allowed ONLY if the output type is at-least-as-wide-as the input type. Bytes[17]=>int128 is illegal.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/956536319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/956540363",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-956540363",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 956540363,
    "node_id": "IC_kwDOBGDvrM45A6XL",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-01T19:53:47Z",
    "updated_at": "2021-11-01T19:53:47Z",
    "author_association": "COLLABORATOR",
    "body": "notes: need to think more about bytes32, but basically, conversions should result in the least data change possible (that still makes sense intuitively+maintains safety)",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/956540363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1065230992",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-1065230992",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 1065230992,
    "node_id": "IC_kwDOBGDvrM4_fiKQ",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-11T15:41:46Z",
    "updated_at": "2022-03-11T15:41:46Z",
    "author_association": "COLLABORATOR",
    "body": "conversion from wider input bytes to narrower output int (e.g. `Bytes[17] => int128`) should be allowed (with a runtime clamp), because `int128` and other ints commonly come in via byte encoded data (e.g., calldata, returndata, etc).",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1065230992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1075295188",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-1075295188",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 1075295188,
    "node_id": "IC_kwDOBGDvrM5AF7PU",
    "user": {
      "login": "jakerockland",
      "id": 8602661,
      "node_id": "MDQ6VXNlcjg2MDI2NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8602661?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakerockland",
      "html_url": "https://github.com/jakerockland",
      "followers_url": "https://api.github.com/users/jakerockland/followers",
      "following_url": "https://api.github.com/users/jakerockland/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakerockland/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakerockland/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakerockland/subscriptions",
      "organizations_url": "https://api.github.com/users/jakerockland/orgs",
      "repos_url": "https://api.github.com/users/jakerockland/repos",
      "events_url": "https://api.github.com/users/jakerockland/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakerockland/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-22T15:03:12Z",
    "updated_at": "2022-03-22T15:03:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "This makes me so happy 🔥 🥳 ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1075295188/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1075295807",
    "html_url": "https://github.com/vyperlang/vyper/issues/2507#issuecomment-1075295807",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2507",
    "id": 1075295807,
    "node_id": "IC_kwDOBGDvrM5AF7Y_",
    "user": {
      "login": "jakerockland",
      "id": 8602661,
      "node_id": "MDQ6VXNlcjg2MDI2NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8602661?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakerockland",
      "html_url": "https://github.com/jakerockland",
      "followers_url": "https://api.github.com/users/jakerockland/followers",
      "following_url": "https://api.github.com/users/jakerockland/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakerockland/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakerockland/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakerockland/subscriptions",
      "organizations_url": "https://api.github.com/users/jakerockland/orgs",
      "repos_url": "https://api.github.com/users/jakerockland/repos",
      "events_url": "https://api.github.com/users/jakerockland/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakerockland/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-22T15:03:46Z",
    "updated_at": "2022-03-22T15:03:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you @charles-cooper ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1075295807/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
