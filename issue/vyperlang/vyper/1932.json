{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/1932",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/1932",
  "id": 604375855,
  "node_id": "MDU6SXNzdWU2MDQzNzU4NTU=",
  "number": 1932,
  "title": "The @constant attribute allows state-modifying instructions",
  "user": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 479554962,
      "node_id": "MDU6TGFiZWw0Nzk1NTQ5NjI=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Bug that shouldn't change language semantics when fixed."
    },
    {
      "id": 684449300,
      "node_id": "MDU6TGFiZWw2ODQ0NDkzMDA=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/Easy%20Pickings",
      "name": "Easy Pickings",
      "color": "0e8a16",
      "default": false,
      "description": "Used to denote issues that should be easy to implement"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-04-22T00:56:55Z",
  "updated_at": "2020-04-22T14:43:44Z",
  "closed_at": "2020-04-22T14:43:43Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The following compiles:\r\n```\r\n@public\r\n@constant\r\ndef hash() -> bytes32:\r\n    return sha256(\"hash\")\r\n```\r\n\r\nThis should not compile, because the `sha256` precompile uses `CALL`. Perhaps the compiler believes it is not state modifying, but technically `CALL` is. This could be fixed by #1929.\r\n\r\nHowever the problem is if any other contract depends on `hash()` being \"constant\" and executes it via `STATICCALL`, then they will face a failure, because it is not possible to execute `CALL` within a `STATICCALL` frame. Even Vyper supposedly [calls `@constant` using `STATICCALL`](https://vyper.readthedocs.io/en/latest/structure-of-a-contract.html?highlight=staticcall#defining-interfaces-and-making-external-calls).\r\n\r\nFound with @MrChico.",
  "closed_by": {
    "login": "fubuloubu",
    "id": 3859395,
    "node_id": "MDQ6VXNlcjM4NTkzOTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fubuloubu",
    "html_url": "https://github.com/fubuloubu",
    "followers_url": "https://api.github.com/users/fubuloubu/followers",
    "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
    "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
    "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
    "repos_url": "https://api.github.com/users/fubuloubu/repos",
    "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/1932/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/617521827",
    "html_url": "https://github.com/vyperlang/vyper/issues/1932#issuecomment-617521827",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932",
    "id": 617521827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNzUyMTgyNw==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-22T03:08:12Z",
    "updated_at": "2020-04-22T03:09:07Z",
    "author_association": "MEMBER",
    "body": "The `@constant` decorator currently just adjusts the ABI for the given function, but we do perform AST checks for mutation violations, raising this exception:\r\nhttps://github.com/vyperlang/vyper/blob/ee8c18dbd228887c91af185872df15aa750e4f4f/vyper/exceptions.py#L157\r\n\r\nThis issue is therefore a duplicate of #1929. We could add a bytecode-level verification as a secondary check. It would have caught this issue earlier, and ensures that deployed code will operate exactly as intended.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/617521827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/617695258",
    "html_url": "https://github.com/vyperlang/vyper/issues/1932#issuecomment-617695258",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932",
    "id": 617695258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNzY5NTI1OA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-22T10:33:38Z",
    "updated_at": "2020-04-22T10:33:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sorry it seems to be my mistake. [EIP-214](https://eips.ethereum.org/EIPS/eip-214) (defining `STATICCALL`) has an exception for `CALL` with zero-value (forgotten about this obscure part):\r\n> Any attempts to make state-changing operations inside an execution instance with STATIC set to true will instead throw an exception. These operations include CREATE, CREATE2, LOG0, LOG1, LOG2, LOG3, LOG4, SSTORE, and SELFDESTRUCT. They also include CALL with a non-zero value.\r\n\r\nSo technically Vyper was correct, because the precompiles are called with zero-value. Still #1929 will make it nicer.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/617695258/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/617822822",
    "html_url": "https://github.com/vyperlang/vyper/issues/1932#issuecomment-617822822",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1932",
    "id": 617822822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNzgyMjgyMg==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-22T14:43:43Z",
    "updated_at": "2020-04-22T14:43:43Z",
    "author_association": "MEMBER",
    "body": "Closing in favor of resolution in #1929",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/617822822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
