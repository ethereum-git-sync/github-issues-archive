{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/1015",
  "id": 358977975,
  "node_id": "MDU6SXNzdWUzNTg5Nzc5NzU=",
  "number": 1015,
  "title": "VIP: Add `DELEGATECALL` support to Vyper",
  "user": {
    "login": "ben-kaufman",
    "id": 10667901,
    "node_id": "MDQ6VXNlcjEwNjY3OTAx",
    "avatar_url": "https://avatars.githubusercontent.com/u/10667901?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ben-kaufman",
    "html_url": "https://github.com/ben-kaufman",
    "followers_url": "https://api.github.com/users/ben-kaufman/followers",
    "following_url": "https://api.github.com/users/ben-kaufman/following{/other_user}",
    "gists_url": "https://api.github.com/users/ben-kaufman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ben-kaufman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ben-kaufman/subscriptions",
    "organizations_url": "https://api.github.com/users/ben-kaufman/orgs",
    "repos_url": "https://api.github.com/users/ben-kaufman/repos",
    "events_url": "https://api.github.com/users/ben-kaufman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ben-kaufman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 751622094,
      "node_id": "MDU6TGFiZWw3NTE2MjIwOTQ=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/VIP:%20Discussion",
      "name": "VIP: Discussion",
      "color": "000000",
      "default": false,
      "description": "Used to denote VIPs and more complex issues that are waiting discussion in a meeting"
    },
    {
      "id": 757250644,
      "node_id": "MDU6TGFiZWw3NTcyNTA2NDQ=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/VIP:%20Approved",
      "name": "VIP: Approved",
      "color": "98f765",
      "default": false,
      "description": "VIP Approved"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2018-09-11T10:10:51Z",
  "updated_at": "2020-09-14T22:25:31Z",
  "closed_at": "2019-01-24T18:59:00Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Simple Summary\r\nAdd a `delegatecall` function to Vyper to allow the use of the `DELEGATECALL` OPCODE.\r\n\r\n## Abstract\r\n`DELEGATECALL` is a relatively new OPCODE which was first added to the EVM on the Homestead hardfork.\r\nThe `DELEGATECALL` OPCODE allows the use of code (or \"logic\") of a contract to be used by any other contract. In simple terms, it allows running code of another contract in the storage and context of the caller contract.\r\n\r\n## Motivation\r\nThe `DELEGATECALL` OPCODE is becoming widely popular lately, mainly because of 2 use cases it allows:\r\nProxy Contracts: A \"Proxy Contract\" is a contract with the sole purpose of being used as an instance of another contract without redeploying the full contract code with every instance creation. This can drastically reduce the deployment costs as a Proxy Contract deployment might cost less than `200,000` gas units. \r\n\r\nUpgradeable Proxy Contracts: The second main use-case of the `DELEGATECALL` OPCODE  is for \"Upgradeable\" contracts. Since a Proxy contract merely points to another address, it is possible to add an upgrade mechanism which will change the address the contract is delegating the call to.\r\nNote that this mechanism while highly useful in some cases, might be dengerous as it violates the \"immutable code\" nature of smart contracts.\r\n\r\nPlease note that for a fully generic proxy implementation would require supporting [EIP-211](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-211.md) opcodes to some extent.\r\n\r\n## Specification\r\nI see 3 ways which we can act by:\r\n\r\n1. Tell everyone to use Solidity/ some other language for this OR make generic proxy conntract (not written is Vyper) which will be precompiled and included into Vyper. These 2 are basically the same by the mean that DELEGATECALL won't be added to Vyper, but we might want to make it easier to integrate with Vyper contracts. Please see [EIP-1167](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1167.md) for a bytecode we mmay want to use for that.\r\n\r\n2. Add `DELEGATECALL` support but with the restriction of allowing only a constant (\"literal\") address (posiblly to EIP-211 as well). This will allow the first use case in Vyper which is less dangerous but not the latter.\r\n\r\n3. Add full `DELEGATECALL` support as well as supprt for EIP-211 OPCODES, while adding some docmentation/ compiler warning on the use of it.\r\n\r\n## Backwards Compatibility\r\nThis VIP should be backward compatible.\r\n\r\n## Copyright\r\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/)\r\n",
  "closed_by": {
    "login": "jacqueswww",
    "id": 6917456,
    "node_id": "MDQ6VXNlcjY5MTc0NTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacqueswww",
    "html_url": "https://github.com/jacqueswww",
    "followers_url": "https://api.github.com/users/jacqueswww/followers",
    "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
    "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
    "repos_url": "https://api.github.com/users/jacqueswww/repos",
    "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/1015/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/420245536",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-420245536",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 420245536,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDI0NTUzNg==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-11T11:48:28Z",
    "updated_at": "2018-09-11T11:48:28Z",
    "author_association": "MEMBER",
    "body": "Trail of Bits has a great article about the complexity of upgradability patterns leveraging `DELEGATECALL` and other such patterns: https://blog.trailofbits.com/2018/09/05/contract-upgrade-anti-patterns/\r\n\r\nThe TLDR is that it is very difficult to do this correctly and needs assurances best implemented at the compiler level to ensure safe usage of this concept/opcode. To that end, your first option is actually very interesting to me, but I think significant work on syntax would be needed to make this feature successful.\r\n\r\nIf you could work on a syntax for how the 1st option might look in practice, that would help aid in evaluation of a serious proposal for this feature IMO. Perhaps a `@proxy`/`@upgrade` decorator around the function(s) (with some standard signature) required to perform the upgrades would let us have one Vyper contract that is split into two deployed contracts. It could be mandated to live above the `__init__()` function of the contract for clarity that this contract is wrapped using the proxy paradigm.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/420245536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/420245764",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-420245764",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 420245764,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMDI0NTc2NA==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-11T11:49:24Z",
    "updated_at": "2018-09-11T11:49:24Z",
    "author_association": "MEMBER",
    "body": "`ethpm` integration also will make managing this much easier in my belief.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/420245764/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/422376931",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-422376931",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 422376931,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMjM3NjkzMQ==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-18T12:43:51Z",
    "updated_at": "2018-09-18T12:44:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "The first step we decided to take with this VIP is to support adding delegate call as an option for `raw_call`; as `raw_call` is a already an advanced feature, it made sense to add it here.\r\n\r\nCombining default + raw_call I believe we should be able to do the proxy pattern.\r\n\r\n\r\nAlso delegatecall with literal sounds like a safe option, that we might add thereafter.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/422376931/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/424709360",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-424709360",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 424709360,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyNDcwOTM2MA==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-26T13:11:24Z",
    "updated_at": "2018-09-26T13:11:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Starting to create a simple `raw_call` proof of concept.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/424709360/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/457308054",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-457308054",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 457308054,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzMwODA1NA==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T18:37:11Z",
    "updated_at": "2019-01-24T18:37:11Z",
    "author_association": "MEMBER",
    "body": "@jacqueswww can we close?",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/457308054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/457315370",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-457315370",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 457315370,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NzMxNTM3MA==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-24T18:59:00Z",
    "updated_at": "2019-01-24T18:59:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, can always be re-opened.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/457315370/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/692343837",
    "html_url": "https://github.com/vyperlang/vyper/issues/1015#issuecomment-692343837",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1015",
    "id": 692343837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjM0MzgzNw==",
    "user": {
      "login": "mudgen",
      "id": 49092,
      "node_id": "MDQ6VXNlcjQ5MDky",
      "avatar_url": "https://avatars.githubusercontent.com/u/49092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mudgen",
      "html_url": "https://github.com/mudgen",
      "followers_url": "https://api.github.com/users/mudgen/followers",
      "following_url": "https://api.github.com/users/mudgen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mudgen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mudgen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mudgen/subscriptions",
      "organizations_url": "https://api.github.com/users/mudgen/orgs",
      "repos_url": "https://api.github.com/users/mudgen/repos",
      "events_url": "https://api.github.com/users/mudgen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mudgen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T22:19:34Z",
    "updated_at": "2020-09-14T22:25:31Z",
    "author_association": "NONE",
    "body": "> Trail of Bits has a great article about the complexity of upgradability patterns leveraging `DELEGATECALL` and other such patterns: https://blog.trailofbits.com/2018/09/05/contract-upgrade-anti-patterns/\r\n> \r\n> The TLDR is that it is very difficult to do this correctly and needs assurances best implemented at the compiler level to ensure safe usage of this concept/opcode. To that end, your first option is actually very interesting to me, but I think significant work on syntax would be needed to make this feature successful.\r\n \r\nIt is not a great article.  It's spreads FUD about a workable solution, which is proxies that use `delegatecall`.\r\n\r\nHere's what @spalladino from OpenZepplin [says](https://forum.openzeppelin.com/t/openzeppelin-usage-in-audited-well-known-projects/2556/8?u=nick_mudge) about that article:\r\n\r\n> FWIW, I’m not a fan of the data separation pattern for upgrades. It produces very awkward code, it makes it impossible to reuse existing libraries, it’s extremely easy to screw up just by forgetting an onlyOwner modifier in any of the functions in the storage contract, and is much more expensive in terms of gas as it requires an additional CALL for every read or write operation.\r\n>\r\n> Last, I’m sad to see that the Trail of Bits post is still promoting FUD on our proxies, by touting an alleged vulnerability found on our implementation. The fact is that the post picks on an unreleased implementation of the proxies which was under development in our labs repository 1 (a space dedicated to exchange ideas), and was not present in the released version. And not to mention that, if this had been an actual vulnerability, we would have appreciated a responsible disclosure privately first, instead of finding out via a public post.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/692343837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
