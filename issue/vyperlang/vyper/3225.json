{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/3225",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/3225/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/3225/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/3225/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/3225",
  "id": 1529159236,
  "node_id": "I_kwDOBGDvrM5bJR5E",
  "number": 3225,
  "title": "`CompilerPanic` when writing to an array in calldata",
  "user": {
    "login": "trocher",
    "id": 43437004,
    "node_id": "MDQ6VXNlcjQzNDM3MDA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/43437004?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/trocher",
    "html_url": "https://github.com/trocher",
    "followers_url": "https://api.github.com/users/trocher/followers",
    "following_url": "https://api.github.com/users/trocher/following{/other_user}",
    "gists_url": "https://api.github.com/users/trocher/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/trocher/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/trocher/subscriptions",
    "organizations_url": "https://api.github.com/users/trocher/orgs",
    "repos_url": "https://api.github.com/users/trocher/repos",
    "events_url": "https://api.github.com/users/trocher/events{/privacy}",
    "received_events_url": "https://api.github.com/users/trocher/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-01-11T14:29:38Z",
  "updated_at": "2023-02-10T19:49:10Z",
  "closed_at": "2023-02-10T19:49:10Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Version Information\r\n\r\n* vyper Version (output of `vyper --version`): 0.3.8+commit.ae7d6d28\r\n* OS: OSX\r\n* Python Version (output of `python --version`): 3.8.0\r\n\r\n### What's your issue about?\r\n\r\nNote that this bug is not present in v0.3.7 but only in the latest commits of the master branch.\r\n\r\nWhen trying to write to calldata by modifying an element of an array, the compiler panic where it would emit an `ImmutableViolation: Cannot write to calldata` in v0.3.7 and prior versions\r\n\r\n```Vyper\r\n@external\r\ndef test(a: uint256[4]):\r\n    a[0] = 1\r\n```\r\n```Bash\r\nError compiling: tests/customs/code.vy\r\nTraceback (most recent call last):\r\n  File \"/Users/trocher/Documents/thesis/vyper/venv/bin/vyper\", line 11, in <module>\r\n    load_entry_point('vyper==0.3.8', 'console_scripts', 'vyper')()\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/cli/vyper_compile.py\", line 57, in _parse_cli_args\r\n    return _parse_args(sys.argv[1:])\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/cli/vyper_compile.py\", line 154, in _parse_args\r\n    compiled = compile_files(\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/cli/vyper_compile.py\", line 294, in compile_files\r\n    compiler_data = vyper.compile_codes(\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/evm/opcodes.py\", line 226, in _wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/__init__.py\", line 141, in compile_codes\r\n    exc_handler(contract_name, exc)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/cli/vyper_compile.py\", line 189, in exc_handler\r\n    raise exception\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/__init__.py\", line 138, in compile_codes\r\n    out[contract_name][output_format] = OUTPUT_FORMATS[output_format](compiler_data)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/output.py\", line 248, in build_bytecode_output\r\n    return f\"0x{compiler_data.bytecode.hex()}\"\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/functools.py\", line 966, in __get__\r\n    val = self.func(instance)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/phases.py\", line 150, in bytecode\r\n    self.assembly, is_runtime=False, no_bytecode_metadata=self.no_bytecode_metadata\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/functools.py\", line 966, in __get__\r\n    val = self.func(instance)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/phases.py\", line 141, in assembly\r\n    return generate_assembly(self.ir_nodes, self.no_optimize)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/phases.py\", line 126, in ir_nodes\r\n    ir, ir_runtime, sigs = self._ir_output\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.8/lib/python3.8/functools.py\", line 966, in __get__\r\n    val = self.func(instance)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/phases.py\", line 122, in _ir_output\r\n    return generate_ir_nodes(self.global_ctx, self.no_optimize)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/compiler/phases.py\", line 258, in generate_ir_nodes\r\n    ir_nodes, ir_runtime, function_sigs = module.generate_ir_for_module(global_ctx)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/module.py\", line 165, in generate_ir_for_module\r\n    runtime, internal_functions = _runtime_ir(runtime_functions, all_sigs, global_ctx)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/module.py\", line 103, in _runtime_ir\r\n    func_ir = generate_ir_for_function(func_ast, all_sigs, global_ctx, skip_nonpayable_check)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/function_definitions/common.py\", line 62, in generate_ir_for_function\r\n    o = generate_ir_for_external_function(code, sig, context, skip_nonpayable_check)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/function_definitions/external_function.py\", line 182, in generate_ir_for_external_function\r\n    body += [parse_body(code.body, context, ensure_terminated=True)]\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/stmt.py\", line 410, in parse_body\r\n    ir = parse_stmt(stmt, context)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/stmt.py\", line 384, in parse_stmt\r\n    return Stmt(stmt, context).ir_node\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/stmt.py\", line 40, in __init__\r\n    self.ir_node = fn()\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/stmt.py\", line 78, in parse_Assign\r\n    ir_node = make_setter(target, sub)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/core.py\", line 829, in make_setter\r\n    return STORE(left, right)\r\n  File \"/Users/trocher/Documents/thesis/vyper/vyper/codegen/core.py\", line 601, in STORE\r\n    raise CompilerPanic(f\"unreachable {ptr.location}\")  # pragma: notest\r\nvyper.exceptions.CompilerPanic: unreachable AddrSpace(name='calldata', word_scale=32, load_op='calldataload', store_op=None)\r\n\r\nThis is an unhandled internal compiler error. Please create an issue on Github to notify the developers.\r\nhttps://github.com/vyperlang/vyper/issues/new?template=bug.md\r\n```",
  "closed_by": {
    "login": "charles-cooper",
    "id": 3867501,
    "node_id": "MDQ6VXNlcjM4Njc1MDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charles-cooper",
    "html_url": "https://github.com/charles-cooper",
    "followers_url": "https://api.github.com/users/charles-cooper/followers",
    "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
    "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
    "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
    "repos_url": "https://api.github.com/users/charles-cooper/repos",
    "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/3225/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/3225/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
