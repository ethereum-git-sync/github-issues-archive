{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/3557",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/3557/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/3557/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/3557/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/3557",
  "id": 1851772807,
  "node_id": "I_kwDOBGDvrM5uX8-H",
  "number": 3557,
  "title": "VIP: add function to create clones with immutable args",
  "user": {
    "login": "banteg",
    "id": 4562643,
    "node_id": "MDQ6VXNlcjQ1NjI2NDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4562643?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/banteg",
    "html_url": "https://github.com/banteg",
    "followers_url": "https://api.github.com/users/banteg/followers",
    "following_url": "https://api.github.com/users/banteg/following{/other_user}",
    "gists_url": "https://api.github.com/users/banteg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/banteg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/banteg/subscriptions",
    "organizations_url": "https://api.github.com/users/banteg/orgs",
    "repos_url": "https://api.github.com/users/banteg/repos",
    "events_url": "https://api.github.com/users/banteg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/banteg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-08-15T16:36:36Z",
  "updated_at": "2023-08-15T23:44:50Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Simple Summary\r\nAdd a new built-in function to create [Clones With Immutable Args](https://github.com/wighawag/clones-with-immutable-args).\r\n\r\n## Motivation\r\nVyper maintains a strong stance against upgradeable contracts. It offers safe immutable contract creation patterns to developers, promoting the use of minimal proxies and blueprints. \r\n\r\nThis pattern offers a middle ground between them, and makes the most sense when the expected usage of the contract is short-lived or the deploy cost is prioritized over runtime cost.\r\n\r\nIt cheapens runtime cost compared to EIP-1167 because it allows the proxy to have an immutable data section, which gets forwarded to the logic contract as appended calldata, where it can be read from `msg.data` by the logic contract.\r\n\r\nThis pattern has seen production use by Ajna, Astaria, Sudoswap, Buttonwood.\r\n\r\n## Specification\r\nAdd a built in function\r\n```python\r\ndef create_clone_with_immutable_args(\r\n    target: address,\r\n    immutables: Bytes[65533],\r\n    value: uint256 = 0,\r\n    salt: bytes32 = None,\r\n)\r\n```\r\nSimilarly to EIP-1167 proxies, it constructs an init code based on the arguments and deploys a new contract using `CREATE` or `CREATE2` opcode, depending on whether `salt` was set.\r\n\r\nAn annotated init code can [be found here](https://github.com/wighawag/clones-with-immutable-args/blob/master/src/ClonesWithImmutableArgs.sol).\r\n\r\nThe data section can't exceed 65,533 bytes, since the data length is encoded as `uint16` and it includes the length of marker  itself.\r\n\r\nIt is left up to the factory and the logic contract to know how to encode and read variables from the immutable section.\r\n\r\n## Backwards Compatibility\r\nThis VIP adds new functionality and doesn't break backwards compatibility.\r\n\r\n## Dependencies\r\nThis VIP doesn't have any external dependencies.\r\n\r\n## References\r\n- https://github.com/wighawag/clones-with-immutable-args\r\n- [Solidity Factory Example](https://github.com/wighawag/clones-with-immutable-args/blob/master/src/ExampleCloneFactory.sol)\r\n- [Solidity Clone Example](https://github.com/wighawag/clones-with-immutable-args/blob/master/src/Clone.sol)\r\n- [Vyper Clone Example](https://github.com/banteg/vyper-cwia/blob/master/contracts/VyperCWIA.vy)\r\n\r\n## Copyright\r\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/)",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/3557/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/3557/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1679345347",
    "html_url": "https://github.com/vyperlang/vyper/issues/3557#issuecomment-1679345347",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3557",
    "id": 1679345347,
    "node_id": "IC_kwDOBGDvrM5kGMbD",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-15T17:39:26Z",
    "updated_at": "2023-08-15T17:39:26Z",
    "author_association": "COLLABORATOR",
    "body": "i think an important point to clarify here is that in terms of motivation, the desired use case is to deploy short-lived CWIAs where the deploy cost can be expensive relative to expected usage, whereas with the existing blueprint pattern, the deployed contract is expected to \"live forever\" and so the deploy cost does not matter much",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1679345347/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1679761682",
    "html_url": "https://github.com/vyperlang/vyper/issues/3557#issuecomment-1679761682",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3557",
    "id": 1679761682,
    "node_id": "IC_kwDOBGDvrM5kHyES",
    "user": {
      "login": "banteg",
      "id": 4562643,
      "node_id": "MDQ6VXNlcjQ1NjI2NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4562643?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/banteg",
      "html_url": "https://github.com/banteg",
      "followers_url": "https://api.github.com/users/banteg/followers",
      "following_url": "https://api.github.com/users/banteg/following{/other_user}",
      "gists_url": "https://api.github.com/users/banteg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/banteg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/banteg/subscriptions",
      "organizations_url": "https://api.github.com/users/banteg/orgs",
      "repos_url": "https://api.github.com/users/banteg/repos",
      "events_url": "https://api.github.com/users/banteg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/banteg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-15T23:35:59Z",
    "updated_at": "2023-08-15T23:35:59Z",
    "author_association": "NONE",
    "body": "an alternative syntax instead of `immutables` buffer could be `*args` that would be abi encoded. it would also make sense to generate some metadata with their offsets.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1679761682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
