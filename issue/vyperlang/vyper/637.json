{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/637/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/637/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/637/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/637",
  "id": 290037533,
  "node_id": "MDU6SXNzdWUyOTAwMzc1MzM=",
  "number": 637,
  "title": "Limit map key size ",
  "user": {
    "login": "yzhang90",
    "id": 5641590,
    "node_id": "MDQ6VXNlcjU2NDE1OTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5641590?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yzhang90",
    "html_url": "https://github.com/yzhang90",
    "followers_url": "https://api.github.com/users/yzhang90/followers",
    "following_url": "https://api.github.com/users/yzhang90/following{/other_user}",
    "gists_url": "https://api.github.com/users/yzhang90/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yzhang90/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yzhang90/subscriptions",
    "organizations_url": "https://api.github.com/users/yzhang90/orgs",
    "repos_url": "https://api.github.com/users/yzhang90/repos",
    "events_url": "https://api.github.com/users/yzhang90/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yzhang90/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 479554962,
      "node_id": "MDU6TGFiZWw0Nzk1NTQ5NjI=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Bug that shouldn't change language semantics when fixed."
    },
    {
      "id": 751622094,
      "node_id": "MDU6TGFiZWw3NTE2MjIwOTQ=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/VIP:%20Discussion",
      "name": "VIP: Discussion",
      "color": "000000",
      "default": false,
      "description": "Used to denote VIPs and more complex issues that are waiting discussion in a meeting"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2018-01-19T16:44:17Z",
  "updated_at": "2018-03-01T15:10:40Z",
  "closed_at": "2018-03-01T15:10:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### What's your issue about?\r\n1. In vyper compiler, the key_type of map can only be base type and byte array type, which is inconsistent with the doc(https://github.com/ethereum/vyper/blob/master/docs/types.rst) : \"Here _KeyType can be almost any type except for mappings, a contract, or a struct\".\r\n\r\n2. Assume key type can only be base type and byte array type. I can have the following program:\r\n```\r\na:num[bytes<=100000]\r\n@public\r\ndef __init__():\r\n    self.a[\"absssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss\"] = 1\r\n    pass\r\n```\r\nwill cause the compiler to throw an error \"Can't have a zerovalent argument to an opcode or a pseudo-opcode! seq\", which is weird.\r\n\r\n\r\n### How can it be fixed?\r\n\r\nSince the storage is limited, it's better to restrict the size of the key of the map.\r\n\r\n#### Cute Animal Picture\r\n\r\n![image](https://user-images.githubusercontent.com/5641590/35161380-a92d46f6-fd05-11e7-9148-846a24becb14.png)\r\n\r\n",
  "closed_by": {
    "login": "jacqueswww",
    "id": 6917456,
    "node_id": "MDQ6VXNlcjY5MTc0NTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacqueswww",
    "html_url": "https://github.com/jacqueswww",
    "followers_url": "https://api.github.com/users/jacqueswww/followers",
    "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
    "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
    "repos_url": "https://api.github.com/users/jacqueswww/repos",
    "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/637/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/637/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360412209",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-360412209",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 360412209,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDQxMjIwOQ==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T09:35:53Z",
    "updated_at": "2018-01-25T09:35:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "@yzhang90 thanks for the report.\r\nHaving a look now. ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360412209/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360478321",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-360478321",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 360478321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDQ3ODMyMQ==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T14:15:10Z",
    "updated_at": "2018-01-25T14:15:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@DavidKnott @fubuloubu @yzhang90 Ok I have investigated this, there was a fault in the way we did the sha3 accross the key bytearray in the incorrect manner. I have now fixed it that any size can work (any size larger than 32 would've  caused trouble).\r\n\r\nNow the question:\r\nDo we want to limit the key size?",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360478321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360532916",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-360532916",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 360532916,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDUzMjkxNg==",
    "user": {
      "login": "DavidKnott",
      "id": 17552858,
      "node_id": "MDQ6VXNlcjE3NTUyODU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17552858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidKnott",
      "html_url": "https://github.com/DavidKnott",
      "followers_url": "https://api.github.com/users/DavidKnott/followers",
      "following_url": "https://api.github.com/users/DavidKnott/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidKnott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidKnott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidKnott/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidKnott/orgs",
      "repos_url": "https://api.github.com/users/DavidKnott/repos",
      "events_url": "https://api.github.com/users/DavidKnott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidKnott/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T17:07:47Z",
    "updated_at": "2018-01-25T17:07:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think we should let people use any sized key.  The downside is gas costs and people should be able to choose whether or not those are worth it themselves.  Can you guys think of situations where someone would need to use more than 32 bytes as a key?",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360532916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360537555",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-360537555",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 360537555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDUzNzU1NQ==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T17:23:41Z",
    "updated_at": "2018-01-25T18:13:33Z",
    "author_association": "MEMBER",
    "body": "Not offhand. Mapping structs maybe.\r\n\r\nI was discussing with @jacqueswww in the Gitter, I think it we should not enable larger keys by default. The writer has the option of using it via `my_mapping[sha3(A, B, ...)]`, which would be accepting the costs of this decision explicitly. Personally, I also don't like extended key sizes as it it increases the vector for a key collision attack (finding another set of objects `A, B, ...` that overwrite the key in the hashmap), which is a possibility [[check this out](https://eprint.iacr.org/2012/672.pdf)], and the risk increases when data over the key size is used. This might be paranoia, because the attack is still very difficult, but it seems like a lot of concerns for what I currently believe has little utility in practice.\r\n\r\nAnyways, we'd have to come up with a practical limit for the amount of data that can be used to generate a key in the hashmap. How would we choose that limit?",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360537555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360539380",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-360539380",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 360539380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDUzOTM4MA==",
    "user": {
      "login": "DavidKnott",
      "id": 17552858,
      "node_id": "MDQ6VXNlcjE3NTUyODU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17552858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidKnott",
      "html_url": "https://github.com/DavidKnott",
      "followers_url": "https://api.github.com/users/DavidKnott/followers",
      "following_url": "https://api.github.com/users/DavidKnott/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidKnott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidKnott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidKnott/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidKnott/orgs",
      "repos_url": "https://api.github.com/users/DavidKnott/repos",
      "events_url": "https://api.github.com/users/DavidKnott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidKnott/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T17:29:38Z",
    "updated_at": "2018-01-25T17:29:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't mind limiting it and making it explicit, but if we've got to worry about keccak256 collisions we've got bigger problems ðŸ˜„. ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360539380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360551923",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-360551923",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 360551923,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDU1MTkyMw==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-25T18:12:39Z",
    "updated_at": "2018-01-25T18:12:39Z",
    "author_association": "MEMBER",
    "body": "True, but consider this: other uses of keccak (such as a block hashing) avoid any sort of attack because not only it is very difficult to compute a reverse hash that has the right properties, but you have a limited time to do it in (e.g. 6+ confirmations in PoW is effectively final), or it is very expensive if you are discovered making the change (high cost plus multiple validators in PoS) and many other parties have copies to compare against.\r\n\r\nIn this scenario, imagine someone wrote something like this: `token_balance[sha3(owner: address, acct: uint256)]`. Then they could sit there and look at two addresses that, when concated together, gives the desired key hash and allows the attacker to take simply control of funds. This attack is still extremely expensive and impractical for some set of keysizes, but if successful there is nothing else preventing the attack from being successful. The attack surface becomes easier as the keysize is increased, in this scenario there is likely a 2nd key corresponding to completely different choices of `address` and `uint256` that map to the same hash. The paper I linked in my prior post takes 2**115 iterations to find a collision in a key space of 1600 bits (If I am reading that correctly).\r\n\r\nI'm no expert by any means in cryptographic hashes, but that part makes sense to me: you have increased chances of finding a collision for every multiple of the base keysize used for the hashmap. And with no other effective means of securing against that attack (anyone can submit transactions to a smart contract), limiting that as a default enabled feature makes sense to me because base keysize (256bit) has the smallest attack surface possible.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/360551923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/369621469",
    "html_url": "https://github.com/vyperlang/vyper/issues/637#issuecomment-369621469",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/637",
    "id": 369621469,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2OTYyMTQ2OQ==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-01T15:08:32Z",
    "updated_at": "2018-03-01T15:08:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "@DavidKnott @yzhang90 @fubuloubu can we agree on a fixed size limit for a bytes key? I say 1024.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/369621469/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
