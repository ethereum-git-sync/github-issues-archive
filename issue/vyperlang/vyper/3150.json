{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/3150",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/3150/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/3150/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/3150/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/3150",
  "id": 1448887726,
  "node_id": "I_kwDOBGDvrM5WXEWu",
  "number": 3150,
  "title": "Invalid array length errors do not print source location",
  "user": {
    "login": "ghost",
    "id": 10137,
    "node_id": "MDQ6VXNlcjEwMTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ghost",
    "html_url": "https://github.com/ghost",
    "followers_url": "https://api.github.com/users/ghost/followers",
    "following_url": "https://api.github.com/users/ghost/following{/other_user}",
    "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
    "organizations_url": "https://api.github.com/users/ghost/orgs",
    "repos_url": "https://api.github.com/users/ghost/repos",
    "events_url": "https://api.github.com/users/ghost/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ghost/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-14T22:55:17Z",
  "updated_at": "2023-01-12T18:34:10Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version Information\r\n\r\n* vyper Version (output of `vyper --version`): 0.3.7\r\n* OS: macOS 12.6\r\n* Python Version (output of `python --version`): 3.10.5\r\n\r\n### What's your issue about?\r\n\r\nWhereas most other compile-time issues show the offending source line from the contract, compiling a dynamic array with an invalid size only shows an error with the source file name. Showing the line would help in searching and correcting typos or other issues causing the bad length value. \r\n\r\nSuper short example:\r\n\r\n```python\r\n# @version 0.3.7\r\n\r\nowner: public(address)\r\nexample: public(DynArray[int8, 0])\r\n\r\n@external\r\ndef __init__():\r\n\tself.owner = msg.sender\r\n```\r\n\r\nCLI output:\r\n\r\n```shell\r\n> vyper ~/Desktop/example.vy\r\nError compiling: /Users/ibis/Desktop/example.vy\r\nvyper.exceptions.InvalidType: Array length is invalid\r\n\r\n[9171] Failed to execute script 'vyper_compile' due to unhandled exception!\r\n```\r\n\r\n### How can it be fixed?\r\n\r\nIdeally when this issue occurs the compiler should print out the offending line like it does with other errors. For example if I were to deliberately cause an error in `__init__()` it displays the offending source:\r\n\r\n```python\r\n# @version 0.3.7\r\n\r\nowner: public(address)\r\n\r\n@external\r\ndef __init__():\r\n\texample: DynArray[int8, 1] # missing value!\r\n\tself.owner = msg.sender\r\n```\r\n```shell\r\n> vyper ~/Desktop/example.vy\r\nError compiling: /Users/ibis/Desktop/example.vy\r\nvyper.exceptions.VariableDeclarationException: Memory variables must be declared with an initial value\r\n  contract \"/Users/ibis/Desktop/example.vy:7\", function \"__init__\", line 7:1 \r\n       6 def __init__():\r\n  ---> 7 \texample: DynArray[int8, 1] # missing value!\r\n  --------^\r\n       8 \tself.owner = msg.sender\r\n\r\n[9646] Failed to execute script 'vyper_compile' due to unhandled exception!\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/3150/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/3150/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1317580778",
    "html_url": "https://github.com/vyperlang/vyper/issues/3150#issuecomment-1317580778",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3150",
    "id": 1317580778,
    "node_id": "IC_kwDOBGDvrM5OiK_q",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-16T19:47:05Z",
    "updated_at": "2022-11-16T19:47:05Z",
    "author_association": "NONE",
    "body": "A similar issue seems to occur for immutables referenced with `self`:\r\n\r\n```python\r\n# @version 0.3.7\r\n# test.vy\r\n\r\nDATA: immutable(uint256)\r\n\r\n@external\r\ndef __init__(_data: uint256):\r\n    self.DATA = _data   # this line should be shown in the error output\r\n```\r\n\r\n```shell\r\n> vyper test.vy\r\nError compiling: test.vy\r\nvyper.exceptions.SyntaxException: Immutable variables must be accessed without 'self'\r\n[41858] Failed to execute script 'vyper_compile' due to unhandled exception!\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1317580778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1380843077",
    "html_url": "https://github.com/vyperlang/vyper/issues/3150#issuecomment-1380843077",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3150",
    "id": 1380843077,
    "node_id": "IC_kwDOBGDvrM5STf5F",
    "user": {
      "login": "emc415",
      "id": 109754541,
      "node_id": "U_kgDOBoq4rQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/109754541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emc415",
      "html_url": "https://github.com/emc415",
      "followers_url": "https://api.github.com/users/emc415/followers",
      "following_url": "https://api.github.com/users/emc415/following{/other_user}",
      "gists_url": "https://api.github.com/users/emc415/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emc415/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emc415/subscriptions",
      "organizations_url": "https://api.github.com/users/emc415/orgs",
      "repos_url": "https://api.github.com/users/emc415/repos",
      "events_url": "https://api.github.com/users/emc415/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emc415/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-12T18:34:10Z",
    "updated_at": "2023-01-12T18:34:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "hi @helloibis! I created a PR to address the first example you posted. \r\n\r\nRegarding the second example with self.DATA = _data: when I run it now I do get a pointer to the line in the src code. Please let me know if you also do!\r\n\r\nAs it stands, the pointer is to line 1 as opposed to line 5, but at least there is one. I played around with adjusting it to line 5, but it appears to be a bit complicated. Do you think it's important?\r\n\r\nCheers!",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1380843077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
