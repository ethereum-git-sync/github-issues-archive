{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/3581",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/3581/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/3581/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/3581/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/3581",
  "id": 1874130097,
  "node_id": "I_kwDOBGDvrM5vtPSx",
  "number": 3581,
  "title": "`Call` nodes should include full function signature and return type",
  "user": {
    "login": "0xalpharush",
    "id": 87383155,
    "node_id": "MDQ6VXNlcjg3MzgzMTU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/87383155?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xalpharush",
    "html_url": "https://github.com/0xalpharush",
    "followers_url": "https://api.github.com/users/0xalpharush/followers",
    "following_url": "https://api.github.com/users/0xalpharush/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xalpharush/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xalpharush/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xalpharush/subscriptions",
    "organizations_url": "https://api.github.com/users/0xalpharush/orgs",
    "repos_url": "https://api.github.com/users/0xalpharush/repos",
    "events_url": "https://api.github.com/users/0xalpharush/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xalpharush/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-30T17:55:16Z",
  "updated_at": "2023-09-04T19:35:59Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version Information\r\n\r\n* vyper Version (output of `vyper --version`): 0.3.7\r\n* OS: osx\r\n* Python Version (output of `python --version`):\r\n\r\n### What's your issue about?\r\n`Call` nodes only have an identifier name as opposed to a function signature and return type. Vyper should enrich the AST during semantic analysis with this info as it will allow tools to accurately represent Vyper without reimplementing any internal details of the compiler.\r\n\r\nCase 1:\r\nSome builtins are essentially generic functions such as `empty` and `convert`. Maybe these can be \"monomorphized\" and included in the AST similar to https://github.com/vyperlang/vyper/issues/3576\r\n\r\nCase 2:\r\n```vyper\r\n@external\r\n@payable\r\ndef foo(_target: address) -> Bytes[32]:\r\n    success: bool = False\r\n    response: Bytes[32] = b\"\"\r\n    response = raw_call(_target, method_id(\"someMethodName()\"), max_outsize=32)\r\n    success, response = raw_call(_target, method_id(\"someMethodName()\"), max_outsize=32, revert_on_failure=False)\r\n    success = raw_call(_target, method_id(\"someMethodName()\"), max_outsize=0, revert_on_failure=False)\r\n    return response\r\n\r\n```\r\nHere, one has to track the value of `max_outsize` and `revert_on_failure` to infer the return value. In this case, adding the resolved function signature and return type like `raw_call(..) returns (bool)`, `raw_call(..) returns (bool,bytes32)`, or `raw_call(..) returns (bytes32)` would help.\r\n\r\nCase 3:\r\nReferring to the example in https://github.com/vyperlang/vyper/issues/3580, the return type of `Test(x).foo()` should be `(int128, uint256)` and not `(int128, int128)` but the AST only indicates that `foo` was called. Instead of tools reimplementing Vyper's semantic analysis to correctly resolve this ambiguity, the info should be included in the final AST. \r\n\r\n### How can it be fixed?\r\n\r\nFill this in if you know how to fix it.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/3581/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/3581/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1705647537",
    "html_url": "https://github.com/vyperlang/vyper/issues/3581#issuecomment-1705647537",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3581",
    "id": 1705647537,
    "node_id": "IC_kwDOBGDvrM5lqh2x",
    "user": {
      "login": "0xalpharush",
      "id": 87383155,
      "node_id": "MDQ6VXNlcjg3MzgzMTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/87383155?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xalpharush",
      "html_url": "https://github.com/0xalpharush",
      "followers_url": "https://api.github.com/users/0xalpharush/followers",
      "following_url": "https://api.github.com/users/0xalpharush/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xalpharush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xalpharush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xalpharush/subscriptions",
      "organizations_url": "https://api.github.com/users/0xalpharush/orgs",
      "repos_url": "https://api.github.com/users/0xalpharush/repos",
      "events_url": "https://api.github.com/users/0xalpharush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xalpharush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-04T19:35:59Z",
    "updated_at": "2023-09-04T19:35:59Z",
    "author_association": "NONE",
    "body": "I would add to this that the default args of calls (builtins and others, too) should also be included so that those don't have to be recovered ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1705647537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
