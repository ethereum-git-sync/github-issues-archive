{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/928",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/928/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/928/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/928/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/928",
  "id": 335207129,
  "node_id": "MDU6SXNzdWUzMzUyMDcxMjk=",
  "number": 928,
  "title": "How to assert transfer() and transferFrom() are successful for all implementations",
  "user": {
    "login": "haydenadams",
    "id": 9343483,
    "node_id": "MDQ6VXNlcjkzNDM0ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9343483?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haydenadams",
    "html_url": "https://github.com/haydenadams",
    "followers_url": "https://api.github.com/users/haydenadams/followers",
    "following_url": "https://api.github.com/users/haydenadams/following{/other_user}",
    "gists_url": "https://api.github.com/users/haydenadams/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haydenadams/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haydenadams/subscriptions",
    "organizations_url": "https://api.github.com/users/haydenadams/orgs",
    "repos_url": "https://api.github.com/users/haydenadams/repos",
    "events_url": "https://api.github.com/users/haydenadams/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haydenadams/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-06-24T20:02:08Z",
  "updated_at": "2019-02-11T08:24:43Z",
  "closed_at": "2019-02-11T08:24:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "There are several ways I have seen contracts call transfer() and transferFrom() and they all have issues.\r\n\r\n1) \r\n```python\r\ntoken: address(ERC20)\r\ntotal_deposits: uint256\r\n\r\ndef deposit(amount: uint256):\r\n    total_deposits += amount\r\n    self.token.transferFrom(msg.sender, self, amount)\r\n```\r\n\r\nIssue: Although most tokens return an exception if the transaction fails, [BAT](https://etherscan.io/address/0x0d8775f648430679a709e98d2b0cb6250d2887ef#code) and several other tokens return false. For these tokens, total_deposits can be increased without tokens ever being transferred. \r\n\r\n2) \r\n\r\n```python\r\ntoken: address(ERC20)\r\ntotal_deposits: uint256\r\n\r\ndef deposit(amount: uint256):\r\n    total_deposits += amount\r\n    assert self.token.transferFrom(msg.sender, self, amount) == True\r\n```\r\n\r\nIssue: Safer for most ERC20s, but [over 130](https://medium.com/coinmonks/missing-return-value-bug-at-least-130-tokens-affected-d67bf08521ca) existing ERC20s including OMG do not return bools. These tokens can never be deposited, since all function calls will fail.\r\n\r\n3) `assert self.token.transfer(msg.sender, amount) != False`\r\n\r\nSee above. I have a new solution I've been thinking about:\r\n\r\n4)\r\n```python\r\ntoken: address(ERC20)\r\ntotal_deposits: uint256\r\n\r\ndef deposit(amount: uint256):\r\n    total_deposits += amount\r\n    balance: uint256 = self.token.balanceOf(self)\r\n    self.token.transferFrom(msg.sender, self, amount)\r\n    assert self.token.balanceOf(self) == balance + amount\r\n``` \r\nThis seems to guarantee desired behavior under all implementations differences. Unfortunately, it adds ~4000 gas. Are there any other catch-all methods?",
  "closed_by": {
    "login": "jacqueswww",
    "id": 6917456,
    "node_id": "MDQ6VXNlcjY5MTc0NTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacqueswww",
    "html_url": "https://github.com/jacqueswww",
    "followers_url": "https://api.github.com/users/jacqueswww/followers",
    "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
    "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
    "repos_url": "https://api.github.com/users/jacqueswww/repos",
    "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/928/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/928/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/399786443",
    "html_url": "https://github.com/vyperlang/vyper/issues/928#issuecomment-399786443",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/928",
    "id": 399786443,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTc4NjQ0Mw==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T20:46:44Z",
    "updated_at": "2018-06-24T20:46:44Z",
    "author_association": "MEMBER",
    "body": "So, you are replicating the assertions that the token may not be implementating as part of a proper implemetation? This is probably one of the only ways to do this, so I don't see an opportunity for improvement.\r\n\r\nThe better solution is many of these tokens should investigate moving to newer standards and/or better implemetations. We definitely need a more comprehensive standard than ERC20 that accommodates various issues working with tokens. We especially need to stop using the older paradigms of returning false on a revert, at least for interface suggestions. How do we upgrade?\r\n\r\nThese are all philosophical opinions of course. Not sure there is a suggestion here to add to the Vyper language.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/399786443/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/399831087",
    "html_url": "https://github.com/vyperlang/vyper/issues/928#issuecomment-399831087",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/928",
    "id": 399831087,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTgzMTA4Nw==",
    "user": {
      "login": "haydenadams",
      "id": 9343483,
      "node_id": "MDQ6VXNlcjkzNDM0ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9343483?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haydenadams",
      "html_url": "https://github.com/haydenadams",
      "followers_url": "https://api.github.com/users/haydenadams/followers",
      "following_url": "https://api.github.com/users/haydenadams/following{/other_user}",
      "gists_url": "https://api.github.com/users/haydenadams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haydenadams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haydenadams/subscriptions",
      "organizations_url": "https://api.github.com/users/haydenadams/orgs",
      "repos_url": "https://api.github.com/users/haydenadams/repos",
      "events_url": "https://api.github.com/users/haydenadams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haydenadams/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-25T04:57:08Z",
    "updated_at": "2018-06-25T04:57:32Z",
    "author_association": "NONE",
    "body": "I don't think its an issue with the ERC20 standard. If every token returned a boolean value, it would be as simple as:\r\n\r\n```python\r\nassert self.token.transferFrom(msg.sender, self, amount) == True\r\n```\r\n\r\nAnd politically I agree that tokens that did not follow the standard should create a simple wrapping contract which could become the \"real\" token, or get left out of decentralized exchanges. \r\n\r\nAs someone currently building an automated market maker its frustrating because I know they prob wont and I have to make the choice between increasing the gas cost for all other tokens, not supporting certain tokens there is demand for, or building multiple versions of my smart contracts and figuring out a way for them to trade between each other. But yeah I agree not a ton that can be done on your end, was just checking if anyone had any ideas or alternate solutions. ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/399831087/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/461068148",
    "html_url": "https://github.com/vyperlang/vyper/issues/928#issuecomment-461068148",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/928",
    "id": 461068148,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTA2ODE0OA==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-06T15:37:14Z",
    "updated_at": "2019-02-06T15:37:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "@haydenadams can I close this issue now? I don't think there is anything that can be changed from the vyper side?",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/461068148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/462016651",
    "html_url": "https://github.com/vyperlang/vyper/issues/928#issuecomment-462016651",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/928",
    "id": 462016651,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MjAxNjY1MQ==",
    "user": {
      "login": "haydenadams",
      "id": 9343483,
      "node_id": "MDQ6VXNlcjkzNDM0ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9343483?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haydenadams",
      "html_url": "https://github.com/haydenadams",
      "followers_url": "https://api.github.com/users/haydenadams/followers",
      "following_url": "https://api.github.com/users/haydenadams/following{/other_user}",
      "gists_url": "https://api.github.com/users/haydenadams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haydenadams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haydenadams/subscriptions",
      "organizations_url": "https://api.github.com/users/haydenadams/orgs",
      "repos_url": "https://api.github.com/users/haydenadams/repos",
      "events_url": "https://api.github.com/users/haydenadams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haydenadams/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-09T05:52:52Z",
    "updated_at": "2019-02-09T05:53:27Z",
    "author_association": "NONE",
    "body": "Don't think theres anything to change. BNB, OMG, and others should reissue their tokens.\r\n\r\nIs something like this possible in Vyper? Not that I support it lol.\r\n\r\nhttps://github.com/sec-bit/badERC20Fix#solution-for-dapp-and-dex",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/462016651/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/462074932",
    "html_url": "https://github.com/vyperlang/vyper/issues/928#issuecomment-462074932",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/928",
    "id": 462074932,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MjA3NDkzMg==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-09T20:04:18Z",
    "updated_at": "2019-02-09T20:04:18Z",
    "author_association": "MEMBER",
    "body": "Lol, just say no to bad tokens.\r\n\r\nMaybe someone should make WOMG (_Wrapped_ OmiseGO) that is a real implementation that isn't crap, or issue a new token (using Vyper!) and port over balances (a la Augur)",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/462074932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
