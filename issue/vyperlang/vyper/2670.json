{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/2670",
  "id": 1141975851,
  "node_id": "I_kwDOBGDvrM5EESsr",
  "number": 2670,
  "title": "cannot import structs",
  "user": {
    "login": "mhorsley30896",
    "id": 63503907,
    "node_id": "MDQ6VXNlcjYzNTAzOTA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/63503907?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mhorsley30896",
    "html_url": "https://github.com/mhorsley30896",
    "followers_url": "https://api.github.com/users/mhorsley30896/followers",
    "following_url": "https://api.github.com/users/mhorsley30896/following{/other_user}",
    "gists_url": "https://api.github.com/users/mhorsley30896/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mhorsley30896/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mhorsley30896/subscriptions",
    "organizations_url": "https://api.github.com/users/mhorsley30896/orgs",
    "repos_url": "https://api.github.com/users/mhorsley30896/repos",
    "events_url": "https://api.github.com/users/mhorsley30896/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mhorsley30896/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-02-17T22:18:52Z",
  "updated_at": "2022-08-27T23:04:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Suppose I have a simple contract that records a user input in a struct.\r\n\r\n```python\r\n# @version ^0.3.0\r\n\r\nstruct A_Struct:\r\n\ta: uint256\r\n\tb: uint256\r\n\r\nstruct_map: public(HashMap[uint256, A_Struct])\r\n\r\nstruct_idx: uint256\r\n\r\n@external\r\ndef __init__():\r\n\tpass\r\n\r\n@external\r\ndef add_struct(_a: uint256, _b: uint256):\r\n\t\r\n\tstruct_inst: A_Struct = A_Struct({a: _a, b:_b})\r\n\r\n\tself.struct_map[self.struct_idx] = struct_inst\r\n\r\n\tself.struct_idx += 1\r\n```\r\n\r\nNow if I export the interface for this contract such that another contract can use it \r\n\r\n```\r\nvyper -f interface contracts/MyContract.vy\r\n\r\n# Functions\r\n\r\n@external\r\ndef add_struct(_a: uint256, _b: uint256):\r\n    pass\r\n\r\n@view\r\n@external\r\ndef struct_map(arg0: uint256) -> A_Struct:\r\n    pass\r\n\r\n```\r\n\r\nIf I save this output into an interface file called `MyInterface.vy` and then write a second contract\r\n\r\n```python\r\n# @version ^0.3.0\r\n\r\nimport interfaces.MyInterface as MC\r\n\r\nmy_contract: MC\r\n\r\n@external\r\ndef __init__(mc_address: address):\r\n\r\n\tself.my_contract = MC(mc_address)\r\n\r\n@external\r\ndef other_add_struct(_a: uint256, _b: uint256):\r\n\r\n\tself.my_contract.add_struct(_a, _b)\r\n```\r\n\r\nThen when I try and compile this I get an error\r\n\r\n```\r\nUnhandled exception in 'contracts/MyOtherContract.vy':\r\nUnknownType: Compilation failed with the following errors:\r\n\r\nUnknownType: No builtin or user-defined type named 'A_Struct'\r\n  contract \"MC\", function \"struct_map\", line 9:33 \r\n       8 @external\r\n  ---> 9 def struct_map(arg0: uint256) -> A_Struct:\r\n  ----------------------------------------^\r\n      10     pass\r\n\r\n```\r\n\r\nThis error can be removed if I delete `A_Struct` as the return type for `struct_map` in `MyInterface.vy`. Is this expected behaviour or am I misunderstanding something around structs and interfaces?\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/2670/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1043730317",
    "html_url": "https://github.com/vyperlang/vyper/issues/2670#issuecomment-1043730317",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
    "id": 1043730317,
    "node_id": "IC_kwDOBGDvrM4-Ng-N",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T02:00:09Z",
    "updated_at": "2022-02-18T02:00:09Z",
    "author_association": "COLLABORATOR",
    "body": "@mhorsley30896 struct definitions aren't exported from interface definitions. right now the thing to do is redefine `struct A_Struct` again from `MyOtherContract.vy` -\r\n```python\r\nimport interfaces.MyInterface as MC\r\n\r\n# ...\r\nstruct A_Struct:\r\n\ta: uint256\r\n\tb: uint256\r\n# ...\r\n\r\nmy_contract: MC\r\n```\r\n\r\nI'm leaving this issue open though so we can track a discussion about changing the semantics here.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1043730317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1044843380",
    "html_url": "https://github.com/vyperlang/vyper/issues/2670#issuecomment-1044843380",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
    "id": 1044843380,
    "node_id": "IC_kwDOBGDvrM4-Rwt0",
    "user": {
      "login": "mhorsley30896",
      "id": 63503907,
      "node_id": "MDQ6VXNlcjYzNTAzOTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/63503907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mhorsley30896",
      "html_url": "https://github.com/mhorsley30896",
      "followers_url": "https://api.github.com/users/mhorsley30896/followers",
      "following_url": "https://api.github.com/users/mhorsley30896/following{/other_user}",
      "gists_url": "https://api.github.com/users/mhorsley30896/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mhorsley30896/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mhorsley30896/subscriptions",
      "organizations_url": "https://api.github.com/users/mhorsley30896/orgs",
      "repos_url": "https://api.github.com/users/mhorsley30896/repos",
      "events_url": "https://api.github.com/users/mhorsley30896/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mhorsley30896/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T17:00:19Z",
    "updated_at": "2022-02-18T17:00:19Z",
    "author_association": "NONE",
    "body": "@charles-cooper you also have to define `A_Struct` in the interface as well? It does seem like overkill (and a little unpythonic) to have to keep copying and pasting `struct` definitions into arbitrary numbers of files",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1044843380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1044977329",
    "html_url": "https://github.com/vyperlang/vyper/issues/2670#issuecomment-1044977329",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
    "id": 1044977329,
    "node_id": "IC_kwDOBGDvrM4-SRax",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T18:32:32Z",
    "updated_at": "2022-02-18T18:32:32Z",
    "author_association": "COLLABORATOR",
    "body": "> @charles-cooper you also have to define `A_Struct` in the interface as well? It does seem like overkill (and a little unpythonic) to have to keep copying and pasting `struct` definitions into arbitrary numbers of files\r\n\r\nyep you need to define in both places -- and I agree about the overkill part",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1044977329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1045941955",
    "html_url": "https://github.com/vyperlang/vyper/issues/2670#issuecomment-1045941955",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
    "id": 1045941955,
    "node_id": "IC_kwDOBGDvrM4-V87D",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-19T07:29:35Z",
    "updated_at": "2022-02-19T07:29:35Z",
    "author_association": "MEMBER",
    "body": "A side note: ABI encoding defines structs as tuples of their members (although there is some undefined behavior with tight packing), so one way to handle this might to implicitly convert structs to and from tuples, so that the interfaces matched up",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1045941955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1067318143",
    "html_url": "https://github.com/vyperlang/vyper/issues/2670#issuecomment-1067318143",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
    "id": 1067318143,
    "node_id": "IC_kwDOBGDvrM4_nft_",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-14T21:34:00Z",
    "updated_at": "2022-03-14T21:34:00Z",
    "author_association": "COLLABORATOR",
    "body": "meeting notes: we should allow this, `A_Struct` would probably be referenced like `MC.A_Struct`",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1067318143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1229292779",
    "html_url": "https://github.com/vyperlang/vyper/issues/2670#issuecomment-1229292779",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2670",
    "id": 1229292779,
    "node_id": "IC_kwDOBGDvrM5JRYTr",
    "user": {
      "login": "hadfieldn",
      "id": 22274,
      "node_id": "MDQ6VXNlcjIyMjc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/22274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hadfieldn",
      "html_url": "https://github.com/hadfieldn",
      "followers_url": "https://api.github.com/users/hadfieldn/followers",
      "following_url": "https://api.github.com/users/hadfieldn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hadfieldn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hadfieldn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hadfieldn/subscriptions",
      "organizations_url": "https://api.github.com/users/hadfieldn/orgs",
      "repos_url": "https://api.github.com/users/hadfieldn/repos",
      "events_url": "https://api.github.com/users/hadfieldn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hadfieldn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-27T23:04:20Z",
    "updated_at": "2022-08-27T23:04:20Z",
    "author_association": "NONE",
    "body": "+1 for ability to import structs -- would be very helpful!",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1229292779/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
