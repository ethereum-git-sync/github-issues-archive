{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/1573",
  "id": 480345541,
  "node_id": "MDU6SXNzdWU0ODAzNDU1NDE=",
  "number": 1573,
  "title": "[question] best practice to calculate a ratio in Vyper?",
  "user": {
    "login": "or2008",
    "id": 3414979,
    "node_id": "MDQ6VXNlcjM0MTQ5Nzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3414979?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/or2008",
    "html_url": "https://github.com/or2008",
    "followers_url": "https://api.github.com/users/or2008/followers",
    "following_url": "https://api.github.com/users/or2008/following{/other_user}",
    "gists_url": "https://api.github.com/users/or2008/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/or2008/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/or2008/subscriptions",
    "organizations_url": "https://api.github.com/users/or2008/orgs",
    "repos_url": "https://api.github.com/users/or2008/repos",
    "events_url": "https://api.github.com/users/or2008/events{/privacy}",
    "received_events_url": "https://api.github.com/users/or2008/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-08-13T20:10:35Z",
  "updated_at": "2019-08-13T21:01:30Z",
  "closed_at": "2019-08-13T21:01:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am looking for a good way to calculate ratio in Vyper, I have 2 params that each represents balance, and I would like to calculate the ratio between them, and check if the ratio is above or below 50%\r\n\r\nThis is something I wrote, but I really do not know if it safe or even works:\r\nplease let me what do you think\r\n\r\n\r\n```\r\n@public\r\ndef calculateRatio(token_exchange_addr: address, token_addr: address) -> bool:\r\n    eth_reserve: uint256(wei) = token_exchange_addr.balance\r\n    token_reserve: uint256 = ERC20(token_addr).balanceOf(token_exchange_addr)\r\n\r\n    ratio: decimal = convert(as_unitless_number(eth_reserve), decimal) / convert(token_reserve, decimal)\r\n\r\n    if ratio < 0.50: return true\r\n\r\n    return false\r\n```",
  "closed_by": {
    "login": "or2008",
    "id": 3414979,
    "node_id": "MDQ6VXNlcjM0MTQ5Nzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3414979?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/or2008",
    "html_url": "https://github.com/or2008",
    "followers_url": "https://api.github.com/users/or2008/followers",
    "following_url": "https://api.github.com/users/or2008/following{/other_user}",
    "gists_url": "https://api.github.com/users/or2008/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/or2008/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/or2008/subscriptions",
    "organizations_url": "https://api.github.com/users/or2008/orgs",
    "repos_url": "https://api.github.com/users/or2008/repos",
    "events_url": "https://api.github.com/users/or2008/events{/privacy}",
    "received_events_url": "https://api.github.com/users/or2008/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/1573/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/520997032",
    "html_url": "https://github.com/vyperlang/vyper/issues/1573#issuecomment-520997032",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
    "id": 520997032,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDk5NzAzMg==",
    "user": {
      "login": "robinsierra",
      "id": 48950322,
      "node_id": "MDQ6VXNlcjQ4OTUwMzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/48950322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robinsierra",
      "html_url": "https://github.com/robinsierra",
      "followers_url": "https://api.github.com/users/robinsierra/followers",
      "following_url": "https://api.github.com/users/robinsierra/following{/other_user}",
      "gists_url": "https://api.github.com/users/robinsierra/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robinsierra/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robinsierra/subscriptions",
      "organizations_url": "https://api.github.com/users/robinsierra/orgs",
      "repos_url": "https://api.github.com/users/robinsierra/repos",
      "events_url": "https://api.github.com/users/robinsierra/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robinsierra/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-13T20:30:46Z",
    "updated_at": "2019-08-13T20:30:46Z",
    "author_association": "NONE",
    "body": "Checking whether the ratio `x / y < 0.5` is the same as checking whether `2 * x < y`, which doesn't need any type conversions.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/520997032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/520999887",
    "html_url": "https://github.com/vyperlang/vyper/issues/1573#issuecomment-520999887",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
    "id": 520999887,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDk5OTg4Nw==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-13T20:39:00Z",
    "updated_at": "2019-08-13T20:39:53Z",
    "author_association": "MEMBER",
    "body": "For this kind of simple example, the most optimal would be to do what @robinsierra says.\r\n\r\nIf you have a more complex relationship you wish to track, it may be more readable to track it via a decimal state variable as a ratio, but probably it would not be more efficient.\r\n\r\nAlso, you can change it to this (adding @robinsierra's suggestion):\r\n```python\r\n@public\r\n@constant\r\ndef calculateRatio(token_exchange_addr: address, token_addr: address) -> bool:\r\n    eth_reserve: uint256(wei) = token_exchange_addr.balance\r\n    token_reserve: uint256 = ERC20(token_addr).balanceOf(token_exchange_addr)\r\n    # Returns true if the amount of ether reserves is over 50% the amount of tokens\r\n    return 2 * eth_reserve < token_reserve\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/520999887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521001780",
    "html_url": "https://github.com/vyperlang/vyper/issues/1573#issuecomment-521001780",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
    "id": 521001780,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMTAwMTc4MA==",
    "user": {
      "login": "or2008",
      "id": 3414979,
      "node_id": "MDQ6VXNlcjM0MTQ5Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3414979?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/or2008",
      "html_url": "https://github.com/or2008",
      "followers_url": "https://api.github.com/users/or2008/followers",
      "following_url": "https://api.github.com/users/or2008/following{/other_user}",
      "gists_url": "https://api.github.com/users/or2008/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/or2008/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/or2008/subscriptions",
      "organizations_url": "https://api.github.com/users/or2008/orgs",
      "repos_url": "https://api.github.com/users/or2008/repos",
      "events_url": "https://api.github.com/users/or2008/events{/privacy}",
      "received_events_url": "https://api.github.com/users/or2008/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-13T20:44:42Z",
    "updated_at": "2019-08-13T20:44:42Z",
    "author_association": "NONE",
    "body": "Thanks guys, the code you provided is really clean, I will definitely use it.\r\n\r\nbut lets say I want to test more complex ratio, for example 88% (or 0.88), is the type conversion I used is the correct way?\r\n\r\n```\r\nratio: decimal = convert(as_unitless_number(eth_reserve), decimal) / convert(token_reserve, decimal)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521001780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521006181",
    "html_url": "https://github.com/vyperlang/vyper/issues/1573#issuecomment-521006181",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
    "id": 521006181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMTAwNjE4MQ==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-13T20:57:37Z",
    "updated_at": "2019-08-13T20:59:14Z",
    "author_association": "MEMBER",
    "body": "For checking the ratio `a / b < r` (where `r := r_n / r_d`, and `r_n`, `r_d` are whole numbers), you could do `r_d * a < r_n * b`.\r\n\r\nUsing your example, it would be `100 * a < 88 * b`, or (reducing) `25 * a < 22 * b` (which is equivalent)\r\n\r\n---\r\nNote: Vyper already checks for overflow math, but in Solidity you should probably check for this",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521006181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521007107",
    "html_url": "https://github.com/vyperlang/vyper/issues/1573#issuecomment-521007107",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
    "id": 521007107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMTAwNzEwNw==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-13T21:00:07Z",
    "updated_at": "2019-08-13T21:00:07Z",
    "author_association": "MEMBER",
    "body": "If, however, you wanted to parameterize `r`, it would probably be prudent to switch to `decimal` in that case",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521007107/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521007579",
    "html_url": "https://github.com/vyperlang/vyper/issues/1573#issuecomment-521007579",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1573",
    "id": 521007579,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMTAwNzU3OQ==",
    "user": {
      "login": "or2008",
      "id": 3414979,
      "node_id": "MDQ6VXNlcjM0MTQ5Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3414979?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/or2008",
      "html_url": "https://github.com/or2008",
      "followers_url": "https://api.github.com/users/or2008/followers",
      "following_url": "https://api.github.com/users/or2008/following{/other_user}",
      "gists_url": "https://api.github.com/users/or2008/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/or2008/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/or2008/subscriptions",
      "organizations_url": "https://api.github.com/users/or2008/orgs",
      "repos_url": "https://api.github.com/users/or2008/repos",
      "events_url": "https://api.github.com/users/or2008/events{/privacy}",
      "received_events_url": "https://api.github.com/users/or2008/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-13T21:01:30Z",
    "updated_at": "2019-08-13T21:01:30Z",
    "author_association": "NONE",
    "body": "@fubuloubu oh that's a great idea, Thank you very much!",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/521007579/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
