{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/1091",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/1091",
  "id": 383248038,
  "node_id": "MDU6SXNzdWUzODMyNDgwMzg=",
  "number": 1091,
  "title": "\"Invalid Jump Destination\"",
  "user": {
    "login": "haydenadams",
    "id": 9343483,
    "node_id": "MDQ6VXNlcjkzNDM0ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9343483?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haydenadams",
    "html_url": "https://github.com/haydenadams",
    "followers_url": "https://api.github.com/users/haydenadams/followers",
    "following_url": "https://api.github.com/users/haydenadams/following{/other_user}",
    "gists_url": "https://api.github.com/users/haydenadams/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haydenadams/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haydenadams/subscriptions",
    "organizations_url": "https://api.github.com/users/haydenadams/orgs",
    "repos_url": "https://api.github.com/users/haydenadams/repos",
    "events_url": "https://api.github.com/users/haydenadams/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haydenadams/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 479554962,
      "node_id": "MDU6TGFiZWw0Nzk1NTQ5NjI=",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": "Bug that shouldn't change language semantics when fixed."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-11-21T18:38:35Z",
  "updated_at": "2018-11-28T23:11:23Z",
  "closed_at": "2018-11-28T23:11:23Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I've noticed that ever since switching to a vyper version using #901 the only error I get (on transactions that should fail) is `eth.exceptions.InvalidJumpDestination: Invalid Jump Destination`\r\n\r\nHere is my testing setup:\r\nhttps://github.com/Uniswap/contracts-vyper/blob/master/tests/conftest.py\r\n\r\n### Version Information\r\n\r\n* Vyper Version: https://github.com/ethereum/vyper/commits/35038d20bd9946a35261c4c4fbcb27fe61e65f78\r\n* OS: osx Mojave\r\n* Python Version: 3.6.5\r\n* Environment (pipe freeze): \r\n```\r\nasn1crypto==0.24.0\r\natomicwrites==1.2.1\r\nattrdict==2.0.0\r\nattrs==18.2.0\r\ncertifi==2018.10.15\r\ncffi==1.11.5\r\nchardet==3.0.4\r\ncryptography==2.3.1\r\ncytoolz==0.9.0.1\r\neth-abi==1.2.2\r\neth-account==0.2.3\r\neth-bloom==1.0.1\r\neth-hash==0.2.0\r\neth-keyfile==0.5.1\r\neth-keys==0.2.0b3\r\neth-rlp==0.1.2\r\neth-tester==0.1.0b33\r\neth-typing==1.3.0\r\neth-utils==1.2.2\r\nhexbytes==0.1.0\r\nidna==2.7\r\nlru-dict==1.1.6\r\nmore-itertools==4.3.0\r\nparsimonious==0.8.1\r\npluggy==0.8.0\r\npy==1.7.0\r\npy-ecc==1.4.3\r\npy-evm==0.2.0a33\r\npycparser==2.19\r\npycryptodome==3.6.6\r\npyethash==0.1.27\r\npytest==3.9.2\r\nrequests==2.20.0\r\nrlp==1.0.3\r\nsemantic-version==2.6.0\r\nsix==1.11.0\r\ntoolz==0.9.0\r\ntrie==1.3.8\r\nurllib3==1.24\r\nvyper==0.1.0b3\r\nweb3==4.4.1\r\nwebsockets==5.0.1\r\n```\r\n\r\nError Output:\r\n\r\n```\r\ntest_eth_to_token.py:18:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n../../env/lib/python3.6/site-packages/web3/eth.py:263: in sendTransaction\r\n    get_buffered_gas_estimate(self.web3, transaction),\r\n../../env/lib/python3.6/site-packages/web3/utils/transactions.py:84: in get_buffered_gas_estimate\r\n    gas_estimate = web3.eth.estimateGas(gas_estimate_transaction)\r\n../../env/lib/python3.6/site-packages/web3/eth.py:304: in estimateGas\r\n    [transaction],\r\n../../env/lib/python3.6/site-packages/web3/manager.py:107: in request_blocking\r\n    response = self._make_request(method, params)\r\n../../env/lib/python3.6/site-packages/web3/manager.py:90: in _make_request\r\n    return request_func(method, params)\r\n../../env/lib/python3.6/site-packages/web3/middleware/gas_price_strategy.py:18: in middleware\r\n    return make_request(method, params)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/web3/middleware/formatting.py:48: in apply_formatters\r\n    response = make_request(method, formatted_params)\r\n../../env/lib/python3.6/site-packages/web3/middleware/attrdict.py:18: in middleware\r\n    response = make_request(method, params)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/web3/middleware/formatting.py:48: in apply_formatters\r\n    response = make_request(method, formatted_params)\r\n../../env/lib/python3.6/site-packages/web3/middleware/normalize_errors.py:9: in middleware\r\n    result = make_request(method, params)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/web3/middleware/formatting.py:48: in apply_formatters\r\n    response = make_request(method, formatted_params)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/web3/middleware/formatting.py:48: in apply_formatters\r\n    response = make_request(method, formatted_params)\r\n../../env/lib/python3.6/site-packages/web3/providers/eth_tester/middleware.py:320: in middleware\r\n    return make_request(method, [filled_transaction] + params[1:])\r\n../../env/lib/python3.6/site-packages/web3/middleware/fixture.py:12: in middleware\r\n    return make_request(method, params)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/web3/middleware/formatting.py:48: in apply_formatters\r\n    response = make_request(method, formatted_params)\r\n../../env/lib/python3.6/site-packages/web3/providers/eth_tester/main.py:46: in make_request\r\n    response = delegator(self.ethereum_tester, params)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/web3/providers/eth_tester/defaults.py:36: in call_eth_tester\r\n    return getattr(eth_tester, fn_name)(*fn_args, **fn_kwargs)\r\n../../env/lib/python3.6/site-packages/eth_tester/main.py:445: in estimate_gas\r\n    raw_gas_estimate = self.backend.estimate_gas(raw_transaction)\r\n../../env/lib/python3.6/site-packages/eth_tester/utils/formatting.py:85: in wrapper\r\n    return to_wrap(*args, **kwargs)\r\n../../env/lib/python3.6/site-packages/eth_tester/backends/pyevm/main.py:511: in estimate_gas\r\n    return self.chain.estimate_gas(spoofed_transaction)\r\n../../env/lib/python3.6/site-packages/eth/chains/base.py:615: in estimate_gas\r\n    return self.gas_estimator(state, transaction)\r\ncytoolz/functoolz.pyx:232: in cytoolz.functoolz.curry.__call__\r\n    ???\r\n../../env/lib/python3.6/site-packages/eth/estimators/gas.py:65: in binary_gas_search\r\n    raise error\r\n../../env/lib/python3.6/site-packages/eth/vm/computation.py:560: in apply_computation\r\n    opcode_fn(computation=computation)\r\n../../env/lib/python3.6/site-packages/eth/vm/opcode.py:49: in wrapped_logic_fn\r\n    return logic_fn(computation)\r\n\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ncomputation = <eth.vm.forks.byzantium.computation.ByzantiumComputation object at 0x10fcc6400>\r\n\r\n    def jumpi(computation):\r\n        jump_dest, check_value = computation.stack_pop(num_items=2, type_hint=constants.UINT256)\r\n\r\n        if check_value:\r\n            computation.code.pc = jump_dest\r\n\r\n            next_opcode = computation.code.peek()\r\n\r\n            if next_opcode != JUMPDEST:\r\n>               raise InvalidJumpDestination(\"Invalid Jump Destination\")\r\nE               eth.exceptions.InvalidJumpDestination: Invalid Jump Destination\r\n\r\n../../env/lib/python3.6/site-packages/eth/vm/logic/flow.py:39: InvalidJumpDestination\r\n```",
  "closed_by": {
    "login": "jacqueswww",
    "id": 6917456,
    "node_id": "MDQ6VXNlcjY5MTc0NTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacqueswww",
    "html_url": "https://github.com/jacqueswww",
    "followers_url": "https://api.github.com/users/jacqueswww/followers",
    "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
    "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
    "repos_url": "https://api.github.com/users/jacqueswww/repos",
    "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/1091/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/440793157",
    "html_url": "https://github.com/vyperlang/vyper/issues/1091#issuecomment-440793157",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091",
    "id": 440793157,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDc5MzE1Nw==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-21T20:04:24Z",
    "updated_at": "2018-11-21T20:04:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "@haydenadams does this occur on `assert` statements? I think this is probably related to our `get_revert` function if so: https://github.com/ethereum/vyper/blob/master/vyper/compile_lll.py#L30",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/440793157/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/440801172",
    "html_url": "https://github.com/vyperlang/vyper/issues/1091#issuecomment-440801172",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091",
    "id": 440801172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDgwMTE3Mg==",
    "user": {
      "login": "haydenadams",
      "id": 9343483,
      "node_id": "MDQ6VXNlcjkzNDM0ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9343483?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haydenadams",
      "html_url": "https://github.com/haydenadams",
      "followers_url": "https://api.github.com/users/haydenadams/followers",
      "following_url": "https://api.github.com/users/haydenadams/following{/other_user}",
      "gists_url": "https://api.github.com/users/haydenadams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haydenadams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haydenadams/subscriptions",
      "organizations_url": "https://api.github.com/users/haydenadams/orgs",
      "repos_url": "https://api.github.com/users/haydenadams/repos",
      "events_url": "https://api.github.com/users/haydenadams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haydenadams/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-21T20:36:37Z",
    "updated_at": "2018-11-21T20:36:37Z",
    "author_association": "NONE",
    "body": "@jacqueswww It occurs on failing web3 function calls that are not constant. ",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/440801172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/440801785",
    "html_url": "https://github.com/vyperlang/vyper/issues/1091#issuecomment-440801785",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091",
    "id": 440801785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDgwMTc4NQ==",
    "user": {
      "login": "haydenadams",
      "id": 9343483,
      "node_id": "MDQ6VXNlcjkzNDM0ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9343483?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haydenadams",
      "html_url": "https://github.com/haydenadams",
      "followers_url": "https://api.github.com/users/haydenadams/followers",
      "following_url": "https://api.github.com/users/haydenadams/following{/other_user}",
      "gists_url": "https://api.github.com/users/haydenadams/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haydenadams/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haydenadams/subscriptions",
      "organizations_url": "https://api.github.com/users/haydenadams/orgs",
      "repos_url": "https://api.github.com/users/haydenadams/repos",
      "events_url": "https://api.github.com/users/haydenadams/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haydenadams/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-21T20:39:06Z",
    "updated_at": "2018-11-21T20:39:06Z",
    "author_association": "NONE",
    "body": "@jacqueswww  wait sorry I misunderstood. You mean Vyper asserts not pytest asserts.\r\n\r\nYeah I think thats the case. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/440801785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/441319281",
    "html_url": "https://github.com/vyperlang/vyper/issues/1091#issuecomment-441319281",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/1091",
    "id": 441319281,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MTMxOTI4MQ==",
    "user": {
      "login": "jacqueswww",
      "id": 6917456,
      "node_id": "MDQ6VXNlcjY5MTc0NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6917456?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jacqueswww",
      "html_url": "https://github.com/jacqueswww",
      "followers_url": "https://api.github.com/users/jacqueswww/followers",
      "following_url": "https://api.github.com/users/jacqueswww/following{/other_user}",
      "gists_url": "https://api.github.com/users/jacqueswww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jacqueswww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jacqueswww/subscriptions",
      "organizations_url": "https://api.github.com/users/jacqueswww/orgs",
      "repos_url": "https://api.github.com/users/jacqueswww/repos",
      "events_url": "https://api.github.com/users/jacqueswww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jacqueswww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-23T21:21:46Z",
    "updated_at": "2018-11-23T21:21:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "After a lot of digging, I have figured out what is causing this. Doing an invalid jump, was the old method of throwing in a contract, before REVERT came to be. `create_with_code_of` still uses this type of exception after the delegatcall returns a failure. So here are the steps to fix this issue:\r\n\r\n- Fix `kode` variable in functions.py to be more readable, hex blobs should be avoided.\r\n- Make the `create_with_code_of` use REVERT instead.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/441319281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
