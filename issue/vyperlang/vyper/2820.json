{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/2820",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/2820/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/2820/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/2820/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/2820",
  "id": 1210711695,
  "node_id": "I_kwDOBGDvrM5IKf6P",
  "number": 2820,
  "title": "Dynamic arrays are not allocated properly in storage, overlap with following variables",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-04-21T08:44:08Z",
  "updated_at": "2022-04-21T17:22:08Z",
  "closed_at": "2022-04-21T17:22:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Version Information\r\n\r\n* vyper Version (output of `vyper --version`): 0.3.2\r\n* OS: Release Linux Mint 20.3 Una 64-bit\r\n* Python Version (output of `python --version`): Python 3.8.10\r\n\r\n### What's your issue about?\r\n\r\nDynamic arrays are not being allocated properly in storage.  Specifically, whatever variable comes after a dynamic array will not, in fact, be placed after it, but rather will overlap with the final storage slot of the dynamic array.  This is obviously really bad!\r\n\r\nFor example, consider the following contract:\r\n\r\n```vyper\r\narr: DynArray[uint256[2], 3]\r\ninterfere: uint256\r\n\r\n@external\r\ndef run() -> uint256:\r\n    self.arr.append([1, 2])\r\n    self.arr.append([3, 4])\r\n    self.arr.append([5, 6])\r\n    self.interfere = 7\r\n    return self.arr[2][1]\r\n```\r\n\r\nIf you deploy this contract and then run the `run` method, then the storage afterward should look like this:\r\n\r\n```\r\n  0000000000000000000000000000000000000000000000000000000000000003\r\n  0000000000000000000000000000000000000000000000000000000000000001\r\n  0000000000000000000000000000000000000000000000000000000000000002\r\n  0000000000000000000000000000000000000000000000000000000000000003\r\n  0000000000000000000000000000000000000000000000000000000000000004\r\n  0000000000000000000000000000000000000000000000000000000000000005\r\n  0000000000000000000000000000000000000000000000000000000000000006\r\n  0000000000000000000000000000000000000000000000000000000000000007\r\n```\r\n\r\nInstead, we have this:\r\n\r\n```\r\n  0000000000000000000000000000000000000000000000000000000000000003\r\n  0000000000000000000000000000000000000000000000000000000000000001\r\n  0000000000000000000000000000000000000000000000000000000000000002\r\n  0000000000000000000000000000000000000000000000000000000000000003\r\n  0000000000000000000000000000000000000000000000000000000000000004\r\n  0000000000000000000000000000000000000000000000000000000000000005\r\n  0000000000000000000000000000000000000000000000000000000000000007\r\n```\r\n\r\nMoreover, if (again, after a clean deploy) you do it as a call rather than as a transaction, you'll see that you get a return value of 7, rather than 6, as you should.\r\n\r\nI'm hoping there can be some sort of hotfix for this, for obvious reasons!  Thank you!",
  "closed_by": {
    "login": "charles-cooper",
    "id": 3867501,
    "node_id": "MDQ6VXNlcjM4Njc1MDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charles-cooper",
    "html_url": "https://github.com/charles-cooper",
    "followers_url": "https://api.github.com/users/charles-cooper/followers",
    "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
    "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
    "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
    "repos_url": "https://api.github.com/users/charles-cooper/repos",
    "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/2820/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/2820/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1104924882",
    "html_url": "https://github.com/vyperlang/vyper/issues/2820#issuecomment-1104924882",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2820",
    "id": 1104924882,
    "node_id": "IC_kwDOBGDvrM5B29DS",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-21T09:11:02Z",
    "updated_at": "2022-04-21T09:11:02Z",
    "author_association": "COLLABORATOR",
    "body": "Looking into this",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1104924882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
