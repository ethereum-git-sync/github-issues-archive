{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/3716",
  "id": 2060315521,
  "node_id": "I_kwDOBGDvrM56zeuB",
  "number": 3716,
  "title": "VIP [draft]: native asset types",
  "user": {
    "login": "charles-cooper",
    "id": 3867501,
    "node_id": "MDQ6VXNlcjM4Njc1MDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charles-cooper",
    "html_url": "https://github.com/charles-cooper",
    "followers_url": "https://api.github.com/users/charles-cooper/followers",
    "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
    "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
    "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
    "repos_url": "https://api.github.com/users/charles-cooper/repos",
    "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2023-12-29T18:30:30Z",
  "updated_at": "2024-01-02T21:25:12Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Simple Summary\r\nbring new types to vyper which safely model assets, natively\r\n\r\n## Motivation\r\naccounting is hard. instead of assets being represented by raw numbers as they currently are, add a special kind of asset type which is more constrained. this removes the possibility for rounding errors and will increase clarity of user code.\r\n\r\nthis new type enforces the invariant that each action to the ledger has an equal and opposite reaction. in code- terms, it un-denormalizes code, increases DRYness and reduces the potential for accounting bugs (ex. rounding errors, missed actions).\r\n```vyper\r\n# example buggy code\r\ndef mint10():\r\n    self.balances[addr] += 10\r\n    self.totalSupply += 19  # typo\r\n```\r\n\r\n```vyper\r\n# with assets\r\ndef mint10():\r\n    self.balances[addr] += 10   # error! can't assign directly\r\n    self.balances[addr] = 10   # error! can't assign directly\r\n\r\n    self.balances.move_from(self.totalSupply, 10)\r\n```\r\n\r\nnotes:\r\n- I previously proposed a language feature in https://github.com/vyperlang/vyper/issues/1277 to solve this problem, but the form was somewhat clunky and depended on an SMT solver to work.\r\n- @jacqueswww proposed a similar function in https://github.com/vyperlang/vyper/issues/1277#issuecomment-476289291, this proposal improves on it by adding a native type with appropriate constraints for the user\r\n- other languages including flintlang and move propose mechanisms involving linear types, but i don't think applying the borrow checker model to assets really models it correctly. the purpose of linear / affine types is to ensure resources are used exactly / at most once. this is useful for RAII use cases. but the fundamental point here is that assets are never created or destroyed, only transferred between ledger tables. so applying the linear type model is a bit like trying to fit a round peg in a square hole.\r\n\r\n\r\n## Specification\r\nadd a new parametrizable type, `Asset` to vyper. `Asset` takes two type parameters, the subtype and an \"intrinsic sign\", which basically just corresponds to whether the account is debit- or credit- normal.\r\n\r\n`Asset` cannot be assigned to directly, but can only be modified through the builtin `move_from` method.\r\n\r\nexample:\r\n```vyper\r\ntotalSupply: Asset[uint256, -]  # move_from totalSupply *increases* totalSupply\r\nbalances: HashMap[address, Asset[uint256, +]  # move_from a balance *decreases* the balance\r\n\r\ndef transfer(recipient: addr, amount: uint256):\r\n    self.balances[recipient].move_from(self.balances[msg.sender], amount)\r\n\r\ndef mint(recipient: addr, amount: uint256):\r\n    self.balances[recipient].move_from(self.totalSupply, amount)\r\n```\r\n\r\ntbd:\r\n- open to other names for `Asset`\r\n- the `+/-` syntax might look a little funky to programmers, maybe `Asset` vs `NegativeAsset` are more intuitive\r\n- `move_from` could be unintuitive when the source and destination accounts have opposite intrinsic signs. if this is the case, maybe additional methods like `mint_to(src: Asset, dst: NegativeAsset)` and `burn_from(src: Asset, dst: NegativeAsset)` could potentially be considered. the usage of `move_from` in the above `mint()` function would not be allowed and it would instead be written as\r\n    ```vyper\r\n    def mint(...):\r\n        self.balances[recipient].mint_from(self.totalSupply, amount)\r\n    ```\r\n\r\n## Backwards Compatibility\r\nno breaking changes\r\n\r\n## References\r\nhttps://github.com/vyperlang/vyper/issues/1277\r\nhttps://en.wikipedia.org/wiki/Debits_and_credits\r\n\r\n## Copyright\r\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/3716/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1872510530",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1872510530",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1872510530,
    "node_id": "IC_kwDOBGDvrM5vnD5C",
    "user": {
      "login": "pcaversaccio",
      "id": 25297591,
      "node_id": "MDQ6VXNlcjI1Mjk3NTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25297591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcaversaccio",
      "html_url": "https://github.com/pcaversaccio",
      "followers_url": "https://api.github.com/users/pcaversaccio/followers",
      "following_url": "https://api.github.com/users/pcaversaccio/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcaversaccio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcaversaccio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcaversaccio/subscriptions",
      "organizations_url": "https://api.github.com/users/pcaversaccio/orgs",
      "repos_url": "https://api.github.com/users/pcaversaccio/repos",
      "events_url": "https://api.github.com/users/pcaversaccio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcaversaccio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-30T11:36:18Z",
    "updated_at": "2023-12-30T11:36:18Z",
    "author_association": "COLLABORATOR",
    "body": "Overall I like this idea very much. But I have to admit that I had to read the specs multiple times to understand the semantics of the \"intrinsic sign\" correctly. I think the word `move` can also be debated. Like asset creations (i.e. what you refer to minting above) could be called `create_resource(...)` and destroying/removing assets could be simply called `destroy_resource(...)` (see below my naming suggestion). For moving the asset, it could be simply `transfer_resource(...)`. This wording is much faster to comprehend. Also, what do you think about this syntax instead (I implicitly want to kick off the convo around generics):\r\n\r\n```vyper\r\nT = vyper.TypeVar(\"uint256\")\r\ntotalSupply: public(Resource[T])\r\nbalanceOf: public(HashMap[address, Resource[vyper.type(self.totalSupply)])\r\n\r\ndef transfer(to: address, amount: uint256):\r\n    transfer_resource(self.totalSupply, self.balanceOf[msg.sender], self.balanceOf[to], amount)\r\n\r\ndef mint(owner: address, amount: uint256):\r\n    create_resource(self.totalSupply, empty(address), self.balanceOf[owner], amount)\r\n\r\ndef burn(owner: address, amount: uint256):\r\n    destroy_resource(self.totalSupply, self.balanceOf[owner], empty(address), amount)\r\n```\r\n\r\nSo the functions would be like:\r\n\r\n```vyper\r\ntransfer_resource(resource: Resource[T], resource_origin: HashMap[address, Resource[vyper.type(resource)]], resource_destination: HashMap[address, Resource[vyper.type(resource)]], resource_amount: uint256)\r\ncreate_resource(resource: Resource[T], resource_origin: address=empty(address), resource_destination: HashMap[address, Resource[vyper.type(resource)]], resource_amount: uint256)\r\ndestroy_resource(resource: Resource[T], resource_origin: HashMap[address, Resource[vyper.type(resource)]], resource_destination: address=empty(address), resource_amount: uint256)\r\n```\r\n\r\nWe might want to have an `unsafe` version of it for people who wanna skip the compiler invariant checks to save gas and assume they know what they do :). Maybe this can be implemented via a `kwarg`...\r\n\r\nI personally like `Resource` as a name since it's somehow more general. `Asset` is very finger-pointing to DeFi somehow, which is fine, but we should consider a name that is more generic IMO.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1872510530/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1872536748",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1872536748",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1872536748,
    "node_id": "IC_kwDOBGDvrM5vnKSs",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-30T14:20:29Z",
    "updated_at": "2023-12-30T14:20:29Z",
    "author_association": "MEMBER",
    "body": "i have a slight preference for \"asset\"- related terminology. \"resource\" sounds more like filehandles or linear types.\r\n\r\ni think maybe the key insight from the \"theory\" of double-entry accounting being applied here is that assets are never created or destroyed, only moved -- and the way it is able to work is because some accounts have opposite intrinsic sign than others. so `balances[addr].move_from(totalSupply)` is a debit to totalSupply and a credit to balances, but that increases the value of both accounts. it enforces the invariant `totalSupply - sum(balances) == 0` by construction!",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1872536748/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1872536937",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1872536937",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1872536937,
    "node_id": "IC_kwDOBGDvrM5vnKVp",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-30T14:21:40Z",
    "updated_at": "2023-12-30T14:21:40Z",
    "author_association": "MEMBER",
    "body": "recommended reading for those unfamiliar with the debits/credits terminology: https://en.wikipedia.org/wiki/Debits_and_credits",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1872536937/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1873545832",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1873545832",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1873545832,
    "node_id": "IC_kwDOBGDvrM5vrApo",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T00:47:52Z",
    "updated_at": "2024-01-02T18:07:43Z",
    "author_association": "MEMBER",
    "body": "A totally different proposal that only requires struct methods to perform similar tasks:\r\n\r\n```vyper\r\n# NOTE: Could be defined as an internal library type\r\n\r\nstruct Ledger(HashMap[address, uint256]):  # NOTE: could also add generic support over time\r\n# struct Ledger[K: vyper.traits.Hashable, V: vyper.traits.AddSubTrait](HashMap[K, V]): ...\r\n\r\n    # NOTE: We can add additional members to struct subclasses\r\n    total: uint256\r\n\r\n    # NOTE: `HashMap` subclasses `vyper.types.Mapping` and hashes the key for access\r\n    # NOTE: `vyper.types.Mapping` defines two methods: `__getval__` and `__setval__`\r\n    def mint(self, receiver: address, amount: uint256):  # NOTE: with generics, we could parametrize these inputs\r\n        self.total += amount  # NOTE: This is safemath\r\n        self.__setval__(\r\n            receiver,\r\n            # NOTE: This is safe because of the previous safe add\r\n            unsafe_add(self.__getval__(receiver), amount),\r\n        )\r\n\r\n    def transfer(self, owner: address, receiver: address, amount: uint256):\r\n        self.__setval__(\r\n            owner,\r\n            # NOTE: If underflow, then it should raise invalid operation\r\n            self.__getval__(owner) - amount,\r\n        )\r\n        self.__setval__(\r\n            receiver,\r\n            # NOTE: This is safe because of the underflow check and the property of conservation on `.total`\r\n            unsafe_add(self.__getval__(receiver), amount),\r\n        )\r\n\r\n    def burn(self, owner: address, amount: uint256):\r\n        self.__setval__(\r\n            owner,\r\n            # NOTE: If underflow, then it should raise invalid operation\r\n            self.__getval__(owner) - amount,\r\n        )\r\n        # NOTE: This is safe because of the underflow check and the property of conservation on `.total`\r\n        self.total = unsafe_sub(self.total, amount),\r\n\r\n    # NOTE: Should have someway of generating a `public` getter method\r\n```\r\n\r\nThen could be used like this:\r\n```vyper\r\nfrom vyper.types import Ledger\r\n\r\nbalanceOf: public(Ledger)\r\n# NOTE: export `totalSupply` public getter as `balanceOf.total`\r\n\r\n@external\r\ndef transfer(receiver: address, amount: uint256) -> bool:\r\n    self.balanceOf.transfer(msg.sender, receiver, amount)\r\n    log Transfer(msg.sender, receiver, amount)\r\n    return True\r\n\r\n...\r\n```\r\n\r\nKind of a nice side effect here is that the `.total` storage slot gets \"flattened\" into the struct",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1873545832/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874034722",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874034722",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874034722,
    "node_id": "IC_kwDOBGDvrM5vs4Ai",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T13:35:59Z",
    "updated_at": "2024-01-02T18:07:51Z",
    "author_association": "MEMBER",
    "body": "> A totally different proposal that only requires struct methods to perform similar tasks:\r\n\r\ni think this is a fine proposal but it more belongs in a discussion about metaprogramming / dunder methods than the issue at hand",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874034722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874042458",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874042458",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874042458,
    "node_id": "IC_kwDOBGDvrM5vs55a",
    "user": {
      "login": "pcaversaccio",
      "id": 25297591,
      "node_id": "MDQ6VXNlcjI1Mjk3NTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25297591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcaversaccio",
      "html_url": "https://github.com/pcaversaccio",
      "followers_url": "https://api.github.com/users/pcaversaccio/followers",
      "following_url": "https://api.github.com/users/pcaversaccio/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcaversaccio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcaversaccio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcaversaccio/subscriptions",
      "organizations_url": "https://api.github.com/users/pcaversaccio/orgs",
      "repos_url": "https://api.github.com/users/pcaversaccio/repos",
      "events_url": "https://api.github.com/users/pcaversaccio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcaversaccio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T13:43:11Z",
    "updated_at": "2024-01-02T18:07:58Z",
    "author_association": "COLLABORATOR",
    "body": "> i think this is a fine proposal but it more belongs in a discussion about metaprogramming / dunder methods than the issue at hand\r\n\r\ngood point - we should actually have an open issue about these topics...",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874042458/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874320513",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874320513",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874320513,
    "node_id": "IC_kwDOBGDvrM5vt9yB",
    "user": {
      "login": "pcaversaccio",
      "id": 25297591,
      "node_id": "MDQ6VXNlcjI1Mjk3NTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25297591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcaversaccio",
      "html_url": "https://github.com/pcaversaccio",
      "followers_url": "https://api.github.com/users/pcaversaccio/followers",
      "following_url": "https://api.github.com/users/pcaversaccio/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcaversaccio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcaversaccio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcaversaccio/subscriptions",
      "organizations_url": "https://api.github.com/users/pcaversaccio/orgs",
      "repos_url": "https://api.github.com/users/pcaversaccio/repos",
      "events_url": "https://api.github.com/users/pcaversaccio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcaversaccio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T17:24:10Z",
    "updated_at": "2024-01-02T18:08:49Z",
    "author_association": "COLLABORATOR",
    "body": "Some further thoughts. Maybe it's worth considering the [dataclass](https://docs.python.org/3/library/dataclasses.html) decorator as we will add further special dunder functions in the future:\r\n\r\n```vyper\r\n__typevars__ = { \"T\" }\r\n\r\n@dataclass(getval=True, setval=True, system=False, typevars=True)\r\nstruct Ledger(HashMap[address, T]):\r\n    total: T\r\n\r\n    def mint(self, receiver: address, amount: T):\r\n        self.total += amount\r\n        __setval__(receiver, unsafe_add(__getval__(receiver), amount))\r\n        __system__(b\"...\") # Does not work since disallowed\r\n\r\n    def transfer(self, owner: address, receiver: address, amount: T):\r\n        __setval__(owner, __getval__(owner) - amount)\r\n        __setval__(receiver, unsafe_add(__getval__(receiver), amount))\r\n\r\n    def burn(self, owner: address, amount: T):\r\n        __setval__(owner, __getval__(owner) - amount)\r\n        self.total = unsafe_sub(self.total, amount)\r\n```\r\n\r\n```vyper\r\nfrom vyper.types import Ledger(\"uint256\")\r\n\r\nbalanceOf: public(Ledger)\r\n\r\n@external\r\ndef transfer(receiver: address, amount: uint256) -> bool:\r\n    self.balanceOf.transfer(msg.sender, receiver, amount)\r\n    self.balanceOf(self.__system__(b\"...\")) # Does not work since disallowed\r\n    log Transfer(msg.sender, receiver, amount)\r\n    return True\r\n\r\n...\r\n```\r\n\r\nUsing dataclasses, a library maintainer could essentially define what special functions are allowed in the context of such a struct.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874320513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874362421",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874362421",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874362421,
    "node_id": "IC_kwDOBGDvrM5vuIA1",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T18:02:24Z",
    "updated_at": "2024-01-02T18:08:58Z",
    "author_association": "MEMBER",
    "body": "> Using dataclasses, a library maintainer could essentially define what special functions are allowed in the context of such a struct.\r\n\r\nthis is kinda of what Python protocols can do, which are similar to Traits",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874362421/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874369093",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874369093",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874369093,
    "node_id": "IC_kwDOBGDvrM5vuJpF",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T18:07:22Z",
    "updated_at": "2024-01-02T18:09:06Z",
    "author_association": "MEMBER",
    "body": "we should move this discussion to another issue specifically about metaprogramming, i am hiding these comments as off-topic",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874369093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874369222",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874369222",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874369222,
    "node_id": "IC_kwDOBGDvrM5vuJrG",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T18:07:29Z",
    "updated_at": "2024-01-02T18:09:12Z",
    "author_association": "MEMBER",
    "body": "https://github.com/vyperlang/vyper/issues/3717",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874369222/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874393444",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874393444",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874393444,
    "node_id": "IC_kwDOBGDvrM5vuPlk",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T18:30:46Z",
    "updated_at": "2024-01-02T21:24:57Z",
    "author_association": "MEMBER",
    "body": "Would like to note that [this original comment](https://github.com/vyperlang/vyper/issues/3716#issuecomment-1873545832), while proposing a different way of implementing the same feature in OP, was also trying to point out some of the difficulties with adding a new type to solve the problem as well\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874393444/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874585832",
    "html_url": "https://github.com/vyperlang/vyper/issues/3716#issuecomment-1874585832",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/3716",
    "id": 1874585832,
    "node_id": "IC_kwDOBGDvrM5vu-jo",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T21:24:45Z",
    "updated_at": "2024-01-02T21:25:12Z",
    "author_association": "MEMBER",
    "body": "> Would like to note that [this original comment](https://github.com/vyperlang/vyper/issues/3716#issuecomment-1873545832), while proposing a different way of implementing the same feature in OP, was also trying to point out some of the difficulties with adding a new type to solve the problem as well\r\n\r\nhmm, it seemed to propose something orthogonal and did not really provide any feedback on the issue, so i marked it as off-topic. if you have some topical feedback on the proposal at hand please continue the discussion below!",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1874585832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
