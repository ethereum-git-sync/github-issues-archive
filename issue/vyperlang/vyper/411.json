{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/411",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/411/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/411/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/411/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/411",
  "id": 266668743,
  "node_id": "MDU6SXNzdWUyNjY2Njg3NDM=",
  "number": 411,
  "title": "num256 sub overflow protection doesn't work",
  "user": {
    "login": "pdaian",
    "id": 565776,
    "node_id": "MDQ6VXNlcjU2NTc3Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/565776?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pdaian",
    "html_url": "https://github.com/pdaian",
    "followers_url": "https://api.github.com/users/pdaian/followers",
    "following_url": "https://api.github.com/users/pdaian/following{/other_user}",
    "gists_url": "https://api.github.com/users/pdaian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pdaian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pdaian/subscriptions",
    "organizations_url": "https://api.github.com/users/pdaian/orgs",
    "repos_url": "https://api.github.com/users/pdaian/repos",
    "events_url": "https://api.github.com/users/pdaian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pdaian/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-10-18T22:56:45Z",
  "updated_at": "2017-12-29T07:36:16Z",
  "closed_at": "2017-10-19T16:08:58Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "viper Version: 0.0.2\r\npyethereum Version: 2.1.0\r\nOS: linux\r\nPython Version (python --version): 3.6\r\n\r\n### What's your issue about?\r\n\r\nnum256_sub overflow protection appears to be very broken (fails in cases that should succeed, succeeds in cases that should fail); at first glance, perhaps it is flipping the order of the arguments to the sub function in the overflow check (failing when y - x would overflow, not x - y).\r\n\r\nMinimal example:\r\n\r\n```\r\nfrom ethereum.tools import tester as t\r\nfrom ethereum.slogging import configure_logging\r\n\r\n#configure_logging(':trace')\r\ns = t.Chain()\r\nfrom viper import compiler\r\n\r\ncode = \"\"\"\r\ndef foo(x:num256) -> num256:\r\n    return num256_sub(x, as_num256(1))\r\n\r\ndef foo2(x:num256) -> num256:\r\n    return x\r\n\r\ndef foo3(x:num256) -> num256:\r\n    return num256_sub(as_num256(1), x)\r\n\"\"\"\r\n\r\nt.languages['viper'] = compiler.Compiler() \r\n\r\nc = s.contract(code, language='viper')\r\n\r\nNUM256_MAX = 115792089237316195423570985008687907853269984665640564039457584007913129639935  # Max possible num256 value\r\nprint(c.foo2(NUM256_MAX)) # Should/does return NUM256_MAX\r\nprint(c.foo3(NUM256_MAX)) # Should fail; instead returns 2\r\nprint(c.foo(NUM256_MAX)) # Should return NUM256_MAX - 1; instead fails\r\n```\r\n\r\n### How can it be fixed?\r\n\r\nHave not looked into this yet.\r\n\r\n#### Cute Animal Picture\r\n\r\n```\r\n             |       :     . |\r\n             | '  :      '   |\r\n             |  .  |   '  |  |\r\n   .--._ _...:.._ _.--. ,  ' |\r\n  (  ,  `        `  ,  )   . |\r\n   '-/              \\-'  |   |\r\n     |  o   /\\   o  |       :|\r\n     \\     _\\/_     / :  '   |\r\n     /'._   ^^   _.;___      |\r\n   /`    `\"\"\"\"\"\"`      `\\=   |\r\n /`                     /=  .|\r\n;             '--,-----'=    |\r\n|                 `\\  |    . |\r\n\\                   \\___ :   |\r\n/'.                     `\\=  |\r\n\\_/`--......_            /=  |\r\n            |`-.        /= : |\r\n            | : `-.__ /` .   |\r\n            |jgs .   ` |    '|\r\n            |  .  : `   . |  |\r\n```",
  "closed_by": {
    "login": "pdaian",
    "id": 565776,
    "node_id": "MDQ6VXNlcjU2NTc3Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/565776?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pdaian",
    "html_url": "https://github.com/pdaian",
    "followers_url": "https://api.github.com/users/pdaian/followers",
    "following_url": "https://api.github.com/users/pdaian/following{/other_user}",
    "gists_url": "https://api.github.com/users/pdaian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pdaian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pdaian/subscriptions",
    "organizations_url": "https://api.github.com/users/pdaian/orgs",
    "repos_url": "https://api.github.com/users/pdaian/repos",
    "events_url": "https://api.github.com/users/pdaian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pdaian/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/411/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/411/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/337756616",
    "html_url": "https://github.com/vyperlang/vyper/issues/411#issuecomment-337756616",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/411",
    "id": 337756616,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzc1NjYxNg==",
    "user": {
      "login": "DavidKnott",
      "id": 17552858,
      "node_id": "MDQ6VXNlcjE3NTUyODU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17552858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidKnott",
      "html_url": "https://github.com/DavidKnott",
      "followers_url": "https://api.github.com/users/DavidKnott/followers",
      "following_url": "https://api.github.com/users/DavidKnott/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidKnott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidKnott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidKnott/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidKnott/orgs",
      "repos_url": "https://api.github.com/users/DavidKnott/repos",
      "events_url": "https://api.github.com/users/DavidKnott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidKnott/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-18T23:28:13Z",
    "updated_at": "2017-10-18T23:28:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@pdaian I'll fix this now",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/337756616/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/337957387",
    "html_url": "https://github.com/vyperlang/vyper/issues/411#issuecomment-337957387",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/411",
    "id": 337957387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNzk1NzM4Nw==",
    "user": {
      "login": "pdaian",
      "id": 565776,
      "node_id": "MDQ6VXNlcjU2NTc3Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/565776?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pdaian",
      "html_url": "https://github.com/pdaian",
      "followers_url": "https://api.github.com/users/pdaian/followers",
      "following_url": "https://api.github.com/users/pdaian/following{/other_user}",
      "gists_url": "https://api.github.com/users/pdaian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pdaian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pdaian/subscriptions",
      "organizations_url": "https://api.github.com/users/pdaian/orgs",
      "repos_url": "https://api.github.com/users/pdaian/repos",
      "events_url": "https://api.github.com/users/pdaian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pdaian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-19T16:08:58Z",
    "updated_at": "2017-10-19T16:08:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "I looked at the LLL changes and they look correct, closing.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/337957387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/354277352",
    "html_url": "https://github.com/vyperlang/vyper/issues/411#issuecomment-354277352",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/411",
    "id": 354277352,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDI3NzM1Mg==",
    "user": {
      "login": "denis-bogdanas",
      "id": 5214914,
      "node_id": "MDQ6VXNlcjUyMTQ5MTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5214914?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/denis-bogdanas",
      "html_url": "https://github.com/denis-bogdanas",
      "followers_url": "https://api.github.com/users/denis-bogdanas/followers",
      "following_url": "https://api.github.com/users/denis-bogdanas/following{/other_user}",
      "gists_url": "https://api.github.com/users/denis-bogdanas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/denis-bogdanas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/denis-bogdanas/subscriptions",
      "organizations_url": "https://api.github.com/users/denis-bogdanas/orgs",
      "repos_url": "https://api.github.com/users/denis-bogdanas/repos",
      "events_url": "https://api.github.com/users/denis-bogdanas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/denis-bogdanas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-28T11:56:13Z",
    "updated_at": "2017-12-28T11:56:13Z",
    "author_association": "NONE",
    "body": "Hi, I have a related question. Is num256 overflow protected or not? \r\n\r\nThis document says:\r\nhttps://github.com/ethereum/vyper/tree/master/examples/tokens/ERC20_solidity_compatible\r\n\"Notably, num256 is not overflow protected\". \r\n\r\nViper reference says nothing on the topic. This issue suggests it is protected. Conflicting data.\r\n\r\nthanks,\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/354277352/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/354395554",
    "html_url": "https://github.com/vyperlang/vyper/issues/411#issuecomment-354395554",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/411",
    "id": 354395554,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDM5NTU1NA==",
    "user": {
      "login": "DavidKnott",
      "id": 17552858,
      "node_id": "MDQ6VXNlcjE3NTUyODU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17552858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DavidKnott",
      "html_url": "https://github.com/DavidKnott",
      "followers_url": "https://api.github.com/users/DavidKnott/followers",
      "following_url": "https://api.github.com/users/DavidKnott/following{/other_user}",
      "gists_url": "https://api.github.com/users/DavidKnott/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DavidKnott/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DavidKnott/subscriptions",
      "organizations_url": "https://api.github.com/users/DavidKnott/orgs",
      "repos_url": "https://api.github.com/users/DavidKnott/repos",
      "events_url": "https://api.github.com/users/DavidKnott/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DavidKnott/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-29T04:13:25Z",
    "updated_at": "2017-12-29T04:13:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "@denis-bogdanas Thanks a lot for bringing this up! `num256` overflow protection has been implemented and is tested [here](https://github.com/ethereum/vyper/blob/master/tests/parser/types/numbers/test_num256.py).  Would you mind making a PR for the ERC20_solidity_compatible Readme correcting this?",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/354395554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/354410250",
    "html_url": "https://github.com/vyperlang/vyper/issues/411#issuecomment-354410250",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/411",
    "id": 354410250,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NDQxMDI1MA==",
    "user": {
      "login": "denis-bogdanas",
      "id": 5214914,
      "node_id": "MDQ6VXNlcjUyMTQ5MTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5214914?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/denis-bogdanas",
      "html_url": "https://github.com/denis-bogdanas",
      "followers_url": "https://api.github.com/users/denis-bogdanas/followers",
      "following_url": "https://api.github.com/users/denis-bogdanas/following{/other_user}",
      "gists_url": "https://api.github.com/users/denis-bogdanas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/denis-bogdanas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/denis-bogdanas/subscriptions",
      "organizations_url": "https://api.github.com/users/denis-bogdanas/orgs",
      "repos_url": "https://api.github.com/users/denis-bogdanas/repos",
      "events_url": "https://api.github.com/users/denis-bogdanas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/denis-bogdanas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-29T07:36:16Z",
    "updated_at": "2017-12-29T07:36:16Z",
    "author_association": "NONE",
    "body": "I guess it's better for someone more knowledgeable to review that document. There are probably more things to update.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/354410250/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
