{
  "url": "https://api.github.com/repos/vyperlang/vyper/issues/2858",
  "repository_url": "https://api.github.com/repos/vyperlang/vyper",
  "labels_url": "https://api.github.com/repos/vyperlang/vyper/issues/2858/labels{/name}",
  "comments_url": "https://api.github.com/repos/vyperlang/vyper/issues/2858/comments",
  "events_url": "https://api.github.com/repos/vyperlang/vyper/issues/2858/events",
  "html_url": "https://github.com/vyperlang/vyper/issues/2858",
  "id": 1237820981,
  "node_id": "I_kwDOBGDvrM5Jx6Y1",
  "number": 2858,
  "title": "`continue` outside of loop context results in compiler panic",
  "user": {
    "login": "0xMaka",
    "id": 12489182,
    "node_id": "MDQ6VXNlcjEyNDg5MTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/12489182?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xMaka",
    "html_url": "https://github.com/0xMaka",
    "followers_url": "https://api.github.com/users/0xMaka/followers",
    "following_url": "https://api.github.com/users/0xMaka/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xMaka/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xMaka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xMaka/subscriptions",
    "organizations_url": "https://api.github.com/users/0xMaka/orgs",
    "repos_url": "https://api.github.com/users/0xMaka/repos",
    "events_url": "https://api.github.com/users/0xMaka/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xMaka/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4038639649,
      "node_id": "LA_kwDOBGDvrM7wuMAh",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/bug%20-%20typechecker",
      "name": "bug - typechecker",
      "color": "51B431",
      "default": false,
      "description": "issue with typechecker"
    },
    {
      "id": 4038686785,
      "node_id": "LA_kwDOBGDvrM7wuXhB",
      "url": "https://api.github.com/repos/vyperlang/vyper/labels/bug%20-%20type%200",
      "name": "bug - type 0",
      "color": "f9d0c4",
      "default": false,
      "description": "compiler halts or panics instead of generating code"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-05-16T22:44:09Z",
  "updated_at": "2022-05-22T10:28:26Z",
  "closed_at": "2022-05-22T10:28:26Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Version Information\r\n\r\n* vyper Version (output of `vyper --version`): 0.2.16\r\n* OS: Arch Linux x86_64\r\n* Python Version (output of `python --version`): Python 3.10.4\r\n\r\n### What's your issue about?\r\nUnhandled internal compiler error\r\n\r\nPlease include information like:\r\n\r\n* full output of the error you received\r\n> vyper.exceptions.CompilerPanic: Invalid break\r\n> This is an unhandled internal compiler error. Please create an issue on Github to notify the developers.\r\n> https://github.com/vyperlang/vyper/issues/new?template=bug.md\r\n\r\n* what command you ran\r\n vyper interface.vy > bin/interface.bin\r\n\r\n* the code that caused the failure (see [this link](https://help.github.com/articles/basic-writing-and-formatting-syntax/) for help with formatting code)\r\n```vyper\r\n# @version 0.2.16\r\n# @author maka\r\n# @title interFaceStation\r\n# @notice fun with interfaces\r\n\r\ninterface IERC20:\r\n  def totalSupply() -> uint256: view\r\n  def balanceOf(account: address) -> uint256: view\r\n  def transfer(recipient: address, amount: uint256) -> bool: nonpayable\r\n  def allowance(owner: address, spender: address) -> uint256: view\r\n  def approve(spender: address, amount: uint256) -> bool: nonpayable\r\n  def transferFrom(sender: address, recipient: address, amount: uint256) -> bool: nonpayable\r\n\r\n\r\nevent Withdraw:\r\n  token: address\r\n  amount: uint256\r\n\r\nevent Exchange:\r\n  tokenIn: address\r\n  tokenOut: address\r\n  skimmed: bool\r\n\r\n\r\nadmin: address\r\nweth: public(address)\r\nrouter: public(address)\r\n\r\n\r\n\r\n@external\r\ndef __init__(_weth: address, _router: address):\r\n  self.admin = msg.sender \r\n  self.weth = _weth\r\n  self.router = _router\r\n\r\n\r\n# @notice you can deposit eth via direct transfer\r\n#  fallback will be called, and any eth will be auto wrapped ready to swap \r\n@external\r\n@payable\r\ndef __default__():\r\n  raw_call(\r\n    self.weth,\r\n    method_id('deposit()'),\r\n    value = msg.value,\r\n    max_outsize=0,\r\n    is_delegate_call=False\r\n  )\r\n\r\n\r\n# just playing around\r\n@view\r\n@external\r\ndef getSupply(_token: address) -> uint256:\r\n  return IERC20(_token).totalSupply()\r\n\r\n@view\r\n@external\r\ndef getBalance(_token: address, _account: address) -> uint256:\r\n  return IERC20(_token).balanceOf(_account)\r\n\r\n\r\n# @notice can only be called by a function that does do a check on caller\r\n@internal\r\ndef transfer(_token: address, _recipient: address, _amount: uint256) -> bool:\r\n  return IERC20(_token).transfer(_recipient, _amount)\r\n\r\n@external\r\ndef withdrawAll(_token: address):\r\n  assert msg.sender == self.admin\r\n  amount: uint256 = IERC20(_token).balanceOf(self)\r\n  self.transfer(_token, self.admin, amount)\r\n  log Withdraw(_token, amount)\r\n\r\n# @params\r\n# tokenIn: address of token to swap from\r\n# tokenOut: address of token to swap to\r\n# amountIn: exact amount of input token to be swapped\r\n# amountOutMin: minimum amount of output token willing to receive\r\n# skim: bento style from wallet toggle, false if from contracts balance\r\n#\r\n@external\r\ndef swap(_tokenIn: address, _tokenOut: address, _amountIn: uint256, _amountOutMin: uint256, \r\n  _skim: bool)-> Bytes[128]:\r\n  assert msg.sender == self.admin\r\n\r\n  if _skim == True:\r\n    assert IERC20(_tokenIn).balanceOf(msg.sender) >= _amountIn\r\n    IERC20(_tokenIn).transferFrom(msg.sender, self, _amountIn)\r\n  elif _skim == False:\r\n    continue\r\n\r\n  approved: bool = IERC20(_tokenIn).approve(self.router, _amountIn)\r\n  assert approved == True\r\n\r\n  # @notice we raw_call the routers swap function as it needs a dynamic array of addresses\r\n  #  the value passed will be the number of args (including offset) multiplied by 32\r\n  # @dev pass offset in place of dynamic array, then at offset pass length of the array\r\n  #  arguments of the array will be the final bytes\r\n  response: Bytes[128] = raw_call(\r\n    self.router,\r\n    concat(\r\n      method_id(\"swapExactTokensForTokens(uint256,uint256,address[],address,uint256)\"),\r\n      convert(_amountIn, bytes32),       # exact amount to swap\r\n      convert(_amountOutMin, bytes32),   # minimum amount to receieve (max slippage)\r\n      convert(160, bytes32),             # offset for path is number of arguments*bytes32\r\n      convert(self, bytes32),            # destination for tokens\r\n      convert(block.timestamp, bytes32), # deadline\r\n      convert(2, bytes32),               # number of args in the path\r\n      convert(_tokenIn, bytes32),        # args in the path...\r\n      convert(_tokenOut, bytes32)        # ...\r\n    ),\r\n    is_delegate_call=False,\r\n    max_outsize=128\r\n  )\r\n  log Exchange(_tokenIn, _tokenOut, _skim)\r\n  return response\r\n\r\n\r\n@external\r\ndef sweep():\r\n  assert msg.sender == self.admin\r\n  selfdestruct(self.admin)\r\n\r\n\r\n# 1 love\r\n```\r\n* please try running your example with the --debug flag turned on\r\n``` Traceback (most recent call last):\r\n  File \"/home/c/.local/bin/vyper\", line 8, in <module>\r\n    sys.exit(_parse_cli_args())\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/cli/vyper_compile.py\", line 55, in _parse_cli_args\r\n    return _parse_args(sys.argv[1:])\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/cli/vyper_compile.py\", line 129, in _parse_args\r\n    compiled = compile_files(\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/cli/vyper_compile.py\", line 242, in compile_files\r\n    compiler_data = vyper.compile_codes(\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/evm/opcodes.py\", line 224, in _wrapper\r\n    return fn(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/compiler/__init__.py\", line 110, in compile_codes\r\n    exc_handler(contract_name, exc)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/cli/vyper_compile.py\", line 166, in exc_handler\r\n    raise exception\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/compiler/__init__.py\", line 107, in compile_codes\r\n    out[contract_name][output_format] = OUTPUT_FORMATS[output_format](compiler_data)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/compiler/output.py\", line 178, in build_bytecode_output\r\n    return f\"0x{compiler_data.bytecode.hex()}\"\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/compiler/phases.py\", line 146, in bytecode\r\n    self._bytecode = generate_bytecode(self.assembly)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/compiler/phases.py\", line 134, in assembly\r\n    self._assembly = generate_assembly(self.lll_nodes, self.use_ovm)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/compiler/phases.py\", line 277, in generate_assembly\r\n    assembly = compile_lll.compile_to_assembly(lll_nodes)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 111, in compile_to_assembly\r\n    res = _compile_to_assembly(code)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 307, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(arg, withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 134, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(c, withargs, existing_labels, break_dest, height + i))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 286, in _compile_to_assembly\r\n    lll = _compile_to_assembly(code.args[0], {}, existing_labels, None, 0)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 307, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(arg, withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 268, in _compile_to_assembly\r\n    _compile_to_assembly(code.args[2], withargs, existing_labels, break_dest, height + 1,)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 307, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(arg, withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 187, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(code.args[1], withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 307, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(arg, withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 199, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(code.args[2], withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 307, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(arg, withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 187, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(code.args[1], withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 307, in _compile_to_assembly\r\n    o.extend(_compile_to_assembly(arg, withargs, existing_labels, break_dest, height))\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 99, in apply_line_no_wrapper\r\n    ret = func(*args, **kwargs)\r\n  File \"/home/c/.local/lib/python3.10/site-packages/vyper/lll/compile_lll.py\", line 246, in _compile_to_assembly\r\n    raise CompilerPanic(\"Invalid break\")\r\n```\r\n### How can it be fixed?\r\nRemove the 'continue' in the elif, or entire elif. Not needed\r\n",
  "closed_by": {
    "login": "charles-cooper",
    "id": 3867501,
    "node_id": "MDQ6VXNlcjM4Njc1MDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charles-cooper",
    "html_url": "https://github.com/charles-cooper",
    "followers_url": "https://api.github.com/users/charles-cooper/followers",
    "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
    "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
    "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
    "repos_url": "https://api.github.com/users/charles-cooper/repos",
    "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/2858/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/vyperlang/vyper/issues/2858/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1128819591",
    "html_url": "https://github.com/vyperlang/vyper/issues/2858#issuecomment-1128819591",
    "issue_url": "https://api.github.com/repos/vyperlang/vyper/issues/2858",
    "id": 1128819591,
    "node_id": "IC_kwDOBGDvrM5DSGuH",
    "user": {
      "login": "charles-cooper",
      "id": 3867501,
      "node_id": "MDQ6VXNlcjM4Njc1MDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3867501?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/charles-cooper",
      "html_url": "https://github.com/charles-cooper",
      "followers_url": "https://api.github.com/users/charles-cooper/followers",
      "following_url": "https://api.github.com/users/charles-cooper/following{/other_user}",
      "gists_url": "https://api.github.com/users/charles-cooper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/charles-cooper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/charles-cooper/subscriptions",
      "organizations_url": "https://api.github.com/users/charles-cooper/orgs",
      "repos_url": "https://api.github.com/users/charles-cooper/repos",
      "events_url": "https://api.github.com/users/charles-cooper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/charles-cooper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-17T12:40:32Z",
    "updated_at": "2022-05-17T12:40:39Z",
    "author_association": "COLLABORATOR",
    "body": "minimal repro:\r\n```python\r\n@external\r\ndef foo():\r\n    if True:\r\n        continue\r\n```\r\n\r\nthis should throw a typechecker error instead of waiting all the way into assembly generation.",
    "reactions": {
      "url": "https://api.github.com/repos/vyperlang/vyper/issues/comments/1128819591/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
