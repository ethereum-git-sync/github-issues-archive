{
  "url": "https://api.github.com/repos/MetaMask/core/issues/3573",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/3573/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/3573/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/3573/events",
  "html_url": "https://github.com/MetaMask/core/issues/3573",
  "id": 2008301703,
  "node_id": "I_kwDOCBB0Cc53tECH",
  "number": 3573,
  "title": "[assets-controllers] Fetch token rates in batches to avoid hitting limits",
  "user": {
    "login": "Gudahtt",
    "id": 2459287,
    "node_id": "MDQ6VXNlcjI0NTkyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gudahtt",
    "html_url": "https://github.com/Gudahtt",
    "followers_url": "https://api.github.com/users/Gudahtt/followers",
    "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
    "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
    "repos_url": "https://api.github.com/users/Gudahtt/repos",
    "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 948148992,
      "node_id": "MDU6TGFiZWw5NDgxNDg5OTI=",
      "url": "https://api.github.com/repos/MetaMask/core/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-11-23T14:06:28Z",
  "updated_at": "2023-11-23T14:21:19Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "We currently fetch the token rates for all tokens (for a given network) in a single call. However, the CoinGecko API we're currently using supports a maximum of 10 token addresses in a single request. Beyond that, it throws an error. The price API that we're considering migrating to has a similar limit of 15 addresses.\r\n\r\nWe should update the `TokenRatesController` to batch requests by a configurable amount (10 for now) to avoid hitting this error.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/3573/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/3573/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1824513262",
    "html_url": "https://github.com/MetaMask/core/issues/3573#issuecomment-1824513262",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/3573",
    "id": 1824513262,
    "node_id": "IC_kwDOCBB0Cc5sv9zu",
    "user": {
      "login": "NicolasMassart",
      "id": 4677568,
      "node_id": "MDQ6VXNlcjQ2Nzc1Njg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4677568?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicolasMassart",
      "html_url": "https://github.com/NicolasMassart",
      "followers_url": "https://api.github.com/users/NicolasMassart/followers",
      "following_url": "https://api.github.com/users/NicolasMassart/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicolasMassart/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicolasMassart/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicolasMassart/subscriptions",
      "organizations_url": "https://api.github.com/users/NicolasMassart/orgs",
      "repos_url": "https://api.github.com/users/NicolasMassart/repos",
      "events_url": "https://api.github.com/users/NicolasMassart/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicolasMassart/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-23T14:18:12Z",
    "updated_at": "2023-11-23T14:21:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note that I think Coingecko implemented that limit recently and have not documented it yet. I can't find anything about it, but the returned 400 error message is clear:\r\n```json\r\n{\r\n   \"timestamp\":\"2023-11-23T14:08:29.074+00:00\",\r\n   \"error_code\":10012,\r\n   \"status\":{\r\n      \"error_message\":\"Number of contract addresses in the request exceeds the allowed limit (10 addresses). Please note that to ensure fair usage and prevent abuse, the allowed limit may be adjusted periodically. To enjoy higher allowed limit, please subscribe to Demo plan or a paid plan at https://www.coingecko.com/en/api/pricing\"\r\n   }\r\n}\r\n``` ",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1824513262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
