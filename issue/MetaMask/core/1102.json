{
  "url": "https://api.github.com/repos/MetaMask/core/issues/1102",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/1102/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/1102/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/1102/events",
  "html_url": "https://github.com/MetaMask/core/issues/1102",
  "id": 1586164706,
  "node_id": "I_kwDOCBB0Cc5eivPi",
  "number": 1102,
  "title": "Analyze differences between extension and mobile keyring interactions",
  "user": {
    "login": "Gudahtt",
    "id": 2459287,
    "node_id": "MDQ6VXNlcjI0NTkyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gudahtt",
    "html_url": "https://github.com/Gudahtt",
    "followers_url": "https://api.github.com/users/Gudahtt/followers",
    "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
    "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
    "repos_url": "https://api.github.com/users/Gudahtt/repos",
    "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 948148996,
      "node_id": "MDU6TGFiZWw5NDgxNDg5OTY=",
      "url": "https://api.github.com/repos/MetaMask/core/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 4031879895,
      "node_id": "LA_kwDOCBB0Cc7wUZrX",
      "url": "https://api.github.com/repos/MetaMask/core/labels/team-accounts",
      "name": "team-accounts",
      "color": "D294F2",
      "default": false,
      "description": ""
    },
    {
      "id": 5330766523,
      "node_id": "LA_kwDOCBB0Cc8AAAABPb0Kuw",
      "url": "https://api.github.com/repos/MetaMask/core/labels/team-shared-libraries",
      "name": "team-shared-libraries",
      "color": "c5def5",
      "default": false,
      "description": ""
    },
    {
      "id": 5436476377,
      "node_id": "LA_kwDOCBB0Cc8AAAABRAoL2Q",
      "url": "https://api.github.com/repos/MetaMask/core/labels/snap-keyring-epic",
      "name": "snap-keyring-epic",
      "color": "20A4FC",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "mikesposito",
    "id": 34438276,
    "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
    "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mikesposito",
    "html_url": "https://github.com/mikesposito",
    "followers_url": "https://api.github.com/users/mikesposito/followers",
    "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
    "organizations_url": "https://api.github.com/users/mikesposito/orgs",
    "repos_url": "https://api.github.com/users/mikesposito/repos",
    "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mikesposito/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2023-02-15T16:27:07Z",
  "updated_at": "2023-04-27T19:17:25Z",
  "closed_at": "2023-03-29T09:22:12Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "We should analyze the differences between the \"keyring interaction\" code on extension v.s. mobile.\r\n\r\nOn extension, keyring interactions are handled by functions in `metamask-controller.js`. On mobile, they are in `@metamask/keyring-controller`.",
  "closed_by": {
    "login": "mikesposito",
    "id": 34438276,
    "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
    "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mikesposito",
    "html_url": "https://github.com/mikesposito",
    "followers_url": "https://api.github.com/users/mikesposito/followers",
    "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
    "organizations_url": "https://api.github.com/users/mikesposito/orgs",
    "repos_url": "https://api.github.com/users/mikesposito/repos",
    "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mikesposito/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/1102/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/1102/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476188529",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1476188529",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1476188529,
    "node_id": "IC_kwDOCBB0Cc5X_Nlx",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T12:58:36Z",
    "updated_at": "2023-03-22T12:33:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "The following is a list of functions in the metamask-extension client that interact with the EthKeyringController. \r\nThe list is divided into semantic categories, taken directly from the extension: They are not meant to indicate classes or nested objects.\r\n\r\nThese functions are declared in `metamask-controller.js`\r\n\r\n* [**EthKeyringController instantiation and events subscription**](https://github.com/MetaMask/core/issues/1102#issuecomment-1479406347)\r\n* [**Use of the PreferencesController**](https://github.com/MetaMask/core/issues/1102#issuecomment-1479423825)\r\n* [**HD Keyring**](https://github.com/MetaMask/core/issues/1102#issuecomment-1476190135) \r\n  - addNewAccount\r\n  - verifySeedPhrase\r\n  - removeAccount\r\n  - importAccountWithStrategy\r\n* [**KeyringController**](https://github.com/MetaMask/core/issues/1102#issuecomment-1476191252)\r\n  - setLocked\r\n  - createNewVaultAndKeychain\r\n  - createNewVaultAndRestore\r\n  - exportAccount\r\n* [**Vault**](https://github.com/MetaMask/core/issues/1102#issuecomment-1476192446)\r\n  - submitPassword\r\n  - verifyPassword\r\n* [**QR Devices**](https://github.com/MetaMask/core/issues/1102#issuecomment-1476193459)\r\n  - submitQRHardwareCryptoHDKey:\r\n  - submitQRHardwareCryptoAccount:\r\n  - cancelSyncQRHardware:\r\n  - submitQRHardwareSignature:        \r\n  - cancelQRHardwareSignRequest\r\n* [**Hardware Keyrings**](https://github.com/MetaMask/core/issues/1102#issuecomment-1476473073)\r\n  - connectHardware\r\n  - forgetDevice\r\n  - checkHardwareStatus\r\n  - unlockHardwareWalletAccount\r\n  - setLedgerTransportPreference\r\n  - attemptLedgerTransportCreation\r\n  - establishLedgerTransportPreference\r\n\r\nI will compare these methods between clients in separated comments to follow, using this nomenclature:\r\n* \"core KeyringController\": [`@metamask/keyring-controller`](https://github.com/MetaMask/core/tree/main/packages/keyring-controller)\r\n* \"EthKeyringController\": [`@metamask/eth-keyring-controller`](https://github.com/MetaMask/KeyringController)\r\n* \"extension\": [MetaMask extension `metamask-controller.js`](https://github.com/MetaMask/metamask-extension/blob/develop/app/scripts/metamask-controller.js)\r\n* \"keyring\": an instance of a keyring managed by an instance of EthKeyringController",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476188529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476190135",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1476190135",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1476190135,
    "node_id": "IC_kwDOCBB0Cc5X_N-3",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T12:59:38Z",
    "updated_at": "2023-03-20T12:59:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "## HD Keyring Methods differences\r\n\r\n### addNewAccount\r\n* The extension `addNewAccount` takes an `accountCount` parameter: a new account is added only if its value is equal to the number of identities in the preferences controller store.  In the core KeyringController we don’t have this parameter and the account is directly added to the primary keyring. This has been done to make this method idempotent for MV3 compatibility reasons (See [Pull Request #15566](https://github.com/MetaMask/metamask-extension/pull/15566))\r\n* The extension `addNewAccount` method returns the keyring memState along with preferencesController identities in the store. On the other hand, the core KeyringController `addNewAccount` returns only the keyring memState, returned by calling the `fullUpdate()` method.\r\n\r\nBesides these two differences the clients add a new account on the primary keyring in the same way.\r\n\r\n### verifySeedPhrase\r\n* In the extension, the primary keyring mnemonic is handled as buffer. In the core KeyringController it is handled as a string.\r\n\r\nBesides that, the methods are aligned.\r\n\r\n### importAccountWithStrategy\r\n* API for this method are different, as  `strategy` argument keys used to identify strategies are different: es. “Private Key” in the extension, “privateKey” in the core KeyringController\r\n* For strategy private key, additionally to `isValidPrivate`, the extension  has also this check (See [Pull Request #17763](https://github.com/MetaMask/metamask-extension/pull/17763)): \r\n> `getBinarySize(prefixedPrivateKey) !== 64 + ‘0x’.length`  \r\n\r\nThese are the only two differences.\r\n\r\n### removeAccount\r\n* After calling `EthKeyringController.removeAccount`, there’s a check to see if it is the last account of a keyring: if so, the `keyring.destroy()` method is directly called. (See: [Pull Request #14993](https://github.com/MetaMask/metamask-extension/pull/14993)) - maybe we could do something on the `eth-ledger-bridge-keyring` to remove the direct call from the extension?\r\n* In the extension `removeAllAccountPermissions` gets called as well, to remove all permissions associated with the removed account",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476190135/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476191252",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1476191252",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1476191252,
    "node_id": "IC_kwDOCBB0Cc5X_OQU",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T13:00:21Z",
    "updated_at": "2023-03-22T11:12:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "## “KeyringController” methods differences\r\n### setLocked\r\n* In the extension, the `ledgerKeyring.destroy()` and `trezorKeyring.dispose()` methods are called to lock hardware keyrings.\r\n* For MV3 compatibility, in the extension  `clearLoginArtifacts()`  is also called to remove login data from the browser session storage.\r\n\r\n### createNewVaultAndKeychain\r\n* To resolve a “possible bug” and to avoid potential multiple submissions from the UI, on the extension there’s a check to see if the vault has been already created by checking accounts in the EthKeyringController (See: [Pull Request #2605](https://github.com/MetaMask/metamask-extension/pull/2605))\r\n\r\n### createNewVaultAndRestore\r\n* In the extension, the seed phrase is passed expected by this method is an array of bytes, on core KeyringController is expected as string\r\n* Besides clearing the addresses in the preferencesController (done also on mobile side), we call the following “clearing” controllers methods:\r\n\t* `snapController.clearState`\r\n\t* `notificationController.clear`\r\n\t* `accountTracker.clearAccounts`\r\n\t* `cachedBalancesController.clearCachedBalances`\r\n\t* `txController.txStateManager.clearUnapprovedTxs`\r\nThese are not present on the core KeyringController.\r\nWe should also note that some of these like `snapController.clearState` are under the FLASK feature flag on the extension.\r\n* In the extension, after creating a new vault, accounts are restored up until the first found with 0 balance (that is then removed)\r\n* In the extension, the  `transportPreference` for the ledger keyring is also updated \r\n\r\n### exportAccount\r\nThe methods are aligned.",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476191252/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476192446",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1476192446",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1476192446,
    "node_id": "IC_kwDOCBB0Cc5X_Oi-",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T13:01:03Z",
    "updated_at": "2023-03-20T14:16:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "## Vault methods differences\r\n### submitPassword\r\n* After submitting the password to `EthKeyringController.submitPassword`, there is a check for the latest block.\r\n* Despite the comment on the method, on extension it seems like we don’t update the preferencesController with new accounts\r\n* In the extension, the  `transportPreference` for the ledger keyring is also updated \r\n\r\n### verifyPassword\r\n* The method is not present in the core KeyringController, where we have `validatePassword` instead. One interesting difference: in the extension we call `EthKeyringController.verifyPassword()` to check the password, while in the core KeyringController's `validatePassword` we compare the password string with `EthKeyringController.password`.\r\nAs  `EthKeyringController.password` is undefined when locked, does it mean that when locked we can export an account passing `undefined` to this function on mobile?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476192446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476193459",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1476193459",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1476193459,
    "node_id": "IC_kwDOCBB0Cc5X_Oyz",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T13:01:41Z",
    "updated_at": "2023-03-20T13:01:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "## QR Devices methods differences\r\nThe QRHardwareKeyring is instantiated differently on the two clients: On extension we manually create a new QRHardwareKeyring in `metamask-controller.js`, instead on core KeyringController it’s done through the EthKeyringController. \r\n\r\n### submitQRHardwareCryptoHDKey\r\n* In core KeyringController, this method is called `submitQRCryptoHDKey`\r\n\r\n### submitQRHardwareCryptoAccount\r\n*  In core KeyringController, this method is called `submitQRCryptoAccount`\r\n\r\n### cancelSyncQRHardware\r\n* Seems like we don’t have this method on core KeyringController. This should call `QRHardwareKeyring.cancelSync`\r\n\r\n### submitQRHardwareSignature\r\n* In core KeyringController, this method is called `submitQRSignature`\r\n\r\n### cancelQRHardwareSignRequest\r\n* In core KeyringController, this method is called `cancelQRSignRequest`",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476193459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476473073",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1476473073",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1476473073,
    "node_id": "IC_kwDOCBB0Cc5YATDx",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-20T15:42:05Z",
    "updated_at": "2023-03-20T15:45:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "## Hardware Keyrings\r\nThese methods are not yet present on the core KeyringController (albeit some methods linked to hardware keyrings support are being added, see: [Pull Request #1121](https://github.com/MetaMask/core/pull/1121)). I will go through a description of what they do\r\n\r\n### getKeyringForDevice(deviceName, hdPath = null)\r\nThis function is not exported to the extension UI, but it is used by all the others to get an hardware keyring from `EthKeyringController.getKeyringsByType` to then call specific keyring methods, using `deviceName` (read: keyring.type).\r\n\r\nIn case of a Trezor device, it also sets the Trezor model on appStateController\r\n\r\n### connectHardware(deviceName, page, hdPath)\r\nA method to get the previous, next or first page of accounts from an hardware device and then syncing the accountTracker with them.\r\n\r\nReturns a list of account\r\n\r\n### forgetDevice(deviceName)\r\nCalls `keyring.forgetDevice()`\r\n\r\n### checkHardwareStatus(deviceName, hdPath)\r\nReturns true if an hardware device is unlocked, using `keyring.isUnlocked()`\r\n\r\n### unlockHardwareWalletAccount(index, deviceName, hdPath, hdPathDescription)\r\nUnlocks an account at index `index` from an hardware keyring with type `deviceName`. Then builds a label for each of the accounts found using the preferencesController.\r\n\r\nReturns a joint object of identities from preferencesController state and EthKeyringController’s memStore\r\n\r\n### setLedgerTransportPreference(transportType)\r\nUpdates the ledger transport method in the preferencesController and calls `keyring.updateTransportMethod` if there is a ledger keyring instance in EthKeyringController. It falls back to the original value in case of error.\r\n\r\n### attemptLedgerTransportCreation()\r\nGets the ledger keyring and calls `keyring.attemptMakeApp()`\r\n\r\n### establishLedgerTransportPreference()\r\nCalls `setLedgerTransportPreference` with the current transport preference",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1476473073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1479406347",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1479406347",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1479406347,
    "node_id": "IC_kwDOCBB0Cc5YLfML",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-22T11:41:49Z",
    "updated_at": "2023-03-22T11:41:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "## EthKeyringController instantiation and events subscription\r\n* In the extension, the EthKeyringController instance is created with this config:\r\n```typescript\r\n{\r\n  keyringBuilders: additionalKeyrings,\r\n  initState: initState.KeyringController,\r\n  encryptor: opts.encryptor || undefined,\r\n  cacheEncryptionKey: isManifestV3,\r\n}\r\n``` \r\nOn the other hand, the core KeyringController’s `KeyringConfig` type seems to not expect the `cacheEncryptionKey` property.\r\n\r\n* Right after instantiating the EthKeyringController, the extension subscribes to three keyring events: `onLock`, `onUnlock` and to `memStore` observable. \r\nThe core KeyringController has `onLock`, `onUnlock` and `subscribe` methods to do that, but `subscribe` subscribes to the store, not the memStore. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1479406347/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1479423825",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1479423825",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1479423825,
    "node_id": "IC_kwDOCBB0Cc5YLjdR",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-22T11:57:56Z",
    "updated_at": "2023-03-22T13:08:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "## Use of the PreferencesController\r\nThe extension makes use of the PreferencesController to update, sync or remove addresses (identities), to set the selected address and to label accounts.\r\n\r\nThese interactions are all supported on the core KeyringController as it accepts these “options” on the constructor:\r\n* `removeIdentity`: called `removeAccount` in extension’s PreferencesController\r\n* `updateIdentities`: called `setAddresses` in the extension\r\n* `syncIdentities`: called the same in the extension\r\n* `setSelectedAddress`: called the same in the extension\r\n* `setAddressLabel`: called the same in the extension\r\n\r\nSo we should be able to easily instantiate the core KeyringController from the extension passing the corresponding PreferencesController methods to its constructor.",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1479423825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1481542133",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1481542133",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1481542133,
    "node_id": "IC_kwDOCBB0Cc5YTon1",
    "user": {
      "login": "mcmire",
      "id": 7371,
      "node_id": "MDQ6VXNlcjczNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcmire",
      "html_url": "https://github.com/mcmire",
      "followers_url": "https://api.github.com/users/mcmire/followers",
      "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
      "organizations_url": "https://api.github.com/users/mcmire/orgs",
      "repos_url": "https://api.github.com/users/mcmire/repos",
      "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcmire/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-23T16:53:14Z",
    "updated_at": "2023-03-23T16:53:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mikesposito This is great analysis!\r\n\r\nOne thing is that you've looked at MetamaskController in extension, but the equivalent in mobile is Engine.js. Is it worth looking at how the keyring controller is being interacted with there as well? I don't know if you ended up looking at that anyway through your analysis, but I thought I'd point it out.",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1481542133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1486555547",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1486555547",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1486555547,
    "node_id": "IC_kwDOCBB0Cc5Ymwmb",
    "user": {
      "login": "mikesposito",
      "id": 34438276,
      "node_id": "MDQ6VXNlcjM0NDM4Mjc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34438276?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mikesposito",
      "html_url": "https://github.com/mikesposito",
      "followers_url": "https://api.github.com/users/mikesposito/followers",
      "following_url": "https://api.github.com/users/mikesposito/following{/other_user}",
      "gists_url": "https://api.github.com/users/mikesposito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mikesposito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mikesposito/subscriptions",
      "organizations_url": "https://api.github.com/users/mikesposito/orgs",
      "repos_url": "https://api.github.com/users/mikesposito/repos",
      "events_url": "https://api.github.com/users/mikesposito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mikesposito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T09:54:58Z",
    "updated_at": "2023-03-28T09:55:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mcmire this is a good point! \r\nIn metamask-mobile's Engine.js we just instantiate the core KeyringController (`@metamask/keyring-controller`) and interact with the underlying eth-keyring-controller through it.\r\n\r\nOn the other hand, on metamask-extension, we instantiate eth-keyring-controller directly and interact with it, duplicating the logic that is now in the core's KeyringController",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1486555547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1487267542",
    "html_url": "https://github.com/MetaMask/core/issues/1102#issuecomment-1487267542",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1102",
    "id": 1487267542,
    "node_id": "IC_kwDOCBB0Cc5YpebW",
    "user": {
      "login": "mcmire",
      "id": 7371,
      "node_id": "MDQ6VXNlcjczNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcmire",
      "html_url": "https://github.com/mcmire",
      "followers_url": "https://api.github.com/users/mcmire/followers",
      "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
      "organizations_url": "https://api.github.com/users/mcmire/orgs",
      "repos_url": "https://api.github.com/users/mcmire/repos",
      "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcmire/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T16:44:15Z",
    "updated_at": "2023-03-28T16:44:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah gotcha, that makes sense. I'm good on this then!",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1487267542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
