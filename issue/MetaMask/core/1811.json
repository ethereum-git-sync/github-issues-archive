{
  "url": "https://api.github.com/repos/MetaMask/core/issues/1811",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/1811/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/1811/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/1811/events",
  "html_url": "https://github.com/MetaMask/core/issues/1811",
  "id": 1938781624,
  "node_id": "I_kwDOCBB0Cc5zj3W4",
  "number": 1811,
  "title": "Design consolidated API for AccountTrackerController",
  "user": {
    "login": "mcmire",
    "id": 7371,
    "node_id": "MDQ6VXNlcjczNzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcmire",
    "html_url": "https://github.com/mcmire",
    "followers_url": "https://api.github.com/users/mcmire/followers",
    "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
    "organizations_url": "https://api.github.com/users/mcmire/orgs",
    "repos_url": "https://api.github.com/users/mcmire/repos",
    "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcmire/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5330766523,
      "node_id": "LA_kwDOCBB0Cc8AAAABPb0Kuw",
      "url": "https://api.github.com/repos/MetaMask/core/labels/team-shared-libraries",
      "name": "team-shared-libraries",
      "color": "c5def5",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "kanthesha",
    "id": 45172858,
    "node_id": "MDQ6VXNlcjQ1MTcyODU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/45172858?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kanthesha",
    "html_url": "https://github.com/kanthesha",
    "followers_url": "https://api.github.com/users/kanthesha/followers",
    "following_url": "https://api.github.com/users/kanthesha/following{/other_user}",
    "gists_url": "https://api.github.com/users/kanthesha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kanthesha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kanthesha/subscriptions",
    "organizations_url": "https://api.github.com/users/kanthesha/orgs",
    "repos_url": "https://api.github.com/users/kanthesha/repos",
    "events_url": "https://api.github.com/users/kanthesha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kanthesha/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "kanthesha",
      "id": 45172858,
      "node_id": "MDQ6VXNlcjQ1MTcyODU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/45172858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kanthesha",
      "html_url": "https://github.com/kanthesha",
      "followers_url": "https://api.github.com/users/kanthesha/followers",
      "following_url": "https://api.github.com/users/kanthesha/following{/other_user}",
      "gists_url": "https://api.github.com/users/kanthesha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kanthesha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kanthesha/subscriptions",
      "organizations_url": "https://api.github.com/users/kanthesha/orgs",
      "repos_url": "https://api.github.com/users/kanthesha/repos",
      "events_url": "https://api.github.com/users/kanthesha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kanthesha/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-10-11T21:36:55Z",
  "updated_at": "2024-01-05T23:18:28Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Look into how AccountTrackerController (from this repo) is being used in the mobile app (including the patches for this controller in mobile) and how AccountTrackerController is being used in the extension, and determine an API for a combined controller that satisfies the requirements that extension and mobile have.\n\nThe new design should go in a new comment in this ticket.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/1811/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/1811/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1845752842",
    "html_url": "https://github.com/MetaMask/core/issues/1811#issuecomment-1845752842",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1811",
    "id": 1845752842,
    "node_id": "IC_kwDOCBB0Cc5uA_QK",
    "user": {
      "login": "desi",
      "id": 15041,
      "node_id": "MDQ6VXNlcjE1MDQx",
      "avatar_url": "https://avatars.githubusercontent.com/u/15041?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/desi",
      "html_url": "https://github.com/desi",
      "followers_url": "https://api.github.com/users/desi/followers",
      "following_url": "https://api.github.com/users/desi/following{/other_user}",
      "gists_url": "https://api.github.com/users/desi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/desi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/desi/subscriptions",
      "organizations_url": "https://api.github.com/users/desi/orgs",
      "repos_url": "https://api.github.com/users/desi/repos",
      "events_url": "https://api.github.com/users/desi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/desi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-07T17:14:33Z",
    "updated_at": "2023-12-07T17:14:33Z",
    "author_association": "NONE",
    "body": "Hey team! Please [add your planning poker estimate](https://app.zenhub.com/workspaces/Shared-Libraries-621e46b4d7103800171d1b02/issues/MetaMask/core/1811?planning-poker) with Zenhub @cryptodev-2s @Gudahtt @MajorLift @mcmire @mikesposito",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1845752842/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1847600850",
    "html_url": "https://github.com/MetaMask/core/issues/1811#issuecomment-1847600850",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1811",
    "id": 1847600850,
    "node_id": "IC_kwDOCBB0Cc5uICbS",
    "user": {
      "login": "MajorLift",
      "id": 34228073,
      "node_id": "MDQ6VXNlcjM0MjI4MDcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/34228073?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MajorLift",
      "html_url": "https://github.com/MajorLift",
      "followers_url": "https://api.github.com/users/MajorLift/followers",
      "following_url": "https://api.github.com/users/MajorLift/following{/other_user}",
      "gists_url": "https://api.github.com/users/MajorLift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MajorLift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MajorLift/subscriptions",
      "organizations_url": "https://api.github.com/users/MajorLift/orgs",
      "repos_url": "https://api.github.com/users/MajorLift/repos",
      "events_url": "https://api.github.com/users/MajorLift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MajorLift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-08T18:00:19Z",
    "updated_at": "2023-12-08T18:00:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Blocked by https://github.com/MetaMask/core/pull/3586",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1847600850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1850783650",
    "html_url": "https://github.com/MetaMask/core/issues/1811#issuecomment-1850783650",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1811",
    "id": 1850783650,
    "node_id": "IC_kwDOCBB0Cc5uULei",
    "user": {
      "login": "jiexi",
      "id": 918701,
      "node_id": "MDQ6VXNlcjkxODcwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/918701?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jiexi",
      "html_url": "https://github.com/jiexi",
      "followers_url": "https://api.github.com/users/jiexi/followers",
      "following_url": "https://api.github.com/users/jiexi/following{/other_user}",
      "gists_url": "https://api.github.com/users/jiexi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jiexi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jiexi/subscriptions",
      "organizations_url": "https://api.github.com/users/jiexi/orgs",
      "repos_url": "https://api.github.com/users/jiexi/repos",
      "events_url": "https://api.github.com/users/jiexi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jiexi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-11T19:53:53Z",
    "updated_at": "2023-12-11T19:55:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "btw in extension, I have the following inflight for AccountTracker\r\nhttps://github.com/MetaMask/metamask-extension/pull/22217\r\nhttps://github.com/MetaMask/metamask-extension/pull/22233",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1850783650/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1856147264",
    "html_url": "https://github.com/MetaMask/core/issues/1811#issuecomment-1856147264",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1811",
    "id": 1856147264,
    "node_id": "IC_kwDOCBB0Cc5uoo9A",
    "user": {
      "login": "MajorLift",
      "id": 34228073,
      "node_id": "MDQ6VXNlcjM0MjI4MDcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/34228073?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MajorLift",
      "html_url": "https://github.com/MajorLift",
      "followers_url": "https://api.github.com/users/MajorLift/followers",
      "following_url": "https://api.github.com/users/MajorLift/following{/other_user}",
      "gists_url": "https://api.github.com/users/MajorLift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MajorLift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MajorLift/subscriptions",
      "organizations_url": "https://api.github.com/users/MajorLift/orgs",
      "repos_url": "https://api.github.com/users/MajorLift/repos",
      "events_url": "https://api.github.com/users/MajorLift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MajorLift/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-14T16:19:44Z",
    "updated_at": "2023-12-14T16:21:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "- It appears that this will be closed by https://github.com/MetaMask/metamask-extension/pull/22276",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1856147264/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1856157000",
    "html_url": "https://github.com/MetaMask/core/issues/1811#issuecomment-1856157000",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1811",
    "id": 1856157000,
    "node_id": "IC_kwDOCBB0Cc5uorVI",
    "user": {
      "login": "Gudahtt",
      "id": 2459287,
      "node_id": "MDQ6VXNlcjI0NTkyODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gudahtt",
      "html_url": "https://github.com/Gudahtt",
      "followers_url": "https://api.github.com/users/Gudahtt/followers",
      "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
      "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
      "repos_url": "https://api.github.com/users/Gudahtt/repos",
      "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-14T16:25:25Z",
    "updated_at": "2023-12-14T16:25:25Z",
    "author_association": "MEMBER",
    "body": "That PR removes the cached balances controller, but we still need to plan for merging the two account tracker controllers we have",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1856157000/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1879371406",
    "html_url": "https://github.com/MetaMask/core/issues/1811#issuecomment-1879371406",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1811",
    "id": 1879371406,
    "node_id": "IC_kwDOCBB0Cc5wBO6O",
    "user": {
      "login": "mcmire",
      "id": 7371,
      "node_id": "MDQ6VXNlcjczNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcmire",
      "html_url": "https://github.com/mcmire",
      "followers_url": "https://api.github.com/users/mcmire/followers",
      "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
      "organizations_url": "https://api.github.com/users/mcmire/orgs",
      "repos_url": "https://api.github.com/users/mcmire/repos",
      "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcmire/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-05T23:17:52Z",
    "updated_at": "2024-01-05T23:18:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "@kanthesha Following our call earlier today, here's a bit more guidance on this ticket.\r\n\r\nCurrently, we have two versions of AccountTrackerController:\r\n\r\n- The extension uses [`account-tracker.js`](https://github.com/MetaMask/metamask-extension/blob/fc8d2235592e46b6e5349089b1972c60376f0456/app/scripts/lib/account-tracker.js), a controller which uses a pattern that predates BaseControllerV1 in the core repo. You can see this because this controller does not extend from any base controller and uses an ObservableStore instance to store state.\r\n- The mobile app uses a patched version of AccountTrackerController from the core repo. Because AccountTrackerController is part of the `@metamask/assets-controllers` package, the patch is within the [patch for `assets-controllers`](https://github.com/MetaMask/metamask-mobile/blob/2b409a583717907590fe425fbf1da653be419575/patches/%40metamask%2Bassets-controllers%2B7.0.0.patch). By default, the version of `@metamask/assets-controllers` you have in `node_modules` will be the published version, but you can apply the patch by running `yarn patch-package` (this assumes that you've run `yarn install` already). Then, when you open `node_modules/@metamask/assets-controllers/dist/AccountTrackerController.js`, you should be able to use this file as a source of truth for what the mobile app is using.\r\n\r\nWhere does this ticket fit into the bigger picture?\r\n\r\n- Because these two versions of AccountTrackerController are different, and because we want the extension and mobile app to be able to use _one_ version, we need to create a controller that incorporates all of the behavior that both the extension and mobile app rely on.\r\n- It's possible — we've seen this in other places — that each version of this controller exposes properties and/or methods that it doesn't need to expose, or contains dead code. We want each controller in the core repo to be as tight as possible, so if there's anything that doesn't need to be there, we can take the opportunity as we're consolidating pieces of behavior into one place to remove things that don't need to be there.\r\n\r\nHow to proceed with this ticket?\r\n\r\n- It might be helpful to first make notes of the behavior that each version of the controller has. You can look at the tests and cross-reference it with the implementation in each version to compile this information.\r\n- Once you've captured all of the behavior in each version of the controller, you can use it to write out an _idealized_ version of the controller.\r\n\r\nWhat's the deliverable?\r\n\r\n- In order to have a cleaned up controller which can be shared between the extension and the mobile app, we need a plan that details what changes we need to make to the existing controller. We can provide that plan in one or many comments in this ticket.\r\n- In terms of how to represent the final result, we've done this a few different ways. Michele did an analysis for KeyringController here that I found pretty comprehensive and easy to read: https://github.com/MetaMask/core/issues/1103. He chose to list each method in the eventual API. For each method, he added sections for proposed changes, and for each proposed change section he gave some context and then the actual change. So this could be a good pattern to follow.\r\n\r\nHopefully that helps!",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1879371406/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
