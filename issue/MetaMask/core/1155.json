{
  "url": "https://api.github.com/repos/MetaMask/core/issues/1155",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/1155/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/1155/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/1155/events",
  "html_url": "https://github.com/MetaMask/core/issues/1155",
  "id": 1647758639,
  "node_id": "I_kwDOCBB0Cc5iNs0v",
  "number": 1155,
  "title": "Plan tasks to merge the transaction controllers",
  "user": {
    "login": "Gudahtt",
    "id": 2459287,
    "node_id": "MDQ6VXNlcjI0NTkyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gudahtt",
    "html_url": "https://github.com/Gudahtt",
    "followers_url": "https://api.github.com/users/Gudahtt/followers",
    "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
    "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
    "repos_url": "https://api.github.com/users/Gudahtt/repos",
    "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 948148996,
      "node_id": "MDU6TGFiZWw5NDgxNDg5OTY=",
      "url": "https://api.github.com/repos/MetaMask/core/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 5330766523,
      "node_id": "LA_kwDOCBB0Cc8AAAABPb0Kuw",
      "url": "https://api.github.com/repos/MetaMask/core/labels/team-shared-libraries",
      "name": "team-shared-libraries",
      "color": "c5def5",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "cryptodev-2s",
    "id": 109512101,
    "node_id": "U_kgDOBocFpQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/109512101?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cryptodev-2s",
    "html_url": "https://github.com/cryptodev-2s",
    "followers_url": "https://api.github.com/users/cryptodev-2s/followers",
    "following_url": "https://api.github.com/users/cryptodev-2s/following{/other_user}",
    "gists_url": "https://api.github.com/users/cryptodev-2s/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cryptodev-2s/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cryptodev-2s/subscriptions",
    "organizations_url": "https://api.github.com/users/cryptodev-2s/orgs",
    "repos_url": "https://api.github.com/users/cryptodev-2s/repos",
    "events_url": "https://api.github.com/users/cryptodev-2s/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cryptodev-2s/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cryptodev-2s",
      "id": 109512101,
      "node_id": "U_kgDOBocFpQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/109512101?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cryptodev-2s",
      "html_url": "https://github.com/cryptodev-2s",
      "followers_url": "https://api.github.com/users/cryptodev-2s/followers",
      "following_url": "https://api.github.com/users/cryptodev-2s/following{/other_user}",
      "gists_url": "https://api.github.com/users/cryptodev-2s/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cryptodev-2s/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cryptodev-2s/subscriptions",
      "organizations_url": "https://api.github.com/users/cryptodev-2s/orgs",
      "repos_url": "https://api.github.com/users/cryptodev-2s/repos",
      "events_url": "https://api.github.com/users/cryptodev-2s/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cryptodev-2s/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-03-30T14:35:21Z",
  "updated_at": "2023-05-31T15:30:26Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "We should plan the tasks needed to merge the two transaction controllers. Ideally we should plan these tasks so that the work can be done in small, measurable pieces. We can make these controllers behave more similarly to each other bit-by-bit until the final step of replacing the extension controller with the core controller is small enough for a single task/PR.\r\n\r\nLikely we will have tasks focused on adding/modifying features, and some on normalizing the APIs, and some on cleaning up tests and adding test coverage where it is missing. We will need to create test plans to cover functionality not easily covered by automated tests as well (e.g. hardware wallet integrations).",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/1155/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/1155/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1570450192",
    "html_url": "https://github.com/MetaMask/core/issues/1155#issuecomment-1570450192",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1155",
    "id": 1570450192,
    "node_id": "IC_kwDOCBB0Cc5dmysQ",
    "user": {
      "login": "cryptodev-2s",
      "id": 109512101,
      "node_id": "U_kgDOBocFpQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/109512101?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cryptodev-2s",
      "html_url": "https://github.com/cryptodev-2s",
      "followers_url": "https://api.github.com/users/cryptodev-2s/followers",
      "following_url": "https://api.github.com/users/cryptodev-2s/following{/other_user}",
      "gists_url": "https://api.github.com/users/cryptodev-2s/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cryptodev-2s/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cryptodev-2s/subscriptions",
      "organizations_url": "https://api.github.com/users/cryptodev-2s/orgs",
      "repos_url": "https://api.github.com/users/cryptodev-2s/repos",
      "events_url": "https://api.github.com/users/cryptodev-2s/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cryptodev-2s/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-31T15:27:18Z",
    "updated_at": "2023-05-31T15:30:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "### 1 - Normalize Controller State\r\n_The state on Mobile holds both local and incoming transactions state/history the data stored is as below:_\r\n\r\n```\r\nTransactionStateÂ {\r\n  transactions: TransactionMeta[];\r\n  methodData: { [key: string]: MethodData };\r\n}\r\n\r\nTransactionMeta {\r\n  isTransfer?: boolean;\r\n  transferInformation?: {\r\n    symbol: string;\r\n    contractAddress: string;\r\n    decimals: number;\r\n  };\r\n  id: string;\r\n  networkID?: string;\r\n  chainId?: Hex;\r\n  origin?: string;\r\n  rawTransaction?: string;\r\n  time: number;\r\n  toSmartContract?: boolean;\r\n  transaction: {\r\n    chainId?: Hex;\r\n    data?: string;\r\n    from: string;\r\n    gas?: string;\r\n    gasPrice?: string;\r\n    gasUsed?: string;\r\n    nonce?: string;\r\n    to?: string;\r\n    value?: string;\r\n    maxFeePerGas?: string;\r\n    maxPriorityFeePerGas?: string;\r\n    estimatedBaseFee?: string;\r\n    estimateGasError?: string;\r\n };\r\n  transactionHash?: string;\r\n  blockNumber?: string;\r\n  deviceConfirmedOn?: WalletDevice;\r\n  verifiedOnBlockchain?: boolean;\r\n  status: TransactionStatus;\r\n  error: Error (in case of failed tx status)\r\n}\r\n\r\nMethodData {\r\n    registryMethod: string;\r\n    parsedRegistryMethod: Record<string, unknown>;\r\n}\r\n```\r\n\r\n_Whereas the extension behaved differently it uses two different controllers TransactionController for Local Transactions and IncomingTransactionController for Incoming Transactions._\r\n\r\n**The state in the TransactionController is as below:**\r\n\r\n```\r\n{\r\n   [txId]: {\r\n     custodyStatus: string;\r\n    custodyId?: string;\r\n    blockNumber?: string;\r\n    id: number;\r\n    time: number;\r\n    contractMethodName: string;\r\n    customTokenAmount: string;\r\n    dappProposedTokenAmount: string;\r\n    dappSuggestedGasFees?: DappSuggestedGasFees;\r\n    currentTokenBalance: string;\r\n    originalApprovalAmount: string;\r\n    finalApprovalAmount: string;\r\n    type: TransactionType;\r\n    originalType: TransactionType;\r\n    status: TransactionStatus;\r\n    metamaskNetworkId: string;\r\n    loadingDefaults: boolean;\r\n    txParams: {\r\n      from: string,\r\n      to: string,\r\n      nonce: string,\r\n      value: string,\r\n      data: string,\r\n      gas: string,\r\n      gasPrice: string,\r\n      maxFeePerGas: string,\r\n      maxPriorityFeePerGas: string,\r\n      type: string,\r\n      estimateSuggested: string\r\n      estimateUsed: string\r\n    };\r\n    txReceipt: TxReceipt;\r\n    history: Record<string, any>[];\r\n    origin: string;\r\n    originalGasEstimate: string;\r\n    userEditedGasLimit: boolean;\r\n    nonceDetails: Record<string, any>;\r\n    hash: string;\r\n    v?: string;\r\n    r?: string;\r\n    s?: string;\r\n    submittedTime?: number;\r\n    txErr?: TxError;\r\n    }\r\n} \r\n```\r\n\r\n**The state in the IncomingTransactionController is as below:**\r\n```\r\n{\r\n    incomingTransactions: {\r\n       [hash]:{\r\n          blockNumber: string;\r\n          id: number;\r\n          chainId: string;\r\n          metamaskNetworkId: string;\r\n          status: string;\r\n          time: number;\r\n          txParams: TxParams;\r\n          hash: string;\r\n          type: string;\r\n      } };\r\n    incomingTxLastFetchedBlockByChainId: { \r\n       [chainId]: block\r\n   };\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1570450192/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
