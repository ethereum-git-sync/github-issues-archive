{
  "url": "https://api.github.com/repos/MetaMask/core/issues/700",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/700/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/700/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/700/events",
  "html_url": "https://github.com/MetaMask/core/issues/700",
  "id": 1155789458,
  "node_id": "I_kwDOCBB0Cc5E4_KS",
  "number": 700,
  "title": "Merge extension and mobile controllers",
  "user": {
    "login": "Gudahtt",
    "id": 2459287,
    "node_id": "MDQ6VXNlcjI0NTkyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gudahtt",
    "html_url": "https://github.com/Gudahtt",
    "followers_url": "https://api.github.com/users/Gudahtt/followers",
    "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
    "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
    "repos_url": "https://api.github.com/users/Gudahtt/repos",
    "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3884427940,
      "node_id": "LA_kwDOCBB0Cc7nh6qk",
      "url": "https://api.github.com/repos/MetaMask/core/labels/Epic",
      "name": "Epic",
      "color": "4660F9",
      "default": false,
      "description": null
    },
    {
      "id": 5330766523,
      "node_id": "LA_kwDOCBB0Cc8AAAABPb0Kuw",
      "url": "https://api.github.com/repos/MetaMask/core/labels/team-shared-libraries",
      "name": "team-shared-libraries",
      "color": "c5def5",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-03-01T20:34:16Z",
  "updated_at": "2023-06-26T16:03:59Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "We want to use one shared set of controllers on both MetaMask extension and MetaMask mobile. This is to reduce to maintenance burden of each team, so that it is easier for us to provide a stable and secure codebase.\r\n\r\nThis issue description is still a work in progress. This will be updated with a list of each set of controllers to merge.\r\n\r\nEach pair of controllers is listed in this checklist, each with sub-tasks that roughly map out the work required to merge the two controllers.\r\n\r\n### Tasks\r\n\r\n#### Extract any API interactions or complex utility functions\r\n\r\nMuch of the complexity in our controllers is tied to functionality that is better managed as a separate module. Extracting API interactions and complex functionality can simplify the migration process and reduce maintenance.\r\n\r\n#### Refactor to be more easily understood\r\n\r\nSome of our controllers are built in a way that makes them very difficult to reason about. For example, they might expose too many internal methods/properties, or they might have race conditions and complex polling logic. We need to understand how these controllers work in order to merge them, so we may have to spend some time simplifying them before merging in some cases.\r\n\r\n#### Write comprehensive unit tests\r\nBy writing comprehensive unit tests for the controllers before we merge them, we can reduce the chance of introducing a regression.\r\n\r\n#### Normalize the functionality across both controllers\r\n\r\nThe more similar we make the two controllers prior to merging them, the easier the final step will be.\r\n\r\n#### Migrate\r\n\r\nMigrate the extension and mobile projects to use the new shared controller. This is the last step.\r\n\r\n\r\n## Checklist\r\n\r\n- [ ] Approval\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [x] Refactor to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] AssetsContract\r\n  - [ ] Convert to library\r\n- [ ] Collectibles\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] CurrencyRate\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] TokenList\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] TokenRates\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] Tokens\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] GasFee\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] Phishing\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] AddressBook\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] All message managers\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [x] #753\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [x] Refactored to be more easily understood.\r\n  - [x] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] Transaction / IncomingTransactions\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Swaps\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] AccountTracker / CachedBalances\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] NftDetection\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] TokenBalances\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] TokenDetection / DetectTokens\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Keyring (wrapper) / keyring related metamask-controller methods / Identity related state (#431)\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [x] Permission\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [x] Refactored to be more easily understood.\r\n  - [x] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] Announcement\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [x] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [x] SubjectMetadata\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [x] Refactored to be more easily understood.\r\n  - [x] Write comprehensive unit tests\r\n  - [x] Normalize the functionality across both controllers\r\n  - [x] Migrate\r\n- [ ] Ens (cache) / Ens (resolve)\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Preferences\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Alert\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] AppState\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] MetaMetrics\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Onboarding\r\n  - [x] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] PermissionLog\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] SmartTransactions\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Snap\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate\r\n- [ ] Notification\r\n  - [ ] Extract any API interactions or complex utility functions\r\n  - [ ] Refactored to be more easily understood.\r\n  - [ ] Write comprehensive unit tests\r\n  - [ ] Normalize the functionality across both controllers\r\n  - [ ] Migrate",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/700/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/700/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1076589168",
    "html_url": "https://github.com/MetaMask/core/issues/700#issuecomment-1076589168",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/700",
    "id": 1076589168,
    "node_id": "IC_kwDOCBB0Cc5AK3Jw",
    "user": {
      "login": "mcmire",
      "id": 7371,
      "node_id": "MDQ6VXNlcjczNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcmire",
      "html_url": "https://github.com/mcmire",
      "followers_url": "https://api.github.com/users/mcmire/followers",
      "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
      "organizations_url": "https://api.github.com/users/mcmire/orgs",
      "repos_url": "https://api.github.com/users/mcmire/repos",
      "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcmire/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-23T17:11:33Z",
    "updated_at": "2022-03-23T17:11:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Notes from Monday's standup:\r\n\r\nWe probably need to prioritize Network and Keyring over other controllers.\r\n\r\n- We're starting to ramp up work on multi-network support\r\n- We've been wanting to fix the keyring stuff for a long time",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1076589168/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1093291993",
    "html_url": "https://github.com/MetaMask/core/issues/700#issuecomment-1093291993",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/700",
    "id": 1093291993,
    "node_id": "IC_kwDOCBB0Cc5BKk_Z",
    "user": {
      "login": "Gudahtt",
      "id": 2459287,
      "node_id": "MDQ6VXNlcjI0NTkyODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gudahtt",
      "html_url": "https://github.com/Gudahtt",
      "followers_url": "https://api.github.com/users/Gudahtt/followers",
      "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
      "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
      "repos_url": "https://api.github.com/users/Gudahtt/repos",
      "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T19:38:42Z",
    "updated_at": "2022-04-08T19:38:42Z",
    "author_association": "MEMBER",
    "body": "I have just finished making a first pass on this, checking off anything that is clearly completed already. 40 tasks are completed out of 188, that's our starting point.",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1093291993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1093357627",
    "html_url": "https://github.com/MetaMask/core/issues/700#issuecomment-1093357627",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/700",
    "id": 1093357627,
    "node_id": "IC_kwDOCBB0Cc5BK1A7",
    "user": {
      "login": "mcmire",
      "id": 7371,
      "node_id": "MDQ6VXNlcjczNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcmire",
      "html_url": "https://github.com/mcmire",
      "followers_url": "https://api.github.com/users/mcmire/followers",
      "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
      "organizations_url": "https://api.github.com/users/mcmire/orgs",
      "repos_url": "https://api.github.com/users/mcmire/repos",
      "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcmire/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T20:58:23Z",
    "updated_at": "2022-04-08T20:58:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Nice!!",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1093357627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1607788334",
    "html_url": "https://github.com/MetaMask/core/issues/700#issuecomment-1607788334",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/700",
    "id": 1607788334,
    "node_id": "IC_kwDOCBB0Cc5f1Ocu",
    "user": {
      "login": "Gudahtt",
      "id": 2459287,
      "node_id": "MDQ6VXNlcjI0NTkyODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2459287?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gudahtt",
      "html_url": "https://github.com/Gudahtt",
      "followers_url": "https://api.github.com/users/Gudahtt/followers",
      "following_url": "https://api.github.com/users/Gudahtt/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gudahtt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gudahtt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gudahtt/subscriptions",
      "organizations_url": "https://api.github.com/users/Gudahtt/orgs",
      "repos_url": "https://api.github.com/users/Gudahtt/repos",
      "events_url": "https://api.github.com/users/Gudahtt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gudahtt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-26T16:03:59Z",
    "updated_at": "2023-06-26T16:03:59Z",
    "author_association": "MEMBER",
    "body": "Here are a few jotnotes regarding the current status of remaining migrations:\r\n\r\nPotentially straightforward (4):\r\n- AccountTracker / Cached Balances\r\n- TokenBalances\r\n- TokenDetection\r\n- PermissionLog\r\n\r\nCollaboration (6):\r\n- AppState\r\n  - Tricky\r\n- Preferences\r\n  - Tricky\r\n- Announcement\r\n  - Check with mobile team first\r\n- ENS\r\n  - Integration is leftover\r\n- Swaps\r\n  - Swaps team\r\n- SmartTransactions\r\n  - Involve swaps team\r\n\r\nNot applicable at the moment (5):\r\n- Alert\r\n  - Not relevant to mobile\r\n- Snap\r\n  - Snaps\r\n- Notification\r\n  - Snaps\r\n- Onboarding\r\n  - Mobile feature that they don't currently support\r\n- MetaMetrics\r\n  - Major effort already planned to be done by mobile team",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1607788334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
