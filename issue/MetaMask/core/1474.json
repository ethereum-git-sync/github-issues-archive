{
  "url": "https://api.github.com/repos/MetaMask/core/issues/1474",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/1474/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/1474/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/1474/events",
  "html_url": "https://github.com/MetaMask/core/issues/1474",
  "id": 1793725357,
  "node_id": "I_kwDOCBB0Cc5q6hOt",
  "number": 1474,
  "title": "Research: v1 using PermissionsController rather than ActiveNetworkController",
  "user": {
    "login": "adonesky1",
    "id": 34557516,
    "node_id": "MDQ6VXNlcjM0NTU3NTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/34557516?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adonesky1",
    "html_url": "https://github.com/adonesky1",
    "followers_url": "https://api.github.com/users/adonesky1/followers",
    "following_url": "https://api.github.com/users/adonesky1/following{/other_user}",
    "gists_url": "https://api.github.com/users/adonesky1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adonesky1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adonesky1/subscriptions",
    "organizations_url": "https://api.github.com/users/adonesky1/orgs",
    "repos_url": "https://api.github.com/users/adonesky1/repos",
    "events_url": "https://api.github.com/users/adonesky1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adonesky1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5108738713,
      "node_id": "LA_kwDOCBB0Cc8AAAABMIEqmQ",
      "url": "https://api.github.com/repos/MetaMask/core/labels/team-devex",
      "name": "team-devex",
      "color": "BFB144",
      "default": false,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "adonesky1",
    "id": 34557516,
    "node_id": "MDQ6VXNlcjM0NTU3NTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/34557516?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adonesky1",
    "html_url": "https://github.com/adonesky1",
    "followers_url": "https://api.github.com/users/adonesky1/followers",
    "following_url": "https://api.github.com/users/adonesky1/following{/other_user}",
    "gists_url": "https://api.github.com/users/adonesky1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adonesky1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adonesky1/subscriptions",
    "organizations_url": "https://api.github.com/users/adonesky1/orgs",
    "repos_url": "https://api.github.com/users/adonesky1/repos",
    "events_url": "https://api.github.com/users/adonesky1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adonesky1/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "adonesky1",
      "id": 34557516,
      "node_id": "MDQ6VXNlcjM0NTU3NTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34557516?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adonesky1",
      "html_url": "https://github.com/adonesky1",
      "followers_url": "https://api.github.com/users/adonesky1/followers",
      "following_url": "https://api.github.com/users/adonesky1/following{/other_user}",
      "gists_url": "https://api.github.com/users/adonesky1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adonesky1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adonesky1/subscriptions",
      "organizations_url": "https://api.github.com/users/adonesky1/orgs",
      "repos_url": "https://api.github.com/users/adonesky1/repos",
      "events_url": "https://api.github.com/users/adonesky1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adonesky1/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-07-07T15:18:07Z",
  "updated_at": "2023-07-07T23:12:50Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": null,
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/1474/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/1474/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1626350501",
    "html_url": "https://github.com/MetaMask/core/issues/1474#issuecomment-1626350501",
    "issue_url": "https://api.github.com/repos/MetaMask/core/issues/1474",
    "id": 1626350501,
    "node_id": "IC_kwDOCBB0Cc5g8COl",
    "user": {
      "login": "adonesky1",
      "id": 34557516,
      "node_id": "MDQ6VXNlcjM0NTU3NTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/34557516?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adonesky1",
      "html_url": "https://github.com/adonesky1",
      "followers_url": "https://api.github.com/users/adonesky1/followers",
      "following_url": "https://api.github.com/users/adonesky1/following{/other_user}",
      "gists_url": "https://api.github.com/users/adonesky1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adonesky1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adonesky1/subscriptions",
      "organizations_url": "https://api.github.com/users/adonesky1/orgs",
      "repos_url": "https://api.github.com/users/adonesky1/repos",
      "events_url": "https://api.github.com/users/adonesky1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adonesky1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-07T23:12:29Z",
    "updated_at": "2023-07-07T23:12:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Overall take: Using the PermissionsController in lieu of an ActiveNetworkController for per-dapp selected network functionality will take longer and may not contribute to the direction we want to go with the way we are currently thinking of refactoring our use of the Permissions System for v1.5.  The way it currently works is each “restricted” method call (meaning essentially a write method requiring an actual signature) is preceded by a call to “eth_accounts” and then [validate that the method being requested to sign matches the existing permission](https://github.com/MetaMask/eth-json-rpc-middleware/blob/b894ed96d26622a2b9c161ff2581220523e8bc4a/src/wallet.ts#L372).\n- These checks in [middleware specifically for each these methods](https://github.com/MetaMask/eth-json-rpc-middleware/blob/b894ed96d26622a2b9c161ff2581220523e8bc4a/src/wallet.ts#L83)\n    - [signTypedData_v4](https://github.com/MetaMask/eth-json-rpc-middleware/blob/b894ed96d26622a2b9c161ff2581220523e8bc4a/src/wallet.ts#L242)\n    - [eth_sendTransaction](https://github.com/MetaMask/eth-json-rpc-middleware/blob/b894ed96d26622a2b9c161ff2581220523e8bc4a/src/wallet.ts#L134)\n    - Etc.\n\n So a way we could do this I suppose is add a chain related caveat to eth_accounts permission (that is written each time the network changes network) and then  getPermittedAccounts -> executeRestrictedMethod -> getPermission result would get formatted with `decorateWithCaveats` into a tuple that would include the chainId on which the dApp is currently active.  \nIt’s possible the only methods where permissions and chainId both matter are `eth_sendTransaction` & `eth_signTransaction`. Other permissioned methods (personal_sign, eth_signTypedData, eth_getEncryptionPublicKey, etc.) are chain agnostic.\n\nOne problem with this approach is that there are some methods that really don’t care about permissions but do care about chainId like wallet_watchAsset. Getting the state from permissions in these cases is especially cumbersome.",
    "reactions": {
      "url": "https://api.github.com/repos/MetaMask/core/issues/comments/1626350501/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
