{
  "url": "https://api.github.com/repos/MetaMask/core/issues/3640",
  "repository_url": "https://api.github.com/repos/MetaMask/core",
  "labels_url": "https://api.github.com/repos/MetaMask/core/issues/3640/labels{/name}",
  "comments_url": "https://api.github.com/repos/MetaMask/core/issues/3640/comments",
  "events_url": "https://api.github.com/repos/MetaMask/core/issues/3640/events",
  "html_url": "https://github.com/MetaMask/core/issues/3640",
  "id": 2031706595,
  "node_id": "I_kwDOCBB0Cc55GWHj",
  "number": 3640,
  "title": "TokenRatesController clears `contractExchangeRates` and doesn't update it if changes to provider config are not reflected in network client configuration",
  "user": {
    "login": "mcmire",
    "id": 7371,
    "node_id": "MDQ6VXNlcjczNzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7371?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcmire",
    "html_url": "https://github.com/mcmire",
    "followers_url": "https://api.github.com/users/mcmire/followers",
    "following_url": "https://api.github.com/users/mcmire/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcmire/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcmire/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcmire/subscriptions",
    "organizations_url": "https://api.github.com/users/mcmire/orgs",
    "repos_url": "https://api.github.com/users/mcmire/repos",
    "events_url": "https://api.github.com/users/mcmire/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcmire/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-12-08T00:02:19Z",
  "updated_at": "2023-12-08T00:05:07Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "If the chain ID or ticker in the provider config changes, then they are stored in memory as the current chain ID and ticker, and the rates are re-fetched and categorized under either this new chain ID or ticker on the next poll iteration. However, when that happens, if for some reason the configuration for the network client that matched the previous values for chain ID and ticker does not reflect the new changes, then `contractExchangeRates` will be cleared. This happens because [`contractExchangeRates` is actually cleared before the rates are re-fetched](https://github.com/MetaMask/core/blob/aca89a43935047c73d0d293897030e0ef37de855/packages/assets-controllers/src/TokenRatesController.ts#L262), and then in order to update `contractExchangeRates` [we check to make sure that the currently set chain ID and ticker match the network client used to make the request](https://github.com/MetaMask/core/blob/aca89a43935047c73d0d293897030e0ef37de855/packages/assets-controllers/src/TokenRatesController.ts#L368-L372). Put more simply, though, it's a consequence of using provider config to read data about the network in one place and network client configuration in another.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/MetaMask/core/issues/3640/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/MetaMask/core/issues/3640/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
